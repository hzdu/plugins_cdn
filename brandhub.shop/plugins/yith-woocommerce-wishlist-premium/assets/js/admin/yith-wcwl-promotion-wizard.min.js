"use strict";jQuery(r=>{let o=null;var n=function(e,t){var o=this;o.settings={},o.modal=null,o._init=function(){o.settings=r.extend({template:e.data("template"),template_data:{},container:".yith-wcwl-wizard-modal",events:{}},t),"function"==typeof o.settings.events.init&&o.settings.events.init(e,t),o._initOpener()},o._initOpener=function(){e.on("click",function(t){const e=r(this);let n=o.settings.template_data;t.preventDefault(),"function"==typeof n&&(n=n(e)),e.WCBackboneModal({template:o.settings.template,variable:n});t=r(o.settings.container);o._initEditor(t),o._initEnhancedSelect(t),o._initTabs(t),o._initSteps(t),o._initOptions(t,n),o._initEvents(t,o.settings.events)})},o._initEditor=function(t){t.find(".with-editor").each(function(){const n=r(this),t=n.attr("id");tinymce.get(t)&&wp.editor.remove(t),wp.editor.initialize(t,{tinymce:{wpautop:!0,init_instance_callback:function(e){e.on("Change",function(t){n.val(e.getContent()).change()})}},quicktags:!0,mediaButtons:!0})})},o._initEnhancedSelect=function(t){r(document.body).trigger("wc-enhanced-select-init")},o._initTabs=function(t){t.find(".tabs").on("click","a",function(t){const e=r(this),n=e.closest("ul"),i=n.find("a"),a=n.parent(),o=a.find(".tab"),c=e.data("target"),s=r(c);let l=!1;t.preventDefault(),e.hasClass("active")||(l=!0),i.attr("aria-selected","false").removeClass("active"),e.attr("aria-selected","true").addClass("active"),o.attr("aria-expanded","false").removeClass("active").hide(),s.attr("aria-expanded","true").addClass("active").show(),l&&e.trigger("tabChange")})},o._initOptions=function(i,t){r.each(t,function(t,e){const n=i.find('[name="'+t+'"]');n.length&&e!==n.val()&&(n.is("select")&&e&&!n.find('option[value="'+e+'"]').length?n.append('<option value="'+e+'" selected="selected">'+e+" </option>"):n.val(e))})},o._initSteps=function(a){a.find(".step").hide().first().show(),a.find(".continue-button").on("click",function(t){const e=r(this),n=e.closest(".step"),i=n.next(".step");t.preventDefault(),i.length&&o._changeStep(a,n,i)}),a.find(".back-button").on("click",function(t){const e=r(this),n=e.closest(".step"),i=n.prev(".step");t.preventDefault(),i.length&&o._changeStep(a,n,i)})},o._initEvents=function(i,t){"function"==typeof o.settings.events.open&&o.settings.events.open(e,i),r.each(t,function(t,e){let n=null;"init"!==t&&"open"!==t&&(n="tabChange"===t?i.find(".tabs"):"stepChange"===t?i.find(".step"):i.find(":input"),n.on(t,function(t){return e(r(this),i,t)}))})},o._changeStep=function(o,c,s){c.animate({opacity:0},{duration:200,complete:function(){var t=o.find("article"),e=t.outerWidth(),n=t.outerHeight();t.outerWidth("auto"),t.outerHeight("auto"),c.hide(),s.show();var i=s.outerWidth(),a=s.outerHeight();s.hide(),c.css("opacity",1),t.outerWidth(e),t.outerHeight(n),t.animate({width:i,height:a},{duration:200,complete:function(){s.fadeIn(200)}})}}),s.trigger("stepChange")},o._init()},i=function(t,e,n){const i=e.find(".email-preview"),a=e.find("#template").val();o&&o.abort(),o=r.ajax({url:ajaxurl+"?action=preview_promotion_email&_wpnonce="+yith_wcwl.nonce.preview_promotion_email,data:e.find("form").serialize(),method:"POST",beforeSend:function(){i.block({message:null,overlayCSS:{background:"transparent",opacity:.6}})},complete:function(){i.unblock()},success:function(t){i.removeClass("html plain").addClass(a).find(".no-interactions").html(t)}})},t=function(){return{template:"yith-wcwl-promotion-wizard",template_data:function(t){var e=t.data("draft");return e=e||r.extend(e,{product_id:t.data("product_id"),user_id:t.data("user_id"),content_html:yith_wcwl.promotion.content_html,content_text:yith_wcwl.promotion.content_text,coupon:!1})},events:{change:i,open:function(t,e,n){e.find("#content_html-tmce").click(),i(0,e)},tabChange:function(t,e,n){e.find("#template").val(t.find(".active").data("template")),i(0,e)},stepChange:function(t,e,n){var i=t.find(".receivers-count"),a=t.find(".show-on-long-queue"),o=a.data("threshold");i.length&&r.ajax({url:ajaxurl+"?action=calculate_promotion_email_receivers&_wpnonce="+yith_wcwl.nonce.calculate_promotion_email_receivers,data:e.find("form").serialize(),method:"post",beforeSend:function(){i.css("opacity",.3),a.length&&a.hide()},complete:function(){i.css("opacity",1)},success:function(t){"undefined"!=typeof t.label&&(i.html(t.label),a.length&&"undefined"!=typeof t.count&&t.count>o&&a.show())}})}}}};r.fn.wizard=function(t){var e=r(this);return e.length&&new n(e,t),e},r(".create-promotion").wizard(t()),r(".restore-draft").wizard(t())});