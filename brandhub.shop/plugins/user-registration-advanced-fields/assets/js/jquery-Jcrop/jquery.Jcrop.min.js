!function(Be){Be.Jcrop=function(e,t){var v=Be.extend({},Be.Jcrop.defaults),n=navigator.userAgent.toLowerCase(),o=/msie/.test(n),r=/msie [1-6]\./.test(n);function y(e){return Math.round(e)+"px"}function m(e){return v.baseClass+"-"+e}function c(e){e=Be(e).offset();return[e.left,e.top]}function i(e){return[e.pageX-Y[0],e.pageY-Y[1]]}function a(e){v=Be.extend(v,e="object"!=typeof e?{}:e),Be.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof v[t]&&(v[t]=function(){})})}function s(e,t,n){if(Y=c(k),ve.setCursor("move"===e?e:e+"-resize"),"move"===e)return ve.activateHandlers((o=t,ke.watchKeys(),function(e){Z.moveOffset([e[0]-o[0],e[1]-o[1]]),o=e,we.update()}),l,n);var o,r,i,a=Z.getFixed(),s=u(e),t=Z.getCorner(u(s));Z.setPressed(Z.getCorner(s)),Z.setCurrent(t),ve.activateHandlers((r=e,i=a,function(e){if(v.aspectRatio)switch(r){case"e":case"w":e[1]=i.y+1;break;case"n":case"s":e[0]=i.x+1}else switch(r){case"e":case"w":e[1]=i.y2;break;case"n":case"s":e[0]=i.x2}Z.setCurrent(e),we.update()}),l,n)}function u(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function C(t){return function(e){return v.disabled||"move"===t&&!v.allowMove||(Y=c(k),A=!0,s(t,i(e)),e.stopPropagation(),e.preventDefault()),!1}}function d(e,t,n){var o=e.width(),r=e.height();n<(r=t<o&&0<t?(o=t)/e.width()*e.height():r)&&0<n&&(o=(r=n)/e.height()*e.width()),P=e.width()/o,J=e.height()/r,e.width(o).height(r)}function x(e){return{x:e.x*P,y:e.y*J,x2:e.x2*P,y2:e.y2*J,w:e.w*P,h:e.h*J}}function l(e){var t=Z.getFixed();t.w>v.minSelect[0]&&t.h>v.minSelect[1]?(we.enableHandles(),we.done()):we.release(),ve.setCursor(v.allowSelect?"crosshair":"default")}function h(e){if(v.disabled)return!1;if(!v.allowSelect)return!1;A=!0,Y=c(k),we.disableHandles(),ve.setCursor("crosshair");var t=i(e);return Z.setPressed(t),we.update(),ve.activateHandlers(f,l,"touch"===e.type.substring(0,5)),ke.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function f(e){Z.setCurrent(e),we.update()}function S(){var e=Be("<div></div>").addClass(m("tracker"));return o&&e.css({opacity:0,backgroundColor:"white"}),e}"object"!=typeof e&&(e=Be(e)[0]),a(t="object"!=typeof t?{}:t);var k,p={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},g=Be(e),n=!0;"IMG"==e.tagName?(0!=g[0].width&&0!=g[0].height?(g.width(g[0].width),g.height(g[0].height)):((t=new Image).src=g[0].src,g.width(t.width),g.height(t.height)),(k=g.clone().removeAttr("id").css(p).show()).width(g.width()),k.height(g.height()),g.after(k).hide()):(k=g.css(p).show(),n=!1,null===v.shade&&(v.shade=!0)),d(k,v.boxWidth,v.boxHeight);var b=k.width(),w=k.height(),z=Be("<div />").width(b).height(w).addClass(m("holder")).css({position:"relative",backgroundColor:v.bgColor}).insertAfter(g).append(k);v.addClass&&z.addClass(v.addClass);var M=Be("<div />"),O=Be("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),j=Be("<div />").width("100%").height("100%").css("zIndex",320),F=Be("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=Z.getFixed();v.onDblClick.call(Ie,e)}).insertBefore(k).append(O,j);n&&(M=Be("<img />").attr("src",k.attr("src")).css(p).width(b).height(w),O.append(M)),r&&F.css({overflowY:"hidden"});var H,D,I,B,P,J,A,R,T=v.boundary,K=S().width(b+2*T).height(w+2*T).css({position:"absolute",top:y(-T),left:y(-T),zIndex:290}).mousedown(h),E=v.bgColor,W=v.bgOpacity,Y=c(k),q={createDragger:function(t){return function(e){return v.disabled||"move"===t&&!v.allowMove||(Y=c(k),A=!0,s(t,i(q.cfilter(e)),!0),e.stopPropagation(),e.preventDefault()),!1}},newSelection:function(e){return h(q.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:L,support:!0===v.touchSupport||!1===v.touchSupport?v.touchSupport:L()};function L(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var r,i=(r="on"+(r=n[e]))in o;i||(o.setAttribute(r,"return;"),i="function"==typeof o[r]),t[n[e]]=i}return t.touchstart&&t.touchend&&t.touchmove}catch(a){return!1}}var X,G,N,V,Q,U,Z=(U=Q=V=N=0,{flipCoords:ee,setPressed:function(e){e=_(e),Q=N=e[0],U=V=e[1]},setCurrent:function(e){e=_(e),X=e[0]-Q,G=e[1]-U,Q=e[0],U=e[1]},getOffset:function(){return[X,G]},moveOffset:function(e){var t=e[0],e=e[1];N+t<0&&(t-=t+N),V+e<0&&(e-=e+V),w<U+e&&(e+=w-(U+e)),b<Q+t&&(t+=b-(Q+t)),N+=t,Q+=t,V+=e,U+=e},getCorner:function(e){var t=$();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}},getFixed:$});function $(){if(!v.aspectRatio)return function(){var e,t=Q-N,n=U-V;H&&Math.abs(t)>H&&(Q=0<t?N+H:N-H);D&&Math.abs(n)>D&&(U=0<n?V+D:V-D);B/J&&Math.abs(n)<B/J&&(U=0<n?V+B/J:V-B/J);I/P&&Math.abs(t)<I/P&&(Q=0<t?N+I/P:N-I/P);N<0&&(Q-=N,N-=N);V<0&&(U-=V,V-=V);Q<0&&(N-=Q,Q-=Q);U<0&&(V-=U,U-=U);b<Q&&(N-=e=Q-b,Q-=e);w<U&&(V-=e=U-w,U-=e);b<N&&(U-=e=N-w,V-=e);w<V&&(U-=e=V-w,V-=e);return te(ee(N,V,Q,U))}();var e,t,n,o,r=v.aspectRatio,i=v.minSize[0]/P,a=v.maxSize[0]/P,s=v.maxSize[1]/J,c=Q-N,u=U-V,d=Math.abs(c),l=Math.abs(u);return 0===a&&(a=10*b),0==s&&0,d/l<r?(t=U,n=l*r,(e=c<0?N-n:n+N)<0?(e=0,o=Math.abs((e-N)/r),t=u<0?V-o:o+V):b<e&&(e=b,o=Math.abs((e-N)/r),t=u<0?V-o:o+V)):(e=Q,o=d/r,(t=u<0?V-o:V+o)<0?(t=0,n=Math.abs((t-V)*r),e=c<0?N-n:n+N):w<t&&(t=w,n=Math.abs(t-V)*r,e=c<0?N-n:n+N)),N<e?(e-N<i?e=N+i:a<e-N&&(e=N+a),t=V<t?V+(e-N)/r:V-(e-N)/r):e<N&&(N-e<i?e=N-i:a<N-e&&(e=N-a),t=V<t?V+(N-e)/r:V-(N-e)/r),e<0?(N-=e,e=0):b<e&&(N-=e-b,e=b),t<0?(V-=t,t=0):w<t&&(V-=t-w,t=w),te(ee(N,V,e,t))}function _(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>b&&(e[0]=b),e[1]>w&&(e[1]=w),[Math.round(e[0]),Math.round(e[1])]}function ee(e,t,n,o){var r=e,i=n,a=t,s=o;return n<e&&(r=n,i=e),o<t&&(a=o,s=t),[r,a,i,s]}function te(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var ne,oe,re,ie=(ne=!1,oe=Be("<div />").css({position:"absolute",zIndex:240,opacity:0}),re={top:ce(),left:ce().height(w),right:ce().height(w),bottom:ce()},{update:ae,updateRaw:se,getShades:fe,setBgColor:de,enable:ue,disable:le,resize:function(e,t){re.left.css({height:y(t)}),re.right.css({height:y(t)})},refresh:function(){(v.shade?ue:le)(),we.isAwake()&&he(v.bgOpacity)},opacity:he});function ae(){return se(Z.getFixed())}function se(e){re.top.css({left:y(e.x),width:y(e.w),height:y(e.y)}),re.bottom.css({top:y(e.y2),left:y(e.x),width:y(e.w),height:y(w-e.y2)}),re.right.css({left:y(e.x2),width:y(b-e.x2)}),re.left.css({width:y(e.x)})}function ce(){return Be("<div />").css({position:"absolute",backgroundColor:v.shadeColor||v.bgColor}).appendTo(oe)}function ue(){ne||(ne=!0,oe.insertBefore(k),ae(),we.setBgOpacity(1,0,1),M.hide(),de(v.shadeColor||v.bgColor,1),we.isAwake()?he(v.bgOpacity,1):he(1,1))}function de(e,t){He(fe(),e,t)}function le(){ne&&(oe.remove(),M.show(),ne=!1,we.isAwake()?we.setBgOpacity(v.bgOpacity,1,1):(we.setBgOpacity(1,1,1),we.disableHandles()),He(z,0,1))}function he(e,t){ne&&(v.bgFade&&!t?oe.animate({opacity:1-e},{queue:!1,duration:v.fadeTime}):oe.css({opacity:1-e}))}function fe(){return oe.children()}var pe,ge,be,we=function(){var r,i=370,a={},s={},n={},e=!1;function c(e,t){t=Be("<div />").mousedown(C(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t}).addClass("ord-"+e);return q.support&&t.bind("touchstart.jcrop",q.createDragger(e)),j.append(t),t}function t(e){for(var t=0;t<e.length;t++)n[e[t]]=c(e[t],i++).addClass("jcrop-dragbar")}function o(e){for(var t,n,o=0;o<e.length;o++){switch(e[o]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}a[e[o]]=(n=t,n=Be("<div />").css({position:"absolute",opacity:v.borderOpacity}).addClass(m(n)),O.append(n),n)}}function u(e){for(var t,n,o=0;o<e.length;o++)s[e[o]]=(t=e[o],n=void 0,n=v.handleSize,t=c(t,i++).css({opacity:v.handleOpacity}).addClass(m("handle")),n&&t.width(n).height(n),t)}function d(){var e=Z.getFixed();Z.setPressed([e.x,e.y]),Z.setCurrent([e.x2,e.y2]),l()}function l(e){if(r)return h(e)}function h(e){var t,n,o=Z.getFixed();t=o.w,n=o.h,F.width(Math.round(t)).height(Math.round(n)),t=o.x,n=o.y,v.shade||M.css({top:y(-n),left:y(-t)}),F.css({top:y(n),left:y(t)}),v.shade&&ie.updateRaw(o),r||function(){F.show(),v.shade?ie.opacity(W):f(W,!0);r=!0}(),(e?v.onSelect:v.onChange).call(Ie,x(o))}function f(e,t,n){(r||t)&&(v.bgFade&&!n?k.animate({opacity:e},{queue:!1,duration:v.fadeTime}):k.css("opacity",e))}function p(){if(e=!0,v.allowResize)return j.show(),!0}function g(){e=!1,j.hide()}function b(e){e?(R=!0,g()):(R=!1,p())}v.dragEdges&&Be.isArray(v.createDragbars)&&t(v.createDragbars),Be.isArray(v.createHandles)&&u(v.createHandles),v.drawBorders&&Be.isArray(v.createBorders)&&o(v.createBorders),Be(document).bind("touchstart.jcrop-ios",function(e){Be(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var w=S().mousedown(C("move")).css({cursor:"move",position:"absolute",zIndex:360});return q.support&&w.bind("touchstart.jcrop",q.createDragger("move")),O.append(w),g(),{updateVisible:l,update:h,release:function(){g(),F.hide(),v.shade?ie.opacity(1):f(1),r=!1,v.onRelease.call(Ie)},refresh:d,isAwake:function(){return r},setCursor:function(e){w.css("cursor",e)},enableHandles:p,enableOnly:function(){e=!0},showHandles:function(){e&&j.show()},disableHandles:g,animMode:b,setBgOpacity:f,done:function(){b(!1),d()}}}(),ve=(pe=function(){},ge=function(){},(be=v.trackDocument)||K.mousemove(ye).mouseup(me).mouseout(me),k.before(K),{activateHandlers:function(e,t,n){return A=!0,pe=e,ge=t,n=n,K.css({zIndex:450}),n?Be(document).bind("touchmove.jcrop",Ce).bind("touchend.jcrop",xe):be&&Be(document).bind("mousemove.jcrop",ye).bind("mouseup.jcrop",me),!1},setCursor:function(e){K.css("cursor",e)}});function ye(e){return pe(i(e)),!1}function me(e){return e.preventDefault(),e.stopPropagation(),A&&(A=!1,ge(i(e)),we.isAwake()&&v.onSelect.call(Ie,x(Z.getFixed())),K.css({zIndex:290}),Be(document).unbind(".jcrop"),pe=function(){},ge=function(){}),!1}function Ce(e){return pe(i(q.cfilter(e))),!1}function xe(e){return me(q.cfilter(e))}var Se,ke=(Se=Be('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),p=Be("<div />").css({position:"absolute",overflow:"hidden"}).append(Se),v.keySupport&&(Se.keydown(function(e){if(e.ctrlKey||e.metaKey)return!0;var t=!!e.shiftKey?10:1;switch(e.keyCode){case 37:ze(e,-t,0);break;case 39:ze(e,t,0);break;case 38:ze(e,0,-t);break;case 40:ze(e,0,t);break;case 27:v.allowSelect&&we.release();break;case 9:return!0}return!1}).blur(function(e){Se.hide()}),r||!v.fixedSupport?(Se.css({position:"absolute",left:"-20px"}),p.append(Se).insertBefore(k)):Se.insertBefore(k)),{watchKeys:function(){v.keySupport&&(Se.show(),Se.focus())}});function ze(e,t,n){v.allowMove&&(Z.moveOffset([t,n]),we.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function Me(e){Oe([e[0]/P,e[1]/J,e[2]/P,e[3]/J]),v.onSelect.call(Ie,x(Z.getFixed())),we.enableHandles()}function Oe(e){Z.setPressed([e[0],e[1]]),Z.setCurrent([e[2],e[3]]),we.update()}function je(){v.disabled=!0,we.disableHandles(),we.setCursor("default"),ve.setCursor("default")}function Fe(){v.disabled=!1,De()}function He(e,t,n){t=t||v.bgColor;v.bgFade&&Be.fx.step.hasOwnProperty("backgroundColor")&&v.fadeTime&&!n?e.animate({backgroundColor:t},{queue:!1,duration:v.fadeTime}):e.css("backgroundColor",t)}function De(e){v.allowResize?e?we.enableOnly():we.enableHandles():we.disableHandles(),ve.setCursor(v.allowSelect?"crosshair":"default"),we.setCursor(v.allowMove?"move":"default"),v.hasOwnProperty("trueSize")&&(P=v.trueSize[0]/b,J=v.trueSize[1]/w),v.hasOwnProperty("setSelect")&&(Me(v.setSelect),we.done(),delete v.setSelect),ie.refresh(),v.bgColor!=E&&(He(v.shade?ie.getShades():z,v.shade&&v.shadeColor||v.bgColor),E=v.bgColor),W!=v.bgOpacity&&(W=v.bgOpacity,v.shade?ie.refresh():we.setBgOpacity(W)),H=v.maxSize[0]||0,D=v.maxSize[1]||0,I=v.minSize[0]||0,B=v.minSize[1]||0,v.hasOwnProperty("outerImage")&&(k.attr("src",v.outerImage),delete v.outerImage),we.refresh()}q.support&&K.bind("touchstart.jcrop",q.newSelection),j.hide(),De(!0);var Ie={setImage:function(r,i){we.release(),je();var a=new Image;a.onload=function(){var e=a.width,t=a.height,n=v.boxWidth,o=v.boxHeight;k.width(e).height(t),k.attr("src",r),M.attr("src",r),d(k,n,o),b=k.width(),w=k.height(),M.width(b).height(w),K.width(b+2*T).height(w+2*T),z.width(b).height(w),ie.resize(b,w),Fe(),"function"==typeof i&&i.call(Ie)},a.src=r},animateTo:function(e,t){var n,o,r,i,a,s,c,u,d,l,h=e[0]/P,f=e[1]/J,p=e[2]/P,g=e[3]/J;function b(){window.setTimeout(l,r)}R||(n=Z.flipCoords(h,f,p,g),e=[(e=Z.getFixed()).x,e.y,e.x2,e.y2],r=v.animationDelay,i=n[0]-(o=e)[0],a=n[1]-e[1],s=n[2]-e[2],c=n[3]-e[3],u=0,d=v.swingSpeed,h=o[0],f=o[1],p=o[2],g=o[3],we.animMode(!0),l=function(){u+=(100-u)/d,o[0]=Math.round(h+u/100*i),o[1]=Math.round(f+u/100*a),o[2]=Math.round(p+u/100*s),o[3]=Math.round(g+u/100*c),(u=99.8<=u?100:u)<100?(Oe(o),b()):(we.done(),we.animMode(!1),"function"==typeof t&&t.call(Ie))},b())},setSelect:Me,setOptions:function(e){a(e),De()},tellSelect:function(){return x(Z.getFixed())},tellScaled:function(){return Z.getFixed()},setClass:function(e){z.removeClass().addClass(m("holder")).addClass(e)},disable:je,enable:Fe,cancel:function(){we.done(),ve.activateHandlers(null,null)},release:we.release,destroy:function(){z.remove(),g.show(),g.css("visibility","visible"),Be(e).removeData("Jcrop")},focus:ke.watchKeys,getBounds:function(){return[b*P,w*J]},getWidgetSize:function(){return[b,w]},getScaleFactor:function(){return[P,J]},getOptions:function(){return v},ui:{holder:z,selection:F}};return o&&z.bind("selectstart",function(){return!1}),g.data("Jcrop",Ie),Ie},Be.fn.Jcrop=function(e,t){var n;return this.each(function(){if(Be(this).data("Jcrop")){if("api"===e)return Be(this).data("Jcrop");Be(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?Be.Jcrop.Loader(this,function(){Be(this).css({display:"block",visibility:"hidden"}),n=Be.Jcrop(this,e),Be.isFunction(t)&&t.call(n)}):(Be(this).css({display:"block",visibility:"hidden"}),n=Be.Jcrop(this,e),Be.isFunction(t)&&t.call(n))}),this},Be.Jcrop.Loader=function(e,t,n){var o=Be(e),r=o[0];o.bind("load.jcloader",function i(){r.complete?(o.unbind(".jcloader"),Be.isFunction(t)&&t.call(r)):window.setTimeout(i,50)}).bind("error.jcloader",function(e){o.unbind(".jcloader"),Be.isFunction(n)&&n.call(r)}),r.complete&&Be.isFunction(t)&&(o.unbind(".jcloader"),t.call(r))},Be.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);