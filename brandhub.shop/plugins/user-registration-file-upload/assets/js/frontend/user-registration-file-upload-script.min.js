!function(o){document.addEventListener("DOMContentLoaded",function(){Dropzone.autoDiscover=!1}),o(document).on("user_registration_frontend_form_data_render",function(e,t,i){"input"===t.get(0).tagName.toLowerCase()&&t.hasClass(".urfu-file-input")&&"undefined"!==t.val()&&0<t.val()&&(i.value=t.val())});var e={init:function(){this.init_event()},init_event:function(){function n(e,t){t>=e.closest(".dropzone").find(".urfu-file-input").data("max-file-limit")?e.closest(".dropzone").find(".dz-message").addClass("hide"):e.closest(".dropzone").find(".dz-message").removeClass("hide");t=urfu_script_data.urfu_max_file_remaining.replace("%qty%",e.closest(".dropzone").find(".urfu-file-input").data("max-file-limit")-t);e.closest(".dropzone").find(".user-registration-file-upload-hint").text(t)}o(document).on("click",".urfu-remove-file",function(){o(this);if(attachment_id=o(this).data("attachment-id"),field_name=o(this).data("field-name"),attachment_ids=o(this).closest(".dropzone").find(".urfu-file-input").val(),attachment_ids_array=attachment_ids.split(","),"undefined"!=typeof attachment_id){for(var e,t,i=attachment_ids_array.length-1;0<=i;i--)attachment_ids_array[i]==attachment_id&&(o(this).closest(".dropzone").find(".urfu_removed_files").length<=0&&((t=document.createElement("input")).setAttribute("type","hidden"),t.setAttribute("class","urfu_removed_files"),t.setAttribute("name","urfu_removed_files_"+field_name),t.setAttribute("value",""),o(this).closest(".dropzone").find(".urfu-upload-node").append(t)),e=o(this).closest(".dropzone").find(".urfu_removed_files").val(),(t=new Set(e?JSON.parse(e):[])).add(attachment_id),o(this).closest(".dropzone").find(".urfu_removed_files").val(JSON.stringify(Array.from(t))),attachment_ids_array.splice(i,1));n(o(this),attachment_ids_array.length),o(this).closest(".dropzone").find(".urfu-file-input").val(attachment_ids_array.toString());var a=o(this).closest(".dropzone").find(".urfu-file-input").data("max-file-number");o(this).closest(".dropzone")[0].dropzone.options.maxFiles=++a,o(this).closest(".dropzone").find(".urfu-file-input").data("max-file-number",a)}o(this).closest(".dz-preview").remove()}),o(".dropzone").each(function(){var e=o(this),t=e.closest(".ur-frontend-form").find("form.register, form.edit-profile").data("form-id"),r=(void 0===t&&(t=o(".user-registration").data("form-id")),e.data("id")),i=o("#"+r).data("max-upload-size-limit"),i=""!==(i=parseInt(i))?i/1024:0,a=o("#"+r).data("valid-file-type"),a=""!==a?a:"";e.dropzone({url:urfu_script_data.ajax_url+"?action=user_registration_file_upload_method_upload&security="+urfu_script_data.urfu_upload_nonce+"&form_id="+t+"&field_name="+r,uploadMultiple:!0,parallelUploads:1,paramName:function(){return"file[]"},maxFiles:o("#"+r).data("max-file-number"),maxFilesize:i,dictFileTooBig:urfu_script_data.urfu_file_size_exceeded.replace("%qty%",i<1?i.toFixed(2):i),acceptedFiles:a,successmultiple:function(e,t){(e=Array.isArray(e)?e[0]:e).previewElement.classList.add("dz-success");var i="";if("undefined"==typeof(e.attachment_id=t).success||"undefined"==typeof t.data)throw urfu_script_data.urfu_something_wrong;a=t.data.message,o(e.previewElement).closest(".urfu-file-upload").find(".user-registration-error").remove(),s(e.name,e.previewElement),t.success||(o(e.previewElement).addClass("dz-error").find(".dz-error-message").text(a),o(e.previewElement).append('<a class="dz-remove urfu-remove-file" href="javascript:undefined;" data-dz-remove="">Remove file</a>')),t.success&&(i=t.data.upload_files,o(e.previewElement).append(a));var a,t=o("#"+r);0==i?(e=t.data("max-file-number"),t.closest(".dropzone")[0].dropzone.options.maxFiles=++e,t.closest(".dropzone").find(".urfu-file-input").data("max-file-number",e)):(""===t.val()?t.val(i):((a=[]).push(t.val()),a.push(i),t.val(a)),length=t.val().split(",").length,n(t,length))},queuecomplete:function(e,t){value_array=o("#"+r).val().split(",");for(var i=value_array.length;0<=i;i--)o.isNumeric(value_array[i])||value_array.splice(i,1);n(o("#"+r),value_array.length),o("#"+r).val(value_array)},error:function(e,t){o(e.previewElement).closest(".urfu-file-upload").find(".user-registration-error").remove(),o(e.previewElement).addClass("dz-error").find(".dz-error-message").text(t),o(e.previewElement).append('<a class="dz-remove urfu-remove-file" href="javascript:undefined;" data-dz-remove="">Remove file</a>')}})})}};function t(t,e){e=e.find(".dz-error-message");0<e.length&&o.each(e,function(){var e=o(this);""!==e.text()&&(o(window).scrollTop(e.closest(".dz-preview").offset().top),t.preventDefault())})}function r(){o(".dropzone").each(function(){var e=o(this),t=(Dropzone.forElement("#"+e.attr("id")).removeAllFiles(!0),e.find(".dz-message").show(),e.closest(".dropzone").find(".urfu-file-input").data("max-file-limit")),t=urfu_script_data.urfu_max_file_remaining.replace("%qty%",t);e.closest(".dropzone").find(".user-registration-file-upload-hint").text(t)})}function s(e,t){var e=e.split(".").pop(),i=new Array("pdf","doc","xls","ppt","mp3","mp4","zip"),a=new Array("docx","xlsx","pptx"),r=new Array("jpg","jpeg","png","gif"),n=null;-1!=i.indexOf(e)?n=e:-1!=a.indexOf(e)?n=e.substr(0,e.length-1):-1==r.indexOf(e)&&(n="default"),null!==n&&o(t).find(".dz-image img").attr("src",urfu_script_data.home_url+"/images/filetypes/"+n+".svg")}o(document).bind("user_registration_frontend_validate_before_form_submit",function(e,t){t=t.find(".dz-error-message");o.each(t,function(){var e=o(this);""==e.text()&&(e.removeClass("dz-error-message"),e.addClass("dz-error-message-custom-class"))})}),o(document).bind("user_registration_frontend_form_data_filter",function(e,i){var t=o(".urfu-uploaded-file");$uploaded_files=[],o.each(t,function(){var e=o(this).closest(".dropzone").data("id");"undefined"==typeof $uploaded_files[e]&&($uploaded_files[e]=[]),$uploaded_files[e].push(o(this).val())}),o.each(i,function(e,t){"undefined"!=typeof $uploaded_files[t.field_name]&&(t.value=$uploaded_files[t.field_name],t.field_type=t.field_type,t.label=t.label,t.field_name=t.field_name,i[e]=t)})}),o(document).bind("user_registration_frontend_before_edit_profile_submit",function(e,t,i){var a=o(".urfu_removed_files");o.each(a,function(){var e=o(this).attr("name");t[e]=o(this).val()})}),o(document).bind("user_registration_frontend_before_form_submit",function(e,t,i,a){i.find(".dz-error-message-custom-class").addClass("dz-error-message")}),o(document).on("click",".user-registration-submit-Button",function(e){t(e,o(this).closest(".ur-frontend-form form"))}),o(document).on("submit","form.edit-profile",function(e){t(e,o(this).closest(".ur-frontend-form form"))}),o(window).on("load",function(){o(".dropzone").each(function(){Dropzone.autoDiscover=!1;var e=o(this)[0].dropzone;e&&e.destroy()}),e.init()}),o(document).on("user_registration_frontend_after_ajax_complete",function(e,t,i,a){"message"===i&&(Dropzone.autoDiscover=!1,r())}),o(document).on("user_registration_frontend_reset_button",function(e){r()}),o(".dropzone").each(function(){var e=o(this);"readonly"===e.closest(".dropzone").find(".urfu-file-input").attr("readonly")&&(e.closest(".urfu-file-upload").find(".dropzone").find(".dz-preview").find(".urfu-download-file").css("pointer-events","auto"),e.closest(".urfu-file-upload").css("pointer-events","none"))}),o(".dropzone").find(".dz-image img").each(function(){s(o(this).attr("alt"),o(this).closest(".dz-preview"))}),o(document).on("user_registration_edit_profile_after_ajax_complete",function(e,t,i){t=JSON.parse(t.responseText);"undefined"!=typeof t.success&&!0===t.success&&(i.find(".urfu-uploaded-file").remove(),"undefined"!=typeof t.data.file_upload_attachments&&o.each(t.data.file_upload_attachments,function(e,t){o("#ur_user_registration_"+e).find(".urfu-remove-file").each(function(){var i=o(this),a=i.data("file-name");void 0!==a&&o.each(t,function(e,t){t.filename===a&&(i.data("attachment-id",e),e='<a class="urfu-download-file" href="'+t.url+'" title="Download" target="_blank"><span class="dashicons dashicons-arrow-down-alt"></span></a>',i.before(e))})})}))})}(jQuery);