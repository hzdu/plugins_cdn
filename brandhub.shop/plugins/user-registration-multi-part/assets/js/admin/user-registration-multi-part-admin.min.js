!function(n){var u={init:function(){n(document).on("init_perfect_scrollbar update_perfect_scrollbar",function(){var t,r;"undefined"!=typeof PerfectScrollbar&&(t=n(".ur-builder-wrapper-content"),r=n(".user-registration-multi-part-tabs .user-registration-tabs"),1<=t.length&&"undefined"==typeof window.ur_builder_content_scrollbar?window.ur_builder_content_scrollbar=new PerfectScrollbar(document.querySelector(".ur-builder-wrapper-content"),{suppressScrollX:!0}):"undefined"!=typeof window.ur_builder_content_scrollbar&&window.ur_builder_content_scrollbar.update(),1<=r.length&&"undefined"==typeof window.ur_multi_part_tab_scrollbar?window.ur_multi_part_tab_scrollbar=new PerfectScrollbar(document.querySelector(".user-registration-multi-part-tabs .user-registration-tabs"),{suppressScrollY:!0}):"undefined"!=typeof window.ur_multi_part_tab_scrollbar&&window.ur_multi_part_tab_scrollbar.update())});var i,t=n(".user-registration-multi-part-tabs .user-registration-tabs > li:first").data("part-id"),r=n('.ur-multipart-page-option input[name="user_registration_multipart_rows_'+t+'"]').val();void 0!==r&&0!==JSON.parse(r).length||(r=n(".ur-input-grids > div.ur-single-row"),i=[],r.each(function(t,r){i.push(parseInt(n(r).attr("data-row-id")))}),0===i.length&&i.push(0),n('.ur-multipart-page-option input[name="user_registration_multipart_rows_'+t+'"]').val(JSON.stringify(i))),u.render_part_rows(t),u.render_part_settings(),n(".user-registration-multi-part-tabs ul.user-registration-tabs").on("click","li a",function(t){t.preventDefault();var t=n(this).parent(),r=t.attr("data-part-id");void 0!==r&&(t.siblings().removeClass("active"),t.addClass("active"),n('.ur-tab-lists li[aria-controls="ur-tab-field-options"]').hide(),n('.ur-tab-lists li[aria-controls="ur-multipart-page-settings"]').show(),n("#multi-part-options").trigger("click"),n("#ur-multipart-page-settings").find(".ur-multipart-page-option").hide(),n("#ur-multipart-page-settings").find('.ur-multipart-page-option[data-part-id="'+r+'"]').show(),u.render_individual_part_settings(r),u.render_part_rows(r))}),n("#ur-multipart-page-settings").on("keyup",".ur-multipart-page-option input.ur-part-title",function(){var t=n(this);n(".user-registration-multi-part-tabs .user-registration-tabs > li.active").find("a > span").text(t.val().trim())}),n(document).on("mouseenter",'.user-registration-multi-part-tabs li[class*="ui-sortable-handle"]',function(){!1===n(this).hasClass("active")&&n(document).find(".ur-selected-item").hasClass("ui-sortable-helper")&&(n(this).find("a").trigger("click"),n(".ur-grid-list-item").sortable({containment:".ur-builder-wrapper"}))}),n("#ur-multipart-page-settings").on("click",".ur-multipart-page-option .user-registration-part-delete",function(t){t.preventDefault();var r=n(this).closest(".ur-multipart-page-option"),i=n(".user-registration-multi-part-tabs .user-registration-tabs"),e=i.find("li.active");1===i.find("li").length?ur_alert(ur_multipart_admin.i18n_part_locked_msg):ur_confirmation(ur_multipart_admin.i18n_delete_part_confirm,{title:ur_multipart_admin.i18n_delete_part_title,confirm:function(){$next_part_index=0!==e.index()?e.index()-1:0,n(".ur-input-grids .ur-single-row:visible").remove(),e.remove(),r.remove(),i.find("li:nth("+$next_part_index+") > a").trigger("click"),u.rearrange_part_id()}})}),n(document).on("click",".ur-builder-wrapper .ur-selected-inputs .ur-selected-item",function(){n('.ur-tab-lists li[aria-controls="ur-multipart-page-settings"]').hide(),n('.ur-tab-lists li[aria-controls="ur-tab-field-options"]').show()}),n(document).on("user_registration_row_added user_registration_row_deleted",function(t,r){var e,a,s;"user_registration_row_added"===t.type?(a=n(".user-registration-multi-part-tabs > ul.user-registration-tabs > li.active").attr("data-part-id"),s=void 0!==(s=n('.ur-multipart-page-option input[name="user_registration_multipart_rows_'+a+'"]').val())?JSON.parse(s):[],e=parseInt(r.attr("data-row-id")),s.push(e)):(e=parseInt(r.attr("data-row-id")),s=a="",n(".ur-multipart-page-option").each(function(t,r){var i=n(r).find('input[name="user_registration_multipart_index"]').val(),r=n(r).find('input[name="user_registration_multipart_rows_'+i+'"]').val();if(-1!==(r=void 0!==r?JSON.parse(r):[]).indexOf(e))return a=i,s=r,!1}),s.splice(s.indexOf(e),1),0===s.length&&(n('.user-registration-multi-part-tabs .user-registration-tabs li[data-part-id="'+a+'"]').remove(),n('.ur-multipart-page-option[data-part-id="'+a+'"]').remove(),setTimeout(function(){u.rearrange_part_id(),n(".user-registration-multi-part-tabs .user-registration-tabs li").removeClass("active"),n(".user-registration-multi-part-tabs .user-registration-tabs li:first-child").addClass("active")},10))),n('.ur-multipart-page-option input[name="user_registration_multipart_rows_'+a+'"]').val(JSON.stringify(s))}),n(".user-registration-multi-part-tabs").on("click","button.add-new-part",function(){var e=n(this),a=e.attr("data-total-parts"),t=(e.attr("disabled","disabled"),n(".ur-builder-wrapper-content").block({message:null,overlayCSS:{background:"#fff",opacity:.7}}),{action:"user_registration_add_new_part",security:ur_multipart_admin.add_new_part_nonce,total_parts:a});n.post(ur_multipart_admin.ajax_url,t,function(t){var r,i;t.success&&t.data?(n("#ur-multipart-page-settings .ur-multipart-page-option").hide(),n("#multi-part-options").trigger("click"),n('.ur-tab-lists li[aria-controls="ur-tab-field-options"]').hide(),n('.ur-tab-lists li[aria-controls="ur-multipart-page-settings"]').show(),t.data.fragments&&n.each(t.data.fragments,function(t,r){n(t).append(r)}),t.data.new_part_id&&(r=n(".user-registration-multi-part-tabs ul.user-registration-tabs").find("li").eq(0).clone(),i=n(".ur-add-new-row").attr("data-total-rows"),i=parseInt(i),n(".ur-selected-inputs .ur-input-grids .ur-single-row").hide(),n(".user-registration-multi-part-tabs ul.user-registration-tabs > li").removeClass("active"),r.attr("data-part-id",t.data.new_part_id),r.removeAttr("data-part-rows"),r.removeClass().addClass("active").addClass("ui-sortable-handle"),r.find(".tips").attr("data-tip",ur_multipart_admin.i18n_tooltip_msg),r.find("span").text(ur_multipart_admin.i18n_part_title),n("ul.user-registration-tabs").find("li").last().after(r)),n(".ur-selected-inputs .ur-add-new-row").trigger("click"),n(document).trigger("update_perfect_scrollbar"),n(document).find("ul.user-registration-tabs li").last().find("a").trigger("click"),a++):window.alert(t.data.error),e.prop("disabled",!1),e.attr("data-total-parts",a),n(".ur-builder-wrapper-content").unblock()})}),n("#ur-field-all-settings > #multi-part-settings #user_registration_enable_multipart_field input").on("change",function(){u.render_part_settings()}),n(".user-registration-multi-part-tabs > ul.user-registration-tabs").sortable({items:"li",cursor:"move",axis:"x",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"ur-sortable-placeholder",start:function(t,r){n(this).attr("data-elPos",r.item.index()),r.item.css("background-color","#f6f6f6")},stop:function(t,r){r.item.removeAttr("style")},update:function(t,r){var i=n(this).attr("data-elPos");n(".ur-input-grids").each(function(){var t=n(this).children(".ur-single-row").eq(r.item.index());i>r.item.index()?n(this).children(".ur-single-row").eq(i).insertBefore(t):n(this).children(".ur-single-row").eq(i).insertAfter(t)}),n("#ur-multi-part-page-settings").each(function(){var t=n(this).children(".ur-multipart-page-option").eq(r.item.index());i>r.item.index()?n(this).children(".ur-multipart-page-option").eq(i).insertBefore(t):n(this).children(".ur-multipart-page-option").eq(i).insertAfter(t)}),u.rearrange_part_id()}})},render_individual_part_settings:function(t){var r=n("#user_registration_multipart_enable_preview_"+t).val(),i=n("#user_registration_multipart_preview_message_"+t+"_field"),e=n("#user_registration_multipart_preview_layout_"+t+"_field"),a=n("#user_registration_multipart_preview_custom_class_"+t+"_field");"true"===r?(i.show(),e.show(),a.show()):(i.hide(),e.hide(),a.hide()),u.render_part_preview_message(t,r,i)},render_part_preview_message:function(t,r,i){var e=n('.ur-multipart-page-option input[name="user_registration_multipart_rows_'+t+'"]').val(),t=n(".ur-input-grids > div.ur-single-row"),a=t.map(function(){return n(this).attr("data-row-id")}).get(),t=t.filter(function(){var t=n(this).attr("data-row-id");return a.includes(t)&&e.includes(t)}).first();t.length&&(t=t.attr("data-row-id"),"true"===r?0<n('.ur-input-grids > div.ur-single-row[data-row-id="'+t+'"]').find(".ur-multipart-preview").length?n('.ur-input-grids > div.ur-single-row[data-row-id="'+t+'"]').find(".ur-multipart-preview").html("<h3>Preview</h3>"+i.find("textarea").val()):n('.ur-input-grids > div.ur-single-row[data-row-id="'+t+'"]').prepend('<div class="ur-multipart-preview"><h3>Preview</h3>'+i.find("textarea").val()+"</div>"):n('.ur-input-grids > div.ur-single-row[data-row-id="'+t+'"]').find(".ur-multipart-preview").remove())},render_part_rows:function(t){var r=n(".ur-input-grids > div.ur-single-row"),t=n('.user-registration-multi-part-tabs ul.user-registration-tabs li[data-part-id="'+t+'"]').attr("data-part-id"),t=n('.ur-multipart-page-option input[name="user_registration_multipart_rows_'+t+'"]').val();r.hide(),t!==undefined&&(t=JSON.parse(t),n.each(t,function(t,r){n('.ur-input-grids > div.ur-single-row[data-row-id="'+r+'"]').show(),n(".ui-sortable-helper").appendTo(n('.ur-input-grids > div.ur-single-row[data-row-id="'+r+'"]').find(".ur-grid-list-item"))})),n(document).trigger("update_perfect_scrollbar")},render_part_settings:function(){var t=n("#ur-field-all-settings > #multi-part-settings"),r=t.find("#user_registration_enable_multipart_field input"),i=n(".ur-builder-wrapper "),e=i.find(".ur-builder-wrapper-footer").find(".user-registration-multi-part-tabs"),a=e.find(".user-registration-tabs > li.active").attr("data-part-id");r.is(":checked")?(t.find("#user_registration_multipart_indicator_field").show(),t.find("#user_registration_multipart_nav_align_field").show(),t.find("#user_registration_multipart_indicator_color_field").show(),e.show(),i.addClass("ur-multipart"),u.render_part_rows(a)):(t.find("#user_registration_multipart_indicator_field").hide(),t.find("#user_registration_multipart_nav_align_field").hide(),t.find("#user_registration_multipart_indicator_color_field").hide(),e.hide(),i.removeClass("ur-multipart"),i.find(".ur-input-grids > .ur-single-row").show(),n('.ur-tab-lists li[aria-controls="ur-tab-field-options"]').show(),n('.ur-tab-lists li[aria-controls="ur-multipart-page-settings"]').hide())},rearrange_part_id:function(){var t=n(".user-registration-multi-part-tabs > .user-registration-tabs > li"),r=n("#ur-multi-part-page-settings > .ur-multipart-page-option");t.each(function(t,r){n(r).attr("data-part-id",t+1)}),r.each(function(t,r){var r=n(r),i=r.attr("data-part-id"),t=t+1;$input_index=r.find('input[name="user_registration_multipart_index"]'),$input_rows=r.find('input[name="user_registration_multipart_rows_'+i+'"]'),r.attr("data-part-id",t),r.find('input[name="user_registration_multipart_part_title_'+i+'"]').attr({name:"user_registration_multipart_part_title_"+t,id:"user_registration_multipart_part_title_"+t,"data-id":"user_registration_multipart_part_title_"+t}),r.find('input[name="user_registration_multipart_next_title_'+i+'"]').attr({name:"user_registration_multipart_next_title_"+t,id:"user_registration_multipart_next_title_"+t,"data-id":"user_registration_multipart_next_title_"+t}),r.find('input[name="user_registration_multipart_previous_title_'+i+'"]').attr({name:"user_registration_multipart_previous_title_"+t,id:"user_registration_multipart_previous_title_"+t,"data-id":"user_registration_multipart_previous_title_"+t}),r.find('select[name="user_registration_multipart_enable_preview_'+i+'"]').attr({name:"user_registration_multipart_enable_preview_"+t,id:"user_registration_multipart_enable_preview_"+t,"data-id":"user_registration_multipart_enable_preview_"+t}),r.find('textarea[name="user_registration_multipart_preview_message_'+i+'"]').attr({name:"user_registration_multipart_preview_message_"+t,id:"user_registration_multipart_preview_message_"+t,"data-id":"user_registration_multipart_preview_message_"+t}),r.find('select[name="user_registration_multipart_preview_layout_'+i+'"]').attr({name:"user_registration_multipart_preview_layout_"+t,id:"user_registration_multipart_preview_layout_"+t,"data-id":"user_registration_multipart_preview_layout_"+t}),r.find('input[name="user_registration_multipart_preview_custom_class_'+i+'"]').attr({name:"user_registration_multipart_preview_custom_class_"+t,id:"user_registration_multipart_preview_custom_class_"+t,"data-id":"user_registration_multipart_preview_custom_class_"+t}),$input_index.val(t),$input_rows.attr("name","user_registration_multipart_rows_"+t)})}};n(document).ready(function(){u.init(),n(document).on("change",".user_registration_multipart_enable_preview",function(){var t=n(this).closest(".ur-multipart-page-option").data("part-id");u.render_individual_part_settings(t)}),n(document).on("keyup",".user_registration_multipart_preview_message",function(){var t=n(this).closest(".ur-multipart-page-option").data("part-id");u.render_part_preview_message(t,"true",n(this).parent())})})}(jQuery);