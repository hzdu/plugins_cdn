"use strict";function _typeof(t){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var s=0;s<e.length;s++){var c=e[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function _createClass(t,e,s){return e&&_defineProperties(t.prototype,e),s&&_defineProperties(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}!function(t){function e(){t("#tmpl-wfch-modal-add-rules-method").show(),t(".modal-close").show()}var s=function(){function s(){_classCallCheck(this,s),this.vue=null,this.rulesVue=null,this.initVue(),this.RulesVue(),this.Notification()}return _createClass(s,[{key:"initVue",value:function(){if(null!==this.vue)return this.vue;var e=this;return this.vue=new Vue({el:"#wfch_skip_cart_container",created:function(){wfch.hooks.doAction("wfch_admin_ui_created",this),this.sortable()},components:{Multiselect:window.VueMultiselect.default},methods:{sortable:function(){var e=this;setTimeout(function(){t(".wfch_rules_table_body").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.wc-shipping-zone-sort",scrollSensitivity:40,stop:function(t,s){e.StopSortable(t,s)}}),jQuery(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},800)},StopSortable:function(e,s){var c=wfch.tools.jsp(this.rules),i=this;t(".wfch_item_drag").each(function(e,s){var o=parseInt(t(this).attr("index"));c[o];i.rules[e]=c[o]}),setTimeout(function(){var e=[];t(".wfch_item_drag").each(function(s,c){e.push(t(this).attr("rule-id"))});var s=new wfch.ajax,c={menu_order:e};s.ajax("save_menu_order",c),s.success=function(t){}},1e3),s.item.removeClass("hoverDrag")},changeDetect:function(){this.changesHappend=!0},addRule:function(){e.rulesVue.addRule()},editRule:function(t,s){e.rulesVue.editRule(t,s)},deleteRule:function(t,e){var s=this;if(null!=t&&confirm(wfch_localization.delete_message)){var c=new wfch.ajax,i={wfch_id:e.id};c.ajax("delete_skip_rules",i),c.success=function(e){1==e.status&&s.rules.splice(t,1)}}},updateRuleStatus:function(t,e){e.target.checked?t.published="publish":t.published="draft";var s=new wfch.ajax,c={wfch_id:t.id,post_status:t.published};s.ajax("update_page_status",c),s.success=function(t){}},asyncFindExcludes:function(t){var e=this;""!==t?(clearTimeout(this.search_excludes_timeout),this.search_excludes_timeout=setTimeout(function(t){var s=new wfch.ajax,c={term:t};s.ajax("product_search",c),s.success=function(t){e.excludes=t,e.isExcludesLoading=!1},s.complete=function(){e.isExcludesLoading=!1}},1e3,t)):this.isExcludesLoading=!1},saveRules:function(){var t=this,e=new wfch.ajax,s={skip_cart:this.skip_cart,category:this.selectedCategory,excludes:this.selectedExcludes,add_cart_button_text:this.add_cart_button_text};wfch.show_spinner(),e.ajax("save_skip_cart_setting",s),e.success=function(e){t.changesHappend=!1}}},data:{search_term:"",search_products:[],editForm:{product:[],edit_id:0,match:"all",skip_cart:!1},rules:wfch.tools.jsp(wfch_data.rules),skip_cart:"true"==wfch_data.skip_cart||1==wfch_data.skip_cart,selectedCategory:wfch.tools.jsp(wfch_data.category),selectedExcludes:wfch.tools.jsp(wfch_data.excludes),category:wfch.tools.jsp(wfch_data.category_list),excludes:[],temp_data:{},changesHappend:!1,search_category_timeout:null,search_excludes_timeout:null,isCategoryLoading:!1,isExcludesLoading:!1,add_cart_button_text:wfch.tools.jsp(wfch_data.add_cart_button_text),wfch_products_search:null}}),this.vue}},{key:"RulesVue",value:function(){if(!0!==this.rulesVue){var s=this;return this.rulesVue=new Vue({el:"#tmpl-wfch-modal-add-edit-rules-method",components:{Multiselect:window.VueMultiselect.default},data:{index:0,wfch_id:0,isLoading:!1,products:[],is_single:"",match:"0",skip_cart:!1,add_to_cart_text:"",checkout:0,selectedProducts:[]},methods:{addRule:function(){t("#tmpl-wfch-modal-add-rules-method .multiselect").removeClass("wfch_error"),e()},editRule:function(s,c){t("#tmpl-wfch-modal-add-rules-method .multiselect").removeClass("wfch_error"),c=wfch.tools.jsp(c),this.index=s,this.wfch_id=c.id,this.selectedProducts=Object.values(c.products),this.match=c.match,this.skip_cart="true"==c.skip_cart||1==c.skip_cart,this.add_to_cart_text=c.add_to_cart_text,wfch.tools.ol(wfch_data.aero_checkout_pages)>0&&null!==c.checkout&&"object"==_typeof(c.checkout)?this.checkout=c.checkout.id:this.checkout=0,e()},onSubmit:function(){var e=this,s=new wfch.ajax,c=[],i=this.selectedProducts;if(wfch.tools.ol(this.selectedProducts)>0){for(var o in i)c.push(i[o].id);this.isLoading=!0;var a={wfch_id:this.wfch_id,products:c,match:this.match,skip_cart:this.skip_cart,checkout:this.checkout,add_to_cart_text:this.add_to_cart_text};s.ajax("create_skip_rules",a),s.success=function(t){1==t.status&&(t.data.skip_cart=wfch.tools.string_to_bool(t.data.skip_cart),wfch.tools.hp(t,"update")&&"yes"==t.update?Vue.set(wfch.instance.initVue().rules,e.index,t.data):wfch.instance.initVue().rules.unshift(t.data),e.isLoading=!1,wfch.instance.initVue().sortable())},s.complete=function(){e.closeModel()}}else t("#tmpl-wfch-modal-add-rules-method .multiselect").addClass("wfch_error")},asyncFind:function(e){var c=this;this.isLoading=!0,t("#tmpl-wfch-modal-add-rules-method .multiselect").removeClass("wfch_error"),""!==e?(clearTimeout(s.search_timeout),s.search_timeout=setTimeout(function(t){var e=new wfch.ajax,s={term:t};e.ajax("product_search",s),e.success=function(t){c.products=t,c.isLoading=!1},e.complete=function(){c.isLoading=!1}},1e3,e)):this.isLoading=!1},clearAll:function(){this.index=0,this.wfch_id=0,this.checkout=0,this.products=[],this.selectedProducts=[],this.isLoading=!1,this.add_to_cart_text="",this.match="0",this.skip_cart=!1},closeModel:function(){t("#tmpl-wfch-modal-add-rules-method").hide(),t(".modal-close").hide(),this.clearAll()}}}),this.rulesVue}}},{key:"Notification",value:function(){wfch.show_saved_model=t("#modal-saved-data-success"),wfch.show_saved_model.length>0&&wfch.show_saved_model.iziModal({title:"saving",icon:"icon-check",headerColor:"#6dbe45",background:"#6dbe45",borderBottom:!1,width:600,timeout:4e3,timeoutProgressbar:!0,transitionIn:"fadeInUp",transitionOut:"fadeOutDown",bottom:0,loop:!0,pauseOnHover:!0,overlay:!1,onOpening:function(t){wfch.hide_spinner()},onClosed:function(){wfch.show_saved_model.iziModal("setTitle",wfch_localization.data_saving)}}),wfch.hooks.addAction("wfch_before_ajax_running",function(){}),wfch.hooks.addAction("wfch_success_notification",function(t,e){""!=t.msg&&wfch.show_data_save_model(t.msg)}),window.addEventListener("load",function(){t(".wfch_loader").hide()})}}]),s}();wfch.instance=new s}(jQuery);