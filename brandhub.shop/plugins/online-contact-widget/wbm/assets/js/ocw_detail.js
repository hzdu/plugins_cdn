import{r as v,o as l,e as a,f as s,t as _,i as m,w as h,h as u,F as w,g as b,j as p,k,v as x,l as S,n as y}from"./vendor.js";import{_ as L}from"./fetch.js";const j={name:"ContactDetail",inject:["reload"],data(){return{isLoaded:!1,isLoading:null,replySubmiting:!1,upCnf:{},cnf:{},row:{},list:[],custom_fields:[],data_info:{},newReply:{content:"",pics:[]},fileObj:null,uploadStatus:"",files:[],faqItems:{},displayAllFaq:!1}},components:{},mounted(){this._getData()},methods:{_getData(){const t=this,e=t.$route.query.id;t.$api.getData({action:"wb_ocw_api",op:"wo_detail",id:e}).then(i=>{t.row=i.row,t.list=i.list,t.upCnf=i.up_cnf,t.cnf=i.cnf,t.custom_fields=i.custom_fields,i.row.data_info&&(t.data_info=JSON.parse(i.row.data_info)),t.isLoaded=!0,t.$nextTick(()=>{window.scrollTo({top:9999})})})},picList(t){return t?JSON.parse(t.toString()):[]},reply(){const t=this;if(t.newReply.content===""&&t.files.length===0)return t.$wbui.toast("请输入内容再提交"),!1;if(t.replySubmiting)return t.$wbui.toast("提交处理中，请稍等..."),!1;const e=Object.assign(t.newReply,{id:t.row.id,pics:t.files.join(","),action:"wb_member_ajax",do:"ow_reply"});!t.replySubmiting&&t.$api.saveData(e).then(i=>{t.newReply.content="",t.files=[],t.reload(),t.replySubmiting=!1}),t.replySubmiting=!0},selectFile(){const t=this;if(t.files.length>2)return t.$wbui.alert("至多上传3个附件，谢谢"),!1;let e,i={};if(t.fileObj=t.$refs.upfile.files[0],t.fileObj){if(e=(t.fileObj.size/1024).toFixed(2),i.fsize=e+"KB",i.fname=t.fileObj.name,e>=5120)return t.$wbui.open({content:"请选择小于5MB的文件",btn:["确认"]}),!1;t.fileUpload(i)}return!1},fileUpload(t){const e=this,i=e.$refs.upform,r=new FormData(i);e.uploadStatus="上传中...",axios.post(e.upCnf.upload_server,r,{headers:{"Content-Type":"multipart/form-data"}}).then(o=>{console.log("res",o);const c=o.data;let d=e.files;c.code?(e.uploadStatus=c.msg,e.$wbui.alert(c.msg)):(d.push(c.msg),e.files=d,e.uploadStatus="上传成功")}).catch(o=>{console.log(o),i.reset(),e.uploadStatus=o,e.$wbui.alert(ret.msg,{btn:["重试"]})})},removeFileItem(t){this.files.splice(t,1)},getFaqs(t,e){const i=this,r={action:"wb_ocw_api",op:"wo_detail"};t&&(r.slug=t),e&&(r.pid=e),i.$api.getData(r).then(o=>{i.faqItems=o.data})}}},C={class:"main-wo-detail"},D={key:0,class:"wo-detail-hd"},F={class:"primary"},O={class:"wo-title"},T={class:"header-desc"},N={class:"ctrl-area"},R=s("span",null,"返回列表",-1),q={class:"rec-content-box"},B={class:"rec-items"},I={class:"msg-hd"},M={class:"user-avatar"},V=["src"],z={class:"msg-detail"},U={class:"detail-hd"},$={class:"wk ml"},H=["innerHTML"],J=["href"],A=["src"],E={key:0,class:"reply-box status-done"},K=s("svg",{class:"wb-icon wbsico-confirm"},[s("use",{"xlink:href":"#wbsico-confirm"})],-1),G={key:1,class:"reply-box"},P={class:"rb-ft"},Q={key:1,class:"wb-btn btn-primary"};function W(t,e,i,r,o,c){const d=v("router-link");return l(),a("div",C,[o.isLoaded?(l(),a("div",D,[s("div",F,[s("div",O,[s("strong",null,_(o.row.title),1)]),s("div",T,"创建于 "+_(o.row.create_date),1)]),s("div",N,[m(d,{class:"ctrl-back",to:"/"},{default:h(()=>[R]),_:1})])])):u("",!0),s("div",q,[s("ul",B,[(l(!0),a(w,null,b(o.list,(n,X)=>(l(),a("li",{key:n.cid,class:y(["rec-detail",n.by_me?"by-me":"by-wb"])},[s("div",I,[s("div",M,[s("img",{alt:"",src:n.user_avatar,height:"64",width:"64"},null,8,V)])]),s("div",z,[s("div",U,[s("strong",null,_(n.display_name),1),s("span",$,_(n.create_date),1)]),s("div",{class:"msg-content",innerHTML:n.content},null,8,H),s("div",{class:y(["imgs","with-"+c.picList(n.pics).length+"-pics"])},[(l(!0),a(w,null,b(c.picList(n.pics),(f,g)=>(l(),a("a",{class:"pic-item",key:"img"+g,href:f,target:"_blank"},[s("img",{src:f,alt:""},null,8,A)],8,J))),128))],2)])],2))),128))]),o.row.status==2?(l(),a("div",E,[K,s("p",null,[p(" 该工单已完结，更多疑问或建议请"),m(d,{class:"link",to:"/contact"},{default:h(()=>[p("提交新工单")]),_:1}),p("，谢谢 ")])])):u("",!0),o.row.status==1?(l(),a("div",G,[k(s("textarea",{class:"textarea-reply","onUpdate:modelValue":e[0]||(e[0]=n=>o.newReply.content=n)},null,512),[[x,o.newReply.content]]),s("div",P,[o.replySubmiting?u("",!0):(l(),a("button",{key:0,class:"wb-btn btn-primary",name:"submit",type:"button",onClick:e[1]||(e[1]=S((...n)=>c.reply&&c.reply(...n),["stop","prevent"]))}," 提交 ")),o.replySubmiting?(l(),a("span",Q,"发送中...")):u("",!0)])])):u("",!0)])])}const tt=L(j,[["render",W]]);export{tt as default};
