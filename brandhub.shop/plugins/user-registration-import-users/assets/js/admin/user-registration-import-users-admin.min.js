!function(i){var a=!1,s=0,o={init:function(){i(".ur_import_users_action_button").on("click",function(){o.mapping_csv_file()}),i(document).on("click",".ur_import_mapped_column_button",function(){o.import_mapped_users()}),i(document).on("change",".csv_title",function(){""!==this.value&&1===i(this).closest(".ur-table-map-field").find(".ur-table-map-label-invalid").length&&(i(this).removeClass("is_required"),i(this).closest(".ur-table-map-field").find(".ur-table-map-label-invalid").remove())})},mapping_csv_file:function(){var e=i("#csvfile").prop("files")[0],t=i("#form_id").val(),r=new FormData;r.append("csvfile",e),r.append("form_id",t),r.append("action","user_registration_import_users_action"),r.append("security",uriu_upload_script_data.uriu_import_users_save),i.ajax({url:uriu_upload_script_data.ajax_url,dataType:"json",cache:!1,contentType:!1,processData:!1,data:r,type:"post",beforeSend:function(){i(".ur_import_users_action_button").append('<span class="ur-spinner is-active"></span>'),i(".ur-import_notice").remove()},complete:function(e){i(".ur_import_users_action_button").find(".ur-spinner").remove(),!0===e.responseJSON.success?(i("#importusers_div").hide(),o.display_column_mapping(e.responseJSON.data)):(i(".ur-import_notice").remove(),e='<div id="message" class="error inline ur-import_notice"><p><strong>'+e.responseJSON.data.message+"</strong></p></div>",i(".ur-export-users-page").prepend(e),i("#csvfile").val(""))}})},display_column_mapping:function(e){var t=(t=e.csv_title).split(","),r=e.form_fields,a="",a=(a=(a=(a=(a+='<form id="column_mapping_form" method="post" class="ur-import-users-map-page">')+'<div class="postbox">'+'<table id="column_mapping_html" class="table user-registration-table">')+("<caption>"+uriu_upload_script_data.uriu_map_csv_title+"</caption>")+"<thead>")+('<th width="50%">'+uriu_upload_script_data.uriu_form_label+"</th>"))+('<th width="50%">'+uriu_upload_script_data.uriu_map_to_field+"</th>")+"</thead>";i.each(r,function(e,r){a=(a=(a=a+'<tr><td class="ur-table-map-label">'+r+'<span class="ur-table-map-label-desc">'+e+"</span></td>")+'<td class="ur-table-map-field"><select name="'+e+'" class="csv_title">')+("user_role"===e?'<option value="default_role" selected = selected >'+uriu_upload_script_data.uriu_default+"</option>":"user_registered"===e?'<option value="current_date" selected = selected >'+uriu_upload_script_data.uriu_current_date+"</option>":'<option value="" >'+uriu_upload_script_data.uriu_do_not_import+"</option>"),i.each(t,function(e,t){form_label=(form_label=(form_label=(form_label=r.replace(/\"/g,"")).replace(/\ /g,"_")).toLowerCase()).split("["),t=t.replace(/\"/g,""),title_key=(title_key=(title_key=t.replace(/\ /g,"_")).toLowerCase()).split("["),a+='<option value="'+title_key[0]+'" ',title_key[0]===form_label[0]&&(a+="selected = selected"),a+=" >"+t+"</option>"}),a+="</select></td></tr>"}),a=(a=(a+='<tfoot><tr><td colspan="2" style="border-bottom: none"><div class="publishing-action">')+'<button type="button" name="ur_import_mapped_column_button" class="button button-primary ur_import_mapped_column_button"> '+uriu_upload_script_data.uriu_import_users_button+" </button></div></td></tr></tfoot></table></div>")+'<input type="hidden" name="form_id" value="'+e.form_id+'"></form>',i(".nav-tab-inside").prepend(a)},import_mapped_users:function(){var e={data:i("form").serializeArray(),action:"user_registration_import_mapped_users_action",security:uriu_upload_script_data.uriu_import_users_save};i.ajax({url:uriu_upload_script_data.ajax_url,data:e,type:"POST",beforeSend:function(){i(".ur_import_mapped_column_button").append('<span class="ur-spinner is-active"></span>'),i(".ur-import_notice").remove()},complete:function(e){i(".ur_import_mapped_column_button").find(".ur-spinner").remove(),i(".ur-import_notice").remove();var t="";!0===e.responseJSON.success?(i("#importusers_div").show(),i("#column_mapping_form").remove(),o.show_import_notice()):("undefined"!=typeof e.responseJSON.data.required_list&&i.each(e.responseJSON.data.required_list,function(e,t){0===i("select[name="+t).closest(".ur-table-map-field").find(".ur-table-map-label-invalid").length&&(i("select[name="+t).addClass("is_required"),i("select[name="+t).after("<span class='ur-table-map-label-invalid'>"+uriu_upload_script_data.uriu_this_field_is_required+".</span>"))}),t='<div id="message" class="error inline ur-import_notice"><p><strong>'+e.responseJSON.data.message+"</strong></p></div>"),i(".ur-export-users-page").prepend(t),i("html,body").animate({scrollTop:i("div.user-registration").offset().top-100},1e3)}})},show_import_notice:function(){var e={data:"",action:"user_registration_import_users_notice_action",security:uriu_upload_script_data.uriu_import_users_save};i.ajax({url:uriu_upload_script_data.ajax_url,data:e,type:"POST",complete:function(e){var t,r;!0===e.responseJSON.success&&""!==e.responseJSON.data.notice&&(!0===e.responseJSON.data.notice.progress_bar_enable&&!0===a?("undefined"!=typeof e.responseJSON.data.notice.percentage&&s<=e.responseJSON.data.notice.percentage&&(s=e.responseJSON.data.notice.percentage,i(".user-registration-progress-bar").attr("style","width:"+e.responseJSON.data.notice.percentage+"%"),i(".user-registration-progress-bar").attr("aria-valuenow",e.responseJSON.data.notice.percentage),i(".user-registration-progress-bar").html(e.responseJSON.data.notice.percentage+"%"),i(".ur-import_notice").css("display","block")),o.show_import_notice()):(i(".ur-import_notice").remove(),r=(r="")+'<div id="user_registration_import_users_notice" class="notice '+(t=!0===e.responseJSON.data.notice.status?"notice-success":"notice-info")+' is-dismissible ur-import_notice"><p>'+e.responseJSON.data.notice.message+"</p>",e.responseJSON.data.notice.status||(r=(r+='<div class="user-registration-progress">')+'<div class="user-registration-progress-bar" style="width:'+e.responseJSON.data.notice.percentage+'%" aria-valuenow="'+e.responseJSON.data.notice.percentage+'" role="progressbar" aria-valuemin="0" aria-valuemax="100">'+e.responseJSON.data.notice.percentage+"%</div></div>",a=!0),"notice-success"==t&&(a=!1),r+="<p>","undefined"!=typeof e.responseJSON.data.notice.invaild_users_data&&(r=(r+='<form id="invalid_users_form" method="post">')+'<input type="submit" name="download_csv_invalid_user" class="button button-primary" value="'+uriu_upload_script_data.uriu_invalid_users_download_button+'"></form>',a=!1),r+='<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button></p></div>',i("h1").first().after(r),a&&o.show_import_notice(),i(".ur-import_notice").css("display","block")))}})}};i(document).ready(function(){o.init(),i("#user_registration_import_users_notice").length&&o.show_import_notice()})}(jQuery);