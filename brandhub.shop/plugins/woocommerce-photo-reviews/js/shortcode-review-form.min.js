jQuery(window).on("elementor/frontend/init",(()=>{"use strict";elementorFrontend.hooks.addAction("frontend/element_ready/woocommerce-photo-reviews-form.default",(function(e){if(!window.elementor)return;let r=e.find(".woocommerce-photo-reviews-form-container");r.find(".wcpr-rating").hide().before('<p class="stars">                    <span>                        <a class="star-1" href="#">1</a>                        <a class="star-2" href="#">2</a>                        <a class="star-3" href="#">3</a>                        <a class="star-4" href="#">4</a>                        <a class="star-5" href="#">5</a>                    </span>                </p>'),r.find(".viwcpr-review-order-container .woocommerce-photo-reviews-form-product .woocommerce-photo-reviews-form-meta-title").map((function(){$(this).closest(".woocommerce-photo-reviews-form-main-inner").prepend($(this).clone()),$(this).remove()}))}))})),jQuery(document).ready((function(e){"use strict";e("body").on("init",".wcpr-rating",(function(){e(".wcpr-rating").hide().before('<p class="stars">                        <span>                            <a class="star-1" href="#">1</a>                            <a class="star-2" href="#">2</a>                            <a class="star-3" href="#">3</a>                            <a class="star-4" href="#">4</a>                            <a class="star-5" href="#">5</a>                        </span>                    </p>')})).on("click","#respond p.stars a",(function(){var r=e(this),o=e(this).closest("#respond").find("#wcpr-rating"),t=e(this).closest(".stars");return o.val(r.text()),r.siblings("a").removeClass("active"),r.addClass("active"),t.addClass("selected"),!1})).on("click","#respond #submit",(function(){var r=e(this).closest("#respond").find("#wcpr-rating"),o=r.val();if(r.length>0&&!o&&"yes"===woocommerce_photo_reviews_form_params.review_rating_required)return window.alert(woocommerce_photo_reviews_form_params.i18n_required_rating_text),!1})),e("#wcpr-rating").trigger("init"),setTimeout((function(){e(".viwcpr-review-order-container .woocommerce-photo-reviews-form-product .woocommerce-photo-reviews-form-meta-title").map((function(){e(this).closest(".woocommerce-photo-reviews-form-main-inner").prepend(e(this).clone()),e(this).closest(".woocommerce-photo-reviews-form-main-inner").find(".wcpr-comment-form-submit").attr("type","button"),e(this).remove()}))}),100);let r=woocommerce_photo_reviews_form_params.max_files;e(".wcpr-comment-form").on("change",".wcpr_image_upload",(function(o){if(e(this).parent().find(".wcpr-selected-image-container").html(""),this.files.length>r)return jQuery(this).closest(".woocommerce-photo-reviews-form-container").find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.warning_max_files),e(this).val(""),!1;this.files.length>0&&(jQuery(this).closest(".woocommerce-photo-reviews-form-container").find(".wcpr-comment-form-error-wraps").addClass("wcpr-hidden"),function(r){let o=1024*parseFloat(woocommerce_photo_reviews_params.max_file_size);for(let i=0;i<r.files.length;i++){var t=new FileReader;t.onload=function(t){let a="";r.files[i].size>o?a=woocommerce_photo_reviews_params.warning_max_file_size.replace("%file_name%",r.files[i].name):-1===woocommerce_photo_reviews_params.upload_allow.indexOf(r.files[i].type)&&(a=woocommerce_photo_reviews_params.warning_upload_allow.replace("%file_name%",r.files[i].name)),e(r).parent().find(".wcpr-selected-image-container").append(m(t.target.result,r.files[i].name,a))},t.readAsDataURL(r.files[i])}}(this))})).find(".star-5").trigger("click");let o=1==woocommerce_photo_reviews_form_params.image_caption_enable,t=woocommerce_photo_reviews_form_params.i18n_image_caption;function m(e,r,m=""){let i,a=`<img title="${r}" src="${e}" class="wcpr-selected-image-preview">`;return e.indexOf("data:video/")>-1&&(a=`<video class="wcpr-selected-image-preview" height="100%" width="100%" src="${e}" controls >${r}</video>`),i=m?`<div class="wcpr-selected-image">${a}<div class="wcpr-selected-image-info"><div class="wcpr-selected-image-name wcpr-comment-form-error" >${m}</div></div></div>`:o?`<div class="wcpr-selected-image">${a}<div class="wcpr-selected-image-info"><div class="wcpr-selected-image-name" title="${r}">${r}</div><input class="wcpr-selected-image-caption" type="text" name="wcpr_image_caption[]" placeholder="${t}"></div></div>`:`<div class="wcpr-selected-image">${a}<div class="wcpr-selected-image-info"><div class="wcpr-selected-image-name" title="${r}">${r}</div></div></div>`,i}e(document).on("click",".viwcpr-review-order-submit:not(.viwcpr-review-order-submit-loading)",(function(){let r=[],o=e(this),t=e(this).closest(".viwcpr-review-order-wrap").find(".woocommerce-photo-reviews-form-container");return!!t.length&&(o.addClass("viwcpr-review-order-submit-loading"),t.each((function(){let t=e(this),m=t.find('textarea[id="comment"]')||t.find('textarea[name="comment"]'),i=t.find('input[name="author"]'),a=t.find('input[name="email"]');t.find(".wcpr-comment-form-error-wraps,.wcpr-comment-form-notify-wraps").addClass("wcpr-hidden");let n=t.find("#rating"),c=n.val();if(n.length>0&&!c&&"yes"===woocommerce_photo_reviews_params.review_rating_required)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_params.i18n_required_rating_text),window.scrollTo({top:t.offset().top-50}),!1;if(m.length>0){let e=m.val();if(!e&&1!=woocommerce_photo_reviews_params.allow_empty_comment)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_params.i18n_required_comment_text),m.focus(),!1;let r=parseInt(woocommerce_photo_reviews_params.minimum_comment_length);if(r&&r>e.length)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_params.i18n_minimum_comment_text),m.focus(),!1}if("on"===woocommerce_photo_reviews_form_params.enable_photo){let e=t.find(".wcpr_image_upload");if(e.length>0){let r=e.get(0).files,o=parseInt(r.length);if("on"===woocommerce_photo_reviews_form_params.required_image&&0===o)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.warning_required_image),window.scrollTo({top:t.offset().top-50}),!1;if(o>woocommerce_photo_reviews_form_params.max_files)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.warning_max_files),window.scrollTo({top:t.offset().top-50}),!1;let m=[],i=1024*parseFloat(woocommerce_photo_reviews_params.max_file_size);if(jQuery.each(r,(function(e,r){if(r.size>i)return m.push("<p>"+woocommerce_photo_reviews_params.warning_max_file_size.replace("%file_name%",r.name)+"</p>"),!0;-1===woocommerce_photo_reviews_params.upload_allow.indexOf(r.type)&&m.push("<p>"+woocommerce_photo_reviews_params.warning_upload_allow.replace("%file_name%",r.name)+"</p>")})),m.length)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(m.join("")),window.scrollTo({top:t.offset().top-50}),!1}else if("on"===woocommerce_photo_reviews_form_params.required_image)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.warning_required_image),window.scrollTo({top:t.offset().top-50}),!1}if(i.length>0&&i.attr("required")&&!i.val())return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.i18n_required_name_text),i.focus(),!1;if(a.length>0&&a.attr("required")&&!a.val())return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.i18n_required_email_text),a.focus(),!1;if(!1===t.find('input[name="wcpr_gdpr_checkbox"]').prop("checked"))return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.warning_gdpr),window.scrollTo({top:t.offset().top-50}),!1;let s=new FormData(t.find("form")[0]);m.val()&&!t.find('textarea[name="comment"]').val()&&s.set("comment",m.val()),r.push({type:"post",url:woocommerce_photo_reviews_form_params.wc_ajax_url.toString().replace("%%endpoint%%","viwcpr_review_order")+"&nonce="+woocommerce_photo_reviews_form_params.nonce,processData:!1,cache:!1,contentType:!1,data:s,success:function(r){r.error?t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(r.error):r.html&&(t.find(".woocommerce-photo-reviews-form-main-content").html(r.html),e(".viwcpr-review-order-wrap form").length||o.addClass("wcpr-hidden"))},error:function(e){cosole.log(e),t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html("-1"===e.responseText?e.statusText:e.responseText)},complete:function(){t.find(".wcpr-comment-form-notify-wraps").addClass("wcpr-hidden"),r.shift(),r.length?e.ajax(r[0]):o.removeClass("viwcpr-review-order-submit-loading")}})})),!r.length||r.length<t.length?(o.removeClass("viwcpr-review-order-submit-loading"),!1):(e(".wcpr-comment-form-notify-wraps").removeClass("wcpr-hidden"),void e.ajax(r[0])))})),e(".woocommerce-photo-reviews-form-container").find('input[type="submit"]').on("click",(function(r){let o=e(this);if(o.hasClass("viwcpr_form_checked"))return!0;let t=o.closest(".woocommerce-photo-reviews-form-container"),m=t.find('textarea[id="comment"]')||t.find('textarea[name="comment"]'),i=t.find('input[name="author"]'),a=t.find('input[name="email"]');t.find(".wcpr-comment-form-error-wraps,.wcpr-comment-form-notify-wraps").addClass("wcpr-hidden");let n=t.find("#rating"),c=n.val();if(n.length>0&&!c&&"yes"===woocommerce_photo_reviews_params.review_rating_required)return jQuery(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_params.i18n_required_rating_text),r.preventDefault(),!1;if(m.length>0){let e=m.val();if(!e&&1!=woocommerce_photo_reviews_params.allow_empty_comment)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_params.i18n_required_comment_text),r.preventDefault(),m.focus(),!1;let o=parseInt(woocommerce_photo_reviews_params.minimum_comment_length);if(o&&o>e.length)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_params.i18n_minimum_comment_text),r.preventDefault(),m.focus(),!1}if("on"===woocommerce_photo_reviews_form_params.enable_photo){let e=t.find(".wcpr_image_upload");if(e.length>0){let o=e.get(0).files,m=parseInt(o.length);if("on"===woocommerce_photo_reviews_form_params.required_image&&0===m)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.warning_required_image),!1;if(m>woocommerce_photo_reviews_form_params.max_files)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.warning_max_files),r.preventDefault(),!1;let i=[],a=1024*parseFloat(woocommerce_photo_reviews_params.max_file_size);if(jQuery.each(o,(function(e,r){if(r.size>a)return i.push("<p>"+woocommerce_photo_reviews_params.warning_max_file_size.replace("%file_name%",r.name)+"</p>"),!0;-1===woocommerce_photo_reviews_params.upload_allow.indexOf(r.type)&&i.push("<p>"+woocommerce_photo_reviews_params.warning_upload_allow.replace("%file_name%",r.name)+"</p>")})),i.length)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(i.join("")),r.preventDefault(),!1}else if("on"===woocommerce_photo_reviews_form_params.required_image)return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.warning_required_image),!1}if(i.length>0&&i.attr("required")&&!i.val())return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.i18n_required_name_text),r.preventDefault(),i.focus(),!1;if(a.length>0&&a.attr("required")&&!a.val())return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.i18n_required_email_text),r.preventDefault(),a.focus(),!1;if(!1===t.find('input[name="wcpr_gdpr_checkbox"]').prop("checked"))return t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(woocommerce_photo_reviews_form_params.warning_gdpr),r.preventDefault(),!1;if(jQuery(".wcpr-comment-form-notify-wraps").removeClass("wcpr-hidden"),woocommerce_photo_reviews_form_params.restrict_number_of_reviews){o.attr("type","button"),async function(){let r="",o=new FormData(jQuery(".woocommerce-photo-reviews-form-container form")[0]);return m.val()&&!t.find('textarea[name="comment"]').val()&&o.set("comment",m.val()),await new Promise((function(m){e.ajax({type:"post",url:woocommerce_photo_reviews_form_params.wc_ajax_url.toString().replace("%%endpoint%%","viwcpr_restrict_number_of_reviews"),processData:!1,cache:!1,contentType:!1,data:o,success:function(e){e.error?r=e.error:(e.remove_upload_file&&t.find(".woocommerce-photo-reviews-form-container form").find(".wcpr_image_upload").val(""),e.img_id&&t.find(".woocommerce-photo-reviews-form-container form").append(`<input type="hidden" name="wcpr_image_upload_id" value="${e.img_id}">`)),console.log(e),m(r)},error:function(e){r="-1"===e.responseText?e.statusText:e.responseText,m(r)}})})),r}().then((function(e){if(o.attr("type","submit"),e)return t.find(".wcpr-comment-form-notify-wraps").addClass("wcpr-hidden"),t.find(".wcpr-comment-form-error-wraps").removeClass("wcpr-hidden").html(e),r.preventDefault(),!1;o.addClass("viwcpr_form_checked").trigger("click")}))}})),e(document).on("click",".woocommerce-photo-reviews-form-main,.woocommerce-photo-reviews-form-main-close",(function(){e(this).closest(".woocommerce-photo-reviews-form-container").addClass("woocommerce-photo-reviews-form-popup-hide"),wcpr_enable_scroll()})),e(document).on("click",".woocommerce-photo-reviews-form-button-add-review",(function(){e(this).closest(".woocommerce-photo-reviews-form-container").removeClass("woocommerce-photo-reviews-form-popup-hide"),wcpr_disable_scroll()})),e(document).on("click",".woocommerce-photo-reviews-form-main-inner",(function(e){e.stopPropagation()}))}));