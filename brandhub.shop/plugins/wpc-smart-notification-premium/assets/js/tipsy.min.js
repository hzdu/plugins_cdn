!function(t){t.fn.tipsy=function(i){if("string"==typeof i&&["show","hide"].indexOf(i)>-1){switch(i){case"show":t(this).trigger("tipsy.show");break;case"hide":t(this).trigger("tipsy.hide")}return this}var e=t.extend({arrowWidth:10,attr:"data-tipsy",cls:null,duration:150,offset:7,position:"top-center",trigger:"hover",onShow:null,onHide:null},i);return this.each(function(i,o){var r=t(o),n=t('<div class="tipsy"></div>'),s=["top-left","top-center","top-right","bottom-left","bottom-center","bottom-right","left","right"],f={init:function(){var t={};switch(e.trigger){case"hover":t={mouseenter:f._show,mouseleave:f._hide};break;case"focus":t={focus:f._show,blur:f._hide};break;case"click":t={click:function(t){f._clSe?(f._clSe=!1,f._hide(t)):(f._clSe=!0,f._show(t))}};break;case"manual":f._unbindOptions(),t={"tipsy.show":function(t){f._clSe=!0,f._show(t)},"tipsy.hide":function(t){f._clSe=!1,f._hide(t)}}}r.on(t),n.hide()},_show:function(i){if(t(".tipsy").remove(),f._clear(),f.hasAttr(e.attr+"-disabled"))return!1;f._createBox(),"manual"!=e.trigger&&f._bindOptions(),n.stop(!0,!0).fadeIn(e.duration,function(){null!=e.onShow&&"function"==typeof e.onShow&&e.onShow(n,r)})},_hide:function(i){f._fixTitle(!0),n.stop(!0,!0).fadeOut(e.duration,function(){null!=e.onHide&&"function"==typeof e.onHide&&e.onHide(n,r),f._clear(),t(this).remove()})},_bindOptions:function(){t(window).bind("contextmenu",function(){f._hide()}).bind("blur",function(){f._hide()}).bind("resize",function(){f._hide()}).bind("scroll",function(){f._hide()})},_unbindOptions:function(){t(window).unbind("contextmenu",function(){f._hide()}).unbind("blur",function(){f._hide()}).unbind("resize",function(){f._hide()}).unbind("scroll",function(){f._hide()})},_clear:function(){n.attr("class","tipsy").empty(),f._lsWpI=[],f._lsWtI=[]},hasAttr:function(t){return void 0!==(t=r.attr(t))&&!1!==t},_fixTitle:function(t){t?f.hasAttr("data-title")&&!f.hasAttr("title")&&1==f._lsWtI[0]&&r.attr("title",f._lsWtI[1]||"").removeAttr("data-title"):!f.hasAttr("title")&&f.hasAttr("data-title")||(f._lsWtI=[!0,r.attr("title")],r.attr("data-title",r.attr("title")||"").removeAttr("title"))},_getTitle:function(){f._fixTitle();var t=r.attr("data-title");return t=""+t},_position:function(i){var o={top:0,left:0},a=i||(f.hasAttr(e.attr+"-position")?r.attr(e.attr+"-position"):e.position),h=a.split("-"),l=f.hasAttr(e.attr+"-offset")?r.attr(e.attr+"-offset"):e.offset,d={offsetTop:r.offset().top,offsetLeft:r.offset().left,width:r.outerWidth(),height:r.outerHeight()},c={width:n.outerWidth(),height:n.outerHeight()},u={width:t(window).outerWidth(),height:t(window).outerHeight(),scrollTop:t(window).scrollTop(),scrollLeft:t(window).scrollLeft()};if(-1==t.inArray(a,s)||-1!==t.inArray(a,f._lsWpI))return f._hide(),o;switch(f._lsWpI.push(a),h[0]){case"bottom":if(o.top=d.offsetTop+d.height+l,o.top>=u.height+u.scrollTop)return f._position("top-"+h[1]);n.addClass("arrow-top");break;case"top":if(o.top=d.offsetTop-c.height-l,o.top-u.scrollTop<=0)return f._position("bottom-"+h[1]);n.addClass("arrow-bottom");break;case"left":return o.top=d.offsetTop+d.height/2-c.height/2,o.left=d.offsetLeft-c.width-l,o.left<=0?f._position("right"):(n.addClass("arrow-side-right"),o);case"right":return o.top=d.offsetTop+d.height/2-c.height/2,o.left=d.offsetLeft+d.width+l,o.left+c.width>u.width?f._position("left"):(n.addClass("arrow-side-left"),o)}switch(h[1]){case"left":if(o.left=d.offsetLeft+d.width/2-c.width+e.arrowWidth,o.left<=0)return f._position(h[0]+"-right");n.addClass("arrow-right");break;case"center":if(o.left=d.offsetLeft+d.width/2-c.width/2,o.left+c.width>u.width)return f._position(h[0]+"-left");if(o.left<=0)return f._position(h[0]+"-right");n.addClass("arrow-center");break;case"right":if(o.left=d.offsetLeft+d.width/2-e.arrowWidth,o.left+c.width>u.width)return f._position(h[0]+"-left");n.addClass("arrow-left")}return o},_createBox:function(){n.html(f._getTitle()).appendTo("body"),n.css(f._position()),(null!=e.cls&&"string"==typeof e.cls||f.hasAttr(e.attr+"-cls"))&&n.addClass(f.hasAttr(e.attr+"-cls")?r.attr(e.attr+"-cls"):e.cls)},_lsWtI:[],_lsWpI:[]};return f.init(),this})}}(jQuery);