jQuery(function(l){"use strict";var t=l(document).find("[data-ywdpd-deps]"),r=[],c=[],a=!1,d=l(document).find("#_rule_for,#_rule_apply_adjustment_discount_for,#_user_rules"),i=l(document).find("#_discount_mode"),n=yith_ywdpd_admin.ajax_url,_=function(e){var t=e.val(),e=e.attr("id");if("_rule_for"===e)o(t);else if("_rule_apply_adjustment_discount_for"===e){var d=t;let e={_active_apply_adjustment_to_exclude:!0,"_exclude_apply_adjustment_rule_for-specific_products":!0,"_exclude_apply_adjustment_rule_for-specific_tag":!0,"_exclude_apply_adjustment_rule_for-specific_categories":!0,"_exclude_apply_adjustment_rule_for-brand_list_excluded":!0,"_exclude_apply_adjustment_rule_for-vendor_list_excluded":!0};"specific_categories"===d?e["_exclude_apply_adjustment_rule_for-specific_categories"]=!1:"specific_tag"===d?e["_exclude_apply_adjustment_rule_for-specific_tag"]=!1:"vendor_list"===d?e["_exclude_apply_adjustment_rule_for-vendor_list_excluded"]=!1:"specific_brands"===d&&(e["_exclude_apply_adjustment_rule_for-brand_list_excluded"]=!1);l.each(e,function(e,t){e=l("#"+e).parent();t?e.show():e.hide()})}else if("_user_rules"===e){d=t;let e={_enable_user_rule_exclude:!0,"_user_rule_exclude-specific_customers":!0,"_user_rule_exclude-specific_roles":!0,"_user_rule_exclude-specific_membership":!0};"role_list"===d?e["_user_rule_exclude-specific_customers"]=!1:"specific_membership"===d&&(e["_user_rule_exclude-specific_membership"]=!1);l.each(e,function(e,t){e=l("#"+e).parent();t?e.show():e.hide()})}},o=function(e){let t={_active_exclude:!0,"_exclude_rule_for-specific_products":!0,"_exclude_rule_for-specific_tag":!0,"_exclude_rule_for-specific_categories":!0,"_exclude_rule_for-vendor_list_excluded":!0,"_exclude_rule_for-brand_list_excluded":!0};"specific_categories"===e?t["_exclude_rule_for-specific_categories"]=!1:"specific_tag"===e?t["_exclude_rule_for-specific_tag"]=!1:"vendor_list"===e?t["_exclude_rule_for-vendor_list_excluded"]=!1:"specific_brands"===e&&(t["_exclude_rule_for-brand_list_excluded"]=!1),l.each(t,function(e,t){e=l("#"+e).parent();t?e.show():e.hide()})},s=function(e){var t=l(document).find("#_rule_for-container label:first-child"),d=l(document).find("#_quantity_based-container label:first-child"),i=l(document).find("#_user_rules-container label:first-child"),n=l(document).find("#_schedule_discount_mode-container").closest("label"),_=l(document).find("#_table_note_apply_to-container label:first-child"),o=l(document).find("#_table_note_apply_to-container span.description"),r=l(document).find("#_enable_user_rule_exclude-container label:first-child"),c=l(document).find("#_enable_user_rule_exclude-container span.description"),a=l(document).find("#_so-repeat-container  span.description");"exclude_items"===e&&(e="bulk"),"undefined"!=typeof yith_ywdpd_admin.labels.rule_type[e]&&("undefined"!=typeof(e=yith_ywdpd_admin.labels.rule_type[e]).rule_for&&t.html(e.rule_for.label),"undefined"!=typeof e.quantity_based&&d.html(e.quantity_based.label),"undefined"!=typeof e.user_rules&&i.html(e.user_rules.label),"undefined"!=typeof e.schedule_discount_mode&&n.html(e.schedule_discount_mode.label),"undefined"!=typeof e.table_note_apply_to&&(_.html(e.table_note_apply_to.label),o.html(e.table_note_apply_to.desc)),"undefined"!=typeof e.enable_user_rule_exclude&&(r.html(e.enable_user_rule_exclude.label),c.html(e.enable_user_rule_exclude.desc)),"undefined"!=typeof e.repeat&&a.html(e.repeat.desc))},u=function(e){"no_schedule"===e?l(document).find("#_schedule_discount_mode-container .yith-plugin-fw-field-schedule").hide():l(document).find("#_schedule_discount_mode-container .yith-plugin-fw-field-schedule").show()},p=function(e,t){"percentage"===t?e.html(yith_ywdpd_admin.percent_symbol):e.html(yith_ywdpd_admin.currency_symbol)},f=function(e,t){t=void 0!==t?t:0;var e=e.find(".ywdpd_condition_for").filter(function(){const e=l(this);return"cart_subtotal"===e.val()}),d=l("#_show_notice_cart"),i=d.parents(".the-metabox");0<e.length-t?i.show():(d.is(":checked")&&d.click(),i.hide())},h=function(e,t){var t=t?".yith-add-box-row":".yith-toggle-content-row",d=e.find(t).not(".ywdpd_general_rule"),e=e.find(t).find(".ywdpd_condition_for").val(),i=d.not("."+e),d=d.filter("."+e),n="";i.addClass("hide_row"),"customers"===e?(n=d.find(".user_discount_to").parents(t),y(n,d,t),n.removeClass("hide_row")):"cart_items"===e?(n=d.find(".ywdpd_cart_item_qty_type").parents(t),m(n,d,t),n.removeClass("hide_row")):"product"===e?(n=d.find(".ywdpd_product_type").parents(t),w(n,d,t),n.removeClass("hide_row")):d.removeClass("hide_row")},y=function(e,t,d){var i=t.find('.user_discount_to input[type="radio"]:checked').val(),n=t.filter("."+i);if(t.not("."+i).addClass("hide_row"),"all"===i){t=n.find(".ywdpd_enable_exclude_users").parents(d),i=n;if(i.find('.ywdpd_enable_exclude_users input[type="checkbox"]').is(":checked"))i.filter(".customers_list_excluded").removeClass("hide_row");else i.filter(".customers_list_excluded").addClass("hide_row");t.removeClass("hide_row")}else n.removeClass("hide_row")},m=function(e,t){var d=t.find('.ywdpd_cart_item_qty_type input[type="radio"]:checked').val(),i=t.filter("."+d),d=t.not("."+d);i.removeClass("hide_row"),d.addClass("hide_row")},w=function(e,t,d){var i,n,_,o,r,c=t.find('.ywdpd_product_type input[type="radio"]:checked').val(),a=t.filter("."+c);t.not("."+c).addClass("hide_row"),"require_product"===c?(i=a.find(".ywdpd_enable_require_product").parents(d),n=a.find(".ywdpd_enable_require_product_categories").parents(d),_=a.find(".ywdpd_enable_require_product_tag").parents(d),o=a.find(".ywdpd_enable_require_product_vendors").parents(d),r=a.find(".ywdpd_enable_require_product_brands").parents(d),b(a,".ywdpd_enable_require_product",".enable_require_product_list"),b(a,".ywdpd_enable_require_product_categories",".enable_require_product_category_list"),b(a,".ywdpd_enable_require_product_tag",".enable_require_product_tag_list"),b(a,".ywdpd_enable_require_product_vendors",".enable_require_product_vendors_list"),b(a,".ywdpd_enable_require_product_brands",".enable_require_product_brands_list"),i.removeClass("hide_row"),n.removeClass("hide_row"),_.removeClass("hide_row"),o.removeClass("hide_row"),r.removeClass("hide_row")):"exclude_product"===c?(i=a.find(".ywdpd_enable_exclude_require_product").parents(d),n=a.find(".ywdpd_enable_exclude_on_sale_product").parents(d),_=a.find(".ywdpd_enable_exclude_product_categories").parents(d),o=a.find(".ywdpd_enable_exclude_product_tag").parents(d),r=a.find(".ywdpd_enable_exclude_product_vendors").parents(d),t=a.find(".ywdpd_enable_exclude_product_brands").parents(d),b(a,".ywdpd_enable_exclude_require_product",".enable_exclude_product_list"),b(a,".ywdpd_enable_exclude_product_categories",".enable_exclude_product_category_list"),b(a,".ywdpd_enable_exclude_product_tag",".enable_exclude_product_tag_list"),b(a,".ywdpd_enable_exclude_product_vendors",".enable_exclude_product_vendors_list"),b(a,".ywdpd_enable_exclude_product_brands",".enable_exclude_product_brands_list"),i.removeClass("hide_row"),n.removeClass("hide_row"),_.removeClass("hide_row"),o.removeClass("hide_row"),r.removeClass("hide_row"),t.removeClass("hide_row")):"disable_product"===c&&(i=a.find(".ywdpd_enable_disable_product").parents(d),n=a.find(".ywdpd_enable_disable_product_categories").parents(d),_=a.find(".ywdpd_enable_disable_product_tag").parents(d),o=a.find(".ywdpd_enable_disable_product_brands").parents(d),b(a,".ywdpd_enable_disable_product",".enable_disable_product_list"),b(a,".ywdpd_enable_disable_product_categories",".enable_disable_product_category_list"),b(a,".ywdpd_enable_disable_product_tag",".enable_disable_product_tag_list"),b(a,".ywdpd_enable_disable_product_brands",".enable_disable_product_brands_list"),i.removeClass("hide_row"),n.removeClass("hide_row"),_.removeClass("hide_row"),o.removeClass("hide_row"))},b=function(e,t,d){e.find(t+' input[type="checkbox"]').is(":checked")?e.filter(d).removeClass("hide_row"):e.filter(d).addClass("hide_row")};l(document).on("ywdpd-init-fields",function(){e=l("#_cart_discount_rules"),f(e),l(document).on("change",".yith-plugin-ui--ywdpd_discount-post_type tr td.status .ywdpd-toggle-enabled input",function(){var e="yes"===l(this).val()?"yes":"no",t=l(this).closest(".ywdpd-toggle-enabled").data("discount-id");l.ajax({type:"POST",data:{action:yith_ywdpd_admin.actions.enable_or_disable_rule,security:yith_ywdpd_admin.nonces.enable_or_disable_rule,id:t,enabled:e},url:n,success:function(e){"undefined"!=typeof e.error&&alert(e.error)}})}),l(document).on("yith-add-box-button-toggle",function(){var e=l(document).find("#_cart_discount_rules_add_box");h(e,!0)}),l(document).on("change",".ywdpd_condition_for",function(){var e,t=!1;l(this).parent().parent().parent().hasClass("yith-add-box-row")?(e=l("#_cart_discount_rules_add_box"),t=!0):(e=l(this).closest(".yith-toggle-content"),f(l("#_cart_discount_rules"))),h(e,t)}),l(document).on("change",'.user_discount_to input[type="radio"]',function(){var e=l(this).closest("#_cart_discount_rules_add_box"),t=!0;e.length||(e=l(this).closest(".yith-toggle-content"),t=!1),h(e,t)}),l(document).on("change",'#_cart_discount_rules input[type="checkbox"]',function(){var e=l(this).closest("#_cart_discount_rules_add_box"),t=!0;e.length||(e=l(this).closest(".yith-toggle-content"),t=!1),h(e,t)}),l(document).on("click","#_cart_discount_rules .yith-delete-button",function(){var e=l(this).parents(".yith-toggle-row");f(e,1)}),l(document).on("change",'.ywdpd_cart_item_qty_type input[type="radio"], .ywdpd_product_type input[type="radio"]',function(){var e=l(this).closest("#_cart_discount_rules_add_box"),t=!0;e.length||(e=l(this).closest(".yith-toggle-content"),t=!1),h(e,t)}),l(document).on("yith-toggle-element-item-before-add",function(e,t,d){f(d),h(d,!1)}),l(document).on("yith-toggle-change-counter",function(e,t,d){var i;"_cart_discount_rules_add_box"===d.attr("id")&&(d=d.parents(".toggle-element").find(".yith-toggle-row"),i=0,d.each(function(){var e=l(this).data("item_key");i<e&&(i=e)}),t.val(i+1))}),l(document).find("#_cart_discount_rules .yith-toggle-content").each(function(){h(l(this),!1)}),t.each(function(){var e=l(this),t=e.closest(".the-metabox"),e=e.data("ywdpd-deps"),o=!0;l.each(e,function(e,t){var d=l("#"+t.id),i="undefined"==typeof t.compare?"==":t.compare,n=d.hasClass("yith-plugin-fw-radio")?d.find('input[type="radio"]').filter(":checked").val():d.hasClass("yith-plugin-fw-select")?d.val():d.is(":checked")?"yes":"no";if(!a&&c.indexOf(t.id)<0&&(r.push(d),c.push(t.id)),o){var _=t.value.split(",");switch(i){case"==":case"===":o=0<=_.indexOf(n);break;case"!=":case"!==":o=_.indexOf(n)<0}}}),o?t.show():t.hide()}),d.each(function(){_(l(this)),l(this).on("change",function(){_(l(this))})}),s(i.val()),i.on("change",function(){var e=l(this).val();s(e),"discount_whole"!==e&&"category_discount"!==e||l("#_rule_for-all_products").click(),"category_discount"==e?o("specific_categories"):_(l("#_rule_for"))});var e=l(document).find('#schedule_mode input[type="radio"]:checked').val();"category_discount"==l(document).find("#_discount_mode").val()?o("specific_categories"):_(l("#_rule_for")),u(e),l(document).on("change",'#schedule_mode input[type="radio"]',function(){var e=l(this);u(e.val())}),l(document).on("change",".ywdpd_qty_discount",function(){var e=l(this).val(),t=l(this).parent().find("span.ywdpd_symbol");p(t,e)}),l(document).on("change","#_simple_whole_discount_discount_mode",function(){var e=l(this).val(),t=l(this).parent().parent().parent().find(".ywdpd_symbol");p(t,e)})}).trigger("ywdpd-init-fields"),a=!0,l.each(r,function(e,t){t.on("change",function(){l(document).trigger("ywdpd-init-fields")})}),l("#_schedule_from").datetimepicker({timeFormat:"HH:mm",minDate:new Date,dateFormat:"yy-mm-dd",onSelect:function(){l("#_schedule_to").datetimepicker("option","minDate",l(this).datetimepicker("getDate"))}}),l("#_schedule_to").datetimepicker({timeFormat:"HH:mm",minDate:new Date,dateFormat:"yy-mm-dd",onSelect:function(){l("#_schedule_from").datetimepicker("option","maxDate",l(this).datetimepicker("getDate"))}}),l("#_schedule_from, #_schedule_to").each(function(){l(this).prop("placeholder","YYYY-MM-DD HH:mm")}).datetimepicker({timeFormat:"HH:mm",defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1}),l(".post-type-ywdpd_discount table.wp-list-table").sortable({items:"tbody tr:not(.inline-edit-row)",cursor:"move",handle:".priority.column-priority",axis:"y",forcePlaceholderSize:!0,helper:"clone",opacity:.65,start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style");var t=l(".post-type-ywdpd_discount table.wp-list-table tbody tr th.check-column input").get(),d=[],t=(l.each(t,function(e,t){d.push(l(t).val())}),d=d.join(),{action:yith_ywdpd_admin.actions.sort_discount_rules,security:yith_ywdpd_admin.nonces.sort_discount_rules,rule_ids:d});l.ajax({type:"POST",url:n,data:t,dataType:"json",success:function(e){}})}}),l(document).on("click",".ywdpd_new_rule",function(e){e.preventDefault();var e=l(this).parent().parent().find(".discount-rules"),t=e.find(".discount-table-row"),d=1,t=(t.each(function(){var e=l(this).data("index");d<e&&(d=e)}),d+1),i="rules-container"===e.parent().parent().parent().attr("id")?wp.template("ywdpd-quantity-discount-row"):wp.template("ywdpd-quantity-category-discount-row");l(i({index:t})).appendTo(e),l(document.body).trigger("wc-enhanced-select-init"),l(document.body).trigger("yith-framework-enhanced-select-init")}),l(document).on("click",".yith-icon.yith-icon-trash",function(){var e=l(this),t=e.closest("div.discount-table-row");(t=t.length?t:e.closest("div.cart-rule-row")).remove()}),l(".yith-plugin-ui--ywdpd_discount-post_type form").submit(function(e){var t=l(this).find(".yith-plugin-fw--required"),d=l(document).find(".yith-plugin-ui--ywdpd_discount-post_type #title"),i=!0,n=!1;""===d.val()&&(i=!1,(n=d).addClass("ywdpd_required_check")),i&&t.each(function(){var e,t=l(this);t.is(":visible")&&(e=t.find("select")).length&&0===e.find(":selected").length&&(i=!1,n=n||t,t.addClass("ywdpd_required_check"))}),i||(e.preventDefault(),t=n,l("html,body").animate({scrollTop:t.offset().top-100},"slow"),l(document).find(".yith-plugin-ui--ywdpd_discount-post_type .yith-plugin-fw--required.ywdpd_required_check select").on("select2:open",function(e){l(this).parents(".yith-plugin-fw--required").removeClass("ywdpd_required_check"),e.stopImmediatePropagation()}),d.on("change",function(){d.removeClass("ywdpd_required_check")}))}),l(".yith-plugin-ui--ywdpd_discount-post_type  a.page-title-action, .ywdpd_add_new_dynamic_rule").on("click",function(e){e.preventDefault(),e.stopPropagation(),yith.ui.modal({width:790,title:!1,content:l("#ywdpd_rule_manger_popup").html(),footer:!1,scrollContent:!1,classes:{title:"ywdpd_admin_popup_title",content:"ywdpd_admin_popup_content"}})}),l("#ywdpd_show_percentage_in_table").on("change",function(){var e=l("#ywdpd_quantity_table_labels .option-element.ywdpd_discount_heading");l(this).is(":checked")?e.addClass("show"):e.removeClass("show")}).trigger("change"),l("#ywdpd_show_quantity_table").on("change",function(){var e=l("#ywdpd_qty_table_shortcode").parents("tr"),t=l("#ywdpd_show_quantity_table_place");l(this).is(":checked")?t.trigger("change"):e.hide()}).trigger("change")});