jQuery(document).ready(function(l){"use strict";var e=l('.ywccl[data-type="colorpicker"]'),t=l('.ywccl[data-type="image"]'),r=function(e){e.each(function(){l(this).wpColorPicker(),l(this).hasClass("hidden_empty")&&!l(this).val()&&l(this).closest(".wp-picker-container").hide()})},c=function(e){e.each(function(){var e=l("<input type='button' name='' id='term_value_button' class='button' value='Upload' />");e.insertAfter(this),e.on("click",function(e){e.preventDefault();var t,i=l(this).attr("id").replace("_button","");if(t)t.open();else{var a=[new wp.media.controller.Library({library:wp.media.query(),multiple:!1,title:"Choose Image",priority:20,filterable:"uploaded"})];(t=wp.media.frames.downloadable_file=wp.media({title:"Choose Image",library:{type:""},button:{text:"Choose Image"},multiple:!1,states:a})).on("select",function(){var e=t.state().get("selection").first().toJSON();l("#"+i).val(e.url)}),t.open()}})})};r(e),c(t);var i=l(".product_page_product_attributes .woocommerce form");"undefined"!=typeof yith_wccl_admin&&yith_wccl_admin.html&&i.find(".form-field").last().after(yith_wccl_admin.html);var a=l(".product_attributes"),d=l("#yith_wccl_dialog_form"),s=d.find(".dialog_error"),u=d.find("form").clone();a.on("click","button.yith_wccl_add_new_attribute",function(e){e.preventDefault();var t=l(this).closest(".woocommerce_attribute"),i=t.data("taxonomy"),a=l(this).data("type_input"),o=d.find("form"),n=o.find("#term_value, #term_value_2");return n.attr("data-type",a),"colorpicker"==a?(r(n),m(o.find(".ywccl_add_color_icon"))):(o.find("#term_value_2, .ywccl_add_color_icon, br").remove(),"image"==a&&c(n)),d.dialog({width:350,modal:!0,dialogClass:"yith_wccl_dialog_modal",buttons:{Add:function(){l(document).find("#yith_wccl_dialog_form form").trigger("submit",[t,i])},Cancel:function(){d.dialog("close")}},close:function(){var e;e=u.clone(),d.find("form").replaceWith(e)}}),!1}),l(document).on("submit","#yith_wccl_dialog_form form",function(e,t,i){e.preventDefault();var a,o=l(this),n=o.serializeArray();return n.push({name:"action",value:"yith_wccl_add_new_attribute"},{name:"taxonomy",value:i}),a=l.param(n),o.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),l.post(yith_wccl_admin.ajaxurl,a,function(e){o.unblock(),e.error?s.html(e.error):e.value&&(s.html(""),t.find("select.attribute_values").append('<option value="'+e.value+'" selected="selected">'+e.name+"</option>"),t.find("select.attribute_values").change(),d.dialog("close"))}),!1});var m=function(e){e.off("click").on("click",function(){var e=l(this),t=e.data("content"),i=l(this).nextAll(".wp-picker-container"),a=i.find(".wp-picker-clear");e.data("content",e.html()),e.html(t),a.click(),i.toggle()})};m(l(".ywccl_add_color_icon"));var n=function(e){var t=e.find(".yith_wccl_variation_gallery_values"),i=e.find("li.image:not('.add')"),a=[];l.each(i,function(){a.push(l(this).data("value"))}),t.attr("value",a.join(",")).change()};l(document).on("woocommerce_variations_loaded woocommerce_variations_added",function(){l(".woocommerce_variation:not('.initialized')").each(function(e,t){var i=l(t).find(".yith-wccl-variation-gallery-wrapper"),a=l(t).find(".form-row-full.options").first();i.insertBefore(a),i.find(".yith-wccl-variation-gallery-images").sortable({items:"li.image:not('.add')",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"yith-wccl-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){n(i)}}),l(this).addClass("initialized")})}),l(document).on("click",".yith-wccl-variation-gallery-images .remove",function(e){e.preventDefault();var t=l(this).closest(".yith-wccl-variation-gallery-wrapper");l(this).closest(".image").remove(),n(t)}),l(document).on("click",".add-variation-gallery-image",function(e){if(e.preventDefault(),"undefined"!=typeof wp){var t=l(this),i=t.closest(".yith-wccl-variation-gallery-wrapper"),a=i.find(".yith-wccl-variation-gallery-images"),o=(t.attr("data-index"),wp.media({title:woocommerce_admin_meta_boxes_variations.i18n_choose_image,button:{text:woocommerce_admin_meta_boxes_variations.i18n_set_image},library:{type:"image"},multiple:!0}));o.on("select",function(){var e=o.state().get("selection").toJSON().map(function(e){if("image"!==e.type||a.find('[data-value="'+e.id+'"]').length)return"";var t=e.id,i=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;return wp.template("yith-wccl-variation-gallery-image")({id:t,url:i})}).join("");a.find(".image.add").before(e),n(i)}),o.open()}})});