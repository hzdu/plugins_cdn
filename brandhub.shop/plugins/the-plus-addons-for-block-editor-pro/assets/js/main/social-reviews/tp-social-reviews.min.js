document.addEventListener("DOMContentLoaded",()=>{tpsocialReview(document)});function tpsocialReview(a){let b=a.querySelectorAll(".tpgb-social-reviews");b&&b.forEach(b=>{var c={ScrollOn:b.getAttribute("data-scroll-normal"),TextLimit:b.getAttribute("data-textlimit")},d=b.getAttribute("data-textlimit");if(d=d?JSON.parse(d):"","true"==c.ScrollOn&&"false"==c.TextLimit){var e=b.querySelectorAll(".showtext");e&&e.forEach(function(a){a.clientHeight>=c.Height&&(a.classList.add(c.className),a.style.height=c.Height)})}document.addEventListener("click",function(a){if(a.target.matches(".readbtn")){let g=a.target;var b=g.closest(".tpgb-message"),c=b.closest(".tpgb-isotope .post-loop-inner"),e=g.closest(".tpgb-social-reviews").dataset.scrollNormal;e=e?JSON.parse(e):"";var f=b.querySelector(".showtext");b.classList.contains("show-text")?(b.classList.remove("show-text","show-less"),g.innerHTML=d.showmoretxt,b.querySelector(".sf-dots").style.display="inline",e&&e.ScrollOn&&e.TextLimit&&(f.classList.remove(e.className),f.removeAttribute("style"))):(b.classList.add("show-text","show-less"),g.innerHTML=d.showlesstxt,b.querySelector(".sf-dots").style.display="none",e&&e.ScrollOn&&e.TextLimit&&f.clientHeight>=e.Height&&(f.classList.add(e.className),f.style.height=e.Height+"px")),c&&new Isotope(c,{itemSelector:".grid-item",resizable:!0,sortBy:"original-order"})}});let f=b.querySelector(".review-load-more");f&&f.addEventListener("click",function(c){c.preventDefault();var d=c.currentTarget,e=d.getAttribute("data-loadattr"),f=d.getAttribute("data-display"),g=d.getAttribute("data-loadview"),h=d.getAttribute("data-loadclass"),i=d.getAttribute("data-layout"),j=d.getAttribute("data-loadingtxt"),k=d.textContent;if(!d.getAttribute("data-requestRunning")){d.setAttribute("data-requestRunning",!0),d.textContent=j;var l=new FormData;l.append("action","tpgb_reviews_load"),l.append("view",f),l.append("loadFview",g),l.append("loadattr",e),fetch(tpgb_config&&tpgb_config.ajax_url?tpgb_config.ajax_url:tpgb_load.ajaxUrl,{method:"POST",body:l}).then(function(a){if(!a.ok)throw new Error("Network response was not ok");return a.json()}).then(function(c){var e=c&&c.HTMLContent?c.HTMLContent:"",j=c&&c.TotalReview?c.TotalReview:"",l=c&&c.FilterStyle?c.FilterStyle:"",m=c&&c.allposttext?c.allposttext:"";if(""==c)d.classList.add("hide");else{var n=".tpgb-block-"+h,o=document.querySelector(n+" .all .tpgb-category-count"),p=document.querySelector(n+" .post-loop-inner");p&&p.insertAdjacentHTML("beforeend",e);var q=document.querySelector(n).querySelectorAll(".grid-item").length;if(o&&(o.innerHTML=q),"style-2"==l||"style-3"==l){var r=document.querySelectorAll(n+" .tpgb-filter-list .tpgb-category-list:not(.all)");r&&r.forEach(function(a){var b=a.querySelector("span:nth-child(2)").dataset.hover,c=document.querySelector(n).querySelectorAll(".grid-item."+b).length;a.querySelector("span:nth-child(1).tpgb-category-count").innerHTML=c})}("grid"==i||"masonry"==i)&&b.classList.contains("tpgb-isotope")&&"function"==typeof tppoMaso&&tppoMaso(a),q>=+j?(d.classList.add("hide"),d.parentNode.insertAdjacentHTML("beforeend","<div class=\"tpgb-review-loaded\">"+m+"</div>")):d.textContent=k}f=+f+ +g,d.setAttribute("data-display",f)}).catch(function(a){console.log("Error:",a)}).finally(function(){d.removeAttribute("data-requestRunning")}).then(function(){document.querySelector(".tpgb-block-"+h).classList.contains("tpgb-isotope")&&("grid"==i||"masonry"==i&&"function"==typeof tppoMaso)&&tppoMaso(a)})}});let g=b.querySelector(".tpgb-review-lazy-load");if(g&&b.classList.contains("tpgb-isotope")){var h,i,j,k,l,m,n=window,o=function(){h=n.innerWidth,i=n.innerHeight,j=document.querySelector("body").offsetHeight,l=b.offsetHeight,m=b.offsetTop+50,setTimeout(function(){l=b.offsetHeight,m=b.offsetTop+50},50)};o(),n.addEventListener("resize",o),n.addEventListener("scroll",function(c){if(c.preventDefault(),o(),k=n.pageYOffset,l=b.offsetHeight,m=b.offsetTop+50,b.querySelector(".tpgb-review-lazy-load")&&k<j&&k+60>l+m-i){let b=g.querySelector(".review-lazy-load"),c=b.dataset.lazyattr,d=b.getAttribute("data-totalreviews"),e=b.getAttribute("data-display"),f=b.dataset.lazyview,h=b.dataset.lazyclass,i=b.dataset.lazylayout,j=b.innerHTML,k=b.closest(".tpgb-block-"+h);if(b.dataset.requestRunning&&"true"==b.dataset.requestRunning)return;+d>=+e&&(b.dataset.requestRunning="true",fetch(tpgb_config&&tpgb_config.ajax_url?tpgb_config.ajax_url:tpgb_load.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action=tpgb_reviews_load&view="+e+"&loadFview="+f+"&loadattr="+c}).then(function(a){return a.json()}).then(function(c){var d=c&&c.HTMLContent?c.HTMLContent:"",g=c&&c.TotalReview?c.TotalReview:"",h=c&&c.FilterStyle?c.FilterStyle:"",l=c&&c.allposttext?c.allposttext:"";if(""===c)b.classList.add("hide");else{var m=k.querySelector(".all .tpgb-category-count"),n=k.querySelector(".post-loop-inner");n.insertAdjacentHTML("beforeend",d);var o=k.querySelectorAll(".grid-item").length;if(m&&(m.innerHTML="",m.appendChild(document.createTextNode(o))),"style-2"===h||"style-3"===h){var p=k.querySelectorAll(".tpgb-filter-list .tpgb-category-list:not(.all)");p&&p.forEach(function(a){var b=a.querySelector("span:nth-child(2)").dataset.hover,c=k.querySelectorAll(".grid-item."+b).length;a.querySelector("span:nth-child(1).tpgb-category-count").innerHTML="",a.querySelector("span:nth-child(1).tpgb-category-count").appendChild(document.createTextNode(c))})}if(("grid"===i||"masonry"===i)&&k.classList.contains("tpgb-isotope")&&"function"==typeof tppoMaso&&tppoMaso(a),!(o>=+g))b.innerHTML=j;else if(!b.nextElementSibling||!b.nextElementSibling.classList.contains("tpgb-review-loaded")){b.classList.add("hide");var q=document.createElement("div");q.classList.add("tpgb-review-loaded"),q.innerHTML=l,b.parentNode.appendChild(q)}}e=+e+ +f,b.setAttribute("data-display",e)}).catch(function(a){console.log("Error:",a)}).finally(function(){b.dataset.requestRunning="false"}).then(function(){if(k.classList.contains("tpgb-isotope")){("grid"===i||"masonry"===i)&&"function"==typeof tppoMaso&&tppoMaso(a);var b=k.querySelectorAll(".tpgb-carousel:not(.is-initialized)");b.forEach(function(a){"function"==typeof splide_init&&splide_init(a)})}}))}})}var p=b.querySelector(".batch-btn-no");p&&p.addEventListener("click",function(a){a.preventDefault();var b=this.closest(".tpgb-batch-recommend");b.style.display="none"===b.style.display?"block":"none"})})}