jQuery(function(e){var t={init:function(){this.initalize_form_reset_settings(),this.initalize_whitelist_domain_settings(),this.initalize_form_auto_password_generation_settings(),this.initialize_conditional_logic_settings(),this.initialize_extension_page(),this.initialize_external_fields_mapping(),this.init_all_tooltips(),this.manage_tooltip_fields(),this.init_export_custom_fields(),this.init_render_dynamic_form_fields(),this.init_accordion_settings(),this.init_integration_settings(),this.init_hide_show_redirection_settings(),this.init_hide_show_role_based_redirection_settings()},init_integration_settings:function(){e(".ur-integration-connected-accounts").each(function(){e(this).closest(".user-registration-card").find(".integration-status").addClass("ur-integration-account-connected")})},init_accordion_settings:function(){var e,t=document.getElementsByClassName("accordion");for(e=0;e<t.length;e++){t[e].nextElementSibling.style.display="none",t[e].addEventListener("click",function(){this.classList.toggle("active");var e=this.nextElementSibling;"block"===e.style.display?e.style.display="none":e.style.display="block"})}},init_all_tooltips:function(){var t={theme:"tooltipster-borderless",maxWidth:200,multiple:!0,interactive:!0,position:"bottom",contentAsHTML:!0,functionInit:function(e,t){var i=jQuery(t.origin).attr("data-tip");i&&e.content(i)}};e(".user-registration-help-tip").tooltipster(t)},initialize_external_fields_mapping:function(){e(document).ready(function(){e(document).on("user_registration_admin_before_form_submit",function(e,i){var n=t.save_external_mapping_settings();n.length>0&&(i.data.ur_pro_external_mapping_settings=n)}),t.hide_show_external_fields_mapping(),e(document).on("change","#user_registration_enable_external_fields_mapping_field",function(){t.hide_show_external_fields_mapping()}),e(document).on("change",".ur-pro-db-table-section",function(){t.hide_show_external_table_selection()});user_registration_pro_admin_script_data.ur_pro_form_fields;e(document).on("click",".ur-pro-external-field-map-group .add",function(){var i=e(this).closest(".ur-pro-field-mapping-box").attr("data-last-key"),n='<li class="ur-pro-external-field-map-group" data-key="'+ ++i+'">';n+='<div class="ur-pro-external-field-map-form-group">',n+='<select class="ur-pro-fields ur-pro-field-map-select" name="ur_pro_external_map_form_fields['+i+']">',n+='<option value="">-- Select Field --</option>',n+=t.get_fields_list(),n+="</select></div>",n+='<div class="ur-pro-operator"> <i class="dashicons dashicons-arrow-right-alt"></i> </div>',n+='<div class="ur-pro-value">',n+='<input name="user_registration_form_value['+i+']" class="ur_pro_external_field_name" placeholder="Enter Field Key" type="text" />',n+="</div>",n+='<span class="add">',n+='<i class="dashicons dashicons-plus"></i>',n+="</span>",n+='<span class="remove">',n+='<i class="dashicons dashicons-minus"></i>',n+="</span></li>",e(this).closest(".ur-pro-field-mapping-box").append(n),e(this).closest(".ur-pro-field-mapping-box").attr("data-last-key",i)}),e(document).on("click",".ur-pro-external-field-map-group .remove",function(){e(".ur-pro-field-mapping-box").find(".ur-pro-external-field-map-group").length>1&&e(this).parent().remove()}),e(document).on("change",".ur_pro_db_table",function(){$table=e(this).val(),e(".ur-spinner").remove(),t.retrive_db_table_columns($table)}),e(document).on("click",".ur-license-expiry-notice .notice-dismiss",function(){var i=e(this);t.get_license_expiry_count(i)})})},initalize_whitelist_domain_settings:function(){e(document).ready(function(){var i=e("#user_registration_form_setting_enable_whitelist_domain"),n=e("#user_registration_form_setting_whitelist_domain_field"),r=e("#user_registration_form_setting_domain_restriction_settings_field");t.settings_fields_toggler(i,n),t.settings_fields_toggler(i,r),i.on("change",function(){t.settings_fields_toggler(e(this),n),t.settings_fields_toggler(e(this),r)})})},initalize_form_reset_settings:function(){e(document).ready(function(){var i=e("#user_registration_form_setting_enable_reset_button"),n=e("#user_registration_form_setting_form_reset_class_field"),r=e("#user_registration_form_setting_form_reset_label_field");t.settings_fields_toggler(i,n),t.settings_fields_toggler(i,r),i.on("change",function(){t.settings_fields_toggler(e(this),n),t.settings_fields_toggler(e(this),r)})})},initalize_form_auto_password_generation_settings:function(){e(document).ready(function(){var i=e("#user_registration_pro_auto_password_activate"),n=e("#user_registration_pro_auto_generated_password_length_field");t.settings_fields_toggler(i,n),i.on("change",function(){t.settings_fields_toggler(e(this),n)})})},initialize_conditional_logic_settings:function(){e(document).on("focus",".ur-conditional-wrapper .ur_conditional_field",function(){t.replaceFormFields(e(this))}),e(document).on("change",".ur-conditional-wrapper .ur_conditional_field",function(){t.replaceFieldValues(".ur-conditional-wrapper",this)}),e(document).find(".ur_use_conditional_logic_wrapper").each(function(){var t=e(this).closest(".ur_conditional_logic_container");e(this).find("#ur_use_conditional_logic").is(":checked")?t.find(".ur_conditional_logic_wrapper").show():t.find(".ur_conditional_logic_wrapper").hide()}),e(document).on("change","#ur_use_conditional_logic",function(){var t=e(this).closest(".ur_conditional_logic_container");e(this).is(":checked")?t.find(".ur_conditional_logic_wrapper").show():t.find(".ur_conditional_logic_wrapper").hide()})},hide_show_external_table_selection:function(){$selected_option=e(".ur-pro-db-table-section").val(),"external_table"===$selected_option?(t.init_all_tooltips(),e(".ur-pro-external-field-table-column-selection").show()):(e(".ur_pro_db_table").val(user_registration_pro_admin_script_data.ur_pro_db_prefix+"usermeta"),e(".ur_pro_user_id_db_column").val(""),e(".ur_pro_field_key_db_column").val(""),e(".ur_pro_field_value_db_column").val(""),e(".ur-pro-external-field-table-column-selection").hide())},hide_show_external_fields_mapping:function(){if(e("#user_registration_enable_external_fields_mapping").is(":checked"))if(0===e(".ur-pro-fields-mapping-container").length){var i=e(user_registration_pro_admin_script_data.ur_pro_external_fields_mapping_output),n=i.find(".ur-pro-field-map-select"),r='<option value="">-- Select Field --</option>'+t.get_fields_list();n.each(function(){var t=e(this).val();e(this).html(r),e(this).val(t),e(this).find('option[value="'+t+'"]').prop("selected",!0)}),e("#user_registration_enable_external_fields_mapping_field").after(i),t.hide_show_external_table_selection()}else e(".ur-pro-fields-mapping-container").show(),t.hide_show_external_table_selection();else e(".ur-pro-fields-mapping-container").hide()},get_fields_list:function(){var t="";return e(".ur-grid-lists .ur-selected-item .ur-general-setting").each(function(){var i=e(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-label label").text(),n=e(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-field").data("field-key");if("section_title"!=n&&"html"!=n&&"wysiwyg"!=n&&"billing_address_title"!=n&&"shipping_address_title"!=n){var r=e(this).find("[data-field='field_name']").val();void 0!==r&&(t+='<option value="'+r+'" data-type="'+n+'">'+i+"</option>")}}),t},settings_fields_toggler:function(e,t){e.is(":checked")?t.show():t.hide()},replaceFieldValues:function(t,i){var n=e("option:selected",i).attr("data-type"),r=e("option:selected",i).val(),a=e(i).closest(t).find(".ur-conditional-input"),o=a.attr("name"),s=a.attr("class");if("checkbox"==n||"radio"==n||"select"==n||"country"==n||"billing_country"==n||"shipping_country"==n||"select2"==n||"multi_select2"==n||"multi_choice"==n||"multiple_choice"==n){if("select"==n||"select2"==n||"multi_select2"==n)var l=e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return e(this).val()});else if("country"==n||"billing_country"==n||"shipping_country"==n)e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return e(this).val()}),e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return e(this).text()});else l=e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field input").map(function(){return e(this).val()});var _="<option value>--select--</option>";if("country"==n||"billing_country"==n||"shipping_country"==n){var d=e('.ur-general-setting-field-name input[value="'+r+'"').closest(".ur-selected-item").find(".ur-advance-selected_countries select option:selected"),c=[];e(this).find(".urcl-value select").html('<option value="">--select--</option>'),d.each(function(){var t=e(this).val(),i=e(this).text();c.push('<option value="'+t+'">'+i+"</option>")}),_=c.join("")}else 1==l.length&&""===l[0]?_='<option value="1">'+urcl_data.checkbox_checked+"</option>":e(l).each(function(e,t){_=_+'<option value="'+t+'">'+t+"</option>"});a.replaceWith('<select name="'+o+'" class="'+s+'">'+_+"</select>")}else a.replaceWith('<input type="text" name="'+o+'" class="'+s+'">')},retrive_db_table_columns:function(t){var i={action:"user_registration_pro_get_db_columns_by_table",security:user_registration_pro_admin_script_data.ur_pro_get_db_columns_by_table,table:t};e(".user_registration_user_id_db_column_label").append('<span class="ur-spinner"></span>'),e(".user_registration_field_key_db_column_label").append('<span class="ur-spinner"></span>'),e(".user_registration_field_value_db_column_label").append('<span class="ur-spinner"></span>'),e.ajax({url:user_registration_pro_admin_script_data.ajax_url,data:i,type:"POST",success:function(t){if(t.success&&"undefined"!=typeof t.data.columns){var i=JSON.parse(t.data.columns);e(".ur_pro_user_id_db_column option").remove(),e(".ur_pro_field_key_db_column option").remove(),e(".ur_pro_field_value_db_column option").remove(),e(".ur_pro_user_id_db_column").append(e("<option>",{value:"",text:"-- Select Column for User ID --"})),e(".ur_pro_field_key_db_column").append(e("<option>",{value:"",text:"-- Select Column for Field Key --"})),e(".ur_pro_field_value_db_column").append(e("<option>",{value:"",text:"-- Select Column for Field Value --  "}));e.each(i,function(t,i){'<option value="'+i+'">'+i+"</option>",e(".ur_pro_user_id_db_column").append(e("<option>",{value:i,text:i})),e(".ur_pro_field_key_db_column").append(e("<option>",{value:i,text:i})),e(".ur_pro_field_value_db_column").append(e("<option>",{value:i,text:i}))})}e(".ur-spinner").remove()}})},get_license_expiry_count:function(t){var i={action:"user_registration_pro_get_license_expiry_count",security:user_registration_pro_admin_script_data.ur_pro_get_license_expiry_count};e.ajax({url:user_registration_pro_admin_script_data.ajax_url,data:i,type:"POST"})},save_external_mapping_settings:function(){var t=[],i=e(".ur-pro-field-mapping-wrap");return e.each(i,function(){var i=e(this).find(".ur-pro-external-field-map-group"),n=[],r=[];e.each(i,function(){var t={ur_field:e(this).find(".ur-pro-field-map-select").val(),external_field:e(this).find(".ur_pro_external_field_name").val()};r.push(t)}),n.push(r);var a={db_table:e(".ur_pro_db_table").val(),user_id_db_column:e(".ur_pro_user_id_db_column").val(),field_key_db_column:e(".ur_pro_field_key_db_column").val(),field_value_db_column:e(".ur_pro_field_value_db_column").val(),mapped_fields:n};t.push(a)}),t},initialize_extension_page:function(){e(".ur_addons_wrap").find(".install-now").on("click",function(t){var i=e(this),n={action:"user_registration_pro_extension_install",security:user_registration_pro_admin_script_data.ur_pro_install_extension,slug:i.data("slug"),name:i.data("name")};t.preventDefault(),i.text("Installing..."),i.append('<span class="ur-spinner"></span>'),e.ajax({url:user_registration_pro_admin_script_data.ajax_url,data:n,type:"POST",success:function(t){var n='<div class="notice '+(t.success?"notice-success":"notice-error")+'"><p>'+t.message+"</p></div>";e(n).insertBefore(i.closest(".ur_addons_wrap").find(".subsubsub")),t.success?(i.text("Installed"),t.activateUrl?(i.text("Activate"),i.removeClass("install-now").addClass("activate-now button-primary").attr("href",t.activateUrl),i.closest(".ur-plugin-card-bottom").find(".status-label").removeClass("status-install-now").addClass("status-inactive").text("Inactive")):t.deActivateUrl&&(i.text("Deactivate"),i.removeClass("install-now").addClass("deactivate-now button-danger").attr("href",t.deActivateUrl),i.closest(".ur-plugin-card-bottom").find(".status-label").removeClass("status-install-now").addClass("status-inactive").text("Inactive"))):i.text(user_registration_pro_admin_script_data.ur_pro_extension_installed_failed_text).prop("disabled",!0),e(".ur-spinner").remove(),i.off("click")}})})},manage_tooltip_fields:function(){e('input[data-field="tooltip"]').each(function(){e(this).is(":checked")?(e(this).closest(".ur-selected-item").find(".ur-label").find("label").append('<span class="ur-portal-tooltip"></span>'),e(this).closest(".ur-toggle-content").find(".ur-general-setting-tooltip-message").show(500)):e(this).closest(".ur-toggle-content").find(".ur-general-setting-tooltip-message").hide(500),e(document).on("click",".ur-selected-item",function(i){i.stopImmediatePropagation();var n=e(".ur-general-setting-field");e.each(n,function(){var i=e(this);switch(i.attr("data-field")){case"tooltip":t.trigger_general_setting_tooltip(i),i.on("change",function(){t.trigger_general_setting_tooltip(i)});break;case"tooltip_message":i.on("input",function(){t.trigger_general_setting_tooltip_message(i)})}})})})},trigger_general_setting_tooltip:function(t){var i=e(".ur-selected-item.ur-item-active"),n=t.closest("#ur-setting-form").find("[data-field='field_name']").val(),r=i.find("[data-field='field_name']").val();i.find(".ur-general-setting-block").find('input[data-field="'+t.attr("data-field")+'"]').prop("checked",t.is(":checked")),n===r&&(i.find(".ur-label").find(".ur-portal-tooltip").length>0&&i.find(".ur-label").find(".ur-portal-tooltip").remove(),t.is(":checked")?(i.find(".ur-label").find("label").append('<span class="ur-portal-tooltip"></span>'),t.closest(".ur-toggle-content").find(".ur-general-setting-tooltip-message").show(500)):(i.find(".ur-label").find("label").find("span.ur-portal-tooltip").remove(),t.closest(".ur-toggle-content").find(".ur-general-setting-tooltip-message").hide(500)))},trigger_general_setting_tooltip_message:function(t){e(".ur-selected-item.ur-item-active").find(".ur-general-setting-block").find('textarea[data-field="'+t.attr("data-field")+'"]').val(t.val())},init_export_custom_fields:function(){e("select.ur-input.forms-list").on("change",function(){var t=e('<span class="ur-spinner"></span>');e(".ur-export-custom-fields > p").append(t);var i=e(this).val();""!=i?e.ajax({url:user_registration_pro_admin_script_data.ajax_url,data:{action:"user_registration_pro_get_form_fields_list_by_form_id",form_id:i,security:user_registration_pro_admin_script_data.ur_pro_get_form_fields_by_form_id},type:"post",success:function(i){e(".ur-export-custom-fields").show(),e(".ur-custom-fields-input").html("");var n=JSON.parse(i.data.form_field_list);option="",e.each(n,function(e,t){option+='<option class="ur-field-option" value="'+e+'">'+t+"</option>"}),e(".ur-custom-fields-input").html(option),e(".ur_export_csv_additional_fields_dict").val(i.data.form_field_list),t.remove()}}):(e(".ur-export-custom-fields").hide(),t.remove())}),e(".ur-export-custom-fields").hide(),e(function(){flatpickr("#date_range",{mode:"range",dateFormat:"Y-m-d",maxDate:"today",onChange:function(t){if(2==t.length){var i=t[0],n=i.toLocaleString("default",{year:"numeric"})+"-"+i.toLocaleString("default",{month:"2-digit"})+"-"+i.toLocaleString("default",{day:"2-digit"}),r=t[1],a=r.toLocaleString("default",{year:"numeric"})+"-"+r.toLocaleString("default",{month:"2-digit"})+"-"+r.toLocaleString("default",{day:"2-digit"});e("#from_date").val(n),e("#to_date").val(a)}}})})},init_render_dynamic_form_fields:function(){e(document).on("focus",".ur_pro_fields_wrapper .column-form-fields select",function(){t.replaceFormFields(e(this))})},replaceFormFields:function(i){var n={};e(".ur-grid-lists .ur-selected-item .ur-admin-template").each(function(){var t=e(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-label label").text(),i=e(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-field").data("field-key"),r=e(this).parent().find(".ur-general-setting-block").find("input[data-field='field_name'").val();"section_title"!=i&&"html"!=i&&"wysiwyg"!=i&&"billing_address_title"!=i&&"shipping_address_title"!=i&&"stripe_gateway"!=i&&"profile_picture"!=i&&"file"!=i&&void 0!==i&&(n[r+"."+i]=t)});var r=i.val();return i.empty(),i.html("<option value>Ignore this field</option>"),e.each(n,function(t,n){var r=t.substring(0,t.indexOf(".")),a=t.slice(t.indexOf(".")+1);i.append(e("<option data-type='"+a+"' data-lable='"+n+"'></option>").attr("value",r).text(n))}),i.find("option[value='"+r+"']").attr("selected","selected"),i.on("change",function(){selectedOption=e(this).val(),t.replaceFormFields(e(this))}),n},init_hide_show_redirection_settings:function(){this.hide_show_redirection_options(),e("#user_registration_form_setting_redirect_after_registration").on("change",this.hide_show_redirection_options),this.hide_show_redirection_messages(),e('#user_registration_form_setting_redirect_after_registration, select[data-id="user_registration_form_setting_login_options"], input[data-id="user_registration_enable_paypal_standard"], input[data-id="user_registration_form_setting_enable_conditional_redirection"]').on("change",this.hide_show_redirection_messages)},hide_show_redirection_options:function(){var t=e("#user_registration_form_setting_redirect_after_registration"),i=t.find(":selected"),n=e("#user_registration_form_setting_role_based_redirection_field").slideUp(800);t.length&&"role-based-redirection"===i.val()&&n.slideDown(800)},hide_show_redirection_messages:function(){var t=e("#user_registration_form_setting_redirect_after_registration"),i=(e('select[data-id="user_registration_form_setting_login_options"]'),e('input[data-id="user_registration_enable_paypal_standard"]').is(":checked")),n=e('input[data-id="user_registration_form_setting_enable_conditional_redirection"]'),r=!1;if(n.length&&(r=n.is(":checked")),("no-redirection"!==t.val()||r)&&i){if(!t.parent().find("#user-registration-redirection-message").length){var a=e('<div class="user-registration-form-setting-info" id="user-registration-redirection-message">Warning: Redirection options will not work with Paypal payment enabled.</div>');t.before(a)}}else{var o=t.parent().find("#user-registration-redirection-message");o.length&&o.remove()}},init_hide_show_role_based_redirection_settings:function(){var t=e("#user_registration_pro_role_based_redirection").closest(".user-registration-global-settings").next();!0===e("#user_registration_pro_role_based_redirection").prop("checked")&&e(t).show(),e("#user_registration_pro_role_based_redirection").on("change",function(){e(t).toggle()})}};e("#user_registration_enable_privacy_tab").is(":checked")||e(".privacy-tab-settings").closest(".user-registration-global-settings").hide(),e("#user_registration_enable_privacy_tab").on("change",function(){e(".privacy-tab-settings").closest(".user-registration-global-settings").toggle()}),""==e("#user_registration_auto_logout_inactivity_time").val()&&(e("#user_registration_timeout_countdown_inactive_period").parent().parent().hide(),e("#user_registration_role_based_inactivity").parent().parent().hide()),e(document).on("change","#user_registration_auto_logout_inactivity_time",function(){e("#user_registration_timeout_countdown_inactive_period").parent().parent().show(),e("#user_registration_role_based_inactivity").parent().parent().show(),""==e(this).val()&&(e("#user_registration_timeout_countdown_inactive_period").parent().parent().hide(),e("#user_registration_role_based_inactivity").parent().parent().hide())}),t.init()});