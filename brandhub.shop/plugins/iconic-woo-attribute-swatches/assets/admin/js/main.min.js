((n,o)=>{var _={cache(){_.els={},_.vars={},_.vars.u_hide_class="iconic-was-u-hide",_.vars.picker_ajax_debounce=null,_.vars.picker_msg_debounce=null,_.vars.picker_container_class=".wp-picker-container",_.vars.picker_ajax_msg_class=".colour-swatch-picker-ajax__message",_.vars.picker_options={change(t,e){n(_.vars.picker_ajax_msg_class).empty(),n(t.target).closest(_.vars.picker_container_class).siblings(_.vars.picker_ajax_msg_class).addClass("saving"),clearTimeout(_.vars.picker_ajax_debounce),_.vars.picker_ajax_debounce=setTimeout(function(){_.update_swatch_colour_meta(t,e)},1e3)}},_.els.attribute_form=n(".product_page_product_attributes #attribute_label").closest("form"),_.els.attribute_form_submit=_.els.attribute_form.find(".submit"),_.els.product_attribute_swatch_types=n(".iconic-was-attributes__swatch-type select"),_.els.attribute_type_field=n('select[name="attribute_type"]')},on_ready(){_.cache(),_.setup_attribute_fields(),_.setup_product_swatch_fields(),_.setup_list_table_watch()},setup_attribute_fields(){_.get_attribute_fields(function(t){t=_.format_attribute_fields(t);_.els.attribute_form_submit.before(t),n("[data-conditional]").iconicConditional()}),_.els.attribute_type_field.on("change",function(){var t=n(this).val(),e=n(".iconic-was-attribute-fields");"select"===t?e.removeClass(_.vars.u_hide_class):e.addClass(_.vars.u_hide_class)}),_.setup_colour_pickers(),_.setup_image_swatch_fields()},setup_colour_pickers(){n(".colour-swatch-picker").wpColorPicker(),n(".colour-swatch-picker-ajax").each(function(t){n(this).wpColorPicker(_.vars.picker_options)}),n(".wp-color-result-text").text(iconic_was_vars.i18n.select_colour)},update_swatch_colour_meta(e,t){n.ajax({type:"POST",url:iconic_was_vars.ajax_url,cache:!1,dataType:"json",crossDomain:!0,data:{action:"iconic_was_update_colour_swatch_meta",term_id:e.target.name.split("__")[1],value:e.target.value,nonce:iconic_was_vars.ajax_nonce},success(t){_.update_swatch_colour_msg(t.success?"success":"error",e.target)},error(t){_.update_swatch_colour_msg("error",e.target)}})},update_swatch_colour_msg(t,e){let a="success"===t?'<span class="dashicons dashicons-yes-alt"></span> Updated!':'<span class="dashicons dashicons-dismiss"></span> Failed!',i="success"===t?"#46B450":"#DC3232",s=n(e).closest(_.vars.picker_container_class).siblings(_.vars.picker_ajax_msg_class);s.removeClass("saving"),s.css("color",i).html(a),"error"===t?(clearTimeout(_.vars.picker_msg_debounce),setTimeout(function(){n(e).parent().siblings(".wp-picker-default").trigger("click")},1e3)):(clearTimeout(_.vars.picker_msg_debounce),_.vars.picker_msg_debounce=setTimeout(function(){s.html("").css("color","")},3e3))},setup_image_swatch_fields(){let r;n(".iconic-was-image-picker__upload").on("click",function(t){t.preventDefault();let e=n(this),a=e.closest(".iconic-was-image-picker"),i=a.find(".iconic-was-image-picker__field"),s=a.find(".iconic-was-image-picker__preview"),c=a.find(".iconic-was-image-picker__remove");(r=wp.media.frames.file_frame=wp.media({title:n(this).data("title"),button:{text:n(this).data("button-text")},multiple:!1})).on("select",function(){attachment=r.state().get("selection").first().toJSON(),attachment_url=(void 0!==attachment.sizes.thumbnail?attachment.sizes.thumbnail:attachment).url,i.val(attachment.id),s.html('<img src="'+attachment_url+'" class="attachment-thumbnail size-thumbnail">'),e.addClass("iconic-was-image-picker__upload--edit"),c.show()}),r.open()}),n(".iconic-was-image-picker__remove").on("click",function(t){t.preventDefault();var t=n(this).closest(".iconic-was-image-picker"),e=t.find(".iconic-was-image-picker__field"),a=t.find(".iconic-was-image-picker__preview"),t=t.find(".iconic-was-image-picker__upload");e.val(""),a.html(""),t.removeClass("iconic-was-image-picker__upload--edit"),n(this).hide()})},get_admin_page(){return!(_.els.attribute_form.length<=0)&&(0<_.els.attribute_form.find("table").length?"update":"add")},get_attribute_fields(e){var t=void 0!==iconic_was_vars.url_params.edit&&iconic_was_vars.url_params.edit;n.post(ajaxurl,{action:"iconic_was_get_attribute_fields",attribute_id:t},function(t){if(!0!==t.success)return!1;e&&"function"==typeof e&&e(t.fields)})},format_attribute_fields(e){let a="",t=_.els.attribute_type_field.val(),i="text"===t?_.vars.u_hide_class:"";if("update"===_.get_admin_page()){let t=n("<table />"),o=n("<tbody />");t.attr("class","form-table iconic-was-attribute-fields "+i),n.each(e,function(t,e){var a=!!e.condition&&(n.isArray(e.condition)?JSON.stringify(e.condition):e.condition),i=JSON.stringify(e.match),s=n("<tr />"),c=n('<th scope="row" valign="top" />'),r=n("<td />");s.attr("class","iconic-was-attribute-row form-field "+e.class.join(" ")),a&&(s.attr("data-condition",a),s.attr("data-match",i)),c.append('<label for="'+t+'">'+e.label+"</label>"),r.append(e.field+'<p class="description">'+e.description+"</p>"),s.append(c,r),o.append(s)}),a=t.append(o)}else{let c=n("<div />");c.attr("class","iconic-was-attribute-fields "+i),n.each(e,function(t,e){var a=!!e.condition&&(n.isArray(e.condition)?JSON.stringify(e.condition):e.condition),i=JSON.stringify(e.match),s=n("<div />");s.attr("class","iconic-was-attribute-row form-field "+e.class.join(" ")),a&&(s.attr("data-condition",a),s.attr("data-match",i)),s.append('<label for="'+t+'">'+e.label+"</label>"),s.append(e.field+'<p class="description">'+e.description+"</p>"),c.append(s)}),a=c}return a},escape(t){return t.replace(/[\\]/g,"\\\\").replace(/[\"]/g,"&quot;").replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t")},setup_product_swatch_fields(){_.els.product_attribute_swatch_types.on("change",function(){let t=n(this),e=t.val(),a=t.find(":selected").text(),i=t.closest(".iconic-was-attribute-wrapper"),s=i.find(".iconic-was-swatch-type"),c=i.find(".iconic-was-attributes__swatch-options td"),r=parseInt(i.data("product-id")),o=i.data("taxonomy"),l=i.find(".wc-metabox-content");s.text(a.replace("Swatch","").trim()),c.html(""),_.reset_height(l),_.is_swatch_visual(e)&&n.post(ajaxurl,{action:"iconic_was_get_product_attribute_fields",swatch_type:e,product_id:r,attribute_slug:o},function(t){return!0===t.success&&!1!==t.fields&&(c.html(t.fields),_.setup_image_swatch_fields(),_.setup_colour_pickers(),void _.reset_height(l))})})},is_swatch_visual(t){return"colour-swatch"===t||"image-swatch"===t},reset_height(t){t.height("")},list_table_watch(t,e){t.forEach(function(t){if("childList"===t.type)if(t.addedNodes.length){var t=t.addedNodes[0],e=n(t),t=t.id.replace("tag-",""),a=e.find(".column-slug").text(),i=n("#colour-swatch").val(),s=n('input[name="taxonomy"]').val(),c=n("th#iconic-was-swatch").text(),r=n("#iconic-was-group-field").val();if(!t||!a||!s)return;c=`
							<td class="iconic-was-swatch column-iconic-was-swatch" data-colname="${c}">
								<input id="colour-swatch_${a}" type="text" name="${s}__${t}" value="${i}" class="colour-swatch-picker-ajax" data-default-color="${i}">
								<div id="colour-swatch_${a}" class="colour-swatch-picker-ajax__message"></div>
							</td>`;e.find(".column-primary").after(c),r&&o.querySelectorAll(".iconic-was-group")&&e.find(".column-posts").after(`<td class="iconic-was-group column-iconic-was-group" data-colname="Group">${r}</td>`),e.find(".colour-swatch-picker-ajax").wpColorPicker(_.vars.picker_options),e.find(".wp-color-result-text").text(iconic_was_vars.i18n.select_colour)}})},setup_list_table_watch(){var t=o.querySelector(".edit-tags-php.post-type-product #posts-filter");t&&new MutationObserver(_.list_table_watch).observe(t,{childList:!0,attributes:!1,subtree:!0})}};n(o).ready(_.on_ready())})(jQuery,document);