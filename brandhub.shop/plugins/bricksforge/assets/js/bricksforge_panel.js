var brfPanel,bricksforgeData={panel:{timelines:[]}};class BricksforgePanel{domContentLoadedEvent;currentUserRole;roles;hideElementsOnly=!1;timelines=[];splitTextInstances=[];timelineActions=[];templateVars;constructor(e){e&&(this.domContentLoadedEvent=e),bricksforgeData||((bricksforgeData={}).panel={}),this.init()}async init(){this.setGlobals(),this.initTemplateVars(),"undefined"!=typeof BRFPANEL&&1==BRFPANEL.panelActivated&&(bricksIsFrontend||this.loadPanel(),setTimeout((()=>{this.renderPanel()}))),this.renderLogic(),this.hideElementsOnly&&this.handlePermissionSettings()}setGlobals(){if("undefined"!=typeof BRFPANEL&&(this.currentUserRole=BRFPANEL.currentUserRole,this.roles=BRFPANEL.permissions,this.roles&&Array.isArray(this.roles)))for(let e of this.roles)e.value==this.currentUserRole&&(this.hideElementsOnly=e.permissions.hideOnly)}initTemplateVars(){this.templateVars=["{eventType}","{eventTarget}","{eventTimestamp}","{eventCharCode}","{eventAltKey}","{eventCtrlKey}","{eventShiftKey}","{eventRepeat}","{eventKey}","{eventCode}","{eventLocation}","{eventButton}","{eventClientX}","{eventClientY}","{eventPageX}","{eventPageY}","{eventScreenX}","{eventScreenY}","{eventX}","{eventY}","{eventTouchCount}","{eventScale}","{eventRotation}","{eventTargetName}","{eventTargetType}","{eventTargetValue}","{eventTargetValidity}","{eventTargetChecked}","{eventTargetFilesCount}","{eventDataTransferTypesCount}","{eventDataTransferFilesCount}","{eventDataTransferText}","{windowScrollX}","{windowScrollY}","{windowInnerWidth}","{windowInnerHeight}","{windowOuterWidth}","{windowOuterHeight}","{eventTargetOffsetTop}","{eventTargetOffsetLeft}","{eventTargetOffsetWidth}","{eventTargetOffsetHeight}","{postId}"],bricksforgeData.panel.variables=this.templateVars}renderLogic(){document.addEventListener("click",(e=>{const t=e.target;t instanceof HTMLElement&&"BUTTON"==t.tagName&&t.parentNode&&"brf-render"==t.parentNode.getAttribute("controlkey")&&(e.preventDefault(),document.querySelector("li.reload-canvas").click())}))}loadPanel(){let e=document.createElement("div");e.setAttribute("id","bricksforge-triggers"),document.querySelector("#bricks-preview")&&document.querySelector("#bricks-preview").appendChild(e);let t=document.querySelector("#bricks-toolbar ul.group-wrapper.left"),a=document.createElement("li");a.classList.add("brf-panel"),a.setAttribute("data-balloon","Bricksforge Panel (Shortcut: CTRL + P)"),a.setAttribute("data-balloon-pos","bottom");let n=document.createElement("span");n.classList.add("bricks-svg-wrapper"),a.appendChild(n),t&&t.appendChild(a),setTimeout((()=>{document.querySelector("#bricksforge-triggers .brf-triggers-container")&&(document.querySelector("#bricksforge-triggers .brf-triggers-container").style.bottom="-"+document.querySelector("#bricksforge-triggers .brf-triggers-container").getAttribute("data-height"))}),500),a.addEventListener("click",(()=>{const e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});let t=document.querySelector("#bricksforge-triggers .brf-triggers-container");if(t.style.bottom&&1==t.style.opacity){if(t.style.bottom="-"+t.getAttribute("data-height"),t.style.opacity=0,e["brf-panel"]){const e=new URL(window.location.href);e.searchParams.delete("brf-panel"),window.history.replaceState(null,null,e),bricksforgeData.panel.isOpen=!1}}else if(t.style.bottom="-2px",t.style.opacity=1,!e["brf-panel"]){const e=new URL(window.location.href);e.searchParams.set("brf-panel","1"),window.history.replaceState(null,null,e),bricksforgeData.panel.isOpen=!0}}))}handlePermissionSettings(){document.addEventListener("mousedown",(e=>{let t=e.target;t&&(t.matches("li.elements")||t.closest("li")&&t.closest("li").classList.contains("elements"))&&setTimeout((()=>{this.hideCategories()}),250)})),setTimeout((()=>{this.hideCategories()}),750)}hideCategories(){for(let e of document.querySelectorAll("#bricks-panel-elements-categories .category")){if(!(e.classList.contains("category-layout")||e.classList.contains("category-basic")||e.classList.contains("category-general")||e.classList.contains("category-media")||e.classList.contains("category-wordpress")||e.classList.contains("category-single"))){let t=e.querySelector(".sortable-wrapper").querySelectorAll("li");for(let e of t)e.setAttribute("style","display:block !important");return}let t=e.querySelector(".sortable-wrapper").querySelectorAll("li"),a=!0;for(let e of t)"none"!=getComputedStyle(e).display&&(a=!1);a&&(e.style.display="none")}}renderPanel(e=!1,t=[],a=!1,n=!1){if(!BRFPANEL||!BRFPANEL.panel||!BRFPANEL.panel.length){if(n){this.timelines=[];for(let e of t)this.handleTimeline(e,!1,a);return}return}if(n){this.timelines=[];for(let e of t)this.handleTimeline(e,!1,!0);return}if(0==e&&bricksIsFrontend){let e=BRFPANEL.panel[0].instances;if(e&&e.length>0)for(let t of e){let e=this.checkInstanceConditions({data:t,trigger:t.selector?t.selector:null,target:null})&&!t.disabled;if(t.loadOnChoice&&"specificPages"==t.loadOnChoice&&t.loadOn&&""!=t.loadOn&&bricksIsFrontend){let e=t.loadOn.split(",");if(e=e.map((e=>e.trim())),!e.length)continue;const a=BRFPANEL.postId.toString();if(!e.includes(a))continue}e&&this.handleInstance(t)}}let i=BRFPANEL.panel[0].timelines;if(!0===e&&(this.timelines=[],i=[],i.push(t)),!0===a&&(this.timelines=[],i=[],i=t),i&&i.length>0){if("undefined"==typeof gsap)return void console.warn("Bricksforge Panel: You try to use timelines, but GSAP is not loaded.");for(let t of i)if(!t.disabled){if(t.loadOnChoice&&"specificPages"==t.loadOnChoice&&t.loadOn&&""!=t.loadOn&&bricksIsFrontend){let e=t.loadOn.split(",");if(e=e.map((e=>e.trim())),!e.length)continue;const a=BRFPANEL.postId.toString();if(!e.includes(a))continue}if(t.matchMedia&&bricksIsFrontend){gsap.matchMedia().add(t.matchMedia,(()=>{this.handleTimeline(t,e,a)}))}else this.handleTimeline(t,e,a);document.querySelectorAll(".brf-prevent-fouc")&&document.querySelectorAll(".brf-prevent-fouc").length&&document.querySelectorAll(".brf-prevent-fouc").forEach((e=>e.classList.remove("brf-prevent-fouc")))}}"undefined"!=typeof ScrollTrigger&&this.handleAnchorLinks()}handleAnchorLinks(){setTimeout((()=>{if(window.location.hash){let e=window.location.hash,t=document.querySelector(e);ScrollTrigger.refresh(),t&&"undefined"==typeof Lenis&&"undefined"==typeof ScrollSmoother&&t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}}),100)}checkInstanceConditions(e){let t=e.data;if(!t.conditions||!t.conditions.length)return!0;let a=t.conditionsRelation?t.conditionsRelation:"and",n=[];for(let a of t.conditions)switch(a.type){case"elementNode":if(!a.elementNodeSelector||!a.elementNodeSelector||!a.elementNodeOption){n.push(!1);break}let t=document.querySelector(this.handleTemplateVars(a.elementNodeSelector,{event:e.event}));if(!t){n.push(!1);break}switch(a.elementNodeOption){case"class":if(!a.elementNodeValue){n.push(!1);break}if("has"==a.elementNodeOperator){if(t.classList.contains(this.handleTemplateVars(a.elementNodeValue,{event:e.event}))){n.push(!0);break}n.push(!1);break}if("notHas"==a.elementNodeOperator){if(t.classList.contains(this.handleTemplateVars(a.elementNodeValue,{event:e.event}))){n.push(!1);break}n.push(!0);break}break;case"attribute":if(!a.elementNodeValue){n.push(!1);break}if(!a.elementNodeAttribute){n.push(!1);break}if("has"==a.elementNodeOperator){if(t.getAttribute(this.handleTemplateVars(a.elementNodeAttribute,{event:e.event}))==this.handleTemplateVars(a.elementNodeValue,{event:e.event})){n.push(!0);break}n.push(!1);break}if("notHas"==a.elementNodeOperator){if(t.getAttribute(this.handleTemplateVars(a.elementNodeAttribute,{event:e.event}))!=this.handleTemplateVars(a.elementNodeValue,{event:e.event})){n.push(!0);break}n.push(!1);break}}break;case"localStorage":if(!a.localStorageKey||!a.localStorageOperator){n.push(!1);break}switch(a.localStorageOperator){case"exists":n.push(null!=localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event})));break;case"notExists":n.push(!localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event})));break;case"==":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))==this.handleTemplateVars(a.localStorageValue,{event:e.event}));break;case"!=":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))!=this.handleTemplateVars(a.localStorageValue,{event:e.event}));break;case">":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))>parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case"<":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))<parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case">=":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))>=parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case"<=":n.push(localStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))<=parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})))}break;case"sessionStorage":if(!a.localStorageKey||!a.localStorageOperator){n.push(!1);break}switch(a.localStorageOperator){case"exists":n.push(null!=sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event})));break;case"notExists":n.push(!sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event})));break;case"==":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))==this.handleTemplateVars(a.localStorageValue,{event:e.event}));break;case"!=":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))!=this.handleTemplateVars(a.localStorageValue,{event:e.event}));break;case">":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))>parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case"<":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))<parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case">=":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))>=parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})));break;case"<=":n.push(sessionStorage.getItem(this.handleTemplateVars(a.localStorageKey,{event:e.event}))<=parseInt(this.handleTemplateVars(a.localStorageValue,{event:e.event})))}break;case"custom":if(!a.customCondition){n.push(!1);break}let i=e.trigger?e.trigger:null,r=e.target?e.target:null,o=e.event?e.event:null,s=new Function("return ((trigger, target, event) => {return "+a.customCondition+"})")();if("function"!=typeof s){n.push(!1);break}n.push(!0===s(i,r,o))}if(!n.length)return!1;switch(a){case"and":return!n.includes(!1);case"or":return n.includes(!0);default:return!1}}async handleInstance(e){if(!e.event||!e.selector||!e.actions.length){if(!e.selector&&"pageLoad"!=e.event&&!e.selector&&"scrollPosition"!=e.event&&"scrollUp"!=e.event&&"scrollDown"!=e.event&&"visibilitychange"!=e.event&&"resize"!=e.event&&"sliderMove"!=e.event&&"sliderMoved"!=e.event&&"sliderVisible"!=e.event&&"sliderHidden"!=e.event&&"sliderClick"!=e.event&&"sliderResize"!=e.event&&"sliderResized"!=e.event&&"sliderDrag"!=e.event&&"sliderDragging"!=e.event&&"sliderDragged"!=e.event&&"sliderOverflow"!=e.event)return void console.warn("You try to use the Bricksforge Panel, but there are some informations missing. This warning appears for the instance: "+(e.name?e.name:"No Name"));e.selector="html"}let t,a=e.selector,n=!1,i=e.event,r=e.actions,o=!!e.delay&&e.delay;switch(o&&await this.wait(o),e.selectorType){case"exactly":default:a=document.querySelector(a);break;case"all":a=document.querySelectorAll(a),n=!0;break;case"siblings":a=document.querySelector(a).parentNode.children,n=!0;break;case"parent":a=document.querySelector(a).parentNode;break;case"children":a=document.querySelector(a).children,n=!0;break;case"closest":if(!e.closestValue)break;a=document.querySelector(a).closest(e.closestValue)}if(null!=a)for(let o of r)switch(i){case"scrollPosition":document.addEventListener("scroll",(t=>{if(e.consoleLog&&"event"==e.consoleLog&&console.log(t),!e.scrollPosition||!e.scrollPositionOperator)return;let n;switch(e.scrollPositionOperator){case"==":default:n=window.scrollY==e.scrollPosition;break;case">":n=window.scrollY>e.scrollPosition;break;case"<":n=window.scrollY<e.scrollPosition;break;case">=":n=window.scrollY>=e.scrollPosition;break;case"<=":n=window.scrollY<=e.scrollPosition}n&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o})}));break;case"scrollUp":var s=0;document.addEventListener("scroll",(t=>{var n=window.pageYOffset||document.documentElement.scrollTop;n<s&&(e.consoleLog&&"event"==e.consoleLog&&console.log(t),r.forEach((n=>{this.fireAction({action:n.action.value,selector:a,instance:e,actionData:n.action,event:t,actionDataRaw:n})}))),s=n<=0?0:n}),!1);break;case"scrollDown":s=0;document.addEventListener("scroll",(t=>{var n=window.scrollY||document.documentElement.scrollTop;n>s&&(e.consoleLog&&"event"==e.consoleLog&&console.log(t),r.forEach((n=>{this.fireAction({action:n.action.value,selector:a,instance:e,actionData:n.action,event:t,actionDataRaw:n})}))),s=n<=0?0:n}),!1);break;case"inViewport":if(!a)return;document.addEventListener("scroll",(t=>{if(n)a.forEach((a=>{var n=a.getBoundingClientRect(),i=n.top,r=n.bottom;let s=e.inViewportVisibility?e.inViewportVisibility:"partially",l=e.inViewportVisibilityOffset?e.inViewportVisibilityOffset:0;("partially"==s?i<window.innerHeight-l&&r>=0:i>=0&&r<=window.innerHeight+l)&&(e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o}))}));else{var i=a.getBoundingClientRect(),r=i.top,s=i.bottom;let n=e.inViewportVisibility?e.inViewportVisibility:"partially",l=e.inViewportVisibilityOffset?e.inViewportVisibilityOffset:0;("partially"==n?r<window.innerHeight-l&&s>=0:r>=0&&s<=window.innerHeight+l)&&(e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o}))}}));break;case"notInViewport":if(!a)return;document.addEventListener("scroll",(t=>{if(n)a.forEach((a=>{var n=a.getBoundingClientRect(),i=n.top,r=n.bottom;i<window.innerHeight&&r>=0||(e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o}))}));else{var i=a.getBoundingClientRect(),r=i.top,s=i.bottom;r<window.innerHeight&&s>=0||(e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o}))}}));break;case"pageLoad":this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:this.domContentLoadedEvent,actionDataRaw:o});break;case"visibilitychange":document.addEventListener("visibilitychange",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),e.visibilityState&&document.visibilityState==e.visibilityState&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o})}));break;case"resize":window.addEventListener("resize",(t=>{if(e.consoleLog&&"event"==e.consoleLog&&console.log(t),e.resizeDimension&&e.resizeOperator&&e.resizeValue)switch(e.resizeOperator){case"==":"width"==e.resizeDimension&&window.innerWidth==e.resizeValue&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o}),"height"==e.resizeDimension&&window.innerHeight==e.resizeValue&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o});break;case">":"width"==e.resizeDimension&&window.innerWidth>e.resizeValue&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o}),"height"==e.resizeDimension&&window.innerHeight>e.resizeValue&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o});break;case"<":"width"==e.resizeDimension&&window.innerWidth<e.resizeValue&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o}),"height"==e.resizeDimension&&window.innerHeight<e.resizeValue&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o});break;case">=":"width"==e.resizeDimension&&window.innerWidth>=e.resizeValue&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o}),"height"==e.resizeDimension&&window.innerHeight>=e.resizeValue&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o});break;case"<=":"width"==e.resizeDimension&&window.innerWidth<=e.resizeValue&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o}),"height"==e.resizeDimension&&window.innerHeight<=e.resizeValue&&this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o});break;default:this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o})}else this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o})}));break;case"resizeObserver":if(!a)return;new ResizeObserver((t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o})})).observe(a);break;case"mutationObserver":if(!a)return;if(n)a.forEach((t=>{let a=!!e.mutationObserverAttributes&&e.mutationObserverAttributes,n=!!e.mutationObserverChildList&&e.mutationObserverChildList,i=!!e.mutationObserverCharacterData&&e.mutationObserverCharacterData,r=!!e.mutationObserverSubTree&&e.mutationObserverSubTree;new MutationObserver((a=>{e.consoleLog&&"event"==e.consoleLog&&console.log(a),this.fireAction({action:o.action.value,selector:t,instance:e,actionData:o.action,event:a,actionDataRaw:o})})).observe(t,{attributes:a,childList:n,characterData:i,subtree:r})}));else{let t=!!e.mutationObserverAttributes&&e.mutationObserverAttributes,n=!!e.mutationObserverChildList&&e.mutationObserverChildList,i=!!e.mutationObserverCharacterData&&e.mutationObserverCharacterData,r=!!e.mutationObserverSubTree&&e.mutationObserverSubTree;new MutationObserver((t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,actionData:o.action,event:t,actionDataRaw:o})})).observe(a,{attributes:t,childList:n,characterData:i,subtree:r})}break;case"sliderMove":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("move",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;case"sliderMoved":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("moved",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;case"sliderVisible":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("visible",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;case"sliderHidden":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("hidden",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;case"sliderClick":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("click",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;case"sliderResize":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("resize",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;case"sliderResized":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("resized",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;case"sliderDrag":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("drag",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;case"sliderDragging":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("dragging",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;case"sliderDragged":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("dragged",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;case"sliderOverflow":if(t=await this.handleSliderEvent(e.sliderId),!t)break;t.on("overflow",(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;case"custom":if(!e.customEventName)break;if(n){Array.prototype.forEach.call(a,(t=>{t.addEventListener(e.customEventName,(a=>{e.consoleLog&&"event"==e.consoleLog&&console.log(a),this.fireAction({action:o.action.value,selector:t,instance:e,event:a,actionData:o.action,actionDataRaw:o})}))}));break}a.addEventListener(e.customEventName,(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}));break;default:if(n){Array.prototype.forEach.call(a,(t=>{t.addEventListener(i,(a=>{e.consoleLog&&"event"==e.consoleLog&&console.log(a),e.preventDefault&&a.preventDefault(),this.fireAction({action:o.action.value,selector:t,instance:e,event:a,actionData:o.action,actionDataRaw:o})}))}));break}a.addEventListener(i,(t=>{e.consoleLog&&"event"==e.consoleLog&&console.log(t),e.preventDefault&&t.preventDefault(),this.fireAction({action:o.action.value,selector:a,instance:e,event:t,actionData:o.action,actionDataRaw:o})}))}else console.warn("Bricksforge Panel: Selector not found: "+e.selector)}handleTemplateVars(e,t){if(!e)return e;if(!e.includes("{"))return e;[{name:"{eventType}",value:t.event?t.event.type:""},{name:"{eventTarget}",value:t.event?t.event.target.toString():""},{name:"{eventTimestamp}",value:t.event?t.event.timeStamp:""},{name:"{eventCharCode}",value:t.event&&"keypress"===t.event.type?t.event.charCode:""},{name:"{eventAltKey}",value:t.event?t.event.altKey:""},{name:"{eventCtrlKey}",value:t.event?t.event.ctrlKey:""},{name:"{eventShiftKey}",value:t.event?t.event.shiftKey:""},{name:"{eventRepeat}",value:t.event?t.event.repeat:""},{name:"{eventKey}",value:t.event?t.event.key:""},{name:"{eventCode}",value:t.event?t.event.code:""},{name:"{eventLocation}",value:!t.event||"keydown"!==t.event.type&&"keyup"!==t.event.type?"":t.event.location},{name:"{eventButton}",value:t.event?t.event.button:""},{name:"{eventClientX}",value:t.event?t.event.clientX:""},{name:"{eventClientY}",value:t.event?t.event.clientY:""},{name:"{eventPageX}",value:t.event?t.event.pageX:""},{name:"{eventPageY}",value:t.event?t.event.pageY:""},{name:"{eventScreenX}",value:t.event?t.event.screenX:""},{name:"{eventScreenY}",value:t.event?t.event.screenY:""},{name:"{eventX}",value:t.event?t.event.x:""},{name:"{eventY}",value:t.event?t.event.y:""},{name:"{eventTouchCount}",value:t.event&&t.event.touches?t.event.touches.length:""},{name:"{eventScale}",value:t.event&&t.event.scale?t.event.scale:""},{name:"{eventRotation}",value:t.event&&t.event.rotation?t.event.rotation:""},{name:"{eventTargetName}",value:t.event&&t.event.target?t.event.target.name:""},{name:"{eventTargetType}",value:t.event&&t.event.target?t.event.target.type:""},{name:"{eventTargetValue}",value:t.event&&t.event.target?t.event.target.value:""},{name:"{eventTargetValidity}",value:t.event&&t.event.target&&t.event.target.validity?t.event.target.validity.valid?"valid":"invalid":""},{name:"{eventTargetChecked}",value:t.event&&t.event.target&&("checkbox"===t.event.target.type||"radio"===t.event.target.type)?t.event.target.checked:""},{name:"{eventTargetFilesCount}",value:t.event&&t.event.target&&"file"===t.event.target.type&&t.event.target.files?t.event.target.files.length:""},{name:"{eventDataTransferTypesCount}",value:t.event&&t.event.dataTransfer?t.event.dataTransfer.types.length:""},{name:"{eventDataTransferFilesCount}",value:t.event&&t.event.dataTransfer?t.event.dataTransfer.files.length:""},{name:"{eventDataTransferText}",value:t.event&&t.event.dataTransfer&&t.event.dataTransfer.types.indexOf("text/plain")>=0?t.event.dataTransfer.getData("text/plain"):""},{name:"{windowScrollX}",value:window.scrollX},{name:"{windowScrollY}",value:window.scrollY},{name:"{windowInnerWidth}",value:window.innerWidth},{name:"{windowInnerHeight}",value:window.innerHeight},{name:"{windowOuterWidth}",value:window.outerWidth},{name:"{windowOuterHeight}",value:window.outerHeight},{name:"{eventTargetOffsetTop}",value:t.event&&t.event.target?t.event.target.offsetTop:""},{name:"{eventTargetOffsetLeft}",value:t.event&&t.event.target?t.event.target.offsetLeft:""},{name:"{eventTargetOffsetWidth}",value:t.event&&t.event.target?t.event.target.offsetWidth:""},{name:"{eventTargetOffsetHeight}",value:t.event&&t.event.target?t.event.target.offsetHeight:""},{name:"{postId}",value:bricksData?bricksData.postId:""}].forEach((t=>{e=e.replace(t.name,t.value)}));const a=e.match(/{event:(.*?)}/);if(a){const n=a[1].split(/\.|:/).reduce(((e,t)=>e instanceof HTMLElement&&"value"===t?e.value:e&&void 0!==e[t]?e[t]:void 0),t.event);void 0!==n&&(e=e.replace(a[0],n))}return e}getTargetElement(e,t,a,n,i){let r=!1;switch(t&&(t=this.handleTemplateVars(t,{event:i})),e){case"same":if(!a)break;e=i.target;break;case"triggered":e="triggered";break;case"all":if(!a)break;e=document.querySelectorAll(n.selector),r=!0;break;case"siblings":if(!a)break;e=i.target.parentNode.children,r=!0;break;case"parent":if(!a)break;e=i.target.parentNode;break;case"children":if(!a)break;e=i.target.children,r=!0;break;case"closest":if(!a)break;if(!e)break;e=i.target.closest(t);break;case"querySelector":if(!a)break;e=i.target.closest(n.selector).querySelector(t);break;case"custom":e=document.querySelector(t);break;case"customAll":e=document.querySelectorAll(t),r=!0;break;case"window":e=window;break;default:if(!a)break;e=document.querySelector(n.selector)}return[e,r]}async fireAction(e){let t=e.instance,a=e.action,n=e.actionData,i=e.selector,r=!!e.event&&e.event.target,o=e.actionDataRaw,s=!!n.delay&&n.delay;const l=this.getTargetElement(n.target,n.targetElement,i,t,e.event);let c=l[0],d=l[1];if(!a||!i||!c)return;if(o.conditions&&o.conditions.length>0){if(!this.checkInstanceConditions({data:o,trigger:i,target:c,event:e.event}))return}s&&await this.wait(s);let u=n.except&&"none"!=n.except,g=!!n.exceptSelector&&n.exceptSelector,v=r;switch(u&&!1!==g&&r&&r!=document.querySelector(g)&&(v=r.closest(g)),"triggered"==c&&(c=r!=document.querySelector(t.selector)?r.closest(t.selector):document.querySelector(t.selector)),a){case"show":if(d)for(let t of c)u&&v==t||(t.style.display=n.display?this.handleTemplateVars(n.display,{event:e.event}):"block");else c.style.display=n.display?this.handleTemplateVars(n.display,{event:e.event}):"block";break;case"hide":if(d)for(let e of c)u&&v==e||(e.style.display="none");else c.style.display="none";break;case"addClass":if(!n.cssClass)break;if(d)for(let t of c)u&&v==t||t.classList.add(this.handleTemplateVars(n.cssClass,{event:e.event}));else c.classList.add(this.handleTemplateVars(n.cssClass,{event:e.event}));break;case"removeClass":if(!n.cssClass)break;if(d)for(let t of c)u&&v==t||t.classList.remove(this.handleTemplateVars(n.cssClass,{event:e.event}));else c.classList.remove(this.handleTemplateVars(n.cssClass,{event:e.event}));break;case"toggleClass":if(!n.cssClass)break;if(d)for(let t of c)u&&v==t||t.classList.toggle(this.handleTemplateVars(n.cssClass,{event:e.event}));else c.classList.toggle(this.handleTemplateVars(n.cssClass,{event:e.event}));break;case"setAttribute":if(!n.attributeKey||!n.attributeValue)break;if(d)for(let t of c)u&&v==t||t.setAttribute(this.handleTemplateVars(n.attributeKey,{event:e.event}),this.handleTemplateVars(n.attributeValue,{event:e.event}));else c.setAttribute(this.handleTemplateVars(n.attributeKey,{event:e.event}),this.handleTemplateVars(n.attributeValue,{event:e.event}));break;case"removeAttribute":if(!n.attributeKeyRemoval)break;if(d)for(let t of c)u&&v==t||t.removeAttribute(this.handleTemplateVars(n.attributeKeyRemoval,{event:e.event}));else c.removeAttribute(this.handleTemplateVars(n.attributeKeyRemoval,{event:e.event}));break;case"innerText":if(!n.innerText)break;if(d)for(let t of c)u&&v==t||(t.innerText=this.handleTemplateVars(n.innerText,{event:e.event}));else c.innerText=this.handleTemplateVars(n.innerText,{event:e.event});break;case"gsap":if("pageLoad"==t.event&&await this.wait(0),!n.animationAction||!n.animationTimeline)return;let a=n.animationAction,o=n.animationTimeline,s=n.animationSelectorType?n.animationSelectorType:"all",l=null!=n.animationTimeScale?n.animationTimeScale:1,g=[];"all"==s&&(g=this.timelines.filter((e=>e.id==o))),"trigger"==s&&(g=this.timelines.filter((e=>{let t=[...r.getElementsByTagName("*")].includes(e.trigger),a=e.trigger.contains(r);return!(e.id!=o||e.trigger!=r&&!t&&!a)}))),g.forEach((e=>{let t=e.tl;switch(1!=l&&t.timeScale(l),a){case"play":t.play();break;case"pause":t.pause();break;case"restart":t.restart();break;case"resume":t.resume();break;case"reverse":t.reverse()}}));break;case"jsFunction":if(!n.jsFunctionName)return;let p=e.event,h=n.jsFunctionName,m=new Function("return (async (trigger, event, timelines, getTimeline) => {"+h+"})")();"function"==typeof m&&(async()=>{const e=await this.getTimelines();await m(i,p,e,(async e=>await this.getTimelineById(e)))})();break;case"ajaxFunction":if(!n.ajaxFunctionName)return;const f=BRFPANEL.ajaxurl,b=this.handleTemplateVars(n.ajaxFunctionName,{event:e.event}),y=this.handleTemplateVars(n.ajaxFunctionLiveUpdateSelector,{event:e.event}),w=n.ajaxFunctionLiveUpdateInsertMethod??"innerHTML",k=n.ajaxFunctionDebug;let S=n.ajaxFunctionData,T={};T.action=b,T.nonce=BRFPANEL.ajaxNonce,S&&S.length>0&&S.forEach((t=>{T[this.handleTemplateVars(t.key,{event:e.event})]=this.handleTemplateVars(t.value,{event:e.event})}));try{let e=await fetch(f,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"same-origin",body:new URLSearchParams(T).toString()}),t=await e.json();if(t&&t.data){const e=t.data.message??!1;if(k&&console.log("Bricksforge Ajax Response",t.data),e&&y){const t=document.querySelector(y);if(t)switch(w){case"innerHTML":t.innerHTML=e;break;case"appendHTML":t.insertAdjacentHTML("beforeend",e);break;case"prependHTML":t.insertAdjacentHTML("afterbegin",e);break;case"innerText":t.innerText=e;break;case"append":t.append(e);break;case"prepend":t.prepend(e)}}}}catch(e){console.log(e)}break;case"sendEmail":if(!e.actionData.emailDesignerTemplate)return void console.warn("No email designer template selected");if(window.bricksforgeData.lastSentEmail&&window.bricksforgeData.lastSentEmail>Date.now()-1e3)return;const D=e.actionData.emailDesignerTemplate,L=BRFPANEL.ajaxurl,V="bricksforge_send_mail";let I={};I.action=V,I.nonce=BRFPANEL.ajaxNonce,I.template=D,e.actionData.mailTo&&(I.to=this.handleTemplateVars(e.actionData.mailTo,{event:e.event})),e.actionData.mailSubject&&(I.subject=this.handleTemplateVars(e.actionData.mailSubject,{event:e.event})),e.actionData.mailMessage&&(I.message=this.handleTemplateVars(e.actionData.mailMessage,{event:e.event}));try{200==(await fetch(L,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"same-origin",body:new URLSearchParams(I).toString()})).status&&(window.bricksforgeData.lastSentEmail=Date.now())}catch(e){console.log(e)}break;case"updateOption":if(!n.optionName||!n.optionValue)return;let A=this.handleTemplateVars(n.optionName,{event:e.event}),C=this.handleTemplateVars(n.optionValue,{event:e.event}),E=!!n.ajaxFunctionLiveUpdateSelector&&n.ajaxFunctionLiveUpdateSelector;const R=n.ajaxFunctionLiveUpdateInsertMethod?n.ajaxFunctionLiveUpdateInsertMethod:"replaceText",F=BRFPANEL.ajaxurl;let O={action:"bricksforge_update_option"};O.nonce=BRFPANEL.ajaxNonce,O.option_name=A,O.option_value=C;try{let e=await fetch(F,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"same-origin",body:new URLSearchParams(O).toString()});if(200==e.status&&E){if(E=document.querySelector(E),!E)return;let t=await e.json();if(t=t.data.message??!1,!t)return;switch(R){case"innerHTML":E.innerHTML=t;break;case"appendHTML":E.insertAdjacentHTML("beforeend",t);break;case"prependHTML":E.insertAdjacentHTML("afterbegin",t);break;case"innerText":E.innerText=t;break;case"append":E.append(t);break;case"prepend":E.prepend(t)}}}catch(e){console.log(e)}break;case"deleteOption":if(!n.optionName)return;let N=this.handleTemplateVars(n.optionName,{event:e.event});const P=BRFPANEL.ajaxurl;let x={action:"bricksforge_delete_option"};x.nonce=BRFPANEL.ajaxNonce,x.option_name=N;try{await fetch(P,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"same-origin",body:new URLSearchParams(x).toString()})}catch(e){console.error(e)}break;case"gsapFlip":if(!c)break;gsap.registerPlugin(Flip);let q=e.actionData.flipStylesProps?e.actionData.flipStylesProps:"",j=e.actionData.flipEase?e.actionData.flipEase:"power1.inOut",B=e.actionData.flipDuration?e.actionData.flipDuration:1,K=!!e.actionData.flipIncludeChildren&&e.actionData.flipIncludeChildren,H=!!e.actionData.flipAbsolute&&e.actionData.flipAbsolute;if(d)for(let t of c){if(u&&v==t)continue;const a=Flip.getState(1==K?[t,...t.children]:t,{props:q});if(c.style.setProperty("transition","none"),K)for(let e of c.children)e.style.setProperty("transition","none");switch(e.actionData.flipStylesInput){case"custom":if(!e.actionData.flipStylesCode)break;let a=new Function("return ((trigger, target, event) => {"+e.actionData.flipStylesCode+"})")();"function"==typeof a&&a(i,t,e.event);break;case"removeClass":if(!e.actionData.flipStylesInputClassName)return;t.classList.remove(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"addClass":if(!e.actionData.flipStylesInputClassName)return;t.classList.add(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"toggleClass":if(!e.actionData.flipStylesInputClassName)return;t.classList.toggle(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"appendTo":if(!e.actionData.flipStylesInputDOMElement)return;document.querySelector(this.handleTemplateVars(e.actionData.flipStylesInputDOMElement,{event:e.event})).append(t)}Flip.from(a,{duration:B,ease:j,absolute:H,nested:!0})}else{const t=Flip.getState(1==K?[c,...c.children]:c,{props:q});if(c.style.setProperty("transition","none"),K)for(let e of c.children)e.style.setProperty("transition","none");switch(e.actionData.flipStylesInput){case"custom":if(!e.actionData.flipStylesCode)break;let t=new Function("return ((trigger, target, event) => {"+e.actionData.flipStylesCode+"})")();"function"==typeof t&&t(i,c,e.event);break;case"removeClass":if(!e.actionData.flipStylesInputClassName)return;c.classList.remove(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"addClass":if(!e.actionData.flipStylesInputClassName)return;c.classList.add(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"toggleClass":if(!e.actionData.flipStylesInputClassName)return;c.classList.toggle(this.handleTemplateVars(e.actionData.flipStylesInputClassName,{event:e.event}));break;case"appendTo":if(!e.actionData.flipStylesInputDOMElement)return;document.querySelector(this.handleTemplateVars(e.actionData.flipStylesInputDOMElement,{event:e.event})).append(c)}Flip.from(t,{duration:B,ease:j,absolute:H})}break;case"gsapSet":if(!c)break;if(d)for(let t of c){let a=this.handleTemplateVars(n.gsapSetObject,{event:e.event}),r=new Function("return (trigger, target, event) => { return "+a+" }")();gsap.set(c,"function"==typeof r?r(i,t,e.event):{})}else{let t=this.handleTemplateVars(n.gsapSetObject,{event:e.event}),a=new Function("return (trigger, target, event) => { return "+t+" }")();gsap.set(c,"function"==typeof a?a(i,c,e.event):{})}break;case"gsapTo":if(!c)break;if(d)for(let t of c){let a=this.handleTemplateVars(n.gsapSetObject,{event:e.event}),r=new Function("return (trigger, target, event) => { return "+a+" }")();gsap.to(c,"function"==typeof r?r(i,t,e.event):{})}else{let t=this.handleTemplateVars(n.gsapSetObject,{event:e.event}),a=new Function("return (trigger, target, event) => { return "+t+" }")();gsap.to(c,"function"==typeof a?a(i,c,e.event):{})}break;case"video_self_hosted_play":if(!c)break;if(d)for(let e of c)u&&v==e||e.play();else c.play();break;case"video_self_hosted_pause":if(!c)break;if(d)for(let e of c)u&&v==e||e.pause();else c.pause();break;case"video_self_hosted_stop":if(!c)break;if(d)for(let e of c)u&&v==e||(e.pause(),e.currentTime=0);else c.pause(),c.currentTime=0;break;case"storageSetItem":if(!e.actionData.storageItemKey||!e.actionData.storageItemValue)break;localStorage.setItem(this.handleTemplateVars(e.actionData.storageItemKey,{event:e.event}),this.handleTemplateVars(e.actionData.storageItemValue,{event:e.event}));break;case"storageRemoveItem":if(!e.actionData.storageItemKey)break;localStorage.removeItem(this.handleTemplateVars(e.actionData.storageItemKey,{event:e.event}));break;case"sessionStorageSetItem":if(!e.actionData.storageItemKey||!e.actionData.storageItemValue)break;sessionStorage.setItem(this.handleTemplateVars(e.actionData.storageItemKey,{event:e.event}),this.handleTemplateVars(e.actionData.storageItemValue,{event:e.event}));break;case"sessionStorageRemoveItem":if(!e.actionData.storageItemKey)break;sessionStorage.removeItem(this.handleTemplateVars(e.actionData.storageItemKey,{event:e.event}));break;case"syncSliders":let M=e.actionData.syncSliderData;if(!M||!M.length){console.warn('Bricksforge Panel: You try to use "syncSliders" action, but we found no data for it.');break}for(let e of M){let t=e.slider1,a=e.slider2;t&&a&&(t=bricksData.splideInstances[t],a=bricksData.splideInstances[a],t&&a&&t.sync(a))}break;case"populateFormField":let z=e.actionData.formFieldValue;if(!z)break;if(z=this.handleTemplateVars(z,{event:e.event}),d){for(let e of c)if(!u||v!=e){if(c=this.findFormField(c),!c)break;e.value=z}}else{if(c=this.findFormField(c),!c)break;c.value=z}}}findFormField(e){const t=["input","select","textarea"];for(let a of t){let t=e.querySelector(a)||e.closest(a);if(t)return t}return null}handleTimeline(e,t=!1,a=!1){bricksIsFrontend||gsap.config({nullTargetWarn:!1}),e.animations&&e.animations.length||!bricksIsFrontend||console.warn("Bricksforge Panel: You try to use timelines, but we found no animations for it. This warning appears for the timeline: "+e.name);let n=e.repeat?parseInt(e.repeat):0,i=e.repeatDelay?parseInt(e.repeatDelay):0,r=e.trigger?e.trigger:"scrollTrigger",o=e.triggerSelector?e.triggerSelector:"",s=!!e.animateTrigger&&e.animateTrigger,l=null!=e.scrub&&e.scrub,c=null!=e.scrubValue?e.scrubValue:1,d=e.scrollStart?e.scrollStart:"top bottom",u=e.scrollEnd?e.scrollEnd:"bottom top",g=null!=e.pin&&e.pin,v=!e.pinSelector||e.pinSelector,p=null!=e.pinSpacing&&e.pinSpacing,h=null!=e.markers&&e.markers,m=null!=e.stagger&&e.stagger,f=e.staggerAmount?e.staggerAmount:.2,b=e.staggerFrom?e.staggerFrom:"start",y=e.staggerEase?e.staggerEase:"linear",w=e.toggleActions?e.toggleActions:"play none none none",k=null!=e.snap&&e.snap,S=!!e.snapTo&&e.snapTo,T=null!=e.automaticSnap&&e.automaticSnap,D=e.automaticSnapSelector?e.automaticSnapSelector:"",L=e.snapDuration?e.snapDuration:.3,V=e.snapDelay?e.snapDelay:.1,I=e.snapEase?e.snapEase:"power1.inOut",A=!!e.toggleClass&&e.toggleClass,C=e.toggleClassTargets?e.toggleClassTargets:"",E=e.toggleClassClassName?e.toggleClassClassName:"",R=null!=e.batch&&e.batch,F=null!=e.withSecondaryClick&&e.withSecondaryClick,O=null!=e.reverseWhenClickingOutside&&e.reverseWhenClickingOutside,N=null!=e.reverseTimescale?e.reverseTimescale:1,P=null!=e.withSecondaryMouseLeave&&e.withSecondaryMouseLeave,x=null!=e.excludeAnimationLayers&&e.excludeAnimationLayers,q=null!=e.yoyo&&e.yoyo,j=null!=e.excludedSelectors?e.excludedSelectors:"";if(j=j&&"string"==typeof j?j.split(","):[],"scrollTrigger"===r)bricksIsFrontend&&(gsap.registerPlugin(ScrollTrigger),ScrollTrigger.config({ignoreMobileResize:!0}));if(gsap.plugins.drawSVG&&gsap.registerPlugin(DrawSVGPlugin),!o||"."==o||!this.isValidSelector(o)){if("custom"!=r)return;o="html"}gsap.utils.toArray(o).forEach((async(B,K)=>{if(R&&(s=!1,K>=1))return;const H=gsap.timeline({repeat:n,repeatDelay:i,yoyo:q,..."scrollTrigger"==r&&e.animations.length&&bricksIsFrontend&&!R&&{scrollTrigger:{...1==A&&{toggleClass:{targets:C,className:E}},trigger:B,markers:h,start:d,...1==k&&{snap:{snapTo:(()=>{if(null==T||!T||!D)return S;return 1/(gsap.utils.toArray(D).length-1)})(),duration:L,delay:V,ease:I}},toggleActions:w,end:u,...1==l&&{scrub:c},...1==g&&v&&{pin:v||!0,pinSpacing:p},onRefresh:e=>this.handleRefresh(e)}}});if(!0===a&&H.pause(),"custom"!=r&&"click"!=r&&"hover"!=r||H.pause(),"click"==r&&(B.addEventListener("click",(e=>{for(let t of j)if(e.target.closest(t)||e.target==document.querySelector(t))return;e.preventDefault(),H.timeScale(1),H.reversed()||!0!==F||0==H.progress()?0!=H.progress()&&1!=H.progress()?H.play():H.restart():(1!=N&&H.timeScale(N),H.reverse())})),O)){const t=[];if(t.push(B),!0===x)for(let a of e.animations)if(a.selector&&document.querySelectorAll(a.selector).forEach((e=>{t.push(e)})),a.childSelector){document.querySelector(a.selector).querySelectorAll(a.childSelector).forEach((e=>{t.push(e)}))}document.addEventListener("click",(e=>{for(let a of t)if(a.contains(e.target)||a==e.target)return;H.reversed()||H.paused()||(1!=N&&H.timeScale(N),H.reverse())}))}"hover"==r&&(B.addEventListener("mouseenter",(e=>{for(let t of j)if(e.target.closest(t)||e.target==document.querySelector(t))return;H.timeScale(1),0!=H.progress()&&1!=H.progress()?H.play():H.restart()})),!0===P&&B.addEventListener("mouseleave",(()=>{1!=N&&H.timeScale(N),H.reverse()})));for(let n of e.animations){if(!(!0!==a||n.selector&&"."!=n.selector&&document.querySelector(n.selector))){if(bricksIsFrontend)continue}if(!n.selector&&!1===s){bricksIsFrontend&&console.warn("Bricksforge Panel: You try to use timeline animations, but we found no selector for it. This warning appears for the timeline: "+e.name);continue}if("."==n.selector&&!1===s||!1===s&&!document.querySelector(n.selector))continue;if(!(n.data&&""!=n.data||n.controls&&0!==Object.keys(n.controls).length)&&bricksIsFrontend){console.warn("Bricksforge Panel: You try to use timeline animations, but we found no animation data for it. This warning appears for the timeline: "+e.name);continue}const i=bricksIsFrontend?document:window.parent.document.querySelector("#bricks-builder-iframe").contentDocument,r=bricksIsFrontend?0:150;setTimeout((()=>{if(i.querySelector(n.selector)){if(i.querySelectorAll(n.selector).length>50)return;i.querySelectorAll(n.selector).forEach((e=>{if(e.classList.add("brf-reset-transition"),n.childSelector){let e=i.querySelector(n.selector);if(e.querySelectorAll(n.childSelector).length>50)return;e.querySelectorAll(n.childSelector).forEach((e=>{e.classList.add("brf-reset-transition")}))}}))}}),r);let T=n.controls?n.controls:{};Object.keys(T).forEach((e=>{null===T[e]&&delete T[e]}));let D,F=n.controls2?n.controls2:{};Object.keys(F).forEach((e=>{null===F[e]&&delete F[e]}));try{D=new Function("return (triggerSelector, target, trigger) => {return "+n.data.replace(/cssVar\((.*?)\)/g,((e,t)=>this.cssVar(t.trim())))+"}")(this)}catch(e){if(D=new Function,bricksIsFrontend)continue}try{D(o,n.selector,B)}catch(t){if(D=new Function,console.warn("Bricksforge Panel: You try to use timeline animations, but your Animation data object seems to be wrong. This warning appears for the timeline: "+e.name),bricksIsFrontend)continue}let O,N,P=D(o,n.selector,B),x=n.duration?n.duration:.5,q=n.delay?n.delay:0,j=n.position?n.position:">",K=null!=typeof n.customPosition?n.customPosition:">",M=n.ease?n.ease:"linear",z=!!n.splitText&&n.splitText,Y=n.splitTextType?n.splitTextType:"chars",U=!!n.stagger&&n.stagger,_=n.staggerValue?n.staggerValue:.02,W=null!=n.yoyo&&n.yoyo,X=n.repeat?n.repeat:0;switch(j){case"<":case">":O=j;break;case"custom":O=this.isNumeric(K)?parseFloat(K):K;break;default:O=">"}if(!0===t&&gsap.set(n.selector,{clearProps:"all"}),!0===s&&o)if(n.childSelector){const e=B.querySelectorAll(n.childSelector);!1===t&&gsap.set(e,{clearProps:"all"}),N=e}else N=B;else N=n.selector;if(N||(N=".brf-dummy"),bricksIsFrontend||H.pause(),!0===z){let e;gsap.registerPlugin(SplitText);let t=this.splitTextInstances.find((e=>e.id==n.id)),a=n.splitTextType;switch("chars"==a&&(a="words, chars"),bricksIsFrontend?e=new SplitText(N,{type:a,charsClass:"brf-split brf-split-chars",linesClass:"brf-split brf-split-lines",wordsClass:"brf-split brf-split-words",tag:"chars"==n.splitTextType?"span":"div"}):(t?e=t:(e=this.splitTextInstances.push({id:n.id,type:a,animation:n.id,data:new SplitText(N,{type:n.splitTextType,charsClass:"brf-split brf-split-chars",linesClass:"brf-split brf-split-lines",wordsClass:"brf-split brf-split-words",tag:"chars"==n.splitTextType?"span":"div"})}),e=this.splitTextInstances.find((e=>e.id==n.id))),e=e.data),Y){case"chars":N=e.chars;break;case"words":N=e.words;break;case"lines":N=e.lines}}if(void 0===this.timelineActions.find((e=>e.finalSelector==N&&e.id==n.id))||!bricksIsFrontend){if(bricksIsFrontend){let e=!1,t=[];"string"==typeof N&&(t=document.querySelectorAll(N)),"object"==typeof N&&t.push(N[0]),t.forEach((t=>{t&&t.classList&&(t.classList.contains("brf-prevent-fouc")||t.closest(".brf-prevent-fouc"))&&(e=!0,t.closest(".brf-prevent-fouc")&&(t=t.closest(".brf-prevent-fouc")),t.classList.contains("brf-reset-transition")?("from"==n.method&&(T.autoAlpha=0),"to"==n.method&&(T.autoAlpha=1),"fromTo"==n.method&&(T.autoAlpha=0,F.autoAlpha=1),t.classList.remove("brf-prevent-fouc")):t.classList.remove("brf-prevent-fouc"))}))}switch(n.method){case"from":R&&bricksIsFrontend?ScrollTrigger.batch(N,{once:1==l||w&&"none"==w.split(" ")[2],markers:h,start:d,end:u,...1==A&&{toggleClass:{targets:C,className:E}},onRefresh:e=>this.handleRefresh(e),onEnter:(e,t)=>{H.from(e,{data:{id:n.id},duration:x,delay:q,yoyo:W,repeat:X,...P,...T,ease:M,...!0===U&&{stagger:_},...!U&&m&&{stagger:{from:b,amount:f,ease:y}},scrollTrigger:{trigger:e,toggleActions:w,...1==k&&{snap:{snapTo:S,duration:L,delay:V,ease:I}},...1==g&&v&&{pin:v||!0,pinSpacing:p},...1==l&&{scrub:c}}})},animationPositionValue:O}):H.from(N,{data:{id:n.id},duration:x,delay:q,yoyo:W,repeat:X,...P,...T,ease:M,...!0===U&&{stagger:_},...!U&&m&&{stagger:{from:b,amount:f,ease:y}}},O);break;case"to":R&&bricksIsFrontend?ScrollTrigger.batch(N,{once:1==l||w&&"none"==w.split(" ")[2],markers:h,start:d,end:u,...1==A&&{toggleClass:{targets:C,className:E}},onRefresh:e=>this.handleRefresh(e),onEnter:(e,t)=>{H.to(e,{data:{id:n.id},immediateRender:bricksIsFrontend,duration:x,yoyo:W,repeat:X,delay:q,...P,...T,ease:M,...!0===U&&{stagger:_},...!U&&m&&{stagger:{from:b,amount:f,ease:y}},scrollTrigger:{trigger:e,...1==k&&{snap:{snapTo:S,duration:L,delay:V,ease:I}},...1==l&&{scrub:c},...1==g&&v&&{pin:v||!0,pinSpacing:p}}})},animationPositionValue:O}):H.to(N,{data:{id:n.id},duration:x,delay:q,yoyo:W,repeat:X,...P,...T,ease:M,...!0===U&&{stagger:_},...!U&&m&&{stagger:{from:b,amount:f,ease:y}}},O);break;case"fromTo":let t;try{t=new Function("return (triggerSelector, target, trigger) => {return "+n.data2.replace(/cssVar\((.*?)\)/g,((e,t)=>this.cssVar(t.trim())))+"}")(this)}catch(e){if(t=new Function,bricksIsFrontend)continue}try{t(o,n.selector,B)}catch(a){if(t=new Function,console.warn("Bricksforge Panel: You try to use timeline animations, but your Animation data object seems to be wrong. This warning appears for the timeline: "+e.name),bricksIsFrontend)continue}let a=t(o,n.selector,B);R&&bricksIsFrontend?ScrollTrigger.batch(N,{once:1==l||w&&"none"==w.split(" ")[2],markers:h,start:d,end:u,...1==A&&{toggleClass:{targets:C,className:E}},onRefresh:e=>this.handleRefresh(e),onEnter:(e,t)=>{H.fromTo(e,{data:{id:n.id},duration:x,delay:q,yoyo:W,repeat:X,...P,...T,ease:M,...!0===U&&{stagger:_},...!U&&m&&{stagger:{from:b,amount:f,ease:y}},scrollTrigger:{trigger:e,...1==k&&{snap:{snapTo:S,duration:L,delay:V,ease:I}},...1==l&&{scrub:c},...1==g&&v&&{pin:v||!0,pinSpacing:p}}},{data:{id:n.id},duration:x,delay:q,yoyo:W,repeat:X,...a,...F,ease:M,...!0===U&&{stagger:_},...!U&&m&&{stagger:{from:b,amount:f,ease:y}},scrollTrigger:{trigger:e,...1==k&&{snap:{snapTo:S,duration:L,delay:V,ease:I}},...1==l&&{scrub:c},...1==g&&v&&{pin:v||!0,pinSpacing:p}}},O)}}):H.fromTo(N,{data:{id:n.id},...P,...T,yoyo:W,repeat:X,immediateRender:bricksIsFrontend,duration:x,delay:q,ease:M,...!0===U&&{stagger:_},...!U&&m&&{stagger:{from:b,amount:f,ease:y}}},{data:{id:n.id},...a,...F,duration:x,yoyo:W,repeat:X,delay:q,ease:M,...!0===U&&{stagger:_},...!U&&m&&{stagger:{from:b,amount:f,ease:y}}},O)}this.timelineActions.push({finalSelector:N,animationData:P,animationControls:T,id:n.id})}}!1===t&&(this.timelines.push({id:e.id,tl:H,children:H.getChildren(),trigger:B}),bricksforgeData&&bricksforgeData.panel&&bricksforgeData.panel.timelines.push({id:e.id,tl:H,children:H.getChildren(),trigger:B}))}))}handleRefresh(e){window.scrollY>window.innerHeight&&e.progress&&e.animation.progress(1)}async getTimelineById(e){return new Promise(((t,a)=>{setTimeout((()=>{let n=this.timelines.find((t=>t.id==e));n?t(n):a(new Error("Timeline not found"))}))}))}cssVar(e){let t,a="";e.includes(",")?(a=e.split(",")[0],t=e.split(",")[1]):a=e,a=a.replace(/['"]+/g,""),t&&(t=t.replace(/['"]+/g,""));let n="'"+getComputedStyle(t?document.querySelector(t):document.body).getPropertyValue(a.toString().trim())+"'";return n=n.replace(/' /g,"'"),n=n.trim(),n}async handleSliderEvent(e){if(!e)return console.warn("No Slider ID set"),!1;let t=bricksData.splideInstances;if("undefined"!=typeof xSlider&&(await this.waitForXSliderInstances(),t={...t,...xSlider.Instances}),!t)return console.warn("No Slider Instances found"),!1;const a=t[e];return a||(console.warn("No Slider found with the ID "+e),!1)}async waitForXSliderInstances(){return new Promise(((e,t)=>{let a=0;const n=setInterval((()=>{a+=100,Object.keys(xSlider.Instances).length>0&&(clearInterval(n),e()),a>=1e3&&(clearInterval(n),t())}),100)}))}async getTimelines(){return await new Promise((e=>{setTimeout((()=>{e()}))})),this.timelines}isValidSelector(e){try{return document.querySelector(e),!0}catch(e){}return!1}async wait(e=1e3){return new Promise((async t=>{setTimeout((()=>{t()}),e)}))}parseObject(e){return new Function("return "+e)}isNumeric(e){return"string"==typeof e&&(!isNaN(e)&&!isNaN(parseFloat(e)))}isParsable(e){try{JSON5.parse(e)}catch(e){return!1}return!0}}document.addEventListener("DOMContentLoaded",(e=>{brfPanel=new BricksforgePanel(e)}));