function brfScrollVideoInstance(){if(brfScrollVideoInstances=[],document.querySelector(".brf-scroll-video")){document.querySelectorAll(".brf-scroll-video").forEach((e=>{new BrfScrollVideo(e)}))}}function brfThreeJsHandler(){document.querySelectorAll(".brf-three-js").forEach((e=>{new BrfThreeJs(e)}))}function brfFlipEverything(){gsap.utils.toArray(".brf-flip-wrapper").forEach((e=>{let t=e,i=t.querySelector(".brf-flip-box"),r=t.querySelector(".brf-flip-front"),a=t.querySelector(".brf-flip-back");a.style.height=r.getBoundingClientRect().height+"px";let s=t.getAttribute("data-type"),n=t.getAttribute("data-duration"),o=t.getAttribute("data-delay"),l=t.getAttribute("data-trigger"),d=t.getAttribute("data-oncomplete"),c=t.getAttribute("data-onstart"),u=t.getAttribute("data-onreversecomplete");s=s||"flip",n=n||1,o=o||0,l=l||"hover",d=d?new Function(d):"",c=c?new Function(c):"",u=u?new Function(u):"";const h=gsap.timeline({paused:!0,onStart:function(){"function"==typeof c&&c()},onComplete:function(){"function"==typeof d&&d()},onReverseComplete:function(){bricksIsFrontend||gsap.set(r,{clearProps:!0}),"function"==typeof u&&u()}});switch(gsap.set(t,{transformStyle:"preserve-3d",transformPerspective:1e3}),gsap.set(i,{transformStyle:"preserve-3d",transformOrigin:"50% 50%"}),gsap.set(a,{rotationY:180,rotationZ:180}),s){case"flip":h.to(r,{rotationX:180,duration:n},o),h.to(a,{rotationX:180,duration:n},o);break;case"fade":t.style.overflow="hidden",gsap.set(a,{width:a.getBoundingClientRect().width-1}),gsap.set(a,{rotationX:180}),h.to(r,{opacity:0,duration:n},o),h.to(a,{opacity:1,duration:n},o);break;case"fadeShrink":t.style.overflow="hidden",gsap.set(a,{width:a.getBoundingClientRect().width-1}),gsap.set(a,{rotationX:180}),h.to(r,{scale:.8,opacity:0,duration:n/2},o),h.to(a,{opacity:1,duration:n},o);break;case"fadeUp":t.style.overflow="hidden",gsap.set(a,{rotationX:180,translateY:a.offsetHeight,opacity:0}),h.to(r,{opacity:1,rotationX:180,duration:n},o),h.to(a,{translateY:0,opacity:1,duration:n},o);break;case"overlay":t.style.overflow="hidden",gsap.set(a,{rotationX:180,translateY:a.offsetHeight+50,zIndex:1}),h.to(a,{translateY:0,zIndex:9999999,duration:n,z:1},o);break;case"overlayShrink":t.style.overflow="hidden",gsap.set(a,{rotationX:180,translateY:a.offsetHeight+50,zIndex:1,scale:.9}),h.to(a,{translateY:0,duration:n,z:1},o)}switch(l){case"hover":e.addEventListener("mouseenter",(e=>{h.play()})),e.addEventListener("mouseleave",(e=>{h.reverse()}));break;case"click":e.addEventListener("click",(t=>{e.classList.contains("active")?(h.reverse(),e.classList.remove("active")):(e.classList.add("active"),h.play())}))}}))}async function brfBeforeAndAfter(){for(let e of document.querySelectorAll(".brf-ba-wrapper")){let t=e.getBoundingClientRect().width,i=e.getBoundingClientRect().height;for(let r of e.querySelectorAll("img"))r.classList.remove("bricks-lazy-hidden"),r.getAttribute("data-src")&&r.setAttribute("src",r.getAttribute("data-src")),r.style.width=t+"px",r.style.height=i+"px",r.ondragstart=function(){return!1};let r=e.querySelector(".brf-ba-handle"),a=e.querySelector(".brf-ba-resize"),s=e;["mousedown","touchstart"].forEach((function(t){r.addEventListener(t,(function(t){t.preventDefault(),r.classList.add("draggable"),a.classList.add("resizable");let i=t.pageX?t.pageX:t.touches[0].pageX,n=r.getBoundingClientRect().width,o=r.offsetLeft+n-i,l=s.offsetLeft,d=s.getBoundingClientRect().width;minLeft=l+10,maxLeft=l+d-n-10,["mousemove","touchmove"].forEach((function(t){r.parentNode.addEventListener(t,(function(t){var i=t.pageX?t.pageX:t.touches[0].pageX;leftValue=i+o-n,leftValue<minLeft?leftValue=minLeft:leftValue>maxLeft&&(leftValue=maxLeft),widthValue=100*(leftValue+n/2-l)/d+"%",e.querySelector(".draggable")&&(e.querySelector(".draggable").style.left=widthValue,["mouseup","touchend"].forEach((function(t){e.querySelector(".draggable").addEventListener(t,(function(){this.classList.remove("draggable"),a.classList.remove("resizable")}))}))),e.querySelector(".resizable")&&(e.querySelector(".resizable").style.width=widthValue)}))})),r.parentNode.addEventListener("mouseup",(function(e){r.classList.remove("draggable"),a.classList.remove("resizable")})),r.parentNode.addEventListener("touchend",(function(e){r.classList.remove("draggable"),a.classList.remove("resizable")}))}))}))}}function brfMegaMenu(){if("undefined"==typeof MegaMenuSettings)return void console.warn("Bricksforge Mega Menu Warning: No Mega Menu data found.");let e=!!MegaMenuSettings&&MegaMenuSettings.data,t=MegaMenuSettings.headerData;if(!t||!t.length)return;let i=t.find((e=>"nav-menu"==e.name&&void 0!==e.settings.activateMegaMenu&&document.querySelector("#brxe-"+e.id))),r=i.settings,a=!!r.activateMegaMenu&&r.activateMegaMenu,s=!!r.menu&&r.menu,n=r.megaMenuTrigger?r.megaMenuTrigger:"hover",o=!!r.megaMenuFullWidth&&r.megaMenuFullWidth,l=r.megaMenuTopSpacing?r.megaMenuTopSpacing:0,d=r.megaMenuCloseSelector?r.megaMenuCloseSelector:"main",c=r.megaMenuCloseEvent?r.megaMenuCloseEvent:"click",u=!!r.megaMenuCloseWhenLeavingNavItem&&r.megaMenuCloseWhenLeavingNavItem,h=r.megaMenuAnimationDuration?r.megaMenuAnimationDuration:150;if(!1===a)return void console.warn("Bricksforge Mega Menu Warning: The Mega Menu is not active.");if(!1===s)return void console.warn('Bricksforge Mega Menu Warning: You have to define a menu for the Nav Item element to use the mega menu. You find the control under: "Select Nav Menu".');if(!document.querySelector("header#brx-header"))return void console.warn("Bricksforge Mega Menu Warning: On this page no header seems to exist");let m=(e,t=!1)=>{let i=e.dataset.navItem;document.querySelectorAll(".bricks-nav-menu li").forEach((e=>{e.classList.remove("megamenu-visible")})),i&&(t||document.querySelector(".bricks-nav-menu li#"+i).classList.add("megamenu-visible"))};for(let t of e){let e=document.createElement("template");e.innerHTML=t;let i=e.content.firstChild;o?document.querySelector("header#brx-header").appendChild(i):document.querySelector("header#brx-header .brxe-container").appendChild(i),(i.querySelector(".brxe-tabs-nested")||i.querySelector(".brxe-tabs"))&&bricksTabs(),(i.querySelector(".brxe-accordion-nested")||i.querySelector(".brxe-accordion"))&&bricksAccordion(),(i.querySelector(".brxe-slider-nested")||i.querySelector(".brxe-slider"))&&bricksSplide()}document.querySelectorAll(".bricks-nav-menu-wrapper li.menu-item").forEach((e=>{e.closest(".wpm-mega-menu")||(e.addEventListener("mouseenter",(()=>{if("hover"==n){let e=document.querySelectorAll(".megamenu-open");for(let t of e)m(t,!0),brfFadeOut(t,h)}})),1==u&&(e.addEventListener("mouseleave",(t=>{var i=e.getBoundingClientRect(),r=i.top+i.height;if(t.pageY>=r-2)return;let a=document.querySelectorAll(".megamenu-open");for(let e of a)m(e,!0),brfFadeOut(e,h),e.classList.remove("megamenu-open")})),document.querySelectorAll(".wpm-mega-menu").forEach((e=>{e.addEventListener("mouseleave",(e=>{let t=document.querySelectorAll(".megamenu-open");for(let e of t)m(e,!0),brfFadeOut(e,h),e.classList.remove("megamenu-open")}))}))))})),document.querySelector("#brxe-"+i.id).querySelectorAll(".bricks-nav-menu-wrapper li.menu-item").forEach((e=>{e.addEventListener("click"==n?"click":"mouseenter",(t=>{if(e.closest(".wpm-mega-menu"))return;let i="LI"==t.target.tagName?t.target:t.target.closest("li"),r=document.querySelectorAll(".wpm-mega-menu");for(let e of r){let r=e;if(o?r.style.top=r.closest("header").getBoundingClientRect().height+parseInt(l,10)+"px":(r.style.top=r.closest("header").getBoundingClientRect().height+parseInt(l,10)+"px",t.target.closest(".brxe-container").style.position="relative"),[...i.classList].includes(r.getAttribute("data-nav-item"))){if(t.preventDefault(),r.classList.contains("megamenu-open")&&"click"==n)return m(e,!0),brfFadeOut(e,h),void r.classList.remove("megamenu-open");e.style.opacity=0,m(e),brfFadeIn(e,h),r.classList.add("megamenu-open")}else m(r,!0),brfFadeOut(r,h),r.classList.remove("megamenu-open")}document.querySelector(d)&&document.querySelector(d).addEventListener("click"==c?"click":"mouseenter",(()=>{let e=document.querySelectorAll(".wpm-mega-menu");for(let t of e)0!=t.style.opacity&&"none"!=t.style.display&&(m(t,!0),brfFadeOut(t,h),t.classList.remove("megamenu-open"))}))}))}))}function brfFadeIn(e,t=150){if(0==t)return e.style.display="block",void(e.style.opacity=1);if("undefined"!=typeof gsap)gsap.to(e,{duration:t/1e3,opacity:1,display:"block"});else{e.style.display="block",e.style.opacity=0;let i=null;requestAnimationFrame((function r(a){i||(i=a);let s=a-i,n=s/t;e.style.opacity=Math.min(n,1),s<t&&requestAnimationFrame(r)}))}}function brfFadeOut(e,t=0){if(0==t)return e.style.display="none",void(e.style.opacity=0);if("undefined"!=typeof gsap)gsap.to(e,{duration:t/1e3,opacity:0,display:"none"});else{e.style.opacity=1;let i=null;requestAnimationFrame((function r(a){i||(i=a);let s=a-i,n=1-s/t;e.style.opacity=Math.max(n,0),s<t?requestAnimationFrame(r):e.style.display="none"}))}}function brfToc(){let e=document.querySelector(".brf-toc-content");if(document.querySelectorAll(".brf-toc-content").forEach((t=>{t.children.length>0?e=t:t.remove(),"none"==t.style.display&&t.remove()})),!e)return;if(!bricksIsFrontend)return;if(e.dataset.status&&"hidden"==e.dataset.status)return void document.querySelector("#brf-toc").closest(".brf-toc").remove();let t=document.createDocumentFragment();t.appendChild(e),document.getElementById("brf-toc").appendChild(t),e.style.display="block"}async function brfWaitForBuilder(e=500){return new Promise((async t=>{setTimeout((function(){t()}),e)}))}function brfIsParsable(e){try{JSON.parse(e)}catch(e){return!1}return!0}function brfGetParents(e,t){void 0===t&&(t=document);for(var i=[],r=e.parentNode;r!==t;){var a=r;i.push(a),r=a.parentNode}return i.push(t),i}function brfQuill(){let e=document.querySelectorAll(".brf-rich-text-container");e&&e.forEach((e=>{let t=e.closest(".form-group"),i=t.dataset.theme?t.dataset.theme:"snow",r=t.dataset.placeholder?t.dataset.placeholder:"",a="true"==t.dataset.readonly,s=t.dataset.formats?t.dataset.formats.split(","):["header","bold","italic","underline","link"],n=t.dataset.formatsMce?t.dataset.formatsMce:"undo redo | formatselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",o=!!s.includes("header")&&[1,2,3,4,5,6,!1],l=!!s.includes("orderedList")&&{list:"ordered"},d=!!s.includes("bulletList")&&{list:"bullet"},c=!!s.includes("color")&&{color:[]},u=!!s.includes("background")&&{background:[]},h=!!s.includes("indent")&&{indent:"+1"},m=!!s.includes("outdent")&&{indent:"-1"},f=!!s.includes("align")&&{align:[]},p=!!s.includes("direction")&&{direction:"rtl"},y=!!t.dataset.colors&&t.dataset.colors.split(",");y&&(c&&(c={color:y}),u&&(u={background:y}));let g=[];o&&(g.push([{header:o}]),s.splice(s.indexOf("header"),1)),l&&s.splice(s.indexOf("orderedList"),1),d&&s.splice(s.indexOf("bulletList"),1),c&&s.splice(s.indexOf("color"),1),u&&s.splice(s.indexOf("background"),1),h&&s.splice(s.indexOf("indent"),1),m&&s.splice(s.indexOf("outdent"),1),f&&s.splice(s.indexOf("align"),1),p&&s.splice(s.indexOf("direction"),1);let b=[...s,l,d,c,u,h,m,f,p].filter((e=>!1!==e));if(s&&g.push(b),"wordpress"==i)return void tinymce.init({selector:"#"+e.id,toolbar:n,statusbar:!1,placeholder:r,setup:function(e){e.on("input",(function(){t.querySelector("input[type=hidden]").value=e.getContent()})),e.on("ExecCommand",(function(){t.querySelector("input[type=hidden]").value=e.getContent()}))}});const S=new Quill(e,{modules:{toolbar:g},readOnly:a,placeholder:r,theme:i});S.root.innerHTML&&(t.querySelector("input[type=hidden]").value=S.root.innerHTML),S.on("text-change",(function(){let e=t.querySelector("input[type=hidden]");e.value=S.root.innerHTML;let i=new CustomEvent("brfQuillChange",{detail:{quill:S,input:e}});document.dispatchEvent(i);let r=document.querySelectorAll(".brf-live-value");r&&r.forEach((t=>{let i=!!t.dataset.connection&&t.dataset.connection;if(i&&e&&e.name=="form-field-"+i){const i=t.dataset.prefix?t.dataset.prefix:"",r=t.dataset.suffix?t.dataset.suffix:"";e.value&&"<p><br></p>"!=e.value?t.innerHTML=i+e.value+r:t.dataset.fallback?t.innerHTML=i+t.dataset.fallback+r:t.innerHTML=i+e.value+r}}))})),bricksIsFrontend||e.closest(".form-group").querySelectorAll(".ql-toolbar").length>1&&e.closest(".form-group").querySelector(".ql-toolbar").remove(),bricksIsFrontend&&(e.style.visibility="visible")}))}function brfProFormsSlider(){let e=document.querySelectorAll(".brxe-brf-pro-forms .slider:not([data-slider-created])");e&&e.forEach((e=>{let t=e.dataset.settings;t&&(t=JSON.parse(t));noUiSlider.create(e,t);e.setAttribute("data-slider-created",!0)}))}function brfProForms(){if(!bricksIsFrontend){BrfProForms.populateControlData(),BrfProForms.handleDefaultEmailContent();[window.parent.document.querySelector("#bricks-toolbar .save")].forEach((e=>{e.addEventListener("mouseenter",(()=>{BrfProForms.handleDefaultEmailContent()}))})),document.querySelectorAll(".brxe-brf-pro-forms").forEach((e=>{BrfProForms.handleGroups(e,!0),new BrfProForms(e,!0).handleSelectFields()}))}}localFrames=[],document.addEventListener("DOMContentLoaded",(function(){brfScrollVideoInstance(),setTimeout((()=>{if(document.querySelector(".brxe-brf-pro-forms")&&bricksIsFrontend){document.querySelectorAll(".brxe-brf-pro-forms").forEach((e=>{setTimeout((()=>{e.classList.contains("form-loading")&&e.classList.remove("form-loading")}),100),new BrfProForms(e),e.style.visibility="visible"}))}}),0)})),window.addEventListener("load",(()=>{brfQuill(),bricksIsFrontend&&(document.querySelector(".brf-flip-wrapper")&&brfFlipEverything(),document.querySelector("#brf-toc")&&brfToc(),document.querySelector(".brf-three-js")&&bricksIsFrontend&&brfThreeJsHandler(),"undefined"!=typeof MegaMenuSettings&&MegaMenuSettings.megaMenuActivated&&brfMegaMenu()),document.querySelector(".brf-before-and-after")&&brfBeforeAndAfter()})),window.addEventListener("resize",(function(){if(document.querySelector(".brf-ba-wrapper"))for(let e of document.querySelectorAll(".brf-ba-wrapper")){let t=e.getBoundingClientRect().width,i=e.getBoundingClientRect().height;for(let r of e.querySelectorAll("img"))r.classList.remove("bricks-lazy-hidden"),r.getAttribute("data-src")&&r.setAttribute("src",r.getAttribute("data-src")),r.style.width=t+"px",r.style.height=i+"px",r.ondragstart=function(){return!1}}}));class BrfProForms{form;structure=[];currentStep=0;hasSummary=!1;hasShowStepsActive=!1;hasClicksAllowed=!1;hasRemoteSteps=!1;hasSubmitConditions=!1;remoteSteps;summary;isSubmitting=!1;currentActiveElement;isNestableForm=!1;initialFormDisplay;results=[];constructor(e,t=!1){this.form=e,this.currentActiveElement=null,!0!==t&&this.init()}async init(){this.buildVars(),await this.handleForm(),this.handleKeyboardEvents(),this.woocommerceSetup(),bricksIsFrontend||this.handleActiveElementChange(),this.finish()}buildVars(){this.hasSummary="true"==this.form.dataset.brfSummary,this.hasShowStepsActive="true"==this.form.dataset.brfShowSteps,this.hasClicksAllowed="true"==this.form.dataset.brfStepAllowClicks,this.hasRemoteSteps=this.checkForRemoteSteps(),this.remoteSteps=document.querySelectorAll(".brf-steps-remote"),this.hasSubmitConditions="true"==this.form.dataset.brfSubmitConditions,this.isNestableForm="true"==this.form.dataset.nestable}finish(){this.isMultiStepForm()&&(this.form.style.visibility="visible"),this.form.classList.contains("form-loading")&&this.form.classList.remove("form-loading")}fireConfetti(){const e=this.form.dataset.confettiType?this.form.dataset.confettiType:"basic";let t=this.form.dataset.confettiDuration?1e3*parseInt(this.form.dataset.confettiDuration):5e3,i=this.form.getBoundingClientRect(),r={x:(i.left+i.right)/(2*window.innerWidth),y:(i.top+i.bottom)/(2*window.innerHeight)+.15};function a(e,t){return Math.random()*(t-e)+e}switch(e){case"basic":confetti({particleCount:100,spread:70,origin:r});break;case"random":confetti({angle:a(55,125),spread:a(50,70),particleCount:a(50,100),origin:{y:.6}});break;case"realistic":var s={origin:r};function d(e,t){confetti({...s,...t,particleCount:Math.floor(200*e)})}d(.25,{spread:26,startVelocity:55}),d(.2,{spread:60}),d(.35,{spread:100,decay:.91,scalar:.8}),d(.1,{spread:120,startVelocity:25,decay:.92,scalar:1.2}),d(.1,{spread:120,startVelocity:45});break;case"fireworks":var n=Date.now()+t,o=(s={startVelocity:30,spread:360,ticks:60,zIndex:0},setInterval((function(){var e=n-Date.now();if(e<=0)return clearInterval(o);var i=e/t*50;confetti({...s,particleCount:i,origin:{x:a(.1,.3),y:Math.random()-.2}}),confetti({...s,particleCount:i,origin:{x:a(.7,.9),y:Math.random()-.2}})}),250));break;case"stars":s={spread:360,ticks:50,gravity:0,decay:.94,startVelocity:30,colors:["FFE400","FFBD00","E89400","FFCA6C","FDFFB8"]};function c(){confetti({...s,particleCount:40,scalar:1.2,shapes:["star"]}),confetti({...s,particleCount:10,scalar:.75,shapes:["circle"]})}setTimeout(c,0),setTimeout(c,100),setTimeout(c,200);break;case"snow":n=Date.now()+t;var l=1;!function e(){var i=n-Date.now(),r=Math.max(200,i/t*500);l=Math.max(.8,l-.001),confetti({particleCount:1,startVelocity:0,ticks:r,origin:{x:Math.random(),y:Math.random()*l-.2},colors:["#ffffff"],shapes:["circle"],gravity:a(.4,.6),scalar:a(.4,1),drift:a(-.4,.4)}),i>0&&requestAnimationFrame(e)}()}}woocommerceSetup(){"undefined"!=typeof wc_add_to_cart_params&&document.body.addEventListener("added_to_cart",(()=>{this.wcRefreshMiniCart()}))}handleKeyboardEvents(){this.form.addEventListener("keydown",(e=>{if(13==e.keyCode){if("TEXTAREA"==e.target.tagName)return;if(this.isMultiStepForm()){if(e.preventDefault(),"BUTTON"==e.target.tagName){if(e.target.click(),"submit"==e.target.type)return;return void this.focusOnFirstStepInput()}this.isLastStep()||(this.jumpToNextStep(),this.focusOnFirstStepInput())}}}))}focusOnFirstStepInput(){let e=this.form.querySelector("[data-brf-step='"+(parseInt(this.currentStep)+1)+"'] *");e&&e.focus()}handleActiveElementChange(){const e=document.querySelector(".brx-body").__vue_app__.config.globalProperties,t=this;Object.defineProperty(e.$_state,"activeElement",{get(){return t.currentActiveElement},set(e){t.currentActiveElement=e,t.handleActiveElementChange()}}),BrfProForms.populateControlData()}static handleDefaultEmailContent(e=!1,t=!1,i=!1){const r=window.parent.document.querySelector(".brx-body").__vue_app__.config.globalProperties.$_state.content,a=window.parent.document.querySelector(".brx-body").__vue_app__.config.globalProperties.$_state.header,s=window.parent.document.querySelector(".brx-body").__vue_app__.config.globalProperties.$_state.footer;if(!r)return;let n=[];if(n=Object.values(r).filter((e=>"brf-pro-forms"==e.name)),a&&(n=[...n,...Object.values(a).filter((e=>"brf-pro-forms"==e.name))]),s&&(n=[...n,...Object.values(s).filter((e=>"brf-pro-forms"==e.name))]),!n)return;const o=["step","divider","heading","turnstile","shortcode","file"],l=["brf-placeholder","guardian42"];n.forEach((r=>{const a=null!=r.settings.emailContent&&""!=r.settings.emailContent,s=!!r.settings.refreshEmailContent,n=!!r.settings.refreshConfirmationEmailContent;let d=document.querySelector("#bricks-builder-iframe");if(d=d?d.contentWindow.document:document,(!a||e&&t||s)&&(r.settings.fields&&r.settings.fields.length>0&&(r.settings.emailContent="",r.settings.fields.forEach((e=>{if(o.includes(e.type))return;const t=e.label?e.label+": ":"",i=e.id?"{{"+e.id+"}}":"";r.settings.emailContent+=t+i+"\n"}))),r.children&&r.children.length>0&&d)){const e=d.querySelector('form[data-script-id="'+r.id+'"]');if(r.settings.emailContent="",e){let t=Array.from(e.querySelectorAll("input")),i=Array.from(e.querySelectorAll("textarea"));t.push(...i);const a=e.querySelectorAll("select");t.forEach((e=>{const t=e.name&&e.name.split("form-field-")[1]?e.name.split("form-field-")[1]:null;if(t){if(l.includes(t))return;if("file"==e.type)return;const i=e.dataset.label;r.settings.emailContent+=i?i+": {{"+t+"}}\n":"{{"+t+"}}\n"}})),a.forEach((e=>{const t=e.name&&e.name.split("form-field-")[1]?e.name.split("form-field-")[1]:null;if(t){const i=e.dataset.label;r.settings.emailContent+=i?i+": {{"+t+"}}\n":"{{"+t+"}}\n"}}))}}const c=null!=r.settings.confirmationEmailContent&&""!=r.settings.confirmationEmailContent,u=null!=r.settings.confirmationEmailSubject&&""!=r.settings.confirmationEmailSubject;if((!c||e&&i||n)&&u&&(r.settings.fields&&r.settings.fields.length>0&&(r.settings.confirmationEmailContent="",r.settings.fields.forEach((e=>{if(o.includes(e.type))return;const t=e.label?e.label+": ":"",i=e.id?"{{"+e.id+"}}":"";r.settings.confirmationEmailContent+=t+i+"\n"}))),r.children&&r.children.length>0&&d)){const e=d.querySelector('form[data-script-id="'+r.id+'"]');if(r.settings.confirmationEmailContent="",e){let t=Array.from(e.querySelectorAll("input")),i=Array.from(e.querySelectorAll("textarea"));t.push(...i);const a=e.querySelectorAll("select");t.forEach((e=>{const t=e.name&&e.name.split("form-field-")[1]?e.name.split("form-field-")[1]:null;if(t){if(l.includes(t))return;if("file"==e.type)return;const i=e.dataset.label;r.settings.confirmationEmailContent+=i?i+": {{"+t+"}}\n":"{{"+t+"}}\n"}})),a.forEach((e=>{const t=e.name&&e.name.split("form-field-")[1]?e.name.split("form-field-")[1]:null;if(t){const i=e.dataset.label;r.settings.confirmationEmailContent+=i?i+": {{"+t+"}}\n":"{{"+t+"}}\n"}}))}}}))}static populateControlData(){const e=document.querySelector(".brx-body").__vue_app__.config.globalProperties,t=window.parent.document.querySelector(".brx-body").__vue_app__.config.globalProperties,i=e.$_state.activeElement;if(i&&i.settings&&i.settings.actions&&i.settings.actions.includes("mailchimp")&&"brf-pro-forms"==i.name){const e=t.bricks.mailchimpLists,r=t.bricks.elements["brf-pro-forms"].controls.mailchimpGroups,a=i.settings.mailchimpList;if(a){const i=structuredClone(r.options);r.options=e[a].groups,JSON.stringify(i)!==JSON.stringify(r.options)&&(t.$_state.rerenderControls=Date.now())}}}checkForRemoteSteps(){if(document.querySelectorAll(".brf-steps-remote").length>0)for(let e=0;e<document.querySelectorAll(".brf-steps-remote").length;e++){let t=document.querySelectorAll(".brf-steps-remote")[e];if(t.dataset.brfFormId==this.form.id)return this.remoteSteps=t,!0}return!1}async handleForm(e){return new Promise((async e=>{await this.buildStructure(),this.loadingSequences(),await this.showOnlyFirstStep(),this.handleVisualSteps(),this.handleSliders(),this.handleDatePickers(),this.handleClickActions(),this.handleLiveEventLogic(),this.handleEventListeners(),this.handleLiveValues(),await this.handleSelectFields(),await this.handleConditionalLogic(),await this.renderFormData(this.needsFormDataRendering()),this.handleFileInputs(),this.handleSubmit(),e()}))}needsFormDataRendering(){if(!(this.hasSubmitConditions||this.hasCalculationField()||this.hasWcDynamicData()||this.hasConditionalFieldLogic()))return[];const e=[];return this.hasSubmitConditions&&e.push("submitConditions"),this.hasCalculationField()&&e.push("calculation"),this.hasWcDynamicData()&&e.push("wcDynamicData"),e}handleEventListeners(){this.form.addEventListener("input",(e=>{if("INPUT"==e.target.tagName||"TEXTAREA"==e.target.tagName){if(e.target.pattern){new RegExp("^"+e.target.pattern+"$").test(e.target.value)||(e.target.value=e.target.value.slice(0,-1))}this.handleLiveValues(e)}})),this.form.addEventListener("change",(e=>{"SELECT"==e.target.tagName&&this.handleLiveValues(e),"checkbox"!=e.target.type&&"radio"!=e.target.type||this.handleLiveValues(e)})),this.handleValidationEvents()}async handleSelectFields(){let e=document.querySelectorAll("[data-use-choices='true']");if(e&&"undefined"!=typeof Choices)return new Promise(((t,i)=>{e.forEach((e=>{const t=e.dataset.itemSelectText?e.dataset.itemSelectText:"",i=e.dataset.noResultsText?e.dataset.noResultsText:"No results found",r=!!e.dataset.searchable&&e.dataset.searchable;let a=new Choices(e,{silent:!bricksIsFrontend,allowHTML:!1,searchEnabled:!1,itemSelectText:t,noResultsText:i,searchEnabled:r,removeItems:!0,removeItemButton:!0});a.passedElement.element.addEventListener("showDropdown",(e=>{let t=e.target.closest(".choices");setTimeout((()=>{t.querySelector("input[type=search]")&&t.querySelector("input[type=search]").focus()}),25)})),a.passedElement.element.addEventListener("change",(e=>{this.handleConditionalLogic()}))})),t()}))}handleLiveValues(e,t=!1){let i=document.querySelectorAll(".brf-live-value");if(!i)return;if(!e)return void this.form.querySelectorAll("input, textarea, select").forEach((e=>{this.handleLiveValues(e,!0)}));let r=t?e:e.target;i.forEach((e=>{let t=!!e.dataset.connection&&e.dataset.connection;if(t&&r&&(r.name=="form-field-"+t||r.name=="form-field-"+t+"[]")){const t=e.dataset.prefix?e.dataset.prefix:"",i=e.dataset.suffix?e.dataset.suffix:"";if("INPUT"==r.tagName)if("radio"==r.type)r.checked?e.innerHTML=t+r.value+i:e.dataset.fallback?e.innerHTML=t+e.dataset.fallback+i:e.innerHTML=t+r.value+i;else if("checkbox"==r.type){let a=document.querySelectorAll('input[name="'+r.name+'"]:checked'),s=[];a.forEach((e=>{s.push(e.value)})),s.length>0?e.innerHTML=t+s.join(", ")+i:e.dataset.fallback?e.innerHTML=t+e.dataset.fallback+i:e.innerHTML=t+""+i}else r.value&&""!=r.value?e.innerHTML=t+r.value+i:e.dataset.fallback?e.innerHTML=t+e.dataset.fallback+i:e.innerHTML=t+r.value+i;else"SELECT"==r.tagName&&(r.value&&""!=r.value?e.innerHTML=t+r.value+i:e.dataset.fallback?e.innerHTML=t+e.dataset.fallback+i:e.innerHTML=t+r.value+i)}}))}handleValidationEvents(e=!1){this.form.querySelectorAll("input, textarea").forEach((t=>{t.addEventListener("blur",(()=>{this.handleLiveValidation(t,e)}))}))}handleLiveValidation(e,t=!1){let i=!!e.dataset.validation&&e.dataset.validation,r=!!e.dataset.liveValidation;if(i&&r||t){i=JSON.parse(i);for(let t=0;t<i.length;t++){let r=i[t];switch(r.type){case"required":""==e.value.replace(/\s/g,"")?this.markFieldAsInvalid(e,r):this.markFieldAsValid(e,r);break;case"email":let t=new RegExp("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,}$");e.value&&!t.test(e.value)?this.markFieldAsInvalid(e,r):this.markFieldAsValid(e,r);break;case"number":let i=new RegExp("^[0-9]+$");e.value&&!i.test(e.value)?this.markFieldAsInvalid(e,r):this.markFieldAsValid(e,r);break;case"url":let a=new RegExp("^(http|https)://");e.value&&!a.test(e.value)?this.markFieldAsInvalid(e,r):this.markFieldAsValid(e,r);break;case"minChars":if(!r.charsCount)break;r.minChars=parseInt(r.charsCount),e.value&&e.value.length<r.charsCount?this.markFieldAsInvalid(e,r):this.markFieldAsValid(e,r);break;case"maxChars":if(!r.charsCount)break;r.charsCount=parseInt(r.charsCount),e.value&&e.value.length>r.charsCount?this.markFieldAsInvalid(e,r):this.markFieldAsValid(e,r);break;case"custom":if(!r.regex)break;new RegExp(r.regex).test(e.value)?this.markFieldAsValid(e,r):this.markFieldAsInvalid(e,r)}}}}getValidationDefaultMessage(e,t){let i=e.dataset.label?e.dataset.label:"This field";switch(t.type){case"required":return i+" is required";case"email":return i+" is not a valid email address.";case"number":return i+" is not a valid number.";case"url":return i+" is not a valid URL.";case"minChars":return i+" must be at least "+t.charsCount+" characters long.";case"maxChars":return i+" must be at most "+t.charsCount+" characters long.";case"custom":return i+" is not valid."}return"This field is not valid."}markFieldAsInvalid(e,t){if(e.classList.add("brf-invalid"),!!!e.dataset.showValidationMessage)return;let i=t.message?t.message:this.getValidationDefaultMessage(e,t),r=e.parentNode.querySelector(".brf-validation-message");r||(r=document.createElement("div"),r.classList.add("brf-validation-message"),e.parentNode.insertBefore(r,e.nextSibling)),r.innerHTML=i}markFieldAsValid(e,t){e.classList.remove("brf-invalid");let i=e.parentNode.querySelector(".brf-validation-message");i&&i.remove()}handleSliders(){if("undefined"==typeof noUiSlider)return;let e=this.form.querySelectorAll(".slider");e&&e.forEach((e=>{let t=e.dataset.settings,i=e.dataset.roundTo,r=e.dataset.bindings,a=e.dataset.singleBindings,s=e.dataset.staticValues;t&&(t=JSON.parse(t)),r&&(r=JSON.parse(r)),a&&(a=JSON.parse(a)),s&&(s=JSON.parse(s)),i&&(i=parseInt(i),t.format={to:e=>parseFloat(e).toFixed(i),from:e=>parseFloat(e).toFixed(i)}),s&&(t.format={to:function(e){return s[Math.round(e)]},from:function(e){return s.indexOf(e)}},t.pips&&(t.pips.format=t.format));let n=noUiSlider.create(e,t),o=e.closest(".form-group").querySelector("input");if(n.set(o.value),r&&r.forEach((e=>{let t=this.form.querySelector("[name='form-field-"+e.id+"']");t&&(t.value=o.value),t.addEventListener("change",(e=>{n.set(e.target.value)}))})),a)if("object"==typeof n.get())for(let e=0;e<n.get().length;e++){if(!a[e])continue;let t=this.form.querySelector("[name='form-field-"+a[e].fieldId+"']");t&&(t.value=n.get()[e]),t.addEventListener("change",(t=>{n.setHandle(e,t.target.value)}))}else if(a[0]){let e=this.form.querySelector("[name='form-field-"+a[0].fieldId+"']");e&&(e.value=n.get()),e.addEventListener("change",(e=>{n.set(e.target.value)}))}n.on("slide.one",((e,t)=>{if(o&&(o.value=n.get(),r&&r.forEach((e=>{let t=this.form.querySelector("[name='form-field-"+e.id+"']");t&&(t.value=o.value)})),a)){if(!a[t])return;let i=this.form.querySelector("[name='form-field-"+a[t].fieldId+"']");if(!i)return;i.value=e[t]}}))}))}handleDatePickers(){if(!bricksIsFrontend)return;let e=this.form.querySelectorAll(".flatpickr-input");e&&e.forEach((e=>{let t=e.dataset.bricksDatepickerOptions;if(t&&(t=JSON.parse(t)),null!=e.dataset.enableWeekdays){let i=e.dataset.enableWeekdays.split(" ");i=i.map((e=>7==(e=parseInt(e))?0:e)),t.enable=[function(e){return i.includes(e.getDay())}]}"undefined"!=typeof flatpickr&&flatpickr(e,t)}))}handleFileInputs(){let e=this.form.querySelectorAll("input[type=file]");for(let t=0;t<e.length;t++){let i=e[t];if("true"==i.dataset.hideImagePreview)continue;let r=document.createElement("div");r.classList.add("brf-field-image-preview-wrapper"),i.parentNode.insertBefore(r,i.nextSibling),i.addEventListener("change",(e=>{[...e.target.files].forEach((e=>{let t=new FileReader;t.onload=t=>{let a=t.target.result;if(!e.type.includes("image"))return;{let t=document.createElement("div");t.classList.add("brf-field-image-preview-"+e.lastModified);let s=document.createElement("img");s.setAttribute("alt","Image Preview"),s.setAttribute("src",a),t.appendChild(s);let n=document.createElement("button");n.classList.add("brf-field-image-preview-delete"),n.innerHTML="x",t.appendChild(n),n.addEventListener("click",(t=>{t.preventDefault(),t.target.closest(".form-group").querySelectorAll(".file-result.show").forEach((e=>{e.remove()})),t.target.closest(".brf-field-image-preview-"+e.lastModified).remove()})),i.parentNode.insertBefore(t,i.parentNode.querySelector("label.choose-files")),r.appendChild(t)}let s=i.parentNode.querySelector(".brf-field-image-preview-"+e.lastModified).querySelector("img");s&&s.setAttribute("src",a)},t.readAsDataURL(e)}))}))}}async handleConditionalLogic(){return new Promise((e=>{const t=this.form.querySelectorAll("[data-brf-conditions]");for(let e=0;e<t.length;e++){const i=t[e],r=JSON.parse(i.dataset.brfConditions),a=i.dataset.brfConditionsRelation;this.handleConditionalFieldLogic(i,r,a)}e()}))}async buildStructure(){let e=[];for(let t=0;t<this.form.children.length;t++){let i=this.form.children[t];i.classList.contains("step")?(this.structure.push(e),e=[]):(t==this.form.children.length-1&&(e.push(i),this.structure.push(e),e=[]),e.push(i),this.isMultiStepForm()&&(i.dataset.brfStep=this.structure.length+1))}this.form.querySelector(".is-group")&&await this.constructor.handleGroups(this.form),this.hasSummary&&this.handleSummaryStructure()}static async handleGroups(e,t=!1){if(e.querySelector(".group-end"))return new Promise((t=>{try{e.querySelectorAll(".group-start").forEach((e=>{let t=e.nextElementSibling,i=document.createElement("div");i.className=e.className;let r=[];for(;t&&!t.classList.contains("group-end");)r.push(t),t=t.nextElementSibling;r.forEach((e=>{e.classList.add("is-group-item"),i.appendChild(e)})),e.parentNode.insertBefore(i,e),i.classList.remove("group-start"),e.remove(),t&&t.remove()})),t()}catch(e){console.log(e),t()}}))}handleVisualSteps(){if(!this.hasShowStepsActive&&!this.hasRemoteSteps)return;let e=document.createElement("div");e.classList.add("brf-steps"),e.classList.add("form-group");for(let t=0;t<this.structure.length;t++){let i=document.createElement("span");i.classList.add("brf-step"),i.innerHTML=t+1;let r=this.form.querySelectorAll(".step");if(t>0){if(void 0===r[t-1])continue;i.innerHTML=r[t-1].getAttribute("aria-label")?r[t-1].getAttribute("aria-label"):"Step",i.dataset.index=t}else 0==t&&(this.hasShowStepsActive&&this.form.dataset.brfFirstStep&&(i.innerHTML=this.form.dataset.brfFirstStep,i.dataset.index=t),this.hasRemoteSteps&&(this.remoteSteps=document.querySelector(".brf-steps-remote[data-brf-form-id='"+this.form.id+"']"),this.remoteSteps.dataset.brfFirstStep&&(i.innerHTML=this.remoteSteps.dataset.brfFirstStep,i.dataset.index=t)));e.appendChild(i)}if(this.hasSummary){let t=document.createElement("span");t.classList.add("brf-step"),t.innerHTML=this.form.dataset.brfSummaryHeadline?this.form.dataset.brfSummaryHeadline:"Summary",t.dataset.index=this.structure.length-1,e.appendChild(t)}e.children[this.currentStep].classList.add("current"),this.hasShowStepsActive&&this.form.append(e),this.checkForRemoteSteps()&&this.remoteSteps.dataset.brfFormId==this.form.id&&this.remoteSteps.append(e.cloneNode(!0))}addClassToCurrentStep(){let e,t;if(this.hasShowStepsActive&&(e=this.form.querySelectorAll(".brf-step")),this.hasRemoteSteps&&(t=this.remoteSteps.querySelectorAll(".brf-step")),e)for(let t=0;t<e.length;t++){let i=e[t];t==this.currentStep?i.classList.add("current"):i.classList.remove("current")}if(t)for(let e=0;e<t.length;e++){let i=t[e];e==this.currentStep?i.classList.add("current"):i.classList.remove("current")}}needsInitialRendering(){return"true"==this.form.dataset.brfNeedsRendering}handleSummaryStructure(){let e=this.structure[this.structure.length-1];for(let t=0;t<e.length;t++){let i=e[t];i.classList.contains("submit-button-wrapper")&&e.splice(t,1),i.classList.contains("submit-button-wrapper")&&e.splice(t,1)}let t=this.buildSummary();this.structure.push([t,this.form.querySelector(".submit-button-wrapper")]);let i=this.form.querySelector(".brf-hcaptcha-wrapper");if(i)for(let e=0;e<this.structure.length;e++){let t=this.structure[e];for(let e=0;e<t.length;e++){t[e].classList.contains("brf-hcaptcha-wrapper")&&(t.splice(e,1),this.structure[this.structure.length-1].push(i))}}}buildSummary(){this.summary=document.createElement("div"),this.summary.id="brf-summary";let e=this.form.querySelector(".submit-button-wrapper");this.isNestableForm&&(e=this.form.children[this.form.children.length-1]),e.before(this.summary);let t=this.form.querySelector(".brf-hcaptcha-wrapper");return t&&t.before(this.summary),this.summary}refreshSummary(){let e=this.summary;e.innerHTML="";let t=document.createElement("h3");t.classList.add("brf-summary-headline"),t.innerHTML=this.form.dataset.brfSummaryHeadline?this.form.dataset.brfSummaryHeadline:"Summary",e.append(t);for(let t=0;t<this.structure.length;t++){let i=this.structure[t];for(let t=0;t<i.length;t++){let r=i[t];if(!r)continue;let a=[];r.querySelector(".form-group")&&a.push(...r.querySelectorAll(".form-group")),r.classList.contains("form-group")&&a.push(r);for(let t=0;t<a.length;t++){let i=a[t];if(i.classList.contains("form-group")||null!=i.querySelector(".form-group")){let t=i.querySelector("label"),r=i.querySelector("input");if(r||(r=i.querySelector("textarea")),r||(r=i.querySelector("select")),i.querySelector("input[data-type=rich-text]")&&(r=i.querySelector("input[data-type=rich-text]")),r&&"password"==r.type)continue;if(i.querySelectorAll('input[type="checkbox"]').length>0){let e=i.querySelectorAll('input[type="checkbox"]:checked');r=Array.from(e).map((e=>e))}if(i.querySelector('input[type="radio"]')){let e=[];e.push(i.querySelector('input[type="radio"]:checked')),r=e}if(!r)continue;if(!this.form.dataset.brfSummaryEmpty&&!r.value&&"object"!=typeof r)continue;let a=document.createElement("div");a.classList.add("brf-summary-item");let s=document.createElement("h4");s.innerHTML=t?t.innerHTML:i.querySelector("*").getAttribute("aria-label"),a.append(s);let n=document.createElement("p");if(Array.isArray(r)){let e=[];for(let t=0;t<r.length;t++)e.push(r[t].dataset.label);n.innerHTML=e.join(", ")}else"select"===r.tagName.toLowerCase()?r.options[r.selectedIndex].dataset.label?n.innerHTML=r.options[r.selectedIndex].dataset.label:n.innerHTML=this.form.dataset.brfSummaryEmptyText?this.form.dataset.brfSummaryEmptyText:"Empty":"file"==r.type?n.innerText=r.files.length>0?Array.from(r.files).map((e=>e.name)).join(", "):this.form.dataset.brfSummaryEmptyText?this.form.dataset.brfSummaryEmptyText:"Empty":"rich-text"==r.dataset.type?n.innerHTML=r.value.replace(/(<([^>]+)>)/gi,"")?r.value:this.form.dataset.brfSummaryEmptyText?this.form.dataset.brfSummaryEmptyText:"Empty":(n.innerText=r.value?r.value:this.form.dataset.brfSummaryEmptyText?this.form.dataset.brfSummaryEmptyText:"Empty",n.innerText=n.innerText.replace(/(<([^>]+)>)/gi,""));a.append(n),e.append(a)}}}}this.isNestableForm&&(this.hideChild(this.form.querySelector(".brxe-brf-pro-forms-field-summary-button")),this.showChild(this.form.children[this.form.children.length-1]))}handleClickActions(){this.form.addEventListener("click",(e=>{e.target.classList.contains("next")&&(e.preventDefault(),this.jumpToNextStep())})),this.form.addEventListener("click",(e=>{e.target.classList.contains("prev")&&(e.preventDefault(),this.jumpToPrevStep())})),this.form.addEventListener("click",(e=>{e.target.classList.contains("summary")&&(e.preventDefault(),this.jumpToNextStep())})),(this.hasClicksAllowed||document.querySelector(".brf-steps-remote"))&&[this.form,this.remoteSteps].forEach((e=>{e.classList&&e.classList.contains("brf-steps-remote")&&!e.dataset.brfStepAllowClicks||"object"==typeof e&&(NodeList.prototype.isPrototypeOf(e)||e.addEventListener("click",(e=>{this.hasRemoteSteps&&!this.isSyncSteps()||e.target.classList.contains("brf-step")&&(e.preventDefault(),this.hasSummary&&e.target.dataset.index==this.structure.length-1&&this.refreshSummary(),this.jumpToStepWithIndex(e.target.dataset.index))})))})),this.form.querySelectorAll(".input-icon").forEach((e=>{e.addEventListener("click",(t=>{const i=e.nextElementSibling;i&&"INPUT"==i.tagName&&i.parentNode.dataset.focus&&"true"==i.parentNode.dataset.focus&&i.focus()}))}))}handleLiveEventLogic(){(this.hasSubmitConditions||this.hasCalculationField()||this.hasWcDynamicData()||this.hasConditionalFieldLogic())&&(this.form.addEventListener("input",(e=>{"INPUT"!=e.target.tagName&&"TEXTAREA"!=e.target.tagName&&"SELECT"!=e.target.tagName||this.fireFormDataRendering()})),document.addEventListener("brfQuillChange",(e=>{this.fireFormDataRendering()})))}fireFormDataRendering(){this.needsFormDataRendering().length>0&&this.renderFormData(this.needsFormDataRendering()),this.hasConditionalFieldLogic()&&this.handleConditionalLogic()}hasConditionalFieldLogic(){return void 0!==this.form.querySelector("[data-brf-conditions]")}hasWcDynamicData(){return!!document.querySelector(".brf-form-wc-variation-price")}isSyncSteps(){return this.form.id.toLowerCase()==this.remoteSteps.dataset.brfFormId.toLowerCase()}loadingSequences(){if(!this.form.querySelector(".step-progress .next"))return;let e=this.form.querySelector(".step-progress .prev"),t=this.form.querySelector(".step-progress .next");null!=e&&(e.style.display=0==this.currentStep?"none":"inline-block"),null!=t&&(t.style.display=this.currentStep==this.structure.length-1?"none":"inline-block")}async showOnlyFirstStep(){if(this.isMultiStepForm())return new Promise(((e,t)=>{this.hideAllSteps();for(let e of this.structure[0])e&&this.showChild(e);this.handleStepButtonAdjustments(),e()}))}isSubmitStep(){return"none"!=this.form.querySelector(".submit-button-wrapper").style.display}jumpToNextStep(){if(this.currentStep==this.structure.length-1)return;if(0!=this.validateCurrentStep()){this.hideAllSteps();for(let e of this.structure[this.currentStep+1])this.showChild(e);this.currentStep=this.currentStep+1,this.refreshPrevAndNextButtons(),this.hasSummary&&this.isLastStep()&&this.refreshSummary(),(this.hasShowStepsActive||this.hasRemoteSteps)&&this.addClassToCurrentStep(),this.handleConditionalLogic(),this.handleStepButtonAdjustments()}}jumpToPrevStep(){if(0!=this.currentStep){this.hideAllSteps();for(let e of this.structure[this.currentStep-1])this.showChild(e);this.currentStep=this.currentStep-1,this.refreshPrevAndNextButtons(),(this.hasShowStepsActive||this.hasRemoteSteps)&&this.addClassToCurrentStep(),this.handleStepButtonAdjustments(),this.isNestableForm&&this.showChild(this.form.querySelector(".brxe-brf-pro-forms-field-summary-button"))}}handleStepButtonAdjustments(){this.form.querySelector(".step-progress")&&(!this.isSecondLastStep()&&!this.isLastStep()||this.isFirstStep()?this.form.querySelector(".step-progress").style.width="100%":this.form.querySelector(".step-progress").style.width="auto",this.isNestableForm&&this.form.querySelectorAll(".step-progress").forEach((e=>{e.dataset.brfStep&&parseInt(e.dataset.brfStep)!=this.currentStep+1&&(this.hasSummary&&this.isLastStep()&&e.querySelector(".prev")?e.querySelector(".prev").style.display="inline-block":e.style.display="none")})))}showChild(e){if(this.isMultiStepForm()&&e&&(e.style.display=e.dataset.originalDisplay&&e.dataset.originalDisplay||"flex",e.dataset.visible=!0,e.closest(".is-group"))){let t=e.closest(".is-group");t.style.display=t.dataset.originalDisplay||"flex"}}hideChild(e){if(this.isMultiStepForm()&&e&&(window.getComputedStyle(e).display&&"none"!=window.getComputedStyle(e).display&&!e.dataset.originalDisplay&&(e.dataset.originalDisplay=window.getComputedStyle(e).display),e.style.display="none",e.dataset.visible=!1,e.closest(".is-group"))){let t=e.closest(".is-group");window.getComputedStyle(t).display&&"none"==window.getComputedStyle(t).display?t.dataset.originalDisplay=window.getComputedStyle(t).display:t.dataset.originalDisplay="flex",t.style.display="none"}}hideAllSteps(){for(let e of this.structure)for(let t of e)t&&(t.classList.contains("step-progress")||this.hideChild(t))}jumpToStepWithIndex(e){if(this.currentStep!=e){if(this.currentStep<e){if(0==this.validateCurrentStep())return}this.hideAllSteps();for(let t of this.structure[e])this.showChild(t);this.currentStep=parseInt(e),this.refreshPrevAndNextButtons(),this.handleStepButtonAdjustments(),(this.hasShowStepsActive||this.hasRemoteSteps)&&this.addClassToCurrentStep()}}isFirstStep(){return 0==this.currentStep}isLastStep(){return this.currentStep==this.structure.length-1}isSecondLastStep(){return this.currentStep==this.structure.length-2}ignoreValidation(e){if(e.classList.contains("brf-hidden")||"none"==e.style.display)return!0}validateCurrentStep(){for(let e of this.structure[this.currentStep])if(!this.ignoreValidation(e)){if(e.querySelector("input")){if(e.querySelector("input").reportValidity(),!e.querySelector("input").checkValidity())return!1;this.handleLiveValidation(e.querySelector("input"),!0)}if(e.querySelector("textarea")){if(e.querySelector("textarea").reportValidity(),!e.querySelector("textarea").checkValidity())return!1;this.handleLiveValidation(e.querySelector("textarea"),!0)}if(e.querySelector("select")&&(e.querySelector("select").reportValidity(),!e.querySelector("select").checkValidity()))return!1}for(let e of this.structure[this.currentStep])if(e.querySelector(".brf-validation-message")&&!this.ignoreValidation(e))return!1;return!0}refreshPrevAndNextButtons(){const e=this.form.querySelector(".step-progress .prev"),t=this.form.querySelector(".step-progress .next");null!=e&&(e.style.display=0==this.currentStep?"none":"inline-block"),null!=t&&(t.style.display=this.currentStep==this.structure.length-1?"none":"inline-block"),this.hasSummary&&this.currentStep==this.structure.length-2&&null!=t&&(t.style.display="none")}showLoading(){this.form.querySelector("button[type='submit']").classList.add("sending")}hideLoading(){this.form.querySelector("button[type='submit']").classList.remove("sending")}async handleSubmit(){this.form.querySelector("button[type=submit]")&&this.form.querySelector("button[type=submit]").addEventListener("click",(async e=>{e.preventDefault(),this.showLoading();let t=this.form.querySelector('button[type="submit"]');if(this.formIsValid()){if(!1===await this.form_submit())return}this.showResults(t),this.afterFormSubmit(),setTimeout((()=>{this.isSubmitting=!1}),1e3)}),!0)}showResults(e){if(this.form.dataset.brfDisableReset?this.form.addEventListener("reset",(e=>{e.preventDefault()})):this.form.checkValidity()?this.form.querySelectorAll(".ql-editor").forEach((e=>{e.innerHTML=""})):this.hideLoading(),this.isSubmitting=!0,this.results.error)return this.hideLoading(),this.results.error=this.results.error.filter(((e,t,i)=>i.findIndex((t=>t.message===e.message))===t)),void this.results.error.forEach((e=>{this.fireProValidationMessage("error",e.message,!0)}));if(this.hideLoading(),this.results.success&&this.results.success[0].message&&this.fireProValidationMessage("success",this.results.success[0].message),this.results.redirect&&this.results.redirect.length>0){const e=this.results.redirect[0].redirectTo,t=this.results.redirect[0].redirectTimeout?this.results.redirect[0].redirectTimeout:0;e&&setTimeout((()=>{window.location.href=e}),t)}}afterFormSubmit(){this.form.dataset.brfDisableReset||this.form.querySelectorAll(".brf-field-image-preview").forEach((e=>{e.remove()})),this.form.dataset.confetti&&this.fireConfetti()}wcRefreshMiniCart(){document.body.dispatchEvent(new CustomEvent("wc_fragment_refresh"))}async renderFormData(e=[]){const t=await this.runRequests(!0);for(let i of e)switch(i){case"calculation":this.handleCalculationFieldLogic(t);break;case"submitConditions":this.handleConditionalSubmitLogic(t);break;case"wcDynamicData":this.handleWcDynamicData(t)}this.afterInitialRendering()}afterInitialRendering(){this.form.dataset.brfNeedsRendering&&(this.form.dataset.brfNeedsRendering=!1),this.form.dataset.brfSubmitConditions&&(this.form.dataset.brfSubmitConditions=!1)}async handleWcDynamicData(e){if(!document.querySelector(".brf-form-wc-variation-price"))return;const t=document.querySelectorAll(".brf-form-wc-variation-price");for(let i of t){const t=i.dataset.formId;if(e.formID==t&&e.wc&&e.wc.variation_price)return void(i.innerHTML=e.wc.variation_price);i.innerText=""}}getHiddenFields(){let e=[];return this.form.querySelectorAll("[data-validation]").forEach((t=>{if(t.classList.contains("brf-hidden")||t.closest(".brf-hidden")||"none"==window.getComputedStyle(t).display||"none"==window.getComputedStyle(t.closest(".form-group")).display){let i=t.name;t.name&&t.name.includes("form-field-")&&(i=t.name.replace("form-field-",""),e.push(i))}})),e}async runRequests(e=!1,t=null,i=null){const r=[];if(e){if(!this.hasCalculationField()&&!this.hasSubmitConditions&&!this.needsInitialRendering())return;this.hasCalculationField()&&this.form.querySelectorAll(".calculation-field").forEach((e=>{r.push(e.dataset.elementId)}))}let a={};this.form.querySelectorAll(".form-group").forEach((e=>{let t=e.dataset.customId,i=e.dataset.elementId;e.classList.contains("brxe-brf-pro-forms-field-checkbox-wrapper")&&(i+="[]"),t&&i&&(a[t]=i)}));let s=this.form.dataset.brfDynamicPostId,n=BRFELEMENTS.apiurl+"form_submit";if(e&&(n=BRFELEMENTS.apiurl+"render_form_data"),!e&&this.form.querySelector('input[type="file"]')){let e=new FormData,t=this.form.querySelectorAll('input[type="file"]');for(let i=0;i<t.length;i++){let r=t[i],a=r.files,s=r.accept;for(let t=0;t<a.length;t++){let i=a[t];e.append(r.name+"_"+t,i),e.append("allowed_types",s)}}this.form.querySelector("button[type=submit]").classList.add("sending")}let o=new FormData(this.form);o.append("postId",window.bricksData.postId),o.append("formId",this.form.dataset.elementId),o.append("fieldIds",JSON.stringify(a)),o.append("calculationFields",JSON.stringify(r)),o.append("action","bricksforge_form_submit"),o.append("referrer",window.location.href),o.append("hiddenFields",JSON.stringify(this.getHiddenFields())),s&&o.append("dynamicPostId",s),t&&o.append("captchaResult",t),i&&o.append("turnstileResult",i);try{let e=await fetch(n,{method:"POST",headers:{"X-WP-Nonce":BRFELEMENTS.nonce},body:o}),t=await e.json();return t&&t.results&&(this.results=t.results),null!=t.success&&0==t.success?(this.hideLoading(),t):t}catch(e){console.log(e)}}hasCalculationField(){return this.form.querySelector(".calculation-field")}async handleCalculationFieldLogic(e){if(!this.hasCalculationField())return;let t=e.calculations;if(!t||0==t.length){return this.form.querySelectorAll(".calculation-result").forEach((e=>{e.value=e.closest(".calculation-field").dataset.emptyMessage})),void document.querySelectorAll(".brf-form-calculation-value").forEach((e=>{let t=e.dataset.calculationId,i=document.querySelector(`.calculation-result[name="form-field-${t}"]`).closest(".calculation-field").dataset.emptyMessage;e.innerText=i}))}for(let e of t){let t=this.form.querySelector(`[data-field-id="${e.id}"] .calculation-result`);t||(t=this.form.querySelector(`[data-custom-id="${e.id}"] .calculation-result`)),t&&(t.value=e.value);let i=document.querySelectorAll(`.brf-form-calculation-value[data-calculation-id="${e.id}"]`);for(let t of i){let i=this.handleRemotePostCalculation(e.value,t.dataset.calculationOperator,t.dataset.calculationValue,t.dataset.calculationOperator2,t.dataset.calculationValue2,e.hasCurrencyFormat,e.roundValue);t.innerText=i}}}handleRemotePostCalculation(e,t,i,r,a,s=!1,n=!1){if(!t||!i)return e;e=parseFloat(e),i=parseFloat(i);let o=this.performOperation(e,t,i);return r&&a&&(a=parseFloat(a),o=this.performOperation(o,r,a)),n&&(o=Math.round(o)),s&&(o=o.toFixed(2),o=o.replace(/\B(?=(\d{3})+(?!\d))/g,",")),o}performOperation(e,t,i){if(!["add","subtract","multiply","divide"].includes(t))return e;switch(t){case"add":return e+i;case"subtract":return e-i;case"multiply":return e*i;case"divide":return e/i;default:return e}}async resetSubmitButtonText(e){if(!e)return;if(e.match(/\{.*\}/)){let t=BRFELEMENTS.apiurl+"render_dynamic_data?_value="+e+"&_post_id="+(this.form.dataset.brfDynamicPostId?Number(this.form.dataset.brfDynamicPostId):null),i=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":BRFELEMENTS.nonce}}),r=await i.json();r&&(e=r)}this.form.querySelector('button[type="submit"] .text').innerHTML=e}modifySubmitButton({action:e=null,alternativeText:t=null}={}){let i=this.form.querySelector('button[type="submit"]'),r="inline-flex";switch(e){case"hide":i.style.display="none";break;case"show":i.style.display=r,i.removeAttribute("disabled");break;case"disabled":i.setAttribute("disabled","disabled"),i.style.display=r,t&&(i.querySelector(".text").innerText=t);break;default:i.style.display="inline-flex"}}async handleConditionalSubmitLogic(e){if(!this.form.dataset.brfSubmitConditions)return;if(!e.submitConditions)return;const t=e.submitConditionsData;let i=t.relation,r=!1,a=[];for(let i of e.submitConditions){let e;switch(i.condition){case"option":case"post_meta":case"form_field":e=this.startCondition(i.value2,i.data,i.operator,i.dataType),a.push(e);break;case"storage_item":e=this.startCondition(i.value2,window.localStorage.getItem(i.value),i.operator,i.dataType),a.push(e);break;case"submission_count_reached":e=this.startCondition(t.submissionsCount,t.submission_max?t.submission_max:null,!1,!1,!0),a.push(e);break;case"submission_field":e=this.startCondition(i.value2,i.data?i.data[0].value:null,i.operator,i.dataType),a.push(e);break;default:a.push(!1)}}r="and"==i?a.every((e=>1==e)):a.some((e=>1==e)),!0!==r?(t.submitButtonConditionsAlternativeText&&this.resetSubmitButtonText(t.submitButtonText),this.modifySubmitButton({action:"show"})):this.modifySubmitButton({action:t.submitButtonConditionAction,alternativeText:t.submitButtonConditionsAlternativeText?t.submitButtonConditionsAlternativeText:null})}saveOriginalDisplayState(e){window.getComputedStyle(e).display&&"none"!=window.getComputedStyle(e).display&&!e.dataset.originalDisplay&&(e.dataset.originalDisplay=window.getComputedStyle(e).display)}handleConditionalFieldLogic(e,t,i){if(!t)return!0;this.saveOriginalDisplayState(e);let r=!1,a=[];for(let e of t){let t;switch(e.condition){case"form_field":let i=this.form.querySelector(`[name="form-field-${e.value}"]`);i||(i=this.form.querySelector(`[name="form-field-${e.value}[]"]:checked`));const r=i?i.value:null;r||a.push(!1),t=this.startCondition(e.value2,r,e.operator,e.type),a.push(t);break;case"storage_item":const s=localStorage.getItem(e.value);t=this.startCondition(e.value2,s,e.operator,e.type),a.push(t)}}r="and"==i?a.every((e=>e)):a.some((e=>e));if(this.isMultiStepForm()){if(this.currentStep+1!=parseInt(e.dataset.brfStep))return!0}!1===r?(e.style.setProperty("display","none"),e.classList.add("brf-hidden")):(e.dataset.originalDisplay&&"none"!=e.dataset.originalDisplay?e.style.setProperty("display",e.dataset.originalDisplay):e.style.setProperty("display","flex"),e.classList.remove("brf-hidden"))}startCondition(e,t,i,r="string",a=!1){if(a){return isNaN(e)||(e=parseFloat(e)),isNaN(t)||(t=parseFloat(t)),e>=t}if(!(e&&t||"exists"==i||"empty"==i||"not_exists"==i||"not_empty"==i))return!1;switch("number"==r&&(e=parseFloat(e),t=parseFloat(t)),"string"==typeof e&&(e=e.replace(/(<([^>]+)>)/gi,"")),"string"==typeof t&&(t=t.replace(/(<([^>]+)>)/gi,"")),i){case"==":return e==t;case"!=":return e!=t;case">":return t>e;case"<":return t<e;case">=":return t>=e;case"<=":return t<=e;case"contains":return t.includes(e);case"not_contains":return!t.includes(e);case"starts_with":return t.startsWith(e);case"ends_with":return t.endsWith(e);case"empty":return"array"==r?0==t.length:!t||""==t;case"not_empty":return"array"==r?t.length>0:t&&""!=t;case"exists":return t&&""!=t;case"not_exists":return!t||""==t;default:return!1}}disableSubmitButton(){this.form.querySelector("button[type=submit]").setAttribute("disabled","disabled")}enableSubmitButton(){this.form.querySelector("button[type=submit]").removeAttribute("disabled")}hideSubmitButton(){this.form.querySelector("button[type=submit]").style.display="none"}showSubmitButton(){this.form.querySelector("button[type=submit]").style.display="inline-block"}formIsValid(){for(let e of this.form.querySelectorAll("[required]"))if(!e.closest(".brf-hidden")&&!e.checkValidity())return e.reportValidity(),!1;return!0}isMultiStepForm(){return this.form.classList.contains("brxe-form-multistep")||null!=this.form.querySelector(".step")}async checkForCaptchas(){return new Promise((async(e,t)=>{if(this.form.querySelector(".brf-hcaptcha-wrapper .h-captcha")){const r=this.form.querySelector(".h-captcha iframe").dataset.hcaptchaWidgetId;var i=hcaptcha.getResponse(r);if(""===i)return t("hCaptcha challenge not completed"),!1;e(i)}else e(!0)}))}async checkForTurnstile(){const e=new FormData(this.form).get("cf-turnstile-response");return e||!1}async form_submit(){return new Promise((async(e,t)=>{let i;try{i=await this.checkForCaptchas()}catch(t){e(!1)}if(!i){let t="Please verify that you are not a robot.",i=this.form.querySelector(".brf-hcaptcha-wrapper");return i.dataset.info&&(t=i.dataset.info),this.fireProValidationMessage("error",t,!0),e(!1),!1}const r=await this.checkForTurnstile(),a=await this.runRequests(!1,i,r);if(a&&a.webhook&&Array.isArray(a.webhook)&&a.webhook.length>0&&console.log("Webhook Result",a.webhook),null!=a.success&&0==a.success)return a.data.message&&this.fireProValidationMessage("error",a.data.message),a.data.validation&&a.data.validation.forEach((e=>{let t=this.form.querySelector('[name="'+e.field+'"]');t&&t.dataset.showMessageBelowField?(t.dataset.showValidationMessage=!0,this.handleValidationEvents(!0),this.markFieldAsInvalid(t,e)):this.fireProValidationMessage("error",e.message,!0)})),e(!1),!1;if(a&&a.data&&a.data.status)switch(a.data.status){case 401:case 403:case 500:return this.fireProValidationMessage("error",a.message),e(!1),this.hideLoading(),!1}await this.handleProValidation(a)||e(!1);for(let e in a)switch(e){case"update_option":case"update_post_meta":this.liveUpdateValue(a[e]),this.handleConditionalSubmitLogicIfNeeded();break;case"update_user_meta":this.liveUpdateValue(a[e]);break;case"set_storage_item":this.setStorageItems(a[e]),this.liveUpdateValue(a[e]),this.handleConditionalSubmitLogicIfNeeded();break;case"wc_add_to_cart":!0===a[e]&&document.body.dispatchEvent(new CustomEvent("added_to_cart",{}))}e(!0)}))}async handleProValidation(e){for(let t in e)if("create_submission"===t)if(e[t]&&e[t].status&&"duplicate"==e[t].status)return this.fireProValidationMessage(e[t].message),!1;return!0}fireProValidationMessage(e="error",t,i=!1){this.form.querySelector("button[type=submit]").addEventListener("click",(function(){this.form.querySelectorAll(".message").forEach((e=>{e.style.display="none"}))})),setTimeout((()=>{const r=this.form.querySelector(".message.danger");r&&!i&&this.form.removeChild(r);const a=document.createElement("div");"error"==e?a.classList.add("message","danger","error"):a.classList.add("message","success");const s=document.createElement("div");s.classList.add("text"),s.textContent=t,a.appendChild(s),this.form.appendChild(a),"error"==e&&(this.hideLoading(),setTimeout((()=>{a.style.display="none"}),5e3),a.addEventListener("click",(()=>{a.style.display="none"})))}),50)}handleConditionalSubmitLogicIfNeeded(){this.form.dataset.brfSubmitConditions&&this.renderFormData(["submitConditions"])}liveUpdateValue(e){if("object"==typeof e)for(let t of e){if(!t.selector||!t.live)continue;let e=document.querySelector(t.selector);if(null==e)continue;let i=this.dispatchLiveUpdateSelectorEvent("brf_live_update",t);setTimeout((()=>{i.detail.newValue&&(t.value=i.detail.newValue),i.detail.newTarget&&(e=document.querySelector(i.detail.newTarget)),i.defaultPrevented||(this.form.querySelector(t.selector)&&!i.detail.newTarget?this.form.querySelector(t.selector).innerHTML=t.value:e.innerHTML=t.value)}))}}dispatchLiveUpdateSelectorEvent(e,t){const i=document.querySelector(t.selector);if(!i)return;if(!(i instanceof HTMLElement))return;let r=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0});return this.form.dispatchEvent(r),r}setStorageItems(e){if("object"==typeof e)for(let t of e)if(t.name)try{let e=window.localStorage.getItem(t.name);switch(t.type){case"replace":window.localStorage.setItem(t.name,t.value);break;case"increment":e?window.localStorage.setItem(t.name,parseInt(e)+1):window.localStorage.setItem(t.name,1);break;case"decrement":e&&window.localStorage.setItem(t.name,parseInt(e)-1);break;case"increment_by_number":e?window.localStorage.setItem(t.name,parseInt(e)+parseInt(t.value)):window.localStorage.setItem(t.name,parseInt(t.value));break;case"decrement_by_number":e&&window.localStorage.setItem(t.name,parseInt(e)-parseInt(t.value));break;case"add_to_array":if(e)if(brfIsParsable(e)&&"object"==typeof JSON.parse(e)){let i=JSON.parse(e);i.push(t.value),window.localStorage.setItem(t.name,JSON.stringify(i))}else window.localStorage.setItem(t.name,JSON.stringify([e,t.value]));else window.localStorage.setItem(t.name,JSON.stringify([t.value]));break;case"remove_from_array":if(e&&brfIsParsable(e)&&"object"==typeof JSON.parse(e)){let i=JSON.parse(e),r=i.indexOf(t.value);r>-1&&i.splice(r,1),window.localStorage.setItem(t.name,JSON.stringify(i))}}}catch(e){console.log(e)}}}var brfScrollVideoInstances=[],brfScrollVideoCurrentInstance=null;class BrfScrollVideo{scrollVideo;data={src:null,transitionSpeed:8,frameThreshold:.1,cover:!1,sticky:!1,full:!0,trackScroll:!0,useWebCodecs:!0,debug:!1};constructor(e){this.scrollVideo=e,this.init()}init(){if(!ScrollyVideo)throw new Error("The Scroll Video Library is not defined");this.buildVars(),this.createInstance()}buildVars(){this.scrollVideo.dataset.src&&(this.data.src=this.scrollVideo.dataset.src),this.scrollVideo.dataset.transitionSpeed&&(this.data.transitionSpeed=this.scrollVideo.dataset.transitionSpeed),this.scrollVideo.dataset.frameThreshold&&(this.data.frameThreshold=this.scrollVideo.dataset.frameThreshold),this.scrollVideo.dataset.cover?this.data.cover=this.scrollVideo.dataset.cover:this.data.cover=!1,this.scrollVideo.dataset.sticky&&1==this.scrollVideo.dataset.sticky?this.data.sticky=this.scrollVideo.dataset.sticky:this.data.sticky=!1,this.scrollVideo.dataset.full?this.data.full=this.scrollVideo.dataset.full:this.data.full=!1,this.scrollVideo.dataset.useWebCodecs?this.data.useWebCodecs=this.scrollVideo.dataset.useWebCodecs:this.data.useWebCodecs=!1,this.scrollVideo.dataset.debug?this.data.debug=this.scrollVideo.dataset.debug:this.data.debug=!1}createInstance(){!bricksIsFrontend&&brfScrollVideoInstances.includes(this.scrollVideo.id)||(0==this.data.full&&(this.data.cover=!1,this.data.useWebCodecs=!1),brfScrollVideoCurrentInstance=new ScrollyVideo({scrollyVideoContainer:this.scrollVideo,src:this.data.src,transitionSpeed:this.data.transitionSpeed,frameThreshold:this.data.frameThreshold,cover:this.data.cover,sticky:this.data.sticky,full:this.data.full,trackScroll:this.data.trackScroll,useWebCodecs:!!bricksIsFrontend&&this.data.useWebCodecs,debug:this.data.debug}),brfScrollVideoInstances.push(this.scrollVideo.id))}}class BrfThreeJs{root;scene;camera;renderer;loader;controls;data={};model;models=[];clock;mixer;constructor(e){this.root=e,this.init()}init(){if(!THREE)throw new Error("The Three.js Library is not defined");this.clock=new THREE.Clock,this.data=this.root.dataset.data?JSON.parse(this.root.dataset.data):{},this.data=this.convertNumericToFloat(this.data),this.identifyModel(),this.createScene(),this.addModel(),this.animate=this.animate.bind(this),this.animate()}convertNumericToFloat(e){for(let t in e)"string"!=typeof e[t]||isNaN(e[t])||(e[t]=parseFloat(e[t]));return e}identifyModel(){if(this.data&&this.data.model){if("string"==typeof this.data.model&&this.data.model.includes(".gltf"))return void(this.model=this.data.model);const e=this.data.model.filename,t=BRFELEMENTS.uploadsDirectory+"/bricksforge/models/"+this.data.model.id+"/"+e;this.model=t}}createScene(){this.scene=new THREE.Scene,this.handleCamera(),this.handleLight(),this.handleRenderer(),this.handleControls(),window.addEventListener("resize",(()=>{this.handleResize()}))}handleCamera(){this.camera=new THREE.PerspectiveCamera(this.data.cameraFov,window.innerWidth/window.innerHeight,this.data.cameraNear,this.data.cameraFar),this.camera.position.x=this.data.cameraPositionX,this.camera.position.y=this.data.cameraPositionY,this.camera.position.z=this.data.cameraPositionZ}handleRenderer(){this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:this.data.rendererAntialiasing}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.root.querySelector("canvas")||this.root.querySelector(".brf-three-js-scene").appendChild(this.renderer.domElement)}handleLight(){this.data.light.forEach((e=>{let t;switch((e=this.convertNumericToFloat(e)).type){case"ambient":t=new THREE.AmbientLight(e.color.hex,e.intensity);break;case"directional":t=new THREE.DirectionalLight(e.color.hex,e.intensity);break;case"hemisphere":t=new THREE.HemisphereLight(e.color.hex,e.groundColor,e.intensity);break;case"point":t=new THREE.PointLight(e.color.hex,e.intensity,e.distance,e.decay);break;case"rectarea":t=new THREE.RectAreaLight(e.color.hex,e.intensity,e.width,e.height);break;case"spot":t=new THREE.SpotLight(e.color.hex,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;default:t=new THREE.AmbientLight(e.color,e.intensity)}t.position.set(e.positionX,e.positionY,e.positionZ),e.castShadow&&(t.castShadow=!0),this.scene.add(t)}))}handleControls(){this.data.enableInteraction&&(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.minDistance=this.data.minDistance,this.controls.maxDistance=this.data.maxDistance,this.controls.enablePan=!0===this.data.enablePan,this.controls.enableZoom=!0===this.data.enableZoom,this.controls.enableRotate=!0===this.data.enableRotate,!0===this.data.preventBottomView&&(this.controls.maxPolarAngle=Math.PI/2),!0===this.data.preventTopView&&(this.controls.minPolarAngle=Math.PI/2),this.controls.rotateSpeed=this.data.rotateSpeed,this.controls.zoomSpeed=this.data.zoomSpeed,this.controls.panSpeed=this.data.panSpeed)}saveModels(){window.bricksforgeData=window.bricksforgeData||{},window.bricksforgeData.models=this.models||{},window.parent!==window&&(window.parent.bricksforgeData=window.bricksforgeData)}addModel(){this.loader=new THREE.GLTFLoader,this.loader.load(this.model,(e=>{const t=e.scene;t.scale.set(this.data.modelScaleX,this.data.modelScaleY,this.data.modelScaleZ),t.position.set(this.data.modelPositionX,this.data.modelPositionY,this.data.modelPositionZ),t.rotation.set(this.data.modelRotationX,this.data.modelRotationY,this.data.modelRotationZ),this.scene.add(t),this.models[this.data.id]=t,this.saveModels(),this.mixer=new THREE.AnimationMixer(t),e.animations.forEach((e=>{this.mixer.clipAction(e).play()}))}))}handleResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}handleAnimation(){if(this.models[this.data.id])switch(this.data.animationType){case"rotateLeft":this.models[this.data.id].rotation.y+=this.data.animationSpeed;break;case"rotateRight":this.models[this.data.id].rotation.y-=this.data.animationSpeed;break;case"rotateUp":this.models[this.data.id].rotation.x+=this.data.animationSpeed;break;case"rotateDown":this.models[this.data.id].rotation.x-=this.data.animationSpeed}}animate(){if(requestAnimationFrame(this.animate),this.mixer&&this.data.allowAnimation){const e=this.clock.getDelta();this.mixer.update(e)}this.data.enableAnimation&&this.data.animationType&&this.handleAnimation(),this.renderer.render(this.scene,this.camera)}}