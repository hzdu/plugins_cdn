!function(i){"use strict";i.fn.avia_masonry=function(a){if(!this.length)return this;var t=i("body"),e=i(window),o=i.avia_utilities.isMobile,n=(i.avia_utilities.isTouchDevice,t.hasClass("avia-mobile-no-animations")),s=!1,r={masonry_filter:function(){var a=i(this),t=a.html(),o=a.data("filter"),n=a.parents(".av-masonry").eq(0),s=n.find(".av-masonry-container").eq(0),l=n.find(".av-masonry-sort a"),d=n.find(".av-current-sort-title");return l.removeClass("active_sort"),a.addClass("active_sort"),s.attr("id","masonry_id_"+o),d.length&&d.html(t),r.applyMasonry(s,o,(function(){s.css({overflow:"visible"})})),setTimeout((function(){e.trigger("debouncedresize")}),500),!1},applyMasonry:function(a,t,o){var n=t?{filter:"."+t}:{};n.layoutMode="packery",n.packery={gutter:0},n.percentPosition=!0,n.itemSelector="a.isotope-item, div.isotope-item",n.originLeft=!i("body").hasClass("rtl"),a.isotope(n,(function(){e.trigger("av-height-change")})),"function"==typeof o&&setTimeout(o,0)},show_bricks:function(a,t){var s=i.avia_utilities.supports("transition"),r=o&&n?0:100;a.each((function(o){var n=i(this),l=n.find(".avia-curtain-reveal-overlay");l.length>0&&(r=500,l.on("animationstart",(function(i){n.css({visibility:"visible"})})),l.on("animationend",(function(a){i(this).remove()}))),setTimeout((function(){!1===s?n.css({visibility:"visible",opacity:0}).animate({opacity:1},1500):(n.addClass("av-masonry-item-loaded"),l.addClass("avia_start_delayed_animation")),o==a.length-1&&"function"==typeof t&&(t.call(),e.trigger("av-height-change"))}),r*o)}))},loadMore:function(a){if(a.preventDefault(),s)return!1;s=!0;var o=i(this),n=o.data(),l=o.parents(".av-masonry").eq(0),d=l.data("post_id"),v=l.find(".av-masonry-container"),c=l.find(".av-masonry-entry"),f=i.avia_utilities.loading(),u=function(){s=!1,f.hide(),t.trigger("av_resize_finished")};void 0!==d&&(n.post_id=d),n.offset||(n.offset=0),n.offset+=n.items,n.action="avia_ajax_masonry_more",n.loaded=[],c.each((function(){var a=i(this).data("av-masonry-item");a&&n.loaded.push(a)})),i.ajax({url:avia_framework_globals.ajaxurl,type:"POST",data:n,beforeSend:function(){f.show()},success:function(a){if(-1!==a.indexOf("{av-masonry-loaded}")){a=a.split("{av-masonry-loaded}");var t=i(a.pop()).filter(".isotope-item");t.length>n.items?t=t.not(t.last()):o.addClass("av-masonry-no-more-items"),t.find(".avia-animate-admin-preview").removeClass("avia-animate-admin-preview"),t.find(".avia-curtain-reveal-overlay").length>0&&t.css({visibility:"hidden"});var s=i('<div class="loadcontainer"></div>').append(t);i.avia_utilities.preload({container:s,single_callback:function(){var a=l.find(".av-masonry-sort a"),o=l.find(".av-sort-by-term"),n=o.data("av-allowed-sort");o.hide(),f.hide(),v.isotope("insert",t),i.avia_utilities.avia_ajax_call(l),setTimeout((function(){r.show_bricks(t,u)}),150),setTimeout((function(){e.trigger("av-height-change")}),550),a&&i(a).each((function(a){var e=i(this),o=e.data("filter");t&&i(t).each((function(a){if(i(this).hasClass(o)&&-1!==n.indexOf(o)){var t=e.find(".avia-term-count").text();e.find(".avia-term-count").text(" "+(parseInt(t)+1)+" "),e.hasClass("avia_hide_sort")&&(e.removeClass("avia_hide_sort").addClass("avia_show_sort"),l.find(".av-masonry-sort ."+o+"_sep").removeClass("avia_hide_sort").addClass("avia_show_sort"),l.find(".av-masonry-sort .av-sort-by-term").removeClass("hidden"))}}))})),o.fadeIn()}})}else u()},error:u,complete:function(){setTimeout((function(){e.trigger("debouncedresize")}),500)}})}};return this.each((function(){var a=i(this),t=a.find(".av-masonry-container"),e=a.find(".isotope-item"),s=a.find(".av-masonry-sort").css({visibility:"visible",opacity:0}).on("click","a",r.masonry_filter),l=a.find(".av-masonry-load-more").css({visibility:"visible",opacity:0});e.find(".avia-curtain-reveal-overlay").length>0&&e.css({visibility:"hidden"}),i.avia_utilities.preload({container:t,single_callback:function(){var d=function(){s.animate({opacity:1},400),t.outerHeight()+t.offset().top+i("#footer").outerHeight()>i(window).height()&&i("html").css({"overflow-y":"scroll"}),r.applyMasonry(t,!1,(function(){a.addClass("avia_sortable_active"),t.removeClass("av-js-disabled")})),r.show_bricks(e,(function(){l.css({opacity:1}).on("click",r.loadMore)}))};o&&n?d():a.waypoint(d,{offset:"80%"}),i(window).on("debouncedresize",(function(){r.applyMasonry(t,!1,(function(){a.addClass("avia_sortable_active")}))}))}})}))}}(jQuery);