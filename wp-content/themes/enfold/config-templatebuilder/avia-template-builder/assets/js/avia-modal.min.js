!function(a){"use strict";if(a.AviaElementBehavior=a.AviaElementBehavior||{},a.AviaElementBehavior.wp_media=a.AviaElementBehavior.wp_media||[],a.AviaCriticalModalChars=a.AviaCriticalModalChars||[],"string"==typeof avia_modal_L10n.alb_critical_modal_charecters){var e=avia_modal_L10n.alb_critical_modal_charecters.split(",");a.AviaCriticalModalChars=a.AviaCriticalModalChars.concat(e)}a.AviaModal=function(e){var t={obj_clicked:null,template_changed:!1,scope:this,modal_title:"",modal_class:"",modal_content:!1,modal_ajax_hook:"",on_save:function(){},on_load:function(){},before_save:"",save_param:{},before_close:function(){},ajax_param:{},button:"save",autoclose:!1,args:{}};a.AviaModal.openInstance.unshift(this),this.instanceNr=a.AviaModal.openInstance.length,this.options=a.extend({},t,e),this.namespace=".AviaModal"+this.instanceNr,this.body=a("body").addClass("avia-noscroll"),this.wrap=a("#wpwrap"),this.doc=a(document),this.modal=a('<div class="avia-modal avia-style"></div>'),this.backdrop=a('<div class="avia-modal-backdrop"></div>'),this.customElements=new a.AviaModalElementTemplates(this),this.has_modal_popup_state="active"==a.avia_builder.activeStatus.val()&&"function"==typeof this.options.save_param.hasClass,this.custom_elements_allowed=this.has_modal_popup_state,this.custom_elements_allowed||this.modal.addClass("no-custom-element-editing-allowed"),this.modal.addClass("modal-instance-"+this.instanceNr),this.modal.data("avia_modal_object",this),this.set_up()},a.AviaModal.openInstance=[],a.AviaModal.prototype={set_up:function(){var e=this;a("body").one("avia_modal_finished",(function(){setTimeout((function(){e.set_to_last_state(),e.critical_characters_warning()}),200)})),this.create_html(),this.add_behavior(),this.modify_binding_order(),this.propagate_modal_open()},add_behavior:function(){var a=this;if(this.customElements.initTemplateSupport(),!1!==a.options.autoclose){var e=parseInt(a.options.autoclose,10);if(!isNaN(e)){a.modal.addClass("modal-autoclose");var t=a.modal.find(".avia-modal-inner-header a.avia-modal-close");setTimeout((function(){t.trigger("click")}),e)}}this.modal.on("click",".avia-modal-save",(function(e,t){return a.canSaveModal()?(a.modal.find("input.avia-fake-input, textarea.avia-fake-input").remove(),a.modal.find(".av-elements-item-select select").prop("disabled",!1),a.execute_callback(t),!1):(alert("Not able to save at this moment"),!1)})),this.backdrop.add(".avia-attach-close-event",this.modal).on("click",(function(){return a.close(),!1})),this.doc.on("keydown"+this.namespace,(function(e){a.media_overlay_closed()&&a.link_overlay_closed()&&(13!=e.keyCode||e.target.tagName&&"textarea"==e.target.tagName.toLowerCase()||(setTimeout((function(){a.execute_callback()}),100),e.stopImmediatePropagation()),27==e.keyCode&&(setTimeout((function(){a.close()}),100),e.stopImmediatePropagation()))}))},modify_binding_order:function(){var a=jQuery.hasData(document)&&jQuery._data(document),e=a.events.keydown.pop();a.events.keydown.unshift(e)},create_html:function(){if(this.options.modal_class&&this.modal.addClass(this.options.modal_class),this.custom_elements_allowed&&this.modal.hasClass("avia-modal-edit-custom-element")){var e=this.modal.hasClass("avia-modal-group-shortcode")?this.options.custom_modal_subitem_title:this.options.custom_modal_title;void 0!==e&&(this.options.modal_title+=void 0!==e?e:" (Custom Element)")}var t=this.options.modal_content?this.options.modal_content:"",i=this.options.attach_content?this.options.attach_content:"",o=this.options.modal_content?"":" preloading ",n='<h3 class="avia-modal-title">'+this.options.modal_title+"</h3>",l=a('<div class="avia_footer_loading avia_loading"></div>'),s='<div class="avia-modal-inner">';s+='<div class="avia-modal-inner-header">'+n+'<a href="#close" class="avia-modal-close avia-attach-close-event">X</a></div>',s+='<div class="avia-modal-inner-content '+o+'">'+t+"</div>",s+=i,s+='<div class="avia-modal-inner-footer">',"save"===this.options.button?s+='<a href="#save" class="avia-modal-save button button-primary button-large">'+avia_modal_L10n.save+"</a>":"close"===this.options.button?s+='<a href="#close" class="avia-attach-close-event button button-primary button-large">'+avia_modal_L10n.close+"</a>":s+=this.options.button,s+="</div></div>",this.wrap.append(this.modal).append(this.backdrop),this.modal.html(s),this.modal.find(".avia-modal-inner-footer").first().prepend(l);var d=this.instanceNr-1,r=parseInt(this.modal.css("zIndex"),10);this.modal.css({margin:30*d,zIndex:r+d+1}),this.backdrop.css({zIndex:r+d}),this.options.modal_content?this.on_load_callback():this.fetch_ajax_content()},set_to_last_state:function(){var e=a.avia_builder;if(this.has_modal_popup_state){var t=e.modal_popup_state;if(!1!==t){var i=this.options.save_param,o=i.data("shortcodehandler"),n=i.hasClass("avia-modal-group-element"),l=n?"avia-modal-group-last-open":"avia-modal-element-last-open";if(a("body").find("."+l).length>0&&!i.hasClass(l))e.clear_modal_popup_state(o,n);else{var s=n?t.group_shortcode:t.shortcode,d=n?t.group_tab_text:t.tab_text,r=n?t.group_toggle_text:t.toggle_text;if(o==s){var c=this.modal.find(".avia-modal-tab-container"),p=c.find(".avia-modal-tab-titles a"),m="";if(p.each((function(e){var t=a(this);if((m=t.html())==d)return t.trigger("click"),!1})),""!=m){var v=c.find('.avia-modal-tab-container-inner[data-tab-name="'+m+'"]');if(""!=r){var _=v.find('.avia-modal-toggle-container-inner[data-toggle-name="'+r+'"]');if(0!=_.length){var h=_.closest(".avia-modal-toggle-visibility-wrap").find("a.avia-modal-toggle-title");h.hasClass("active-modal-toggles")||h.trigger("click")}}}}else e.clear_modal_popup_state(o,n)}}}},critical_characters_warning:function(){var e=this.modal.find('input[type="text"], textarea');e.on("change"+this.namespace+" keyup"+this.namespace,(function(e){var t=a(e.currentTarget),i=t.closest(".avia-form-element"),o=i.closest(".avia-form-element-container"),n=i.find(".avia-critical-char-msg");if(!o.hasClass("avia-no-special-character-msg")&&0!=n.length){var l=t.val(),s=!1;a.each(a.AviaCriticalModalChars,(function(a,e){if(l.indexOf(e)>-1)return s=!0,!1})),s?i.addClass("avia-has-critical-character"):i.removeClass("avia-has-critical-character")}})),e.trigger("change"+this.namespace)},set_focus:function(){var a=this.modal.find("select, input[type=text], input[type=checkbox], textarea, radio").eq(0);a.is(".av-no-autoselect")||a.trigger("focus")},show_loading_icon:function(){this.modal.addClass("loading")},hide_loading_icon:function(){this.modal.removeClass("loading")},disable_save_button:function(){this.modal.addClass("disable-save-button")},enable_save_button:function(){this.modal.removeClass("disable-save-button")},canSaveModal:function(){return!(this.modal.hasClass("hide-save-button")||this.modal.hasClass("disable-save-button"))},fetch_ajax_content:function(){var e=this,t=e.options,i=e.modal.find(".avia-modal-inner-content"),o=a('form[id="post"]').find("#post_ID"),n=e.modal.hasClass("avia-modal-group-shortcode")?"modal_group":"base_element",l=e.custom_elements_allowed&&e.modal.hasClass("avia-modal-edit-custom-element"),s="",d=0,r=e.modal.hasClass("avia-edit-item-template")?"item_element":"base_element";o=o.length>0?o.val():0;l&&(s=void 0===t.element_post_type?"":t.element_post_type,d=void 0===t.element_id?0:t.element_id),a.ajax({type:"POST",url:ajaxurl,data:{action:"avia_ajax_"+this.options.modal_ajax_hook,params:this.options.ajax_param,template_changed:this.options.template_changed,ajax_fetch:!0,instance:this.instanceNr,avia_request:!0,post_type:a(".avia-builder-main-wrap").data("post_type"),post_id:o,modal_popup:n,edit_element:l,element_post_type:s,element_id:d,element_edit_type:r},wpColorPicker:function(){a.AviaModal.openInstance[0].close(),new a.AviaModalNotification({mode:"error",msg:avia_modal_L10n.ajax_error})},success:function(t){if(0==t)a.AviaModal.openInstance[0].close(),new a.AviaModalNotification({mode:"error",msg:avia_modal_L10n.login_error});else if("-1"==t)a.AviaModal.openInstance[0].close(),new a.AviaModalNotification({mode:"error",msg:avia_modal_L10n.timeout});else{var o=a(t);if(e.custom_elements_allowed&&e.modal.hasClass("avia-modal-edit-custom-element")){var n=o.find(".avia-modal-group-element").eq(0);n.length>0&&(n.data("element_id",e.options.element_id),n.data("element_post_type",e.options.element_post_type),n.data("custom_is_item",e.options.custom_is_item),n.data("custom_modal_title",e.options.custom_modal_title),n.data("custom_modal_subitem_title",e.options.custom_modal_subitem_title),n.data("custom_element_title",e.options.custom_element_title),n.data("custom_element_tooltip",e.options.custom_element_tooltip),n.data("custom_element_shortcode_select",e.options.custom_element_shortcode_select))}i.html(o),e.on_load_callback()}},complete:function(a){i.removeClass("preloading"),e.options.template_changed&&e.execute_callback("no_close")}})},on_load_callback:function(){var e,t=this.options.on_load,i=0;if("string"==typeof t)for(i in e=t.split(", "))void 0!==a.AviaModal.register_callback[e[i]]?a.AviaModal.register_callback[e[i]].call(this):(avia_log('modal_on_load function "$.AviaModal.register_callback.'+e[i]+'" not defined',"error"),avia_log("Make sure that the modal_on_load function defined in your Shortcodes config array exists","help"));else"function"==typeof t&&t.call();this.set_focus(),this.propagate_modal_content()},close:function(){"function"==typeof this.options.before_close&&this.options.before_close.call(this.options.scope,this.modal),a.AviaModal.openInstance.shift(),this.doc.trigger("avia_modal_before_close",[this]),this.doc.trigger("avia_modal_before_close_instance"+this.namespace,[this]),this.modal.removeData(),this.modal.remove(),this.backdrop.remove(),this.doc.trigger("avia_modal_close",[this]).off("keydown"+this.namespace),0==a.AviaModal.openInstance.length&&this.body.removeClass("avia-noscroll")},convert_values:function(e){var t={};return a.each(e,(function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""})),t},get_final_values:function(){var e=this.modal.find("input, select, radio, textarea").not(".avia_ignore_on_save").serializeArray(),t=this.convert_values(e);return void 0!==a.AviaModal.register_callback[this.options.before_save]&&(t=a.AviaModal.register_callback[this.options.before_save].call(this.options.scope,t,this.options.save_param)),t},execute_callback:function(a){var e=this.get_final_values();!1!==this.options.on_save.call(this.options.scope,e,this.options.save_param,"",this)&&("string"!=typeof a||"no_close"!=a)&&this.close()},media_overlay_closed:function(){return!a.AviaElementBehavior.wp_media.length},link_overlay_closed:function(){return!a("#wp-link-wrap:visible").length},propagate_modal_open:function(){this.body.trigger("avia_modal_open",this)},propagate_modal_content:function(){this.body.trigger("avia_modal_finished",this)}},a.AviaModalNotification=function(e){var t={modal_title:"<span class='avia-msg-"+e.mode+"'>"+avia_modal_L10n[e.mode]+"</span>",modal_content:"<div class='avia-form-element-container'>"+e.msg+"</div>",modal_class:"flexscreen",button:"close"};return this.options=a.extend({},t,e),new a.AviaModal(this.options)},a.AviaModal.register_callback=a.AviaModal.register_callback||{},a.AviaModal.register_callback.modal_start_sorting=function(e){var t=(e||this.modal).find(".avia-modal-group"),i={handle:".avia-attach-modal-element-move",items:".avia-modal-group-element",placeholder:"avia-modal-group-element-highlight",tolerance:"pointer",forcePlaceholderSize:!0,start:function(e,t){a(".avia-modal-group-element-highlight").height(t.item.outerHeight()).width(t.item.outerWidth())},update:function(a,e){},stop:function(a,e){}};t.find(".avia-modal-group-element, .avia-insert-area").disableSelection(),t.sortable(i)},a.AviaModal.register_callback.modal_load_iconfont_filter=function(){this.modal.find(".av-icon-filter-container").each((function(){let e=a(this),t=e.find(".av-icon-filter-select"),i=e.find(".av-icon-filter-input"),o=e.closest(".avia-form-element ").find(".avia_icon_select_container"),n=o.find(".av-iconselect-heading"),l=o.find(".avia_icon_preview");t.on("change",(function(e){let t=a(this).find("option:selected"),i=t.length?t.val():"";""==i.trim()?(n.removeClass("avia-icon-filter-select-hide"),l.removeClass("avia-icon-filter-select-hide")):(n.each((function(){let e=a(this);e.data("element-font")==i?e.removeClass("avia-icon-filter-select-hide"):e.addClass("avia-icon-filter-select-hide")})),l.each((function(){let e=a(this);e.data("element-font")==i?e.removeClass("avia-icon-filter-select-hide"):e.addClass("avia-icon-filter-select-hide")})))})),i.on("keyup",(function(e){let t=a(this).val().toLowerCase();""==t.trim()?l.removeClass("avia-icon-filter-input-hide"):l.each((function(){let e=a(this);-1!==e.data("element-name").toLowerCase().indexOf(t)?e.removeClass("avia-icon-filter-input-hide"):e.addClass("avia-icon-filter-input-hide")}))}))}))},a.AviaModal.register_callback.modal_load_colorpicker=function(){var e=["#000000","#ffffff","#B02B2C","#edae44","#eeee22","#83a846","#7bb0e7","#745f7e","#5f8789","#d65799","#4ecac2"];void 0!==avia_globals.color_palettes&&(e=avia_globals.color_palettes);var t={palettes:e,change:function(e,t){a(this).trigger("av-update-preview")},clear:function(){a(this).trigger("keyup")}},i=this.modal,o=i.find(".av-colorpicker").avia_wpColorPicker(t),n=i.find(".wp-color-result");void 0!==avia_globals.color_palettes_class&&i.find(".av-colorpicker").closest(".avia-element-colorpicker").addClass(avia_globals.color_palettes_class),o.on("click",(function(e){a(this);var t=a(this).parents(".wp-picker-container").eq(0),o=t.find(".wp-color-result"),n=t.find(".wp-picker-holder .iris-picker");o.hasClass("wp-picker-open")||o.addClass("wp-picker-open"),"block"!=n.css("display")&&n.css({display:"block"}),i.find(".wp-picker-open").not(o).trigger("click"),a("body").one("click",(function(a){"block"==n.css("display")&&n.css({display:"none"}),o.hasClass("wp-picker-open")&&o.removeClass("wp-picker-open")}))})),n.on("click",(function(a){if(void 0!==a.originalEvent)i.find(".wp-picker-open").not(this).trigger("click")})),a(document).one("avia_modal_before_close_instance"+this.namespace,(function(){n.off().remove(),o.off().remove(),o.iris()}))},a.AviaModal.register_callback.modal_load_datepicker=function(){var e=this.modal.find(".av-datepicker"),t=["showButtonPanel","closeText","currentText","nextText","prevText","monthNames","monthNamesShort","dayNames","dayNamesShort","dayNamesMin","dateFormat","firstDay","isRTL","changeMonth","changeYear","yearRange","minDate","maxDate"],i=["monthNames","monthNamesShort","dayNames","dayNamesShort","dayNamesMin"];e.each((function(){var e=a(this),o=e.data(),n={};a.each(t,(function(e,t){var l=t.toLowerCase(),s="";void 0!==o[l]&&(a.inArray(t,i)>=0?(s=o[l].split(",")).map((function(a){return a.trim()})):s=o[l],n[t]=s)})),n.beforeShow=function(a,e){e.dpDiv.addClass("avia-datepicker-div"),void 0!==o.container_class&&e.dpDiv.addClass(o.container_class)},e.datepicker(n)}))},a.AviaModal.register_callback.modal_load_multi_input=function(){this.modal.find(".avia-element-multi_input").each((function(){var e=a(this),t=e.find('input[type="text"]').first(),i=e.find('input[type="text"]').not(t),o=e.find('input[type="checkbox"]');o.length&&(t.on("keyup",(function(){o.is(":checked")&&i.attr("value",t.val())})),o.on("change",(function(){o.is(":checked")?(i.prop("disabled",!0),i.attr("value",t.val())):i.prop("disabled",!1)})))}))},a.AviaModal.register_callback.modal_load_tabs=function(){var e=this.modal,t=this,i=e.find(".avia-modal-tab-container"),o=i.find(".avia-modal-tab-container-inner"),n=a('<div class="avia-modal-tab-titles"></div>').prependTo(i),l="active-modal-tab",s=null;this.has_modal_popup_state&&(s=this.options.save_param.hasClass("avia-modal-group-element")),o.each((function(e){var i=a(this),d=i.data("tab-name"),r=a("<a href='#'>"+d+"</a>").appendTo(n);0===e&&(r.addClass(l),o.css({display:"none"}),i.css({display:"block"})),r.on("click",(function(e){var r=a(this);if(t.has_modal_popup_state){var c=s?"group_tab_text":"tab_text";a.avia_builder.set_modal_popup_state(c,d,t)}return n.find("a").removeClass(l),o.css({display:"none"}),r.addClass(l),i.css({display:"block"}),!1}))}))},a.AviaModal.register_callback.modal_load_toggles=function(){var e=this.modal,t=this,i=e.find(".avia-modal-toggle-container").addClass("avia-modal-toggle-ready"),o=null,n="active-modal-toggles";this.has_modal_popup_state&&(o=this.options.save_param.hasClass("avia-modal-group-element")),i.each((function(e){var i=a(this),l=i.data("toggles-closed"),s=i.data("toggles-layout"),d=i.find(".avia-modal-toggle-container-inner"),r=!1;"yes"==(l="string"==typeof l&&a.inArray(l,["yes","no"])>=0?l:"no")&&(r=!0),s="string"==typeof s&&a.inArray(s,["","section_headers","no_section_headers"])>=0?s:"",d.each((function(e){var l=a(this),c=l.data("toggle-name"),p=l.data("toggle-desc"),m=l.find(".avia-form-element-container").not(".avia-hidden"),v=a('<a class=\'avia-modal-toggle-title\' href=\'#\'><svg class="avia-modal-toggle-arrow" width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" focusable="false"><g><path fill="none" d="M0,0h24v24H0V0z"></path></g><g><path d="M7.41,8.59L12,13.17l4.59-4.58L18,10l-6,6l-6-6L7.41,8.59z"></path></g></svg>'+c+"<span>"+p+"</span></a>").insertBefore(l),_=l.closest(".avia-modal");!r&&m.length>0&&""==s&&(d.css({display:"none"}),v.addClass(n),l.css({display:"block"}),r=!0),v.on("click",(function(e){e.preventDefault();var r=a(this),p=!!r.hasClass(n),m=o?"group_toggle_text":"toggle_text";t.has_modal_popup_state&&a.avia_builder.set_modal_popup_state(m,c,t),""==s&&(i.find("a").removeClass(n),d.css({display:"none"}),p||(r.addClass(n),l.css({display:"block"})))})),_.on("change",(function(e){setTimeout((function(){var e=!0,t=l.find(".avia-form-element-container").not(".avia-hidden");_.hasClass("show-locked-input-element")||(t=t.not(".avia-locked-input-element")),_.hasClass("avia-edit-item-template")&&(t=t.not(".avia-hide-on-edit-item-template"));var i=l.closest(".avia-modal-toggle-visibility-wrap");if(t.each((function(t){for(var i=a(this).parent();!i.hasClass("avia-modal-toggle-container-inner");)i.hasClass("avia-form-element-container")&&(e=!i.hasClass("avia-hidden")),i=i.parent();if(e)return!1})),e&&t.length>0){var o=0;t.each((function(e){a(this).hasClass("avia-element-heading")&&o++})),t.length==o&&(t=[])}e&&0==t.length&&(e=!1),e?i.removeClass("avia-hidden"):i.addClass("avia-hidden")}),500)})),setTimeout((function(){_.trigger("change")}),100)}))}))},a.AviaModal.register_callback.modal_load_iconswitcher=function(){var e=this.modal.find(".avia-modal-iconswitcher-container").addClass("avia-modal-switcher-ready"),t="active-modal-icon-switcher";e.each((function(e){var i=a(this),o=null,n=i.find(".avia-modal-iconswitcher-container-inner"),l=a('<div class="avia-modal-iconswitcher-titles"></div>'),s=i.find(".avia-iconswitcher-name-description");o=0==s.length?l.prependTo(i):l.insertAfter(s),n.each((function(e){var l=a(this),s=l.data("switcher-name"),d=l.data("switcher-icon"),r=a("<a class='avia-modal-iconswitcher-title' href='#'><span><img src='"+d+"' /></span><strong>"+s+"</strong></a>").appendTo(o);0===e&&(n.css({display:"none"}),r.addClass(t),l.css({display:"block"})),r.on("click",(function(e){var o=a(this);return i.find("a").removeClass(t),n.css({display:"none"}),o.addClass(t),l.css({display:"block"}),!1}))}))}))},a.AviaModal.register_callback.modal_load_mailchimp=function(){var e,t=this.modal,i=t.find(".avia-element-mailchimp_list select"),o=t.find(".avia-modal-group"),n=o.find(".avia-modal-group-element"),l=t.find(".avia-tmpl-modal-element").html(),s=i.val(),d=[],r=function(e,t){var i,n="",s=a(l);e.label&&(e.label=e.label.replace(/'/g,"&lsquo;")),e.options&&(e.options=e.options.replace(/'/g,"&lsquo;")),e.value&&(e.value=e.value.replace(/'/g,"&lsquo;")),n=s.find("textarea"),i=a.avia_builder.createShortcode(e,"av_mailchimp_field",{},!1),n.html(i),a.avia_builder.update_builder_html(s,e,!1),"prepend"==t?o.prepend(s):o.append(s)};if(""==s)o.html("");else if(av_mailchimp_list[s]){var c=av_mailchimp_list[s];for(e in n.each((function(){var e=a(this),t=e.find('[data-update_class_with="id"]').attr("class").replace("avia-id-","");if(!isNaN(t))if(t=parseInt(t,10),c[t]){var i=e.find("textarea"),o=i.val(),n=new RegExp(/check=['|"](.*?)['|"]/);n.exec(o)[1]!=c[t].check&&(o=o.replace(n,"check='"+c[t].check+"'"),e.find('[data-update_class_with="check"]').removeClass().addClass("avia-check-"+c[t].check),""!=c[t].check&&(n=new RegExp(/disabled=['|"](.*?)['|"]/),o=o.replace(n,"disabled=''"),e.find('[data-update_class_with="disabled"]').removeClass())),i.html(o)}else e.remove()})),c)o.find(".avia-id-"+c[e].id).length||r(c[e],"prepend")}i.on("change",(function(){if(""!=s&&(d[s]=o.html()),o.html(""),s=i.val(),d[s])o.append(d[s]);else if(av_mailchimp_list[s])for(e in av_mailchimp_list[s])r(av_mailchimp_list[s][e])}))},a.AviaModal.register_callback.modal_load_tiny_mce=function(e){e=e||this.modal.find(".avia-modal-inner-content .avia_tinymce");var t=this,i=e.parents(".avia-modal").eq(0).find(".avia-modal-save"),o=a(document),n=a("#avia_builder").find(".avia-builder-main-wrap").first().hasClass("avia-ignore-tiny-indent-fix");e.each((function(){var e=this.id,l=a(this).parents(".wp-editor-wrap").eq(0),s=l.find("textarea.avia_tinymce"),d=l.find(".wp-switch-editor").removeAttr("onclick"),r={id:this.id,buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,spell,close",menubar:!1},c="mceRemoveEditor";window.tinyMCE&&window.tinyMCE.majorVersion,quicktags(r),QTags._buttonsInit(),d.on("click",(function(){if(a(this).is(".switch-tmce")){l.removeClass("html-active").addClass("tmce-active"),window.tinyMCE.execCommand("mceAddEditor",!0,e);var t=s.val(),i=t.match(/\[caption /i)?"wpeditimage":"raw",o=window.switchEditors.wpautop(t);n||(o=(o=(o=(o=(o=(o=o.replace(/>[.\s]+<li>/g,"><li>")).replace(/>[.\s]+<li /g,"><li ")).replace(/>[.\s]+<\/ul>/g,"></ul>")).replace(/>[.\s]+<\/ol>/g,"></ol>")).replace(/<\/ul>[.\s]+<\/li>/g,"</ul></li>")).replace(/<\/ol>[.\s]+<\/li>/g,"</ol></li>")),window.tinyMCE.get(e).setContent(o,{format:i}),tinymce.activeEditor.on("keyup change",(function(a){var t=s.val();window.tinyMCE.get(e)&&(t=window.tinyMCE.get(e).getContent()),s.trigger("av-update-preview-tinymce",window.switchEditors._wp_Nop(t))}))}else{var d=s.val();window.tinyMCE.get(e)&&(d=window.tinyMCE.get(e).getContent()),l.removeClass("tmce-active").addClass("html-active"),window.tinyMCE.execCommand(c,!0,e),s.val(window.switchEditors._wp_Nop(d))}})),d.filter(".switch-tmce").trigger("click"),i.on("click",(function(){d.filter(".switch-html").trigger("click")})),o.on("avia_modal_before_close"+t.namespace+"tiny_close",(function(a,i){t.namespace==i.namespace&&(window.tinyMCE&&window.tinyMCE.execCommand(c,!0,e),o.off("avia_modal_before_close"+t.namespace+"tiny_close"))}))}))},a.AviaModal.register_callback.modal_hotspot_helper=function(){var e,t={},i={};t.hotspot=this.modal.find(".av-hotspot-container"),t.hotspot.length&&(e=t.hotspot.hasClass("avia-locked-input-element"),t.image_container=t.hotspot.find(".avia-builder-prev-img-container-wrap"),t.hotspot_container=a('<div class="av-hotspot-holder"></div>').appendTo(t.image_container),t.modal_group=t.hotspot.siblings(".avia-element-modal_group"),t.hotspot_html="<div class='av-image-hotspot'><div class='av-image-hotspot_inner'>{count}</div></div>",(i={init:function(){i.find_sub_els(),t.modal_group_els.each((function(e){var t=a(this);i.create_hotspot(t,e)})),i.general_behavior()},find_sub_els:function(){t.modal_group_els=t.modal_group.find(".avia-modal-group-element")},create_hotspot:function(e,o){var n=a(t.hotspot_html.replace("{count}",o+1)).appendTo(t.hotspot_container),l=e.find("[data-hotspot_pos]").data("hotspot_pos").split(",");l[1]&&n.css({top:l[0]+"%",left:l[1]+"%"}),i.hotspot_behavior(n,e)},hotspot_behavior:function(a,t){t.data("hotspot",a),a.data("modal_sub_el",t),e||a.draggable({containment:"parent",scroll:!1,grid:[5,5],stop:i.update_hotspot})},general_behavior:function(){t.hotspot_container.on("click",".av-image-hotspot",(function(){var e=a(this).data("modal_sub_el");e&&e.find(".avia-modal-group-element-inner").trigger("click")})),t.hotspot_container.on("mouseenter",".av-image-hotspot",(function(){var e=a(this).data("modal_sub_el");e&&e.addClass("av-highlight-subel")})),t.hotspot_container.on("mouseleave",".av-image-hotspot",(function(){var e=a(this).data("modal_sub_el");e&&e.removeClass("av-highlight-subel")})),t.modal_group.on("mouseenter",".avia-modal-group-element",(function(){var e=a(this).data("hotspot");e&&e.addClass("active_tooltip")})),t.modal_group.on("mouseleave",".avia-modal-group-element",(function(){var e=a(this).data("hotspot");e&&e.removeClass("active_tooltip")})),t.modal_group.on("av-item-add",i.add_hotspot),t.modal_group.on("av-item-delete",i.delete_hotspot),t.modal_group.on("av-item-moved",i.update_hotspot_numbers)},add_hotspot:function(a,e){i.create_hotspot(e,0),i.update_hotspot_numbers()},delete_hotspot:function(a,e){var t=e.data("hotspot");t&&(t.remove(),setTimeout(i.update_hotspot_numbers,350))},update_hotspot_numbers:function(){i.find_sub_els(),t.modal_group_els.each((function(e){var t=a(this).data("hotspot");t&&t.find(".av-image-hotspot_inner").text(e+1)}))},update_hotspot:function(a,e){var o=t.image_container.find("img");if(o.length){var n=o.width(),l=o.height(),s=(e.position,{top:0,left:0});s.left=e.position.left/(n/100),s.top=e.position.top/(l/100),s.left=Math.round(10*s.left)/10,s.top=Math.round(10*s.top)/10,e.helper.css({top:s.top+"%",left:s.left+"%"}),i.update_shortcode(s,e.helper)}},update_shortcode:function(a,e){var t=e.data("modal_sub_el").find("textarea"),i=t.val();i=i.indexOf("hotspot_pos")>-1?i.replace(/hotspot_pos=['|"].*?['|"]/g,"hotspot_pos='"+a.top+","+a.left+"'"):i.replace(/av_image_spot/,"av_image_spot hotspot_pos='"+a.top+","+a.left+"'"),t.val(i).html(i)}}).init())},a.AviaModal.register_callback.modal_preview_script=function(){var e=this,t=e.modal.find(".avia-modal-preview-header"),i=e.modal.find(".avia-modal-preview-content"),o=e.modal.find(".avia-modal-preview-footer"),n=e.modal.find("#aviaTBadmin_preview_bg"),l="avia-preview-scale-"+i.attr("data-preview-scale"),s=(e.modal.find("input, select, radio, textarea"),window.avia_preview.paths),d=window.avia_preview.error,r=!1,c=!1,p=!1,m={};(m={change_preview_bg:function(a){a.preventDefault();var e=a.currentTarget.style.background;i.css("background",e),n.val(e)},update_iframe_with_delay:function(a,e){clearTimeout(r),r=setTimeout((function(){void 0!==a&&"av-update-preview-tinymce"==a.type&&(a.currentTarget.value=e),m.update_iframe()}),400)},update_iframe:function(){var i=e.get_final_values(),o=e.options.on_save.call(e.options.scope,i,e.options.save_param.clone(),"return",e);t.addClass("loading"),a.ajax({type:"POST",url:ajaxurl,data:{action:"avia_ajax_text_to_preview",text:o,avia_request:!0,text_to_preview_post_id:e.has_modal_popup_state?a.avia_builder.modal_popup_state.post_id:0,post_type:a(".avia-builder-main-wrap").data("post_type"),_ajax_nonce:a("#avia-loader-nonce").val()},success:function(a){m.set_frame_content(a)},complete:function(){t.removeClass("loading")}})},set_frame_content:function(t){-1===t.indexOf("["+e.options.ajax_param.allowed)&&-1===t.indexOf(e.options.ajax_param.allowed+"]")||(t="<div class='avia-preview-error'>"+d+"</div>"),0==c?(c=document.createElement("iframe"),i.html("").append(c),t="<html class='responsive html-admin-preview'><head>"+s+"</head><body id='top'><div id='wrap_all'><div id='av-admin-preview' class='entry-content-wrapper main_color all_colors avia-admin-preview-container "+l+"'>"+t+"</div></div></body></html>",c.contentWindow.contents=t,c.src='javascript:window["contents"]',c.onload=function(){p=a(c).contents().find("#av-admin-preview")}):p.length&&p.html(t),p.length&&a(c).contents().find("#av-admin-preview").addClass("avia-preview-updated")}}).set_frame_content(""),m.update_iframe_with_delay(),""!=n.val()&&i.css("background",n.val()),e.modal.on("av-update-preview-instant change","input, select, radio, textarea",m.update_iframe),e.modal.on("av-update-preview keyup","input, select, radio, textarea",m.update_iframe_with_delay),e.modal.on("av-update-preview-tinymce","textarea",m.update_iframe_with_delay),o.on("click","a",m.change_preview_bg)},a.AviaModal.register_callback.modal_load_divider_preview=function(){var e=this,t=e.modal.find(".avia-element-divider_preview .avia-svg-divider-section"),i=!1,o=null,n={};t.length&&((n={getPreviewSections:function(){return null==o&&(o={},t.each((function(){var e=a(this),t=e.data("divider_id"),i=void 0!==e.data("divider_location")?e.data("divider_location"):"top";void 0!==t&&(o[t]={},o[t].id=t,o[t].location=i,o[t].html="")}))),o},getPreviewSvgWithDelay:function(a,e){clearTimeout(i),i=setTimeout((function(){void 0!==a&&"av-update-preview-tinymce"==a.type&&(a.currentTarget.value=e),n.getPreviewSvg()}),400)},getPreviewSvg:function(){var i=e.get_final_values(),o=e.options.on_save.call(e.options.scope,i,e.options.save_param.clone(),"return",e),l=n.getPreviewSections();if(0!=l.length){t.addClass("loading");var s={action:"avia_ajax_text_to_preview_svg_dividers",text:o,svg_list:l,avia_request:!0,text_to_preview_post_id:e.has_modal_popup_state?a.avia_builder.modal_popup_state.post_id:0,post_type:a(".avia-builder-main-wrap").data("post_type"),_ajax_nonce:a("#avia-loader-nonce").val()};a.ajax({type:"POST",url:ajaxurl,dataType:"json",cache:!1,data:s,success:function(e,t,i){1==e.success&&(a("#avia-loader-nonce").val(e._ajax_nonce),n.updateSvgUI(e))},error:function(a){},complete:function(){t.removeClass("loading")}})}},updateSvgUI:function(e){var i=e.preview_list;null!=i&&void 0!==i&&0!=i.length&&t.each((function(){var e=a(this),t=e.data("divider_id");void 0!==t&&void 0!==i[t]&&void 0!==i[t].html&&e.find(".avia-svg-divider-inner").html(i[t].html)}))}}).getPreviewSvgWithDelay(),e.modal.on("av-update-preview-instant change","input, select, radio, textarea",n.getPreviewSvg),e.modal.on("av-update-preview keyup","input, select, radio, textarea",n.getPreviewSvgWithDelay),e.modal.on("av-update-preview-tinymce","textarea",n.getPreviewSvgWithDelay))},a.AviaModal.register_callback.modal_new_custom_element=function(){this.options.args={action:"new_custom_element"},new a.AviaModalElementTemplates(this).ManageCPTData()},a.AviaModal.register_callback.modalEditElementInfoInit=function(){var e=this,t=e.options.args,i=e.modal.find("select.av_add_new_element_shortcode"),o=e.modal.find("input.avia-elements-check-title"),n=e.modal.find('textarea[name="base_element_tooltip"]');i.find('option[value="'+t.shortcode_select+'"]').prop("selected",!0),i.prop("disabled",!0),o.val(t.title),n.val(t.tooltip),new a.AviaModalElementTemplates(this).ManageCPTData()},a.AviaModal.register_callback.modal_btn_new_custom_element_from_alb=function(){var e=this,t=e.modal.find('select[data-template_selector="element"]'),i=e.modal.find(".avia-element-new-from-alb-button .button"),o=a("#avia-tmpl-add-new-element-modal-content"),n={};0!=i.length&&0!=t.length&&(n={init:function(){i.on("click",n.createNewElementFromALB)},createNewElementFromALB:function(t){var i=e.options.base_shortcode,l=e.options.element_title,s=e.options.element_tooltip,d=e.get_final_values();e.modal.hasClass("avia-modal-group-shortcode")&&(i=e.options.item_shortcode+";"+e.options.base_shortcode),e.options.ajax_param.sc_params=d;var r={action:"new_element_from_alb",shortcode:e.options.shortcodehandler,title:l,tooltip:s,shortcode_select:i},c={};c.scope=e,c.modal_title=o.data("modal_title"),c.modal_class="avia-create-new-custom-element hide-save-button",c.modal_content=o.html(),c.on_load="modalEditElementInfoInit",c.on_save=n.elementCPTDataProvided,c.button='<a href="#update_element" class="avia-modal-update-element avia-modal-create-update-btn button button-primary button-large">'+o.data("modal_button")+"</a>",c.ajax_param=e.options.ajax_param,c.args=r;new a.AviaModal(c)},elementCPTDataProvided:function(e){if(!0===e.success){var i='<option value="'+e.change_info.element_id+'" title="'+e.change_info.tooltip+'">'+e.change_info.title+"</option>";t.append(i)}a.avia_builder.element_templates.newElementCreated(e)}}).init()},a.AviaModal.register_callback.modal_btn_edit_custom_element_cpt=function(){var e=this,t=e.modal.find('select[data-template_selector="element"]'),i=e.modal.find(".avia-element-edit-cpt-button .button"),o=a("#avia-tmpl-add-new-element-modal-content"),n={};0!=i.length&&0!=t.length&&(n={init:function(){i.on("click",n.updateElementsPostData),a.avia_builder.body_container.on("avia_elements_cpt_data_changed",n.elements_cpt_data_changed)},updateElementsPostData:function(t){var i={action:"update_element_post_data",shortcode:e.options.shortcodehandler,element_id:e.options.element_id,title:e.options.custom_element_title,tooltip:e.options.custom_element_tooltip,shortcode_select:e.options.custom_element_shortcode_select},l={};l.scope=e,l.modal_title=o.data("modal_title_update"),l.modal_class="avia-create-new-custom-element hide-save-button",l.modal_content=o.html(),l.on_load="modalEditElementInfoInit",l.on_save=n.elementCPTDataUpdated,l.button='<a href="#update_element" class="avia-modal-update-element avia-modal-create-update-btn button button-primary button-large">'+o.data("modal_button_update")+"</a>",l.args=i;new a.AviaModal(l)},elementCPTDataUpdated:function(e){a.avia_builder.element_templates.newElementCreated(e,!0),void 0!==e.change_info&&i.trigger("avia_elements_cpt_data_changed",[e.change_info])},elements_cpt_data_changed:function(a,t){a.preventDefault(),e.options.element_id==t.element_id&&(e.options.custom_element_title=t.title,e.options.custom_element_tooltip=t.tooltip,void 0!==t.modal_title&&e.modal.find(".avia-modal-inner-header h3").html(t.modal_title))}}).init()},a.AviaModal.register_callback.modal_btn_geolocation_get_coordinates=function(){var e=this.modal.find(".avia-element-action_button.avia-geolocation_get_coordinates .button"),t={};0!=e.length&&(t={init:function(){e.on("click",t.findGeoLocation)},findGeoLocation:function(e){e.preventDefault();var t=a(this);void 0!==a.avia_leaflet&&"object"==typeof a.avia_leaflet&&"function"==typeof a.avia_leaflet.findGeoLocationModalContainer?a.avia_leaflet.findGeoLocationModalContainer(t):alert(avia_modal_L10n.leafletNotActive)}}).init()}}(jQuery),function(a,e,t,i){"use strict";void 0!==typeof Color.fn.toString&&(Color.fn.toString=function(){if(this._alpha<1)return this.toCSS("rgba",this._alpha).replace(/\s+/g,"");var a=parseInt(this._color,10).toString(16);if(this.error)return"";if(a.length<6)for(var e=6-a.length-1;e>=0;e--)a="0"+a;return"#"+a}),a.avia_ParseColorValue=function(a){var e=a.replace(/\s+/g,""),t=-1!==e.indexOf("rgba")?parseFloat(100*e.replace(/^.*,(.+)\)/,"$1")):100;return{value:e,alpha:t,rgba:t<100}},a.fn.avia_wpColorPicker=function(e){return this.each((function(){var t=a(this);if(1==t.data("av-rgba")){var i=a.avia_ParseColorValue(t.val()),o={clear:function(){t.trigger("keyup")},change:function(e,i){var o=i.color.toString();t.closest(".wp-picker-container").find(".av-alpha-slider-offset").css("background-color",o),t.val(o).trigger("change"),a(this).trigger("av-update-preview")},create:function(){var e=t.data("a8cIris"),o=t.closest(".wp-picker-container"),n=o.find(".iris-picker").addClass("av-iris-picker-rgba"),l=a('<div class="av-alpha-wrap"><div class="av-alpha-slider"></div><div class="av-alpha-slider-offset"></div><div class="av-alpha-text"></div></div>').appendTo(n),s=l.find(".av-alpha-slider"),d=l.find(".av-alpha-text"),r=l.find(".av-alpha-slider-offset");n.height(n.height()+37),s.slider({slide:function(a,i){var o=parseFloat(i.value/100);e._color._alpha=o,t.wpColorPicker("color",e._color.toString()),d.text(o<1?o:"")},create:function(){var n=parseFloat(i.alpha/100),l=n<1?n:"";d.text(l),r.css("background-color",i.value),o.on("click",".wp-picker-clear",(function(){e._color._alpha=1,d.text(""),s.slider("option","value",100).trigger("slide")})),o.on("click",".wp-picker-default",(function(){var i=a.avia_ParseColorValue(t.data("default-color")),o=parseFloat(i.alpha/100),n=o<1?o:"";e._color._alpha=o,d.text(n),s.slider("option","value",i.alpha).trigger("slide")}))},value:i.alpha,step:1,min:1,max:100})}},n=a.extend(!0,{},o,e);t.wpColorPicker(n)}else t.wpColorPicker(e)}))}}(jQuery,window,document);