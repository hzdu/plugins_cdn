!function(t){"use strict";t.AviaAnalytics=function(){this.body=t("body").eq(0),this.alb=t("#avia_builder"),this.builder=t("#aviaLayoutBuilder"),this.shortcodes=t("#_aviaLayoutBuilderCleanData"),this.classic=null,this.gutenberg=null,this.blocks=null,this.rawdata="",this.data="",this.delay=t("body").is(".avia-seo-analysis-no-delay")?1e3:5e3,this.unsubscribe=null,this.get_tinymce_editor(),this.register_tiny_events(),this.register_gutenberg_events(),this.register_listeners()},t.AviaAnalytics.prototype={register_listeners:function(){var e=this;this.body.on("AviaBuilder_after_switch_layout_mode",(function(i,a){0!=e.is_block_editor()&&(t(a).is(".avia-builder-active")?(e.builder.off("avia-analytics-for-blocks-ready"),e.unsubscribe()):e.register_gutenberg_events())}))},register_tiny_events:function(){var e=this;if("undefined"!=typeof tinyMCE&&void 0!==tinyMCE.editors&&void 0!==tinyMCE.activeEditor){if(t("#content-tmce").on("click",(function(){e.classic||setTimeout((function(){e.get_tinymce_editor(),e.register_tiny_events()}),100)})),null==this.classic)return t("#content-tmce").trigger("click"),void setTimeout((function(){t("#content-html").trigger("click")}),200);this.classic.onChange.add(_.debounce((function(t,i){e.convert_shortcodes()}),e.delay)),this.classic.onInit.add(_.debounce((function(t,i){e.convert_shortcodes()}),1e3))}},register_gutenberg_events:async function(){if(0!=this.is_block_editor()&&1!=this.is_alb_active()){var t=this,e=()=>this.get_gutenberg_blocks(),i=e();this.body.on("avia-analytics-for-blocks-ready",(function(){var e=t.get_raw_data();t.convert_shortcodes(e)})),this.unsubscribe=wp.data.subscribe(_.debounce((function(){var a=e(),n=a!==i;i=a,n&&t.body.trigger("avia-analytics-for-blocks-ready")}),t.delay))}},get_raw_data:function(){return this.rawdata=wp.data.select("core/editor").getEditedPostContent(),this.rawdata},get_tinymce_editor(){this.classic=tinyMCE.get("content")},get_editor_content:function(){return this.is_alb_active()?this.shortcodes.val():this.classic.getContent()},get_gutenberg_blocks:function(){return wp.data.select("core/editor").getBlocks()},convert_shortcodes:function(e=null){var i=this;t.ajax({type:"POST",url:ajaxurl,data:{action:"avia_ajax_text_to_preview",text:null==e?i.get_editor_content():e,avia_request:!0,post_type:t(".avia-builder-main-wrap").data("post_type"),_ajax_nonce:t("#avia-loader-nonce").val()},success:function(t){i.data=t,setTimeout((function(){i.body.trigger("avia-analytics-ready")}),100)}})},retrieve_data:function(){return this.data},is_alb_active:function(){return 0!==this.alb.length&&0==this.alb.is(".avia-hidden")},is_block_editor:function(){return t("body").hasClass("block-editor-page")}}}(jQuery);