!function(a){"use strict";if("undefined"!=typeof avia_globals){var n="avia_builder_button";tinymce.create("tinymce.plugins."+n,{init:function(n,t){n.addCommand("openAviaModal",(function(n,t){new a.AviaModal(t);return!1}))},createControl:function(t,e){if(t!=n)return null;var o=this,i=a.AviaModal.openInstance||[],d=e.createMenuButton(n,{icons:!1,title:avia_globals.sc[n].title,image:avia_globals.sc[n].image});return d.onRenderMenu.add((function(a,t){var e=avia_globals.sc[n].config,d=[],r=0;for(var l in e)(0==i.length||void 0!==e[l].tinyMCE&&void 0!==e[l].tinyMCE.tiny_always)&&(d[e[l].tab]=[]);for(var c in d)"undefined"!=c&&(r++,d[c]=t.addMenu({title:c}));for(var s in(0==i.length||r>0)&&t.addSeparator(),e)if(e[s].tinyMCE=e[s].tinyMCE||{},0==i.length||!e[s].tab||void 0!==e[s].tinyMCE.tiny_always){var v=e[s].tab?d[e[s].tab]:t;void 0!==e[s].tinyMCE.instantInsert?o.instantInsert(v,e[s]):o.modalInsert(v,e[s])}})),d},instantInsert:function(a,n){a.add({title:n.tinyMCE.name||n.name,onclick:function(){tinyMCE.activeEditor.execCommand("mceInsertContent",!1,window.switchEditors.wpautop(n.tinyMCE.instantInsert))}})},modalInsert:function(n,t){n.add({title:t.tinyMCE.name||t.name,onclick:function(){var n=a.extend({},{modal_class:"",before_save:""},t.modal_data);void 0!==t.modal_on_load&&"string"!=typeof t.modal_on_load&&(t.modal_on_load=t.modal_on_load.join(", ")),tinyMCE.activeEditor.execCommand("openAviaModal",!1,{modal_class:n.modal_class,before_save:n.before_save,shortcodehandler:t.shortcode,modal_title:t.name,modal_ajax_hook:t.shortcode,scope:tinyMCE.activeEditor,ajax_param:{extract:!0,shortcode:"",_ajax_nonce:a("#avia-loader-nonce").val()},on_load:t.modal_on_load,on_save:function(n){if("string"!=typeof n){var e,o;for(var i in n)n.hasOwnProperty(i)&&(-1!==i.indexOf("_fakeArg")?delete n[i]:(e=i.replace(/aviaTB/g,""))!=i&&(o=void 0!==n[e]?n[e]+",":"",n[e]=o?o+n[i]:n[i],delete n[i]));if(t.tinyMCE.templateInsert){var d=t.tinyMCE.templateInsert;for(var i in n)d=d.replace("{{"+i+"}}",n[i]);n=d}else n=window.switchEditors.wpautop(a.avia_builder.createShortcode(n,t.shortcode))}tinyMCE.activeEditor.execCommand("mceInsertContent",!1,n)}})}})}}),tinymce.PluginManager.add(n,tinymce.plugins[n])}}(jQuery);