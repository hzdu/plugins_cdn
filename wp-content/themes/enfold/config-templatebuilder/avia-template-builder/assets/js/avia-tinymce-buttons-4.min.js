!function(e){"use strict";if("undefined"!=typeof avia_globals){var a="avia_builder_button",t=(void 0!==avia_globals.sc[a].access_key&&""!=avia_globals.sc[a].access_key&&avia_globals.sc[a].access_key,avia_globals.sc[a].title);tinymce.create("tinymce.plugins."+a,{init:function(n,o){n.addButton(a,{type:"menubutton",text:"",title:t,image:avia_globals.sc[a].image,icons:a,menu:this.createMenuValues(n)}),n.addCommand("openAviaModal",(function(a,t){new e.AviaModal(t);return!1}))},createMenuValues:function(t){var n=[],o=e.AviaModal.openInstance||[],i=avia_globals.sc[a].config,s=[];for(var d in i)(0==o.length||void 0!==i[d].tinyMCE&&void 0!==i[d].tinyMCE.tiny_always)&&(s[i[d].tab]=[]);for(var l in s)"undefined"!=l&&(n.push({text:l,menu:[]}));for(var r in i)if(i[r].tinyMCE=i[r].tinyMCE||{},0==o.length||!i[r].tab||void 0!==i[r].tinyMCE.tiny_always){var c,_,v=n;for(var l in n)"undefined"!=l&&n[l].text==i[r].tab&&(v=n[l].menu);c=i[r].tinyMCE.name||i[r].name,_=void 0!==i[r].tinyMCE.instantInsert?this.instantInsert:this.modalInsert,v.push({text:c,onclick:_,av_shortcode:i[r],scope:t})}for(var l in n)"undefined"!=l&&void 0!==n[l].menu&&0===n[l].menu.length&&delete n[l];return n},instantInsert:function(){var e=this.settings.av_shortcode;this.settings.scope.execCommand("mceInsertContent",!1,window.switchEditors.wpautop(e.tinyMCE.instantInsert))},modalInsert:function(a,t){t=this.settings.av_shortcode;var n=e.extend({},{modal_class:"",before_save:""},t.modal_data);"object"==typeof t.modal_on_load&&(t.modal_on_load=e.map(t.modal_on_load,(function(e){return e}))),void 0!==t.modal_on_load&&"string"!=typeof t.modal_on_load&&(t.modal_on_load=t.modal_on_load.join(", "));var o=this.settings.scope;tinyMCE.activeEditor.execCommand("openAviaModal",!1,{modal_class:n.modal_class,before_save:n.before_save,shortcodehandler:t.shortcode,modal_title:t.name,modal_ajax_hook:t.shortcode,scope:tinyMCE.activeEditor,ajax_param:{extract:!0,shortcode:"",_ajax_nonce:e("#avia-loader-nonce").val()},on_load:t.modal_on_load,on_save:function(a){if("string"!=typeof a){var n,i;for(var s in a)a.hasOwnProperty(s)&&(-1!==s.indexOf("_fakeArg")?delete a[s]:(n=s.replace(/aviaTB/g,""))!=s&&(i=void 0!==a[n]?a[n]+",":"",a[n]=i?i+a[s]:a[s],delete a[s]));if(t.tinyMCE.templateInsert){var d=t.tinyMCE.templateInsert;for(var s in a)d=d.replace("{{"+s+"}}",a[s]);a=d}else{var l=void 0===t.self_closing||"yes"!=t.self_closing;a=window.switchEditors.wpautop(e.avia_builder.createShortcode(a,t.shortcode,{},l))}}o.execCommand("mceInsertContent",!1,a)}})}}),tinymce.PluginManager.add(a,tinymce.plugins[a])}}(jQuery);