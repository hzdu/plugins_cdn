!function(e){"use strict";e.AviaElementBehavior=e.AviaElementBehavior||{},e.AviaElementBehavior.wp_media=e.AviaElementBehavior.wp_media||[],e.AviaElementBehavior.wp_media_advanced=function(){var i=e("body"),t=[],a=wp.media;i.on("click",".avia-builder-prev-img-container a, .avia-builder-prev-img > img, .avia-builder-prev-img-container dotlottie-player, .avia-builder-prev-img-container lottie-player",(function(i){i.preventDefault();var t=e(this).parents(".avia-form-element-container").eq(0);if(t.hasClass("avia-locked-input-element"))return!1;t.find(".button").eq(0).trigger("click")})),i.on("click",".avia-element-image .avia-delete-image, .avia-element-lottie_animation .avia-delete-image",(function(i){i.preventDefault();var t=e(this).addClass("avia-hidden").parents(".avia-form-element-container").eq(0);t.find(".avia-builder-prev-img").html(""),t.find("input[type=hidden]").val("").trigger("change")})),i.on("click",".avia-delete-gallery-button",(function(i){i.preventDefault();var t=e(this).parents(".avia-form-element-container").eq(0);t.find(".avia-builder-prev-img-container").html(""),t.find("input[type=hidden]").val("").trigger("change")})),i.on("click",".avia-element-action_button.avia-save_video_thumbnails .button",(function(i){i.preventDefault();var t=e(this),a=e('<div class="ajax_load"><span class="ajax_load_inner"></span></div>'),l=e(".avia-modal .avia-element-video .avia-form-element input").val(),r=t.data("post_id");({saveVideoThumbs:function(){e.ajax({type:"POST",url:ajaxurl,data:{action:"avia_save_video_thumbnails_locally",post_id:r,video_url:l,_ajax_nonce:e("#avia-loader-nonce").val()},beforeSend:function(){a.insertAfter(t),t.addClass("avia_button_inactive"),e(".avia-notification").remove()},error:function(i){var l="";l=void 0!==i.responseJSON?i.responseJSON.data[0].message:"Internal Server Error - File could not be downloaded.",e('<div class="avia-notification avia-notification-error"><p>'+l+"</p></div>").insertAfter(t),a.remove(),t.removeClass("avia_button_inactive")},success:function(i){e('<div class="avia-notification avia-notification-success"><p>'+i.message+"</p></div>").insertAfter(t)}}).done((function(){a.remove(),t.removeClass("avia_button_inactive")}))}}).saveVideoThumbs()})),i.on("click",".aviabuilder-image-upload",(function(i){i.preventDefault();var l=e(this),r=l.data(),n=l.closest(".avia-modal-group-wrapper"),o=[];0==n.length&&(n=l.closest(".avia-form-element-container")),o=r.download&&"string"==typeof r.download&&""!=r.download.trim()?r.download.split(",").map((function(e){return e.trim()})):["image","video","audio","text/plain","text/csv","application/pdf","application/zip","application/lottiefiles"];var d=n.find("#"+r.target),s=d.next("input"),p=n.find(".hidden-attachment-id"),v=n.find(".hidden-attachment-size"),u=n.find(".avia-builder-prev-img-container"),m=n.find(".avia-tmpl-modal-element"),c=m.html(),f=n.find(".avia-modal-group"),y=n.find(".avia-delete-image"),g=function(i,t,a){var l=[],r="image";if("html"==a.save_to)t.each((function(){var i=e(this).html();isNaN(parseInt(i,10))||l.push(i)}));else{if(void 0===i)return;l=i.split(",")}if(0!=l.length&&!isNaN(parseInt(l[0],10))){void 0!==a.media_type&&(r=a.media_type);var n={orderby:"post__in",order:"ASC",type:r,perPage:-1,post__in:l},o=wp.media.query(n),d=new wp.media.model.Selection(o.models,{props:o.props.toJSON(),multiple:!0});return void 0!==a.state_edit&&l.length>0&&(a.state=a.state_edit),d}}(d.val(),p,r),b=_.random(0,1e18);e.AviaElementBehavior.wp_media.unshift(this),t[b]||(t[b]=wp.media({frame:r.frame,state:r.state,library:{type:["image"]},button:{text:r.button},className:r.class,selection:g}),t[b].states.add([new a.controller.Library({id:"avia_insert_single",title:l.data("title"),priority:20,toolbar:"select",filterable:"uploaded",library:a.query(t[b].options.library),multiple:!1,editable:!0,displayUserSettings:!1,displaySettings:!0,allowLocalEdits:!0}),new a.controller.Library({id:"avia_insert_multi",title:l.data("title"),priority:20,toolbar:"select",filterable:"uploaded",library:a.query(t[b].options.library),multiple:"add",editable:!0,displayUserSettings:!1,displaySettings:!1,allowLocalEdits:!0}),new a.controller.Library({id:"avia_insert_video",title:l.data("title"),priority:20,toolbar:"select",filterable:"uploaded",library:a.query({type:"video",orderby:"date",query:!0}),multiple:!1,editable:!0,displayUserSettings:!1,displaySettings:!0,allowLocalEdits:!0}),new a.controller.Library({id:"avia_insert_multi_video",title:l.data("title"),priority:20,toolbar:"select",filterable:"uploaded",library:a.query({type:"video",orderby:"date",query:!0}),multiple:"add",editable:!0,displayUserSettings:!1,displaySettings:!0,allowLocalEdits:!0}),new a.controller.Library({id:"avia_insert_audio",title:l.data("title"),priority:20,toolbar:"select",filterable:"uploaded",library:a.query({type:"audio",orderby:"date",query:!0}),multiple:!1,editable:!0,displayUserSettings:!1,displaySettings:!0,allowLocalEdits:!0}),new a.controller.Library({id:"avia_insert_multi_audio",title:l.data("title"),priority:20,toolbar:"select",filterable:"uploaded",library:a.query({type:"audio",orderby:"date",query:!0}),multiple:"add",editable:!0,displayUserSettings:!1,displaySettings:!0,allowLocalEdits:!0}),new a.controller.Library({id:"avia_insert_lottie",title:l.data("title"),priority:20,toolbar:"select",filterable:"uploaded",library:a.query({type:["text/plain","application/lottiefiles"],orderby:"date",query:!0}),multiple:!1,editable:!0,displayUserSettings:!1,displaySettings:!0,allowLocalEdits:!0}),new a.controller.Library({id:"avia_insert_file_download",title:l.data("title"),priority:20,toolbar:"select",filterable:"uploaded",library:a.query({type:o,orderby:"date",query:!0}),multiple:!1,editable:!0,displayUserSettings:!1,displaySettings:!0,allowLocalEdits:!0})]),t[b].on("select update insert",(function(i){var a,l=t[b].state();a=void 0!==i?i:l.get("selection");var n,o,g,_,h="",w=e("<div></div>");n=a.map((function(i){if(g=i.toJSON(),"url"==r.fetch)return o=l.display(i).toJSON(),"string"==typeof g.subtype&&"lottiefiles"==g.subtype||"string"==typeof g.url&&g.url.indexOf(".json")>=0?(_=g.url,h+='<span class="avia-builder-prev-img"><dotlottie-player autoplay loop mode="normal" style="width: 160px" src="'+_+'"></dotlottie-player></span>',y.removeClass("avia-hidden"),p.length&&p.val(g.id),v.length&&v.val("full")):void 0===g.sizes?(_=g.url,h=""):(_=g.sizes[o.size].url,h+="<span class='avia-builder-prev-img'><img src='"+_+"' /></span>",y.removeClass("avia-hidden"),p.length&&p.val(g.id),v.length&&v.val(o.size)),_;if("id"==r.fetch)return _=void 0!==g.sizes.thumbnail?g.sizes.thumbnail.url:g.url,h+="<span class='avia-builder-prev-img'><img src='"+_+"' /></span>",y.removeClass("avia-hidden"),s.length&&s.val('<img src="'+_+'" />'),g[r.fetch];if("template"==r.fetch){var t=e(c),a={id:g.id,img_fakeArg:""};if(m.hasClass("avia-copy-element-template")){t.addClass("avia-force-empty-update-value");var n=t.html().match(/element_template='(\d*)'|element_template="(\d*)"/i);null!=n&&n.length>1?a.element_template=n[1]:a.element_template=""}g.sizes&&g.sizes.thumbnail?a.img_fakeArg=g.sizes.thumbnail.url:a.img_fakeArg=g.url,a.img_fakeArg='<img src="'+a.img_fakeArg+'" title="" alt="" />';var d=e.avia_builder.update_builder_html(t,a,!1);t.find(e.avia_builder.datastorage).eq(0)[0].innerHTML=d.output,w.append(t)}else if("template_audio"==r.fetch){f.html(""),o=l.display(i).toJSON();t=e(c);(a={id:g.id,title:g.title,artist:g.artist,album:g.album,description:g.description,filelength:g.fileLength,url:g.url,filename:g.filename,icon:g.icon,img_fakeArg:g.icon,title_info:""}).img_fakeArg='<img src="'+a.img_fakeArg+'" title="'+a.title+'" alt="" />',void 0!==a.title?a.title_info+='<span class="avia-known-title">'+a.title:a.title_info+='<span class="avia-unknown-title">'+a.title,a.title_info+="</span>";d=e.avia_builder.update_builder_html(t,a,!0);t.find(e.avia_builder.datastorage).eq(0)[0].innerHTML=d.output,w.append(t)}})),d.length&&d.val(n.join(",")).trigger("change"),u.length&&u.html(h),f.length&&f.append(w.html())})),t[b].on("close",(function(){_.defer((function(){e.AviaElementBehavior.wp_media.shift()}))}))),t[b].open()}))}}(jQuery);