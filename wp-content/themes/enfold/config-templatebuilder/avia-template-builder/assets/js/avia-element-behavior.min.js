!function(a){"use strict";a.AviaElementBehavior=a.AviaElementBehavior||{},a((function(){a.AviaElementBehavior.image_radio(),a.AviaElementBehavior.checkbox_label_change(),a.AviaElementBehavior.tabs(".avia-tab-container"),a.AviaElementBehavior.icon_select(),a.AviaElementBehavior.expand_metabox(),a.AviaElementBehavior.check_dependencies(),a.AviaElementBehavior.set_target_property(),a.AviaElementBehavior.tmpl_fetcher(),a.AviaElementBehavior.redo_undo(),a.AviaElementBehavior.wp_media_advanced(),a.AviaElementBehavior.gmaps_fetcher(),"function"==typeof a.AviaElementBehavior.wp_save_template&&new a.AviaElementBehavior.wp_save_template,new a.AviaTooltip({attach:"body"}),new a.AviaTooltip({class:"avia-help-tooltip",data:"avia-help-tooltip",event:"click",position:"bottom",attach:"body"})})),a.AviaElementBehavior.gmaps_fetcher=function(){var e="",i=!1,t={},n=!1,o=1500;void 0===avia_framework_globals.gmap_builder_maps_loaded||""==avia_framework_globals.gmap_builder_maps_loaded?(e="https://maps.googleapis.com/maps/api/js?v=3.30&callback=av_builder_maps_loaded","undefined"!=avia_framework_globals.gmap_api&&""!=avia_framework_globals.gmap_api&&(e+="&key="+avia_framework_globals.gmap_api)):e=avia_framework_globals.gmap_builder_maps_loaded,a("body").on("click",".avia-js-google-coordinates",(function(){if(t=this,void 0!==window.google&&void 0!==window.google.maps||0!=i)void 0!==window.google&&void 0!==window.google.maps&&window.av_builder_maps_loaded();else{i=!0;var a=document.createElement("script");a.type="text/javascript",a.src=e,document.body.appendChild(a)}return!1})),window.av_builder_maps_loaded=function(e){void 0===e&&((e={}).clicked=a(t),e.parent=e.clicked.parents("div").eq(0),e.long=e.parent.find("#long"),e.lat=e.parent.find("#lat"),e.coordinatcontainer=e.parent.find(".av-gmap-coordinates"),e.inputs=e.parent.find(".av-gmap-addres input"),e.address=e.inputs.map((function(){return this.value})).get().join(" ")),t=!1;var i=new google.maps.Geocoder,d=e.address,l={},r=!1;i.geocode({address:d},(function(i,t){r=!0,t==google.maps.GeocoderStatus.OK?(l.latitude=i[0].geometry.location.lat(),l.longitude=i[0].geometry.location.lng(),e.long.val(l.longitude),e.lat.val(l.latitude)):t==google.maps.GeocoderStatus.ZERO_RESULTS?d.replace(/\s/g,"").length?new a.AviaModalNotification({mode:"error",msg:avia_modal_L10n.notfound}):new a.AviaModalNotification({mode:"error",msg:avia_modal_L10n.insertaddress}):t==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?new a.AviaModalNotification({mode:"error",msg:avia_modal_L10n.toomanyrequests}):t==google.maps.GeocoderStatus.REQUEST_DENIED&&new a.AviaModalNotification({mode:"error",msg:avia_modal_L10n.gmap_api_text}),e.coordinatcontainer.addClass("av-visible")})),!1===n&&(n=setTimeout((function(){!1===r&&(new a.AviaModalNotification({mode:"error",msg:avia_modal_L10n.gmap_api_wrong}),n=!1,o=0)}),o))}},a.AviaElementBehavior.tabs=function(e,i){a(e).each((function(e){var t=0,n="avia_post_"+e+"_"+avia_globals.post_id,o=!1;"undefined"!=typeof Storage&&(o=!0,t=sessionStorage[n]||0);var d,l=a(this),r=l.find(".avia-tab-title-container a").not(".avia-fake-tab"),c=l.find(".avia-tab");r.off("click").on("click",(function(){r.removeClass("active-tab"),d=a(this).addClass("active-tab");var e=r.index(d);return c.css({display:"none"}).eq(e).css({display:"block"}),o&&(sessionStorage[n]=e),void 0!==i&&i.find(".avia-tab-title-container a").eq(e).trigger("click"),a(this).trigger("avia-tab-title-container-clicked",[this]),!1})),r.filter(".active-tab").length||r.eq(t).addClass("active-tab").trigger("click")}))},a.AviaElementBehavior.image_radio=function(){a('.avia_scope input[type="radio"]:checked').parents(".avia_radio_wrap").eq(0).addClass("avia_checked"),a("body").on("click",".avia_scope input[type='radio']",(function(e){a(this).parents(".avia_radio_wrap").eq(0).siblings(".avia_radio_wrap").removeClass("avia_checked").end().addClass("avia_checked")}))},a.AviaElementBehavior.icon_select=function(){a("body").on("click",".avia-attach-element-select",(function(){var e=a(this),i=e.parents(".avia-attach-element-container").eq(0),t=(i.find(".avia-active-element").removeClass("avia-active-element"),i.find("input[type=hidden]").eq(0)),n=i.find("input[type=hidden]").eq(1),o=i.find("input[type=hidden]").eq(2);return e.addClass("avia-active-element"),t.val(e.data("element-nr")),n.length&&n.val(e.html()),o.length&&o.val(e.data("element-font")),t.trigger("change"),!1}))},a.AviaElementBehavior.expand_metabox=function(){var e,i,t,n,o,d=a("body"),l=a(".avia-expanded").find(".avia-attach-expand"),r=a("input#publish"),c=a("a#post-preview"),s=a('<div class="avia-expand-whitescreen"></div>').appendTo(d),v=a("body").is(".block-editor-page"),p=a("body").is(".avia-block-editor-expand")?"enabled":"disabled";if(l.length&&(i=(e=l).parents(".postbox").eq(0),g()),"enabled"==p&&v){if("undefined"==wp.data&&"undefined"==wp.data.subscribe)return;function u(){return wp.data.select("core/edit-post").isFeatureActive("fullscreenMode")}var h=u();i=a("#avia_builder"),e=i.find(".avia-attach-expand"),function(a,e){1==a&&g(a);wp.data.subscribe((function(){var i=e(),t=i!==h;h=i,t&&(i?g(a):m())}))}(h,u)}function m(){i.removeClass("avia-expanded"),d.removeClass("avia-noscroll-box"),t.length&&t.remove()}function g(l){i.addClass("avia-expanded"),d.addClass("avia-noscroll-box"),(n=i.find(".avia-tab-container").clone(!0)).length&&(o=a('<div class="avia-expanded-buttons"></div>').appendTo(n),c.clone(!0).appendTo(o).on("click",(function(){setTimeout((function(){window.open("","wp-preview","").trigger("focus")}),10)})),r.clone(!0).appendTo(o),e.clone(!0).addClass("wp-core-ui button").appendTo(o),a('<input type="hidden" name="avia-expanded-hidden" value="'+i.attr("id")+'" />').appendTo(o),t=a('<div class="avia-fixed-controls"></div>').appendTo(void 0!==l?i.find("#post-body-content"):i),n.appendTo(t),a.AviaElementBehavior.tabs(n,a(".avia-tab-container:not(.avia-fixed-controls .avia-tab-container)").first())),i.trigger("avia_builder_expanded",{builder:i})}d.on("click",".avia-attach-expand",(function(){return e=a(this),(i=e.parents(".postbox").eq(0)).is(".avia-expanded")?s.css({display:"block",opacity:0}).animate({opacity:1},(function(){m(),s.animate({opacity:0},(function(){s.css({display:"none"})}))})):s.css({display:"block",opacity:0}).animate({opacity:1},(function(){g(),s.animate({opacity:0},(function(){s.css({display:"none"})}))})),!1}))},a.AviaElementBehavior.checkbox_label_change=function(){a("body").on("change",".avia-style input[type=checkbox]",(function(e){var i=a(this),t=i.closest(".avia-form-element-container");if(!i.hasClass("avia-locked-data-value")&&!i.hasClass("avia-locked-data-hide")&&0!=t.length&&t.hasClass("avia-checkbox-label-change")){var n=t.find("label"),o=t.data("checkbox-checked"),d=t.data("checkbox-unchecked");0!=n.length&&(i.prop("checked")?void 0!==o&&n.html(o):void 0!==d&&n.html(d))}}))},a.AviaElementBehavior.check_dependencies=function(){var e=a("body");e.on("change",".avia-style select, .avia-style textarea, .avia-style radio, .avia-style input[type=checkbox], .avia-style input[type=hidden], .avia-style input[type=text], .avia-style input[type=radio]",(function(){var i=a(this),t=i.parents(".avia-modal").eq(0);t.length||(t=e);var n=this.id.replace(/aviaTB/g,""),o=t.find('.avia-form-element-container[data-check-element="'+n+'"]'),d=this.value,l=i.parents(".avia-form-element-container").eq(0).is(".avia-hidden"),r="",c=i.data("locked_value");if(void 0!==c&&"$$undefined$$"!=c&&(d=c),""!=n){if(i.is("input[type=checkbox]")&&!i.prop("checked")&&(d=""),i.is("input[type=radio]")){var s=this.name.replace(/aviaTB/g,"");o=t.find('.avia-form-element-container[data-check-element="'+s+'"]')}var v=i.closest(".avia-form-element-container").find("#"+this.id).eq(0);v.is("input[type=checkbox]")?r=v.prop("checked")?v.val():"":v.is("input[type=radio]")?""===r&&(r=v.prop("checked")):r=v.val(),o.length&&o.each((function(){var e=a(this),i=e.data(),t=i.checkValue.toString(),n=!1;if(!l)switch(i.checkComparison){case"equals":d==t&&(n=!0);break;case"not":d!=t&&(n=!0);break;case"is_larger":d>t&&(n=!0);break;case"is_smaller":d<t&&(n=!0);break;case"contains":-1!==d.indexOf(t)&&(n=!0);break;case"doesnt_contain":-1===d.indexOf(t)&&(n=!0);break;case"is_empty_or":""!==d&&d!==t||(n=!0);break;case"not_empty_and":""!==d&&d!==t&&(n=!0);break;case"parent_in_array":n=-1!==a.inArray(r,t.split(","));break;case"parent_not_in_array":n=-1===a.inArray(r,t.split(","))}!0===n&&e.is(".avia-hidden")?(e.css({display:"none"}).removeClass("avia-hidden").find("select, radio, input[type=checkbox]").trigger("change"),e.slideDown(300)):!1!==n||e.is(".avia-hidden")||(e.css({display:"block"}).addClass("avia-hidden").find("select, radio, input[type=checkbox]").trigger("change"),e.slideUp(300))}))}}))},a.AviaElementBehavior.set_target_property=function(){var e=a("body");e.on("change",".avia-style select, .avia-style radio, .avia-style input[type=checkbox]",(function(){var i=a(this),t=i.parents(".avia-form-element-container").eq(0),n=i.parents(".avia-modal").eq(0),o=t.data(),d="";if(t.length&&o.targetElement){n.length||(n=e),i.is("select")&&(d=i.find("option").map((function(){return this.value})).get().join(" "));var l=e.find(o.targetElement),r=this.value;l.length&&l.each((function(){var e=a(this);switch(o.targetProperty){case"class":e.removeClass(d).addClass(r);break;case"id":e.attr({id:r})}}))}})),e.on("avia_modal_finished",(function(a,e){e.modal.find(".avia-attach-targeting select,.avia-attach-targeting radio,.avia-attach-targeting input[type=checkbox]").trigger("change")}))},a.AviaElementBehavior.tmpl_fetcher=function(){var e=a("body");e.on("change",".avia-attach-templating select, .avia-attach-templating radio, .avia-attach-templating input[type=checkbox]",(function(){var i=a(this),t=i.attr("id"),n=(i.parents(".avia-form-element-container").eq(0),i.parents(".avia-modal").eq(0)),o=i.next(".template-container");if(n.length||(n=e),o.length){var d="#avia-tmpl-"+t+"-"+this.value,l=a(d);l.length||(avia_globals.builderMode&&"debug"==avia_globals.builderMode&&(avia_log('template snippet "'+d+'" not defined',"error"),avia_log("Make sure that the you have created the template and check the source code if its really available","help")),l=a("<div />")),o.html(l.html())}})),e.on("avia_modal_finished",(function(a,e){e.modal.find(".avia-attach-templating select, .avia-attach-templating radio, .avia-attach-templating input[type=checkbox]").trigger("change")}))},a.AviaElementBehavior.redo_undo=function(){new a.AviaElementBehavior.history({monitor:"#aviaLayoutBuilder",editor:"#_aviaLayoutBuilderCleanData",buttons:".layout-builder-wrap .avia-controll-bar"})}}(jQuery);