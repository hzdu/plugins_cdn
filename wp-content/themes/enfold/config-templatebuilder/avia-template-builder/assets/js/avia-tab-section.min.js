!function(t){"use strict";t.AviaTabSection=function(){this.body_container=t("body").eq(0),this.canvas=t("#aviaLayoutBuilder"),this.builder=t.avia_builder,this.set_up()},t.AviaTabSection.prototype={set_up:function(){this.canvas.on("click",".avia-add-tab",this.add_tab.bind(this)),this.canvas.on("click",".av-admin-section-tab",this.change_active_tab.bind(this)),this.canvas.on("click",".avia-tab-delete",this.delete_current_tab.bind(this)),this.canvas.on("click",".avia-tab-clone",this.clone_tab.bind(this)),this.body_container.on("av-element-to-editor",this.activate_sorting.bind(this)),this.body_container.on("av-builder-new-element-added",this.activate_sorting.bind(this))},add_tab:function(a){a.preventDefault();var e=t(a.currentTarget).parents(".avia_tab_section").eq(0),i=e.find(">.avia_inner_shortcode").eq(0),n=e.find(".avia_tab_section_titles .av-admin-section-tab").last(),s=e.find(".av-admin-section-tab").eq(0).clone().removeClass("av-admin-section-tab-active"),o=e.hasClass("avia-slideshow-section")?"avia_sc_slide_sub_section":"avia_sc_tab_sub_section",r=t("#avia-tmpl-"+o).html().replace("av-admin-section-tab-content-active","");s.find(".av-tab-custom-title").text(""),s.insertAfter(n),i.append(r),this.resort_tab_ids(e),this.builder.activate_element_dropping(),this.builder.updateInnerTextarea(!1,e),this.builder.updateTextarea(),this.builder.do_history_snapshot(0)},change_active_tab:function(a){a.preventDefault();var e=t(a.currentTarget),i=e.parents(".avia_tab_section").eq(0),n=e.data("av-tab-section-title"),s=i.find("[data-av-tab-section-content='"+n+"']"),o=s.is(".av-admin-section-tab-content-active"),r=i.find(">.avia_inner_shortcode>"+this.builder.datastorage).eq(0),c=r.val();if(o)t(a.target).is(".ui-sortable-handle")||s.find("> .avia_sorthandle .avia-edit-element").trigger("click");else{var d=this.builder.set_shortcode_single_value(c,"av_admin_tab_active",n,r);r.val(d),this.builder.updateTextarea(),i.find(".av-admin-section-tab-active, .av-admin-section-tab-content-active").removeClass("av-admin-section-tab-active"),i.find(".av-admin-section-tab-content-active").removeClass("av-admin-section-tab-content-active"),e.addClass("av-admin-section-tab-active"),s.addClass("av-admin-section-tab-content-active")}},delete_current_tab:function(a){a.preventDefault();var e=t(a.currentTarget),i=e.parents(".avia_tab_section").eq(0),n=e.parents(".avia_layout_tab").eq(0),s=i.find(".av-admin-section-tab"),o=n.data("av-tab-section-content"),r=i.find("[data-av-tab-section-title='"+o+"']"),c=r.next(".av-admin-section-tab").length>=1?r.next(".av-admin-section-tab"):r.prev(".av-admin-section-tab");s.length>=2&&(n.addClass("av-removed-next").css("display","none"),r.remove(),this.builder.shortcodes.deleteItem(a.currentTarget,this.builder,0),this.resort_tab_ids(i),c.trigger("click"))},clone_tab:function(a){a.preventDefault();var e=t(a.currentTarget),i=e.parents(".avia_tab_section").eq(0),n=e.parents(".avia_layout_tab").eq(0),s=i.find(".av-admin-section-tab-active"),o=s.clone().removeClass("av-admin-section-tab-active"),r=n.clone().removeClass("av-admin-section-tab-content-active");r.find(".ui-draggable").removeClass("ui-draggable"),r.find(".ui-droppable").removeClass("ui-droppable"),o.insertAfter(s),r.insertAfter(n),this.resort_tab_ids(i),this.builder.activate_element_dropping(),this.builder.activate_element_dragging(),this.builder.updateInnerTextarea(!1,i),this.builder.updateTextarea(),this.builder.do_history_snapshot(0),o.trigger("click")},activate_sorting:function(a,e){var i=this,n={handle:".av-admin-section-tab-move-handle",items:".av-admin-section-tab",placeholder:"av-admin-section-tab-placeholder",tolerance:"pointer",scroll:!1,forcePlaceholderSize:!0,start:function(t,a){},update:function(t,a){var e=a.item.parents(".avia_tab_section").eq(0),n=a.item.parents(".avia_tab_section_titles").eq(0).find(".av-admin-section-tab"),s=a.item.data("av-tab-section-title"),o=n.index(a.item),r=s>o?1:0,c=e.find("[data-av-tab-section-content='"+s+"']"),d=e.find(">.avia_inner_shortcode>"+i.builder.datastorage).eq(0);if(0===o)c.insertAfter(d);else{var v=e.find(".avia_layout_tab").eq(o-r);c.insertAfter(v)}i.resort_tab_ids(e),i.builder.updateInnerTextarea(!1,e),i.builder.updateTextarea(),i.builder.do_history_snapshot(0)},stop:function(t,a){}};e&&t(e).find(".av-tab-section-sortable").removeClass("av-tab-section-sortable"),t(".avia_tab_section_titles:not(.av-tab-section-sortable)").each((function(){t(this).addClass("av-tab-section-sortable").sortable(n)}))},resort_tab_ids:function(a){var e=a.find(".av-admin-section-tab"),i=a.find(".avia_layout_tab:not(.av-removed-next)");e.each((function(a){var e=a+1,i=t(this);i.find(".av-tab-nr").text(e),i.attr("data-av-tab-section-title",e),i.data("av-tab-section-title",e)})),i.each((function(a){var e=a+1,i=t(this);i.attr("data-av-tab-section-content",e),i.data("av-tab-section-content",e)}))}},t((function(){t.avia_tab_section=new t.AviaTabSection}))}(jQuery);