/**
 * This file holds the main javascript functions needed for new version of the avia-media uploads with improved sorting options
 *
 * @author		Christian "Kriesi" Budschedl
 * @copyright	Copyright ( c ) Christian Budschedl
 * @link		http://kriesi.at
 * @link		http://aviathemes.com
 * @since		Version 1.7
 * @package 	AviaFramework
 */
function avia_log(a){var e=navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad)/);(window.console&&console.log&&!e||window.opera&&opera.postError&&!e||function(a){var e=jQuery(".avia_logfield");e.length||(e=jQuery('<pre class="avia_logfield"></pre>').appendTo("body").css({zIndex:1e5,padding:"20px",backgroundColor:"#ffffff",position:"fixed",top:0,right:0,width:"300px",borderColor:"#cccccc",borderWidth:"1px",borderStyle:"solid",height:"600px",overflow:"scroll",display:"block",zoom:1}));var i=e.html();a=function(a){var e=a;if("object"==typeof a||"array"==typeof a)for(var i in a)e+="'"+i+"': "+a[i]+"<br/>";return e}(a);e.html(i+"\n<br/>"+a)}).call(this,a)}!function(a){var e={window:parent||top,bind_click:function(){a("body").on("click",".avia_gallery_delete_all",(function(){return a(this).parents(".avia_gallery_upload_container").eq(0).find(".avia_sortable_gallery_container").html(""),!1})),a("body").on("click",".avia_gallery_uploader",(function(){var i=a(this),t=i.parents(".avia_gallery_upload_container").eq(0),o=i.parents(".avia_set").eq(0),n=t.find(".avia_sortable_gallery_container"),l=(this.title,i.data("attach-to-post")),r=i.data("label"),_=i.data("real-id"),d=i.data("overwrite"),s=i.data("video-insert"),c=o.find(".avia_gallery_image_value"),v=c.parents(".avia_gallery_image").eq(0),g="options_page";a("input[name=meta_active]","#avia_hidden_data").length&&(g="metabox");var u="media-upload.php?post_id="+l;return u+="&amp;avia_gallery_active=true",s&&(u+="&amp;tab="+s+"&amp;height=300"),u+="&amp;avia_gallery_label="+encodeURI(r),u+="&amp;TB_iframe=true",s&&a("body").addClass(s+"_height_mod height_mod_active"),e.window.avia_framework_globals.gallery_editor={element:i,container:n,elementSlug:_,attach_to_post:l,page_context:g,overwrite:d,value_field:c,image_field:v,label:r,video:s,_wpnonce:a("input[name=avia-nonce]").val(),_wp_http_referer:a("input[name=_wp_http_referer]").val()},"",tb_show("",u),!1})),a("body",parent.document).is(".height_mod_active")&&a("body").addClass("iframe_height_mod_active")},insert_click:function(){a("body").on("click",".avia_send_to_gallery",(function(){var i=a(this),t=i.data("attachment-id"),o=i.next(".avia_gallery_loading").css({visibility:"visible"}).removeClass("avia_loading_done avia_loading_error");return e.window.avia_framework_globals.gallery_editor&&e.window.avia_framework_globals.gallery_editor.overwrite?e.replace_image(t,o):e.request_image(t,o),!1}))},insert_inline_content_click:function(i,t,o){i=a(i),t=a(t);var n=a('<div class="avia_gallery_loading"></div>').insertAfter(i);i.on("click",(function(){var a=t.val();if(""!=a){var i={};i.std={slideshow_image:"",slideshow_video:encodeURIComponent(a)},n.css("visibility","visible"),e.request_image(a,n,i,o)}return!1}))},open_close_click:function(){a("body").on("click",".open_set",(function(){var e=a(this),i=e.parents(".avia_set").eq(0);return i.is(".required_ready")||(i.addClass("required_ready"),a(".avia_required_container",i).avia_form_requirement()),i.is(".set_is_open")?(i.removeClass("set_is_open"),e.text(e.data("openset"))):(i.addClass("set_is_open"),e.text(e.data("closedset"))),!1}))},get_gallery_settings:function(){return!!e.window.avia_framework_globals.gallery_editor&&e.window.avia_framework_globals.gallery_editor},clear_gallery:function(){e.window.avia_framework_globals.gallery_editor=!1},clone_insert_button:function(){if(!e.window.avia_framework_globals.gallery_editor)return!1;var i=a("#media-upload");i.length&&i.find(".media-item").not(".button_cloned").each((function(){var e=a(this).addClass("button_cloned"),i=e.find(".filename"),t=e.find(".avia_send_to_gallery").clone(!0).prependTo(i);a('<div class="avia_gallery_loading"></div>').insertAfter(t)}))},add_insert_all_button:function(){var i=a("#gallery-form"),t=e.window.avia_framework_globals.gallery_editor;if(i.length&&t&&!t.overwrite){var o=a(".ml-submit").eq(0),n=a('<input type="submit" id="avia_insert_all" class="button savebutton" value="Add all Images to Slideshow"/>'),l=a('<div class="avia_gallery_loading avia_gallery_loading_all"></div>');n.appendTo(o).on("click",(function(){var a={activate_filter:"avia_ajax_fetch_all"};return l.css({visibility:"visible"}).removeClass("avia_loading_done avia_loading_error"),e.request_image("",l,a),!1})),l.appendTo(o)}},overwrite_default_uploader:function(){window.orig_send_to_editor=window.send_to_editor,window.send_to_editor=function(a){0==e.get_gallery_settings()?window.orig_send_to_editor(a):(e.clear_gallery(),e.window.tb_remove())}},sortable:function(){a(".avia_handle").disableSelection(),a(".avia_sortable_gallery_container").sortable({handle:".avia_handle",cancel:"a",items:".avia_row",update:function(a,e){var i={currentSet:e.item,container:e.item,setsToCount:!1,detach:".ui-sortable"};avia_recalcIds(i)}})},modify_filter_url:function(){var i=a("#filter"),t=e.window.avia_framework_globals.gallery_editor;if(i.length){var o=i.find("input[name=avia_gallery_label]"),n=i.find("input[name=avia_gallery_active]");t&&t.label&&!o.length&&i.prepend("<input type='hidden' name='avia_gallery_label' value='"+t.label+"'/>"),t&&!n.length&&i.prepend("<input type='hidden' name='avia_gallery_active' value='true'/>")}},activate_tabs:function(e){e&&"undefined"!=e||(e=".avia_sortable_gallery_container");var i=a(e),t=i.parents("#avia_options_page").length>0;i.each((function(){var e=a(this),i=[],o=!!t;t&&e.hasClass("avia_tab_container")?i=e.filter(".avia_set"):(i=e.find(".avia_set")).length||(i=e.filter(".avia_set")),i.each((function(){var e=a(this),i=e.find(".avia_tab"),t=a('<div class="tab-title-container"></div>');o?t.prependTo(e):t.prependTo(e.find(".avia_visual_set").eq(0)),i.each((function(e){var o=a(this),n=o.data("group-name"),l="avia_active_tab_title";0!=e&&(o.css({display:"none"}),l=""),a('<a href="#" class="tab-title '+l+'">'+n+"</a>").appendTo(t).on("click",(function(){var e=a(this);i.css({display:"none"}).removeClass("avia_active_tab"),o.css({display:"block"}).addClass("avia_active_tab"),t.find("a").removeClass("avia_active_tab_title"),e.addClass("avia_active_tab_title");var n=o.parents(".avia_subpage_container").eq(0);return n.length&&(o.data("av_set_global_tab_active")?n.attr("data-av_set_global_tab_active",o.data("av_set_global_tab_active")):n.attr("data-av_set_global_tab_active","")),!1}))}))}))}))},overwrite_thickbox_close:function(){window.orig_tb_remove=window.tb_remove,window.tb_remove=function(){var i=e.window.avia_framework_globals.gallery_editor;if(i){if(i.video){var t=a("#TB_window",parent.document);t.height(t.height()),t.css({overflow:"hidden",top:t.css("top"),marginTop:t.css("marginTop")}),a("body").removeClass(i.video+"_height_mod height_mod_active")}e.clear_gallery()}window.orig_tb_remove()}},replace_image:function(i,t){var o=e.window.avia_framework_globals.gallery_editor;a.ajax({type:"POST",url:window.ajaxurl,data:"action=avia_ajax_get_image&attachment_id="+i,success:function(a){t.addClass("avia_loading_done"),o.value_field.val(i),(a=a.trim()).match(/^<img/)?o.image_field.find("a").html(a):o.image_field.find("a").html('<img src="'+avia_framework_globals.frameworkUrl+'images/icons/video.png" alt="" />'),e.window.tb_remove()}})},request_image:function(i,t,o,n){var l=e.window.avia_framework_globals.gallery_editor;if(l){var r={method:"add",action:"avia_ajax_modify_set",elementSlug:l.elementSlug,context:l.page_context,apply_all:l.attach_to_post,std:{slideshow_image:i},_wpnonce:l._wpnonce,_wp_http_referer:l._wp_http_referer,ajax_decode:!0};r=a.extend(r,o);a.ajax({type:"POST",url:window.ajaxurl,data:r,success:function(i){t.addClass("avia_loading_done");var o=i.match(/\{avia_ajax_element\}(.+|\s+)\{\/avia_ajax_element\}/);if(null!=o){var r=a(o[1]);r.appendTo(l.container),r.length<5&&r.css("display","none").slideDown(400);var _=r.eq(0);avia_recalcIds({currentSet:_,container:_,setsToCount:!1}),r.avia_event_binding(),o[0]!=i?(i=i.replace(o[0],""),a("body").avia_alert({the_class:"error",text:"Adding of element successful but the script generated unexpected output: <br/><br/> "+i,show:6e3})):1==n&&setTimeout(e.window.tb_remove,500)}}})}else t.addClass("avia_loading_error")}};a((function(){e.overwrite_thickbox_close(),a.fn.sortable&&e.sortable(),e.modify_filter_url(),e.bind_click(),e.insert_click(),e.insert_inline_content_click("#avia_insert_video","#src",!0),e.open_close_click(),e.activate_tabs(),e.clone_insert_button(),a("body").on("mouseenter",".media-item",e.clone_insert_button),e.add_insert_all_button()})),a.fn.avia_media_advanced_plugin=function(a){e.activate_tabs(this)}}(jQuery);