/**
 * This file holds the main javascript functions needed to clone option groups and improve those form elements with
 * js behaviour
 *
 * @author		Christian "Kriesi" Budschedl
 * @copyright	Copyright ( c ) Christian Budschedl
 * @link		http://kriesi.at
 * @link		http://aviathemes.com
 * @since		Version 1.0
 * @package 	AviaFramework
 */
var av_backend_maps_loaded,gm_authFailure,avia_callback=avia_callback||{};jQuery((function(a){a("body").avia_event_listener(),a(".avia_set").avia_clone_sets(),a(".avia_required_container").not(".avia_delay_required .avia_required_container").avia_form_requirement(),a(".avia_target_value").avia_target(),a(".avia_link_controller").avia_prefill_options(),a(".avia_onchange").avia_on_change(),a(".avia_styling_wizard").avia_styling_wizard(),a(".avia_verify_button").avia_verify_input(),a("body").on("change",".avia_select_unify select",(function(){var e=a(this);e.next(".avia_select_fake_val").text(e.find("option:selected").text())})),a(".avia_select_unify select").not(".avia_multiple_select select").each((function(){var e=a(this);e.css("opacity",0).next(".avia_select_fake_val").text(e.find("option:selected").text())})),a("input[name=avia_options_first_call]","#avia_hidden_data").length&&a(".avia_link_controller_active").trigger("click")})),function(a){avia_callback.gmaps_values={callback:!1,value:!1},avia_callback.av_maps_js_api_check=function(e,i){var t="https://maps.googleapis.com/maps/api/js?v=3.30&callback=av_backend_maps_loaded&key="+e;void 0!==avia_framework_globals.gmap_backend_maps_loaded&&""!=avia_framework_globals.gmap_backend_maps_loaded&&(t=avia_framework_globals.gmap_backend_maps_loaded+"&key="+e);var n=document.createElement("script");n.id="av-google-maps-api",n.type="text/javascript",n.src=t,n.onerror=av_google_maps_api_load_error,avia_callback.gmaps_values={callback:i,value:e},a('script[src*="maps.google"]').remove(),google.maps=!1,document.body.appendChild(n)},av_google_maps_api_load_error=function(){var a="Google Maps API could not be loaded. We are not able to verify the key. Check your internet connection and try again.";void 0!==AviaMapData.api_load_error&&""!=AviaMapData.api_load_error&&(a=AviaMapData.api_load_error),avia_callback.gmaps_values.callback.call(this,"error"),alert(a)},av_backend_maps_loaded=function(){var a=0;(new google.maps.Geocoder).geocode({address:"Stephansplatz 1 Vienna 1010 Austria"},(function(e,i){i===google.maps.GeocoderStatus.OK?a=!0:google.maps.GeocoderStatus.REQUEST_DENIED,avia_callback.gmaps_values.callback.call(this,a)}))},gm_authFailure=function(){avia_callback.gmaps_values.callback&&avia_callback.gmaps_values.callback.call(this,!1)}}(jQuery),function(a){avia_callback.av_recaptcha_values={callback:!1,version:"",sitekey:"",secretkey:"",container:!1,current_id:!1,widget_id:!1,monitor_check:!1,theme:"light"},avia_callback.av_recaptcha_js_api_check=function(e,i){var t=a(this),n=t.closest(".av-verify-button-container"),r=t.data("av-verify-fields"),c=!1,o="",l="",_="",s="",v="light";r=r.split(","),a(".av-recaptcha-callback-error").hide(),o="https://www.google.com/recaptcha/api.js",void 0!==AviaReCAPTCHA_data.api&&""!=AviaReCAPTCHA_data.api&&(o=AviaReCAPTCHA_data.api),void 0!==AviaReCAPTCHA_data.theme&&""!=AviaReCAPTCHA_data.theme&&(v=AviaReCAPTCHA_data.theme);var d=t.attr("id").trim();switch(d.indexOf("recaptcha_key_verify_v2")>=0?l="avia_recaptcha_v2":d.indexOf("recaptcha_key_verify_v3")>=0&&(l="avia_recaptcha_v3"),l){case"avia_recaptcha_v2":_=void 0!==r[1]?n.find('input[name="'+r[1]+'"]').val().trim():"",s=void 0!==r[2]?n.find('input[name="'+r[2]+'"]').val().trim():"",""==(v=void 0!==r[5]?n.find('select[name="'+r[5]+'"]').find(":selected").attr("value").trim():"light")&&(v="light"),o+="?onload=av_recaptcha_api_loaded&render=explicit",c=!0;break;case"avia_recaptcha_v3":_=void 0!==r[3]?n.find('input[name="'+r[3]+'"]').val().trim():"",s=void 0!==r[4]?n.find('input[name="'+r[4]+'"]').val().trim():"",o+="?onload=av_recaptcha_api_loaded&render="+_;break;default:l=""}if(""==l||""==_||""==s){var u=""==l?AviaReCAPTCHA_data.invalid_version:AviaReCAPTCHA_data.invalid_keys;return u='<div class="av-notice-error">'+u+"</div>",n.find(".av-verification-result").html(u),!1}avia_callback.av_recaptcha_values.callback=i,avia_callback.av_recaptcha_values.version=l,avia_callback.av_recaptcha_values.sitekey=_,avia_callback.av_recaptcha_values.secretkey=s,avia_callback.av_recaptcha_values.container=n,avia_callback.av_recaptcha_values.current_id=!1,avia_callback.av_recaptcha_values.widget_id=!1,avia_callback.av_recaptcha_values.theme=v,a('script[src*="recaptcha/api.js"]').remove(),a("#av-recaptcha-api-script").remove();var p=document.createElement("script");p.id="av-recaptcha-api-script",p.type="text/javascript",p.src=o,p.onerror=av_recaptcha_api_load_error,c&&(p.defer=!0),document.body.appendChild(p)},av_recaptcha_api_load_error=function(){var a="Google reCAPTCHA API could not be loaded. We are not able to verify keys. Check your internet connection and try again.";void 0!==AviaReCAPTCHA_data.v3_timeout&&""!=AviaReCAPTCHA_data.v3_timeout&&(a=AviaReCAPTCHA_data.api_load_error),avia_callback.av_recaptcha_values.callback.call(this,"error"),alert(a)},av_recaptcha_api_loaded=function(){avia_callback.av_recaptcha_values.container.find(".av-verification-result");if("avia_recaptcha_v2"==avia_callback.av_recaptcha_values.version){var a=av_recaptcha_unique_id(),e='<div id="'+a+'" class="av-recaptcha-verify"></div>';avia_callback.av_recaptcha_values.container.find(".av-verification-result").first().before(e),avia_callback.av_recaptcha_values.current_id=a,avia_callback.av_recaptcha_values.widget_id=grecaptcha.render(a,{sitekey:avia_callback.av_recaptcha_values.sitekey,callback:av_recaptcha_verify_VerifyCallback,"error-callback":av_recaptcha_verify_ErrorCallback,theme:avia_callback.av_recaptcha_values.theme})}else"avia_recaptcha_v3"==avia_callback.av_recaptcha_values.version&&grecaptcha.ready((function(){avia_callback.av_recaptcha_values.monitor_check=setTimeout(av_recaptcha_verify_MonitorVerify,5e3),grecaptcha.execute(avia_callback.av_recaptcha_values.sitekey,{action:"verify_keys"}).then(av_recaptcha_verify_VerifyCallback)}))},av_recaptcha_verify_MonitorVerify=function(){avia_callback.av_recaptcha_values.monitor_check=!1;var a="A network timeout problem occured. Could be caused by an invalid V3 sitekey. Please recheck the key and try again.";void 0!==AviaReCAPTCHA_data.v3_timeout&&""!=AviaReCAPTCHA_data.v3_timeout&&(a=AviaReCAPTCHA_data.v3_timeout),avia_callback.av_recaptcha_values.callback.call(this,"error"),alert(a)},av_recaptcha_verify_VerifyCallback=function(e){!1!==avia_callback.av_recaptcha_values.monitor_check&&(clearTimeout(avia_callback.av_recaptcha_values.monitor_check),avia_callback.av_recaptcha_values.monitor_check=!1);var i={token:e,version:avia_callback.av_recaptcha_values.version,sitekey:avia_callback.av_recaptcha_values.sitekey,secretkey:avia_callback.av_recaptcha_values.secretkey,current_id:avia_callback.av_recaptcha_values.current_id};a("#av-recaptcha-api-script").remove(),!1!==avia_callback.av_recaptcha_values.widget_id&&grecaptcha.reset(avia_callback.av_recaptcha_values.widget_id),a("#"+avia_callback.av_recaptcha_values.current_id).remove(),avia_callback.av_recaptcha_values.callback.call(this,i)},av_recaptcha_verify_ErrorCallback=function(){a("#"+avia_callback.av_recaptcha_values.current_id).addClass("av-recaptcha-callback-error"),avia_callback.av_recaptcha_values.callback.call(this,"error")},av_recaptcha_unique_id=function(){for(var e=a("body"),i=0;;){var t="av-verify-recaptcha-"+i;if(0==e.find("#"+t).length)return t;i++}}}(jQuery),function(a){a.fn.avia_verify_input=function(e){a(this).on("click",(function(e){e.preventDefault();var i=a(this),t=i.parents(".avia_verification_field"),n=t.find(".avia_verify_input input"),r=t.find(".av-verification-result"),c="",o=i.data("av-verification-callback"),l=i.data("av-verification-callback-javascript"),_=a("#avia_hidden_data input[name=avia-nonce]").val(),s=a("#avia_hidden_data input[name=_wp_http_referer]").val(),v=a(".avia_header .avia_loading, .avia_footer .avia_loading");if(i.hasClass("avia_button_inactive"))return!1;var d=function(e){if(void 0===e&&(e=""),"error"==e)return v.fadeOut(),void i.removeClass("avia_button_inactive");a.ajax({type:"POST",url:window.ajaxurl,dataType:"json",cache:!1,data:{action:"avia_ajax_verify_input",key:n.attr("id"),avia_ajax:!0,value:c,js_value:e,callback:o,_wpnonce:_,_wp_http_referer:s},beforeSend:function(){v.css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:1}),i.addClass("avia_button_inactive")},error:function(){r.html("Could not connect to the internet. Please reload the page and try again")},success:function(e){if(!0===e.success){void 0!==e.update_input_fields&&a.each(e.update_input_fields,(function(e,i){a("input[name='"+e+"']").val(i)}));var i=e.html;-1!==i.indexOf("avia_trigger_save")&&(a(".avia_submit").eq(0).removeClass("avia_button_inactive").trigger("click"),i=i.replace("avia_trigger_save","")),r.html(i)}},complete:function(a){v.fadeOut(),i.removeClass("avia_button_inactive")}})};(c=n.val(),window.avia_callback[l])?(v.css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:1}),i.addClass("avia_button_inactive"),!1===window.avia_callback[l].call(this,c,d)&&(v.fadeOut(),i.removeClass("avia_button_inactive"))):d();return!1}))}}(jQuery),function(a){a.fn.avia_event_binding=function(e){return this.each((function(){if(window.parent&&window.parent.document&&"skip"!=e)parent.jQuery(window.parent.document.body).trigger("avia_event_binding",[this]);else{var i=a(this);a.fn.avia_media_advanced_plugin&&i.avia_media_advanced_plugin(),a.fn.avia_color_picker_activation&&i.avia_color_picker_activation(),a.fn.avia_clone_sets&&i.avia_clone_sets(),a.fn.avia_form_requirement&&a(".avia_required_container",i).not(".avia_delay_required .avia_required_container").avia_form_requirement(),a.fn.avia_target&&a(".avia_target_value",i).avia_target(),a.fn.avia_prefill_options&&a(".avia_link_controller",i).avia_prefill_options(),a.fn.avia_on_change&&a(".avia_on_change",i).avia_on_change();var t=a(".avia_submit");a("input, select, textarea",i).not(".avia_button_inactive").on("keydown change",(function(){t.removeClass("avia_button_inactive")})),a(".avia_clone_set, .avia_remove_set, .avia_dynamical_add_elements",i).on("click",(function(){t.removeClass("avia_button_inactive")})),a(".avia_select_unify select").not(".avia_multiple_select select").css("opacity",0)}}))}}(jQuery),jQuery.fn.avia_event_listener=function(a){this.on("avia_event_binding",(function(a,e){parent.jQuery(e).avia_event_binding("skip")}))},function(a){var e={insertEL:function(i){var t=i.data.self,n=t.insertVal.val(),r="";return!!n&&(t.insertVal.val("").trigger("change"),(r=a(t.container.find("#avia-tmpl-wizard-"+n).html())).css({display:"none"}).prependTo(t.insertContainer).slideDown(),r.find(".av-wizard-subcontainer-colorpicker").avia_color_picker_activation(),r.find("input, select, textarea").on("keydown change",(function(){t.saveButton.removeClass("avia_button_inactive")})),e.recalc(t.insertContainer),!1)},deleteEL:function(i){var t=i.data.self,n=a(this).parents(".av-wizard-element").eq(0);return n.slideUp((function(){n.remove(),e.recalc(t.insertContainer)})),t.insertVal.trigger("change"),!1},recalc:function(e){e.find(".av-wizard-element").each((function(e){a(this).find("[data-recalc]").each((function(){var i=a(this),t=i.data("recalc").replace("{counter}",e);i.attr("name",t)}))}))}};a.fn.avia_styling_wizard=function(i){return this.each((function(){var i={};i.container=a(this),i.insertContainer=i.container.find(".av-wizard-element-container"),i.insertBtn=i.container.find(".add_wizard_el_button"),i.insertVal=i.container.find(".add_wizard_el"),i.saveButton=a(".avia_submit"),i.insertBtn.on("click",{self:i},e.insertEL),i.container.on("click",".avia_remove_wizard_set",{self:i},e.deleteEL)}))}}(jQuery),function(a){a.fn.avia_on_change=function(e){return this.each((function(){var e=a(this),i=e.data("avia-onchange"),t={avia_add_google_font:function(){var e=a(this),i=e.val(),t=e.parents(".avia_control").eq(0);t.find(".webfont_"+this.id).remove();if(i){var n=i.replace(/ /g,"+",i),r="";-1!=i.indexOf("-websave")?(i=(i=i.replace(/-websave/g,"",i)).replace(/-/g,"",i),r='<style type="text/css">.webfont_'+this.id+"{font-family:'"+i.replace(/:(\d+)$/,"")+"';}</style>"):-1!=i.indexOf("-custom")?(i=i.replace(/-custom/g,"",i),r='<style type="text/css">.webfont_'+this.id+"{font-family:'"+i+"';}</style>"):r='<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family='+n+'" /> <style type="text/css">.webfont_'+this.id+"{font-family:'"+i.replace(/:(.+)$/,"")+"';}</style>",a('<div class="webfont_'+this.id+'">'+r+"</div>").appendTo(t)}}};e.on("change",t[i]).trigger("change")}))}}(jQuery),function(a){a.fn.avia_prefill_options=function(e){return this.each((function(){var e=a(this),i=e.parents(".avia_section").eq(0).find(".avia_link_controller"),t=e.data(),n="",r=function(){for(n in i.removeClass("avia_link_controller_active"),e.addClass("avia_link_controller_active"),t)if("string"==typeof t[n]||"number"==typeof t[n]||"boolean"==typeof t[n]){var r=n.replace(/([A-Z])/g,"-$1").toLowerCase(),c=a("#"+r);c.length&&(c.is("input[type=text]")||c.is("input[type=hidden]")||c.is("select"))&&(""!=t[n]&&c.is("[data-baseurl]")&&(t[n]=t[n].replace(c.data("baseurl"),"{{AVIA_BASE_URL}}")),c.val(t[n]).trigger("change"))}return!1};e.on("click",r)}))}}(jQuery),function(a){a.fn.avia_target=function(e){return this.each((function(){var e=a(this),i=e.parents(".avia_section").eq(0),t=i.find("[data-baseurl]"),n="",r="",c=e.val().split("::"),o=a("#avia_"+c[0]);o.length||(o=a(c[0]));var l=a(c[1],o),_=c[2];t.length&&(n=t.data("baseurl"));var s=function(){var a=r.val(),e=!1,t=[],c=r.attr("id");for(var o in i.is(".avia_checkbox")&&!r.is(":checked")&&(a=""),""!=a&&null!=a&&n&&(a=a.replace("{{AVIA_BASE_URL}}",n)),t=_.indexOf(",")>=0?_.split(","):[_])switch("block"!=i.css("display")&&(a="",e=!0),t[o]){case"background-color":l.css({"background-color":a});break;case"background-image":e||l.css({"background-image":"url("+a+")"});break;case"border-color":l.css({"border-color":a});break;case"color":l.css({color:a});break;case"set_class":l.attr({class:a});break;case"set_data":l.attr("data-"+c,a);break;case"set_id":l.attr({id:a.replace(/\./,"-")});break;case"set_id_single":l.attr({id:a.split(" ")[0]});break;case"set_active":""!=a?l.addClass("av-active"):l.removeClass("av-active");break;case"width":l.css({width:a+"%"});break;default:var s={};s[t[o]]=a,l.css(s)}};(i.is(".avia_select")||i.is(".avia_select_sidebar"))&&(r=i.find("select")),i.is(".avia_colorpicker")&&(r=i.find(".avia_color_picker")),i.is(".avia_upload")&&(r=i.find(".avia_upload_input")),i.is(".avia_checkbox")&&(r=i.find("input[type=checkbox]")),"string"!=typeof r&&r.on("change",(function(){s()})),setTimeout((function(){s()}),200)}))}}(jQuery),function(a){a.fn.avia_form_requirement=function(i){return this.each((function(){var i=a(this),t={el:i,elHeight:i.css({display:"block",height:"auto"}).height(),elPadd:{top:i.css("paddingTop"),bottom:i.css("paddingBottom")},required:a(".avia_required",this).val().split("::")},n=a(".avia_required",this).parents(".avia_section").eq(0).attr("id");"string"!=typeof n&&(n=a(".avia_required",this).parents(".avia_visual_set").eq(0).attr("id"));var r=n.split("-__-");r=void 0!==r[1]?r[r.length-1]:r[0],i.css({display:"none"});var c=i.siblings("div[id$="+t.required[0]+"]");0==c.length&&(c=i.parents(".inside").find("div[id$="+t.required[0]+"]"));var o=a(":input[name$="+t.required[0]+"]",c);if(0==o.length&&(o=a(":input[name$="+t.required[0]+"]")),i.is(".inactive_visible")&&a('<div class="avia_inactive_overlay"><span>'+i.data("group-inactive")+"</span></div>").appendTo(i),o.is(":checkbox")){var l="{false}"==t.required[1]||""==t.required[1];(o.prop("checked")&&!l||!o.prop("checked")&&l)&&(i.is(".inactive_visible")?i.addClass("avia_visible"):i.css({display:"block"}))}else{var _=!1;if(-1!==t.required[1].indexOf("{contains_array}")){var s=t.required[1].replace("{contains_array}","").split(";");a.each(s,(function(a,e){if(-1!==o.val().indexOf(e))return _=!0,!1}))}(o.val()==t.required[1]||""!=o.val()&&"{true}"==t.required[1]||""==o.val()&&"{false}"==t.required[1]||-1!==t.required[1].indexOf("{contains}")&&-1!==o.val().indexOf(t.required[1].replace("{contains}",""))||-1!==t.required[1].indexOf("{not}")&&o.val().indexOf(t.required[1].replace("{not}",""))<0||-1!==t.required[1].indexOf("{higher_than}")&&parseInt(o.val())>=parseInt(t.required[1].replace("{higher_than}",""))||_)&&(i.is(".inactive_visible")?i.addClass("avia_visible"):i.css({display:"block"}))}o.on("change",{set:t},e.change)}))};var e={change:function(e){var i=e.data.set,t=a(this),n=t.val(),r=!1,c=t.is(":checkbox"),o=!1;if(c&&(t.prop("checked")?(n=""!=n?n:"{true}",o="{false}"!=i.required[1]&&""!=i.required[1]):(n="{false}",o="{false}"==i.required[1]||""==i.required[1])),-1!==i.required[1].indexOf("{contains_array}")){var l=i.required[1].replace("{contains_array}","").split(";");a.each(l,(function(a,e){if(-1!==n.indexOf(e))return r=!0,!1}))}if(n==i.required[1]||!c&&""!=n&&"{true}"==i.required[1]||""==n&&"{false}"==i.required[1]||-1!==i.required[1].indexOf("{contains}")&&-1!==n.indexOf(i.required[1].replace("{contains}",""))||-1!==i.required[1].indexOf("{not}")&&n.indexOf(i.required[1].replace("{not}",""))<0||-1!==i.required[1].indexOf("{higher_than}")&&parseInt(n)>=parseInt(i.required[1].replace("{higher_than}",""))||r||o){if(i.el.is(".inactive_visible"))return void i.el.addClass("avia_visible");"none"==i.el.css("display")&&(0==i.elHeight&&(i.elHeight=i.el.css({visibility:"hidden",position:"absolute"}).height()),i.el.css({height:0,opacity:0,overflow:"hidden",display:"block",paddingBottom:0,paddingTop:0,visibility:"visible",position:"relative"}).animate({height:i.elHeight,opacity:1,paddingTop:i.elPadd.top,paddingBottom:i.elPadd.bottom},(function(){i.el.css({overflow:"visible",height:"auto"})})))}else{if(i.el.is(".inactive_visible"))return void i.el.removeClass("avia_visible");if("block"==i.el.css("display")){if(i.el.is(".set_blank_on_hide"))i.el.find(".set_blank_on_hide").val("").trigger("change");i.el.css({overflow:"hidden"}).animate({height:0,opacity:0,paddingBottom:0,paddingTop:0},(function(){i.el.css({display:"none",overflow:"visible",height:"auto"})}))}}}}}(jQuery),function(a){a.fn.avia_clone_sets=function(e){return this.each((function(){var e=a(this);if(1==e.length){var t=a("#avia_hidden_data"),n={container:e,createButton:a(".avia_clone_set",this),removeButton:a(".avia_remove_set",this),nonce:a("input[name=avia-nonce]",t).val(),ajaxUrl:a("input[name=admin_ajax_url]",t).val(),ref:a("input[name=_wp_http_referer]",t).val(),prefix:a("input[name=avia_options_prefix]",t).val(),meta_active:a("input[name=meta_active]",t)};n.createButton.off("click").on("click",{set:n},i.add),n.removeButton.off("click").on("click",{set:n},i.remove)}}))};var e=!1,i={add:function(t){if(e)return!1;e=!0;var n=t.data.set,r=a(this),c=r.prev(".avia_clone_loading"),o=r.parents(".avia_set").eq(0),l=r.parents(".avia_set").eq(1).not(".avia_tab_container"),_=o.attr("id");if(1==l.length){var s=l.attr("id");_=_.replace(s+"-__-","").replace(/-__-\d+/,"")}else _=_.replace("avia_","").replace(/-__-\d+/,"");var v="options_page";return n.meta_active.length&&(v="metabox"),a.ajax({type:"POST",url:n.ajaxUrl,data:{action:"avia_ajax_modify_set",method:"add",elementSlug:_,context:v,_wpnonce:a("input[name=avia-nonce]").val(),_wp_http_referer:a("input[name=_wp_http_referer]").val()},beforeSend:function(){c.fadeIn(300)},error:function(){a("body").avia_alert({the_class:"error",text:"Couldnt connect to your Server <br/> Please wait a few seconds and try again",show:4500}),c.fadeOut(300)},success:function(e){var t=e.match(/\{avia_ajax_element\}(.+|\s+)\{\/avia_ajax_element\}/);if(null!=t){var r=a(t[1]).css("display","none");i.setBlank(r),r.insertAfter(o).slideDown(400,(function(){n.currentSet=r,i.recalcIds(n),r.avia_event_binding()})),t[0]!=e&&(e=e.replace(t[0],""),a("body").avia_alert({the_class:"error",text:"Adding of element successful but the script generated unexpected output: <br/><br/> "+e,show:6e3}))}},complete:function(a){c.fadeOut(300),e=!1}}),!1},remove:function(t){if(e)return!1;e=!0;var n=t.data.set,r=a(this).parents(".avia_set").eq(0),c=r.attr("id").replace(/-__-\d+$/,"-__-");return n.setsToCount=r.siblings(".avia_set").filter("[id*="+c+"]"),n.setsToCount.length||n.removeButton.is(".remove_all_allowed")?(n.currentSet=n.setsToCount.eq(0),r.slideUp(400,(function(){r.remove(),i.recalcIds(n),e=!1}))):(i.setBlank(r),n.setsToCount=!1,e=!1),!1},setBlank:function(e){a("input:text, input:hidden, textarea",e).not(".avia_upload_insert_label, .avia_required").val("").trigger("change"),a("input:checkbox, input:radio",e).prop("checked",!1).trigger("change"),a("select",e).prop("selected",!1).trigger("change"),a(".avia_preview_pic, .avia_color_picker_div",e).html("").css({backgroundColor:"transparent"})},recalcIds:function(a){avia_recalcIds(a)}};avia_recalcIds=function(e){if(!e.setsToCount){var i=e.container.attr("id").replace(/-__-\d+$/,"-__-");e.setsToCount=e.currentSet.siblings(".avia_set").filter("[id*="+i+"]").add(e.currentSet)}var t,n,r=e.currentSet.parents(".avia_set").eq(0).not(".avia_tab_container"),c="";"string"==typeof e.detach&&(n=(t=e.currentSet.parents(e.detach).eq(0)).parent(),t.detach()),1==r.length?(c=e.currentSet.attr("id").replace("avia_",""),c=r.attr("id")+"-__-"+c.replace(/\d+$/,"")):e.currentSet.attr("id")&&(c=e.currentSet.attr("id").replace(/\d+$/,"")),e.setsToCount.each((function(e){a(this);var i=a("[id*=-__-], [name*=-__-]",this),t=c+e;this.id=t,i.each((function(){var e=a(this),i=this.id,t=e.parents(".avia_set").eq(0)[0].id.replace("avia_",""),n=i.match(/[a-z0-9](-__-[-_a-zA-Z0-9]+-__-\d+)$/);if(null==n){n=/.+-__-([-_a-zA-Z0-9]+)$/.exec(i),id_string=t+"-__-"+n[1],this.name?this.name=id_string:id_string="avia_"+id_string,this.id=id_string}else el_attr_array=n[1],this.id="avia_"+t+el_attr_array}))})),e.setsToCount="",void 0!==t&&t.length&&t.prependTo(n)}}(jQuery),function(a){a.fn.avia_instant_editor=function(e){"use strict";var i=a(window),t=!1,n={class:"avia_default_instant_editor",elements:"td",input:{avia_text:"textarea"},output:"",start:"click",appendTo:!1,special_buttons:!1},r={bind_event:function(a){var e=a.options;a.off(".avia_instant_edit",e.elements),a.on(e.start+".avia_instant_edit",e.elements,(function(e){r.show_editor(this,a,e)})),a.on("click.avia_instant_edit",".avia_editor_button",(function(e){r.insert_button_shortcode(this,a,e)})),i.off(".avia_instant_edit_keyup").on("keyup.avia_instant_edit_keyup",(function(e){r.key_binds(this,a,e)}))},key_binds:function(a,e,i){var n=e.options;if(9===i.keyCode)if(t&&t.length){var r=e.find(n.elements),c=r.index(t),o=i.shiftKey?-1:1,l=r.eq(c+o);l.length||(l=1==o?r.eq(0):r.last()),l.trigger("click"),i.stopPropagation(),i.preventDefault(),t=l}},insert_button_shortcode:function(e,i,t){t.stopPropagation(),t.preventDefault();var n=e.hash.substring(1),r=i.options.special_buttons[n].code,c=a(e).parents(".avia_instant_editor").eq(0).find(":input").eq(0),o=c.val();"Edit"==o?c.val(r):c.val(o+r)},show_editor:function(e,n,c){c.stopPropagation();var o=a(e);if(!o.is(".avia_active_editor")){var l=o.html(),_=r.form_builder(n,l);o.addClass("avia_active_editor").html(_),o.find(":input").eq(0).trigger("focus").trigger("select"),i.trigger("click"),r.closeListener(n,o),t=o}},close_editor:function(a,e){if(""==a.options.output){var n,r=a.options.input,c="";for(n in r)c+=e.find(r[n]).val();c=c.replace(/\n/g,"</br>"),e.html(c).removeClass("avia_active_editor"),i.off(".avia_instant_edit"),t=!1}},form_builder:function(a,e){var i,t=a.options.input,n="<div class='avia_instant_editor "+a.options.class+"'>";for(i in n+=r.button_builder(a),t)n+=r[t[i]].call(this,i,e);return n+="</div>"},button_builder:function(a){var e,i=a.options.special_buttons,t="";for(e in i)t+="<a href='#"+e+"' class='avia_editor_button "+e+"'>"+i[e].label+"</a>";return t},textarea:function(a,e){return"<textarea class='"+a+"'>"+(e=e.replace(/<\/br>/g,"\n").replace(/<br>/g,"\n"))+"</textarea>"},input:function(a,e){return"<input class='"+a+"' value='"+e+"' />"},closeListener:function(a,e){i.off(".avia_instant_edit").on(a.options.start+".avia_instant_edit",(function(i){e.get(0)!=i.target&&r.close_editor(a,e)}))}};return this.each((function(){var i=a(this);i.options=a.extend({},n,e),r.bind_event(i)}))}}(jQuery);