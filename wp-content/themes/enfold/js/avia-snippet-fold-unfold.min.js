"use strict";var avia_js_shortcodes=avia_js_shortcodes||{},aviaJS=aviaJS||{};!function(){if(!avia_js_shortcodes.aviaFoldUnfoldSection){class avFoldUnfoldSection{container=null;id="";settings={};button=[];foldContainer=[];folded=!1;preview=!1;innerDimension={};textblock=[];multiColumsTextblock=!1;gridRow=[];colorSection=[];column=[];constructor(t){this.container=t,this.container.avFoldUnfoldSection=this,this.id=t.getAttribute("id"),this.init()}init(){if(this.settings=JSON.parse(this.container.dataset.fold_unfold),this.preview=null!=document.getElementById("av-admin-preview"),this.moveIntoFoldContainer(),this.button.length&&this.foldContainer.length&&!this.checkMissingInnerContainers()){if(this.isNested())return this.container.classList.remove("avia-fold-init"),this.foldContainer[0].classList.remove("unfolded","folded"),this.foldContainer[0].style["max-height"]="unset",void this.button[0].remove();this.foldContainer[0].style["max-height"]=this.settings.height+"px",this.foldContainer[0].classList.add("folded"),this.foldContainer[0].classList.remove("unfolded"),this.folded=!0,this.container.classList.add("avia-fold-init-done"),this.getMaxHeight(),this.foldChanged(),this.bindEvents(),this.container.classList.remove("avia-fold-init")}}moveIntoFoldContainer(){if(this.container.hasChildNodes()){let t=this.container.childNodes;for(const i of t)if(i.classList&&(i.classList.contains("av-fold-unfold-container")&&(this.foldContainer[0]=i),i.classList.contains("av-fold-button-wrapper"))){const t=i.getElementsByClassName("av-fold-button-container");t.length&&(this.button[0]=t[0])}}let t=null;if("avia_sc_text"==this.settings.context){let i=this.foldContainer[0].nextSibling;for(;i;){if(i.classList&&i.classList.contains("avia_textblock")){t=i;break}i=i.nextSibling}}else if("avia_sc_columns"==this.settings.context){let t=this.foldContainer[0].nextSibling;if(this.column=this.foldContainer[0].getElementsByClassName("av-fold-unfold-inner"),this.column.length)for(;t;)if(t.classList&&t.classList.contains("av-fold-button-wrapper"))t=t.nextSibling;else{const i=t.nextSibling;this.column[0].append(t),t=i}}else{const i=this.container.nextSibling;i&&(t=i)}t&&this.foldContainer[0].append(t)}checkMissingInnerContainers(){let t=!1;switch(this.settings.context){case"avia_sc_text":this.textblock=this.container.getElementsByClassName("avia_textblock"),0==this.textblock.length?t=!0:this.multiColumsTextblock=this.textblock[0].classList.contains("av_multi_colums");break;case"avia_sc_grid_row":this.gridRow=this.container.getElementsByClassName("av-layout-grid-container"),0==this.gridRow.length&&(t=!0);break;case"avia_sc_section":this.colorSection=this.container.getElementsByClassName("avia-section"),0==this.colorSection.length&&(t=!0);break;case"avia_sc_columns":this.column[0].childNodes.length||(t=!0);break;default:t=!0}return t}isNested(){const t=this.container.parentElement;if(null==t)return!1;let i=t.closest(".avia-fold-unfold-section");return i==t&&(i=null),null!=i}bindEvents(){this.container.addEventListener("transitionend",this.onTransitionEnd.bind(this)),this.container.addEventListener("webkitTransitionEnd",this.onTransitionEnd.bind(this)),this.button[0].addEventListener("click",this.onClickFoldUnfold.bind(this)),window.addEventListener("avia_fold_unfold_changed",this.onFoldUnfoldChanged.bind(this)),window.addEventListener("resize",aviaJS.aviaJSHelpers.debounce(this.onResize.bind(this),200))}getMaxHeight(){switch(this.settings.context){case"avia_sc_text":this.innerDimension=this.textblock[0].getBoundingClientRect();break;case"avia_sc_grid_row":this.innerDimension=this.gridRow[0].getBoundingClientRect();break;case"avia_sc_section":this.innerDimension=this.colorSection[0].getBoundingClientRect();break;case"avia_sc_columns":this.innerDimension=this.column[0].getBoundingClientRect()}}foldChanged(){let t="",i="";this.folded?(this.foldContainer[0].style["max-height"]=this.settings.height+"px",t=this.settings.more,i="#"):(this.getMaxHeight(),this.foldContainer[0].style["max-height"]=Math.ceil(this.innerDimension.height)+200+"px",t=this.settings.less,i+="#"+this.id),this.button[0].setAttribute("href",i),this.button[0].textContent=t,this.triggerHeightChange()}onClickFoldUnfold(t){t.preventDefault(),t.stopPropagation(),this.foldContainer[0].classList.contains("folded")?(this.foldContainer[0].classList.remove("folded"),this.foldContainer[0].classList.add("unfolded"),this.folded=!1):(this.foldContainer[0].classList.remove("unfolded"),this.foldContainer[0].classList.add("folded"),this.folded=!0),this.foldChanged();let i=this;setTimeout((function(){const t=new CustomEvent("avia_fold_unfold_changed",{bubbles:!0,cancelable:!0,detail:{caller:i}});i.container.dispatchEvent(t)}),500)}onTransitionEnd(t){this.container.classList.remove("avia-fold-init-done"),this.triggerHeightChange()}onResize(t){this.foldChanged()}onFoldUnfoldChanged(t){this.foldChanged()}triggerHeightChange(){const t=new CustomEvent("avia_height_change",{bubbles:!0,cancelable:!0});window.dispatchEvent(t)}}avia_js_shortcodes.aviaFoldUnfoldSection=function(t){return new avFoldUnfoldSection(t)},aviaJS.aviaPlugins.register(avia_js_shortcodes.aviaFoldUnfoldSection,".avia-fold-unfold-section")}}();