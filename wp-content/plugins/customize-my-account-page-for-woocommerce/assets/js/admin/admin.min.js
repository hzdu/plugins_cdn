"use strict";jQuery(function($){var currentHref="",$tabs=$("#tgwc-tabs"),$lis=$tabs.find(".dd-item"),$deleteDialog=$("#tgwc-dialog-delete");$(window).on("load added_endpoint",function(){$('input[name*="enable"]').on("change",function(){var $endpointSlug=$(this).closest(".tgwc-tabs-panel").prop("id"),$endpointItem=$('.dd-item[data-id="'+$endpointSlug+'"]');$(this).prop("checked")?$endpointItem.find(".tgwc-sidenav-tab-anchor span:nth-child(2)").hide():$endpointItem.find(".tgwc-sidenav-tab-anchor span:nth-child(2)").show()})}),$.each($lis,function(index,li){var href=$(li).find("a").attr("href");index>0?$(href).hide():($(li).addClass("active"),$(href).addClass("active"),currentHref=href)}),$tabs.on("click",".dd-item a",function(e){e.preventDefault(),e.stopPropagation();var href=$(this).attr("href"),$tabContainer=$(href);currentHref!==href&&($tabs.find(".dd-item").removeClass("active"),$(currentHref).removeClass("active"),$(this).parents(".dd-item").first().addClass("active"),$(href).addClass("active"),$(currentHref).fadeOut($.proxy(function(){$(this).fadeIn()},$tabContainer)),currentHref=href)}),$tabs.on("click",".tgwc-delete-endpoints",function(e){e.preventDefault(),$deleteDialog.dialog({resizable:!1,height:"auto",width:400,modal:!0,autoOpen:!0,open:function(){$(this).parent(".ui-dialog").find(".tgwc-button--danger:eq(0)").focus()},buttons:[{text:window.tgwc.i18n.cancel,"class":"tgwc-button tgwc-button--link tgwc-endpoint-dialog-form-cancel",tabindex:2,click:function(){$(this).dialog("close")}},{text:window.tgwc.i18n["delete"],"class":"tgwc-button tgwc-button--danger",tabindex:1,click:$.proxy(function(){$deleteDialog.dialog("close");var $panel=$(this).closest(".tgwc-tabs-panel"),panelId=$panel.attr("id"),$tab=$panel.siblings(".tgwc-sidenav").find('[data-id="'+panelId+'"]'),$tabSibling=$tab.siblings(".dd-item").first();$tabSibling.length||($tabSibling=$tab.parents(".dd-item").first()),$tabSibling.first().find("a").first().trigger("click"),$tab.fadeOut(function(){$(this).remove(),$panel.remove()})},this)}]})})}),function($,tgwc){var $icons=$('select[name$="[icon]"]');$.fn.select2.amd.require(["select2/data/array","select2/utils"],function(ArrayData,Utils){function CustomData($element,options){CustomData.__super__.constructor.call(this,$element,options)}Utils.Extend(CustomData,ArrayData),CustomData.prototype.query=function(params,callback){var results=[];results=params.term&&""!==params.term?_.filter(tgwc.icons,function(e){return e.text.toUpperCase().indexOf(params.term.toUpperCase())>=0}):tgwc.icons,"page"in params||(params.page=1);var data={};data.results=results.slice(50*(params.page-1),50*params.page),data.pagination={},data.pagination.more=50*params.page<results.length,callback(data)},$.each($icons,function(index,icon){$(icon).select2({placeholder:tgwc.i18n.selectAnIcon,allowClear:!0,ajax:{},dataAdapter:CustomData,escapeMarkup:function(markup){return markup}});var selectedIcon=$(icon).data("selected");if(""!==selectedIcon||undefined!==selectedIcon){var text=selectedIcon.replace("fas fa-","");text=`<i class="${selectedIcon}"></i> ${text=(text=text.replace("-"," ")).charAt(0).toUpperCase()+text.slice(1)}`;var newOption=new Option(text,selectedIcon,!0,!0);$(icon).append(newOption).trigger("change")}})})}(jQuery,window.tgwc),jQuery(function($){var $tabs=$("#tgwc-tabs"),$endpointDialog=$("#tgwc-endpoint-dialog"),$endpointDialogType=$("#tgwc-endpoint-dialog-type"),$endpointDialogName=$("#tgwc-endpoint-dialog-name");function addTab(form){var name=$endpointDialogName.val(),type=$endpointDialogType.val(),prefixType=type.substring(0,1).toUpperCase(),slug=textToID(name),li=[`<li class="dd-item ${type}" data-id="${slug=function(slug){var firstCharacter=(slug=(slug=slug.replace(/[^\w- ]+/g,"")).trim()).substring(0,1);"-"!==firstCharacter&&"_"!==firstCharacter||(slug=slug.substring(1,slug.length));var lastCharacter=(slug=slug.trim()).substring(slug.length-1,slug.length);"-"!==lastCharacter&&"_"!==lastCharacter||(slug=slug.substring(0,slug.length-1));slug="#"+slug;var $anchors=$tabs.find("li a"),hrefs=$.map($anchors,function(anchor){return $(anchor).attr("href")});hrefs=hrefs.concat(["#pagename","#page","#page_id","#preview"]);for(;hrefs.indexOf(slug)>-1;)slug+=1;return slug.substr(1)}(slug)}" data-type="${type}">`,'<span class="dd-handle dd3-handle"></span>',`<a class="dd3-content tgwc-sidenav-tab-anchor" href="#${slug}"><span title="${type.charAt(0).toUpperCase()+type.slice(1)}">[${prefixType}]</span> <span>[D]</span> <span>${name}</span></a>`,"</li>"].join("");if(""===name)return $(form).find(".tgwc-error-message").html("Empty name is not allowed."),!1;var template=wp.template(`tgwc-${type}`);$tabs.find(".dd-list").first().append(li),$tabs.append(template({slug:slug,text:name,type:type,i18n:window.tgwc.i18n})),$(`#tgwc-${slug}`).hide(0),$(document).trigger("added_endpoint"),$.fn.select2.amd.require(["select2/data/array","select2/utils"],function(ArrayData,Utils){function CustomData($element,options){CustomData.__super__.constructor.call(this,$element,options)}Utils.Extend(CustomData,ArrayData),CustomData.prototype.query=function(params,callback){var results=[];results=params.term&&""!==params.term?_.filter(window.tgwc.icons,function(e){return e.text.toUpperCase().indexOf(params.term.toUpperCase())>=0}):window.tgwc.icons,"page"in params||(params.page=1);var data={};data.results=results.slice(50*(params.page-1),50*params.page),data.pagination={},data.pagination.more=50*params.page<results.length,callback(data)},$(`select[name$="tgwc_endpoints[${slug}][icon]"]`).select2({placeholder:window.tgwc.i18n.selectAnIcon,allowClear:!0,ajax:{},dataAdapter:CustomData,escapeMarkup:function(markup){return markup}})}),$(`select[name$="tgwc_endpoints[${slug}][user_role]"]`).select2({placeholder:tgwc.i18n.selectUserRoles,allowClear:!0,multiple:!0,data:window.tgwc.roles});var textAreaId=`tgwc_endpoints_${slug}_content`;return wp.editor.initialize(textAreaId,{tinymce:{wpautop:!0,plugins:"charmap colorpicker compat3x directionality fullscreen hr image lists media paste tabfocus textcolor wordpress wpautoresize wpdialogs wpeditimage wpemoji wpgallery wplink wptextpattern wpview",toolbar1:"bold italic underline strikethrough | bullist numlist | blockquote hr wp_more | alignleft aligncenter alignright | link unlink | fullscreen | wp_adv",toolbar2:"formatselect alignjustify forecolor | pastetext removeformat charmap | outdent indent | undo redo | wp_help",media_strict:!1},quicktags:!0,mediaButtons:!0}),$tabs.find(".dd-item").last().find("a").trigger("click"),$('[data-toggle="tgwc-tooltip"]').tooltip({position:{my:"center top-120%",at:"center top",collision:"none"},tooltipClass:"tgwc-tooltip"}),!0}$("#tgwc-endpoint-actions").on("click","button",function(e){e.preventDefault();var type=$(this).data("type");$endpointDialogType.val(type),$endpointDialog.dialog({resizable:!1,autoOpen:!0,modal:!0,title:`Add ${type}`,minWidth:460,buttons:[{text:window.tgwc.i18n.cancel,"class":"tgwc-button tgwc-button--link tgwc-endpoint-dialog-form-cancel",tabindex:2,click:function(){$(this).dialog("close")}},{text:`${window.tgwc.i18n.add} ${type}`,"class":"tgwc-button tgwc-button--primary tgwc-endpoint-dialog-form-add",tabindex:1,click:function(){addTab(this)&&$(this).dialog("close")}}],close:function(){$endpointDialog.find("form").get(0).reset(),$endpointDialog.find(".tgwc-error-message").html("")}})}),$("body").on("keydown","#tgwc-endpoint-dialog",function(e){e.keyCode===$.ui.keyCode.ENTER&&(addTab(this)&&$(this).dialog("close"),e.preventDefault(),e.stopPropagation())})}),function($){$(".dd").nestable({maxDepth:2,expandBtnHTML:"",collapseBtnHTML:"",listNodeName:"ul",onDragStart:function(container,el){var type=$(el).data("type");container.find('[data-type="endpoint"]').addClass("dd-nochildren"),container.find('[data-type="link"]').addClass("dd-nochildren"),"group"===type?container.find('[data-type="group"]').addClass("dd-nochildren"):container.find('[data-type="group"]').removeClass("dd-nochildren")},beforeDragStop:function(container,el,drop){var secondList=$(drop).parents(".dd-item");if("group"===$(el).data("type")&&secondList.length)return!1}}),$("#tgwc-customization-form").submit(function(e){if($(".dd").length){var data=$(".dd").nestable("serialize"),input=`<input type='hidden' name='tgwc_endpoints[endpoints_order]' value='${data=JSON.stringify(data)}' />`;$(this).append(input)}})}(jQuery),function($){$("#tgwc-endpoints").find('select[name$="[user_role][]"]').each(function(index,userRole){var $userRole=$(userRole);$userRole.select2({placeholder:window.tgwc.i18n.selectUserRoles,multiple:!0,allowClear:!0,data:window.tgwc.roles}),$userRole.val($userRole.data("selected")),$userRole.trigger("change")})}(jQuery),function($){var data=window.tgwc,$settingsForm=$("#tgwc-customization-form"),$restoreDefaultsDialog=$("#tgwc-dialog-restore-defaults"),$setting=$("#tgwc-restore-defaults-settings"),$customization=$("#tgwc-restore-defaults-customization"),$debug=$("#tgwc-restore-defaults-debug-settings");$setting.add($customization).add($debug).change(function(e){e.preventDefault();var $noticeContainer=$("#tgwc-dialog-restore-defaults").find(".tgwc-dialog-notice"),title="",message="",noticeId=$(this).attr("id")+"-notice";"tgwc-restore-defaults-settings-notice"===noticeId?(title=data.i18n.settings,message=data.i18n.restoreSettingsInfo):"tgwc-restore-defaults-customization-notice"===noticeId&&(title=data.i18n.designCustomization,message=data.i18n.restoreCustomizationInfo);var html=['<div class="notice notice-warning" style="display: none" id="'+noticeId+'">',"<p>","<strong>"+title+": </strong>",message,"</p>","</div>"].join("");$(this).prop("checked")?($noticeContainer.append(html),$("#"+noticeId).fadeIn()):$("#"+noticeId).fadeOut(function(){$(this).remove()})}),$("#tgwc-reset").click(function(e){e.preventDefault(),$("#tgwc-dialog-restore-defaults").dialog({modal:!0,resizable:!1,minWidth:460,buttons:[{text:window.tgwc.i18n.cancel,"class":"tgwc-button tgwc-button--link tgwc-endpoint-dialog-form-cancel",tabindex:2,click:function(){$(this).dialog("close")}},{text:window.tgwc.i18n.reset,"class":"tgwc-button tgwc-button--primary tgwc-endpoint-dialog-form-add",tabindex:1,click:function(){var $setting=$restoreDefaultsDialog.find("#tgwc-restore-defaults-settings"),$customization=$restoreDefaultsDialog.find("#tgwc-restore-defaults-customization");$settingsForm.find("input[name^=tgwc_reset_options]").remove();var html="";$setting.prop("checked")&&(html+='<input type="hidden" name="tgwc_reset_options[setting]" value="setting" />'),$customization.prop("checked")&&(html+='<input type="hidden" name="tgwc_reset_options[customization]" value="customization" />'),$debug.prop("checked")&&(html+='<input type="hidden" name="tgwc_reset_options[debug]" value="debug" />'),$settingsForm.append(html),$("#tgwc-submit").trigger("click"),$(this).dialog("close")}}],close:function(){$restoreDefaultsDialog.find("form").get(0).reset(),$restoreDefaultsDialog.find(".notice").hide()}})})}(jQuery),jQuery(function($){$('[data-toggle="tgwc-tooltip"]').tooltip({position:{my:"center top-120%",at:"center top",collision:"none"},tooltipClass:"tgwc-tooltip"})}),function($){var $container=$("#tgwc-customization"),data=window.tgwc;$container.on("keyup keydown",'input[name$="[label]"]',function(e){e.keyCode===$.ui.keyCode.ENTER&&e.preventDefault();var label=$(this).val(),isValid=!0,errorMessage="",panelId=$(this).parents(".tgwc-tabs-panel.active").first().attr("id"),eroorLabel=$("#tgwc-tabs").find('[data-id="'+panelId+'"]').find(".dd3-content").text().trim().substring(4);$(this).parents(".tgwc-tabs-panel.active").find(".tgwc-tabs-panel-header h2").html(label),$('.dd-item[data-id="'+panelId+'"]').find(".tgwc-sidenav-tab-anchor span:nth-child(3)").html(label),$(this).siblings(".notice").remove(),""===label&&(errorMessage=data.i18n.labelCannotBeEmpty,$(this).after('<div class="notice notice-error"><p>'+errorMessage+"</p></div>"),isValid=!1),$(this).data("isValid",isValid),$(this).data("error",{label:eroorLabel,message:errorMessage})}),$container.on("keyup keydown",'input[name$="[slug]"]',function(e){e.keyCode===$.ui.keyCode.ENTER&&e.preventDefault();var currentSlug=$(this).parents(".tgwc-tabs-panel.active").attr("id"),panelId=$(this).parents(".tgwc-tabs-panel.active").first().attr("id"),label=$("#tgwc-tabs").find('[data-id="'+panelId+'"]').find(".dd3-content").text().trim().substring(4),slug=$(this).val().toLowerCase(),message=data.i18n.available,errorMessage="",$endpoints=$container.find("li.endpoint"),cssClass="notice-success",isValid=!0,endpoints=$.map($endpoints,function(endpoint){var slug=$(endpoint).data("id");if(currentSlug!==slug)return slug});(endpoints=endpoints.concat(["pagename","page","page_id","preview"])).indexOf(slug)>=0&&(message=data.i18n.notAvailable,errorMessage=data.i18n.notAvailable,cssClass="notice-error",isValid=!1),/^[a-zA-Z0-9]+[\w-]*[a-zA-Z0-9]$/g.test(slug)||(message=data.i18n.slugMustBeginWith,errorMessage=data.i18n.slugMustBeginWith,cssClass="notice-error",isValid=!1),/^[\w-]+$/g.test(slug)||(message=data.i18n.slugCanOnlyContains,errorMessage=data.i18n.slugCanOnlyContains,cssClass="notice-error",isValid=!1),slug.length<3&&(message=data.i18n.slugMustBeOfLength,errorMessage=data.i18n.slugMustBeOfLength,cssClass="notice-error",isValid=!1),""===slug&&(message=data.i18n.slugCannotBeEmpty,errorMessage=data.i18n.slugCannotBeEmpty,cssClass="notice-error",isValid=!1),$(this).siblings(".notice").remove(),$(this).after('<div class="notice '+cssClass+'"><p>'+message+"</p></div>"),$(this).data("isValid",isValid),$(this).data("error",{label:label,message:errorMessage}),this.value=slug}),$container.on("keyup keydown",'input[name$="[class]"]',function(e){e.keyCode===$.ui.keyCode.ENTER&&e.preventDefault()}),$container.find("form").submit(function(e){var isValid=!0,errorHtml="",$inputs=$container.find('input[name$="[slug]"], input[name$="[label]"] ');$.each($inputs,function(index,input){var valid=$(input).data("isValid"),error=$(input).data("error"),html="";valid=undefined===valid||valid,isValid=isValid&&valid,valid||(html=['<div class="notice notice-error">',"<p>","<strong>"+error.label+": </strong>",error.message,"</p>","</div>"].join("")),errorHtml+=html}),isValid||(e.preventDefault(),$("<div/>").html('<div class="tgwc-dialog-content"><span class="ui-icon ui-icon-alert"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-triangle"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></span><div class="tgwc-dialog-content__detail"><p>'+data.i18n.resolveFormErrors+'</p></div></div><div class="tgwc-dialog-content-list">'+errorHtml+"</div>").dialog({title:data.i18n.couldNotSaveChanges,dialogClass:"no-close",resizable:!1,width:"400px",modal:!0,buttons:[{text:data.i18n.ok.toUpperCase(),"class":"tgwc-button tgwc-button--link tgwc-endpoint-dialog-form-cancel",click:function(){$(this).dialog("close")}}]}))})}(jQuery);