(()=>{"use strict";window.addEventListener("load",(function(){!function(){const e="#commentform",t="nv-upload-review-image";jQuery((function(n){n(e).attr("enctype","multipart/form-data"),n("a.nv-upvote-button").each(((e,t)=>{const a=n(t).data("review-id"),o=n(t).data("key");"voted"===localStorage.getItem("nv_apr_upvote_"+o+a)&&(n(t).attr("data-already-liked",1),n(t).find(".nv-upvote-icon").addClass("active"))}));let a=!1;n(".nv-apr-upvote-section").on("click","a.nv-upvote-button",(e=>{if(e.preventDefault(),!0===a)return;const t=n(e.currentTarget),o="1"===t.attr("data-already-liked"),l=t.data("review-id"),r=t.data("product-id"),d=t.data("key");let i=localStorage.getItem("nv_apr_upvote_"+d+l);o&&"voted"!==i&&(localStorage.setItem("nv_apr_upvote_"+d+l,"voted"),i="voted"),n.ajax({type:"post",url:neveWooBooster.advancedProductReview.adminAjaxUrl+r+"/vote",beforeSend(e){a=!0,e.setRequestHeader("X-WP-Nonce",neveWooBooster.advancedProductReview.adminAjaxNonce)},data:{reviewId:l,hasVoted:i},success(e){if(a=!1,e.success){const n=e.latestCount;t.find(".nv-upvote-count").html(n>0?n:""),t.attr("data-already-liked",o?0:1),o?localStorage.removeItem("nv_apr_upvote_"+d+l):localStorage.setItem("nv_apr_upvote_"+d+l,"voted"),t.find(".nv-upvote-icon").toggleClass("active")}}})})),n(".nv-review-gallery").on("click","a.nv-review-image",(e=>{e.preventDefault();const t=e.currentTarget.getAttribute("data-image"),n=document.querySelector("#review-image-modal"),a=document.querySelector("#review-image-modal .nv-modal-container"),o=document.querySelector("#review-image-modal .nv-modal-container .nv-modal-inner-content"),l=document.createElement("img");l.style.display="block",l.style.width="100%",l.src=t,n.classList.add("open"),a.style.height="auto",a.classList.remove("is-loading"),o.innerHTML=l.outerHTML}));const o=[],l=e=>{document.getElementById("nv-upload-max").style.display="none";const t=document.getElementById("nv-upload-review-list"),n=function(e,t){const n=new FileReader;n.readAsDataURL(e[t]),n.onload=function(e){document.getElementById("img_preview_"+t).style.backgroundImage='url("'+e.target.result+'")'}};for(;t.hasChildNodes();)t.removeChild(t.firstChild);for(let a=0;a<e.files.length;a++){const o=document.createElement("li");o.classList.add("nv-upload-img-preview"),o.setAttribute("id","img_preview_"+a),o.innerHTML='<button value="'+a+'" class="nv-apr-remove-product">Ã—</button>',n(e.files,a),t.appendChild(o)}};n("#nv-do-upload").click((function(){n(`#${t}`).click()})),n(`#${t}`).on("change",(e=>{if(!e.target.files)return;const n=e.target.files,a=Array.from(n);if(o.length+a.length>5){document.getElementById("nv-upload-max").style.display="block";const e=new DataTransfer;for(let t=0;t<o.length;t++){const n=o[t];e.items.add(n)}return void(document.getElementById(t).files=e.files)}const r=new DataTransfer;for(let e=0;e<o.length;e++){const t=o[e];r.items.add(t)}for(let e=0;e<a.length;e++){const t=n[e];r.items.add(t),o.push(t)}const d=document.getElementById(t);d.files=r.files,l(d)})),n("#nv-upload-review-list").on("click","li .nv-apr-remove-product",(e=>{e.preventDefault();const n=parseInt(e.target.value),a=document.getElementById(t),r=new DataTransfer,{files:d}=a;for(let e=0;e<d.length;e++){const t=d[e];n===e&&o.splice(e,1),n!==e&&r.items.add(t)}a.files=r.files,l(a)})),n(e).submit((function(){if(document.getElementById(t).files.length>5)return!1}))}))}()}))})();