/*! Thrive Comments - 2022-05-25
* http://www.thrivethemes.com/
* Copyright (c) 2022 Thrive Themes */

"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},ThriveComments=ThriveComments||{};ThriveComments.util=ThriveComments.util||{},_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},function(a){ThriveComments.util.tpl=function(b,c){var d=a("script#"+b.replace(/\//g,"-")).html()||"";return c?_.template(d)(c):_.template(d)},ThriveComments.util.nested=function(a,b){var c=this;return a instanceof Backbone.Model?this.nested(a.attributes,b):_.each(b,function(b){b.children&&(a[b.name]=c.nested(a[b.name],b.children)),_.isArray(a)?_.each(a,function(a){a[b.name]=new b.obj(a[b.name])}):a[b.name]=new b.obj(a[b.name])}),a},ThriveComments.util.validateInput=function(a,b,c){var d=a instanceof jQuery?a.val():a,e=!0;return d=d.trim(),""==d?(b||(b=ThriveComments.util.render_label("isRequired")),e=!1,a instanceof jQuery&&(a.removeClass("tcm-valid"),a.addClass("tcm-invalid"),a.prev(".tcm-error-message").show().html(b))):(a.removeClass("tcm-invalid"),a.prev(".tcm-error-message").hide(b)),e},ThriveComments.util.validateInputUrl=function(a,b,c){var d=a instanceof jQuery?a.val():a,e=!0;return void 0!=d&&0==this.isValidUrl(this.addHttp(d))?(b||(b=ThriveComments.util.render_label("isRequired")),e=!1,a instanceof jQuery&&(a.removeClass("tcm-valid"),a.addClass("tcm-invalid"),a.prev(".tcm-error-message").show().html(b))):(a.removeClass("tcm-invalid"),a.prev(".tcm-error-message").hide(b)),e},ThriveComments.util.validateStoringConsent=function(a,b){var c=a instanceof jQuery?a.is(":checked"):a,d=a.siblings(".tcm-consent-text"),e=ThriveComments.util.get_cookie("tcm_cookie_user_name"),f=!0;return""===ThriveComments.settings.storing_consent||0===ThriveComments.settings.storing_consent?f:(c||""!==e?(d.removeClass("tcm-not-selected"),a.prev(".tcm-error-message").hide(b)):(b||(b=ThriveComments.util.render_label("isRequired")),f=!1,a instanceof jQuery&&(d.removeClass("tcm-not-selected"),d.addClass("tcm-not-selected"),a.prev(".tcm-error-message").show().html(b))),f)},ThriveComments.util.validateEmail=function(a,b){var c=a.length?a.val():a;return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(c)?(a instanceof jQuery&&(a.removeClass("tcm-invalid"),a.prev(".tcm-error-message").hide()),!0):(a instanceof jQuery&&(a.removeClass("tcm-valid"),a.addClass("tcm-invalid"),a.prev(".tcm-error-message").show().html(b)),!1)},ThriveComments.util.valuesToArray=function(a){return Object.keys(a).map(function(b){return a[b]})},ThriveComments.util.set_avatar_url=function(a){a.length&&a.attr("data-src")===ThriveComments.default_author_picture_url&&this.checkGravatar(a.attr("data-email-hash")).done(function(b){a.css("background-image",'url("'+b+'")')})},ThriveComments.util.previousUser=function(){return""!==ThriveComments.util.get_cookie("social-login")||!!ThriveComments.current_user.ID||void 0},ThriveComments.util.set_cookie=function(a,b,c,d){d=d||"/",c=c||2592e3;var e,f=new Date;c=parseInt(c),f.setTime(f.getTime()+1e3*c),e=f.toUTCString(),"object"===(void 0===b?"undefined":_typeof(b))&&(b=JSON.stringify(b)),document.cookie=encodeURIComponent(a)+"="+b+";expires="+e+";path="+d},ThriveComments.util.get_cookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""},ThriveComments.util.search_comment=function(a,b){return void 0!==a.models&&this.search_recursive(a.models,b)},ThriveComments.util.search_recursive=function(a,b){for(var c=0,d=0;!c&&d<a.length;d++)a[d].get("comment_ID")==b?c=a[d]:a[d].get("children")&&a[d].get("children").length&&(c=c||this.search_recursive(a[d].get("children"),b));return c},ThriveComments.util.elem_viewport=function(b){var c=b.offset(),d=c?c.top:0,e=d+b.outerHeight(),f=a(window).scrollTop(),g=f+a(window).height();return e>f&&d<g},ThriveComments.util.focusElement=function(b){var c=b.offset().top,d=b.height(),e=a(window).height(),f=void 0;f=d<e?c-(e/2-d/2):c,a("html, body").animate({scrollTop:f},300,"easeOutQuint")},ThriveComments.util.save_setting_model=function(a,b,c,d){if(!a)return!1;d=d||{},d.success||(d.success=ThriveComments.translations.settings_saved_success_toast),d.fail||(d.fail=ThriveComments.translations.settings_saved_fail_toast),new ThriveComments.models.Settings({name:a,value:b}).save().done(function(e){"NoMessage"!==d.success&&TVE_Dash.success(d.success),-1!==ThriveComments.tcm_sync_settings.indexOf(a)&&c.where({name:a}).shift().set("value",b)}).fail(function(a){TVE_Dash.err(d.fail)})},ThriveComments.util.render_label=function(a,b,c){var d,e,f,g,h,i;if(b||(b=""),!(d=window.parent.ThriveComments?void 0===window.parent.ThriveComments.objects.Settings?ThriveComments.tcm_customize_labels:window.parent.ThriveComments.objects.Settings.get(ThriveComments.tcm_labels_key).get("value"):ThriveComments.tcm_customize_labels)||!d.hasOwnProperty(a))return"";if(h=d[a].text,-1===h.indexOf("{"))return h;switch(f=h.indexOf("{"),g=h.indexOf("}"),c){case"before":i=h.substr(0,f);break;case"after":i=h.substr(g+1,h.length-1);break;default:e=h.substring(f,g+1),i=h.replace(e,b)}return i},ThriveComments.util.showCommentsNumber=function(b){var c=a(".tcm-comments-number");c.length&&c.html(c.html().replace("comment_count",b)).show()},ThriveComments.util.tcm_show_loader=function(){a(".tcm-dot-loader").show()},ThriveComments.util.tcm_hide_loader=function(){a(".tcm-dot-loader").hide(),a(".thrive-comments-content").show()},ThriveComments.util.tcm_hide_textareas=function(b){var c=a(b.currentTarget).closest(".tcm-reply-container").find(".tcm-reply-btn").attr("data-id");a("textarea[name=tcm-post-content]").each(function(){var b=a(this).closest(".tcm-comment-wrapper"),d=a(this).closest(".tcm-reply-container").find(".tcm-reply-btn").attr("data-id"),e=b.find(".tcm-create-post-container").attr("data-position");void 0!==c&&a(this).closest(".comment-id-0").find(".tcm-comment-additional-fields").hide(),""!=e&&"top"===e||c==d||(a(this).closest(".tcm-comment-wrapper").slideUp(),a(this).closest(".tcm-reply-container").find(".tcm-reply-btn").attr("data-clicked",0))})},ThriveComments.util.after_ajax_login_actions=function(){a(".tcm-lazy-comments").empty(),a.ajax({headers:{"X-WP-Nonce":ThriveComments.nonce},cache:!1,url:ThriveComments.routes.generate_nonce,dataType:"JSON",data:{action:"refresh_nonce"},type:"GET"}).done(function(b){var c=window.parent.ThriveComments.util.commentId,d=c?"comments/"+c:"";ThriveComments.current_user=b.current_user,ThriveComments.nonce=b.nonce,Backbone.history.loadUrl(d),a(".tcm-comment-item").each(function(){var b=a(this);b.find(".tcm-comment-wrapper").hide(),b.find(".tcm-error-heading").hide()})})},ThriveComments.util.focusAfterLogin=function(){if(this.commentId&&parseInt(this.commentId)===this.commentId){var b=a("div[data-comment-id="+this.commentId+"]");b.find(".tcm-reply-btn").click(),b.find("#tcm-post-content").val(this.content).focus()}if("bottom"===this.position){var c=a(".add-comment");c.click(),c.closest(".tcm-lazy-comments").find("textarea#tcm-post-content").val(this.content).focus()}"top"===this.position&&a("textarea#tcm-post-content").focus(),this.position=null},ThriveComments.util.scrollToElement=function(b){b.length&&a("body, html").animate({scrollTop:b.offset().top-a(window).height()/2+30},{duration:500,complete:function(){var a=b.parent();a.addClass("tcm-highlight-item"),setTimeout(function(){return a.removeClass("tcm-highlight-item")},800)}})},ThriveComments.util.showCommentConversion=function(a){var b=new ThriveComments.views.CommentConversion({commentView:a});b.handleAfterShowAction(),a.$el.prepend(b.$el)},ThriveComments.util.isValidUrl=function(a){return!(null===a.match(/(http(s)?:\/\/.)(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/g))},ThriveComments.util.addHttp=function(b){return b=a.trim(b),b&&!/^(?:f|ht)tps?\:\/\//.test(b)&&(b="http://"+b),b},ThriveComments.util.err=function(b,c,d){a(".tvd-toast").remove(),Toasts.init(b,c||3e3,"tvd-toast tvd-red",d,"bottom"),a(".tvd-toast").parent().addClass("tcm-frontend-toast")},ThriveComments.util.getDropDownItems=function(a){var b=void 0;if(a.meta_query.tcm_delegate)b={approve:1,unapprove:1,no_reply_needed:1,featured:1,delegate:1,spam:1,trash:1};else if(a.meta_query.tcm_featured)b={stop_featured:1,no_reply_needed:1,delegate:1};else switch(a.status){case"all":case"hold":case"tcm_unreplied":b={approve:1,unapprove:1,no_reply_needed:1,featured:1,delegate:1,spam:1,trash:1};break;case"featured":b={no_reply_needed:1,stop_featured:1,delegate:1};break;case"spam":b={not_spam:1,delete:1};break;case"trash":b={spam:1,restore:1,delete:1}}return b},ThriveComments.util.dynamicSortByProperty=function(a){var b=1;return"-"===a[0]&&(b=-1,a=a.substr(1)),function(c,d){return(c[a]<d[a]?-1:c[a]>d[a]?1:0)*b}},ThriveComments.util.insertAtCaret=function(a,b){if(a.length){var c=a[0],d=c.scrollTop,e=0,f=c.selectionStart||"0"==c.selectionStart?"ff":!!document.selection&&"ie";if("ie"==f){c.focus();var g=document.selection.createRange();g.moveStart("character",-c.value.length),e=g.text.length}else"ff"==f&&(e=c.selectionStart);var h=c.value.substring(0,e),i=c.value.substring(e,c.value.length);if(c.value=h+b+i,e+=b.length,"ie"==f){c.focus();var j=document.selection.createRange();j.moveStart("character",-c.value.length),j.moveStart("character",e),j.moveEnd("character",0),j.select()}else"ff"==f&&(c.selectionStart=e,c.selectionEnd=e,c.focus());c.scrollTop=d}},ThriveComments.util.ajaxurl=function(a){var b=-1!==ajaxurl.indexOf("?")?"&":"?";return a&&a.length?(a=a.replace(/^(\?|&)/,""),a+="&_nonce="+ThriveComments.admin_nonce,ajaxurl+b+a):ajaxurl+b+"_nonce="+ThriveComments.admin_nonce},ThriveComments.util.toCamelCase=function(a){return a=a.replace(/_/g," "),a.toLowerCase().replace(/(?:(^.))/g,function(a){return a.charAt(a.length-1).toUpperCase()})},ThriveComments.util.formatSelection=function(a){var b=a instanceof jQuery?a[0]:document.getElementById(a),c=void 0,d=void 0,e=void 0;if(void 0!==document.selection){b.focus();c=document.selection.createRange().text}else void 0!==b.selectionStart&&(d=b.selectionStart,e=b.selectionEnd,c=b.value.substring(d,e));return{selectedText:c,startPos:d,endPos:e}},ThriveComments.util.set_subscriber_cookies=function(a){var b=ThriveComments.util.get_cookie("subscribed_posts");if(""!==b&&(b=JSON.parse(b)),0===a){var c=b.indexOf(ThriveComments.post.ID);c>-1&&(b.splice(c,1),ThriveComments.util.set_cookie("subscribed_posts",JSON.stringify(b),31104e3))}else""===b?b=[ThriveComments.post.ID]:b.push(ThriveComments.post.ID),ThriveComments.util.set_cookie("subscribed_posts",JSON.stringify(b),31104e3)},ThriveComments.util.checkGravatar=function(b){var c=this,d=a.Deferred();if(this.gravatarCache=this.gravatarCache||{},this.gravatarCache[b])this.gravatarCache[b].success?d.resolve(this.gravatarCache[b].url):d.reject();else{var e="https://www.gravatar.com/avatar/"+b+"?s=512";a.ajax({type:"HEAD",url:e+"&d=404"}).done(function(a){c.gravatarCache[b]={url:e,success:!0},d.resolve(e)}).fail(function(){c.gravatarCache[b]={url:"",success:!1},d.reject()})}return d}}(jQuery);var ThriveComments=ThriveComments||{};ThriveComments.models=ThriveComments.models||{},ThriveComments.collections=ThriveComments.collections||{},function(a){ThriveComments.models.Base=Backbone.Model.extend({idAttribute:"id",sync:function(a,b,c){var d;return c=c||{},c.cache=!1,!b.has("id")||"delete"!==a&&"update"!==a||(c.url=this.url()+"/"+b.get("id")),_.isUndefined(ThriveComments.nonce)||_.isNull(ThriveComments.nonce)||(d=c.beforeSend,c.beforeSend=function(a){if(a.setRequestHeader("X-WP-Nonce",ThriveComments.nonce),d)return d.apply(this,arguments)}),Backbone.sync(a,b,c)},save:function(a,b,c){var d;null==a||"object"===(void 0===a?"undefined":_typeof(a))?(d=a,c=b):(d={})[a]=b,c=_.extend({validate:!0,parse:!0},c);var e=c.wait;if(d&&!e){if(!this.set(d,c))return!1}else if(!this._validate(d,c))return!1;var f=this,g=c.success,h=this.attributes;c.success=function(a){f.attributes=h;var b=c.parse?f.parse(a,c):a;if(e&&(b=_.extend({},d,b)),b&&!f.set(b,c))return!1;g&&g.call(c.context,f,a,c),d&&(d.sync||void 0===d.sync)&&f.trigger("sync",f,a,c)},function(a,b){var c=b.error;b.error=function(d){c&&c.call(b.context,a,d,b),a.trigger("error",a,d,b)}}(this,c),d&&e&&(this.attributes=_.extend({},h,d));var i=this.isNew()?"create":c.patch?"patch":"update";"patch"!==i||c.attrs||(c.attrs=d);var j=this.sync(i,this,c);return this.attributes=h,j}}),ThriveComments.collections.Base=Backbone.Collection.extend({sync:function(a,b,c){var d;return c=c||{},c.cache=!1,c.url=this.url(),_.isUndefined(ThriveComments.nonce)||_.isNull(ThriveComments.nonce)||(d=c.beforeSend,c.beforeSend=function(a){if(a.setRequestHeader("X-WP-Nonce",ThriveComments.nonce),d)return d.apply(this,arguments)}),Backbone.sync(a,b,c)}}),ThriveComments.models.Comment=ThriveComments.models.Base.extend({defaults:{children:[],comment_post_ID:"",comment_author:"",comment_author_email:"",comment_author_url:"",comment_date:"",comment_content:"",comment_karma:0,comment_type:"",comment_parent:0,top_parent_id:0,level:"",user_id:0,tcm_meta:{},undo_action:""},url:function(){return ThriveComments.moderation_routes.comments},parse:function(a){return a.comment_content=a.content.rendered.replace(/<\/?[^>]+(>|$)/g,""),delete a.author,a}}),ThriveComments.collections.Comments=ThriveComments.collections.Base.extend({model:ThriveComments.models.Comment,url:function(){return ThriveComments.moderation_routes.comments}}),ThriveComments.models.Settings=ThriveComments.models.Base.extend({idAttribute:"name",defaults:{name:"",value:""},url:function(){return ThriveComments.routes.settings}}),ThriveComments.models.KeyboardSettings=ThriveComments.models.Base.extend({idAttribute:"name",defaults:{name:"",value:""},url:function(){return ThriveComments.routes.settings+"/keyboard-tooltip"}}),ThriveComments.collections.Settings=ThriveComments.collections.Base.extend({model:ThriveComments.models.Settings,url:function(){return ThriveComments.routes.settings}})}(jQuery);var ThriveComments=ThriveComments||{};ThriveComments.views=ThriveComments.views||{},ThriveComments.objects=ThriveComments.objects||{},function(a){ThriveComments.views.Base=Backbone.View.extend({render:function(a){return this._render(a),TVE_Dash.materialize(this.$el),this},close:function(){this.$el.empty(),this.unbind()}}),ThriveComments.views.CommentsModeration=ThriveComments.views.Base.extend({className:"tcm-admin-moderation-wrapper",template:ThriveComments.util.tpl("moderation/comments-moderation"),events:{"click a.toggle-stuff":"showHideElem","click .tcm-sort-by":"changeSorting","click .to-top":"scrollToTop","click .tcm-comment-checkbox":"activateBulk","click .filter-by-post":"filterByPost","click .keyboard-tooltip-title":"showKeyboardTooltip","click .clear-post-autocomplete":"postCleared"},keyboardEvents:ThriveComments.moderation_keyboard,initialize:function(){this._render()},_render:function(){this.$el.html(this.template()),this.keyboardTooltipContainer=new ThriveComments.views.KeyboardTooltipContainer({el:this.$(".keyboard-tooltip-container"),moderation_view:this}),ThriveComments.objects.Comments=new ThriveComments.collections.Comments,this.commentsList=ThriveComments.objects.CommentsList=new ThriveComments.views.CommentsList({collection:ThriveComments.objects.Comments,el:this.$(".tcm-moderation-container")}),this.commentsPagination=ThriveComments.objects.CommentsPagination=new ThriveComments.views.CommentsPagination({collection:ThriveComments.objects.Comments,view:ThriveComments.objects.CommentsList,moderation_view:this});var a={status:"all",meta_query:0};this.bulkActions=new ThriveComments.views.BulkActions({el:this.$(".bulk-section"),bulklist:ThriveComments.util.getDropDownItems(a),commentsList:this.commentsList,commentsPagination:this.commentsPagination}),this.showOverlay(),this.commentsPagination.fetchComments(),this.stickyHeader(),this.renderViewCommentsOnFilter(),this.bindSearchEvent(),new ThriveComments.views.KeyboardNotification({el:this.$(".keyboard-notification-container"),moderation_view:this}).bindKeyboardEvents()},showKeyboardTooltip:function(b){b.preventDefault?b.preventDefault():b.returnValue=!1,this.unbindKeyboardEvents(),this.keyboardTooltipContainer.bindKeyboardEvents(),a("body").css("overflow","hidden"),this.$(".keyboard-tooltip-container").show(),this.$(".keyboard-notification-container").hide()},showOverlay:function(){this.$(".tcm-moderation-loader").show()},hideOverlay:function(){this.$(".tcm-moderation-loader").hide()},actionKey:function(b){var c=this.$(".tcm-focused-element"),d=c.find('[data-key="'+b.key+'"]'),e=["f","t","s","d"],f=!0;return 113===b.keyCode?(c.find(".edit-status").click(),!1):(27===b.keyCode&&this.$(".keyboard-notification-container").hide(),d.length>1?d.each(function(){var b=a(this);(b.is(":focus")||b.is(":visible"))&&(f=!1,b.click())}):(f=!1,(-1!==e.indexOf(b.key)||d.is(":visible"))&&d.click()),13===b.keyCode&&f&&c.find("a.tcm-focus-action").click(),!1)},leftRight:function(a){var b=this.$(".tcm-focused-element"),c=b.find(".tcm-focus-action"),d=c.next(),e=c.prev();39===a.keyCode?this.handleRightArrow(d,c,b):this.handleLeftArrow(e,c,b),c.removeClass("tcm-focus-action")},handleRightArrow:function(a,b,c){var d=c.find(".moderation-dropdown");a.hasClass("moderation-dropdown")&&a.find("ul.inner").css("display","block"),(b.hasClass("moderation-dropdown")||d.find(".tcm-focus-action").length)&&(d.find("ul.inner").css("display",""),a=d.next()),0===a.length&&(a=c.find(".moderation-footer a").first()),a.addClass("tcm-focus-action")},handleLeftArrow:function(a,b,c){var d=c.find(".moderation-dropdown");a.hasClass("moderation-dropdown")&&a.find("ul.inner").css("display","block"),(b.hasClass("moderation-dropdown")||d.find(".tcm-focus-action").length)&&(d.find("ul.inner").css("display",""),a=d.prev()),0===a.length&&(a=c.find(".moderation-footer a").last()),a.addClass("tcm-focus-action")},upDown:function(a){var b=this.$(".tcm-focused-element"),c=b.find(".moderation-dropdown");if(c.hasClass("tcm-focus-action")||c.find(".tcm-focus-action").length){var d=b.find(".tcm-focus-action");return 106===a.keyCode||40===a.keyCode?this.moderationUp(c,d):this.moderationDown(c,d),!1}return 106===a.keyCode||40===a.keyCode?this.changeFocus(b,b.next(".tcm-admin-moderation-comment-item")):this.changeFocus(b,b.prev(".tcm-admin-moderation-comment-item")),!1},moderationUp:function(a,b){var c={};if(a.hasClass("tcm-focus-action"))c=a.find("ul.inner li").first().find("a"),a.removeClass("tcm-focus-action");else{var d=b.parent().next();c=d.length?d.find("a"):a.find("ul.inner li").first().find("a")}b.removeClass("tcm-focus-action"),c.addClass("tcm-focus-action")},moderationDown:function(a,b){var c=b.parent().prev(),d={};d=c.length?c.find("a"):a.find("ul.inner li").last().find("a"),b.removeClass("tcm-focus-action"),d.addClass("tcm-focus-action")},changeFocus:function(b,c){if(!c.length)return!1;var d=c.offset().top,e=c.height(),f=a(window).height(),g=void 0;return g=e<f?d-(f/2-e/2)-81:d,b.removeClass("tcm-focused-element"),c.addClass("tcm-focused-element"),b.find("ul.inner").css("display",""),b.find(".tcm-focus-action").removeClass("tcm-focus-action"),b.find(".moderation-footer a").first().addClass("tcm-focus-action"),c.prev().length||(g=0),a("html, body").animate({scrollTop:g},300,"easeOutQuint"),!1},filterByPost:function(a){var b=a.currentTarget.getAttribute("data-post-id"),c=a.currentTarget.getAttribute("data-post-title"),d=this.$("#tcm_post_autocomplete"),e={post_id:b,tva_term:a.currentTarget.getAttribute("data-term-id")};return this.commentsPagination.fetchAndEmpty(a,e),d.val(c),this.commentsList.allCollections.reset(),!1},changeSorting:function(a){this.$(".current-sorting").text(a.currentTarget.textContent),this.commentsList.allCollections.reset(),this.commentsPagination.fetchAndEmpty(a,{order:a.currentTarget.getAttribute("data-value")})},showHideElem:function(b){return a(b.currentTarget).parent().toggleClass("hideit"),!1},scrollToTop:function(){a("html, body").animate({scrollTop:0},"slow")},activateBulk:function(){var b=this.$("#tcm-bulk-checkbox");this.$(".tcm-comment-checkbox:checked").length?(b.prop("indeterminate",!0),b.addClass("indeterminate"),this.$(".tcm-apply-bulk").css("display","inline-block"),a(".tcm-bulk-action").show(),this.$(".tcm-moderation-mid").removeClass("hideit"),a(".tcm-comment-checkbox:checked").length===a(".tcm-comment-checkbox").length&&(b.prop("indeterminate",!1),b.removeClass("indeterminate"),b.prop("checked",!0))):(b.prop("indeterminate",!1),b.prop("checked",!1),b.removeClass("indeterminate"),this.$(".tcm-apply-bulk").hide(),a(".tcm-bulk-action").hide(),this.bulkActions.$el.parent().hasClass("sticky")&&this.bulkActions.$(".tcm-moderation-mid").addClass("hideit"))},stickyHeader:function(){if(a(window).width()>960){var b=this;a(window).scroll(function(){var c=a(window).scrollTop(),d=b.$("#tcm-header").height(),e=b.$(".tcm-moderation-header"),f=e.parent().outerWidth(),g=b.$("#tcm-holder");e.toggleClass("sticky",c>=d).css("width",f),b.$(".tcm-comment-checkbox:checked").length||e.find(".tcm-moderation-mid").toggleClass("hideit",c>=d),e.hasClass("sticky")?g.css("padding-top",e.outerHeight()+34):g.css("padding-top","")})}},renderViewCommentsOnFilter:function(){var a=ThriveComments.routes.settings+"/redirect_autocomplete",b=this.$(".tcm-autocomplete");this.LinkAutocomplete(a,b,0)},bindSearchEvent:function(){var a=this,b=this.$("#tcm-keyword-search"),c=this.$(".search"),d=this.$(".tcm-reset-search").hide();return b.keydown(function(c){if(d.show(),13===c.keyCode)return a.doTheSearch(c,b,d)}),c.click(function(c){return a.doTheSearch(c,b,d)}),d.click(function(c){return d.hide(),""!==b.val()&&(b.val(""),a.commentsPagination.fetchAndEmpty(c,{search:""}),!1)}),this},doTheSearch:function(a,b,c){var d=b.val();return""===d&&c.hide(),this.commentsPagination.fetchAndEmpty(a,{search:d}),!1},delegateModalData:function(b){var c=this;void 0===ThriveComments.tcm_moderators?(this.showOverlay(),a.ajax({headers:{"X-WP-Nonce":ThriveComments.nonce},cache:!1,dataType:"JSON",url:ThriveComments.moderation_routes.get_moderators,type:"GET"}).done(function(a){ThriveComments.tcm_moderators=a,c.showDelegateModal(b),c.hideOverlay()})):this.showDelegateModal(b)},showDelegateModal:function(a){TVE_Dash.modal(ThriveComments.views.DelegateModal,a)},getPostNameById:function(b){var c=ThriveComments.routes.settings+"/get_post_name_by_id";jQuery.ajax({headers:{"X-WP-Nonce":ThriveComments.nonce},url:c,type:"POST",data:{postId:b}}).done(function(b){a("#tcm_post_autocomplete").removeClass("ui-autocomplete-loading")}).fail(function(a){TVE_Dash.err(JSON.parse(a.responseText).message)}).always(function(){TVE_Dash.hideLoader()})},LinkAutocomplete:function(b,c){var d=this;c.autocomplete({delay:50,select:function(a,b){var c={post_id:b.item.id,tva_term:void 0!==b.item.tva_term};d.commentsList.allCollections.reset(),d.commentsPagination.fetchAndEmpty(a,c)},source:function(c,e){d.$(".clear-post-autocomplete").show(),a.ajax({headers:{"X-WP-Nonce":ThriveComments.nonce},url:b,dataType:"json",data:{q:c.term},type:"POST"}).done(function(a){d.commentsList.allCollections.reset(),e(a)}).fail(function(a){TVE_Dash.err(JSON.parse(a.responseText).message)})}}),c.on("keyup",function(a){""===c.val()&&d.postCleared(a)})},postCleared:function(a){this.$(".clear-post-autocomplete").hide(),this.$(".tcm-autocomplete").val(""),this.commentsList.allCollections.reset(),this.commentsPagination.fetchAndEmpty(a,{post_id:0,tva_term:!1})}}),ThriveComments.views.CommentsList=ThriveComments.views.Base.extend({className:"tcm-comments-list",template:ThriveComments.util.tpl("moderation/comment-list"),events:{"click .tcm-admin-moderation-comment-item":"focusCommentAtClick"},commentsViews:[],initialize:function(){this.allCollections=new ThriveComments.collections.Comments},_render:function(b){var c=this;return b.forEach(function(a,b){c.renderOne(a,b)}),0===b.length&&0===this.$(".tcm-admin-moderation-comment-item").length&&(this.noCommentsMessage=new ThriveComments.views.NoCommentsMessage({el:c.$el})),this.mergeCollections(b),this.lazy_images(),a(window).trigger("scroll"),this},renderOne:function(a,b){var c=new ThriveComments.views.CommentItem({model:a}),d=c.render().$el;return 0!==b||this.$(".tcm-focused-element").length||d.addClass("tcm-focused-element"),d.attr("data-index",b),this.$el.append(d),this.commentsViews[a.get("id")]=c,this},mergeCollections:function(a){return this.allCollections.add(a.models),this},focusCommentAtClick:function(b){var c=a(b.currentTarget);c.addClass("tcm-focused-element"),c.siblings().removeClass("tcm-focused-element")},lazy_images:function(){var b=this;a(window).on("scroll",function(){b.show_images()})},show_images:function(){var b=this;a("div.no-image").each(function(c,d){var e=a(d);!0!==e.data("social-avatar")&&ThriveComments.util.elem_viewport(e)&&(b.set_avatar_url(e),e.removeClass("no-image"))})},set_avatar_url:function(a){var b=this;a.length&&a.attr("data-src")===ThriveComments.default_author_picture_url&&ThriveComments.util.checkGravatar(a.attr("data-email-hash")).done(function(c){var d='url("'+c+'")';a.css("background-image",d),b.setImageOnModel(a,d)})},setImageOnModel:function(a,b){var c=a.closest(".tcm-moderation-comment").attr("data-comment-id"),d=this.allCollections.findWhere({id:parseInt(c)});void 0!==d&&d.set("author-background-image",b)}}),ThriveComments.views.CommentsCounters=ThriveComments.views.Base.extend({template:ThriveComments.util.tpl("moderation/comment-counters"),events:{"click .tcm-filters li":"changeTab"},active_tab_class:"total",initialize:function(a){this.counters=a.counters,this.commentsPagination=a.commentsPagination,this.moderation_view=a.moderation_view,this.render()},_render:function(a){var b=void 0!==a?this.getCountersFromHeaders(a):this.counters;return b.active_class=this.active_tab_class,this.$el.empty().append(this.template({items:b})),this},getCountersFromHeaders:function(a){var b=void 0!==a.xhr?a.xhr:a;return{pending:b.getResponseHeader("X-WP-PENDING"),pendingMyReply:b.getResponseHeader("X-WP-PENDING-MY-REPLY"),total:b.getResponseHeader("X-WP-Total"),unreplied:b.getResponseHeader("X-WP-UNREPLIED"),featured:b.getResponseHeader("X-WP-FEATURED"),spam:b.getResponseHeader("X-WP-SPAM"),trash:b.getResponseHeader("X-WP-TRASH")}},changeTab:function(a){var b,c=a.currentTarget.getAttribute("data-status"),d={},e=a.currentTarget.getAttribute("data-meta");e&&(b=e===ThriveComments.const.moderation.tcm_delegate?ThriveComments.current_user.ID:1,d[e]=b);var f={meta_query:d,status:c};return this.setActiveTabClass(a),this.commentsPagination.view.allCollections.reset(),this.commentsPagination.fetchAndEmpty(a,f),this.moderation_view.bulkActions.render({bulklist:ThriveComments.util.getDropDownItems(f)}),!1},setActiveTabClass:function(a){var b=a.currentTarget.className.split(/\s+/);return this.active_tab_class=b[0],this}}),ThriveComments.views.CommentItemMessages=ThriveComments.views.Base.extend({className:"pending-no-collapse",template:ThriveComments.util.tpl("moderation/comment-messages"),events:{"click .tcm-see-content":"showContent"},initialize:function(a){this.parentView=a.parentView,this.previousAction=a.previousAction,this.render()},render:function(){this.$el.html(this.template())},showContent:function(){return"reply"===this.previousAction&&this.parentView.replyAction(),"edit_comment"===this.previousAction&&this.parentView.editComment(),!1}}),ThriveComments.views.CommentItem=ThriveComments.views.Base.extend({className:"tcm-admin-moderation-comment-item",template:ThriveComments.util.tpl("moderation/comment-item"),events:{"click .expand-reply":"expandReply","click .change-status":"changeStatus","click .delete-comment":"deleteComment","click .edit-status":"editComment","click .undo-action":"undoAction","click .cancel-edit":"closeEdit","click .save-edit":"saveEdit","click .reply-action":"replyAction","click .cancel-reply":"closeReply","click .save-reply":"submitReply","click .delegate-comment":"delegateComment","click .tvo-comment-button":"saveTestimonial","keydown .tcm-comment-content":"escEditComment","keydown .tcm-comment-content-reply":"escReplyComment","click .tcm-tooltip-link":"clickCopyMail","focus .tcm-last-tabindex":"focusTextArea","focus .tcm-last-edit-tabindex":"focusEditArea","mousedown .tcm-hyperlink":"openHyperLink"},actions:{approved:ThriveComments.translations.approved,hold:ThriveComments.translations.unapproved,edit_comment:ThriveComments.translations.edit,delegate_comment:ThriveComments.translations.delegate,no_reply_needed:ThriveComments.translations.no_reply_needed,needs_reply:ThriveComments.translations.reply_needed,reply:ThriveComments.translations.reply,featured:ThriveComments.translations.feature_text,stop_featuring:ThriveComments.translations.stop_feature_text},initialize:function(){this.counters=ThriveComments.objects.CommentsCounters,this.comments_list=ThriveComments.objects.CommentsList,this.filters=ThriveComments.objects.CommentsPagination.filters,this.moderation_view=ThriveComments.objects.CommentsPagination.moderation_view,this.listenTo(this.model,"sync",this.modelSynced)},_render:function(){this.setExpandReplyContent(),this.$el.html(this.template({comment:this.model})),"delete"===this.model.get("status")&&this.remove(),this.setImageSrc(),this.cooltips();new Clipboard(".tcm-tooltip-link");return this.model.get("is_minified")&&this.minimizeComment(this.model,this.counters.active_tab_class.replace(/-/g,"_")),this},modelSynced:function(){var a=this;if("content"in this.model.changed){var b=this.comments_list.allCollections.where({parent:parseInt(this.model.get("id"))});_.each(b,function(b){b.get("tcm_parent_comment").comment_content=a.model.get("content").raw,b.trigger("sync")})}this.setImageSrc(),this.render()},setImageSrc:function(){var a=this.$(".moderation-img");this.model.get("author-background-image")&&a.css("background-image",this.model.get("author-background-image"))},escReplyComment:function(a){return 27!==a.keyCode||(this.$("a.cancel-reply").click(),!1)},escEditComment:function(a){return 27!==a.keyCode||(this.$("a.cancel-edit").click(),!1)},cooltips:function(){var a,b=this.$("[class^='tooltipelem']"),c=b.find(".tooltiptext");b.bind({mouseenter:function(b){clearInterval(a),c.hide(),jQuery(b.currentTarget).find(".tooltiptext").show()},mouseleave:function(b){a=setTimeout(function(){jQuery(b.currentTarget).find(".tooltiptext").hide()},1e3)}})},setExpandReplyContent:function(){if(0!==this.model.get("parent")&&this.model.get("tcm_parent_comment")){var a=this.model.get("tcm_parent_comment").comment_content;if(a.length>140){var b=a.substring(0,140);b=b.split(" ").slice(0,-1).join(" ")+"&nbsp;&hellip;",this.model.set("parent_excerpt",b)}}},expandReply:function(b){return a(b.currentTarget).toggleClass("expanded"),this.$(".tcm-short-content").slideToggle(),this.$(".tcm-parent-all-content").slideToggle(),!1},changeStatus:function(a){var b=a.currentTarget.getAttribute("data-status"),c=a.currentTarget.getAttribute("data-value");return"function"==typeof this[b]&&this[b](a,c),!1},changeApprove:function(a,b){var c=this,d=null,e={},f=void 0;return ThriveComments.const.moderation.unapprove===b&&"0"!==this.model.get("tcm_featured")&&(this.model.set("tcm_featured",0),d={update_meta:"tcm_featured"},e.tcm_featured=0),d=_.extend({},this.filters,d),d.action_status=b,d.sync=!1,f=this.model.toJSON(),this.model.set("status",b).save(d,{success:function(a,b,d){c.counters.render(d),c.actionsAfterSuccess()},error:function(a,b,d){c.ajaxError(b,d,f)}}),e.status=b,e.previousAction=b===ThriveComments.const.moderation.unapprove?ThriveComments.const.moderation.unapprove:ThriveComments.const.moderation.approve,this.actionsAfterAjax(e),this},ajaxError:function(a,b,c){
void 0!==c&&this.model.set(c);var d=this.getErrorMessage(a,b);this.actionsAfterError(d)},actionsAfterSuccess:function(){var b=this;this.childView.isMin||this.model.trigger("sync");var c=this.$(".tcm-pending-save"),d=this.$(".replace-after-success");c.length&&d.length&&(c.addClass("tcm-request-success"),setTimeout(function(){c.find("span.tcm-text").fadeOut(0),""!==d.html().trim()?c.parent().parent().html(d.html()):b.childView.isMin?c.find("span.tcm-check").fadeIn(1500):c.find("span.tcm-check").fadeIn(1500,function(){a(this).delay(1500).fadeOut(1500)})},1e3))},actionsAfterError:function(a){this.childView.isMin||this.model.trigger("sync");var b=this.$(".tcm-pending-save"),c=this.$(".tcm-pending-error"),d=this.$(".tcm-pending-error .tooltiptext"),e=void 0,f=a;a=this.generateErrorMessage(a),TVE_Dash.err(f,5e3),b.addClass("tcm-request-error"),b.find("span.tcm-text").html(ThriveComments.translations.error).hide(),c.css("display","inline"),d.html(a),c.bind({mouseenter:function(a){clearInterval(e),d.hide(),jQuery(a.currentTarget).find(".tooltiptext").show()},mouseleave:function(a){e=setTimeout(function(){jQuery(a.currentTarget).find(".tooltiptext").hide()},1e3)}})},generateErrorMessage:function(a){if(this.childView.isMin)return a;var b=this.childView.model.get("previousAction"),c=void 0;return c=a+ThriveComments.translations.moderation_error+": "+this.actions[b],"reply"===b&&(c+="<a href='#' class='tcm-see-content'>"+ThriveComments.translations.see_comment_reply+"</a>"),"edit_comment"===b&&(c+="<a href='#' class='tcm-see-content'>"+ThriveComments.translations.see_comment_edit+"</a>"),c},spamComment:function(a,b){var c=this,d=_.extend({action_status:b,sync:!1},this.filters,d),e=this.model.toJSON(),f={};return this.model.set("can-undo",1),this.model.set("undo-action",ThriveComments.translations.spam),this.model.set("status",b).save(d,{success:function(a,b,d){c.counters.render(d),c.actionsAfterSuccess()},error:function(a,b,d){c.ajaxError(b,d,e),c.changeUndo()}}),f.status=b,this.actionsAfterAjax(f),this},unspam:function(a,b){var c=this,d=_.extend({sync:!1},this.filters),e={},f=void 0;return f=this.model.toJSON(),d.action_status=b,this.model.set("status",b).save(d,{success:function(a,b,d){c.counters.render(d),c.actionsAfterSuccess()},error:function(a,b,d){c.ajaxError(b,d,f)}}),e.status=b,e.previousAction="unspam",this.actionsAfterAjax(e),this},featured:function(a,b){var c,d=this,e={},f=_.extend({sync:!1},this.filters,{update_meta:"tcm_featured"});return c=this.model.toJSON(),this.model.get("status")!==ThriveComments.const.moderation.approve&&(this.model.set("status",ThriveComments.const.moderation.approve),f.action_status=ThriveComments.const.moderation.approve),this.model.set("tcm_featured",parseInt(b)),this.model.save(f,{success:function(a,b,c){d.counters.render(c),d.actionsAfterSuccess()},error:function(a,b,e){d.ajaxError(b,e,c)}}),e.status=ThriveComments.const.moderation.approve,e.previousAction="featured",this.actionsAfterAjax(e),this},stopFeaturing:function(a,b){var c=this,d=_.extend({sync:!1},this.filters,{update_meta:"tcm_featured"}),e={},f=this.model.toJSON();return this.model.set("tcm_featured",parseInt(b)),this.model.save(d,{success:function(a,b,d){c.counters.render(d),c.actionsAfterSuccess()},error:function(a,b,d){c.ajaxError(b,d,f)}}),e.status=f.status,e.previousAction="stop_featuring",this.actionsAfterAjax(e),this},undoAction:function(){var a=this,b="trash"===this.model.get("status")?"untrash":"unspam",c=_.extend({},this.filters);return c.action_status=b,this.model.set("status",b),this.model.save(c,{success:function(b,c,d){b.set("can-undo",0),a.counters.render(d)},error:this.saveSettingError}),!1},trashComment:function(a,b){var c=this,d=_.extend({action_status:b,sync:!1},this.filters),e=this.model.toJSON(),f={};return this.model.set("status",b),this.model.set("can-undo",1),this.model.set("undo-action",ThriveComments.translations.trash),this.model.save(d,{success:function(a,b,d){c.counters.render(d),c.actionsAfterSuccess()},error:function(a,b,d){c.ajaxError(b,d,e),c.changeUndo()}}),f.status=b,f.previousAction="trash",this.actionsAfterAjax(f),this},restoreComment:function(a,b){var c=this,d=_.extend({sync:!1},this.filters),e=this.model.toJSON(),f={};return d.action_status=b,this.model.set("status",b).save(d,{success:function(a,b,d){c.counters.render(d),c.actionsAfterSuccess()},error:function(a,b,d){c.ajaxError(b,d,e)}}),f.status=b,f.previousAction="restore",this.actionsAfterAjax(f),!1},deleteComment:function(){var b=this,c={force:!0};return this.filters.post_id&&(c.post_id=this.filters.post_id),this.model.destroy({data:c,processData:!0}).done(function(c,d,e){var f=a("li.active").attr("data-arg"),g=b.counters.getCountersFromHeaders(e);b.remove(),b.counters.render(e),"0"===g[f]&&(this.noCommentsMessage=new ThriveComments.views.NoCommentsMessage({el:a(".tcm-moderation-container")})),a(window).trigger("scroll")}).fail(this.saveSettingError),this},replyNeeded:function(a,b){var c=this,d=void 0,e={},f=_.extend({sync:!1},this.filters,{update_meta:"tcm_needs_reply"});return d=this.model.toJSON(),2===parseInt(b)&&"hold"===this.model.get("status")&&(f.action_status=ThriveComments.const.moderation.approve,this.model.set("status",ThriveComments.const.moderation.approve),e.status=ThriveComments.const.moderation.approve),this.model.set("tcm_needs_reply",parseInt(b)),this.model.save(f,{success:function(a,b,d){c.counters.render(d),c.actionsAfterSuccess()},error:function(a,b,e){c.ajaxError(b,e,d)}}),void 0===e.status&&(e.status=d.status),e.tcm_needs_reply=parseInt(b),e.previousAction=1===parseInt(b)?"needs_reply":"no_reply_needed",this.actionsAfterAjax(e),this},getErrorMessage:function(a,b){var c="";if(a.responseJSON.message)c=a.responseJSON.message;else if(a.responseText)try{if("parsererror"===status)c="Could not parse response: "+a.responseText;else{var d=JSON.parse(a.responseText);c=d.message}}catch(a){}return c||(c=(a.statusText||status)+(a.status?" ("+a.status+")":"")),c},editComment:function(){var b=this.$(".edit-section");a(".reply-action").show(),a(".edit-section").hide(),a(".reply-section").hide(),b.show().find("textarea").focus()},closeEdit:function(){return this.$(".edit-section").hide(),!1},saveEdit:function(){var a,b=this,c=this,d=this.$(".tcm-comment-content"),e=this.$(".tcm-edit-name"),f=this.$(".tcm-edit-email"),g=this.$(".tcm-edit-website"),h=g.val(),i=!0,j={};return ThriveComments.util.validateInput(d,ThriveComments.translations.comment_content_missing,!0)||(i=!1),ThriveComments.util.validateInput(e,ThriveComments.translations.author_name_required,!0)||(i=!1),""!==f.val()&&ThriveComments.util.validateEmail(f,ThriveComments.util.render_label("isRequired"))||(f.prev(".tcm-error-message").show().html(ThriveComments.util.render_label("isRequired")),i=!1),""!==g.val()&&(h=ThriveComments.util.addHttp(h),ThriveComments.util.isValidUrl(h)||(g.prev(".tcm-error-message").show().html(ThriveComments.util.render_label("isRequired")),i=!1)),!!i&&(a=this.model.toJSON(),j.content=_.clone(this.model.get("content")),j.content.raw=d.val(),j.content.rendered="<p>"+d.val()+"</p>",j.author_name=e.val(),j.author_email=f.val(),j.author_url=h,this.model.get("author_ip")||this.model.set("author_ip","127.0.0.1"),this.model.set(j),this.model.save({sync:!1},{success:function(){b.actionsAfterSuccess()},error:function(e,f,g){b.ajaxError(f,g,a),c.$(".tcm-comment-content").val(d.val())}}),j.previousAction="edit_comment",j.status=a.status,this.actionsAfterAjax(j),!0)},replyAction:function(){var b=this.$(".reply-section"),c=b.find("textarea"),d=void 0,e=void 0,f=void 0,g=void 0;return a(".reply-action").show(),a(".edit-section").hide(),a(".reply-section").hide(),this.$(".reply-action").hide(),setTimeout(function(){b.find("grammarly-btn").length&&b.find(".textarea-container").addClass("tcm-has-grammarly")},1e3),b.show(),c.focus(),d=c.offset().top,e=c.height(),f=a(window).height(),g=e<f?d-(f/2-e/2):d,a("html, body").animate({scrollTop:g},500),!1},closeReply:function(){return this.$(".reply-section").hide(),this.$(".reply-action").show(),!1},submitReply:function(){var a=this,b=void 0,c={};this.model.set("tcm_comments_author_count",this.model.get("tcm_comments_author_count")+1);var d={children:[],content:this.$(".tcm-comment-content-reply").val(),comment_author:ThriveComments.current_user.display_name,comment_author_email:ThriveComments.current_user.user_email,parent:this.model.get("id"),post:this.model.get("post"),user_id:ThriveComments.current_user.ID,tcm_needs_reply:2},e=_.extend({},this.filters);return b=this.model.toJSON(),e.action_status=ThriveComments.const.moderation.approve,this.model.get("tva_term_id")&&(e.tva_term_id=this.model.get("tva_term_id")),e.sync=!1,d=new ThriveComments.models.Comment(d),d.save(e,{success:function(){a.actionsAfterSuccess(),a.updateParent()},error:function(c,d,e){a.ajaxError(d,e,b),a.$(".tcm-comment-content-reply").html(c.get("content"))}}),c.status=ThriveComments.const.moderation.approve,c.previousAction="reply",this.actionsAfterAjax(c),!1},actionsAfterAjax:function(a){this.$("#tcm-comment-content").val(""),this.$(".reply-section").hide(),this.model.set(a),this.model.set("is_minified",1),this.model.trigger("sync")},changeUndo:function(){var a=this.$(".undo-action");a.html(ThriveComments.translations.moderation_expand),a.removeClass("undo-action").addClass("expand-action"),a.data("data-key","x")},updateParent:function(){var a=this,b=_.extend({},this.filters),c=this.model.toJSON();this.model.get("status")!==ThriveComments.const.moderation.approve&&this.model.set("status",ThriveComments.const.moderation.approve),b.action_status=ThriveComments.const.moderation.approve,b.sync=!1,this.model.set("update_meta","tcm_needs_reply"),this.model.set("tcm_needs_reply",0).save(b,{success:function(b,c,d){a.counters.render(d),a.actionsAfterSuccess()},error:function(b,d,e){a.ajaxError(d,e,c)}})},replyError:function(a){var b=this.$(".min-comment .tcm-pending-save"),c=this.$(".min-comment .tcm-pending-error"),d=this.$(".tooltiptext"),e=void 0;TVE_Dash.err(a,5e3),b.addClass("tcm-request-error"),b.find("span").html("Error"),c.show(),d.html(a),c.bind({mouseenter:function(a){clearInterval(e),d.hide(),jQuery(a.currentTarget).find(".tooltiptext").show()},mouseleave:function(a){e=setTimeout(function(){jQuery(a.currentTarget).find(".tooltiptext").hide()},1e3)}})},delegateComment:function(){this.moderation_view.unbindKeyboardEvents(),this.moderation_view.delegateModalData({model:this.model,dismissible:!1,className:"tvd-modal tcm-modal-delegate",counters:this.counters,commentView:this})},saveTestimonial:function(){"undefined"!=typeof ThriveOvation&&ThriveOvation.comments.addEditTestimonial(this.model.get("id"))},clickCopyMail:function(){TVE_Dash.success(ThriveComments.translations.email_copied)},focusTextArea:function(){a(".tcm-comment-content-reply").focus()},focusEditArea:function(){a(".tcm-comment-content").focus()},openHyperLink:function(){this.hyperlink=new ThriveComments.views.HyperLink({el:this.$(".tcm-hyperlink-dropdown"),selected_text:ThriveComments.util.formatSelection(this.$(".tcm-comment-content-reply")),commentView:this}),this.$(".tcm-hyperlink-dropdown").show().addClass("dropdown")},minimizeComment:function(b,c){this.childView=new ThriveComments.views.CommentMinimum({el:this.$(".min-comment"),model:b,parentView:this,activeTab:c}),this.childView.render(),a(window).trigger("scroll")}}),ThriveComments.views.CommentMinimum=ThriveComments.views.Base.extend({template:ThriveComments.util.tpl("moderation/comment-item-min"),events:{"click .expand-action":"expandParent","click .undo-action":"undoAction"},isMin:0,initialize:function(a){this.parentView=a.parentView,this.activeTab=a.activeTab},render:function(){var a=this,b=this.afterActionMessage();if(b){var c=this.parentView.$(".tcm-moderation-comment-container");this.$el.html(this.template({comment:this.model,text:b})),c.animate({height:"80px"},{queue:!1,duration:400,complete:function(){c.fadeOut(function(){a.$el.show()})}}),this.isMin=1}else this.notCollapsingComments(),this.isMin=0;return this},notCollapsingComments:function(){var a=this.model.get("previousAction"),b=this.parentView.$(".pending-no-collapse"),c=this.parentView.$(".replace-after-success"),d=void 0;switch(a){case"hold":case"approved":case"edit_comment":case"featured":case"stop_featuring":d=this.parentView.$(".awaiting-moderation");break;case"needs_reply":case"no_reply_needed":case"reply":d=this.parentView.$(".no-reply-needed");break;case"delegate_comment":d=this.parentView.$(".assigned-to")}this.commentMessages=new ThriveComments.views.CommentItemMessages({parentView:this.parentView,previousAction:a}),d&&(c.html(d.html()),d.html(this.commentMessages.$el),b.show())},expandParent:function(){return this.parentView.model.set("is_minified",0),this.parentView.render(),this.parentView.$(".tcm-moderation-comment-container").hide().slideDown(),!1},undoAction:function(){var a=this,b="trash"===this.parentView.model.get("status")?"untrash":"unspam",c=_.extend({},this.filters),d=this.parentView.model.toJSON();return c.action_status=b,c.sync=!1,this.parentView.model.set("status",b),this.parentView.model.save(c,{success:function(b,c,d){a.parentView.counters.render(d),a.expandParent()},error:function(b,c,e){var f=a.parentView.getErrorMessage(c,e);a.parentView.actionsAfterError(f),a.parentView.model.set(d)}}),!1},afterActionMessage:function(){var a=void 0;return(a=this.handleSpamTrash())?a:"function"==typeof this[this.activeTab]&&this[this.activeTab]()},handleSpamTrash:function(){var a=this.model.get("status");if(a===ThriveComments.const.moderation.spam||a===ThriveComments.const.moderation.trash){var b=a===ThriveComments.const.moderation.spam?ThriveComments.translations.moderation_spam:ThriveComments.translations.moderation_trash;return this.getMessage(b)}return!1},total:function(){return!1},pending:function(){this.model.changedAttributes();return this.model.get("status")===ThriveComments.const.moderation.approve&&("reply"===this.model.get("previousAction")?this.getMessage(ThriveComments.translations.moderation_replied):"no_reply_needed"===this.model.get("previousAction")?this.getMessage(ThriveComments.translations.moderation_no_replied):"featured"===this.model.get("previousAction")?this.getMessage(ThriveComments.translations.moderation_featured):this.getMessage(ThriveComments.translations.moderation_approved))},unreplied:function(){var a=this.model.get("previousAction"),b=!1;switch(a){case"no_reply_needed":b=this.getMessage(ThriveComments.translations.moderation_no_replied);break;case"reply":b=this.getMessage(ThriveComments.translations.moderation_replied)}return b},pending_my_reply:function(){var a=this.model.changedAttributes();return"reply"===this.model.get("previousAction")?this.getMessage(ThriveComments.translations.moderation_replied):"no_reply_needed"===this.model.get("previousAction")?this.getMessage(ThriveComments.translations.moderation_no_replied):"delegate_comment"===this.model.get("previousAction")&&this.getMessage(ThriveComments.translations.moderation_delegate+" "+a.tcm_delegate_author)},tcm_featured:function(){this.model.changed;return"stop_featuring"===this.model.get("previousAction")?this.getMessage(ThriveComments.translations.moderation_no_featured):"hold"===this.model.get("previousAction")&&this.getMessage(ThriveComments.translations.moderation_unapproved)},tcm_spam:function(){return"unspam"===this.model.get("previousAction")&&this.getMessage(ThriveComments.translations.moderation_not_spam)},tcm_trash:function(){return"restore"===this.model.get("previousAction")&&this.getMessage(ThriveComments.translations.moderation_restored)},getMessage:function(a){return ThriveComments.translations.comment_by+" "+this.model.get("author_name")+" "+a}}),ThriveComments.views.HyperLink=ThriveComments.views.Base.extend({template:ThriveComments.util.tpl("moderation/hyperlink"),events:{"click .hyperlink-close":"closeHyperLink","click .hyperlink-save":"saveHyperLink"},initialize:function(a){this.parentView=a&&a.commentView?a.commentView:null,this.selected_text=a.selected_text,this.render()},render:function(){return this.$el.html(this.template({selected_text:this.selected_text.selectedText})),TVE_Dash.materialize(this.$el),this.initAutocomplete(),this.disableSave(),this},closeHyperLink:function(){this.viewRemove(),a(".tcm-hyperlink-dropdown").hide().removeClass("dropdown")},disableSave:function(){var b=a("#tcm_hyperlink_url"),c=a(".hyperlink-save");b.bind("change keyup input",function(){""===b.val()?c.attr("disabled",!0):c.attr("disabled",!1)})},saveHyperLink:function(){var a=this.$("#hyperlink-error"),b=this.$("#hyperlink-new-tab"),c=this.$("#hyperlink-no-follow"),d=ThriveComments.util.addHttp(this.$("#tcm_hyperlink_url").val()),e=this.$("#tcm_hyperlink_text").val(),f=this.parentView.$("#tcm-comment-content-reply");if(!ThriveComments.util.isValidUrl(d))return a.show(),!1;a.hide(),""===e&&(e=d);var g='<a href = "'+d+'"';if(b.is(":checked")&&(g+=' target="_blank"'),c.is(":checked")&&(g+=' rel="nofollow"'),g+=">"+e+"</a>",""===this.selected_text.selectedText)ThriveComments.util.insertAtCaret(f,g);else{var h=f.val();f.val(h.substring(0,this.selected_text.startPos)+g+h.substring(this.selected_text.endPos,h.length))}this.closeHyperLink()},getPostNameById:function(b){var c=ThriveComments.routes.settings+"/get_post_name_by_id";jQuery.ajax({headers:{"X-WP-Nonce":ThriveComments.nonce},url:c,type:"POST",data:{postId:b}}).done(function(b){a("#tcm_hyperlink").removeClass("ui-autocomplete-loading")}).fail(function(a){TVE_Dash.err(JSON.parse(a.responseText).message)}).always(function(){TVE_Dash.hideLoader()})},LinkAutocomplete:function(b,c){var d=this,e=location.href.split("/");c.autocomplete({delay:50,select:function(a,b){return d.$("#link-error").hide(),d.$("#tcm_hyperlink_url").val(e[0]+"//"+e[2]+"?p="+b.item.id),d.$("#tcm_hyperlink_text").val(b.item.label),!1},source:function(c,d){a.ajax({headers:{"X-WP-Nonce":ThriveComments.nonce},url:b,dataType:"json",data:{q:c.term},type:"POST"}).done(function(b){a("#hyperlink-error").hide(),d(b)}).fail(function(a){TVE_Dash.err(JSON.parse(a.responseText).message)})}})},initAutocomplete:function(){var a=ThriveComments.routes.settings+"/redirect_autocomplete",b=this.$(".tcm-autocomplete");this.LinkAutocomplete(a,b)},viewRemove:function(){return this.$el.empty(),this.undelegateEvents(),this.unbind(),this}}),ThriveComments.views.DelegateModal=TVE_Dash.views.Modal.extend({template:ThriveComments.util.tpl("moderation/delegate-comment"),events:{"click .tcm-delegate":"delegate_comment","click .moderation-doe":"focusAtClick"},keyboardEvents:{up:"upDown",down:"upDown",esc:"escAction",enter:"enterAction"},afterInitialize:function(a){"undefined"!==a.bulkActions&&(this.bulkActions=a.bulkActions),this.counters=a.counters,this.commentView=a.commentView},onClose:function(){ThriveComments.objects.ModerationView.delegateEvents()},onOpen:function(){if("0"===this.model.get("tcm_delegate"))return this.$(".moderators-list div").first().addClass("tcm-focused"),this;var a=this.$("#"+this.model.get("tcm_delegate")),b=this.$(".moderators-container");return a.addClass("tcm-focused"),b.animate({scrollTop:a.offset().top-b.offset().top+b.scrollTop()-b.height()/2}),this},escAction:function(){return this.$(".tcm-back-btn").click(),!1},enterAction:function(){return this.$(".tvd-modal-submit").click(),!1},upDown:function(a){var b=this.$(".tcm-focused");return 106===a.keyCode||40===a.keyCode?this.changeFocus(b,b.next(".moderation-doe")):this.changeFocus(b,b.prev(".moderation-doe")),!1},focusAtClick:function(){var b=document.activeElement;a(".moderation-doe").removeClass("tcm-focused"),a(b).addClass("tcm-focused")},changeFocus:function(a,b){var c=this.$(".moderators-container");if(!b.length)return!1;var d=b.offset().top,e=b.height(),f=c.height(),g=void 0;return g=e<f?d-(f/2-e/2):d,a.removeClass("tcm-focused"),b.addClass("tcm-focused"),c.animate({scrollTop:g},300,"easeOutQuint"),!0},delegate_comment:function(){var a=this,b=this.$(".tcm-focused").attr("id"),c=this.$(".tcm-focused").attr("data-name"),d=this.model.toJSON(),e={},f=_.extend({sync:!1},ThriveComments.objects.CommentsPagination.filters,{update_meta:"tcm_delegate"});void 0!==this.bulkActions?(this.bulkActions.ajaxData.value=b,this.bulkActions.ajaxData.delegator_name=c,this.bulkActions.bulkAjax(this.bulkActions.ajaxData)):(this.model.set("tcm_delegate",b).save(f,{success:function(b,c,d){a.counters.render(d),a.commentView.actionsAfterSuccess()},error:function(b,c,e){a.commentView.ajaxError(c,e,d)}}),e.status=d.status,e.tcm_delegate=b,e.previousAction="delegate_comment",this.commentView.actionsAfterAjax(e))}}),ThriveComments.views.CommentsPagination=ThriveComments.views.Base.extend({className:"tcm-admin-moderation-pagination",template:ThriveComments.util.tpl("moderation/comment-pagination"),events:{},comments_loaded:1,filters:{per_page:10,status:"all",order:"desc",orderby:"date",lastDate:0,context:"edit"},default_counters:{pending:0,pendingMyReply:0,total:0,unreplied:0,featured:0,spam:0,trash:0},initialize:function(a){this.collection=a.collection,this.view=a.view,this.moderation_view=a.moderation_view,ThriveComments.objects.CommentsCounters=new ThriveComments.views.CommentsCounters({el:this.moderation_view.$(".tcm-filters-container"),counters:this.default_counters,commentsPagination:this,moderation_view:a.moderation_view}),this.counters=ThriveComments.objects.CommentsCounters,this.initPagination()},_render:function(){return this.$el.html(this.template()),this.view.$el.append(this.$el),this},showCollection:function(a,b){this.view.render(this.collection),this.collection.length>=this.filters.per_page?this.render():this.$el.remove()},initPagination:function(){var a=this;jQuery(window).scroll(function(){a.comments_loaded&&ThriveComments.util.elem_viewport(a.$el)&&(a.nextPage(),a.comments_loaded=0)})},fetchComments:function(b,c){var d=this;c=_.extend(this.filters,c),this.lastDate?"desc"===c.order?(c.before=this.lastDate,delete c.after):(c.after=this.lastDate,delete c.before):(delete c.before,delete c.after),ThriveComments.objects.Comments.fetch({data:c,reset:!0}).done(function(b,c,e){d.counters.render(e),d.showCollection();var f=d.counters.getCountersFromHeaders(e),g=a("li.active").attr("data-arg"),h=b.length?b[b.length-1].date:0;d.lastDate=h,d.initialCounter=f[g],d.comments_loaded=1,d.moderation_view.hideOverlay()})},fetchAndEmpty:function(a,b){return this.view.$el.empty(),this.resetFilters(),this.moderation_view.showOverlay(),this.fetchComments(a,b),this},nextPage:function(){this.moderation_view.showOverlay(),this.fetchComments(null,{per_page:this.filters.per_page})},resetFilters:function(){this.lastDate=0}}),ThriveComments.views.BulkActions=ThriveComments.views.Base.extend({template:ThriveComments.util.tpl("moderation/bulk-actions"),events:{"click #tcm-bulk-checkbox":"activateBulk","click .tcm-apply-bulk":"applyAction","click .tcm-bulk-action":"changeOption"},commentIds:[],ajaxData:{},initialize:function(a){this.bulklist=a.bulklist,this.commentsList=a.commentsList,this.commentsPagination=a.commentsPagination,this.counters=ThriveComments.objects.CommentsCounters,this._render({bulklist:a.bulklist})},_render:function(a){this.$el.html(this.template(a)),this.$(".tcm-bulk-action").hide()},changeOption:function(a){var b=this.$(".current-bulk-option");b.text(a.currentTarget.textContent),b.attr("data-value",a.currentTarget.dataset.value),b.attr("data-status",a.currentTarget.dataset.status),b.attr("data-action",a.currentTarget.dataset.action)},activateBulk:function(){var b=this.$("#tcm-bulk-checkbox"),c=this.$(".tcm-apply-bulk"),d=a(".tcm-comment-checkbox"),e=a(".tcm-bulk-action");if(!a(".tcm-comment-checkbox").length)return!1;b.hasClass("indeterminate")?(b.removeClass("indeterminate"),b.prop("checked",!1),d.prop("checked",!1),e.hide(),c.hide()):b.is(":checked")&&this.commentsList.collection.length?(d.prop("checked",!0),e.show(),c.css("display","inline-block")):(d.prop("checked",!1),c.hide(),e.hide())},bulkAjax:function(b){var c=this,d=this.buildPreviousAttributes(b.comment_ids);a.ajax({headers:{"X-WP-Nonce":ThriveComments.nonce},cache:!1,dataType:"JSON",url:ThriveComments.moderation_routes.bulk_actions,type:"POST",data:b}).done(function(b,d,e){var f=b.data;f.length===c.commentsList.collection.length&&"delete"===f[0].new_value&&(c.noCommentsMessage=new ThriveComments.views.NoCommentsMessage({el:a(".tcm-moderation-container")})),f.forEach(function(a){void 0!==c.commentsList.commentsViews[a.id]&&c.commentsList.commentsViews[a.id].actionsAfterSuccess()}),c.counters.render(e)}).fail(function(a,e){var f=void 0,g=void 0;a.responseJSON.data&&(f=a.responseJSON.data.comment_id);for(var h=0;h<b.comment_ids.length;h++){var i=b.comment_ids[h];(f===i||g)&&(void 0!==c.commentsList.commentsViews[i]&&c.commentsList.commentsViews[i].ajaxError(a,e,d[i]),g=!0)}}).always(function(){c.commentIds=[];var b=c.$("#tcm-bulk-checkbox");a(".tcm-comment-checkbox").prop("checked",!1),b.prop("indeterminate",!1),b.prop("checked",!1),b.removeClass("indeterminate"),c.$(".tcm-apply-bulk").hide()}),this.actionsAfterBulkAjax(b)},actionsAfterBulkAjax:function(a){var b=this;a.comment_ids.forEach(function(c){var d=b.getSuccessAttributes(a);void 0!==b.commentsList.commentsViews[c]&&b.commentsList.commentsViews[c].actionsAfterAjax(d)})},getSuccessAttributes:function(a){var b=[];return b[a.status]=a.value,b.previousAction=a.previousAction,void 0!==a.delegator_name&&(b.tcm_delegate_author=a.delegator_name),"status"===a.status&&ThriveComments.const.moderation.unapprove===a.value&&(b.tcm_featured=0),"tcm_featured"===a.status&&1===parseInt(a.value)&&(b.status=ThriveComments.const.moderation.approve),b},buildPreviousAttributes:function(a){var b=this,c=[];return void 0===a?c:(a.forEach(function(a){var d=b.commentsList.allCollections.findWhere({id:parseInt(a)});void 0!==d&&(c[a]=d.toJSON())}),c)},applyAction:function(b){var c=this.$(".current-bulk-option"),d=c.attr("data-status"),e=c.attr("data-value"),f=c.attr("data-action"),g=this;a(".tcm-comment-checkbox:checked").each(function(){g.commentIds.push(this.id)}),this.ajaxData=_.extend({},g.commentsPagination.filters,{comment_ids:this.commentIds,status:d,value:e,previousAction:f}),"tcm_delegate"===d?this.commentsPagination.moderation_view.delegateModalData({model:ThriveComments.objects.Comments.first(),bulkActions:this,dismissible:!1,"max-width":"25%",counters:this.counters}):this.bulkAjax(this.ajaxData),this.$(".tcm-bulk-action").hide()}}),ThriveComments.views.KeyboardTooltipContainer=ThriveComments.views.Base.extend({template:ThriveComments.util.tpl("moderation/keyboard-tooltip"),events:{"click .esc":"hide"},keyboardEvents:{esc:"hide",up:"returnFalse",down:"returnFalse"},returnFalse:function(){return!1},initialize:function(a){this.moderation_view=a.moderation_view,this._render(),this.moderation_view.bindKeyboardEvents()},_render:function(){return this.$el.html(this.template({})),a(document).ready(function(){a(".scrollbar-inner").scrollbar()}),this},hide:function(){a(".keyboard-tooltip-container").hide(),a("body").css("overflow","visible"),this.moderation_view.bindKeyboardEvents()}}),ThriveComments.views.KeyboardNotification=ThriveComments.views.Base.extend({template:ThriveComments.util.tpl("moderation/keyboard-notification"),events:{"click #show-keyboard-notification-checkbox":"saveKeyboardNotificationSetting","click .esc":"hideKeyboardNotification","click .keyboard-notification-close":"hideKeyboardNotification",hover:"preventHide",mouseover:"preventHide"},hide_notification:!1,timeout:null,initialize:function(){a(window).on("resize",this.render.bind(this)).ready(this.render.bind(this));var b=ThriveComments.tcm_display_keyboard_notification_tooltip;if(b.length&&(this.hide_notification=_.find(JSON.parse(b),function(a){return a===parseInt(ThriveComments.current_user.ID)})),this.$el.css("opacity","0"),!this.hide_notification){var c=this;setTimeout(function(){c.showKeyboardNotification()},1e3),this.timeout=setTimeout(function(){c.hideKeyboardNotification()},4e3)}},render:function(){var b=a(".plus");return this.hide_notification||(this.$el.offset({top:b.offset().top,left:b.offset().left-this.$el.outerWidth()/2}),this.$el.html(this.template())),this},preventHide:function(a){clearTimeout(this.timeout);var b=this;this.timeout=setTimeout(function(){b.hideKeyboardNotification()},5e3)},saveKeyboardNotificationSetting:function(a){new ThriveComments.models.KeyboardSettings({name:ThriveComments.const.moderation.tcm_keyboard_tooltip,value:a.currentTarget.checked}).save().done(function(a){TVE_Dash.success(ThriveComments.translations.settings_saved_success_toast)}).fail(function(a){TVE_Dash.err(ThriveComments.translations.settings_saved_fail_toast)})},hideKeyboardNotification:function(a){this.$el.removeClass("tooltipDown").addClass("tooltipUp")},showKeyboardNotification:function(a){this.$el.removeClass("tooltipUp").addClass("tooltipDown")}}),ThriveComments.views.NoCommentsMessage=ThriveComments.views.Base.extend({template:ThriveComments.util.tpl("moderation/comment-list"),events:{},initialize:function(){this._render()},_render:function(){return this.$el.append(this.template()),this}})}(jQuery);var ThriveComments=ThriveComments||{};ThriveComments.objects=ThriveComments.objects||{},function(a){var b=Backbone.Router.extend({view:null,$el:a("#tcm-admin-moderation-wrapper"),routes:{commentsModeration:"commentsModeration"},params:{},initialize:function(){},commentsModeration:function(){this.view&&this.view.remove(),this.view=new ThriveComments.views.CommentsModeration,this.$el.html(this.view.$el),ThriveComments.objects.ModerationView=this.view}});a(function(){ThriveComments.router=new b,Backbone.history.start({hashchange:!0}),Backbone.history.fragment||ThriveComments.router.navigate("#commentsModeration",{trigger:!0})})}(jQuery);