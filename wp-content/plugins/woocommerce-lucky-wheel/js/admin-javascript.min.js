jQuery(document).ready((function(e){"use strict";function t(t){let l=e('[name="white_list"]').closest("tr"),o=e('[name="black_list"]').closest("tr");switch(t){case"white_list":o.hide(),l.show();break;case"black_list":l.hide(),o.show()}}function l(t){let l=e('input[name="show_wheel"]').closest("tr"),o=e('input[name="scroll_amount"]').closest("tr");switch(t){case"popup_icon":case"show_wheel":l.closest("tr").fadeIn(200),o.closest("tr").fadeOut(200);break;case"random":l.closest("tr").fadeIn(200),o.closest("tr").fadeIn(200);break;case"on_scroll":l.closest("tr").fadeOut(200),o.closest("tr").fadeIn(200);break;case"on_exit":l.closest("tr").fadeOut(200),o.closest("tr").fadeOut(200)}}function o(){let t=0,l=e(".probability");l.each((function(){let l=e(this),o=l.closest("tr"),n=o.find('select[name="coupon_type[]"]'),a=o.find('input[name="prize_quantity[]"]');"non"!==n.val()&&0===parseInt(a.val())||(t+=parseInt(l.val()))})),t>0?l.each((function(){let l=e(this),o=l.closest("tr"),n=o.find('select[name="coupon_type[]"]'),a=o.find('input[name="prize_quantity[]"]'),i=0;if("non"===n.val()||0!==parseInt(a.val())){i=function(e,t=2){let l=Math.pow(10,t);return Math.round(e*l)/l}(100*parseInt(l.val())/t)}o.find(".probability-percent").val(i)})):l.each((function(){e(this).closest("tr").find(".probability-percent").val(0)}))}function n(){let t=1;e(".wheel-col-index").map((function(){e(this).html(t),t++}))}e(".vi-ui.tabular.menu").length&&e(".vi-ui.tabular.menu .item").vi_tab({history:!0,historyType:"hash"}),e(".vi-ui.accordion").length&&e(".vi-ui.accordion:not(.wlwl-accordion-init)").addClass("wlwl-accordion-init").vi_accordion("refresh"),e(".vi-ui.checkbox:not(.wlwl-checkbox-init)").addClass("wlwl-checkbox-init").off().checkbox(),e(".vi-ui.dropdown:not(.wlwl-dropdown-init)").addClass("wlwl-dropdown-init").off().dropdown(),e("#gdpr_policy,#wlwl_enable_funnelkit,#wlwl_enable_sendy,#wlwl_mailster_list,#wlwl_enable_mailpoet,#mailchimp_enable, #wlwl_enable_active_campaign, #wlwl_sendgrid_enable, #wlwl_enable_sendinblue, #wlwl_enable_klaviyo,#wlwl_enable_hubspot, #metrilo_enable").on("change",(function(){e(this).prop("checked")?e(".wlwl-"+e(this).attr("id")+"-class").show():e(".wlwl-"+e(this).attr("id")+"-class").hide()})).trigger("change"),e(".wheel-settings .ui-sortable").sortable({update:function(e,t){n()}}),e(document).on("change",'input[name="choose_using_white_black_list"]',(function(){t(e(this).val())})),t(e('input[name="choose_using_white_black_list"]:checked').val()),e('select[name="notify_intent"]').on("change",(function(){l(e(this).val())})),l(e('select[name="notify_intent"]').val()),jQuery(".wlwl_recaptcha_version").dropdown({onChange:function(e){2==e?(jQuery(".wlwl-recaptcha-v2-wrap").show(),jQuery(".wlwl-recaptcha-v3-wrap").hide()):(jQuery(".wlwl-recaptcha-v2-wrap").hide(),jQuery(".wlwl-recaptcha-v3-wrap").show())}}),e(".color-picker").iris({change:function(t,l){e(this).parent().find(".color-picker").css({backgroundColor:l.color.toString()}),e(this).parent().find("#wheel_wrap_bg_color")&&e(".wlwl-image-container").find(".review-images").css({background:l.color.toString()})},hide:!0,border:!0}).click((function(){e(".iris-picker").hide(),e(this).closest("td").find(".iris-picker").show()})),e("body").click((function(){e(".iris-picker").hide()})),e(".color-picker").click((function(e){e.stopPropagation()})),e(".wheel-popup-icon").on("click",(function(){let t=e(this),l=t.closest(".wheel-popup-icons-container");if(t.hasClass("wheel-popup-icon-selected"))t.removeClass("wheel-popup-icon-selected").attr("style",""),l.find('input[name="wheel_popup_icon"]').val("");else{let e=l.find(".wheel-popup-icon-selected");l.find('input[name="wheel_popup_icon"]').val(t.data("wheel_popup_icon")),t.addClass("wheel-popup-icon-selected").attr("style",e.attr("style")),e.attr("style","").removeClass("wheel-popup-icon-selected")}})),e("#wheel_popup_icon_color").iris({change:function(t,l){e(this).parent().find(".color-picker").css({backgroundColor:l.color.toString()}),e(".wheel-popup-icon-selected").css({color:l.color.toString()})},hide:!0,border:!0}),e("#wheel_popup_icon_bg_color").iris({change:function(t,l){e(this).parent().find(".color-picker").css({backgroundColor:l.color.toString()}),e(".wheel-popup-icon-selected").css({"background-color":l.color.toString()})},hide:!0,border:!0}),e(document).on("click",".clone_piece",(function(){let t=e(this).parent().parent().clone(),l=parseInt(t.find('input[name="probability[]"]').val());t.find('input[name="probability[]"]').val(l),t.insertAfter(e(this).parent().parent()),n(),o(),t.find(".vi-ui.dropdown").dropdown({placeholder:""}),t.find(".color-picker").iris({change:function(t,l){e(this).parent().find(".color-picker").css({backgroundColor:l.color.toString()})},hide:!0,border:!0,width:270}).on("click",(function(e){e.stopPropagation()}))})),e(document).on("click",".remove_field",(function(){if(o(),confirm("Would you want to remove this?")){if(!(e(".wheel_col").length>3))return alert("Must have at least 3 columns!"),!1;e(this).closest("tr").remove(),o(),n()}})),o(),e(document).on("change",".prize_quantity",(function(){o()})),e(document).on("change",".probability",(function(){o()})),n(),e('select[name="coupon_type[]"]').map((function(){let t=e(this),l=t.find(`option[value="${t.val()}"]`);void 0!==l.data("coupon_amount")&&t.closest("tr").find('input[name="coupon_amount[]"]').val(l.data("coupon_amount"))})),e(document).on("change",'select[name="coupon_type[]"]',(function(){o();let t=e(this),l=t.closest("tr"),n=t.val();switch(n){case"non":l.attr("class",`wheel_col wheel_col-${n}`),l.find(".coupon_amount").val(0).prop("readonly",!0).addClass("coupon-amount-readonly"),l.find(".custom_type_label").val("Not Lucky"),l.find('select[name="email_templates[]"]').val("").trigger("change");break;case"custom":l.attr("class",`wheel_col wheel_col-${n}`),l.find(".custom_type_value").val(""),l.find(".custom_type_label").val("");break;case"existing_coupon":l.attr("class",`wheel_col wheel_col-${n}`),l.find(".custom_type_label").val(woo_lucky_wheel_params_admin.default_coupon_label);break;case"percent":case"fixed_product":case"fixed_cart":l.attr("class",`wheel_col wheel_col-${n}`),l.find(".custom_type_label").val(woo_lucky_wheel_params_admin.default_coupon_label),l.find(".coupon_amount").removeClass("coupon-amount-readonly").prop("readonly",!1);break;default:l.find(".coupon_amount").val(t.find(`option[value="${n}"]`).data("coupon_amount")).prop("readonly",!0).addClass("coupon-amount-readonly"),l.attr("class","wheel_col wheel_col-dynamic_coupon")}})),e(".wlwl_color_palette").on("click",(function(){let t=e(this).data("color_code"),l=[],o=e(".color_palette").data("color_arr")[t];o?.pointer&&e("#pointer_color").val(o.pointer).trigger("change"),e("#wheel_wrap_bg_color").val(t).trigger("change"),o?.color&&o.color.length&&(l=o.color);let n,a=e(".wheel_col").find('input[name="bg_color[]"]').map((function(){return e(this).val()})).get(),i=l.length,c=a.length,r=0;for(n=0;n<c;n++)r==i&&(r=0),e(".wheel_col").find('input[name="bg_color[]"]').eq(n).val(l[r]).css({"background-color":l[r]}),r++;e(".auto_color_ok").on("click",(function(){e(".color_palette").hide(),e(".auto_color_ok_cancel").hide(),e(".auto_color").show()})),e(".auto_color_cancel").on("click",(function(){for(r=0,n=0;n<c;n++)r==i&&(r=0),$wheel_col.find('input[name="bg_color[]"]').eq(n).val(a[r]).css({"background-color":a[r]}),r++;e(".color_palette").hide(),e(".auto_color_ok_cancel").hide(),e(".auto_color").show()}))})),e(".auto_color").on("click",(function(){e(".color_palette").css({display:"flex"}),e(".auto_color_ok_cancel").css({display:"inline-block"}),e(this).hide(),e(".auto_color_ok").on("click",(function(){e(".color_palette").hide(),e(".auto_color_ok_cancel").hide(),e(".auto_color").show()})),e(".auto_color_cancel").on("click",(function(){e(".color_palette").hide(),e(".auto_color_ok_cancel").hide(),e(".auto_color").show()}))})),e(".wlwl-button-save-settings-container").closest("form").on("submit",(function(){let t=e(".custom_type_label"),l=e('select[name="coupon_type[]"]');for(let o=0;o<t.length;o++){if(""===t.eq(o).val())return alert("Label cannot be empty."),t.eq(o).focus(),!1;if("custom"===l.eq(o).val()&&""===e(".custom_type_value").eq(o).val())return alert("Value cannot be empty."),e(".custom_type_value").eq(o).focus(),!1;if("existing_coupon"===l.eq(o).val()&&""==e('select[name="wlwl_existing_coupon[]"]')[o].lastElementChild.innerHTML)return alert("Value of Existing coupon cannot be empty."),e('select[name="wlwl_existing_coupon[]"]')[o].focus(),!1}e(".wlwl-button-save-settings-container").find("button").addClass("loading")}))})),jQuery(document).ready((function(e){var t,l=e("#wlwl-bg-image"),o=l.find(".wlwl-upload-custom-img"),n=l.find(".wlwl-image-container");function a(t){parseInt(t)?(e(".wheel_wrap_bg_image_custom").show(),e(".wlwl-remove-image").length?e(".wlwl-upload-custom-img").hide():e(".wlwl-upload-custom-img").show()):(e(".wheel_wrap_bg_image_custom").hide(),e(".wheel_wrap_bg_image").val(woo_lucky_wheel_params_admin.bg_img_default),n.find(".review-images").attr({src:woo_lucky_wheel_params_admin.bg_img_default}))}e(".wheel_wrap_bg_image_custom").css("margin-top","15px"),e(".wheel_wrap_bg_image_type").dropdown({onChange:function(e){a(e)}}),a(e(".wheel_wrap_bg_image_type select").val()),o.on("click",(function(l){l.preventDefault(),t||(t=wp.media({title:"Select or Upload Media Of Your Chosen Persuasion",button:{text:"Use this media"},multiple:!1})).on("select",(function(){var l,o=t.state().get("selection").first().toJSON();console.log(o),o.sizes.thumbnail?l=o.sizes.thumbnail.url:o.sizes.medium?l=o.sizes.medium.url:o.sizes.large?l=o.sizes.large.url:o.url&&(l=o.url),n.html('<img style="width: 300px;background:'+e("#wheel_wrap_bg_color").val()+'"class="review-images" src="'+l+'"/><input class="wheel_wrap_bg_image" name="wheel_wrap_bg_image" type="hidden" value="'+o.id+'"/><span class="wlwl-remove-image negative vi-ui button">Remove</span>'),e(".wlwl-upload-custom-img").hide()})),t.open()})),e(document).on("click",".wlwl-remove-image",(function(t){t.preventDefault(),e(this).parent().html(""),e(".wlwl-upload-custom-img").show()}))})),jQuery(document).ready((function(e){var t,l=e("#wlwl-bg-image1"),o=l.find(".wlwl-upload-custom-img1"),n=l.find("#wlwl-new-image1");o.on("click",(function(l){l.preventDefault(),t||(t=wp.media({title:"Select or Upload Media Of Your Chosen Persuasion",button:{text:"Use this media"},multiple:!1})).on("select",(function(){var l,o=t.state().get("selection").first().toJSON();console.log(o),o.sizes.thumbnail?l=o.sizes.thumbnail.url:o.sizes.medium?l=o.sizes.medium.url:o.sizes.large?l=o.sizes.large.url:o.sizes.full?l=o.sizes.full.url:o.url&&(l=o.url),n.append('<div class="wlwl-image-container1"><img style="border: 1px solid;"class="review-images" src="'+l+'"/><input class="wheel_center_image" name="wheel_center_image" type="hidden" value="'+o.id+'"/><span class="wlwl-remove-image1 nagative vi-ui button">Remove</span></div>'),e(".wlwl-upload-custom-img1").hide(),e(".wlwl-remove-image1").on("click",(function(t){t.preventDefault(),e(this).parent().html(""),e(".wlwl-upload-custom-img1").show()}))})),t.open()})),e(".wlwl-remove-image1").on("click",(function(t){t.preventDefault(),e(this).parent().html(""),e(".wlwl-upload-custom-img1").show()})),e(".suggested-product-search").select2({placeholder:"Please fill in your product title",ajax:{url:"admin-ajax.php?action=wlwl_search_suggested_product",dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(e){return{keyword:e.term}},processResults:function(e){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1}),e(".category-search").select2({placeholder:"Please enter category title",ajax:{url:"admin-ajax.php?action=wlwl_search_cate",dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(e){return{keyword:e.term}},processResults:function(e){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1}),e(".product-search").select2({closeOnSelect:!1,placeholder:"Please fill in your product title",ajax:{url:"admin-ajax.php?action=wlwl_search_product",dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(e){return{keyword:e.term}},processResults:function(e){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1}),e(".coupon-search").select2({placeholder:"Type coupon code here",ajax:{url:"admin-ajax.php?action=wlwl_search_coupon",dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(e){return{keyword:e.term}},processResults:function(e){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1}),e(".wlwl-ac-search-list").select2({placeholder:"Type list name",ajax:{url:"admin-ajax.php?action=wlwl_search_active_campaign_list",dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(e){return{keyword:e.term}},processResults:function(e){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1,allowClear:!0}),e("#wlwl-google-font-select").fontselect().change((function(){e("#wlwl-google-font-select").val(e(this).val()),e(".wlwl-google-font-select-remove").show()})),e(".wlwl-google-font-select-remove").on("click",(function(){e(this).parent().find(".font-select span").html("<span>Select a font</span>"),e("#wlwl-google-font-select").val(""),e(this).hide()}));var a=e(".wlwl-button-shop-now");e("#wlwl_button_shop_title").on("keyup",(function(){a.html(e(this).val())})),e("#wlwl_button_shop_url").on("keyup",(function(){a.attr("href",e(this).val())})),e("#wlwl_button_shop_size").on("change",(function(){a.css("font-size",e(this).val()+"px")})),e("#wlwl_button_shop_color").iris({change:function(t,l){e(this).parent().find(".color-picker").css({backgroundColor:l.color.toString()}),a.css({color:l.color.toString()})},hide:!0,border:!0}).click((function(t){t.stopPropagation(),e(".iris-picker").hide(),e(this).closest("td").find(".iris-picker").show()})),e("#wlwl_button_shop_bg_color").iris({change:function(t,l){e(this).parent().find(".color-picker").css({backgroundColor:l.color.toString()}),a.css({"background-color":l.color.toString()})},hide:!0,border:!0}).click((function(t){t.stopPropagation(),e(".iris-picker").hide(),e(this).closest("td").find(".iris-picker").show()})),e(".preview-emails-html-overlay").on("click",(function(){e(".preview-emails-html-container").addClass("preview-html-hidden")})),e(".wlwl-preview-emails-button").on("click",(function(){let t=e(this),l=t.html();t.html("Please wait...");let o=t.data().wlwl_language,n=e("#wlwl_suggested_products").val();e.ajax({url:woo_lucky_wheel_params_admin.url,type:"GET",dataType:"JSON",data:{action:"wlwl_preview_emails",heading:e("#heading"+o).val(),footer_text:e("#footer_text"+o).val(),content:tinyMCE.get("content"+o)?tinyMCE.get("content"+o).getContent():e("#content"+o).val(),button_shop_size:e("#wlwl_button_shop_size").val(),button_shop_color:e("#wlwl_button_shop_color").val(),button_shop_bg_color:e("#wlwl_button_shop_bg_color").val(),button_shop_title:e("#wlwl_button_shop_title"+o).val(),button_shop_url:e("#wlwl_button_shop_url"+o).val(),suggested_products:n||[]},success:function(o){t.html(l),o&&(e(".preview-emails-html").html(o.html),e(".preview-emails-html-container").removeClass("preview-html-hidden"))},error:function(e){t.html(l)}})})),e(".woocommerce-lucky-wheel-preview-overlay").on("click",(function(){e(".woocommerce-lucky-wheel-preview").addClass("preview-html-hidden")})),e(".preview-lucky-wheel").on("click",(function(){e(this).addClass("loading");let t=[];e('input[name="prize_quantity[]"]').map((function(){t.push(e(this).val())}));let l=[];e('input[name="bg_color[]"]').map((function(){l.push(e(this).val())}));let o=[];e('input[name="slices_text_color[]"]').map((function(){o.push(e(this).val())}));let n=[];e('input[name="custom_type_label[]"]').map((function(){n.push(e(this).val())}));let a=[];e('select[name="coupon_type[]"]').map((function(){a.push(e(this).val())}));let i=[];e('input[name="coupon_amount[]"]').map((function(){i.push(e(this).val())})),e.ajax({url:woo_lucky_wheel_params_admin.url,type:"GET",dataType:"JSON",data:{action:"wlwl_preview_wheel",label:n,coupon_type:a,coupon_amount:i,prize_quantity:t,quantity_label:e('input[name="quantity_label"]').val()},success:function(t){e(".preview-lucky-wheel").removeClass("loading");let n=e("#font_size").val(),a=e("#wheel_center_color").val(),i=e("#wheel_border_color").val(),c=e("#wheel_dot_color").val(),r=l.length,s=360/r,u=-s/2,p=document.getElementById("wlwl_canvas"),d=p.getContext("2d"),h=400;p.width=h,p.height=h;let w=200,_=parseInt(h/28)*parseInt(n)/100;if(t.labels){let n=t.labels;for(let e=0;e<r;e++)f(d,u,l[e]),v(d,u+s/2,n[e],o[e],_),u+=s;p=document.getElementById("wlwl_canvas1"),d=p.getContext("2d"),p.width=h,p.height=h,function(e,t,l){e.save(),e.beginPath(),e.fillStyle=l,e.shadowBlur=1,e.shadowOffsetX=8,e.shadowOffsetY=8,e.shadowColor="rgba(0,0,0,0.2)",e.arc(w,w,50,0,2*Math.PI),e.fill(),e.clip(),e.restore()}(d,0,a);let m=e('input[name="wheel_center_image"]').parent().find("img").attr("src");if(m){let e=new Image;e.onload=function(){p=document.getElementById("wlwl_canvas1"),d=p.getContext("2d");d.arc(w,w,43,0,2*Math.PI),d.clip(),d.drawImage(e,157,157,86,86)},e.src=m}g(d,i,"rgba(0,0,0,0)",20,4,5,"rgba(0,0,0,0.2)"),p=document.getElementById("wlwl_canvas2"),d=p.getContext("2d"),p.width=h,p.height=h,g(d,"rgba(0,0,0,0)",c,20,4,5,"rgba(0,0,0,0)"),e(".woocommerce-lucky-wheel-preview").removeClass("preview-html-hidden")}function m(e){return e*Math.PI/180}function f(e,t,l){let o;e.beginPath(),e.fillStyle=l,e.moveTo(w,w),o=190,e.arc(w,w,o,m(t),m(t+s)),e.lineTo(w,w),e.fill()}function g(e,t,l,o,n,a,i){let c,u,p;e.beginPath(),e.strokeStyle=t,e.lineWidth=o,e.shadowBlur=1,e.shadowOffsetX=8,e.shadowOffsetY=8,e.shadowColor=i,e.arc(w,w,w,0,2*Math.PI),e.stroke(),p=s/2;let d=w-a;for(let t=0;t<r;t++)e.beginPath(),e.fillStyle=l,c=w+d*Math.cos(p*Math.PI/180),u=w-d*Math.sin(p*Math.PI/180),e.arc(c,u,n,0,2*Math.PI),e.fill(),p+=s}function v(e,t,l,o,n){let a=175;e.save(),e.translate(w,w),e.rotate(m(t)),e.textAlign="right",e.fillStyle=o,e.font="200 "+n+"px Helvetica",e.shadowOffsetX=0,e.shadowOffsetY=0;let i=(l=(l=l.replace(/&#(\d{1,4});/g,(function(e,t){return String.fromCharCode(t)}))).replaceAll(/&nbsp;/g," ")).split("/n"),c="",r="",s="";if(i.length>1?(c=i[0],i.length>2?r=i[1]:(r=i.splice(1,i.length-1),r=r.join("")),s=i.splice(2,i.length-1),s=s.join("")):(i=l.split("\\n"),i.length>1&&(c=i[0],r=i.splice(1,i.length-1),r=r.join(""),s=i.splice(2,i.length-2),s=s.join(""))),""!==c.trim()&&""!==r.trim()&&""===s.trim())e.fillText(c.trim(),a,-1*n/4),e.fillText(r.trim(),a,3*n/4);else if(""!==c.trim()&&""!==r.trim()&&""!==s.trim())e.fillText(c.trim(),a,-1*n/2),e.fillText(r.trim(),a,1*n/2),e.fillText(s.trim(),a,1.5*n);else{let t=function(e,t,l,o,n,a){let i=t.split(" "),c=i.length,r="",s="",u=[],p=[];for(let t in i){s+=`${i[t]} `,e.measureText(s).width>n&&t>0?(u.push({text:r,x:l,y:o}),r=`${i[t]} `,s=`${i[t]} `):r+=`${i[t]} `,t==c-1&&u.push({text:r,x:l,y:o})}let d=o/2-2,h=u.length;h>4?d=-o:h>2?d=-1*o/2:h>1&&(d=-1*o/4);for(let e in u){let t=u[e];e>0&&(d+=a),t.y=d,p.push(t)}return p}(e,l=l.replace(/\\n/g,"").replace(/\/n/g,""),a,n,h/3-10,n);for(let l of t)e.fillText(l.text,l.x,l.y)}e.restore()}},error:function(t){e(".wlwl-preview-emails-button").html("Preview emails"),e(".preview-lucky-wheel").removeClass("loading")}})})),jQuery(".villatheme-get-key-button").one("click",(function(e){let t=jQuery(this);t.addClass("loading");let l,o=t.data(),n=o.id,a=o.href,i=window.location.hostname;i=i.toLowerCase(),e.preventDefault();t.attr("data-download");l=window.open(a,"myWindow","width=380,height=600"),window.addEventListener("message",(function(e){let l=JSON.parse(e.data),o="",a=l.message,c="",r="";if(l.data.length>0){for(let e=0;e<l.data.length;e++)if(l.data[e].id==n&&(l.data[e].domain==i||""==l.data[e].domain||null==l.data[e].domain)&&((""==o||c<l.data[e].support_until)&&(o=l.data[e].download_key,c=l.data[e].support_until),l.data[e].domain==i)){o=l.data[e].download_key;break}o&&(r=1,jQuery(".villatheme-autoupdate-key-field").val(o))}t.removeClass("loading"),r?(jQuery("<p><strong>"+a+"</strong></p>").insertAfter(".villatheme-autoupdate-key-field"),jQuery(t).closest("form").submit()):jQuery("<p><strong> Your key is not found. Please contact support@villatheme.com </strong></p>").insertAfter(".villatheme-autoupdate-key-field")}))}))}));