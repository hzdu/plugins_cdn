(function($){$('.automatorwp-selector select').each(function(){automatorwp_selector($(this))});$('.automatorwp-post-selector select').each(function(){automatorwp_post_selector($(this))});$('.automatorwp-term-selector select').each(function(){automatorwp_term_selector($(this))});$('.automatorwp-taxonomy-selector select').each(function(){automatorwp_selector($(this))});$('.automatorwp-user-selector select').each(function(){automatorwp_user_selector($(this))});$('.automatorwp-object-selector select').each(function(){automatorwp_object_selector($(this))});$('.automatorwp-ajax-selector select').each(function(){automatorwp_ajax_selector($(this))});$('.automatorwp-filter-selector select').each(function(){automatorwp_filter_selector($(this))});automatorwp_update_items_position($('.automatorwp-automation-items.automatorwp-triggers'));automatorwp_update_items_position($('.automatorwp-automation-items.automatorwp-actions'));$('body').on('click','.automatorwp-save-and-activate input',function(e){e.preventDefault();if($('select#status').length){$('select#status').val('active')}else if($('input#status1').length){$('input#status1').prop('checked',!0);$('input#status2').prop('checked',!1)}
$('#ct-save').trigger('click')});$('body').on('mouseover','.automatorwp-tooltip',function(e){$(this).prev('.cmb2-metabox-description').addClass('automatorwp-tooltip-dialog').fadeIn('fast')});$('body').on('mouseout','.automatorwp-tooltip',function(e){$(this).prev('.cmb2-metabox-description').fadeOut('fast')});$('.automatorwp-automation-items').sortable({cursor:'grabbing',cancel:'.automatorwp-option-form-container, .automatorwp-no-grab',update:function(e,ui){automatorwp_update_items_position($(e.target))},stop:function(e,ui){ui.item.find('.cmb-type-wysiwyg').each(function(){var $this=$(this);var textarea_id=$this.find('textarea').attr('id');var textarea=$this.find('textarea').clone();$this.find('.wp-editor-wrap').remove();$this.find('.cmb-td').append(textarea);automatorwp_initialize_wysiwyg_editor(textarea_id)});if('undefined'!==typeof window.QTags){window.QTags._buttonsInit()}}});$('body').on('click','.automatorwp-toggleable-options-list-toggle',function(e){e.preventDefault();var $this=$(this);var show_text=$this.data('show-text');var hide_text=$this.data('hide-text');var list=$this.closest('.cmb-td').find('.automatorwp-toggleable-options-list');if($this.text()===show_text){$this.text(hide_text);list.slideDown('fast')}else{$this.text(show_text);list.slideUp('fast')}});$('body').on('change','input#sequential',function(e){var selector='.automatorwp-triggers .automatorwp-automation-item:not(.automatorwp-automation-item-filter) .automatorwp-automation-item-position';if($(this).prop('checked')){$(selector).show()}else{$(selector).hide()}});$('body').on('click','.automatorwp-automation-item-action-move-up, .automatorwp-automation-item-action-move-down',function(e){var item=$(this).closest('.automatorwp-automation-item');var items_list=$(this).closest('.automatorwp-automation-items');var direction=($(this).hasClass('automatorwp-automation-item-action-move-up')?'up':'down');var sibling_item;if(direction==='up'){sibling_item=item.prev('.automatorwp-automation-item')}else{sibling_item=item.next('.automatorwp-automation-item')}
if(!sibling_item.length){return}
if(direction==='up'){$('#'+item.attr('id')).insertBefore('#'+sibling_item.attr('id'))}else{$('#'+item.attr('id')).insertAfter('#'+sibling_item.attr('id'))}
automatorwp_update_items_position(items_list)});$('body').on('click','.automatorwp-automation-item-action-delete',function(e){var item=$(this).closest('.automatorwp-automation-item');var items_list=$(this).closest('.automatorwp-automation-items');var item_type=item.hasClass('automatorwp-trigger')?'trigger':'action';var id=item.find('input.id').val();item.slideUp('fast',function(){item.remove();automatorwp_update_items_position(items_list)});if(item_type==='trigger'&&$('body.edit-anonymous-automation').length){$('<div class="automatorwp-automation-item automatorwp-trigger" style="display: none;">'+$('#automatorwp_triggers').find('.automatorwp-add-item-form').html()+'</div>').appendTo('.automatorwp-triggers').slideDown('fast')}
$.ajax({url:ajaxurl,method:'POST',data:{action:'automatorwp_delete_automation_item',nonce:automatorwp_admin.nonce,id:id,item_type:item_type},success:function(response){if(response.success){if(item_type==='trigger'){$('.automatorwp-automation-tag-selector optgroup[data-id="'+id+'"]').remove()}}else{}},error:function(response){}})});if($('body.edit-anonymous-automation').length){if($('#automatorwp_triggers .automatorwp-automation-item').length===0){$('<div class="automatorwp-automation-item automatorwp-trigger">'+$('#automatorwp_triggers').find('.automatorwp-add-item-form').html()+'</div>').appendTo('.automatorwp-triggers')}
$('.automatorwp-add-trigger').remove();$('#automatorwp_triggers .automatorwp-add-filter').remove();$('.automatorwp-sequential-field').remove();$('#cmb-field-js-controls-times_per_user-before').remove();$('.cmb2-id-times-per-user').remove();$('#cmb-field-js-controls-times_per_user-after').remove()}else{$('.automatorwp-automation-ui-anonymous-notice').remove()}
$('body').on('click','.automatorwp-action-automatorwp-anonymous-user .automatorwp-anonymous-user-choice',function(e){var item=$(this).closest('.automatorwp-automation-item');var option_form=item.find('.automatorwp-option-form-container[data-option="user"]');var choice=$(this).data('choice');option_form.find('.cmb2-id-run-actions-on select').val(choice).trigger('change');$(this).closest('.automatorwp-anonymous-user-choices').slideUp('fast');option_form.addClass('automatorwp-option-form-active').slideDown('fast')});$('body').on('click','.automatorwp-action-automatorwp-anonymous-user .automatorwp-anonymous-user-change-button',function(e){var item=$(this).closest('.automatorwp-automation-item');$(this).closest('.automatorwp-anonymous-user-resume').slideUp('fast');item.find('.automatorwp-anonymous-user-choices').slideDown('fast')});$('body').on('click','.automatorwp-action-automatorwp-anonymous-user .automatorwp-anonymous-user-resume strong',function(e){var item=$(this).closest('.automatorwp-automation-item');var option_form=item.find('.automatorwp-option-form-container[data-option="user"]');option_form.find('.cmb2-id-run-actions-on select').trigger('change');$(this).closest('.automatorwp-anonymous-user-resume').slideUp('fast');option_form.addClass('automatorwp-option-form-active').slideDown('fast')});$('body').on('change','.automatorwp-action-automatorwp-anonymous-user .cmb2-id-run-actions-on select',function(e){var choice=$(this).val();var form=$(this).closest('.cmb2-metabox');var target=undefined;var checked=undefined;if(choice==='existing_user'){checked=form.find('.cmb2-id-existing-user-not-exists input:checked');if(checked.length&&checked.val()==='new_user'){target=undefined;form.find('> .cmb-row').show();form.find('.cmb2-id-run-actions-on,'+'.cmb2-id-new-user-exists,'+' .cmb2-id-new-user-search-field').hide()}else{target=form.find('.cmb2-id-search-field,'+' .cmb2-id-search-field-value,'+' .cmb2-id-existing-user-not-exists')}}else if(choice==='new_user'){checked=form.find('.cmb2-id-new-user-exists input:checked');if(checked.length&&checked.val()==='existing_user'){target=form.find('.cmb2-id-user-login,'+' .cmb2-id-user-email,'+' .cmb2-id-first-name,'+' .cmb2-id-last-name,'+' .cmb2-id-user-url,'+' .cmb2-id-user-pass,'+' .cmb2-id-role,'+' .cmb2-id-send-user-notification,'+' .cmb2-id-user-meta,'+' .cmb2-id-new-user-exists,'+' .cmb2-id-new-user-search-field')}else{target=form.find('.cmb2-id-user-login,'+' .cmb2-id-user-email,'+' .cmb2-id-first-name,'+' .cmb2-id-last-name,'+' .cmb2-id-user-url,'+' .cmb2-id-user-pass,'+' .cmb2-id-role,'+' .cmb2-id-send-user-notification,'+' .cmb2-id-user-meta,'+' .cmb2-id-new-user-exists')}}
if(target!==undefined){form.find('> .cmb-row').hide();target.show()}});$('body').on('change','.automatorwp-action-automatorwp-anonymous-user .cmb2-id-existing-user-not-exists input',function(e){var $this=$(this);var fields=$this.closest('.cmb2-metabox').find('.cmb2-id-user-login,'+' .cmb2-id-user-email,'+' .cmb2-id-first-name,'+' .cmb2-id-last-name,'+' .cmb2-id-user-url,'+' .cmb2-id-user-pass,'+' .cmb2-id-role,'+' .cmb2-id-send-user-notification,'+' .cmb2-id-user-meta');if($this.prop('checked')&&$this.val()==='new_user'){fields.slideDown('fast')}else{fields.slideUp('fast')}});$('body').on('change','.automatorwp-action-automatorwp-anonymous-user .cmb2-id-new-user-exists input',function(e){var $this=$(this);var fields=$this.closest('.cmb2-metabox').find('.cmb2-id-new-user-search-field');if($this.prop('checked')&&$this.val()==='existing_user'){fields.slideDown('fast')}else{fields.slideUp('fast')}});$('body').on('click','.automatorwp-action-automatorwp-anonymous-user .automatorwp-cancel-option-form',function(e){var item=$(this).closest('.automatorwp-automation-item');var option_form=item.find('.automatorwp-option-form-container[data-option="user"]');$('.automatorwp-anonymous-user-choices').slideDown('fast');option_form.find('.cmb2-id-run-actions-on select').val('').trigger('change')});$('body').on('click','.automatorwp-add-trigger, .automatorwp-add-action',function(e){e.preventDefault();var type=$(this).hasClass('automatorwp-add-trigger')?'trigger':'action';$('<div class="automatorwp-automation-item automatorwp-'+type+'" style="display: none;">'+$(this).closest('.inside').find('.automatorwp-add-item-form').html()+'</div>').appendTo('.automatorwp-'+type+'s').slideDown('fast')});$('body').on('click','.automatorwp-automation-item .automatorwp-select-integration .automatorwp-integration',function(e){e.preventDefault();var item=$(this).closest('.automatorwp-automation-item');var select=item.find('.automatorwp-integration-choices[data-integration="'+$(this).data('integration')+'"]');item.find('.automatorwp-select-integration').hide();item.find('.automatorwp-automation-item-details .automatorwp-integration-icon').append('<img src="'+$(this).data('icon')+'" />');item.find('.automatorwp-automation-item-content').prepend('<div class="automatorwp-integration-label">'+$(this).data('label')+'</div>');select.show();item.find('.automatorwp-integration-choices-container').show();$('<div class="automatorwp-select2-dropdown-container"></div>').insertAfter(select);var dropdown_container=select.next('.automatorwp-select2-dropdown-container');select.automatorwp_select2({theme:'default automatorwp-select2',placeholder:select.data('placeholder'),allowClear:!1,multiple:!1,closeOnSelect:!1,dropdownParent:dropdown_container,escapeMarkup:function(markup){return markup},templateResult:function(data){var text=data.text;if(data.element!==undefined){var custom_text=$(data.element).data('text');if(custom_text!==undefined&&custom_text.length){text=custom_text}}
return text},templateSelection:function(data){return data.text}}).on('select2:open',function(e){dropdown_container.find('input.select2-search__field').attr('placeholder',select.data('placeholder'))}).on('select2:closing',function(e){e.preventDefault()}).on('select2:closed',function(e){select.select2('open')}).on('select2:selecting',function(e){if(select.prop('disabled')){e.preventDefault()}});select.automatorwp_select2('open')});$('body').on('change','.automatorwp-automation-item .automatorwp-integration-choices',function(e){e.preventDefault();if($(this).prop('disabled')){return}
var item=$(this).closest('.automatorwp-automation-item');var items_list=item.closest('.automatorwp-automation-items');var automation_id=$('input#object_id').val();var type=$(this).val();var item_type=item.hasClass('automatorwp-trigger')?'trigger':'action';if(!type.length){return}
var last_position=items_list.find('.automatorwp-automation-item input.position').last();var position=0;if(last_position.length){position=parseInt(last_position.val())+1}else{position=parseInt(items_list.find('.automatorwp-automation-item').length-1)}
$(this).prop('disabled',!0);item.find('.automatorwp-spinner').show();$.ajax({url:ajaxurl,method:'POST',data:{action:'automatorwp_add_automation_item',nonce:automatorwp_admin.nonce,automation_id:automation_id,item_type:item_type,type:type,position:position},success:function(response){if(response.success){item.remove();var new_item=$(response.data.edit_html);new_item.appendTo(items_list);if(item_type==='trigger'&&$('#sequential').prop('checked')){automatorwp_update_items_position(items_list);items_list.find('.automatorwp-automation-item:not(.automatorwp-automation-item-filter) .automatorwp-automation-item-position').show()}
if(item_type==='trigger'&&response.data.tags_html.length){$(response.data.tags_html).appendTo('.automatorwp-automation-tag-selector')}
automatorwp_initialize_form_fields(new_item)}else{}},error:function(response){}})});$('body').on('click','.automatorwp-automation-item .automatorwp-cancel-choice-select',function(e){e.preventDefault();var item=$(this).closest('.automatorwp-automation-item');var type=(item.hasClass('automatorwp-trigger')?'trigger':'action');if(type==='trigger'&&$('body.edit-anonymous-automation').length){item.find('.automatorwp-select-integration').show();item.find('.automatorwp-automation-item-details .automatorwp-integration-icon img').remove();item.find('.automatorwp-automation-item-content .automatorwp-integration-label').remove();item.find('.automatorwp-integration-choices-container').hide();$('.automatorwp-select2-dropdown-container').remove();return}
item.slideUp('fast',function(){item.remove()})});$('body').on('click','.automatorwp-recommended-integrations-label a',function(e){e.preventDefault();$(this).closest('.automatorwp-recommended-integrations').find('.automatorwp-integrations').slideToggle('fast')});$('body').on('click','.automatorwp-add-filter',function(e){var button=$(this);var box=button.closest('.postbox');var items_list=box.find('.automatorwp-automation-items');var automation_id=$('input#object_id').val();var item_type=(box.attr('id')==='automatorwp_triggers'?'trigger':'action');var type='filter';var last_position=items_list.find('.automatorwp-automation-item input.position').last();var position=0;if(last_position.length){position=parseInt(last_position.val())+1}else{position=parseInt(items_list.find('.automatorwp-automation-item').length-1)}
button.prop('disabled',!0);box.find('.automatorwp-box-spinner').show();$.ajax({url:ajaxurl,method:'POST',data:{action:'automatorwp_add_automation_item',nonce:automatorwp_admin.nonce,automation_id:automation_id,item_type:item_type,type:type,position:position},success:function(response){button.prop('disabled',!1);box.find('.automatorwp-box-spinner').hide();if(response.success){var new_item=$(response.data.edit_html);new_item.appendTo(items_list);if(item_type==='trigger'&&$('#sequential').prop('checked')){automatorwp_update_items_position(items_list);items_list.find('.automatorwp-automation-item:not(.automatorwp-automation-item-filter) .automatorwp-automation-item-position').show()}
if(item_type==='trigger'&&response.data.tags_html.length){$(response.data.tags_html).appendTo('.automatorwp-automation-tag-selector')}
automatorwp_initialize_form_fields(new_item)}else{}},error:function(response){}})});$('body').on('click','.automatorwp-automation-item-label > .automatorwp-option',function(e){var item=$(this).closest('.automatorwp-automation-item');var option=$(this).data('option');var option_form=item.find('.automatorwp-option-form-container[data-option="'+option+'"]');if(option_form.hasClass('automatorwp-option-form-active')){option_form.removeClass('automatorwp-option-form-active').slideUp('fast')}else{item.find('.automatorwp-option-form-active').removeClass('automatorwp-option-form-active').slideUp('fast');option_form.addClass('automatorwp-option-form-active').slideDown('fast')}});$('body').on('click','.automatorwp-save-option-form',function(e){var button=$(this);if(button.prop('disabled')){return}
var item=button.closest('.automatorwp-automation-item');var form=button.closest('.automatorwp-option-form-container');var id=item.find('input.id').val();var item_type=item.hasClass('automatorwp-trigger')?'trigger':'action';form.find('.automatorwp-spinner').show();button.prop('disabled',!0);button.next('.automatorwp-cancel-option-form').prop('disabled',!0);var data=automatorwp_get_option_form_values(form);data.action='automatorwp_update_item_option';data.nonce=automatorwp_admin.nonce;data.id=id;data.item_type=item_type;data.option_name=form.data('option');$.ajax({url:ajaxurl,method:'POST',data:data,success:function(response){if(response.success){form.removeClass('automatorwp-option-form-active').slideUp('fast');if(response.data.item_html!==undefined){if(item.hasClass('automatorwp-automation-item-filter')&&item.data('update-content')==='true'){var item_content=$(response.data.item_html).filter('.automatorwp-automation-item').find('.automatorwp-automation-item-content').html();item.find('.automatorwp-automation-item-content').html(item_content);automatorwp_initialize_form_fields(item);item.data('update-content','false')}}
item.find('.automatorwp-automation-item-label').html(response.data.edit_html);if(item_type==='trigger'){$('.automatorwp-automation-tag-selector optgroup[data-id="'+id+'"]').attr('label',response.data.edit_html);if(response.data.tags_html.length){$('.automatorwp-automation-tag-selector optgroup[data-id="'+id+'"]').html($(response.data.tags_html).html());$('.automatorwp-automation-tag-selector').each(function(){$(this).automatorwp_select2('destroy');automatorwp_tags_selector($(this))})}}}
form.find('.automatorwp-spinner').hide();button.prop('disabled',!1);button.next('.automatorwp-cancel-option-form').prop('disabled',!1)},error:function(response){}})});$('body').on('click','.automatorwp-cancel-option-form',function(e){$(this).closest('.automatorwp-option-form-container').removeClass('automatorwp-option-form-active').slideUp('fast')});$('body').on('change','.automatorwp-automation-item-filter .cmb2-id-filter select',function(e){var item=$(this).closest('.automatorwp-automation-item-filter');item.data('update-content','true')});$('body').on('change','.automatorwp-option-form input[type="radio"]',function(e){$(this).closest('ul').find('input[type="radio"]:not([value="'+$(this).val()+'"])').prop('checked',!1)});$('body').on('click','.automatorwp-option-form input[type="radio"] + label',function(e){e.preventDefault();$(this).prev('input').prop('checked',!0).trigger('change')});$('body').on('click','.automatorwp-option-form input[type="checkbox"] + label',function(e){e.preventDefault();$(this).prev('input').prop('checked',(!$(this).prev('input').prop('checked'))).trigger('change')});$('.automatorwp-option-form .cmb-repeat-table').each(function(){var item_id=$(this).closest('.automatorwp-automation-item').find('input.id').val();var new_id=$(this).attr('id')+'-'+item_id;$(this).attr('id',new_id);$(this).parent().find('.cmb-add-row-button').attr('data-selector',new_id)});$('.automatorwp-option-form .cmb-repeatable-group').each(function(){var item_id=$(this).closest('.automatorwp-automation-item').find('input.id').val();var new_id=$(this).attr('id')+'-'+item_id;$(this).attr('id',new_id);$(this).find('.cmb-add-group-row').attr('data-selector',new_id);$(this).find('.cmb-remove-group-row').attr('data-selector',new_id)});$('body').on('cmb2_add_row','.cmb-repeatable-group',function(e,row,cmb){row.find('.select2').remove();var select2_elements=row.find('.select2-hidden-accessible');select2_elements.find('optgroup, option').removeAttr('id').removeAttr('data-select2-id');select2_elements.removeClass('select2-hidden-accessible').removeAttr('id').removeAttr('data-select2-id');automatorwp_initialize_form_fields(row)});$('.automatorwp-automation-tag-selector').each(function(){automatorwp_tags_selector($(this))});$('body').on('focus','.automatorwp-action input, .automatorwp-action textarea',function(e){$(this).data('focused',!0)});$('body').on('change','.automatorwp-automation-tag-selector',function(e){var $this=$(this);var input=$this.parent().find('input, textarea');var value=$this.val();if(value&&value.length){value='{'+value+'}';if($this.closest('.cmb-row').hasClass('cmb-type-wysiwyg')){input=$this.parent().find('textarea.wp-editor-area');var editor=window.tinyMCE.get(input.attr('id'));if(editor&&!editor.isHidden()){editor.execCommand('mceInsertContent',!1,value);return}else if(typeof QTags!=='undefined'){QTags.insertContent(value);return}}
if(input.data('focused')!==!0){automatorwp_set_caret_at_end(input)}
automatorwp_insert_at_caret(input,value);$this.val(null).trigger('change')}});$('body').on('click','.automatorwp-tags-select2 .select2-dropdown li[role="group"] > strong',function(e){$(this).next('ul').slideToggle('fast')});$('body').on('change','.automatorwp-taxonomy-selector select',function(e){var row=$(this).closest('.cmb-row');var term_row=row.next('.automatorwp-term-selector');if(term_row===undefined){return}
var taxonomy=$(this).val();var first_change=row.hasClass('is-option-change');if(taxonomy==='any'||taxonomy===''){if(first_change){term_row.hide()}else{term_row.slideUp('fast')}}else{var term_selector=term_row.find('select.select2-hidden-accessible');var taxonomy_label=automatorwp_get_taxonomy_label(taxonomy);if(!taxonomy_label.length){taxonomy_label='Category'}
term_selector.next('.select2').remove();term_selector.data('taxonomy',taxonomy);term_selector.data('placeholder',automatorwp_admin_functions.taxonomy_selector_placeholder_pattern.replace('%s',taxonomy_label.toLowerCase()));if(!first_change){term_selector.val('')}
term_selector.removeAttr('data-select2-id');automatorwp_term_selector(term_selector);if(first_change){term_row.show()}else{term_row.slideDown('fast')}}
row.removeClass('is-option-change')});$('body').on('click','.automatorwp-automation-item-label > .automatorwp-option',function(e){var item=$(this).closest('.automatorwp-automation-item');var option=$(this).data('option');var option_form=item.find('.automatorwp-option-form-container[data-option="'+option+'"]');var taxonomy_selector=option_form.find('.automatorwp-taxonomy-selector');if(taxonomy_selector!==undefined){taxonomy_selector.addClass('is-option-change');taxonomy_selector.find('select.select2-hidden-accessible').trigger('change')}});$('body').on('change','select',function(e){var row=$(this).closest('.cmb-row');var custom_input_row=row.next('.automatorwp-selector-custom-input');if(custom_input_row===undefined){return}
var first_change=row.hasClass('is-option-change');if($(this).val()==='custom'){if(first_change){custom_input_row.show()}else{custom_input_row.slideDown('fast')}}else{if(first_change){custom_input_row.hide()}else{custom_input_row.slideUp('fast')}}
row.removeClass('is-option-change')});$('body').on('click','.automatorwp-automation-item-label > .automatorwp-option',function(e){var item=$(this).closest('.automatorwp-automation-item');var option=$(this).data('option');var option_form=item.find('.automatorwp-option-form-container[data-option="'+option+'"]');var custom_input_row=option_form.find('.automatorwp-selector-custom-input');if(custom_input_row!==undefined){var selector_row=custom_input_row.prev('.cmb-row');if(selector_row!==undefined){selector_row.addClass('is-option-change');selector_row.find('select.select2-hidden-accessible').trigger('change')}}});$('.automatorwp-selector-custom-input').each(function(){var selector_row=$(this).prev('.cmb-row');if(selector_row.find('select').val()==='custom'){$(this).show()}});$('body').on('click','.automatorwp-dialog-cancel',function(e){var target=$(this).data('dialog');if(target.length){$('.'+target).dialog('close')}});$('body').on('click','a[href$="admin.php?page=add_automatorwp_automations"]',function(e){e.preventDefault();$('.automatorwp-automation-type-dialog').dialog({dialogClass:'automatorwp-dialog',closeText:'',show:{effect:'fadeIn',duration:200},hide:{effect:'fadeOut',duration:200},resizable:!1,height:'auto',width:600,modal:!0,draggable:!1,closeOnEscape:!1,})});$('body').on('click','.automatorwp-automation-type-dialog .automatorwp-automation-type',function(e){$('.automatorwp-automation-type-dialog .automatorwp-automation-type-selected').removeClass('automatorwp-automation-type-selected');$(this).addClass('automatorwp-automation-type-selected')});$('body').on('click','.automatorwp-automation-type-dialog .automatorwp-automation-type-dialog-confirm',function(e){var type='user';var selected=$('.automatorwp-automation-type-dialog .automatorwp-automation-type-selected');if(selected.length){type=selected.data('type')}
var url=window.location.href.split('admin.php')[0];window.location.href=url+'admin.php?page=add_automatorwp_automations&type='+type});var url_export_id=0;var url_export_url='';$('body').on('click','a.automatorwp-url-export-automation',function(e){e.preventDefault();url_export_id=automatorwp_get_url_param($(this).attr('href'),'id',0);url_export_url='';$('.automatorwp-automation-url-export-dialog input').val('');$('.automatorwp-automation-url-export-dialog .automatorwp-automation-url-export-dialog-url').hide();$('.automatorwp-automation-url-export-dialog .automatorwp-automation-url-export-dialog-input .automatorwp-notice-error').hide();$('.automatorwp-automation-url-export-dialog-confirm .automatorwp-automation-url-export-dialog-confirm-default-text').show();$('.automatorwp-automation-url-export-dialog-confirm .automatorwp-automation-url-export-dialog-confirm-generating-text').hide();$('.automatorwp-automation-url-export-dialog-confirm .automatorwp-automation-url-export-dialog-confirm-success-text').hide();$('.automatorwp-automation-url-export-dialog').dialog({dialogClass:'automatorwp-dialog',closeText:'',show:{effect:'fadeIn',duration:200},hide:{effect:'fadeOut',duration:200},resizable:!1,height:'auto',width:600,modal:!0,draggable:!1,closeOnEscape:!1,})});$('body').on('keypress','.automatorwp-automation-url-export-dialog-input input',function(e){var keycode=(e.keyCode?e.keyCode:e.which);if(parseInt(keycode)===13){$('.automatorwp-automation-url-export-dialog-confirm').trigger('click')}});$('body').on('click','.automatorwp-automation-url-export-dialog-confirm',function(e){var button=$(this);var dialog=button.closest('.automatorwp-automation-url-export-dialog');dialog.find('.automatorwp-automation-url-export-dialog-input .automatorwp-notice-error').slideUp('fast');if(button.find('.automatorwp-automation-url-export-dialog-confirm-success-text').is(":visible")){dialog.dialog('close');return}
if(button.prop('disabled')){return}
if(url_export_id===0){return}
var url=dialog.find('.automatorwp-automation-url-export-dialog-input input').val();if(!(url.includes('dev')||url.includes('127.0.0.')||url.includes('localhost')||url.includes(':8888'))){if(!automatorwp_is_valid_url(url)){dialog.find('.automatorwp-automation-url-export-dialog-input .automatorwp-notice-error').slideDown('fast');return}}
if(!url.startsWith('http')){url='https://'+url}
button.prop('disabled',!0);button.find('.automatorwp-automation-url-export-dialog-confirm-default-text').hide();button.find('.automatorwp-automation-url-export-dialog-confirm-generating-text').show();button.find('.automatorwp-automation-url-export-dialog-confirm-success-text').hide();$.ajax({url:ajaxurl,method:'POST',data:{action:'automatorwp_get_automation_export_url',nonce:automatorwp_admin.nonce,automation_id:url_export_id,},success:function(response){if(!url.endsWith('/')){url+='/'}
url_export_url=response.data;url+=url_export_url;var url_input=dialog.find('.automatorwp-automation-url-export-dialog-url input');url_input.val(url);dialog.find('.automatorwp-automation-url-export-dialog-url').slideDown('fast',function(){url_input.trigger('focus');url_input.trigger('select');url_input[0].setSelectionRange(0,99999)});button.prop('disabled',!1);button.find('.automatorwp-automation-url-export-dialog-confirm-default-text').hide();button.find('.automatorwp-automation-url-export-dialog-confirm-generating-text').hide();button.find('.automatorwp-automation-url-export-dialog-confirm-success-text').show()},error:function(response){button.prop('disabled',!1);button.find('.automatorwp-automation-url-export-dialog-confirm-default-text').show();button.find('.automatorwp-automation-url-export-dialog-confirm-generating-text').hide();button.find('.automatorwp-automation-url-export-dialog-confirm-success-text').hide()}})});$('body').on('click','.automatorwp-automation-url-export-dialog-url input',function(e){$(this).trigger('select');$(this)[0].setSelectionRange(0,99999)});$('body').on('click','.automatorwp-automation-url-export-dialog-url-copy',function(e){var input=$('.automatorwp-automation-url-export-dialog-url input');input.trigger('select');input[0].setSelectionRange(0,99999);document.execCommand("copy");$(this).find('.automatorwp-automation-url-export-dialog-url-copy-text-copy').hide();$(this).find('.automatorwp-automation-url-export-dialog-url-copy-text-copied').show()});$('body').on('change','#automatorwp-automations-execution-options input#schedule_run',function(e){var form=$(this).closest('.cmb2-metabox');var target=form.find('.cmb2-id-schedule-run-datetime');if($(this).prop('checked')){if(form.find('.cmb2-id-recurring-run input').prop('checked')){form.find('.cmb2-id-recurring-run input').prop('checked',!1).trigger('change')}
target.slideDown('fast')}else{target.slideUp('fast')}});if(!$('#automatorwp-automations-execution-options input#schedule_run').prop('checked')){$('#automatorwp-automations-execution-options .cmb2-id-schedule-run-datetime').hide()}
$('body').on('change','#automatorwp-automations-execution-options input#recurring_run',function(e){var form=$(this).closest('.cmb2-metabox');var target=form.find('.automatorwp-recurring-run-day-label, .cmb2-id-recurring-run-period, .cmb2-id-recurring-run-time');form.find('.cmb2-id-recurring-run-period select').trigger('change');if($(this).prop('checked')){if(form.find('.cmb2-id-schedule-run input').prop('checked')){form.find('.cmb2-id-schedule-run input').prop('checked',!1).trigger('change')}
target.slideDown('fast')}else{target.slideUp('fast')}});if(!$('#automatorwp-automations-execution-options input#recurring_run').prop('checked')){$('#automatorwp-automations-execution-options').find('.automatorwp-recurring-run-day-label, .cmb2-id-recurring-run-period, .cmb2-id-recurring-run-time').hide()}
$('body').on('change','#automatorwp-automations-execution-options select#recurring_run_period',function(e){var form=$(this).closest('.cmb2-metabox');var target=form.find('.cmb2-id-recurring-run-day');if(!form.find('input#recurring_run').prop('checked')){target.slideUp('fast');return}
if($(this).val()!=='day'){target.slideDown('fast')}else{target.slideUp('fast')}
var day_input=form.find('.cmb2-id-recurring-run-day input#recurring_run_day')
var max_day=365;switch($(this).val()){case 'week':max_day=7;break;case 'month':max_day=31;break;case 'year':default:max_day=365;break}
if(parseInt(day_input.val())>max_day){day_input.val(max_day)}
day_input.attr('max',max_day)});if($('#automatorwp-automations-execution-options select#recurring_run_period').val()==='day'){$('#automatorwp-automations-execution-options .cmb2-id-recurring-run-day').hide()}
$('#automatorwp-automations-execution-options select#recurring_run_period').trigger('change');$('body').on('click','.automatorwp-run-automation button',function(e){var $this=$(this);if($this.prop('disabled')){return}
var automation_id=$('input#object_id').val();var automation_type=$('select#type').val();var items_per_loop=0;if(automation_type==='all-users'){items_per_loop=$('input#users_per_loop').val()}else if(automation_type==='all-posts'){items_per_loop=$('input#posts_per_loop').val()}
$this.prop('disabled',!0);$this.find('.automatorwp-run-automation-run-label').hide();$this.find('.automatorwp-run-automation-running-label').show();$('.automatorwp-run-automation').addClass('automatorwp-is-running');$('.automatorwp-cancel-automation-run').show();automatorwp_cancel_automation_run=!1;$this.closest('#major-publishing-actions').find('.automatorwp-notice-error').remove();$('.automatorwp-run-automation-progress').removeClass('automatorwp-run-automation-progress-completed');$('.automatorwp-run-automation-progress .automatorwp-run-automation-progress-current-progress').css({width:'0%'});$('.automatorwp-run-automation-progress-text').text('0/0');$('.automatorwp-run-automation-progress').slideDown('fast');automatorwp_run_automation(automation_id,items_per_loop)});if($('.automatorwp-run-automation.automatorwp-is-running').length){var automation_id=$('input#object_id').val();var automation_type=$('select#type').val();var items_per_loop=0;if(automation_type==='all-users'){items_per_loop=$('input#users_per_loop').val()}else if(automation_type==='all-posts'){items_per_loop=$('input#posts_per_loop').val()}
automatorwp_run_automation(automation_id,items_per_loop)}
$('body').on('click','.automatorwp-cancel-automation-run button',function(e){var $this=$(this);if($this.prop('disabled')){return}
$this.prop('disabled',!0);$this.find('.automatorwp-cancel-automation-run-cancel-label').hide();$this.find('.automatorwp-cancel-automation-run-cancelling-label').show();automatorwp_cancel_automation_run=!0})})(jQuery);function automatorwp_update_items_position(element){var $=$||jQuery;var items=element.find('.automatorwp-automation-item');var items_order={};var items_order_for_tags=[];var current_position=0;items.each(function(index,value){$(this).find('input.position').val(index);if(!$(this).hasClass('automatorwp-automation-item-filter')){$(this).find('.automatorwp-automation-item-position').html((current_position+1)+'.');current_position++}
items_order[$(this).find('input.id').val()]=index;items_order_for_tags.push($(this).find('input.id').val())});if(Object.entries(items_order).length){var item_type=element.hasClass('automatorwp-triggers')?'trigger':'action';$.ajax({url:ajaxurl,method:'POST',data:{action:'automatorwp_update_automation_items_order',nonce:automatorwp_admin.nonce,items_order:items_order,item_type:item_type,},success:function(response){if(response.success){}else{}},error:function(response){}});if(item_type==='trigger'){$.each(items_order_for_tags,function(index,id){$('.automatorwp-automation-tag-selector').each(function(){$(this).find('optgroup[data-id="'+id+'"]').appendTo(this)})})}}}
function automatorwp_tags_selector(element){var $=$||jQuery;element.automatorwp_select2({theme:'default automatorwp-select2 automatorwp-tags-select2',escapeMarkup:function(markup){return markup},templateResult:function(data){var text=data.text;if(data.element!==undefined){var label=$(data.element).attr('label');if(label!==undefined&&label.length){text=label}
var custom_text=$(data.element).data('text');if(custom_text!==undefined&&custom_text.length){text=custom_text}
var icon=$(data.element).data('icon');if(icon!==undefined){text='<img src="'+icon+'" />'+text}}
return text},matcher:automatorwp_select2_optgroup_matcher,dropdownPosition:'below',});element.val(null).trigger('change')}
function automatorwp_filter_selector(element){var $=$||jQuery;element.automatorwp_select2({theme:'default automatorwp-select2 automatorwp-filter-select2',escapeMarkup:function(markup){return markup},templateResult:function(data){var text=data.text;if(data.element!==undefined){var label=$(data.element).attr('label');if(label!==undefined&&label.length){text=label}
var custom_text=$(data.element).data('text');if(custom_text!==undefined&&custom_text.length){text=custom_text}
var icon=$(data.element).data('icon');if(icon!==undefined){text='<img src="'+icon+'" />'+text}}
return text},matcher:automatorwp_select2_optgroup_matcher,})}
function automatorwp_get_option_form_values(form){var $=$||jQuery;var data={};form.find('input:not([type="button"]):not([type="submit"]), select, textarea').each(function(){var option=$(this).data('option');var value=$(this).val();if($(this).closest('.cmb-row.empty-row').length){return}
if($(this).attr('type')==='checkbox'||$(this).attr('type')==='radio'){if($(this).closest('.cmb2-checkbox-list').length){value=[];$(this).closest('.cmb2-checkbox-list').find('input:checked').each(function(){value.push($(this).val())})}else if(!$(this).prop('checked')){return}}else if($(this).closest('.cmb-row.cmb-type-text-datetime-timestamp').length){value={'date':$(this).closest('.cmb-row.cmb-type-text-datetime-timestamp').find('input.cmb2-datepicker').val(),'time':$(this).closest('.cmb-row.cmb-type-text-datetime-timestamp').find('input.cmb2-timepicker').val(),}}else if($(this).hasClass('wp-editor-area')){option=$(this).attr('name');if(window.tinyMCE.editors.length&&window.tinyMCE.editors[$(this).attr('id')]){window.tinyMCE.editors[$(this).attr('id')].save();value=$(this).val()}}
if(option!==undefined){if(option.indexOf('[')!==-1){var parts=option.split('[');option=parts[0];if(data[option]===undefined){data[option]=[]}
if(parts[1]!==']'){var option_key=parts[1].replace(']','');var index=$(this).closest('.cmb-repeatable-grouping').data('iterator');if(data[option][index]===undefined){data[option][index]={}}
data[option][index][option_key]=value}else{data[option].push(value)}}else{data[option]=value}}});return data}
function automatorwp_initialize_form_fields(form){var $=$||jQuery;form.find('.automatorwp-selector select').each(function(){automatorwp_selector($(this))});form.find('.automatorwp-post-selector select').each(function(){automatorwp_post_selector($(this))});form.find('.automatorwp-term-selector select').each(function(){automatorwp_term_selector($(this))});form.find('.automatorwp-taxonomy-selector select').each(function(){automatorwp_selector($(this))});form.find('.automatorwp-user-selector select').each(function(){automatorwp_user_selector($(this))});form.find('.automatorwp-object-selector select').each(function(){automatorwp_object_selector($(this))});form.find('.automatorwp-ajax-selector select').each(function(){automatorwp_ajax_selector($(this))});form.find('.automatorwp-automation-tag-selector').each(function(){automatorwp_tags_selector($(this))});form.find('.automatorwp-filter-selector select').each(function(){automatorwp_filter_selector($(this))});form.find('.cmb-repeat-table').each(function(){var item_id=$(this).closest('.automatorwp-automation-item').find('input.id').val();var new_id=$(this).attr('id')+'-'+item_id;$(this).attr('id',new_id);$(this).parent().find('.cmb-add-row-button').attr('data-selector',new_id)});form.find('.cmb-repeatable-group').each(function(){var item_id=$(this).closest('.automatorwp-automation-item').find('input.id').val();var new_id=$(this).attr('id')+'-'+item_id;$(this).attr('id',new_id);$(this).find('.cmb-add-group-row').attr('data-selector',new_id);$(this).find('.cmb-remove-group-row').attr('data-selector',new_id)});form.on('click','.cmb-add-group-row',function(e){window.CMB2.addGroupRow.apply(this,[e])}).on('click','.cmb-add-row-button',function(e){window.CMB2.addAjaxRow.apply(this,[e])}).on('click','.cmb-remove-group-row',function(e){window.CMB2.removeGroupRow.apply(this,[e])}).on('click','.cmb-remove-row-button',function(e){window.CMB2.removeAjaxRow.apply(this,[e])}).on('cmb2_remove_row','.cmb-repeatable-group',function(e){window.CMB2.resetTitlesAndIterator.apply(this,[e])}).on('click','.cmbhandle, .cmbhandle + .cmbhandle-title',function(e){window.CMB2.toggleHandle.apply(this,[e])});window.CMB2.initPickers(form.find('input[type="text"].cmb2-timepicker'),form.find('input[type="text"].cmb2-datepicker'),form.find('input[type="text"].cmb2-colorpicker'));form.find('.cmb-type-wysiwyg').each(function(){var $this=$(this);var textarea_id=$this.find('textarea').attr('id');var textarea=$this.find('textarea').clone();$this.find('.wp-editor-wrap').remove();$this.find('.cmb-td').append(textarea);automatorwp_initialize_wysiwyg_editor(textarea_id)});if('undefined'!==typeof window.QTags){window.QTags._buttonsInit()}}
function automatorwp_initialize_wysiwyg_editor(textarea_id){if(window.tinyMCE.editors.length&&window.tinyMCE.editors[textarea_id]){window.tinyMCE.editors[textarea_id].remove()}
wp.editor.initialize(textarea_id,{mediaButtons:!0,tinymce:{wpautop:!0,toolbar1:'formatselect bold italic bullist numlist blockquote alignleft aligncenter alignright link unlink wp_more fullscreen wp_adv',toolbar2:'strikethrough hr forecolor pastetext removeformat charmap outdent indent undo redo wp_help'},quicktags:{buttons:'strong,em,link,block,del,ins,img,ul,ol,li,,code,more,close'}})}
var automatorwp_original_automation_status='';var automatorwp_cancel_automation_run=!1;function automatorwp_run_automation(automation_id,items_per_loop){var $=$||jQuery;if(automatorwp_original_automation_status===''){automatorwp_original_automation_status=$('select#status').val();if(automatorwp_original_automation_status==='in-progress'){automatorwp_original_automation_status=$('.automatorwp-run-automation').data('original-status')}
$('select#status').val('in-progress').trigger('change');$('#cmb-field-js-controls-status-value .cmb2-id-status').html($('select#status option[value="in-progress"]').html())}
$.ajax({url:ajaxurl,method:'POST',data:{action:'automatorwp_run_automation',nonce:automatorwp_admin.nonce,automation_id:automation_id,items_per_loop:items_per_loop,},success:function(response){if(response.success){if(automatorwp_cancel_automation_run===!0){$.ajax({url:ajaxurl,method:'POST',data:{action:'automatorwp_cancel_automation_run',nonce:automatorwp_admin.nonce,automation_id:automation_id,},success:function(response){$('.automatorwp-cancel-automation-run button .automatorwp-cancel-automation-run-cancelling-label').hide();$('.automatorwp-cancel-automation-run button .automatorwp-cancel-automation-run-done-label').show();automatorwp_cancel_automation_run=!1;setTimeout(function(){automatorwp_restore_run_automation_elements(response)},2000)},error:function(response){automatorwp_restore_run_automation_elements(response)}});return}
$('.automatorwp-run-automation-progress .automatorwp-run-automation-progress-current-progress').css({width:response.data.percentage+'%'});$('.automatorwp-run-automation-progress-text').text(response.data.processed+'/'+response.data.count);if(response.data.percentage===100){$('.automatorwp-run-automation-progress').addClass('automatorwp-run-automation-progress-completed')}
if(response.data.run_again){automatorwp_run_automation(automation_id,items_per_loop)}else{$('.automatorwp-run-automation button .automatorwp-run-automation-running-label').hide();$('.automatorwp-run-automation button .automatorwp-run-automation-done-label').show();$('.automatorwp-cancel-automation-run').hide();setTimeout(function(){automatorwp_restore_run_automation_elements(response)},2000)}}else{automatorwp_restore_run_automation_elements(response)}},error:function(response){automatorwp_restore_run_automation_elements(response)}})}
function automatorwp_restore_run_automation_elements(response){var $=$||jQuery;$('.automatorwp-run-automation button').prop('disabled',!1);$('.automatorwp-run-automation button .automatorwp-run-automation-run-label').show();$('.automatorwp-run-automation button .automatorwp-run-automation-running-label').hide();$('.automatorwp-run-automation button .automatorwp-run-automation-done-label').hide();$('.automatorwp-run-automation').removeClass('automatorwp-is-running');$('select#status').val(automatorwp_original_automation_status).trigger('change');$('#cmb-field-js-controls-status-value .cmb2-id-status').html($('select#status option[value="'+automatorwp_original_automation_status+'"]').html());$('.automatorwp-run-automation-progress').slideUp('fast');$('.automatorwp-cancel-automation-run').hide();$('.automatorwp-cancel-automation-run button').prop('disabled',!1);$('.automatorwp-cancel-automation-run button .automatorwp-cancel-automation-run-cancel-label').show();$('.automatorwp-cancel-automation-run button .automatorwp-cancel-automation-run-cancelling-label').hide();$('.automatorwp-cancel-automation-run button .automatorwp-cancel-automation-run-done-label').hide();automatorwp_cancel_automation_run=!1;if(response!==undefined&&response.data!==undefined&&response.data.message!==undefined){$('.automatorwp-run-automation button').closest('#major-publishing-actions').append('<div class="automatorwp-notice-error" style="display: none;">'+response.data.message+'</div>');$('.automatorwp-run-automation button').closest('#major-publishing-actions').find('.automatorwp-notice-error').slideDown('fast')}}