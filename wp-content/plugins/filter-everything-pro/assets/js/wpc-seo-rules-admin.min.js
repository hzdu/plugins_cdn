!function($){"use strict";let a=!1;function b(a){a.fadeTo(100,0,function(){a.slideUp(100,function(){a.remove()})})}function c(j,g,h){var f=(g=g.replace("[]","[%%index%%]")).match(/([^\[\]])+/g);if(f)for(var i=f.length,a=j,c=0;c<i;c++){var b=String(f[c]);c==i-1?"%%index%%"===b?a.push(h):a[b]=h:("%%index%%"===f[c+1]?d(a[b])||(a[b]=[]):e(a[b])||(a[b]={}),a=a[b])}}function d(a){return Array.isArray(a)}function e(a){return"object"==typeof a}$.fn.getCursorPosition=function(){var a=this.get(0);if(a){if("selectionStart"in a)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange(),c=document.selection.createRange().text.length;return b.moveStart("character",-a.value.length),b.text.length-c}}},$.fn.createSeoVarsList=function(b){let a='<ul class="wpc-seo-vars-list">';return Object.keys(b).length>0?$.each(b,function(b,c){a+='<li data-seovar="{'+b+'}">'+c+"</li>"}):a+="<li>"+wpcSeoVars.noSeoVarsMsg+"</li>",a+="</ul>",$(this).replaceWith(a),!0},$(document).mouseup(function(b){let a=$(".wpc-vars-container");a.length>0&&(a.is(b.target)||0!==a.has(b.target).length||a.hide())}),$(document).ready(function(){$("form#post").on("submit",function(g){if(b($(".wpc-field-notice")),b($("#message")),!a){var e;g.preventDefault();let f,d;e=$(this),f=$("#publishing-action .spinner"),d={},f.addClass("is-active"),d.validateData=function(e){for(var d={},b=e.find("select, textarea, input").serializeArray(),a=0;a<b.length;a++)c(d,b[a].name,b[a].value);return d}(e),wp.ajax.post("wpc-validate-seo-rules",d).always(function(){f.removeClass("is-active")}).done(function(b){a=!0,e.submit()}).fail(function(c){var d;let a=[],b,e;void 0!==c.errors&&($.each(c.errors,function(c,b){a.push(b.message)}),a.length<1&&a.push("Error: Set was not saved."),d=a,b=$("form#post"),e="",$.each(d,function(b,a){e+="<p>"+a+"</p>"}),void 0!==b&&($("#message").length>0&&$("#message").remove(),b.before('<div id="message" class="wpc-error notice notice-error is-dismissible">'+e+'<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button></div>')))})}}),$(".wpc-seo-vars-list").createSeoVarsList(wpcSeoVars.seovars),$("body").on("click",".wpc-open-container",function(b){b.preventDefault();let a=$(this).data("field"),c=$("#wpc-vars-container-"+a);$("#wpc_seo_rules-"+a).focus(),c.toggle()}),$("body").on("focus keypress blur",".wpc-vars-insertable",function(b){let a=$(this).getCursorPosition();$(this).data("caret",a)}),$("body").on("click",".wpc-seo-vars-list li",function(){let a=$(this).data("seovar"),d=$(this).parents(".wpc-vars-container");if(void 0!==a){let c=$("#wpc_seo_rules-"+d.data("container")),b=c.data("caret");""===b&&(b=c.val().length),0===b?a+=" ":a=b===c.val().length?" "+a:" "+a+" ",insertAtCaret(c,a,b)}d.hide()}),$("body").on("change","#wpc_seo_rules-rule_post_type",function(){b($(".wpc-field-notice"));let c=$(this).val(),d=$(".wpc-intersection-fields-wrapper").children(".spinner");d.addClass("is-active");let a={};a._wpnonce=$("#wpc_seo_rule_nonce").val(),a.postType=c,a.postId=$("#post_ID").val(),wp.ajax.post("wpc-get-indexed-filters",a).always(function(){d.removeClass("is-active")}).done(function(a){$("#wpc-intersections-table").replaceWith(a.html),$(".wpc-seo-vars-list").createSeoVarsList(a.seovars)}).fail(function(a){if(void 0!==a){var b,c;let d;b="wpc-intersection-fields-container",c=a.message,void 0!==(d=$("#"+b))&&d.before('<div class="wpc-field-notice wpc-field-notice-error"><p>'+c+"</p></div>")}})})})}(jQuery);function insertAtCaret(b,e,c){let d=b.val(),a=d.substring(0,c)+e+d.substring(c);return a=a.replace(/ +(?= )/g,""),b.val(a),!0}