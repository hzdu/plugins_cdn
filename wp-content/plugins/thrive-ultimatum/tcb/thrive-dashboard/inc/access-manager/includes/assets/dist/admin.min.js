!function(){var e={8018:function(e,t,i){e.exports=Backbone.Collection.extend({model:i(3024)})},6195:function(e,t,i){e.exports=Backbone.Collection.extend({model:i(7010)})},5069:function(e,t,i){e.exports=Backbone.Collection.extend({model:i(7166),getActiveRole:function(){return this.findWhere({isActive:!0})}})},3024:function(e){e.exports=Backbone.Model.extend({getName:function(){return this.get("name")},getTag:function(){return this.get("tag")},getDefaultValue:function(){return this.get("default_value")},getValue:function(){return this.get("value")},getIcon:function(){return this.get("icon")},getOptions:function(){return this.get("functionality_options")},getOptionsType:function(){return this.get("get_options_type")},getActiveRole:function(){return this.get("activeRole")}})},7010:function(e){e.exports=Backbone.Model.extend({getName:function(){return this.get("name")},getTag:function(){return this.get("tag")},getLogo:function(){return this.get("logo")},getProductCapability:function(){return this.get("prod_capability")},canUse:function(){return this.get("can_use")},isEditable:function(){return this.get("is_editable")},getActiveRole:function(){return this.get("activeRole")}})},7166:function(e){e.exports=Backbone.Model.extend({canEditPosts:function(){return this.get("can_edit_posts")},getName:function(){return this.get("name")},getTag:function(){return this.get("tag")},getUrl:function(){return this.get("url")},getProducts:function(e){let t=this.get("products");return e&&(t=t[e]),t},getFunctionalities:function(e){let t=this.get("functionalities");return e&&(t=t[e]),t},isActive:function(){return this.get("isActive")},activateRole:function(){this.collection.findWhere({isActive:!0}).set({isActive:!1}),this.collection.findWhere({tag:this.getTag()}).set({isActive:!0}),this.collection.trigger("activate-role")},changeProductCapability:function(e,t){this.getProducts(e).can_use=t},changeFunctionalityValue:function(e,t){this.getFunctionalities(e).value=t}})},2996:function(e,t,i){!function(t){const n=i(7077),o=i(2744),s=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/reset-default-confirmation"),events:{"click .reset-button.tvd-modal-submit":function(){this.resetDefaults(),this.close()}},initialize:function(e){this.rolesCollection=e.rolesCollection},afterRender:function(){this.$el.addClass("tvd-modal-am-reset"),t(".role-name").text(this.rolesCollection.getActiveRole().getName())},resetDefaults:function(){const e=this.rolesCollection.getActiveRole(),i=e.getTag();TVE_Dash.showLoader(!0),t.ajax({url:ajaxurl,data:{_wpnonce:TVE_Dash_Const.nonce,action:TVE_Dash_Const.actions.backend_ajax,route:TVE_Dash_Const.routes.reset_capabilities_to_default,role:i},type:"post",dataType:"json"}).done((t=>{if(t.success){const i=t.updated_products,n=t.updated_functionalities;for(const t in i)e.changeProductCapability(t,i[t]);for(const t in n)e.changeFunctionalityValue(t,n[t]);this.rolesCollection.trigger("activate-role"),TVE_Dash.success(t.message,4e3,null,"top")}else TVE_Dash.err(t.message,4e3,null,"top")})).always((function(){TVE_Dash.hideLoader()}))}});e.exports=Backbone.View.extend({template:TVE_Dash.tpl("views/container"),el:".tvd-am-container",events:{"click .tvd-am-reset-defaults":function(){TVE_Dash.modal(s,{rolesCollection:this.rolesCollection})}},initialize:function(e){this.productsCollection=e.productCollection,this.functionalitiesCollection=e.functionalitiesCollection,this.rolesCollection=e.rolesCollection},render:function(){this.$el.html(this.template());const e=new n({productsCollection:this.productsCollection}),t=new o({functionalitiesCollection:this.functionalitiesCollection});return e.render(),t.render(),this.$el}})}(jQuery)},8547:function(e){var t;t=jQuery,e.exports=Backbone.View.extend({template:TVE_Dash.tpl("views/functionality"),events:{"select2:select .tvd-am-functionality-select":function(e){this.changeFunctionality(e.params.data.id)}},render:function(){let e=this.model.getValue();return e?"login_redirect"!==this.model.getTag()||this.model.getOptions().map((e=>e.tag)).includes(e)||(e="custom"):e="inherit",this.$el.html(this.template({model:this.model,optionsTags:this.model.getOptions().map((e=>e.tag)),optionsNames:this.model.getOptions().map((e=>e.name)),selectedValue:e})),void 0!==this.afterRender&&this.afterRender(),this.$el},changeFunctionality:function(e,i=!0){const n=this.model.getActiveRole(),o=this.model.getTag();return i&&TVE_Dash.showLoader(),t.ajax({url:ajaxurl,data:{_wpnonce:TVE_Dash_Const.nonce,action:TVE_Dash_Const.actions.backend_ajax,route:TVE_Dash_Const.routes.update_user_functionality,role:n,functionality:o,value:e},type:"post",dataType:"json"}).done((t=>{t.success?(this.model.set({value:e}),this.model.collection.trigger("change-functionality",[this.model.getTag(),e]),i&&TVE_Dash.success(t.message,4e3,null,"top")):i&&TVE_Dash.err(t.message,4e3,null,"top")})).always((function(){i&&TVE_Dash.hideLoader()}))}})},6399:function(e,t,i){!function(t){const n=i(8547);e.exports=n.extend({events:{"select2:select .tvd-am-functionality-select":"selectOption","click .open-remove-options":function(){this.$(".custom-redirect-select-wrapper ").hide(),this.$(".custom-redirect-remove-page-wrapper ").show()},"click .keep-page":function(){this.$(".custom-redirect-select-wrapper ").show(),this.$(".custom-redirect-remove-page-wrapper ").hide()},"click .remove-page":function(){this.changeFunctionality("inherit",!1),this.$("#tvd-am-custom-redirect").val(null).trigger("change",{shouldNotUpdate:!0}),this.$(".custom-redirect-remove-page-wrapper ").hide(),this.toggleCustomRedirectElements(!0)}},selectOption:function(e){const t=e.params.data.id;this.model.getOptions().map((e=>e.tag)).includes(t)&&"custom"!==t?(this.$(".custom-redirect-select-wrapper").hide(),this.changeFunctionality(t)):this.toggleCustomRedirectElements(!0)},initializePageSearch:function(e){e.find("#tvd-am-custom-redirect").select2({ajax:{url:TVD_AM_CONST.baseUrl,dataType:"json",delay:250,data:e=>({search:e.term,status:"publish",type:"page"}),processResults:e=>({results:e})},placeholder:"Search an existing page",templateResult:e=>e.loading?e.text:this.renderPageName(e.title.rendered),templateSelection:e=>e.text||this.renderPageName(e.title.rendered),language:{inputTooShort:()=>""}}).on("select2:select",(e=>{void 0===e.params.shouldNotUpdate&&this.changeFunctionality({pageId:e.params.data.id,pageName:this.renderPageName(e.params.data.title.rendered),pageLink:e.params.data.link}).done((()=>{this.toggleCustomRedirectElements(!1)}))}))},afterRender:function(){this.$el.find(".tvd-am-functionality-wrapper").append(TVE_Dash.tpl("views/custom-page-redirect")()),this.initializePageSearch(this.$el);const e=this.model.getValue();e&&!this.model.getOptions().map((e=>e.tag)).includes(e)&&this.toggleCustomRedirectElements(!1)},toggleCustomRedirectElements:function(e){this.$(".custom-redirect-select-wrapper").show(),this.$("#custom-page-info").toggle(e),this.$("#tvd-am-custom-redirect").toggle(e),this.$("#tvd-am-custom-redirect").next(".select2-container").toggle(e),this.$(".custom-page-options").toggle(!e),e||(this.$(".custom-page-title").text(this.renderPageName(this.model.getValue().pageName)),this.$(".view-page").attr("href",this.model.getValue().pageLink))},renderPageName:function(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}})}(jQuery)},2744:function(e,t,i){!function(t){const n=i(6399),o=i(8547);e.exports=Backbone.View.extend({el:".tvd-am-functionality-content",initialize:function(e){this.functionalitiesCollection=e.functionalitiesCollection,this.functionalitiesCollection.on("reset",(()=>{this.render()}))},render:function(){return this.$el.empty(),this.functionalitiesCollection.each((e=>{let t;const i=e.getOptionsType();i&&("dropdown"===i&&(t="login_redirect"===e.getTag()?new n({model:e}):new o({model:e})),t.render().appendTo(this.$el),this.$(".tvd-am-functionality-select").select2())})),this.$el}})}(jQuery)},7077:function(e){!function(t){const i=Backbone.View.extend({template:TVE_Dash.tpl("views/product"),events:{"click .tvd-am-product-cap":function(){this.model.isEditable()&&this.changeCapability()}},initialize:function(){this.model.on("change:can_use",(()=>{this.render()}))},render:function(){return this.$el.html(this.template({model:this.model,canUse:this.model.canUse()?"cap":"no-cap",isEditable:this.model.isEditable()?"-editable":"-non-editable"})),this.$el},changeCapability:function(){const e=this.model.canUse()?"remove":"add",i=this.model.getActiveRole(),n=this.model.getProductCapability();TVE_Dash.showLoader(),t.ajax({url:ajaxurl,data:{_wpnonce:TVE_Dash_Const.nonce,action:TVE_Dash_Const.actions.backend_ajax,route:TVE_Dash_Const.routes.change_capability,role:i,capability:n,capability_action:e},type:"post",dataType:"json"}).done((t=>{if(t.success){const i="add"===e;this.model.set({can_use:i}),this.model.collection.trigger("change-capability",[this.model.getTag(),i]),TVE_Dash.success(t.message,4e3,null,"top")}else TVE_Dash.err(t.message,4e3,null,"top")})).always((()=>{TVE_Dash.hideLoader()}))}});e.exports=Backbone.View.extend({el:".tvd-am-products-cap-content",initialize:function(e){this.productsCollection=e.productsCollection,this.productsCollection.on("reset",(()=>{this.render()}))},render:function(){return this.$el.empty(),this.productsCollection.each((e=>{new i({model:e}).render().appendTo(this.$el)})),this.$el}})}(jQuery)},7662:function(e){!function(t){const i=Backbone.View.extend({template:TVE_Dash.tpl("views/sidebar-item"),events:{"click .tvd-am-role":function(){this.model.activateRole()}},initialize:function(){this.model.on("change:isActive",(()=>{this.render()}))},render:function(){return this.$el.html(this.template({model:this.model})),this.$el}});e.exports=Backbone.View.extend({el:".tvd-am-sidebar",initialize:function(e){this.rolesCollection=e.rolesCollection,this.productsCollection=e.productCollection,this.functionalitiesCollection=e.functionalitiesCollection;const t=TVD_AM_CONST.roles_properties;this.initializeEvents();for(const e in t)t[e].isActive="administrator"===e,this.rolesCollection.add(t[e]);this.rolesCollection.findWhere({isActive:!0}).activateRole()},initializeEvents:function(){this.rolesCollection.on("activate-role",(()=>{const e=this.rolesCollection.getActiveRole(),t=e.getProducts(),i=e.getFunctionalities();Object.values(t).forEach((t=>{t.activeRole=e.getTag()})),this.productsCollection.reset(Object.values(t)),Object.values(i).forEach((t=>{t.activeRole=e.getTag()})),this.functionalitiesCollection.reset(Object.values(i)),this.updateRoleInfo(e)})),this.productsCollection.on("change-capability",(([e,t])=>{this.rolesCollection.getActiveRole().changeProductCapability(e,t)})),this.functionalitiesCollection.on("change-functionality",(([e,t])=>{this.rolesCollection.getActiveRole().changeFunctionalityValue(e,t)}))},render:function(){return this.$el.empty(),this.rolesCollection.each((e=>{new i({model:e}).render().appendTo(this.$el)})),this.$el},updateRoleInfo:function(e=this.rolesCollection.getActiveRole()){t(".tvd-am-view-users").attr("href",e.getUrl()),t(".tvd-am-container-role").text(e.getName())}})}(jQuery)}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}jQuery(document).ready((()=>{const e=i(7662),t=i(2996),n=i(6195),o=i(8018),s=i(5069);(new(Backbone.View.extend({template:TVE_Dash.tpl("views/content-wrapper"),el:".tvd-access-manager-setting",render:function(){this.$el.html(this.template());const i=new n,a=new o,l=new s,c=new e({productCollection:i,functionalitiesCollection:a,rolesCollection:l}),r=new t({productCollection:i,functionalitiesCollection:a,rolesCollection:l});return c.render(),r.render(),c.updateRoleInfo(),this.$el}}))).render()}))}();