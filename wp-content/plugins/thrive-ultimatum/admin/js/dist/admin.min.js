(()=>{var e;window.ThriveUlt=window.ThriveUlt||{},ThriveUlt.util=ThriveUlt.util||{},_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},Backbone.ajax=function(){return-1===arguments[0].url.indexOf("_nonce")&&(arguments[0].url+="&_nonce="+ThriveUlt.admin_nonce),Backbone.$.ajax.apply(Backbone.$,arguments)},e=jQuery,ThriveUlt.util.upperFirst=function(e){return e?e.toLowerCase().charAt(0).toUpperCase()+e.slice(1):""},ThriveUlt.util.ajaxModal=function(t){TVE_Dash.showLoader();var i=_.extend({type:"get"},t);e.ajax(i).done((function(e){var i=new TVE_Dash.views.Modal(t);i.data=t,i.template=_.template(e),i.render().open(t),"function"==typeof t.afterOpen&&t.afterOpen.call(i)})).always((function(){TVE_Dash.hideLoader()}))},ThriveUlt.util.printf=function(e,t){return t?(t instanceof Array||(t=[t]),_.each(t,(function(t){e=e.replace("%s",t)})),e):e},ThriveUlt.util.plural=function(e,t,i){return 1==i?ThriveUlt.util.printf(e,i):ThriveUlt.util.printf(t,i)},ThriveUlt.util.states={normal:"normal",delete:"delete",checked:"checked"},ThriveUlt.util.days={week:7,month:31},ThriveUlt.util.weekdays={weekdays:["S","M","T","W","T","F","S"],weekdays_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ThriveUlt.util.campaignType={absolute:"absolute",rolling:"rolling",evergreen:"evergreen"},ThriveUlt.util.status={running:"running",paused:"paused",archived:"archived"},ThriveUlt.util.rollingType={daily:"daily",weekly:"weekly",monthly:"monthly",yearly:"yearly"},ThriveUlt.util.triggerType={conversion:"conversion",first:"first",url:"url",promotion:"promotion",webhook:"webhook"},ThriveUlt.util.triggerVisit={conversion:"Thrive Leads conversion",first:"first page visit",url:"page visit",linked:"Conversion Event",promotion:"Visit to Promotion Page",webhook:"Incoming webhook"},ThriveUlt.util.conversion_event={end:"end",move:"move"},ThriveUlt.util.trigger_type={conversion:"conversion",specific:"specific"},ThriveUlt.util.leadtype={lead_group:"tve_lead_group",shortcode:"tve_lead_shortcode",thriveBox:"tve_lead_2s_lightbox"},ThriveUlt.util.get_type_title=function(e){var t;switch(e){case"absolute":t="Fixed Date";break;case"rolling":t="Recurring";break;case"evergreen":t="Evergreen"}return t+" Campaign"},ThriveUlt.ajaxurl=function(e){var t=-1!==ajaxurl.indexOf("?")?"&":"?";return e&&e.length?(e=e.replace(/^(\?|&)/,""),e+="&_nonce="+ThriveUlt.admin_nonce,ajaxurl+t+e):ajaxurl+t+"_nonce="+ThriveUlt.admin_nonce},ThriveUlt.select_card=function(e,t,i){t.removeClass(i),e.addClass(i)},ThriveUlt.util.ajax_done=function(){},ThriveUlt.util.get_days_and_hours=function(e){return isNaN(e)?[0,0]:e<=23?[0,e]:[parseInt(e/24),e%24]},e.fn.data_name=function(){this.find("select").change((function(){var t=e(this),i=t.val();t.attr("data-name",t.find('option[value="'+i+'"]').text())}))},ThriveUlt.util.enter_key_fn=function(t){return function(i){13===i.which&&(e.isFunction(t)?t():("string"==typeof t||t.jquery)&&e(t).trigger("click"))}},ThriveUlt.util.isValidHour=function(e){return/^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/.test(e)},ThriveUlt.util.data_binder=function(t,i){if(void 0===i&&(i=t.model),!(!i instanceof Backbone.Model)){var s=t.$el.find("[data-bind]").each((function(){var s=e(this),n=s.attr("data-bind"),r=!1;s.on("change",(function(){var e,t=(e=s).is(":checkbox")?!!e.is(":checked"):e.is(":radio")?e.is(":checked")?e.val():"":e.val();i.get(n)!=t&&(r=!0,i.set(n,t),r=!1)})),t.listenTo(i,"change:"+n,(function(){var e,i;r||(e=s,i=this.model.get(n),e.is(":radio")?t.$el.find('input[name="'+e.attr("name")+'"]:radio').filter('[value="'+i+'"]').prop("checked",!0):e.is(":checkbox")?e.prop("checked",!!i):e.val(i))}))}));t.listenTo(i,"invalid",(function(e,t){_.isArray(t)?_.each(t,(function(e){var t=e;e.field&&(t=e.field);var i=s.filter('[data-bind="'+t+'"]').first().addClass("tvd-validate tvd-invalid").focus();e.message&&i.siblings("label").attr("data-error",e.message),(i.is(":radio")||i.is(":checkbox"))&&TVE_Dash.err(i.next("label").attr("data-error"))})):_.isString(t)&&TVE_Dash.err(t)}))}},ThriveUlt.util.server_date=function(e){e=e||new Date;var t=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),i=t-e.getTime();return t=t+3600*ThriveUlt.wp_timezone_offset*1e3-2*i,e.setTime(t),e},ThriveUlt.util.bind_wistia=function(){window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes()},ThriveUlt.util.select2ImageItemRenderer=function(t){return t.element&&t.element.dataset.image?e('<span><span class="opt-image" style="background-image: url('+t.element.dataset.image+')"></span><span>'+t.text+"</span></span>"):t.text},ThriveUlt.util.trimStringAfterWidth=function(e,t,i,s,n){var r=document.createElement("span");r.style.cssText="visibility: hidden; float: left; font-size: "+i+"px; font-family: "+s+"; font-weight: "+n+"; ",document.body.appendChild(r),r.innerHTML=e;for(var l=r.offsetWidth>t;r.offsetWidth>t;)e=e.substring(0,e.length-1),r.innerHTML=e+"...";return r.parentNode.removeChild(r),e+(l?"...":"")},(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}window.ThriveUlt=window.ThriveUlt||{},ThriveUlt.models=ThriveUlt.models||{},ThriveUlt.collections=ThriveUlt.collections||{},function(t){Backbone.emulateHTTP=!0,ThriveUlt.models.Base=Backbone.Model.extend({idAttribute:"ID",toDeepJSON:function(){var e=t.extend(!0,{},this.attributes);return _.each(_.keys(e),(function(t){_.isUndefined(e[t])||_.isNull(e[t])||!_.isFunction(e[t].toJSON)||(e[t]=e[t].toJSON())})),e},deepClone:function(){return new this.constructor(this.toDeepJSON())},ensureCollectionData:function(e,t){_.each(t,_.bind((function(t,i){return!e[i]||(this.get(i)instanceof t?(this.get(i).reset(e[i]),void(e[i]=this.get(i))):(e[i]=new t(e[i]),!0))}),this))},validation_error:function(e,t){return{field:e,message:t}}}),ThriveUlt.collections.Base=Backbone.Collection.extend({last:function(){return this.at(this.size()-1)}}),ThriveUlt.models.Settings=ThriveUlt.models.Base.extend({defaults:function(){return{ID:""}},url:function(){return ThriveUlt.ajaxurl("action="+ThriveUlt.ajax_actions.admin_controller+"&route=dateSettings")},validate:function(e,t){var i=[];if(e.timezone||i.push(ThriveUlt.t.Timezone_required),i.length)return i}}),ThriveUlt.models.Campaign=ThriveUlt.models.Base.extend({defaults:{ID:"",rolling_type:"",status:ThriveUlt.util.status.paused,impressions:0,has_event_logs:!1,settings:{start:{date:"",time:""},end:"",duration:1,repeat:1,evergreen_repeat:0,repeatOn:[],trigger:[],real:0,realtime:"00:00",redirect:0},lockdown_settings:{}},get_chart_dummy_data:function(){var e={conversions:[11,8,14,11,17,12,9,19,17,11,21,13,4],impressions:[64,58,89,85,93,75,74,83,88,72,90,82,27]};return e.labels=_.map((function(){return""}),_.range(e.impressions.length)),e},url:function(){var e=ThriveUlt.ajaxurl("action="+ThriveUlt.ajax_actions.admin_controller+"&route=campaigns");return this.get("ID")&&(e+="&ID="+this.get("ID")),e},initialize:function(){this.set("state",ThriveUlt.util.states.normal),this.set("lockdown_state",ThriveUlt.util.states.normal)},createModelCollections:function(){!this.get("display_settings")||this.get("display_settings")instanceof ThriveUlt.collections.Hangers||(this.set("display_settings",new ThriveUlt.collections.Hangers(this.get("display_settings"))),this.set("display_settings_tpl",new ThriveUlt.models.TemplateList(this.get("display_settings_tpl")))),!this.get("designs")||this.get("designs")instanceof ThriveUlt.collections.Designs||this.set("designs",new ThriveUlt.collections.Designs(this.get("designs"))),!this.get("timeline")||this.get("timeline")instanceof ThriveUlt.collections.Events||this.set("timeline",new ThriveUlt.collections.Events(this.get("timeline")))},parse:function(e){if(e.state=ThriveUlt.util.states.normal,e.settings&&(e.settings_collection=new ThriveUlt.collections.RollingCollection,e.settings_collection.setOptions(e.settings.duration,e.rolling_type,e.settings.repeatOn)),e.linked_to){var t=new ThriveUlt.collections.LinkedToCollection;_.each(e.linked_to,(function(e){var i=ThriveUlt.globals.campaigns.findWhere({ID:parseInt(e)});t.add(i)})),e.linked_to=t}return e.display_settings&&(e.display_settings=new ThriveUlt.collections.Hangers(e.display_settings),e.display_settings_summary=e.display_settings.get_display_summary(),e.display_settings_tpl=new ThriveUlt.models.TemplateList(e.display_settings_tpl)),e.lockdown_settings&&e.lockdown_settings.promotion&&(e.lockdown_settings.promotion=new ThriveUlt.collections.PromotionURLCollection(e.lockdown_settings.promotion)),this.ensureCollectionData(e,{timeline:ThriveUlt.collections.Events,designs:ThriveUlt.collections.Designs,conversion_events:ThriveUlt.collections.ConversionEvents}),e},validate:function(e,t){var i=[];return e.post_title||i.push(this.validation_error("post_title",ThriveUlt.t.InvalidName)),i.length?i:e.skip_settings_validation?void 0:e.type?(e.type&&"function"==typeof this["validate_"+e.type]&&this["validate_"+e.type](e,i),e.lockdown&&this.validate_lockdown(e,i),i.length?i:void 0):(i.push(ThriveUlt.t.Choose_campaign_type),i)},validate_lockdown:function(e,t){var i=e.lockdown_settings;if(!e.settings_modal){if((!i.preaccess||i.preaccess instanceof Array&&0===i.preaccess.length)&&t.push(this.validation_error("preaccess",ThriveUlt.t.Pre_access_required)),(!i.promotion||0===i.promotion.length||i.promotion instanceof Object&&!i.promotion.at(0).get("id")&&!i.promotion.at(0).get("value"))&&t.push(this.validation_error("promotion",ThriveUlt.t.Promotion_required)),(!i.expired||i.expired instanceof Array&&0===i.expired.length)&&t.push(this.validation_error("expired",ThriveUlt.t.Expired_required)),t.length)return t;var s=[];return i.preaccess.value===i.promotion.value&&(s=[ThriveUlt.t.promotion,ThriveUlt.t.pre_access],t.push(this.validation_error("promotion",ThriveUlt.util.printf(ThriveUlt.t.SamePage,s)))),i.promotion.value===i.expired.value&&(s=[ThriveUlt.t.expired,ThriveUlt.t.promotion],t.push(this.validation_error("expired",ThriveUlt.util.printf(ThriveUlt.t.SamePage,s)))),t.length?t:void 0}},validate_rolling:function(i,s){var n=i.settings,r=ThriveUlt.util.server_date(),l=parseInt(n.duration),a=new Date(n.start.date+" "+n.start.time);if(t.trim(n.start.date)||s.push(this.validation_error("start_date",ThriveUlt.t.Start_date_required)),t.trim(n.start.time)||s.push(this.validation_error("start_time",ThriveUlt.t.Start_time_required)),t.trim(n.start.time)&&!ThriveUlt.util.isValidHour(n.start.time)&&s.push(this.validation_error("start_time",ThriveUlt.t.InvalidHour)),(!t.trim(n.duration).match(/\d+/)||isNaN(l)||l<1)&&s.push(this.validation_error("duration",ThriveUlt.t.Invalid_duration)),s.length)return s;if("new"===i.edit_mode&&r>a){var o=this._same_day(r,a)?ThriveUlt.t.Start_hour_in_the_past:ThriveUlt.t.InvalidStartDateToday;s.push(this.validation_error(this._same_day(r,a)?"start_time":"start_date",o))}if(i.rolling_type===ThriveUlt.util.rollingType.daily&&l>24&&s.push(this.validation_error("duration",ThriveUlt.util.printf(ThriveUlt.t.InvalidDurationTime,24))),i.rolling_type===ThriveUlt.util.rollingType.weekly&&l>7&&s.push(this.validation_error("duration",ThriveUlt.util.printf(ThriveUlt.t.InvalidDurationTime,7))),i.rolling_type===ThriveUlt.util.rollingType.monthly&&l>31&&s.push(this.validation_error("duration",ThriveUlt.util.printf(ThriveUlt.t.InvalidDurationTime,31))),i.rolling_type===ThriveUlt.util.rollingType.yearly&&l>365&&s.push(this.validation_error("duration",ThriveUlt.util.printf(ThriveUlt.t.InvalidDurationTime,365))),null!==n.end&&"object"===e(n.end)&&(t.trim(n.end.date)||s.push(this.validation_error("end_date",ThriveUlt.t.End_date_required)),t.trim(n.end.time)||s.push(this.validation_error("end_time",ThriveUlt.t.End_time_required)),t.trim(n.end.time)&&!ThriveUlt.util.isValidHour(n.end.time)&&s.push(this.validation_error("end_time",ThriveUlt.t.InvalidEndHour)),new Date(n.end.date+" "+n.end.time)<=a)){var d=n.start.date===n.end.date?ThriveUlt.t.End_after_start_time:ThriveUlt.t.End_after_start_date;s.push(this.validation_error(n.start.date===n.end.date?"end_time":"end_date",d))}if("string"==typeof n.end&&(t.trim(n.end)||s.push(this.validation_error("occurrences_number",ThriveUlt.t.OccurrencesRequired)),t.trim(n.end)&&(isNaN(n.end)||n.end<=0)&&s.push(this.validation_error("occurrences_number",ThriveUlt.t.InvalidOccurrences))),s.length)return s;i.rolling_type!==ThriveUlt.util.rollingType.weekly&&i.rolling_type!==ThriveUlt.util.rollingType.monthly||0===i.settings.repeatOn.length&&s.push(ThriveUlt.t.InvalidRepeatOn)},validate_evergreen:function(e,i){var s=e.settings,n=parseInt(s.days_duration),r=parseInt(s.hours_duration),l=parseInt(s.minutes_duration),a=parseInt(s.seconds_duration),o=n+r+l+a,d=parseInt(s.end);return(isNaN(o)||0===o)&&(i.push(this.validation_error("days_duration",ThriveUlt.t.Invalid_value)),i.push(this.validation_error("hours_duration","")),i.push(this.validation_error("minutes_duration","")),i.push(this.validation_error("seconds_duration",""))),(!t.trim(s.days_duration).match(/^\d+$/)||isNaN(n)||n<0)&&i.push(this.validation_error("days_duration",ThriveUlt.t.Invalid_duration)),(!t.trim(s.hours_duration).match(/^\d+$/)||isNaN(r)||r>23||r<0)&&i.push(this.validation_error("hours_duration",ThriveUlt.t.Invalid_value_hours)),(!t.trim(s.minutes_duration).match(/^\d+$/)||isNaN(l)||l>59||l<0)&&i.push(this.validation_error("minutes_duration",ThriveUlt.t.Invalid_value_minutes_seconds)),(!t.trim(s.seconds_duration).match(/^\d+$/)||isNaN(a)||a>59||a<0)&&i.push(this.validation_error("seconds_duration",ThriveUlt.t.Invalid_value_minutes_seconds)),1===parseInt(s.evergreen_repeat)&&(!t.trim(s.end).match(/^\d+$/)||isNaN(d)||d<1)&&i.push(this.validation_error("end",ThriveUlt.t.Invalid_end_evergreen)),i.length?i:(s.trigger.type===ThriveUlt.util.triggerType.url&&""==s.trigger.ids&&i.push(this.validation_error("post_search",ThriveUlt.t.Choose_trigger_page)),s.redirect&&!s.redirect_url&&i.push(this.validation_error("post_search_redirect",ThriveUlt.t.Choose_trigger_page)),i.length?i:void(e.linked_to||"evergreen"==e.edit_mode||(""===s.trigger.type&&i.push(ThriveUlt.t.InvalidTriggerIds),s.trigger.type===ThriveUlt.util.triggerType.url&&""==s.trigger.ids&&i.push(ThriveUlt.t.InvalidPost),s.trigger.type===ThriveUlt.util.triggerType.conversion&&0===s.trigger.ids.length&&i.push(ThriveUlt.t.InvalidLeadGroup))))},validate_absolute:function(e,i){var s=ThriveUlt.util.server_date(),n=e.settings.start,r=e.settings.end,l=new Date(n.date+" "+n.time),a=new Date(r.date+" "+r.time);if(t.trim(n.date)||i.push(this.validation_error("start_date",ThriveUlt.t.Start_date_required)),t.trim(n.time)||i.push(this.validation_error("start_time",ThriveUlt.t.Start_time_required)),t.trim(r.date)||i.push(this.validation_error("end_date",ThriveUlt.t.End_date_required)),t.trim(r.time)||i.push(this.validation_error("end_time",ThriveUlt.t.End_time_required)),i.length)return i;if("new"===e.edit_mode&&a<s){var o=this._same_day(s,l)?ThriveUlt.t.End_hour_in_the_past:ThriveUlt.t.InvalidEndDateToday;i.push(this.validation_error(this._same_day(s,l)?"end_time":"end_date",o))}if(a<=l){var d=n.date===r.date?ThriveUlt.t.End_after_start_time:ThriveUlt.t.End_after_start_date;i.push(this.validation_error(n.date===r.date?"end_time":"end_date",d))}return i.length?i:void 0},_same_day:function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},getDisplaySettingsUrl:function(){return ThriveUlt.ajaxurl("action="+ThriveUlt.ajax_actions.admin_controller+"&route=displaySettingsCampaign&campaign_id="+this.get("ID"))},saveStatus:function(e){var i=this;return t.ajax({url:ThriveUlt.ajaxurl(),dataType:"json",method:"POST",data:{_nonce:ThriveUlt.admin_nonce,action:ThriveUlt.ajax_actions.admin_controller,route:"campaignStatus",ID:this.get("ID"),status:e}}).done((function(t){i.set("status",e)}))},cleanModel:function(){var e=this.get("type");if(e===ThriveUlt.util.campaignType.absolute)this.get("settings").repeat=1,this.get("settings").duration=1,this.get("settings").repeatOn=[],this.set("rolling_type",""),this.get("settings").trigger={type:"",ids:""},this.get("settings").real=0,this.get("settings").realtime="00:00";else if(e===ThriveUlt.util.campaignType.evergreen){this.get("settings").repeatOn=[],this.set("rolling_type",""),this.get("settings").start={date:"",time:""};var t=this.get("settings").evergreen_repeat;t&&0!==parseInt(t)||(this.get("settings").end=""),"url"!==this.get("settings").trigger.type&&this.get("settings").redirect&&(this.get("settings").redirect=0,this.get("settings").redirect_url="")}else this.get("settings").trigger={type:"",ids:""},this.get("settings").real=0,this.get("settings").realtime="00:00"},changeRepeat:function(e){var t="",i=this.get("rolling_type");return e?(t=e.target.value,this.get("settings").repeat=t):t=this.get("settings").repeat,i||(i=ThriveUlt.util.rollingType.daily),i=i===ThriveUlt.util.rollingType.daily?1==t?i.replace("ily","y"):i.replace("ily","ys"):1==t?i.replace("ly",""):i.replace("ly","s"),1==t&&(t=""),t+" "+i},getSummary:function(){var e=this.get("settings"),i=this.get("type"),s="";if(i===ThriveUlt.util.campaignType.rolling){var n=this.changeRepeat(),r=this.get("settings_collection").prepareAppend(),l=this.get("rolling_type");if(l==ThriveUlt.util.rollingType.daily||l==ThriveUlt.util.rollingType.yearly||!l)return void this.set("summary",ThriveUlt.util.printf(ThriveUlt.t.SummaryRunsDayYear,[n]));this.set("summary",ThriveUlt.util.printf(ThriveUlt.t.SummaryRuns,[n,r]))}else{if(i===ThriveUlt.util.campaignType.absolute){s=e.end;var a=e.start,o=new Date(a.date+" "+a.time),d=(new Date(s.date+" "+s.time).getTime()-o.getTime())/1e3;m=Math.floor(d/86400);var h=[t.datepicker.formatDate(ThriveUlt.date_format,o)+" "+t().timepicker.formatTime(ThriveUlt.time_format,o)],c=Math.floor((d-86400*m)/3600);m&&h.push(ThriveUlt.util.plural(ThriveUlt.t.count_day,ThriveUlt.t.count_days,m)),c&&h.push(ThriveUlt.util.plural(ThriveUlt.t.count_hour,ThriveUlt.t.count_hours,c));var v=ThriveUlt.util.printf(m&&c&&c>0?ThriveUlt.t.SummaryStartsDaysHours:ThriveUlt.t.SummaryStarts,h);return this.set("summary",v)}var u,g=e.trigger.type,m="";if(i===ThriveUlt.util.campaignType.evergreen){m="",s="";var p=(void 0===e.days_duration?parseInt(e.duration):parseInt(e.days_duration))||0,T=parseInt(e.hours_duration)||0,_=parseInt(e.minutes_duration)||0,f=parseInt(e.seconds_duration)||0;s=(p>0?p+(1===p?" day ":" days "):"")+(T>0?T+(1===T?" hour ":" hours "):"")+(_>0?_+(1===_?" minute ":" minutes "):"")+(f>0?f+(1===f?" second ":" seconds "):"")}else m=1==(s=e.end)?"day":"days";if(g&&g===ThriveUlt.util.triggerType.webhook)return this.set("summary",ThriveUlt.util.printf("FluentCRM"===ThriveUlt.integratedApis[e.trigger.api].label?ThriveUlt.t.SummaryStartsEvergreenTag:ThriveUlt.t.SummaryStartsEvergreenWebhook,[ThriveUlt.integratedApis[e.trigger.api].label]));u=g&&g!==ThriveUlt.util.triggerType.webhook?g===ThriveUlt.util.triggerType.url?ThriveUlt.util.triggerVisit.url:g===ThriveUlt.util.triggerType.first?ThriveUlt.util.triggerVisit.first:g===ThriveUlt.util.triggerType.promotion?ThriveUlt.util.triggerVisit.promotion:ThriveUlt.util.triggerVisit.conversion:ThriveUlt.util.triggerVisit.linked,this.set("summary",ThriveUlt.util.printf(ThriveUlt.t.SummaryStartsEvergreen,[u,s,m]))}},checkDesignsTemplate:function(){var e=this.get("designs"),t="";return e.each((function(e){var i=e.get("tpl");i&&(t=i)}),this),!!t},setTime:function(t){return this.get("settings").end=null!==this.get("settings").end&&"object"===e(this.get("settings").end)?this.get("settings").end:{date:"",time:""},this.get("settings").end.time=t,this},has_design_type:function(e){return"string"!=typeof e||!e.length||"shortcode"!==e&&void 0!==this.get("designs").findWhere({post_type:e})},can_set_events:function(){return this.get("type")},get_settings_step:function(){return this.get("display_settings")?this.get("type")?ThriveUlt.data.lead_groups&&ThriveUlt.data.shortcodes||this.get("settings").trigger.type!=ThriveUlt.util.triggerType.conversion?this.get("type")!=ThriveUlt.util.campaignType.evergreen||this.get("lockdown")||this.get("settings").trigger.type!=ThriveUlt.util.triggerType.promotion?this.get("display_settings").has_saved_options()?!this.get("lockdown")||0!=this.get("lockdown_settings").preaccess.length&&0!=this.get("lockdown_settings").expired.length&&0!=this.get("lockdown_settings").promotion.length?this.get("designs").size()?this.get("timeline").size()<=2&&!this.get("timeline").at(0).get("actions").size()?"timeline":"":"design":"lockdown":"display":"lockdown_type":"leads_missing":"type":"display"},load_chart_data:function(e){return this.get("ID")?this.has("chart_data")?e.call(null,this.get("chart_data")):void t.ajax({url:this.url(),data:{custom:"chart_data",_nonce:ThriveUlt.admin_nonce},type:"post",dataType:"json"}).done(_.bind((function(t){this.set("chart_data",t),e.call(null,this.get("chart_data"))}),this)).fail(_.bind((function(){e.call(null,null)}),this)):null},roundTime:function(e){if(e){var t=e.slice(-2),i=e.slice(0,2);return t>30&&i++,i+":00"}return""},_is_type:function(e){return this.get("type")&&this.get("type")===e},is_evergreen:function(){return this._is_type(ThriveUlt.util.campaignType.evergreen)},is_absolute:function(){return this._is_type(ThriveUlt.util.campaignType.absolute)},is_rolling:function(){return this._is_type(ThriveUlt.util.campaignType.rolling)},has_valid_lockdown_trigger:function(){if(!this.is_evergreen())return!0;var e=this.get("settings");return!!(e.trigger&&t.isPlainObject(e.trigger)&&e.trigger.type)&&[ThriveUlt.util.triggerType.conversion,ThriveUlt.util.triggerType.promotion,ThriveUlt.util.triggerType.webhook].includes(e.trigger.type)},is_archived:function(){return this.get("status")===ThriveUlt.util.status.archived},is_running:function(){return this.get("status")===ThriveUlt.util.status.running},get_archive_tooltip:function(){return this.get("status")===ThriveUlt.util.status.archived?ThriveUlt.t.restore_campaign:ThriveUlt.t.archive_campaign}}),ThriveUlt.models.CheckboxModel=ThriveUlt.models.Base.extend({defaults:{ID:"",checked:!1,label:"",disabled:!1}}),ThriveUlt.models.LeadGroupModel=ThriveUlt.models.Base.extend({}),ThriveUlt.collections.LeadGroupsCollection=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.LeadGroupModel}),ThriveUlt.models.ShortcodeModel=ThriveUlt.models.Base.extend({}),ThriveUlt.collections.ShortcodesCollection=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.ShortcodeModel}),ThriveUlt.models.ThriveBoxModel=ThriveUlt.models.Base.extend({}),ThriveUlt.collections.ThriveBoxesCollection=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.ThriveBoxModel}),ThriveUlt.models.PromotionURLModel=ThriveUlt.models.Base.extend({idAttribute:"ID",defaults:{id:"",label:"",type:"",value:"",link:""}}),ThriveUlt.collections.PromotionURLCollection=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.PromotionURLModel,generateEmailLink:function(){var e=this.model,i=this.parent_model,s=t("#tvu-autoresponder-type").find("option:selected").data("tag"),n=this.$(".tvu-email-link");if(!(e instanceof Array&&0===e.length))if(null===e||e.get("id")||!e.get("value")){var r=ajaxurl+"?action="+ThriveUlt.ajax_actions.admin_controller+"&route=getPostByID",l={id:e.get("id"),_nonce:ThriveUlt.admin_nonce};n.val(ThriveUlt.t.Loading),t.ajax({method:"POST",url:r,data:l,success:function(t){var i=o(t.url,s);e.set({link:i})}})}else{var a=o(e.get("value"),s);e.set("link",a)}function o(e,t){var s=e.indexOf("?")>0?"&":"?";return e=e+s+"tu_id="+i.get("ID"),i.get("type")===ThriveUlt.util.campaignType.evergreen&&(e=e+"&tu_em="+t),e}},cleanCollection:function(){var e=[];return this.at(0).get("id")?(this.length>1&&_.each(this.where({id:""}),(function(e){this.remove(e,{silent:!0})}),this),e):(e.push(this.at(0).validation_error("promotion",ThriveUlt.t.Promotion_required)),e)}}),ThriveUlt.collections.RollingCollection=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.CheckboxModel,setOptions:function(e,t,i){var s=0,n=e-1,r=2*n+1,l=this;if(t===ThriveUlt.util.rollingType.weekly){var a=ThriveUlt.util.weekdays.weekdays;s=ThriveUlt.util.days.week}else t===ThriveUlt.util.rollingType.monthly&&(s=ThriveUlt.util.days.month);this.reset();for(var o=0;o<s;o++)this.add(new ThriveUlt.models.CheckboxModel({checked:_.contains(i,o),ID:o,label:a?a[o]:o+1,disabled:!1}));var d=this.where({checked:!0});return d&&_.each(d,(function(e){for(var t=e.get("ID"),i=0;i<s;i++)(i-t<0?t-i+n:i-t+n)%s<r&&i!==t&&l.at(i).set("disabled",!0)})),this},changeCheckboxes:function(e,t){for(var i=this.length,s=e-1,n=2*s+1,r=this.at(t).get("checked"),l=this,a=0;a<i;a++)(a-t<0?t-a+s:a-t+s)%i<n&&a!==t&&this.at(a).set("disabled",!r);var o=this.where({checked:!0});o&&1==r&&_.each(o,(function(e){if(e.get("ID")!==t)for(var r=e.get("ID"),a=0;a<i;a++)(a-r<0?r-a+s:a-r+s)%i<n&&a!==r&&l.at(a).set("disabled",!0)}))},getIDsArray:function(){var e=this.where({checked:!0}),t=[];return _.each(e,(function(e){t.push(e.get("ID"))})),t},prepareAppend:function(){var e=this.where({checked:!0}),t=this,i="",s=e[e.length-1],n=e[0];return _.each(e,(function(r){if(7===t.length){var l=ThriveUlt.util.weekdays.weekdays_full;e.length>1&&s.get("ID")===r.get("ID")?i+=" and "+l[r.get("ID")]:e.length>=1&&n.get("ID")===r.get("ID")?i+=" "+l[r.get("ID")]:i+=", "+l[r.get("ID")]}else{var a=r.get("ID")+1,o=a%10,d=a%100;e.length>1&&s.get("ID")===r.get("ID")?i+=1==o&&11!=d?" and "+a+"st":2==o&&12!=d?" and "+a+"nd":3==o&&13!=d?" and "+a+"rd":" and "+a+"th":e.length>=1&&n.get("ID")===r.get("ID")?i+=1==o&&11!=d?" "+a+"st":2==o&&12!=d?" "+a+"nd":3==o&&13!=d?" "+a+"rd":" "+a+"th":i+=1==o&&11!=d?", "+a+"st":2==o&&12!=d?", "+a+"nd":3==o&&13!=d?", "+a+"rd":", "+a+"th"}})),i}}),ThriveUlt.collections.Campaigns=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.Campaign,comparator:function(e){return parseInt(e.get("order"))},removeSpecificModel:function(e){var t=this.findWhere({ID:parseInt(e)});return t&&this.remove(t),this},filter_archived:function(e){return void 0===e&&(e=!0),!0===e?this.where({status:ThriveUlt.util.status.archived}):this.filter((function(e){return e.get("status")===ThriveUlt.util.status.paused||e.get("status")===ThriveUlt.util.status.running}))}}),ThriveUlt.models.Design=ThriveUlt.models.Base.extend({defaults:{ID:"",state:ThriveUlt.util.states.normal},previous_state:null,initialize:function(e){!this.get("ID")&&e.id&&this.set("ID",e.id),this.on("change:state",_.bind(this.state_changed,this)),!e.children||e.children instanceof ThriveUlt.collections.Designs||this.set("children",new ThriveUlt.collections.Designs(e.children))},state_changed:function(e,t){this.previous_state=t},url:function(){var e=ThriveUlt.ajaxurl("action="+ThriveUlt.ajax_actions.admin_controller+"&route=designs");return this.get("ID")&&(e+="&ID="+this.get("ID")),e},parse:function(e){return e.state||(e.state=this.previous_state?this.previous_state:ThriveUlt.util.states.normal),this.ensureCollectionData(e,{children:ThriveUlt.collections.Designs}),e},thumb:function(){return this.get("thumb_url")?this.get("thumb_url"):ThriveUlt.t.Choose_a_template},validate:function(e,t){return e.post_parent?e.post_type?void 0:ThriveUlt.t.DesignTypeMissing:ThriveUlt.t.InvalidCampaign},clearRefetchTimer:function(){clearTimeout(this.refetch_timeout)},initRefetchTimer:function(){var e=this;e.refetch_timeout=setTimeout((function t(){e.get("thumb_url")||(e.fetch(),e.refetch_timeout=setTimeout(t,5e3))}),5e3)},getShortcode:function(){return"[tu_countdown id="+this.get("post_parent")+" design="+this.get("ID")+"][/tu_countdown]"}}),ThriveUlt.collections.Designs=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.Design,campaign_id:0,set_campaign_id:function(e){return this.campaign_id=e,this},url:function(){return ThriveUlt.ajaxurl("action="+ThriveUlt.ajax_actions.admin_controller+"&route=designList&get_states=1&campaign_id="+this.campaign_id)},mark_selected_event_actions:function(e){return e&&e.length?(e.each(_.bind((function(e){var t=this.findWhere({ID:e.get("design")});t&&(t.set("event_display",!0),this._find_state(e.get("design"),e.get("state"))&&t.set("event_state",e.get("state")))}),this)),this):this},_find_state:function(e,t){var i=this.get(e);return e==t?i:i.get("children")?i.get("children").get(t):i}}),ThriveUlt.models.Event=ThriveUlt.models.Base.extend({initialize:function(e){this.get("actions")instanceof ThriveUlt.collections.EventActions||this.set("actions",new ThriveUlt.collections.EventActions(e.actions)),this.set("ID",e.id?e.id:"")},parse:function(e){return this.ensureCollectionData(e,{actions:ThriveUlt.collections.EventActions}),e},url:function(){var e=ajaxurl+"?action="+ThriveUlt.ajax_actions.admin_controller+"&route=events";return this.get("ID")&&(e+="&ID="+this.get("ID")),e},validate:function(e){if(!e.type||"start"!==e.type){if(!e.days&&!e.hours)return this.validation_error("time",ThriveUlt.t.InvalidTriggerTime);if(e.days<0||e.hours<0)return this.validation_error("time",ThriveUlt.t.InvalidTriggerTime)}},validateTrigger:function(e){if(this.get("type")===ThriveUlt.event_type.start)return null;var t=24*parseInt(e.get("days"))+parseInt(e.get("hours")),i=parseInt(24*this.get("days")+parseInt(this.get("hours"))),s=ThriveUlt.globals.campaign.get("settings"),n=(void 0===s.days_duration?parseInt(s.duration):parseInt(s.days_duration))||0,r=parseInt(s.hours_duration)||0,l=parseInt(s.minutes_duration)||0,a=parseInt(s.seconds_duration)||0;return i>=t||i>=24*n+r+l/60+a/60/60&&"evergreen"===ThriveUlt.globals.campaign.get("type")?this.validation_error("time",ThriveUlt.t.InvalidEventTriggerTime):void 0},getDuration:function(){return 24*parseInt(this.get("days"))+parseInt(this.get("hours"))},setTime:function(e,t){"days"===t&&(this.set("days",e),this.set("hours",0)),"hours"===t&&(this.set("days",0),this.set("hours",e))},getLabel:function(){if(this.get("label")&&this.get("label").length)return this.get("label");if(0==this.get("hours")&&0==this.get("days"))return"";if(0==this.get("hours"))return"-"+ThriveUlt.util.plural("%s "+ThriveUlt.t.Day,"%s "+ThriveUlt.t.Days,this.get("days"));if(0==this.get("days")){if(parseInt(this.get("hours"))>24){var e=parseInt(this.get("hours")/24);return"-"+ThriveUlt.util.plural("%s "+ThriveUlt.t.Day,"%s "+ThriveUlt.t.Days,e)+" and "+ThriveUlt.util.plural("%s "+ThriveUlt.t.Hour,"%s "+ThriveUlt.t.Hours,this.get("hours")-24*e)}return"-"+ThriveUlt.util.plural("%s "+ThriveUlt.t.Hour,"%s "+ThriveUlt.t.Hours,this.get("hours"))}return"-"+ThriveUlt.util.plural("%s "+ThriveUlt.t.Day,"%s "+ThriveUlt.t.Days,this.get("days"))+"<br/>"+ThriveUlt.util.plural("%s "+ThriveUlt.t.Hour,"%s "+ThriveUlt.t.Hours,this.get("hours"))},buildActionsFromDesigns:function(e){var t=new ThriveUlt.collections.EventActions;return e.each((function(e){if(!e.get("event_display"))return!0;t.add({design:e.get("ID"),state:e.get("event_state"),key:ThriveUlt.data.actions.design_show.key})})),this.set("actions",t),this}}),ThriveUlt.collections.Events=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.Event,url:ThriveUlt.ajaxurl("action="+ThriveUlt.ajax_actions.admin_controller+"&route=events"),comparator:function(e){return-(parseInt(e.get("hours"))+24*e.get("days"))},removeEvents:function(e){this.each((function(t){if(t.get("type")!==ThriveUlt.event_type.end){var i=t.get("actions");i.filter((function(t){return t.get("design")==e.get("ID")})).forEach((function(e){void 0!==e&&i.remove(e)}))}}))}}),ThriveUlt.models.EventAction=ThriveUlt.models.Base.extend({validate:function(e){if(!e.key||"0"===e.key)return this.validation_error("action",ThriveUlt.t.SelectAction);if(!ThriveUlt.data.actions[e.key])return this.validation_error("action",ThriveUlt.t.InvalidAction);if(e.key===ThriveUlt.data.actions.design_show.key||e.key===ThriveUlt.data.actions.design_switch_state.key){var t=[];if(e.design&&"0"!==e.design||t.push(this.validation_error("design",ThriveUlt.t.SelectDesign)),e.state&&"0"!==e.state||t.push(this.validation_error("state",ThriveUlt.t.SelectState)),t.length)return t}return!ThriveUlt.data.actions.campaign_move||e.key!==ThriveUlt.data.actions.campaign_move.key||e.campaign&&"0"!==e.campaign?void 0:ThriveUlt.t.SelectCampaign},getFullName:function(){if("design_show"!==this.get("key"))return this.get("name");if(this.get("event_full_name"))return this.get("event_full_name");var e=ThriveUlt.globals.campaign.get("designs"),t=this.get("design"),i=e.get(t),s=this.get("state"),n=e._find_state(t,s),r="";return i&&n?(r=i.get("post_title"),r+=" ("+(t==s?ThriveUlt.t.main_state:n.get("post_title"))+")",r=ThriveUlt.util.printf(ThriveUlt.t.display_countdown_design,"<strong>"+r+"</strong>"),this.set("event_full_name",r),r):""}}),ThriveUlt.collections.EventActions=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.EventAction}),ThriveUlt.models.BreadcrumbLink=ThriveUlt.models.Base.extend({defaults:{ID:"",hash:"",label:"",full_link:!1},initialize:function(e){this.get("ID")||this.set("ID",e.label.split(" ").join("").toLowerCase()),this.set("full_link",e.hash.match(/^http/))},get_url:function(){return this.get("full_link")?this.get("hash"):"#"+this.get("hash")}}),ThriveUlt.models.ConversionEvent=ThriveUlt.models.Event.extend({defaults:{ID:"",actions:[],trigger_options:{trigger:"",trigger_ids:"",event:""}},initialize:function(e){this.get("trigger_options")||this.set("trigger_options",e.trigger_options),this.set("ID",e.id?e.id:"")},parse:function(e){return e},validate:function(e,t){var i=e.trigger_options,s=[];return i.event&&0!==parseInt(i.event)||s.push(this.validation_error("action_event",ThriveUlt.t.Event_type_required)),s.length?s:i.event!==ThriveUlt.util.conversion_event.move||i.end_id?void 0:ThriveUlt.t.InvalidEndId},validateTrigger:function(){var e=this.get("trigger_options"),t=[];if(e.trigger&&0!==parseInt(e.trigger)||t.push(this.validation_error("trigger",ThriveUlt.t.Trigger_required)),t.length)return t;if(!e.trigger_ids){if(e.trigger===ThriveUlt.util.trigger_type.conversion)return ThriveUlt.t.Select_conversion_target;e.trigger===ThriveUlt.util.trigger_type.specific&&t.push(this.validation_error("conversion_page",ThriveUlt.t.Choose_conversion_page))}return t.length?t:void 0}}),ThriveUlt.collections.ConversionEvents=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.ConversionEvent}),ThriveUlt.models.LinkedTo=ThriveUlt.models.Base.extend({}),ThriveUlt.collections.LinkedToCollection=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.LinkedTo}),ThriveUlt.collections.Breadcrumbs=ThriveUlt.collections.Base.extend({model:ThriveUlt.models.Base.extend({defaults:{hash:"",label:""}}),add_page:function(e,t){var i=new ThriveUlt.models.BreadcrumbLink({hash:e,label:t});return this.add(i)}})}(jQuery)})(),window.ThriveUlt=window.ThriveUlt||{},ThriveUlt.views=ThriveUlt.views||{},function(e){e((function(){ThriveUlt.views.ModalSteps=TVE_Dash.views.Modal.extend({stepClass:".tvu-modal-step",currentStep:0,$step:null,events:{"click .tvu-modal-next-step":"next","click .tvu-modal-prev-step":"prev"},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this},gotoStep:function(e){var t=this.steps.hide().eq(e).show(),i=this;return this.$step=t,setTimeout((function(){i.input_focus(t)}),50),this.currentStep=e,this},next:function(){this.beforeNext(),this.gotoStep(this.currentStep+1),this.afterNext()},prev:function(){this.beforePrev(),this.gotoStep(this.currentStep-1),this.afterPrev()},beforeNext:function(){return this},afterNext:function(){return this},beforePrev:function(){return this},afterPrev:function(){return this}}),ThriveUlt.views.ModalAddDesign=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/new-design"),type:"",events:{"click .tvu-save-new-design":"save","click div[data-type]":"select_type","click .tu-display-option":"selectDisplayOption"},afterRender:function(){return this.$el.addClass("tvu-modal-design-type"),this.design_model=new ThriveUlt.models.Design({post_parent:this.model.get("ID"),post_type:this.type}),this.$headerDisplayOptions=this.$(".tu-display-option"),ThriveUlt.util.data_binder(this,this.design_model),this},selectDisplayOption:function(t){this.$headerDisplayOptions.removeClass("active"),this.design_model.set("display_position",e(t.currentTarget).addClass("active").data("value"))},select_type:function(t){var i=e(t.currentTarget),s=i.data("type"),n=i.children(".tvd-card"),r=this.$el.find(".tvu-campaign-selector").children(".tvd-card");ThriveUlt.select_card(n,r,"tvu-selected-design"),"shortcode"===s?(this.$("#tu-design-name-wrapper").show(),this.$("#tu-design-name").focus().select()):this.$("#tu-design-name-wrapper").hide(),this.$("#tu-top-ribbon-position").toggle("header-bar"===s),this.$headerDisplayOptions.removeClass("active"),this.$headerDisplayOptions.filter('[data-value="push_content"]').addClass("active"),this.design_model.set({post_type:s,display_position:"header-bar"===s?"push_content":""})},save:function(){if(this.design_model.isValid()){TVE_Dash.showLoader();var e=this,t=this.design_model,i=t.save({wait:!0});i&&(i.done((function(i,s,n){t.set(i),t.set("ID",i.id),e.model.get("designs").add(t),e.model.trigger("tve_ult_campaign_saved"),t.initRefetchTimer(),TVE_Dash.hideLoader()})),i.error((function(e){TVE_Dash.hideLoader()})),i.always((function(){e.close()})))}}}),ThriveUlt.views.ModalEditCampaignType=TVE_Dash.views.Modal.extend({className:"tvd-modal-fixed-footer tvd-modal",template:TVE_Dash.tpl("modals/edit-campaign"),events:{"click .tvu-campaign-selector":"showCampaignOptions","click .tvu-save-campaign-type":"save"},afterInitialize:function(){this.listenTo(this.model,"change:type",this.renderSettings)},afterRender:function(){return this.$el.addClass("tvu-campaign-modal"),this.renderSettings(),this},renderSettings:function(){var e=this.model.get("type"),t=this.collection,i=null,s=null;if(e||this.model.set("edit_mode","new"),this.model.set("settings_modal","modal"),ThriveUlt.views["CampaignType"+ThriveUlt.util.upperFirst(e)+"State"])return e==ThriveUlt.util.campaignType.evergreen&&(!1===ThriveUlt.data.lead_groups?t=null:(t=new ThriveUlt.collections.LeadGroupsCollection(ThriveUlt.data.lead_groups),i=new ThriveUlt.collections.ShortcodesCollection(ThriveUlt.data.shortcodes),s=new ThriveUlt.collections.ThriveBoxesCollection(ThriveUlt.data.thrive_boxes))),this[e]?this[e].setElement(this.$("#tvu-campaign-type-options")[0]):this[e]=new(ThriveUlt.views["CampaignType"+ThriveUlt.util.upperFirst(e)+"State"])({el:this.$el.find("#tvu-campaign-type-options")[0],model:this.model,collection:t,shortcodes:i,thriveBoxes:s,thriveQuizzes:ThriveUlt.data.tqb_optin}),this[e].render(),this[e].$el.hide().fadeIn().slideDown(),this},save:function(){var e=this.collection.getIDsArray();if(this.model.get("rolling_type")||this.model.set("rolling_type","daily"),this.model.get("settings").repeatOn=e,this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);var t=this;TVE_Dash.showLoader(),this.model.cleanModel(),this.model.save().done((function(){TVE_Dash.hideLoader(),t.model.getSummary(),t.model.unset("edit_mode"),t.model.unset("settings_modal");try{var e=ThriveUlt.globals.campaigns.findWhere({ID:t.model.get("ID")});e instanceof ThriveUlt.models.Campaign&&e.set(t.model.toJSON()),ThriveUlt.globals.campaign.set(t.model.toJSON())}catch(e){console.log("Error: "+e)}t.original_model.trigger("tve_ult_campaign_saved")})).error((function(){TVE_Dash.hideLoader()})).always((function(){t.close()}))},showCampaignOptions:function(t){var i=t.currentTarget,s=e(i).attr("data-type"),n=e(i).children(".tvd-card"),r=this.$el.find(".tvd-card");ThriveUlt.select_card(n,r,"tvu-selected-design"),this.model.set("type",s)},onClose:function(){e(".tvd-material-tooltip").hide()}}),ThriveUlt.views.ModalEditDateSettings=TVE_Dash.views.Modal.extend({className:"tvd-modal-fixed-footer tvd-modal tvu-edit-date-settings-modal",template:TVE_Dash.tpl("modals/edit-date-settings"),events:{"change #tvu-date-format-setting":"changeDateFormat","change #tvu-time-format-setting":"changeTimeFormat","change #tvu-timezone-setting":"changeTimeZone","click .tvu-save-date-settings":"save"},afterOpen:function(){this.$("#tvu-timezone-setting").val(this.model.get("timezone"))},changeDateFormat:function(e){this.model.set("date_format",e.target.value)},changeTimeFormat:function(e){this.model.set("time_format",e.target.value)},changeTimeZone:function(e){this.model.set("timezone",e.target.value)},save:function(){if(this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);var e=this;this.model.save().done((function(t){TVE_Dash.hideLoader(),ThriveUlt.data.now=t.now,ThriveUlt.data.settings.timezone=e.model.get("timezone")})).error((function(){TVE_Dash.hideLoader()})).always((function(){e.close()}))}}),ThriveUlt.views.ModalEditLockDownSettings=TVE_Dash.views.Modal.extend({className:"tvd-modal-fixed-footer tvd-modal",template:TVE_Dash.tpl("modals/edit-lockdown"),events:{"click .tvu-save-lockdown-settings":"save","click .tve_ult_add_promotion_field":function(){this.addPromotionField()},"click .tve-ult-remove-button":"removePromotionField","change #tvu-autoresponder-type":"generateAllEmailLinks"},afterInitialize:function(){this.listenTo(this.collection,"add",(function(e){this.renderOnePromotion(e),this.renderOneLink(e)})),this.listenTo(this.collection,"remove",this.renderPromotionUrls)},afterOpen:function(){TVE_Dash.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))},afterRender:function(){this.renderPromotionUrls();var t=this,i=this.model,s=this.$("#tvu-lockdown-pre-access-url"),n=this.$("#tvu-lockdown-expired-url"),r=this.$("#tvu-autoresponder-type");this.$el.addClass("tvu-lockdown-modal"),i.set("lockdown",!0);var l={url:ThriveUlt.ajaxurl("action="+ThriveUlt.ajax_actions.admin_controller+"&route=progressiveGetPosts"),no_value_callback:function(){var t=e(this);i.get("lockdown_settings")[t.data("field")]=null},change_callback:function(){var s=e(this);i.get("lockdown_settings")[s.data("field")]={value:s.val()},"promotion"===s.data("field")&&t.$("#tvu-autoresponder-type").change()},select:function(s,n){var r=e(this);i.get("lockdown_settings")[r.data("field")]=n.item,"promotion"===r.data("field")&&t.$("#tvu-autoresponder-type").change()}};return new ThriveUlt.PostSearch(s,l),new ThriveUlt.PostSearch(n,l),this.collection.length>0&&r.find('option[value="'+i.get("lockdown_settings").service+'"]').attr("selected","seletced").select2(),r.change(),this},generateAllEmailLinks:function(t){var i=this.collection,s=e("option:selected",t.target).attr("data-tag"),n=this.$el;return i.each((function(e){if(e.get("link")){var t=e.get("link").split("tu_em=")[0],r=i.indexOf(e),l=t+"tu_em="+s;n.find("#tvu-email-link"+r).val(l),e.set("link",l,{silent:!0})}}),this),this.model.get("lockdown_settings").service=t.target.value,this},save:function(){this.tvd_clear_errors();var e=this,t=e.collection.cleanCollection();return this.model.get("lockdown_settings").promotion=e.collection,this.model.isValid()?0===!Object.keys(t).length?this.tvd_show_errors(this.model):(TVE_Dash.showLoader(),void this.model.save().done((function(){TVE_Dash.hideLoader();try{var t=ThriveUlt.globals.campaigns.findWhere({ID:e.model.get("ID")});t instanceof ThriveUlt.models.Campaign&&t.set(e.model.toJSON()),ThriveUlt.globals.campaign.set(e.model.toJSON())}catch(e){console.log("Error: "+e)}e.original_model.trigger("tve_ult_campaign_saved")})).error((function(){TVE_Dash.hideLoader()})).always((function(){e.close()}))):this.tvd_show_errors(this.model)},addPromotionField:function(){var e=new ThriveUlt.models.PromotionURLModel;this.collection.add(e),ZeroClipboard.Client.prototype.destroy(),this.$el.find(".zclip").remove(),TVE_Dash.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))},removePromotionField:function(t){var i=e(t.target).closest(".tvd-input-field").find(".tvu-promotion-url"),s=parseInt(i.prop("id").match(/\d+/g),10);this.collection.remove(this.collection.at(s))},renderPromotionUrls:function(){var e=this.collection;this.$el.find(".tve-ult-promotion-wrapper").empty(),this.$el.find(".tvu-url-to-copy-wrapper").empty(),e.each(this.renderOnePromotion,this),e.each(this.renderOneLink,this)},renderOnePromotion:function(e){var t=new ThriveUlt.views.LockdownPromotionURL({model:e,collection:this.collection,parent_model:this.model});this.$el.find(".tve-ult-promotion-wrapper").append(t.render().$el)},renderOneLink:function(e){var t=new ThriveUlt.views.LockdownServiceURL({model:e,collection:this.collection});this.$el.find(".tvu-url-to-copy-wrapper").append(t.render().$el)}}),ThriveUlt.views.ModalEditEvent=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/edit-event"),className:"tvd-modal tvd-modal-fixed-footer",events:function(){return _.extend({},ThriveUlt.views.ModalSteps.prototype.events,{"change #tvu-event-time":"setTime","change #tvu-event-unit":"setTime","click .tvu-event-save":"saveEvent"})},renderDesignItems:function(){var e=this.$("#tvu-event-designs");this.designs.each((function(t){e.append(new ThriveUlt.views.EventModalDesignItem({model:t}).render().$el)}))},afterRender:function(){this.renderDesignItems(),this.$el.addClass("tvu-add-timeline-event-modal"),this.steps=this.$el.find(this.stepClass).hide(),this.$actionsList=this.$el.find("#tvu-event-actions-list"),this.$triggerOptions=this.$el.find("#tvu-trigger-options"),this.model.get("type")!==ThriveUlt.event_type.start&&this.$triggerOptions.show();var e=parseInt(this.model.get("days"));return void 0!==this.model.get("hours")&&0!=this.model.get("hours")&&(this.$el.find("#tvu-event-unit").val("hours"),TVE_Dash.materialize(this.$el),e=24*parseInt(this.model.get("days"))+parseInt(this.model.get("hours"))),isNaN(e)||this.$el.find("#tvu-event-time").val(e),this},saveEvent:function(){if(this.tvd_clear_errors(),this.model.buildActionsFromDesigns(this.designs),!this.model.isValid())return this.tvd_show_errors();var e=this.model.validateTrigger(this.collection.findWhere({type:"start"}));if(e)return this.tvd_show_errors(e);TVE_Dash.showLoader();var t=this;this.model.save({},{success:function(e,i){if(TVE_Dash.hideLoader(),t.close(),e.get("ID")){var s=t.model.getDuration()===t.original_model.getDuration()?"edited":"duration_changed",n=t.collection.indexOf(t.original_model);t.model.set("label",null),t.original_model.set(e.attributes),t.original_model.set("status",s),t.collection.sort(),n===t.collection.indexOf(t.original_model)&&t.original_model.unset("status"),t.collection.trigger("update")}else e.set("ID",i.id),e.set("status","new"),t.collection.add(e)},error:function(e,t){TVE_Dash.err(t.responseText),TVE_Dash.hideLoader()}})},setTime:function(t){var i=e(t.currentTarget);i.is("input")?this.model.setTime(parseInt(i.val()),this.$el.find("#tvu-event-unit").val()):this.model.setTime(parseInt(this.$el.find("#tvu-event-time").val()),i.val())}}),ThriveUlt.views.ModalCopyCampaign=ThriveUlt.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/copy-campaign"),events:{"click .tvd-modal-submit":"save"},afterRender:function(){return this.$el.addClass("tvu-campaign-modal"),this.renderSettings(),this},renderSettings:function(){var e=this.model.get("type");this.settings_collection=new ThriveUlt.collections.RollingCollection,e||this.model.set("edit_mode","new"),this.model.set("settings_modal","modal"),ThriveUlt.views["CampaignType"+ThriveUlt.util.upperFirst(e)+"State"]&&(e==ThriveUlt.util.campaignType.evergreen&&(!1===ThriveUlt.data.lead_groups?this.settings_collection=null:(this.settings_collection=new ThriveUlt.collections.LeadGroupsCollection(ThriveUlt.data.lead_groups),this.shortcodes=new ThriveUlt.collections.ShortcodesCollection(ThriveUlt.data.shortcodes),this.thriveBoxes=new ThriveUlt.collections.ThriveBoxesCollection(ThriveUlt.data.thrive_boxes))),new(ThriveUlt.views["CampaignType"+ThriveUlt.util.upperFirst(e)+"State"])({el:this.$el.find("#tvu-campaign-type-options"),model:this.model,collection:this.settings_collection,shortcodes:this.shortcodes,thriveBoxes:this.thriveBoxes,thriveQuizzes:ThriveUlt.data.tqb_optin}).render())},save:function(){if(this.model.get("type")==ThriveUlt.util.campaignType.rolling){var e=this.settings_collection.getIDsArray();this.model.get("rolling_type")||this.model.set("rolling_type","daily"),this.model.get("settings").repeatOn=e}if(this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);var t=this;TVE_Dash.showLoader(),this.model.cleanModel(),this.model.save().done((function(e){t.model.set("ID",e),t.model.set("post_title",ThriveUlt.t.Copy_of+t.model.get("post_title")),t.model.set("status",ThriveUlt.util.status.paused),t.model.set("chart_data",""),t.model.unset("copy"),t.collection.add(t.model,{at:t.collection.length}),TVE_Dash.hideLoader()})).error((function(){TVE_Dash.hideLoader()})).always((function(){t.close()}))}}),ThriveUlt.views.ModalNewCampaign=ThriveUlt.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/new-campaign"),events:function(){return _.extend({},ThriveUlt.views.ModalSteps.prototype.events,{"click .tvu-new-campaign-tpl":function(t){var i=e(t.target).parents(),s=this.$el.find(".tvu-new-campaign-tpl").parents();ThriveUlt.select_card(i,s,"tvu-selected-design"),this.model.set("tpl",t.target.dataset.id),this.renderDescription()},"click .tvd-modal-submit":"save"})},afterInitialize:function(){this.listenTo(this.model,"change:tpl",_.bind((function(){var e=this.data.templates.findWhere({id:this.model.get("tpl")});this.model.set("post_title",e.get("is_empty")?"":e.get("name"))}),this))},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this.renderTemplates(),this.renderDescription(),ThriveUlt.util.data_binder(this),this},renderTemplates:function(){var e=this.$el.find(".tvu-new-campaign-templates");return e.empty(),this.data.templates.each((function(t,i){e.append(TVE_Dash.tpl("modals/new-campaign-tpl",{item:t,index:i+1}))}),this),this},renderDescription:function(){var e=this.$el.find(".tvu-new-campaign-description"),t=this.model.get("tpl");if(t){var i=this.data.templates.at(t);e.empty().append("<span>"+i.get("description")+"</span>")}},next:function(){if(!this.model.get("tpl"))return TVE_Dash.err(ThriveUlt.t.CampaignMissingTemplate);this.gotoStep(this.currentStep+1)},save:function(){if(this.model.set("skip_settings_validation",!0),this.model.isValid()){var e=this;TVE_Dash.showLoader(),this.model.set("template_values",!0),this.model.save().done((function(t){e.model.set("ID",t),e.collection.add(e.model,{at:e.collection.length}),ThriveUlt.globals.campaigns.add(e.model,{at:e.collection.length}),e.close(),ThriveUlt.router.navigate("#dashboard/campaign/"+t,{trigger:!0})})).error((function(){TVE_Dash.hideLoader()})).always((function(){TVE_Dash.showLoader()}))}}}),ThriveUlt.views.ModalConversionEvent=ThriveUlt.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/new-conversion-event"),events:function(){return _.extend({},ThriveUlt.views.ModalSteps.prototype.events,{"change #tvu-select-campaign-trigger":"changeTriggers","change #tvu-select-campaign-event":"changeEvents","click #tvu-add-evergreen-campaign":"addEvergreenCampaign","click .tvu-continue-events":"showEvents","click .tvu-save-new-evergreen-campaign":"createEvergreenCampaign","click #tvu-new-campaign-repeat-campaign-switch":"toggleEndCampaign","click .tvu-save-new-conversion-event":"save"})},afterInitialize:function(){this.listenTo(ThriveUlt.globals.campaigns,"add",this.renderEvents)},afterRender:function(){return this.$el.addClass("tvu-conversion-event-modal"),this.renderTriggers(),this.renderEvents(),this.renderSummary(),this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),TVE_Dash.materialize(this.$el),this.$el.find("select").select2().each((function(){var t=e(this);t.on("select2:open",(function(){t.data("select2").$dropdown.addClass("tvu-conversion-event-select")}))})),this},renderSummary:function(){new ThriveUlt.views.ConversionSummary({el:this.$el.find("#tvu-trigger-description"),model:this.model}).render()},renderTriggers:function(){var e=this.model.get("trigger_options").trigger,t=new ThriveUlt.collections.LeadGroupsCollection,i=new ThriveUlt.collections.ShortcodesCollection,s=new ThriveUlt.collections.ThriveBoxesCollection;if(ThriveUlt.data.lead_groups&&t.reset(ThriveUlt.data.lead_groups),ThriveUlt.data.shortcodes&&i.reset(ThriveUlt.data.shortcodes),ThriveUlt.data.thrive_boxes&&s.reset(ThriveUlt.data.thrive_boxes),e&&0!==parseInt(e)){var n=new(ThriveUlt.views["TriggerType"+ThriveUlt.util.upperFirst(e)])({el:this.$el.find("#tvu-conversion-triggers"),model:this.model,collection:t,shortcodes:i,thriveBoxes:s,thriveQuizzes:ThriveUlt.data.tqb_optin});n.render(),n.$el.hide().fadeIn().slideDown()}},renderEvents:function(){var e=this.model.get("trigger_options").event,t=new ThriveUlt.collections.Campaigns(ThriveUlt.globals.campaigns.where({type:ThriveUlt.util.campaignType.evergreen}));if(t.length>0){var i=t.findWhere({ID:parseInt(this.model.get("campaign_id"))});t.remove(i)}e&&0!==parseInt(e)&&((e=new(ThriveUlt.views["EventType"+ThriveUlt.util.upperFirst(e)])({el:this.$el.find("#tvu-conversion-events"),model:this.model,collection:t})).render(),e.$el.hide().fadeIn().slideDown())},changeTriggers:function(e){this.model.get("trigger_options").trigger=e.target.value,this.renderTriggers(),this.renderEvents(),this.renderSummary()},changeEvents:function(e){this.model.get("trigger_options").event=e.target.value,"move"!==e.target.value&&this.model.get("trigger_options").end_id&&(this.model.get("trigger_options").end_id_old=this.model.get("trigger_options").end_id),this.renderTriggers(),this.renderEvents(),this.renderSummary(),this.gotoStep(1)},save:function(){var e=this;if(this.model.get("trigger_options").event===ThriveUlt.util.conversion_event.end&&(this.model.get("trigger_options").end_id=""),!this.model.isValid())return this.tvd_show_errors();TVE_Dash.showLoader(),this.model.save({},{success:function(t,i){e.model.get("ID")?e.original_model.set(t.attributes):(e.model.set("ID",i.id),e.collection.add(e.model)),e.close(),TVE_Dash.hideLoader()},error:function(e,t){TVE_Dash.err(t.responseText),TVE_Dash.hideLoader()}})},showEvents:function(){var e=this.model.validateTrigger();if(e)return this.tvd_show_errors(e);this.next()},addEvergreenCampaign:function(){this.next()},toggleEndCampaign:function(){this.$el.find(".tvu-repeat-wrapper").toggle()},createEvergreenCampaign:function(){var e=new ThriveUlt.models.Campaign({order:ThriveUlt.globals.campaigns.length}),t=this,i=this.$el.find("#tvu-new-campaign-name").val(),s=this.$el.find("#tvu-new-campaign-days").val(),n=this.$el.find("#tvu-new-campaign-expire").val(),r="";this.$el.find(".tvu-new-campaign-repeat-switch").is(":checked")?r=0:(r=1,n="");var l={duration:s,end:n,repeat:r,real:1,realtime:"00:00",trigger:{type:"",ids:""},redirect:0};if(e.set({post_title:i,type:ThriveUlt.util.campaignType.evergreen,tpl:1,edit_mode:"evergreen",settings:l}),e.cleanModel(),this.tvd_clear_errors(),!e.isValid())return this.tvd_show_errors(e);TVE_Dash.showLoader(),e.save({},{success:function(i,s){var n=t.model.get("trigger_options").end_id;e.set("ID",s),t.model.get("ID")&&(t.model.get("trigger_options").end_id_old=n),t.model.get("trigger_options").end_id=s,ThriveUlt.globals.campaigns.add(e),TVE_Dash.hideLoader(),t.gotoStep(1)},error:function(e,t){TVE_Dash.err(t.responseText),TVE_Dash.hideLoader()}})}}),ThriveUlt.views.TopRibbonModal=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/top-ribbon"),tempPosition:"",events:{"click .tvd-modal-submit":"save","click .tu-display-option":"selectDisplayOption"},afterRender:function(){this.$options=this.$(".tu-display-option"),this.tempPosition=this.model.get("tcb_fields").display_position||"push_content",this.setActivePosition()},setActivePosition:function(){this.$options.removeClass("active"),this.$options.filter('[data-value="'.concat(this.tempPosition,'"]')).addClass("active")},selectDisplayOption:function(t){this.tempPosition=e(t.currentTarget).data("value"),this.setActivePosition()},save:function(){var e=this;this.model.set("display_position",this.tempPosition),this.model.isValid()&&(TVE_Dash.showLoader(),this.model.set("template_values",!0),this.model.save().done((function(){e.close(),TVE_Dash.hideLoader()})).error((function(){TVE_Dash.hideLoader()})))}}),ThriveUlt.views.ModalShortcodeCode=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/get-shortcode"),afterOpen:function(){TVE_Dash.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))}})}))}(jQuery),(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}window.ThriveUlt=window.ThriveUlt||{},ThriveUlt.views=ThriveUlt.views||{},function(t){function i(e){if(e.model.has("display_settings"))return ThriveUlt.objects.hangers=e.model.get("display_settings"),ThriveUlt.objects.savedTemplates=e.model.get("display_settings_tpl"),void TVE_Dash.modal(ThriveUlt.views.CampaignSettings,{model:e.model,"max-width":"90%",width:"80%",collection:e.model.get("display_settings")});TVE_Dash.showLoader(),t.ajax({url:e.model.getDisplaySettingsUrl(),data:{_nonce:ThriveUlt.admin_nonce},dataType:"json"}).done((function(t){ThriveUlt.objects.savedTemplates=new ThriveUlt.models.TemplateList(t.savedTemplates),ThriveUlt.objects.hangers=new ThriveUlt.collections.Hangers(t.hangers),TVE_Dash.modal(ThriveUlt.views.CampaignSettings,{model:e.model,"max-width":"90%",width:"80%",collection:ThriveUlt.objects.hangers})})).fail((function(e){console.error&&console.error(arguments)})).always((function(){setTimeout((function(){TVE_Dash.hideLoader()}),300)}))}t((function(){Backbone.View.prototype.tvd_clear_errors=function(){return this.$(".tvd-invalid").removeClass("tvd-invalid"),this.$("select").trigger("tvdclear"),this},Backbone.View.prototype.refreshTime=function(){this.$(".tu-time").html(ThriveUlt.data.now),this.$(".tu-timezone").html(ThriveUlt.data.settings.timezone)},Backbone.View.prototype.tvd_show_errors=function(e){if(e=e||this.model){var i=e instanceof Backbone.Model?e.validationError:e,s=this,n=t();return t.isArray(i)?_.each(i,(function(e){r(e)})):r(i),n.not(".tvd-no-focus").first().focus(),this.scroll_first_error(n.first()),this}function r(e){if("string"==typeof e)return TVE_Dash.err(e);n=n.add(s.$("[data-field="+e.field+"]").addClass("tvd-invalid").each((function(){var i=t(this);i.is("select")?i.trigger("tvderror",e.message):i.next("label").attr("data-error",e.message)})))}},Backbone.View.prototype.scroll_first_error=function(e){if(!(this instanceof TVE_Dash.views.Modal&&e.length))return this;var t=e.offset().top,i=this.$_content.offset().top,s=this.$_content.scrollTop(),n=this.$_content.outerHeight();if(t>=i&&t<n+i-50)return this;this.$_content.animate({scrollTop:s+t-i-40},200,"swing")},ThriveUlt.views.Base=Backbone.View.extend({render:function(){return this},modal:function(e,t){return TVE_Dash.modal(e,t)}}),ThriveUlt.views.Header=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("header"),events:{"click #date_time_settings":"openSettingsModal"},render:function(){return this.$el.html(this.template({})),TVE_Dash.materialize(this.$el),this},openSettingsModal:function(){this.modal(ThriveUlt.views.ModalEditDateSettings,{model:this.model,width:"1200px","max-width":"80%"})}}),ThriveUlt.views.Dashboard=ThriveUlt.views.Base.extend({className:"tvd-container",template:TVE_Dash.tpl("dashboard"),events:{"click .tvu-add-new-campaign":"addNew"},addNew:function(){return this.modal(ThriveUlt.views.ModalNewCampaign,{model:new ThriveUlt.models.Campaign({order:this.collection.length}),collection:this.collection,"max-width":"60%",width:"750px",in_duration:200,out_duration:0,templates:new Backbone.Collection(ThriveUlt.campaign_templates)}),this},initialize:function(){this.listenTo(this.collection,"add",this.toggleNoCampaignText),this.listenTo(this.collection,"remove",this.toggleNoCampaignText)},render:function(){return this.$el.html(this.template({})),new ThriveUlt.views.CampaignsList({el:this.$el.find("#tvu-campaigns-list"),collection:this.collection}).render(),this.toggleNoCampaignText(),TVE_Dash.hideLoader(),this},toggleNoCampaignText:function(){this.collection.length?this.$el.find("#tvu-no-campaign-text").hide():this.$el.find("#tvu-no-campaign-text").show()}}),ThriveUlt.views.ArchivedCampaigns=ThriveUlt.views.Dashboard.extend({template:TVE_Dash.tpl("campaign/archived")}),ThriveUlt.views.CampaignsList=ThriveUlt.views.Base.extend({events:{"click .tvu-add-campaign":"addNew"},initialize:function(){this.listenTo(this.collection,"add",this.renderOne)},itemViews:[],render:function(){function e(e,i){var s=t(i.placeholder),n=s.prevAll().not(i.item).length+1;s.html("<div class='tvu-inside-placeholder'><span>"+n+(ThriveUlt.t.n_suffix[n]?ThriveUlt.t.n_suffix[n]:ThriveUlt.t.n_th)+" "+ThriveUlt.t.priority+"</span></div>")}return this.collection.each(this.renderOne,this),this.$el.sortable({placeholder:"ui-sortable-placeholder",items:".tvu-campaign-item",forcePlaceholderSize:!0,handle:".tvu-drag-card",update:_.bind(this.updateOrder,this),tolerance:"pointer",change:e,start:function(i,s){e(0,s),t("body").addClass("tvu-sorting")},stop:function(){setTimeout((function(){t("body").removeClass("tvu-sorting")}),200)}}),this},renderOne:function(e){var t=this.$el.find(".tvu-campaign-item").last(),i=new ThriveUlt.views.Campaign({model:e,collection:this.collection});return t.length?t.after(i.render().$el):this.$el.prepend(i.render().$el),this.itemViews.push(i),this},updateOrder:function(){var e={};_.each(this.itemViews,(function(t){t.model.get("order")!=t.$el.index()&&(t.model.set("order",t.$el.index()),e[t.model.get("ID")]=t.$el.index())})),this.collection.sort(),t.ajax({type:"post",url:ajaxurl,data:{action:ThriveUlt.ajax_actions.admin_controller,route:"campaigns",custom:"update_order",new_order:e,_nonce:ThriveUlt.admin_nonce}})},addNew:function(){return this.modal(ThriveUlt.views.ModalNewCampaign,{model:new ThriveUlt.models.Campaign({order:this.collection.length}),collection:this.collection,"max-width":"60%",width:"750px",in_duration:200,out_duration:0,templates:new Backbone.Collection(ThriveUlt.campaign_templates)}),this}}),ThriveUlt.views.Campaign=ThriveUlt.views.Base.extend({events:{"click .tvu-campaign-status":"changeStatus","click .tvu-archive-campaign":"toggle_archive"},initialize:function(){this.listenTo(this.model,"change:state",this.renderState),this.listenTo(this.model,"change:status",this.renderStatus)},render:function(){return this.renderState(),this},renderState:function(){var e=this.model.get("state");if(this.model.get("status")===ThriveUlt.util.status.archived&&(e=ThriveUlt.util.status.archived),ThriveUlt.views["Campaign"+ThriveUlt.util.upperFirst(e)+"State"]){var t=new(ThriveUlt.views["Campaign"+ThriveUlt.util.upperFirst(e)+"State"])({model:this.model,collection:this.collection});return t.render(),this.$el.replaceWith(t.$el),this.setElement(t.$el),this}},changeStatus:function(){var e,t;switch(this.model.get("status")){case ThriveUlt.util.status.paused:e=ThriveUlt.util.status.running,t=ThriveUlt.t.Campaign_started;break;case ThriveUlt.util.status.running:e=ThriveUlt.util.status.paused,t=ThriveUlt.t.Campaign_paused;break;default:return}TVE_Dash.showLoader(),this.model.saveStatus(e).done((function(i){e===ThriveUlt.util.status.paused?TVE_Dash.err(t):TVE_Dash.success(t),TVE_Dash.hideLoader()})).fail((function(e){TVE_Dash.err(e.responseText),TVE_Dash.hideLoader()}))},renderStatus:function(){""!=this.model.get("status")&&(this.$(".tvu-campaign-status").addClass("tvd-hide"),this.$(".tvu-campaign-status-"+this.model.get("status")).removeClass("tvd-hide"))},toggle_archive:function(e){var i=this,s=t(e.currentTarget).data(),n=!1===s.archived?ThriveUlt.util.status.archived:ThriveUlt.util.status.paused,r=this.model.get("post_title"),l=!1===s.archived?ThriveUlt.util.printf(ThriveUlt.t.campaign_archived,[r]):ThriveUlt.util.printf(ThriveUlt.t.campaign_restored,[r]);TVE_Dash.showLoader(),this.model.saveStatus(n).done((function(){i.collection.remove(i.model),i.remove(),TVE_Dash.success(l),TVE_Dash.hideLoader()})).fail((function(e){TVE_Dash.err(e.responseText),TVE_Dash.hideLoader()}))}}),ThriveUlt.views.CampaignNormalState=ThriveUlt.views.Base.extend({className:"tvd-col tvd-s6 tvd-ms6 tvd-m4 tvd-l3 tvu-campaign-item",template:TVE_Dash.tpl("campaign/item"),events:{"click .tvu-delete-campaign":function(){this.$el.live_tooltip("destroy");var e=this.collection.findWhere({state:"delete"});e&&e.set("state",ThriveUlt.util.states.normal),this.model.set("state",ThriveUlt.util.states.delete)},"click .tvu-copy-campaign":"copy","click .tvu-campaign-display":"openDisplaySettings","click .tvu-edit-campaign-title":"editTitle"},render:function(){return this.$el.html(this.template({item:this.model})),this.$campaignTitle=this.$el.find(".tvd-card-title"),this.model.load_chart_data(_.bind(this.chart,this)),this},copy:function(){var e=this.model.deepClone();e.set("copy",e.get("ID")),e.set("ID","",{silent:!0}),e.set("order",this.collection.length,{silent:!0}),e.set("impressions",0),e.set("conversion_rate",0),e.set("conversion_events",""),e.set("has_event_logs",!1),this.modal(ThriveUlt.views.ModalCopyCampaign,{model:e,collection:this.collection,"max-width":"60%",width:"800px"})},editTitle:function(){var e=this,t=this.$el.find(".tvu-edit-campaign-title"),i=new Backbone.Model({value:this.model.get("post_title"),label:ThriveUlt.t.Campaign_name,required:!0});t.hide(),i.on("change:value",(function(){e.saveTitle.apply(e,arguments),e.$campaignTitle.show(),s.remove(),t.show()})),i.on("tvu_no_change",(function(){e.$campaignTitle.html(e.model.get("post_title")).show(),s.remove(),t.show()}));var s=new ThriveUlt.views.TextEdit({model:i,tagName:"div"});this.$campaignTitle.hide().after(s.render().$el),s.focus()},saveTitle:function(e,t){var i=this;this.model.set({post_title:t,skip_settings_validation:!0}),i.$campaignTitle.html(t);var s=this.model.save();s&&s.always((function(){i.$campaignTitle.html(t),i.model.set("skip_settings_validation",!1)}))},openDisplaySettings:function(){i(this)},chart:function(e){var t=!0,i=this.$(".tvu-chart-no-data").clone();(!e||e.impressions.length<2)&&(t=!1,e=this.model.get_chart_dummy_data());var s=[{title:{text:ThriveUlt.t.No_of_impressions}}],n=[{name:ThriveUlt.t.Impressions,type:"line",data:e.impressions}];e.conversions&&(s.push({labels:{format:"{value}"},title:{text:ThriveUlt.t.No_of_conversions},opposite:!0}),n.push({name:ThriveUlt.t.Conversions,type:"line",yAxis:1,data:e.conversions,tooltip:{valueSuffix:""}})),setTimeout(_.bind((function(){this.$(".tvu-campaign-chart").highcharts({colors:t?["#3498db","#47bb28"]:["#fff","#fff"],credits:{enabled:!1},plotOptions:{line:{marker:{enabled:!1}}},title:{text:" "},xAxis:{categories:e.labels,labels:{enabled:!1}},yAxis:s,tooltip:{shared:!0},legend:{enabled:!1},series:n}),t||this.$(".tvu-campaign-chart").addClass("tvd-relative tvu-blurred").append(i.removeClass("tvd-hide"))}),this))}}),ThriveUlt.views.CampaignArchivedState=ThriveUlt.views.CampaignNormalState.extend({template:TVE_Dash.tpl("campaign/archived-item")}),ThriveUlt.views.CampaignDeleteState=ThriveUlt.views.Base.extend({className:"tvd-col tvd-s6 tvd-m4 tvd-ms6 tvd-l3 tvu-campaign-item",template:TVE_Dash.tpl("campaign/delete-state"),events:{"click .tvu-delete-no":function(){this.model.set("state",ThriveUlt.util.states.normal)},"click .tvu-delete-yes":"yes",keydown:"keyAction"},initialize:function(){this.listenTo(this.collection,"remove",this.remove)},render:function(){this.$el.html(this.template({item:this.model}));var e=this;return _.defer((function(){e.$(".tve-delete-campaign-card").focus()})),this},keyAction:function(e){var t=e.which;13==t?this.yes():27==t&&this.model.set("state",ThriveUlt.util.states.normal)},yes:function(){TVE_Dash.cardLoader(this.$el),this.model.destroy({wait:!0,success:function(){TVE_Dash.hideLoader()},error:function(){TVE_Dash.hideLoader()}})}}),ThriveUlt.views.EditCampaign=ThriveUlt.views.Base.extend({className:"tvd-container",template:TVE_Dash.tpl("campaign/edit"),timeline_view:null,conversion_view:null,events:{"click .tvu-add-design":"addDesign","click .tvu-edit-campaign-title":"editTitle","click .tvu-campaign-status":"changeStatus","click .tvu-edit-campaign":"editCampaignType","click .tvu-display-settings":"openDisplaySettings","click .tvu-lockdown":"openLockdownSettings","click .tvu-disable-lockdown":"disableLockdown"},initialize:function(){this.listenTo(this.model.get("designs"),"add",this.render),this.listenTo(this.model.get("designs"),"remove",this.render),this.listenTo(this.model.get("designs"),"remove",this.removeEventActions),this.listenTo(this.model,"change:summary",this.changeSettings),this.listenTo(this.model,"change:type",this.render),this.listenTo(this.model,"change:lockdown_state",this.renderLockdown),this.listenTo(this.model,"change:lockdown",this.render),this.listenTo(this.model,"change:status",this.renderStatus),this.listenTo(this.model,"change:display_settings_summary",this.render),this.listenTo(this.model,"tve_ult_campaign_saved",this.onCampaignSaved),this.listenTo(this.model.get("timeline"),"reset",this.renderTimeline)},onCampaignSaved:function(){this.fetchEvents(),this.render()},render:function(){this.$el.html(this.template({item:this.model})),this.$designList=this.$el.find("#tvu-designs-list"),this.$campaignTitle=this.$el.find(".tvu-campaign-title"),this.$campaignStatus=this.$el.find(".tvu-campaign-status");var e=this.model.get("status"),t=this.model;return ThriveUlt.data.shortcodes&&ThriveUlt.data.lead_groups||this.model.get("settings").trigger.type===ThriveUlt.util.triggerType.conversion&&e===ThriveUlt.util.status.running&&(e=ThriveUlt.util.status.paused,this.model.saveStatus(e).done((function(e){t.set("status",ThriveUlt.util.status.paused),TVE_Dash.err(ThriveUlt.t.leads_missing_paused,6e3)})).fail((function(e){TVE_Dash.err(e.responseText,6e3)}))),e||(e=ThriveUlt.util.status.paused),this.$campaignStatus.html(e),this.changeSettings(),this.model.get("designs").each(_.bind(this.renderDesign,this)),this.renderTimeline(),this.renderConversionEvents(),this.renderLockdown(),""==this.model.get("status")&&this.model.set("status",ThriveUlt.util.status.paused),TVE_Dash.materialize(this.$el),this},renderDesign:function(e){if(this.$designList.length){var t=this.$designList.find(".tvu-design-item").last(),i=new ThriveUlt.views.Design({model:e,collection:this.model.get("designs")});return i.render(),t.length?t.after(i.$el):this.$designList.prepend(i.$el),this}},addDesign:function(){this.modal(ThriveUlt.views.ModalAddDesign,{model:this.model,"max-width":"50%"})},openDisplaySettings:function(){i(this)},renderLockdown:function(){var e=this.model.get("lockdown_state");e||(e=this.model.set("lockdown_state",ThriveUlt.util.states.normal)),new(ThriveUlt.views["Lockdown"+ThriveUlt.util.upperFirst(e)+"State"])({model:this.model,el:this.$el.find("#tvd-lockdown-wrapper")[0]}).render()},openLockdownSettings:function(){if(!this.model.has_valid_lockdown_trigger())return!1;var e=new ThriveUlt.models.Campaign(t.extend(!0,{},this.model.toJSON())),i=new ThriveUlt.collections.PromotionURLCollection;this.model.get("lockdown_settings").promotion.each((function(e){i.add(new ThriveUlt.models.PromotionURLModel(e.toJSON()))})),this.modal(ThriveUlt.views.ModalEditLockDownSettings,{model:e,collection:i,original_model:this.model,original_collection:this.model.get("lockdown_settings").promotion,width:"800px","max-width":"60%"})},disableLockdown:function(){this.model.set("lockdown_state",ThriveUlt.util.states.delete)},editCampaignType:function(){var e=new ThriveUlt.models.Campaign(t.extend(!0,{},this.model.toJSON()));this.modal(ThriveUlt.views.ModalEditCampaignType,{model:e,original_model:this.model,collection:this.model.get("settings_collection"),width:"800px","max-width":"60%"})},changeStatus:function(){var e,t;switch(this.model.get("status")){case ThriveUlt.util.status.paused:e=ThriveUlt.util.status.running,t=ThriveUlt.t.Campaign_started;break;case ThriveUlt.util.status.running:e=ThriveUlt.util.status.paused,t=ThriveUlt.t.Campaign_paused;break;default:return}TVE_Dash.showLoader(),this.model.saveStatus(e).done((function(i){e===ThriveUlt.util.status.paused?TVE_Dash.err(t):TVE_Dash.success(t),TVE_Dash.hideLoader()})).fail((function(e){TVE_Dash.err(e.responseText),TVE_Dash.hideLoader()}))},renderStatus:function(){try{var e=ThriveUlt.globals.campaigns.findWhere({ID:this.model.get("ID")});e instanceof ThriveUlt.models.Campaign&&e.set("status",this.model.get("status"))}catch(e){console.log("Error: "+e)}this.render()},editTitle:function(){var e=this,t=this.$el.find(".tvu-edit-campaign-title"),i=new Backbone.Model({value:this.model.get("post_title"),label:ThriveUlt.t.Campaign_name,required:!0});t.hide(),i.on("change:value",(function(){e.saveTitle.apply(e,arguments),e.$campaignTitle.show(),s.remove(),t.show()})),i.on("tvu_no_change",(function(){e.$campaignTitle.html(e.model.get("post_title")).show(),s.remove(),t.show()}));var s=new ThriveUlt.views.TextEdit({model:i,tagName:"div"});this.$campaignTitle.hide().after(s.render().$el),s.focus()},saveTitle:function(e,t){var i=this;try{var s=ThriveUlt.globals.campaigns.findWhere({ID:this.model.get("ID")});s instanceof ThriveUlt.models.Campaign&&s.set("post_title",t)}catch(e){console.log("Error: "+e)}this.model.set({post_title:t,skip_settings_validation:!0}),i.$campaignTitle.html(t);var n=this.model.save();n&&n.always((function(){i.$campaignTitle.html(t),i.model.set("skip_settings_validation",!1)}))},changeSettings:function(e){void 0===e&&(e=this.model);var t=e.get("summary"),i=e.get("type");i&&(this.updateDashboardCampaignType(),this.$el.find(".tvu-campaign-type-title").text(ThriveUlt.util.get_type_title(i)),this.$el.find(".tvu-campaign-icon").html('<img width="55" src="'+ThriveUlt.plugin_url+"admin/img/tvd-"+i+'-campaign.png"/>'),t?this.$el.find(".tvu-campaign-type").text(t):e.getSummary())},displaySettingsChanged:function(){this.$el.find("#tvu-display-summary").html(this.model.get("display_settings_summary"))},removeEventActions:function(e){this.model.get("timeline").removeEvents(e),this.renderTimeline()},renderTimeline:function(){this.timeline_view?this.timeline_view.setElement(this.$("#tvu-timeline-wrapper")[0]):this.timeline_view=new ThriveUlt.views.Timeline({model:this.model,el:this.$("#tvu-timeline-wrapper")[0],collection:this.model.get("timeline")}),this.timeline_view.render()},renderConversionEvents:function(){this.conversion_view?this.conversion_view.setElement(this.$("#tvu-conversion-wrapper")[0]):this.conversion_view=new ThriveUlt.views.ConversionEvents({model:this.model,el:this.$("#tvu-conversion-wrapper")[0],collection:this.model.get("conversion_events")}),this.conversion_view.render()},updateDashboardCampaignType:function(){try{var e=ThriveUlt.globals.campaigns.findWhere({ID:this.model.get("ID")});e instanceof ThriveUlt.models.Campaign&&e.set("type",this.model.get("type"))}catch(e){console.log("Error: "+e)}},fetchEvents:function(){this.model.get("timeline").fetch({reset:!0,data:{campaign_id:this.model.get("ID")}})}}),ThriveUlt.views.LockdownNormalState=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/lockdown/normal-state"),render:function(){return this.$el.html(this.template({item:this.model})),this}}),ThriveUlt.views.LockdownPromotionURL=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/lockdown/promotion-url"),className:"tvd-input-field",initialize:function(e){this.parent_model=e.parent_model,this.listenTo(this.model,"change",this.collection.generateEmailLink)},render:function(){var e=this.model,i=this.collection,s=this.collection.indexOf(this.model);this.$el.empty().append(this.template({model:e,key:s}));var n={url:ThriveUlt.ajaxurl("action="+ThriveUlt.ajax_actions.admin_controller+"&route=progressiveGetPosts"),no_value_callback:function(){e.set(e.defaults)},change_callback:function(){var i=t(this);e.set({value:i.val()})},select:function(t,i){e.set(i.item)},collection:i};return new ThriveUlt.PostSearch(this.$el.find("#tvu-promotion-url"+s),n),this}}),ThriveUlt.views.LockdownServiceURL=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/lockdown/link-generation"),className:"tvd-copy-row control-grid tvd-no-mb tvu-url-container",initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change",this.bindZclip)},render:function(){var e=this.collection.indexOf(this.model);return this.$el.empty().append(this.template({model:this.model,key:e})),this},bindZclip:function(){ZeroClipboard.Client.prototype.destroy(),this.$el.find(".zclip").remove(),TVE_Dash.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))}}),ThriveUlt.views.LockdownDeleteState=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/lockdown/delete-state"),events:{"click .tvu-delete-no":"switchNormal","click .tvu-delete-yes":"save"},render:function(){return this.$el.html(this.template({item:this.model})),this},switchNormal:function(){this.model.set("lockdown_state",ThriveUlt.util.states.normal)},save:function(){this.model.set("lockdown",""),this.model.get("settings").trigger.type=ThriveUlt.util.triggerType.first;var e=this;TVE_Dash.showLoader(),this.model.save().done((function(){TVE_Dash.hideLoader();try{ThriveUlt.globals.campaign.set(e.model.toJSON())}catch(e){console.log("Error: "+e)}})).error((function(){TVE_Dash.hideLoader()})),this.switchNormal()}}),ThriveUlt.views.CampaignTypeAbsoluteState=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/type/absolute-state"),events:{"change #tvu-end-date":"setEndDate","change #tvu-start-date":"setStartDate"},default_settings:{end:{time:"00:00"},start:{time:"00:00"}},initialize:function(){var e=t.extend(!0,this.default_settings,this.model.get("settings"));this.model.set("settings",e)},render:function(){var e=this.model;return this.$el.html(this.template({item:this.model.get("settings")})),TVE_Dash.materialize(this.$el),this.$el.find("#tvu-start-date, #tvu-end-date").pickadate({format:"d mmmm yyyy",selectYears:!0,selectMonths:!0}),this.$el.find("#tvu-start-hour").timepicker({timeFormat:"HH:mm",dynamic:!1,interval:60,change:function(){var i=t(this).removeClass("tvd-invalid").val(),s=t(this),n=e.roundTime(i);s.val(n),e.get("settings").start.time=n}}),this.$el.find("#tvu-end-hour").timepicker({timeFormat:"HH:mm",dynamic:!1,interval:60,change:function(){var i=t(this).removeClass("tvd-invalid").val(),s=t(this),n=e.roundTime(i);s.val(n),e.setTime(n)}}),this.refreshTime(),this},setStartDate:function(e){t(e.target).removeClass("tvd-invalid"),this.model.get("settings").start.date=e.target.value},setEndDate:function(i){if(t(i.target).removeClass("tvd-invalid"),"object"===e(this.model.get("settings").end))this.model.get("settings").end.date=i.target.value;else{var s={date:i.target.value,time:""};this.model.get("settings").end=s}}}),ThriveUlt.views.CampaignTypeRollingState=ThriveUlt.views.Base.extend({className:"tvu-campaign-option tvu-campaign-rolling",template:TVE_Dash.tpl("campaign/type/rolling-state"),default_settings:{start:{time:"00:00"},end:{time:"00:00"}},events:{"change select.tvu-rolling-repeat":"changeDescription","change #tvu-select-recurrence-change":"changeRollingState","click #tve-rolling-end-never":function(){this.$("#tvu-end-date").removeClass("tvd-invalid").val(""),this.$('label[for="tvu-end-date"]').removeClass(),this.$("#tvu-end-hour").removeClass("tvd-invalid").val(""),this.$('label[for="tvu-end-hour"]').removeClass(),this.$("#tvu-rolling-end-after-in").removeClass("tvd-invalid").val(""),this.$('label[for="tvu-rolling-end-after-in"]').removeClass("tvd-active"),this.model.get("settings").end=null},"click #tve-rolling-end-after":function(){this.$("#tvu-end-date").removeClass("tvd-invalid").val(""),this.$('label[for="tvu-end-date"]').removeClass(),this.$("#tvu-end-hour").removeClass("tvd-invalid").val(""),this.$('label[for="tvu-end-hour"]').removeClass();var e=this.$("#tvu-rolling-end-after-in");e.focus(),"string"!=typeof this.model.get("settings").end&&(this.model.get("settings").end="1",e.val("1"))},"change #tvu-rolling-end-after-in":function(e){this.model.get("settings").end=e.target.value},"click #tvu-rolling-end-after-in":function(){this.$("#tvu-end-date").removeClass("tvd-invalid").val(""),this.$('label[for="tvu-end-date"]').removeClass(),this.$("#tvu-end-hour").removeClass("tvd-invalid").val(""),this.$('label[for="tvu-end-hour"]').removeClass(),this.$("#tve-rolling-end-after").attr("checked","checked"),"string"!=typeof this.model.get("settings").end&&(this.model.get("settings").end="1",this.$("#tvu-rolling-end-after-in").val("1"))},"click #tve-rolling-end-on":function(){this.$el.find("#tvu-end-date").trigger("click").focus()},"click #tvu-end-date":function(){this.$("#tvu-rolling-end-after-in").removeClass("tvd-invalid").val(""),this.$('label[for="tvu-rolling-end-after-in"]').removeClass("tvd-active"),this.$("#tve-rolling-end-on").attr("checked","checked"),null!==this.model.get("settings").end&&"object"===e(this.model.get("settings").end)||(this.model.get("settings").end={date:"",time:""})},"change #tvu-end-date":function(e){t(e.target).removeClass("tvd-invalid"),this.model.get("settings").end.date=e.target.value},"click #tvu-end-hour":function(e){this.$("#tvu-rolling-end-after-in").removeClass("tvd-invalid").val(""),this.$('label[for="tvu-rolling-end-after-in"]').removeClass("tvd-active"),this.$("#tve-rolling-end-on").attr("checked","checked"),t(e.target).removeClass("tvd-invalid")},"change #tvu-end-hour":function(e){t(e.target).removeClass("tvd-invalid")},"change #tvu-start-date":function(e){t(e.target).removeClass("tvd-invalid"),this.model.get("settings").start.date=e.target.value}},initialize:function(e){this.data=e,this.listenTo(this.model,"change:rolling_type",this.renderSettings);var i=t.extend(!0,this.default_settings,this.model.get("settings"));this.model.set("settings",i)},render:function(){var e=this;return this.$el.html(this.template({item:this.model,settings:this.model.get("settings")})),TVE_Dash.materialize(this.$el),this.renderSettings(),this.$el.find("#tvu-start-date, #tvu-end-date").pickadate({format:"d mmmm yyyy",selectYears:!0,selectMonths:!0}),this.$el.find("#tvu-start-hour").timepicker({timeFormat:"HH:mm",dynamic:!1,interval:60,change:function(){var i=t(this).removeClass("tvd-invalid").val(),s=t(this),n=e.model.roundTime(i);s.val(n),e.model.get("settings").start.time=t(this).removeClass("tvd-invalid").val()}}),this.$el.find("#tvu-end-hour").timepicker({timeFormat:"HH:mm",dynamic:!1,interval:60,change:function(){var i=t(this).removeClass("tvd-invalid").val(),s=t(this),n=e.model.roundTime(i);s.val(n),e.model.setTime(t(this).removeClass("tvd-invalid").val())}}),this.refreshTime(),this},renderSettings:function(){var e=this.model.get("rolling_type");e||(e=ThriveUlt.util.rollingType.daily),this.collection.setOptions(this.model.get("settings").duration,e,this.model.get("settings").repeatOn),this[e]?this[e].setElement(this.$("#tvu-rolling-options")[0]):this[e]=new(ThriveUlt.views["Rolling"+ThriveUlt.util.upperFirst(e)+"Settings"])({el:this.$el.find("#tvu-rolling-options")[0],model:this.model,collection:this.collection}),this.changeDescription();var t=this.collection.prepareAppend();return t&&this.$el.find(".tvu-campaign-rolling-day").show().text("on "+t),this[e].render(),this[e].$el.hide().fadeIn().slideDown(),this},changeRollingState:function(e){var t=e.target.value;this.$el.find(".tvu-campaign-rolling-repeat, .tvu-campaign-rolling-day").empty(),this.model.get("settings").repeatOn=[],this.model.get("settings").repeat=1,this.model.get("settings").duration=1,this.model.set("rolling_type",t)},changeDescription:function(e){var t=this.model.changeRepeat(e);this.$el.find(".tvu-campaign-rolling-repeat").text(t)}}),ThriveUlt.views.CampaignTypeEvergreenState=ThriveUlt.views.Base.extend({className:"tvu-campaign-option tvu-campaign-evergreen",template:TVE_Dash.tpl("campaign/type/evergreen-state"),events:{"change .tvu-evergreen-settings":"changeEvergreenState","change .tvu-evergreen-duration":function(e){var t=e.currentTarget.dataset.field,i=parseInt(e.currentTarget.value);this.model.get("settings")[t]=isNaN(i)?0:i},"change #tvu-evergreen-expire":function(e){this.model.get("settings").end=e.target.value},"click .tvu-lead-conversion":"saveCheckboxes","change .tvu-repeat-switch":"changeRepeat","change .tvu-real-time":"changeRealEnding","change .tvu-lockdown-switch":"changeLockdown"},initialize:function(e){this.shortcodes=e.shortcodes,this.thriveBoxes=e.thriveBoxes},prepareSettings:function(){var e=this.model.get("settings");(e.trigger.type!=ThriveUlt.util.trigger_type.conversion||this.shortcodes||this.collection)&&e.trigger.type||(e.trigger.type=this.model.get("lockdown")?"promotion":"first"),void 0===e.days_duration&&(e.days_duration=parseInt(e.duration),e.hours_duration=0,e.minutes_duration=0,e.seconds_duration=0),void 0===e.redirect&&(e.redirect=0),this.model.set("settings",e)},render:function(){var e=this.model.get("linked_to"),i=this.model;return this.prepareSettings(),this.$el.html(this.template({item:this.model.get("settings"),lockdown:this.model.get("lockdown"),collection:this.collection})),this.renderSettings(),e&&e.length>0&&e.each(this.renderLinkedCampaign,this),TVE_Dash.materialize(this.$el),this.$el.find("#tvu-real-time").timepicker({timeFormat:"HH:mm",dynamic:!1,interval:60,change:function(){var e=t(this).removeClass("tvd-invalid").val(),s=t(this),n=i.roundTime(e);s.val(n),i.get("settings").realtime=n}}),this.$("#tvu-evergreen-gmt-offset").on("change",(function(e){i.get("settings").gmt_offset=e.currentTarget.value})).val(i.get("settings").gmt_offset||"UTC+0").trigger("change"),this},renderSettings:function(){var e=this.model.get("settings").trigger.type;if(ThriveUlt.views["Evergreen"+ThriveUlt.util.upperFirst(e)+"Settings"]){var t=new(ThriveUlt.views["Evergreen"+ThriveUlt.util.upperFirst(e)+"Settings"])({el:this.$el.find("#tvu-evergreen-settings"),model:this.model,collection:this.collection,shortcodes:this.shortcodes,thriveBoxes:this.thriveBoxes,thriveQuizzes:ThriveUlt.data.tqb_optin});t.render(),this.$("#tvu-trigger-description").html(t.get_trigger_description()),t.$el.hide().fadeIn().slideDown()}},changeEvergreenState:function(e){var t=e.target.value;this.model.get("settings").trigger.type=t,this.model.get("settings").trigger.ids="",this.renderSettings()},renderLinkedCampaign:function(e){var t=new ThriveUlt.views.LinkedCampaign({model:e});return this.$el.find(".tvu-evergreen-linked").show(),this.$el.find(".tvu-evergreen-linked-to").append(t.render().$el),this},saveCheckboxes:function(){var e=[];this.$el.find("input[type=checkbox].tvu-lead-conversion:checked").each((function(){var i=parseInt(t(this).val());e.push(i)})),this.model.get("settings").trigger.ids=e},changeRepeat:function(e){if(t(e.currentTarget).is(":checked"))return this.model.get("settings").evergreen_repeat=1,void this.$el.find(".tvu-repeat-wrapper").slideDown(200);this.model.get("settings").evergreen_repeat=0,this.model.get("settings").end="",this.$el.find("#tvu-evergreen-expire").val(""),this.$el.find(".tvu-repeat-wrapper").slideUp(200)},changeRealEnding:function(e){var i=t(e.currentTarget).val();if(this.$el.find(".tvu-duration-label-realistic").toggleClass("hidden"),this.$el.find(".tvu-duration-label-absolute").toggleClass("hidden"),"realistic"===i)return this.model.get("settings").real=1,void this.$el.find(".tvu-real-time-wrapper").slideDown(200);this.model.get("settings").real=0,this.model.get("settings").realtime="00:00",this.$el.find("#tvu-real-time").val("00:00"),this.$el.find(".tvu-real-time-wrapper").slideUp(200)},changeLockdown:function(e){var i=t(e.currentTarget);this.model.set("lockdown",i.is(":checked")),this.model.get("settings").trigger.type="",!this.model.get("lockdown")||this.model.get("status")!=ThriveUlt.util.status.running||this.model.get("lockdown_settings").expired&&this.model.get("lockdown_settings").preaccess&&this.model.get("lockdown_settings").promotion||(this.model.set("status",ThriveUlt.util.status.paused),this.model.saveStatus(),TVE_Dash.err(ThriveUlt.t.Campaign_paused)),this.render()}}),ThriveUlt.views.LinkedCampaign=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/type/evergreen-linked"),render:function(){return this.$el.empty().append(this.template({item:this.model})),this}}),ThriveUlt.views.EvergreenConversionSettings=ThriveUlt.views.Base.extend({className:"tvu-trigger-option tvu-trigger-option-conversion",template:TVE_Dash.tpl("campaign/type/evergreen-conversion"),initialize:function(e){this.shortcodes=e.shortcodes,this.thriveBoxes=e.thriveBoxes},render:function(){return this.$el.html(this.template({item:this.model.get("settings").trigger,collection:this.collection,shortcodes:this.shortcodes,thriveBoxes:this.thriveBoxes,thriveQuizzes:ThriveUlt.data.tqb_optin,leadGenPages:ThriveUlt.data.lead_gen_pages,lightBoxes:ThriveUlt.data.tve_lightboxes})),this.collection&&this.shortcodes&&ThriveUlt.LeadGroupSearch2(this.$el,[this.collection,this.shortcodes,this.thriveBoxes],this.model),this},renderLeadGroups:function(e){var t=new ThriveUlt.views.EvergreenCampaignCheckbox({model:e,triggers:this.model.get("settings").trigger});return this.$el.find(".tvu-evergreen-leads-checkboxes").append(t.render().$el),this},renderShortcodes:function(e){var t=new ThriveUlt.views.EvergreenCampaignCheckbox({model:e,triggers:this.model.get("settings").trigger});return this.$el.find(".tvu-evergreen-shortcodes-checkboxes").append(t.render().$el),this},get_trigger_description:function(){return"<em>"+ThriveUlt.t.trigger_conversion+"</em>"}}),ThriveUlt.views.EvergreenWebhookSettings=ThriveUlt.views.Base.extend({className:"tvu-trigger-option tvu-trigger-option-webhook",template:TVE_Dash.tpl("campaign/type/evergreen-webhook"),integratedApis:ThriveUlt.integratedApis,events:{"change .tvu-webhook-api":"changeAPi"},initialize:function(e){this.shortcodes=e.shortcodes},changeAPi:function(e){var t=this.model.get("settings");t.trigger.api=e.target.value,this.model.set("settings",t),this.render()},render:function(){var e=this.model.get("settings");for(var i in e.trigger.api||(e.trigger.api=Object.keys(this.integratedApis)[0],this.model.set("settings",e)),this.integratedApis)this.integratedApis[i].selected=e.trigger.api===i;var s=this.model.get("settings").trigger.api;this.$el.html(this.template()),this.integratedApis[s]&&this.integratedApis[s].custom_integration?(this.$(".tvu-api-integration").html(TVE_Dash.tpl("campaign/type/api-partials/"+s)({item:s,kb_article:this.getKBAricle()})),this[s]()):this.$(".tvu-api-integration").html(TVE_Dash.tpl("campaign/type/api-partials/general")({item:s,integratedApis:this.integratedApis,url:this.generateURL(),kb_article:this.getKBAricle()}));var n=this.$("#tvu-webhook-api");return _.each(this.integratedApis,(function(e){var i=e.label.endsWith("webhook")?"":e.label.endsWith("FluentCRM")?" tag":" webhook",s=t('<option value="'+e.key+'" data-image="'+e.image+'">'+e.label+i+"</option>");e.selected&&s.prop("selected",!0),n.append(s)})),n.select2({templateResult:ThriveUlt.util.select2ImageItemRenderer,templateSelection:ThriveUlt.util.select2ImageItemRenderer}),TVE_Dash.bindZClip(this.$el.find("a.tve-copy-to-clipboard")),this},fluentcrm:function(){this.$(".tvu-fluentcrm-trigger-dropdown").select2();var e=this,i=e.model.get("settings"),s=ThriveUlt.integratedApis.fluentcrm.data;s.filter((function(e){e.selected=i.trigger.ids.includes(parseInt(e.id))}));var n=this.$("#tvu-fluentcrm-trigger-tags").select2({tags:!0,data:s,templateResult:function(e){return t('<div class="tvu-leads-dropdown-option"><span >'+e.text+"</span></div>")}}).on("change",(function(t){i.trigger.ids=n.select2("data").map((function(e){return parseInt(e.id)})),e.model.set("settings",i)}))},getKBAricle:function(){return this.integratedApis[this.model.get("settings").trigger.api].kb_article},generateURL:function(){var e,t=this.model.get("settings");return t.trigger.code?e=t.trigger.code:(e=(new Date).getTime().toString(36),t.trigger.code=e,this.model.set("settings",t)),ThriveUlt.tvd_webhook_rest_url+t.trigger.api+"/"+this.model.get("ID")+"/"+e},get_trigger_description:function(){return"<em>"+ThriveUlt.t.trigger_webhook+"</em>"}}),ThriveUlt.views.EvergreenCampaignCheckbox=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/type/evergreen-checkbox"),tagName:"div",className:"tvu-posts-checkbox tvd-col tvd-s4",initialize:function(e){this.triggers=e.triggers},render:function(){this.$el.empty().append(this.template({item:this.model,ids:this.triggers.ids.constructor===Array?this.triggers.ids:""}));var e=this.$el.find("label");return e.text(ThriveUlt.util.trimStringAfterWidth(e.text(),175,16,"Roboto",400)),this}}),ThriveUlt.views.EvergreenFirstSettings=ThriveUlt.views.Base.extend({render:function(){return this.$el.empty(),this},get_trigger_description:function(){return"<em>"+ThriveUlt.t.trigger_first_visit+"</em>"}}),ThriveUlt.views.EvergreenPromotionSettings=ThriveUlt.views.Base.extend({render:function(){return this.$el.empty(),this},get_trigger_description:function(){return"<em>"+ThriveUlt.t.trigger_promotion_page+"</em>"}}),ThriveUlt.views.EvergreenUrlSettings=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/type/evergreen-specific"),events:{"change .tvu-redirect-switch":"changeRedirect"},render:function(){var e=this.model,t=e.get("settings");this.$el.html(this.template({item:t.trigger,settings:t}));var i=this.$("#tvu-specific-url"),s=this.$("#tvu-redirect-url"),n=ThriveUlt.ajaxurl("action="+ThriveUlt.ajax_actions.admin_controller+"&route=progressiveGetPosts");return new ThriveUlt.PostSearch(i,{url:n,select:function(t,i){e.get("settings").trigger.ids=i.item.id},search:function(){e.get("settings").trigger.ids=""},open:function(){e.get("settings").trigger.ids=""},fetch_single:e.get("settings").trigger.ids}),new ThriveUlt.PostSearch(s,{url:n,select:function(t,i){e.get("settings").redirect_url=i.item.id},search:function(){e.get("settings").redirect_url=""},open:function(){e.get("settings").redirect_url=""},fetch_single:e.get("settings").redirect_url}),this},get_trigger_description:function(){return"<em>"+ThriveUlt.t.trigger_url+"</em>"},changeRedirect:function(e){var t=e.currentTarget.checked?1:0;this.model.get("settings").redirect=t,this.$(".tvd-redirect-input").toggle(t)}}),ThriveUlt.views.RollingDailySettings=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/type/daily-campaign"),events:{"change #tvu-rolling-day-duration":function(e){this.model.get("settings").duration=e.target.value}},render:function(){return this.$el.html(this.template({item:this.model.get("settings")})),TVE_Dash.materialize(this.$el),this}}),ThriveUlt.views.RollingWeeklySettings=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/type/weekly-campaign"),events:{"change #tvu-rolling-duration":function(e){this.model.get("settings").duration=e.target.value,this.collection.each((function(e){e.set({disabled:!1,checked:!1})}),this),t(".tvu-campaign-rolling-day").empty(),this.render()}},render:function(){return this.$el.empty(),this.$el.html(this.template({item:this.model.get("settings")})),this.$c_wrapper=this.$(".tvu-weekly-repeats-wrapper"),this.collection.each(this.renderOne,this),TVE_Dash.materialize(this.$el),this},renderOne:function(e){var t=new ThriveUlt.views.RollingCampaignCheckbox({model:e,collection:this.collection});return this.$c_wrapper.append(t.render().$el),this}}),ThriveUlt.views.RollingMonthlySettings=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/type/monthly-campaign"),events:{"change #tvu-rolling-duration":function(e){this.model.get("settings").duration=e.target.value,this.collection.each((function(e){e.set({disabled:!1,checked:!1})}),this),this.render()}},render:function(){return this.$el.html(this.template({item:this.model.get("settings")})),this.$c_wrapper=this.$(".tvu-monthly-repeats-wrapper"),this.collection.each(this.renderOne,this),TVE_Dash.materialize(this.$el),this},renderOne:function(e){var t=new ThriveUlt.views.RollingCampaignCheckbox({model:e,collection:this.collection});return this.$c_wrapper.append(t.render().$el),this}}),ThriveUlt.views.RollingYearlySettings=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/type/yearly-campaign"),events:{"change #tvu-rolling-year-duration":function(){this.model.get("settings").duration=this.$el.find("#tvu-rolling-year-duration").val()}},render:function(){return this.$el.html(this.template({item:this.model.get("settings")})),TVE_Dash.materialize(this.$el),this}}),ThriveUlt.views.RollingCampaignCheckbox=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/type/checkbox"),tagName:"span",className:"tvu-repeat-checkbox",events:{"click .tvu-rolling-repeat-check":"prepareCheckboxes"},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.empty().append(this.template({item:this.model})),this},prepareCheckboxes:function(e){var i=t("#tvu-rolling-options").find("#tvu-rolling-duration").val(),s=this.model.get("ID"),n=this.model.get("checked");this.collection.changeCheckboxes(i,s),this.model.set("checked",!n);var r=this.collection.prepareAppend();t(".tvu-campaign-rolling-day").show().text("on "+r)}}),ThriveUlt.views.Design=ThriveUlt.views.Base.extend({events:{"click .tvu-delete-design":function(){this.model.set("state","delete")},"click .tvu-edit-design":function(){this.model.initRefetchTimer()},"click .tvu-top-ribbon-settings":"openTopRibbonSettings","click .tvu-get-shortcode":"openShortcodeModal"},initialize:function(){this.listenTo(this.model,"change:state",this.renderState),this.listenTo(this.model,"change:thumb_url",this.renderState)},render:function(){return this.renderState(),this},renderState:function(){var e=this.model.get("state");if(ThriveUlt.views["Design"+ThriveUlt.util.upperFirst(e)+"State"]){var t=new(ThriveUlt.views["Design"+ThriveUlt.util.upperFirst(e)+"State"])({model:this.model,collection:this.collection});return t.render(),this.$el.replaceWith(t.$el),this.setElement(t.$el),this}},openTopRibbonSettings:function(){this.modal(ThriveUlt.views.TopRibbonModal,{model:this.model})},openShortcodeModal:function(){this.modal(ThriveUlt.views.ModalShortcodeCode,{model:this.model})}}),ThriveUlt.views.DesignNormalState=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("design-item"),className:"tvu-design-item mr-30",events:{},render:function(){return this.$el.html(this.template({item:this.model})),this}}),ThriveUlt.views.DesignDeleteState=ThriveUlt.views.Base.extend({className:"tvd-col tvd-s12 tvd-m4 tvd-ms6 tvd-l3 mr-30",template:TVE_Dash.tpl("design-delete-state"),events:{"click .tvu-delete-yes":"yes",keydown:"keyAction","click. .tvu-delete-no":function(){this.model.set("state",ThriveUlt.util.states.normal)}},initialize:function(){this.listenTo(this.collection,"remove",this.remove)},render:function(){this.$el.html(this.template({item:this.model}));var e=this;return _.defer((function(){e.$(".tve-delete-design-card").focus()})),this},keyAction:function(e){var t=e.which;13==t?this.yes():27==t&&this.model.set("state",ThriveUlt.util.states.normal)},yes:function(){var e=this;TVE_Dash.cardLoader(this.$el),this.model.clearRefetchTimer(),this.model.destroy({wait:!0,success:function(t,i){e.collection.remove({ID:e.model.get("ID")}),i.campaign_paused&&(ThriveUlt.globals.campaign.set("status",i.campaign_status),TVE_Dash.err(i.campaign_paused,6e3))},error:function(){TVE_Dash.hideLoader()}})}}),ThriveUlt.views.TextEdit=ThriveUlt.views.Base.extend({className:"tvd-input-field tvu-inline-edit",template:TVE_Dash.tpl("textedit"),events:{"keyup input":"keyup","change input":function(e){return t.trim(this.input.val())?(this.model.set("value",this.input.val()),!1):(this.input.addClass("tvd-invalid"),!1)},"blur input":function(){this.model.trigger("tvu_no_change")}},keyup:function(e){27===e.which&&this.model.trigger("tvu_no_change")},render:function(){return this.$el.html(this.template({item:this.model})),this.input=this.$el.find("input"),this},focus:function(){this.input.focus().select()}}),ThriveUlt.views.Timeline=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/timeline"),events:{"click #tvu-add-timeline-event":"addEvent"},initialize:function(){this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"update",this.render)},render:function(){return this.$el.html(this.template({item:this.model})),this.collection.each(_.bind(this.renderEvent,this)),this},renderEvent:function(e){if(e.get("type")===ThriveUlt.event_type.end)return this.renderEndEvent(e);var t=new ThriveUlt.views.Event({model:e,collection:this.collection});return this.$("#tvu-timeline").append(t.render().$el),this},renderEndEvent:function(e){var t=new ThriveUlt.views.EndEvent({model:e,collection:this.collection});return this.$("#tvu-timeline").append(t.render().$el),this},addEvent:function(){if(this.model.get("designs")&&this.model.get("designs").size()){var e=new ThriveUlt.models.Event({campaign_id:this.model.get("ID")}),t=this.collection.at(this.collection.size()-2),i=new ThriveUlt.collections.EventActions(t.get("actions").toJSON());e.set("actions",i),ThriveUlt.views.Timeline.openEventModal(e,null,this.collection)}else TVE_Dash.err(ThriveUlt.t.NoDesigns)}},{openEventModal:function(e,t,i){TVE_Dash.showLoader();var s=new ThriveUlt.collections.Designs;s.set_campaign_id(e.get("campaign_id")).fetch().done(_.bind((function(){s.mark_selected_event_actions(e.get("actions")),ThriveUlt.globals.campaign.set("designs",s),this.prototype.modal(ThriveUlt.views.ModalEditEvent,{model:e,original_model:t,designs:s,collection:i,"max-width":"45%"})}),this)).fail((function(e){TVE_Dash.err(e.responseText)})).always((function(){TVE_Dash.hideLoader()}))}}),ThriveUlt.views.Event=ThriveUlt.views.Base.extend({className:"tvu-timeline-row",newClassName:"tvu-animation-edit",durationClassName:"tvu-animation-duration",deleteClassName:"tvu-deleting",template:TVE_Dash.tpl("event/item"),events:{"click .tvu-event-edit":"edit","click .tvu-event-delete":"delete"},initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template({item:this.model})),this.$actionsList=this.$el.find(".tvu-event-actions"),this.renderActions(),"edited"===this.model.get("status")&&(this.$el.addClass(this.newClassName),this.model.unset("status")),"duration_changed"!==this.model.get("status")&&"new"!==this.model.get("status")||(this.$el.addClass(this.durationClassName),setTimeout(_.bind((function(){this.model.unset("status")}),this),2e3)),setTimeout(_.bind((function(){this.$el.removeClass(this.newClassName+"  "+this.durationClassName)}),this),2e3),this},renderActions:function(){this.$actionsList.empty();var e=this.model.get("actions").models;e.length>0?_.each(e,(function(e){this.$actionsList.append(TVE_Dash.tpl("event/action",{item:e}))}),this):this.$actionsList.append("There are no Designs attached to this event. To add a new Design edit the event.")},edit:function(){ThriveUlt.views.Timeline.openEventModal(this.model.deepClone(),this.model,this.collection)},delete:function(){this.$el.addClass(this.deleteClassName),setTimeout(_.bind((function(){this.model.destroy({success:function(e,t,i){TVE_Dash.hideLoader()},error:function(e,t,i){TVE_Dash.hideLoader(),TVE_Dash.err(t.responseText)}})}),this),500)}}),ThriveUlt.views.EndEvent=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("event/end"),className:"tvu-timeline-row tvu-timeline-row-last",render:function(){return this.$el.html(this.template({item:this.model})),this}}),ThriveUlt.views.EventModalDesignItem=ThriveUlt.views.Base.extend({tagName:"li",template:TVE_Dash.tpl("event/design-row"),className:"tvu-event-design-item tvd-collection-item",events:{"change .tvu-event-design-display":"eventDisplayChange","change .tvu-event-design-state":"eventStateChange"},eventDisplayChange:function(e){var i=t(e.target);this.model.set("event_display",i.is(":checked")),this.$(".tvu-event-design-state-container")[i.is(":checked")?"fadeIn":"fadeOut"](150)},eventStateChange:function(e){var i=t(e.target).val();this.model.set("event_state",i)},render:function(){return this.$el.html(this.template({design:this.model})),this.$(".tvu-event-design-state").trigger("change"),this}}),ThriveUlt.views.ConversionEvents=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/conversion_events"),events:{"click #tvu-add-conversion-event":"addEvent"},initialize:function(){this.listenTo(this.collection,"add",this.renderOne)},render:function(){return this.$el.html(this.template({item:this.model})),this.collection.each(this.renderOne,this),this},addEvent:function(){var e=new ThriveUlt.models.ConversionEvent({campaign_id:this.model.get("ID")});e.set("trigger_options",{end_id:"",event:"",trigger:"",trigger_ids:""}),this.modal(ThriveUlt.views.ModalConversionEvent,{model:e,collection:this.collection,"max-width":"40%"})},renderOne:function(e){var t=new ThriveUlt.collections.Campaigns(ThriveUlt.globals.campaigns.where({type:ThriveUlt.util.campaignType.evergreen})),i=new ThriveUlt.views.ConversionEvent({model:e,collection:t});return this.$el.find("#tvu-conversion-events").append(i.render().$el),this}}),ThriveUlt.views.ConversionEvent=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("conversion/event"),tagName:"div",className:"tvu-conversion-event",events:{"click .tvu-campaign-delete":"delete","click .tvu-campaign-edit":"editEvent"},initialize:function(){this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"change",this.render)},render:function(){var e=ThriveUlt.globals.campaigns.findWhere({ID:parseInt(this.model.get("trigger_options").end_id)}),t=this;return e&&e.createModelCollections(),t.$el.empty().append(t.template({item:t.model,campaign:e})),this},delete:function(){TVE_Dash.showLoader(),this.model.destroy({success:function(e,t,i){TVE_Dash.hideLoader()},error:function(e,t,i){TVE_Dash.hideLoader(),TVE_Dash.err(t.responseText)}})},editEvent:function(){this.modal(ThriveUlt.views.ModalConversionEvent,{model:this.model.deepClone(),original_model:this.model,collection:this.collection,"max-width":"40%"})}}),ThriveUlt.views.ConversionSummary=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("conversion/conversion-summary"),render:function(){return this.$el.html(this.template({item:this.model})),this}}),ThriveUlt.views.TriggerTypeSpecific=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("conversion/visit-page"),events:{},render:function(){var e=this.model;this.$el.html(this.template({item:this.model})),new ThriveUlt.PostSearch(this.$("#tvu-specific-url"),{url:ThriveUlt.ajaxurl("action="+ThriveUlt.ajax_actions.admin_controller+"&route=progressiveGetPosts"),select:function(t,i){e.get("trigger_options").trigger_ids=i.item.id},no_value_callback:function(){e.get("trigger_options").trigger_ids=""},fetch_single:e.get("trigger_options").trigger_ids})}}),ThriveUlt.views.TriggerTypeConversion=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("conversion/subscription"),events:{"click .tvu-lead-conversion":"saveCheckboxes"},initialize:function(e){this.shortcodes=e.shortcodes,this.thriveBoxes=e.thriveBoxes},render:function(){this.$el.html(this.template({collection:this.collection,shortcodes:this.shortcodes,thriveBoxes:this.thriveBoxes,item:this.model})),this.collection.each(this.renderLeads,this),this.thriveBoxes.each(this.renderLeads,this),this.shortcodes.each(this.renderLeads,this)},renderLeads:function(e){var t=new ThriveUlt.views.ConversionCheckbox({model:e,triggers:this.model.get("trigger_options").trigger_ids});return e.get("post_type")===ThriveUlt.util.leadtype.lead_group?this.$el.find(".tvu-conversion-leads-checkboxes").append(t.render().$el):e.get("post_type")===ThriveUlt.util.leadtype.thriveBox?this.$el.find(".tvu-conversion-thrivebox-checkboxes").append(t.render().$el):this.$el.find(".tvu-conversion-shortcodes-checkboxes").append(t.render().$el),this},saveCheckboxes:function(){var e=[];this.$el.find("input[type=checkbox]:checked").each((function(){var i=parseInt(t(this).val());e.push(i)})),this.model.get("trigger_options").trigger_ids=e}}),ThriveUlt.views.ConversionCheckbox=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("conversion/subscription-checkbox"),className:"tvu-posts-checkbox tvd-col tvd-s4",initialize:function(e){this.triggers=e.triggers},render:function(){return this.$el.empty().append(this.template({item:this.model,ids:this.triggers?this.triggers:""})),this}}),ThriveUlt.views.EventTypeEnd=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("conversion/move-to-campaign"),render:function(){return this.$el.empty(),this}}),ThriveUlt.views.EventTypeMove=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("conversion/move-to-campaign"),events:{"click .tvu-campaign-conversion":"setMove"},render:function(){return this.$el.html(this.template({item:this.model,collection:this.collection})),this.collection.each(this.renderOne,this),this},renderOne:function(e){var t=this.model.get("trigger_options").end_id,i=new ThriveUlt.views.ConversionRadio({model:e,end_id:t||""});return this.$el.find("#tvu-campaign-move-wrapper").append(i.render().$el),this},setMove:function(e){var t=e.target.value;if(this.model.get("ID")){var i=this.model.get("trigger_options").end_id;this.model.get("trigger_options").end_id_old=i}this.model.get("trigger_options").end_id=t}}),ThriveUlt.views.ConversionRadio=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("conversion/move-to-campaign-radio"),className:"tvu-caimpaigns-radio tvd-col tvd-s4",initialize:function(e){this.end_id=e.end_id},render:function(){return this.$el.empty().append(this.template({item:this.model,end_id:this.end_id?this.end_id:""})),this}}),ThriveUlt.views.Breadcrumbs=ThriveUlt.views.Base.extend({el:t("#tvu-breadcrumbs-wrapper")[0],template:TVE_Dash.tpl("breadcrumbs"),initialize:function(){this.$title=t("head > title"),this.original_title=this.$title.html(),this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"add",this.render)},render:function(){this.$el.empty().html(this.template({links:this.collection}))}})})),ThriveUlt.PostSearch=function(e,i){function s(){var t;return!!(t=e.data("allow-regex"))&&e.val().match(new RegExp(t))}(i=i||{}).no_value_callback=i.no_value_callback||t.noop,i.change_callback=i.change_callback||t.noop;var n={appendTo:e.parent(),minLength:2,delay:200,change:function(t,n){n.item||e.data("value-filled")||s()||(e.val(""),i.no_value_callback.apply(e,arguments)),e.data("value-filled",null),s()&&i.change_callback.apply(e,arguments)}};(i=t.extend(!0,n,i)).source||(i.source=i.url),e.autocomplete(i).data("ui-autocomplete")._renderItem=function(e,s){var n="";return i.collection&&i.collection.length&&i.collection.findWhere({id:s.id})&&(n="tvu-selected-post"),t("<li class='"+n+"'>").append("<span class='tvu-ps-result-title tvd-truncate' style='max-width: 85%'>"+s.label+"</span><span class='tvu-ps-result-type'>"+s.type+"</span>").appendTo(e)},e.on("blur",(function(){t.trim(this.value).length||i.no_value_callback.apply(e,arguments)})),e.on("input",(function(e){var i=t(e.currentTarget);i.removeClass("tvd-invalid"),i.siblings().removeAttr("data-error")})),i.fetch_single&&"number"==typeof i.fetch_single&&(e.addClass("ui-autocomplete-loading"),t.ajax({url:ThriveUlt.ajaxurl("action="+ThriveUlt.ajax_actions.admin_controller+"&route=getPostByID"),data:{id:i.fetch_single},success:function(t){e.data("value-filled",1).val(t.title).removeClass("ui-autocomplete-loading").next("label").addClass("tvd-active")}})),i.fetch_single&&"string"==typeof i.fetch_single&&e.data("value-filled",1).val(i.fetch_single).next("label").addClass("tvd-active")},ThriveUlt.LeadGroupSearch2=function(e,i,s){var n=[],r=e.find("#tvu-trigger-form-ids"),l={tve_lead_group:"Lead Group",tve_lead_shortcode:"Shortcode",tve_lead_2s_lightbox:"Thrive Box"},a=function(e){return e.length>50?e.slice(0,50)+"...":e};i.forEach((function(e){e.models&&e.models.forEach((function(e,t){n.push({text:a(e.attributes.post_title),subText:l[e.attributes.post_type],id:e.attributes.ID,selected:s.get("settings").trigger.ids.indexOf(e.attributes.ID)>-1})}))})),ThriveUlt.data.tqb_optin.forEach((function(e){e.optin&&e.quiz_title&&n.push({text:a(e.quiz_title),subText:"Quiz",id:e.optin,selected:s.get("settings").trigger.ids.indexOf(e.optin)>-1})})),ThriveUlt.data.lead_gen_pages&&_.each(ThriveUlt.data.lead_gen_pages,(function(e,t){n.push({text:a(e),subText:"Page",id:t,selected:s.get("settings").trigger.ids.indexOf(parseInt(t))>-1})})),ThriveUlt.data.tve_lightboxes&&_.each(ThriveUlt.data.tve_lightboxes,(function(e,t){n.push({text:a(e),subText:"Thrive Lightbox",id:t,selected:s.get("settings").trigger.ids.indexOf(parseInt(t))>-1})})),r.length&&r.select2({tags:!0,data:n,templateResult:function(e){return t('<div class="tvu-leads-dropdown-option"><span >'+e.text+'</span><span class="tvu-leads-dropdown-category">'+e.subText+"</span></div>")}}).on("change",(function(e){s.get("settings").trigger.ids=r.select2("data").map((function(e){return parseInt(e.id)}))}))}}(jQuery)})(),window.ThriveUlt=window.ThriveUlt||{},ThriveUlt.globals=ThriveUlt.globals||{},function(e){var t=Backbone.Router.extend({view:null,editCampaignView:null,$el:e("#tvu-admin-wrapper"),routes:{dashboard:"dashboard","dashboard/campaign/:id":"campaignEdit","purge-cache":"purgeCache","dashboard/archived-campaigns":"archived"},params:{},breadcrumbs:{col:null,view:null},init_breadcrumbs:function(){this.breadcrumbs.col=new ThriveUlt.collections.Breadcrumbs,this.breadcrumbs.view=new ThriveUlt.views.Breadcrumbs({collection:this.breadcrumbs.col})},set_page:function(t,i,s){this.breadcrumbs.col.reset(),s=s||{},this.breadcrumbs.col.add_page(ThriveUlt.dash_url,ThriveUlt.t.Thrive_Dashboard,!0),_.each(s,_.bind((function(e){this.breadcrumbs.col.add_page(e.route,e.label)}),this)),this.breadcrumbs.col.add_page("",i);var n=e("head > title");this.original_title||(this.original_title=n.html()),n.html(i+" &lsaquo; "+this.original_title)},dashboard:function(){this.set_page("dashboard",ThriveUlt.t.Dashboard),e(".tvd-material-tooltip").hide(),TVE_Dash.opened_modal_view&&TVE_Dash.opened_modal_view.close(),TVE_Dash.showLoader(),this.view&&this.view.remove(),this.renderHeader(),this.view=new ThriveUlt.views.Dashboard({collection:new ThriveUlt.collections.Campaigns(ThriveUlt.globals.campaigns.filter_archived(!1))}),this.$el.html(this.view.render().$el),ThriveUlt.util.bind_wistia()},archived:function(){this.set_page("archived-campaigns",ThriveUlt.t.archived_campaigns,[{route:"purge-cache",label:ThriveUlt.t.Dashboard}]),TVE_Dash.opened_modal_view&&TVE_Dash.opened_modal_view.close(),TVE_Dash.showLoader(),this.view&&this.view.remove(),this.view=new ThriveUlt.views.ArchivedCampaigns({collection:new ThriveUlt.collections.Campaigns(ThriveUlt.globals.campaigns.filter_archived())}),this.$el.html(this.view.render().$el),this.renderHeader(),TVE_Dash.hideLoader()},campaignEdit:function(t){if(this.view&&this.view.remove(),TVE_Dash.opened_modal_view&&TVE_Dash.opened_modal_view.close(),e(".tvd-material-tooltip").hide(),t){var i=this,s=new ThriveUlt.models.Campaign({ID:t});TVE_Dash.showLoader(),this.renderHeader(),s.fetch().success((function(){ThriveUlt.globals.campaign=s,i.view=new ThriveUlt.views.EditCampaign({model:s}),i.$el.html(i.view.render().$el),n("dashboard/campaign",s.get("post_title")),s.on("change:post_title",(function(){n("dashboard/campaign",s.get("post_title"))})),TVE_Dash.hideLoader(),ThriveUlt.util.bind_wistia()})).error((function(e){TVE_Dash.err(e.responseText),TVE_Dash.hideLoader()})),this.params.campaign=s}else ThriveUlt.router.navigate("#dashboard",{trigger:!0});function n(e,t){i.set_page(e,t,[{route:"purge-cache",label:ThriveUlt.t.Dashboard}])}},purgeCache:function(){TVE_Dash.showLoader(),e.ajax({type:"post",url:ajaxurl,dataType:"json",data:{action:ThriveUlt.ajax_actions.admin_controller,route:"settings",custom:"purge_cache",_nonce:ThriveUlt.admin_nonce}}).done(_.bind((function(e){ThriveUlt.globals.campaigns.reset(e),this.navigate("#dashboard",{trigger:!0})}),this)).always((function(){TVE_Dash.hideLoader()}))},renderHeader:function(){this.header?this.header.setElement(e(".tvu-header")):this.header=new ThriveUlt.views.Header({el:".tvu-header",model:ThriveUlt.globals.settings}),this.header.render()}});e((function(){ThriveUlt.globals.campaigns=new ThriveUlt.collections.Campaigns(ThriveUlt.data.campaigns),ThriveUlt.globals.actions=new ThriveUlt.collections.EventActions(ThriveUlt.data.actions),ThriveUlt.globals.settings=new ThriveUlt.models.Settings(ThriveUlt.data.settings),ThriveUlt.globals.date_formats=new ThriveUlt.models.Settings(ThriveUlt.date_formats),ThriveUlt.router=new t,ThriveUlt.router.init_breadcrumbs(),Backbone.history.start({hashchange:!0}),Backbone.history.fragment||ThriveUlt.router.navigate("#dashboard",{trigger:!0})}))}(jQuery),window.ThriveUlt=window.ThriveUlt||{},ThriveUlt.views=ThriveUlt.views||{},ThriveUlt.models=ThriveUlt.models||{},ThriveUlt.collections=ThriveUlt.collections||{},ThriveUlt.objects=ThriveUlt.objects||{},function(e){e((function(){ThriveUlt.models.Template=Backbone.Model.extend({defaults:{name:"",description:"",hangers:""},initialize:function(e,t){this.set("hangers",new Backbone.Collection([e.show_group_options,e.hide_group_options]))}}),ThriveUlt.collections.Templates=Backbone.Collection.extend({model:ThriveUlt.models.Template}),ThriveUlt.models.TemplateList=Backbone.Model.extend({defaults:{template_groups:[]},initialize:function(e){var t=[];_.each(e,(function(e,i){var s=new ThriveUlt.collections.Templates(e);s.group_name=i,s.size()&&(s.group_tag=s.at(0).get("tag")),t.push(s)})),this.set("template_groups",t)},get_template:function(e){var t=null;return _.every(this.get("template_groups"),(function(i){return!(t=i.findWhere(e))})),t},name_exists:function(e,t){var i=!1;return _.each(this.get("template_groups"),(function(s){return s.group_tag!=t||(s.findWhere({name:e})?(i=!0,!1):void 0)})),i},size:function(){return this.get("template_groups").length}}),ThriveUlt.models.Filter=Backbone.Model.extend({defaults:{cssClass:"",identifier:"",label:""}}),ThriveUlt.collections.Filters=Backbone.Collection.extend({model:ThriveUlt.models.Filter}),ThriveUlt.models.Option=Backbone.Model.extend({defaults:{label:"",isChecked:!1,id:"",type:null},validate:function(e){if(!e.label.length)return alert("Empty links are not accepted !"),"just return something"},toggle:function(){this.set("isChecked",!this.get("isChecked"))},check:function(){this.set("isChecked",!0)},uncheck:function(){this.set("isChecked",!1)}}),ThriveUlt.collections.Options=Backbone.Collection.extend({model:ThriveUlt.models.Option,countCheckedOptions:function(){var e=0;return this.each((function(t){e+=t.get("isChecked")?1:0})),e}}),ThriveUlt.models.Tab=Backbone.Model.extend({defaults:function(){return{identifier:"",label:"",isActive:!1,actions:[],filters:[]}},initialize:function(e){this.set("options",new ThriveUlt.collections.Options(e.options)),this.set("filters",new ThriveUlt.collections.Filters(e.filters))},getTabIdentifierFromTabId:function(e){return e.replace("tvu_leads_tab_","")},getTabIdFromIdentifier:function(){return"tvu_leads_"+(this.get("exclusion")?"hide":"show")+"_tab_"+this.get("identifier")},getTabContentIdentifier:function(){return"tvu_leads_tab_content_"+this.get("identifier")},countCheckedOptions:function(){if("others"===this.get("identifier")){var e=0;return this.get("options").each((function(t){("direct_url"===t.get("type")||t.get("isChecked"))&&e++})),e}return this.get("options").countCheckedOptions()},uncheckAll:function(){var e=[],t=this.get("options");t.each((function(t){t.set("isChecked",!1),"direct_url"===t.get("type")&&e.push(t)})),_.forEach(e,(function(e){t.remove(e)}))}}),ThriveUlt.collections.Tabs=Backbone.Collection.extend({model:ThriveUlt.models.Tab}),ThriveUlt.models.Hanger=Backbone.Model.extend({defaults:function(){return{identifier:"",tabs:""}},initialize:function(e,t){this.set("tabs",new ThriveUlt.collections.Tabs(e.tabs))},countCheckedOptions:function(){var e=0;return this.get("tabs").each((function(t){e+=t.countCheckedOptions()})),e},uncheckAll:function(){this.get("tabs").each((function(e){e.uncheckAll()}))},getDataForSave:function(){var e={tabs:[]};return this.get("tabs").each((function(t,i){e.tabs[i]=[],t.get("options").each((function(t){(t.get("isChecked")||"direct_url"==t.get("type"))&&e.tabs[i].push(t.get("id"))}))})),e},get_selected_labels:function(e){var t=this.get("tabs"),i=[];return void 0===e&&(e=this.getDataForSave().tabs),_.each(e,(function(e,s){_.each(e,(function(e,n){i.push(t.at(s).get("options").findWhere({id:e}).get("label"))}))})),i}}),ThriveUlt.collections.Hangers=Backbone.Collection.extend({model:ThriveUlt.models.Hanger,uncheckAll:function(){this.each((function(e){e.uncheckAll()}))},get_display_summary:function(e){e=void 0===e?2:parseInt(e),e=isNaN(e)?2:e;var t=this.at(0).get_selected_labels(),i=this.at(1).get_selected_labels();function s(t,i){var s;if(!t||!(s=t.length))return"";var n=t.slice(0,e).join(", ");return s>e&&(n+=" &amp; "+(s-e)+" "+ThriveUlt.t.more),n?i+" "+n:""}var n=_.filter([s(t,ThriveUlt.t.Showing_on),s(i,ThriveUlt.t.Hidden_on)],(function(e){return e.length>0}));return n.length?n.join(". "):ThriveUlt.t.Not_set},has_saved_options:function(){return this.at(0).get_selected_labels().concat(this.at(1).get_selected_labels()).length>0}}),ThriveUlt.views.FiltersView=ThriveUlt.views.Base.extend({className:"tvu_leads_filtersContainer",events:{"click .tvu_leads_tabFilter":function(e){this.filterClicked(jQuery(e.target))}},initialize:function(){},render:function(){var e=this;_.each(this.collection.models,(function(t){e.renderFilter(t)}))},renderFilter:function(e){var t=TVE_Dash.tpl("campaign/settings/filter",e.toJSON());this.$el.append(t)},filterClicked:function(e){this.$el.find(".tvu_leads_tabFilter").removeClass("selected"),e.addClass("selected"),_.each(this.$el.parent().find(".tvu_leads_optionContainer,.tvu_leads_tab_content_toggle"),(function(t){var i=jQuery(t);i.children("label").data("type")===e.attr("id")?i.show():i.hide()})),this.renderSelectedFilter(e.text())},renderSelectedFilter:function(e){var t=this.$el.next(".tvu_leads_selectedFilter");t.length&&t.remove();var i=TVE_Dash.tpl("campaign/settings/selected_filter",{filter:e});this.$el.after(i)}}),ThriveUlt.views.OptionView=ThriveUlt.views.Base.extend({className:"tvu_leads_optionContainer tvd-col tvd-s6 tvd-m6 tvd-l2",events:{"click .tvu_leads_toggle_option":"toggle","click .tvu_leads_removeDirectLink":"removeLink"},initialize:function(){this.listenTo(this.model,"change:isChecked",this.isCheckedChanged)},render:function(){if("direct_url"===this.model.get("type")){this.$el.removeClass("tvd-l2");var e=TVE_Dash.tpl("campaign/settings/direct_url",this.model.toJSON())}else e=TVE_Dash.tpl("campaign/settings/option",this.model.toJSON());"item_page"===this.model.get("type")&&this.$el.removeClass("tvd-l2").addClass("tvd-l3"),this.$el.append(e)},toggle:function(){this.model.toggle()},isCheckedChanged:function(){this.$el.find('input[type="checkbox"]').prop("checked",this.model.get("isChecked"))},removeLink:function(){this.model.collection.remove(this.model)}}),ThriveUlt.views.tab_custom_views={_autocomplete:function(e,t,i){e.autocomplete({appendTo:e.parent(),minLength:2,delay:200,source:function(e,i){jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:ThriveUlt.ajax_actions.admin_controller,route:t,q:e.term,tax:"post_tag",_nonce:ThriveUlt.admin_nonce}}).done((function(e){i(e)}))},select:i})},taxonomy_terms:Backbone.View.extend({template:TVE_Dash.tpl("campaign/settings/tags_filter"),render:function(e){var t=this;return this.$el.html(this.template(this.model.attributes)),this.$el.addClass("tvu_leads_tab_content_toggle").hide(),ThriveUlt.views.tab_custom_views._autocomplete(this.$el.find(".tvu-leads-autocomplete"),"tagSearch",(function(e,i){return t.model.get("options").add({isChecked:!0,type:"post_tag",id:i.item.id,label:i.item.label}),this.value="",!1})),e.find(".tvu_leads_selectedFilter").after(this.$el),this}}),posts:Backbone.View.extend({template:TVE_Dash.tpl("campaign/settings/posts_filter"),render:function(e){var t=this.model.get("options");this.$el.html(this.template(this.model.attributes)),ThriveUlt.views.tab_custom_views._autocomplete(this.$el.find(".tvu-leads-autocomplete"),"postSearch",(function(e,i){return t.add({isChecked:!0,type:"",id:i.item.id,label:i.item.label}),this.value="",!1})),e.find(".tab-content-title").after(this.$el)}})},ThriveUlt.views.TabContentView=ThriveUlt.views.Base.extend({actionContainerClass:"tvu_leads_actionContainer",actionDefaultClass:"tvd-btn-flat tvd-btn-flat-dark tvd-waves-effect",className:"tvd-row",events:{"click .selectAll":"checkAll","click .selectNone":"checkNone","click .tvu_leads_addDirectLink":"addDirectLinkClicked","keypress .tvu_leads_directUrl":"addDirectLinkClicked"},initialize:function(){this.listenTo(this.model.get("options"),"add",(function(e){this.renderOptions(e.get("type")),this.model.trigger("change",this.model)})),this.listenTo(this.model.get("options"),"remove",(function(){this.renderOptions(),this.model.trigger("change",this.model)}))},renderOthersTab:function(){this.$el.attr("id",this.model.getTabIdFromIdentifier()).append('<h5 class="tab-content-title">Visitor Status</h5>').append('<div class="tl-visitor-status clearfix"></div>').append('<div class="clear"></div><h5 class="tab-second-title">Direct URLs</h5>').append('<div class="tl-direct-urls tvd-row tvu_leads_tab_content_direct_urls clearfix"></div>'),this.renderOptionsOthers(),this.renderAddDirectUrlForm()},renderOptionsOthers:function(){this.$el.find(".tl-visitor-status").empty(),this.$el.find(".tl-direct-urls").empty();var e=this;_.each(this.model.get("options").models,(function(t){var i="direct_url"==t.get("type")?e.$el.find(".tl-direct-urls"):e.$el.find(".tl-visitor-status");t.set("base_id",e.model.getTabIdFromIdentifier());var s=new ThriveUlt.views.OptionView({model:t});i.append(s.el),s.render(),t.on("change:isChecked",(function(){e.model.trigger("change")}))}))},render:function(){if("others"===this.model.get("identifier"))return this.renderOthersTab();this.$el.append('<span class="tab-content-title"></span>').attr("id",this.model.getTabIdFromIdentifier()),this.renderActions(),this.renderOptions(),this.renderFilters(),this.renderCustomHtml()},renderCustomHtml:function(){ThriveUlt.views.tab_custom_views[this.model.get("identifier")]&&new(ThriveUlt.views.tab_custom_views[this.model.get("identifier")])({model:this.model}).render(this.$el)},renderOptions:function(e){if("others"===this.model.get("identifier"))return this.renderOptionsOthers();this.$el.find(".tvu_leads_optionContainer").remove();var t=this;_.each(this.model.get("options").models,(function(i){t.renderOption(i,e),i.on("change:isChecked",(function(){t.model.trigger("change",t.model)}))}))},renderOption:function(e,t){e.set("base_id",this.model.getTabIdFromIdentifier());var i=new ThriveUlt.views.OptionView({model:e});this.$el.append(i.el),i.render(),t&&e.get("type")!=t&&i.$el.hide()},renderActions:function(){if(this.model.get("actions").length){var e=jQuery('<div class="'+this.actionContainerClass+' tvu_leads_clearfix" />'),t=this;this.$el.append(e),this.model.get("actions").length&&_.each(this.model.get("actions"),(function(e){t.$el.find("."+t.actionContainerClass).append('<a class="'+t.actionDefaultClass+" "+e.cssClass+'" href="javascript:void(0)">'+e.label+"</a>")}))}},renderFilters:function(){if(this.model.get("filters").length){var e=new ThriveUlt.views.FiltersView({model:this.model,collection:this.model.get("filters")});e.render(),this.$el.find(".tab-content-title").after(e.el),e.filterClicked(e.$el.children().first())}},renderAddDirectUrlForm:function(){var e=TVE_Dash.tpl("campaign/settings/add_direct_url_form",{});this.$el.append(e)},checkAll:function(){_.each(this.model.get("options").models,(function(e){e.check()}))},checkNone:function(){_.each(this.model.get("options").models,(function(e){e.uncheck()}))},addDirectLinkClicked:function(e){if("keypress"!==e.type||13===e.which){var t=jQuery(e.target).parents(".tvd-add-link-row").find("input");this.model.get("options").add({id:t.val().trim(),label:t.val().trim(),type:"direct_url"},{validate:!0}),t.val("")}}}),ThriveUlt.views.TabLabelView=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/settings/tab_label"),activeClass:"tvu_leads_active_tab",className:"tvd-tab",tagName:"li",events:{},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){this.$el.html(this.template({tab:this.model}))}}),ThriveUlt.views.HangerView=ThriveUlt.views.Base.extend({template:TVE_Dash.tpl("campaign/settings/hanger"),initialize:function(){},render:function(){var e=this.template(this.model.toJSON()),t=this;this.$el.html(e),this.$tabLabelsContainer=this.$el.find(".tvu_leads_tabs"),this.$tabContentsContainer=this.$el.find(".tvu_leads_tabs_wrapper"),_.each(this.model.get("tabs").models,(function(e){e.set("exclusion",t.model.get("identifier").indexOf("hide")>=0);var i=t.renderTabLabels(e),s=t.renderTabContent(e);e.on("change:isActive",_.bind(t.activateTab,t,i,s)),e.on("change",_.bind((function(){"hide_options"===this.model.get("identifier")?jQuery(".exclusions-count").html("("+this.model.countCheckedOptions()+")"):jQuery(".inclusions-count").html("("+this.model.countCheckedOptions()+")")}),t,e))})),this.model.get("tabs").at(0).set("isActive",!0)},renderTabLabels:function(e){var t=new ThriveUlt.views.TabLabelView({model:e});return this.$tabLabelsContainer.append(t.el),t.render(),t},renderTabContent:function(e){var t=new ThriveUlt.views.TabContentView({model:e});return this.$tabContentsContainer.append(t.el),t.render(),t},activateTab:function(e,t,i,s){this.$tabLabelsContainer.find("li").removeClass(e.activeClass).find("a").removeClass("tvd-active"),this.$tabContentsContainer.find(".tvu_leads_tabs_content").hide(),e.$el.addClass(e.activeClass).find("> a").addClass("tvd-active"),t.$el.show(),i.attributes.isActive=!1}}),ThriveUlt.views.CampaignSettings=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("campaign/settings/main"),events:{"click .tvu_leads_save_widget_options":"saveOptions","click .tvu_leads_add_new_template":"saveTemplate","click .tvu_leads_load_saved_options":"loadTemplate","click .tvd-modal-close":"close","click .tl-toggle-tab-display":"toggleTabDisplay","blur input#tvu_leads_new_template_name":function(t){e(t.target).removeClass("tvd-invalid")},"keyup input#tvu_leads_new_template_name":function(e){13===e.which&&this.saveTemplate()}},toggleTabDisplay:function(e){var t=jQuery(e.currentTarget),i=t.hasClass("collapsed"),s=jQuery(t.data("target"));i?s.hide(0).removeClass("tvd-not-visible").slideDown(200):s.slideUp(200,(function(){s.addClass("tvd-not-visible")})),t.toggleClass("collapsed"),t.toggleClass("hover")},afterRender:function(){this.$templatesList=this.$el.find(".tvu_leads_saved_options");var e=this;_.each(this.collection.models,(function(t){e.renderHangerView(t)})),this.$el.addClass("tvd-modal-fixed-footer tvd-modal-display-settings"),this.renderTemplatesList()},_render:function(){this.$el.html(this.template({model:this.model})),this.afterRender(),TVE_Dash.materialize(this.$el)},renderHangerView:function(e){new ThriveUlt.views.HangerView({model:e,el:jQuery("#"+e.get("identifier"))}).render()},renderTemplatesList:function(){var t=this,i=ThriveUlt.objects.savedTemplates.size()>1;this.$templatesList.data("select2")&&this.$templatesList.data("select2").destroy(),this.$templatesList.find("optgroup, option").each((function(t){t>0&&e(this).remove()})),_.every(ThriveUlt.objects.savedTemplates.get("template_groups"),(function(s){if(0===s.size())return!0;var n=e('<optgroup label="'+s.group_name+'"></optgroup>');return s.each((function(e){(i?n:t.$templatesList).append('<option value="'+e.get("id")+'">'+e.get("name")+"</option>")})),i&&t.$templatesList.append(n),!0})),this.$templatesList.select2()},loadTemplate:function(){if(""===this.$templatesList.val())return this.tvd_show_errors({field:"load_template",message:ThriveUlt.t.Select_template});var e=ThriveUlt.objects.savedTemplates.get_template({id:this.$templatesList.val()}),t=this;TVE_Dash.showLoader(),jQuery.ajax({url:ajaxurl,data:{action:ThriveUlt.ajax_actions.admin_controller,route:"displaySettingsLoadTemplate",campaign_id:this.model.get("ID"),template_id:this.$templatesList.val(),_nonce:ThriveUlt.admin_nonce}}).done((function(i){t.collection.reset(i),t._render(),TVE_Dash.hideLoader(),TVE_Dash.success(ThriveUlt.util.printf(ThriveUlt.t.template_loaded,e.get("name")))}))},saveOptions:function(t){var i={options:[JSON.stringify(this.collection.at(0).getDataForSave()),JSON.stringify(this.collection.at(1).getDataForSave())],campaign_id:this.model.get("ID"),_nonce:ThriveUlt.admin_nonce},s=e(t.target),n=s.html(),r=this;TVE_Dash.showLoader(),this.btnLoading(s),e.ajax({url:ajaxurl+"?action="+ThriveUlt.ajax_actions.admin_controller+"&route=displaySettingsSave",type:"post",dataType:"json",data:i,success:function(e){e.success&&(TVE_Dash.success(ThriveUlt.t.Display_settings_saved),r.close())},error:function(e,t,i){TVE_Dash.err(ThriveUlt.t.GeneralError+" ( Error info: <strong>"+i+"</strong> )")},complete:function(){s.html(n).attr("disabled",!1),TVE_Dash.hideLoader()}})},saveTemplate:function(t){var i=e("input[name='tvu_leads_new_template_name']"),s=this;if(i.val().trim().length){var n={name:i.val().trim(),options:[JSON.stringify(this.collection.at(0).getDataForSave()),JSON.stringify(this.collection.at(1).getDataForSave())],_nonce:ThriveUlt.admin_nonce},r=!1;ThriveUlt.objects.savedTemplates.name_exists(n.name,"TU")&&(r=!confirm('"'+n.name+'" template already exists. Do you want to overwrite it ?')),r||(TVE_Dash.showLoader(),e.ajax({type:"post",dataType:"json",data:n,url:ajaxurl+"?action="+ThriveUlt.ajax_actions.admin_controller+"&route=displaySettingsSaveTemplate",success:function(t){t.success?(i.val(""),ThriveUlt.objects.savedTemplates=new ThriveUlt.models.TemplateList(t.templates),s.renderTemplatesList(),s.$templatesList.find("option").each((function(){e(this).text()===n.name&&e(this).attr("selected","selected")})),TVE_Dash.success(ThriveUlt.t.DisplaySettingsTemplateSaved)):TVE_Dash.err(t.message?t.message:ThriveUlt.t.GeneralError)},error:function(e,t,i){TVE_Dash.err(ThriveUlt.t.GeneralError+" ( Error info: <strong>"+i+"</strong> )")},complete:function(){TVE_Dash.hideLoader()}}))}else i.addClass("tvd-invalid").focus()},onClose:function(){var e=this.collection.get_display_summary();this.model.set("display_settings_summary",e),ThriveUlt.globals.campaigns.findWhere({ID:this.model.get("ID")}).set("has_display_settings","Not set"!=e)}})}))}(jQuery)})();