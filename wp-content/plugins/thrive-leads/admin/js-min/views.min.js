window.ThriveLeads=window.ThriveLeads||{},ThriveLeads.views=ThriveLeads.views||{},_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},jQuery((function(){var e=jQuery;function t(t,i){e(window).on("storage.tcb",(function(e){if("tve_add_content_variation"===e.originalEvent.key){var s;try{s=JSON.parse(e.originalEvent.newValue)}catch(e){s={}}var o=parseInt(s.form_type_id),n=parseInt(s.variation_id);o===t.model.id&&n&&t.model.get("variations").forEach((function(e){parseInt(e.id)===n&&(e.set("content",!0),i&&t.render())}))}}))}e(document).keypress((function(e){13!=e.which&&13!=e.keyCode||jQuery(".tve-stop-test-variation-modal-action").is(":visible")&&jQuery(".tve-stop-test-variation-modal-action").focus().click()})),e("body").on("click",".tl-toggle-display",(function(e){var t=jQuery(e.currentTarget),i=t.hasClass("collapsed");jQuery(t.data("target"))[i?"slideDown":"slideUp"](200),t.toggleClass("collapsed"),t.toggleClass("hover")})),ThriveLeads.views.Base=Backbone.View.extend({render:function(){return this.$el.html(this.template(this.model.toJSON())),this},initialize:function(){this.listenTo(this.model,"change",this.render)},modal:function(e,t){return TVE_Dash.modal(e,t)}}),ThriveLeads.views.Group=ThriveLeads.views.Base.extend({tagName:"li",className:"collapse-table-list-item tvd-collapsible",template:TVE_Dash.tpl("groups/item"),events:{"click .tve-group-delete":"deleteGroupPopup","click .tve-start-group-test":"startTest","click .tve-add-form-type":"addFormType","click .tve-group-details":function(e){this.model.set("details_expanded",!this.model.get("details_expanded"))},"click .tve-group-heading":function(e){var t=jQuery(e.target);if(t.hasClass("tve-prevent-click")||t.parents(".tve-prevent-click").length)return e.stopPropagation(),!0;this.model.set("details_expanded",!this.model.get("details_expanded"))},"click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input input":"saveTitle","keyup .tve-edit-title-input input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle","click .tve-group-settings":"showDisplaySettings"},initialize:function(){this.listenTo(this.model,"change:details_expanded",this.groupDetails),this.listenTo(this.model,"change:impressions",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.get("active_tests"),"add",this.render),this.listenTo(this.model.get("completed_tests"),"add",this.render),this.listenTo(this.model.get("form_types"),"change:ID remove add",this.render),this.listenTo(this.model.get("completed_tests"),"remove",this.render),this.listenTo(this.model,"change:post_title",this.render),this.listenTo(this.model,"change:has_display_settings",this.render);var t=this;e(document).on("tl.form_type.added",(function(e,i){i.post_parent&&t.model.get("ID")==i.post_parent&&setTimeout((function(){t.$el.find('.tvd-form-tooltip[data-form="'+i.ID+'"]').fadeIn("slow")}),1e3)})).on("tl.form_type.update_display",(function(e,i){i.post_parent&&t.model.get("ID")==i.post_parent&&t.update_display_options()}))},render:function(){var e=!1,t=!1,i=this.model.toJSON();return i.running_tests_count=this.model.get("active_tests").length,i.archived_tests_count=this.model.get("completed_tests").length,this.$el.html(this.template(i)),this.renderFormTypes(),this.model.ableForTest()||this.$el.find(".tve-start-group-test").hide(),this.model.get("active_tests").length&&(e=!0,this.model.get("active_tests").each(this.renderActiveTest,this)),this.model.get("completed_tests").length&&(t=!0,this.model.get("completed_tests").each(this.renderCompletedTest,this)),this.$el.find(".tve-leads-running-tests")[e?"show":"hide"](),this.$el.find(".tve-leads-archived-tests")[t?"show":"hide"](),this.groupDetails(),this},addFormType:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddFormType,{width:1030,"max-width":"100%",model:this.model.get("form_types"),post_parent:this.model.get("ID"),className:"tvd-modal add-form-type-modal"})},update_display_options:function(){var e=this.model.get("form_types"),t=this.model.get("ID"),i=0,s=0,o=0;e.each((function(e){""!=e.get("ID")&&(o++,i+=parseInt(e.get("display_on_mobile")),s+=parseInt(e.get("display_status")))})),this.$el.find("#tve-dm-"+t).html(0==i?"No":i<o?"Custom":"Yes"),this.$el.find("#tve-ds-"+t).html(0==s?"No":s<o?"Custom":"Yes")},startTest:function(){var e=this;this.$el.find("tr").removeClass("tve-form-no-content"),TVE_Dash.showLoader(),this.model.ajaxGetEmptyVariations().done((function(t){var i=t.ids?t.ids:[];e.model.get("form_types").each((function(e){-1!==jQuery.inArray(e.get("ID"),i)?e.set("has_design",!1):e.set("has_design",!0)})),TVE_Dash.modal(ThriveLeads.views.lightbox.VariationTest,{title:ThriveLeads.const.translations.StartFormtypeTest+" "+ThriveLeads.const.translations.StartGroupTestVideo,model:e.model,width:900,"max-width":"80%"}).renderFormTypes()})).fail((function(e,t,i){})).always((function(){TVE_Dash.hideLoader()}))},renderFormTypes:function(){var e=this,t=0;this.model.get("form_types").each((function(i){if(i.get("ID")){var s=new ThriveLeads.views.FormType({model:i});e.$el.find(".tve-form-types > .tve-form-types-list").append(s.render().el),t++}})),this.$el.find(".tve-no-form-type")[t?"hide":"show"]()},deleteGroupPopup:function(t){var i=e(t.currentTarget);return TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteGroup,{title:i.attr("data-title"),width:650,model:ThriveLeads.objects.groups.get(i.attr("data-id"))}),!1},groupDetails:function(){this.model.get("details_expanded")?(this.$el.addClass("tve-expanded tvd-active"),this.$el.find(".tve-form-types").slideDown("fast")):(this.$el.removeClass("tve-expanded tvd-active"),this.$el.find(".tve-form-types").slideUp("fast"))},renderActiveTest:function(e){var t=this;e.set("type",[]),_.each(e.get("item_ids"),(function(i){var s=t.model.get("form_types").findWhere({ID:parseInt(i)});s&&(s.set("group_test_id",e.get("id")),e.get("type").push(s.get("post_title")))}));var i=new ThriveLeads.views.ActiveTestItem({model:e});this.$el.find("#tve-active-group-test-list").append(i.render().el)},renderCompletedTest:function(e){var t=this;e.set("type",[]),_.each(e.get("item_ids"),(function(i){var s=t.model.get("form_types").findWhere({ID:parseInt(i)});s&&e.get("type").push(s.get("post_title"))}));var i=new ThriveLeads.views.CompletedTestItem({model:e});this.$el.find("#tve-completed-group-test-list").append(i.render().el)},showEditTitleInput:function(e){var t=this.$el.find(".group-title").hide();this.$el.find(".tve-edit-title-input").show().children("input").val(t.text().trim()).focus().select(),jQuery(e.currentTarget).hide(),e.stopPropagation()},saveTitle:function(e){var t=e.currentTarget.value;t!=this.model.get("post_title")&&(this.model.set("post_title",t),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(e){27!=e.which&&13!=e.which||this.closeEditTitle()},closeEditTitle:function(){var e=this.model.get("post_title");this.$el.find(".tve-edit-title-input input").val(e),this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".group-title,.tve-edit-title").show()},showDisplaySettings:function(){TVE_Dash.showLoader();var e={title:this.model.get("post_title")+" "+ThriveLeads.const.translations.DisplayGroupSettings+" "+ThriveLeads.const.translations.GroupSettingsVideo,"max-width":"90%",width:"80%"},t=this.model.get("ID");return jQuery.ajax({url:ThriveLeads.const.url.admin+"admin-ajax.php?action=thrive_leads_backend_ajax&route=displayGroupSettings&group="+t+"&security="+ThriveLeadsConst.security,dataType:"json",success:function(i){ThriveLeads.objects.hangers=new ThriveLeads.collections.Hangers(i.hangers),ThriveLeads.objects.savedTemplates=new ThriveLeads.models.TemplateList(i.savedTemplates),e.collection=ThriveLeads.objects.hangers,e.model={hangers:ThriveLeads.objects.hangers,templates:ThriveLeads.objects.savedTemplates};var s=new ThriveLeads.views.DisplayGroupSettings(e);s.urlSaveOptions=ThriveLeads.ajaxurl("action=thrive_leads_backend_ajax&route=saveGroupSettings&security="+ThriveLeadsConst.security),s.urlSaveTemplate=ThriveLeads.ajaxurl("action=thrive_leads_backend_ajax&route=saveGroupTemplate&security="+ThriveLeadsConst.security),s.group=t,s.render().open()}}).fail((function(){})).always((function(){TVE_Dash.hideLoader()})),!1}}),ThriveLeads.views.FormType=ThriveLeads.views.Base.extend({className:"tve-form-type-item tvd-collection-item",template:TVE_Dash.tpl("form-type/item"),events:{"click .tve-form-type-add":"add","click .tve-form-type-delete":"deleteModal","click .tve-form-type-mobile":"toggle_display","click .tve-form-type-status":"toggle_display","click .form-type-reset":"reset","click .tve-leads-php-code":"grabPHPCode"},initialize:function(){this.listenTo(this.model,"change:group_test_id",this.render),this.listenTo(this.model,"change:conversions",this.render),this.listenTo(this.model,"change:conversion_rate",this.render),this.listenTo(this.model,"change:impressions",this.render);var i=this.model;e(window).on("tl.tpl.save",(function(e,t){t.ID==i.get("ID")&&i.get("variations").get(t.key).set("content","true")})),t(this,!0)},render:function(){return this.$el.html(this.template({form:this.model})),this},add:function(){ThriveLeads.router.navigate("#form-type/"+this.model.get("ID"),{trigger:!0})},save:function(){var e=this;this.model.save({},{success:function(t,i){e.model.set("ID",i)},complete:function(e){}})},toggle_display:function(t){var i=jQuery(t.currentTarget).is(":checked")?1:0,s=this.model.get("post_parent"),o=jQuery(t.target).attr("data-display");this.model.set(o,i),this.save(),e(document).trigger("tl.form_type.update_display",{post_parent:s})},reset:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmFormTypeResetStats,{title:ThriveLeads.const.translations.ResetFormStats,model:this.model,width:600})},grabPHPCode:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.PHPInsertCode,{title:ThriveLeads.const.translations.PHPInsertCode,model:this.model})},deleteModal:function(e){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteFormType,{width:650,model:this.model})}}),ThriveLeads.views.FormVariation=ThriveLeads.views.Base.extend({tagName:"tr",className:"tvd-collection-item",template:TVE_Dash.tpl("form-type/variation"),events:{"click .variation-archive":"archive","click .variation-publish":"reAdd","click .variation-delete":"remove","click .variation-reset":"reset","click .variation-clone":"clone","click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input input":"saveTitle","keyup .tve-edit-title-input input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle","click .tve-leads-display-frequency":"showFrequencyPopup","click .tve-leads-display-animation":"showAnimationPopup","click .tve-leads-lock-display":"showLockDisplayPopup"},has_frequency_settings:!1,has_position_settings:!1,has_animation_settings:!1,has_trigger_settings:!1,content_locking:!1,initialize:function(){this.listenTo(this.model,"change:post_title",this.render),this.listenTo(this.model,"change:impressions",this.render),this.listenTo(this.model,"change:conversions",this.render),this.listenTo(this.model,"change:display_frequency_nice_name",this.render),this.listenTo(this.model,"change:display_position_nice_name",this.render),this.listenTo(this.model,"change:display_animation_nice_name",this.render),this.listenTo(this.model,"change:content_locking",this.render)},render:function(){return this.model.set("has_frequency_settings",this.has_frequency_settings),this.model.set("has_position_settings",this.has_position_settings),this.model.set("has_animation_settings",this.has_animation_settings),this.model.set("content_locking",this.content_locking),this.model.set("has_trigger_settings",this.has_trigger_settings),this.model.set("has_trigger_options",!(this.model instanceof ThriveLeads.models.TwoStepLightboxVariation)),this.$el.html(this.template(this.model.toJSON())),this},archive:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ArchiveForm,{title:ThriveLeads.const.translations.ArchiveForm,model:this.model})},reset:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmResetStats,{title:ThriveLeads.const.translations.ResetFormStats,model:this.model,width:600})},clone:function(e){TVE_Dash.showLoader();var t=this.model.toJSON();if(this.model instanceof ThriveLeads.models.ShortcodeVariation)var i=new ThriveLeads.models.ShortcodeVariation(_.extend({},t));else i=this.model instanceof ThriveLeads.models.TwoStepLightboxVariation?new ThriveLeads.models.TwoStepLightboxVariation(_.extend({},t)):new ThriveLeads.models.FormVariation(_.extend({},t));i.set("clone_from",i.get("key")),i.set("is_control",0),i.set("key","");var s=i.save({});ThriveLeads.addFailCallback(s),s.done((function(e){i.set(e)})).always((function(){s.failed||(i.unset("clone_from"),i instanceof ThriveLeads.models.ShortcodeVariation?(ThriveLeads.objects.Shortcode.get("variations").add(i),ThriveLeads.objects.Shortcode.trigger("change")):i instanceof ThriveLeads.models.TwoStepLightboxVariation?(ThriveLeads.objects.TwoStepLightbox.get("variations").add(i),ThriveLeads.objects.TwoStepLightbox.trigger("change")):(ThriveLeads.objects.FormType.get("variations").push(i),ThriveLeads.objects.FormType.trigger("change")),TVE_Dash.hideLoader())}))},reAdd:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddForm,{title:ThriveLeads.const.translations.ReAddForm+" "+this.model.get("post_title"),model:new Backbone.Model({state:"re-add",group_id:Backbone.history.getFragment().match(/form-type/g)?ThriveLeads.objects.FormType.get("post_parent"):0,form_type_id:this.model.post_parent,form_variation:this.model})})},remove:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteVariation,{title:ThriveLeads.const.translations.DeleteForm,model:this.model,width:650})},showEditTitleInput:function(e){var t=this.$el.find(".form-title").hide();this.$el.find(".tve-edit-title-input").show().children("input").val(t.text().trim()).focus().select(),jQuery(e.currentTarget).hide()},saveTitle:function(e){var t=e.currentTarget.value;t!=this.model.get("post_title")&&(this.model.set("post_title",t),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(e){27!=e.which&&13!=e.which||this.closeEditTitle()},closeEditTitle:function(){this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".form-title,.tve-edit-title").show()},showFrequencyPopup:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DisplayFrequencySettings,{title:ThriveLeads.const.translations.DisplaySettings,model:this.model,width:700})},showAnimationPopup:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AnimationSettings,{model:this.model,"max-width":"40%"})},showLockDisplayPopup:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.LockDisplaySettings,{title:ThriveLeads.const.translations.LockDisplaySettings,model:this.model,width:700})}}),ThriveLeads.views.Dashboard=Backbone.View.extend({el:e("#tve-content"),template:_.template(e("#tve-leads-dashboard").length?e("#tve-leads-dashboard").html():""),globalSettings:null,initialize:function(e){this.globalSettings=e.globalSettings,this.has_non_uniques=e.has_non_uniques},events:{"click .report-item":"goToReporting","click .tve-leads-clear-cache":"clearCacheStats","click .tve-leads-delete-logs":"deleteConversionLogs","click .tl-inbound-link-builder":"inboundLinkBuilder"},goToReporting:function(){location.href=ThriveLeadsConst.url.reporting},inboundLinkBuilder:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.InboundLink,{title:ThriveLeads.const.translations.InboundLinkBuilder,width:750,"max-width":"70%",collection:ThriveLeads.objects.groups,model:new ThriveLeads.models.InboundLink})},render:function(){ThriveLeads.objects.titleChanger.replaceFirst("Thrive Leads Dashboard"),this.$el.html(this.template({globalSettings:this.globalSettings,has_non_uniques:this.has_non_uniques}));var t=new ThriveLeads.views.LeadGroups({el:this.$el.find("#tve-lead-groups"),collection:ThriveLeads.objects.groups}),i=new ThriveLeads.views.LeadShortcodes({el:this.$el.find("#tve-lead-shortcodes"),collection:ThriveLeads.objects.shortcodeCollection}),s=new ThriveLeads.views.TwoStepLightboxList({el:this.$el.find("#tve-two-step-lightbox"),collection:ThriveLeads.objects.TwoStepLightboxCollection}),o=new ThriveLeads.views.OneClickSignupList({el:this.$el.find("#tve-one-click-signup"),collection:ThriveLeads.objects.OneClickSignupCollection}),n=ThriveLeads.objects.groups.getTotalVariations(),a=ThriveLeads.objects.shortcodeCollection.getTotalVariations(),r=ThriveLeads.objects.TwoStepLightboxCollection.getTotalVariations();t.renderAll(),i.render(),s.render(),o.render(),n+a+r&&e("#no-form-overlay").hide(),ThriveLeads.displayMessages(),this.$el.find(".tve-setting-change").on("change",_.bind(this.globalSetting,this)),this.$el.find(".tve-leads-db-optimize").on("click",_.bind(this.optimizeDB,this)),TVE_Dash.materialize(this.$el)},optimizeDB:function(e){var t={action:"thrive_leads_backend_ajax",route:"optimizeDbAPI",security:ThriveLeadsConst.security};TVE_Dash.showLoader(),jQuery.post(ajaxurl,t,(function(){TVE_Dash.success(ThriveLeadsConst.translations.DbOptimized),TVE_Dash.hideLoader()})),this.has_non_uniques=!1},toggleGlobalSettings:function(e){return jQuery(e.currentTarget).parents(".nav-wrapper").find("#tve-settings-postbox").slideToggle(),!1},globalSetting:function(e){var t=jQuery(e.currentTarget),i={action:"thrive_leads_backend_ajax",route:"globalSettingsAPI",field:t.attr("name"),value:t.attr("value"),security:ThriveLeadsConst.security};t.is('input[type="checkbox"]')&&!t.is(":checked")&&(i.value=0),this.globalSettings[i.field]=i.value,jQuery.post(ajaxurl,i)},clearCacheStats:function(){TVE_Dash.showLoader(),jQuery.post(ajaxurl,{action:"thrive_leads_backend_ajax",route:"clearCacheStatistics",security:ThriveLeadsConst.security},(function(){location.reload()}))},deleteConversionLogs:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DeleteConversionLogs)}}),ThriveLeads.views.LeadShortcodes=Backbone.View.extend({events:{"click .tve-add-shortcode":"openAddShortcode"},initialize:function(){this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.remove)},remove:function(){0==this.collection.length&&(this.$el.find(".tve-shortcode-list-header").hide(),this.$el.find(".no-shortcodes").show())},addOne:function(e){var t=new ThriveLeads.views.Shortcode({model:e,collection:this.collection});this.$el.find("#tve-shortcode-list").append(t.render().$el),this.$el.find(".tve-shortcode-list-header").show(),this.$el.find(".no-shortcodes").hide()},render:function(){this.$el.find("#tve-shortcode-list .tvd-collection-item").remove(),this.collection.each(this.addOne,this)},openAddShortcode:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddShortcode,{title:ThriveLeads.const.translations.AddShortcode+" &nbsp;"+ThriveLeads.const.translations.AddNewShortcodeVideo})}}),ThriveLeads.views.Shortcode=Backbone.View.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("shortcode/item"),events:{"click .tve-shortcode-delete":"deleteShortcodePopup","click .shortcode-reset":"reset","click .tve-shortcode-content-locking":"toggle_content_locking","click .tve-leads-php-code":"grabPHPCode","click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input input":"saveTitle","keyup .tve-edit-title-input input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle","click .tve-leads-clear-cache":"clearCacheStats","click .tve-leads-delete-logs":"deleteConversionLogs","change .tve-setting-change":"globalSetting"},initialize:function(){this.model.on("remove",this.remove,this),this.listenTo(this.model,"change:impressions",this.render),this.listenTo(this.model,"change:post_title",this.render)},remove:function(){this.$el.remove()},render:function(){return this.$el.html(this.template({shortcode:this.model})),this.bindZclip(),this.$el.find(".tve-copy-code-container")["1"==this.model.get("content_locking")?"hide":"show"](),TVE_Dash.materialize(this.$el),this},bindZclip:function(){ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))},deleteShortcodePopup:function(t){var i=e(t.currentTarget);TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteShortcode,{title:i.attr("title"),width:650,model:ThriveLeads.objects.shortcodeCollection.get(i.attr("data-id"))})},toggle_content_locking:function(e){var t=jQuery(e.currentTarget).is(":checked")?1:0,i=this;this.model.set("content_locking",t),this.$el.find(".tve-copy-code-container")[t?"hide":"show"](),this.model.save({},{success:function(e,t){i.model.set("ID",t),i.model.set("shortcode_code",""),i.$el.find(".tve-shortcode-"+t).val(i.model.getCode())},complete:function(e){}})},reset:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmFormTypeResetStats,{title:ThriveLeads.const.translations.ResetFormStats,model:this.model,width:600})},grabPHPCode:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.PHPInsertCode,{title:ThriveLeads.const.translations.PHPInsertCode,model:this.model})},showEditTitleInput:function(e){var t=this.$el.find(".group-title").hide();this.$el.find(".tve-edit-title-input").show().children("input").val(t.text().trim()).focus().select(),jQuery(e.currentTarget).hide(),e.stopPropagation()},saveTitle:function(e){var t=e.currentTarget.value;t!=this.model.get("post_title")&&(this.model.set("post_title",t),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(e){27!=e.which&&13!=e.which||this.closeEditTitle()},closeEditTitle:function(){var e=this.model.get("post_title");this.$el.find(".tve-edit-title-input input").val(e),this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".group-title,.tve-edit-title").show()},globalSetting:function(e){var t=jQuery(e.currentTarget),i={action:"thrive_leads_backend_ajax",route:"globalSettingsAPI",field:t.attr("name"),value:t.attr("value"),security:ThriveLeadsConst.security};t.is('input[type="checkbox"]')&&!t.is(":checked")&&(i.value=0),jQuery.post(ajaxurl,i)},clearCacheStats:function(){TVE_Dash.showLoader(),jQuery.post(ajaxurl,{action:"thrive_leads_backend_ajax",route:"clearCacheStatistics",security:ThriveLeadsConst.security},(function(){location.reload()}))},deleteConversionLogs:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DeleteConversionLogs)}}),ThriveLeads.views.TwoStepLightboxList=Backbone.View.extend({events:{"click .tve-add-two-step-lightbox":"openAddTwoStepLightbox"},initialize:function(){this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.remove)},remove:function(){0==this.collection.length&&(this.$el.find("#tve-two-step-lightbox-list").hide(),this.$el.find(".no-two-step-lightbox").show())},addOne:function(e){var t=new ThriveLeads.views.TwoStepLightboxItem({model:e,collection:this.collection});this.$el.find("#tve-two-step-lightbox-list").append(t.render().$el),this.$el.find("#tve-two-step-lightbox-list").show(),this.$el.find(".no-two-step-lightbox").hide()},render:function(){this.$el.find("#tve-two-step-lightbox-list .tvd-collection-item").empty(),this.collection.each(this.addOne,this)},openAddTwoStepLightbox:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddTwoStepLightbox,{title:ThriveLeads.const.translations.AddTwoStepLightbox+" "+ThriveLeads.const.translations.AddNewTwoStepLightboxVideo})}}),ThriveLeads.views.TwoStepLightboxItem=Backbone.View.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("two-step-lightbox/item"),events:{"click .tve-two-step-lightbox-delete":"deleteTwoStepLightboxPopup","click .two-step-reset":"reset","click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input input":"saveTitle","keyup .tve-edit-title-input input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle","click .tve-leads-clear-cache":"clearCacheStats","click .tve-leads-delete-logs":"deleteConversionLogs","change .tve-setting-change":"globalSetting"},initialize:function(){this.model.on("remove",this.remove,this),this.listenTo(this.model,"change:impressions",this.render),this.listenTo(this.model,"change:post_title",this.render)},remove:function(){this.$el.remove()},render:function(){return this.$el.html(this.template({two_step_lightbox:this.model})),this.bindZclip(),TVE_Dash.materialize(this.$el),this},bindZclip:function(){ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))},deleteTwoStepLightboxPopup:function(t){var i=e(t.currentTarget);TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteTwoStepLightbox,{title:i.attr("title"),width:650,model:ThriveLeads.objects.TwoStepLightboxCollection.get(i.attr("data-id"))})},reset:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmFormTypeResetStats,{title:ThriveLeads.const.translations.ResetFormStats,model:this.model,width:600})},showEditTitleInput:function(e){var t=this.$el.find(".group-title").hide();this.$el.find(".tve-edit-title-input").show().children("input").val(t.text().trim()).focus().select(),jQuery(e.currentTarget).hide(),e.stopPropagation()},saveTitle:function(e){var t=e.currentTarget.value;t!=this.model.get("post_title")&&(this.model.set("post_title",t),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(e){27!=e.which&&13!=e.which||this.closeEditTitle()},closeEditTitle:function(){var e=this.model.get("post_title");this.$el.find(".tve-edit-title-input input").val(e),this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".group-title,.tve-edit-title").show()},globalSetting:function(e){var t=jQuery(e.currentTarget),i={action:"thrive_leads_backend_ajax",route:"globalSettingsAPI",field:t.attr("name"),value:t.attr("value"),security:ThriveLeadsConst.security};t.is('input[type="checkbox"]')&&!t.is(":checked")&&(i.value=0),jQuery.post(ajaxurl,i)},clearCacheStats:function(){TVE_Dash.showLoader(),jQuery.post(ajaxurl,{action:"thrive_leads_backend_ajax",route:"clearCacheStatistics",security:ThriveLeadsConst.security},(function(){location.reload()}))},deleteConversionLogs:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DeleteConversionLogs)}}),ThriveLeads.views.OneClickSignupList=Backbone.View.extend({events:{"click .tve-add-one-click-signup":"openAddOneClickSignup"},initialize:function(){this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.remove)},remove:function(){0==this.collection.length&&(this.$el.find("#tve-one-click-signup-list").hide(),this.$el.find(".no-one-click-signup").show())},addOne:function(e){var t=new ThriveLeads.views.OneClickSignupItem({model:e,collection:this.collection});this.$el.find("#tve-one-click-signup-list").append(t.render().$el),this.$el.find("#tve-one-click-signup-list").show(),this.$el.find(".no-one-click-signup").hide()},render:function(){this.$el.find("#tve-one-click-signup-list .tvd-collection-item").empty(),this.collection.each(this.addOne,this)},openAddOneClickSignup:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddOneClickSignup)}}),ThriveLeads.views.OneClickSignupItem=Backbone.View.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("one-click-signup/item"),events:{"click .tve-one-click-signup-delete":"deleteOneClickSignupPopup","click .one-click-signup-reset":"reset","click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input input":"saveTitle","keyup .tve-edit-title-input input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle","click .show-redirect-settings":"showRedirectSettings","click .show-api-connections":"showApiConnections","click .tl-copy-btn-overlay":"checkSetupsBeforeCopy"},initialize:function(){this.model.on("remove",this.remove,this),this.listenTo(this.model,"change:post_title",this.render),this.listenTo(this.model,"change:signups",this.render),this.listenTo(this.model,"change:changed_redirect_url",this.render),this.listenTo(this.model,"change:changed_connection",this.render)},remove:function(){this.$el.remove()},render:function(){return this.$el.html(this.template({one_click_signup:this.model})),this.bindZclip(),this},bindZclip:function(){var e=this.$el.find("a.tve-copy-to-clipboard");e.hasClass("tvd-disabled")||ThriveLeads.bindZClip(e)},deleteOneClickSignupPopup:function(t){var i=e(t.currentTarget);TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteOneClickSignup,{width:650,title:ThriveLeads.const.translations.DeleteSignupSegue,model:ThriveLeads.objects.OneClickSignupCollection.get(i.attr("data-id"))})},reset:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmFormTypeResetStats,{title:ThriveLeads.const.translations.ResetFormStats,model:this.model,width:600})},showEditTitleInput:function(e){var t=this.$el.find(".group-title").hide();this.$el.find(".tve-edit-title-input").show().children("input").val(t.text().trim()).focus().select(),jQuery(e.currentTarget).hide(),e.stopPropagation()},saveTitle:function(e){var t=e.currentTarget.value;t!=this.model.get("post_title")&&(this.model.set("post_title",t),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(e){27!=e.which&&13!=e.which||this.closeEditTitle()},closeEditTitle:function(){var e=this.model.get("post_title");this.$el.find(".tve-edit-title-input input").val(e),this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".group-title,.tve-edit-title").show()},showRedirectSettings:function(e){TVE_Dash.modal(ThriveLeads.views.lightbox.OneClickSignupRedirectSettings,{"max-width":"60%",model:this.model})},showApiConnections:function(t){var i=e(t.currentTarget);TVE_Dash.modal(ThriveLeads.views.lightbox.OneClickSignupApiConnections,{title:i.attr("title"),"max-width":"40%",model:this.model})},checkSetupsBeforeCopy:function(){return!1}}),ThriveLeads.views.LeadGroups=Backbone.View.extend({events:{"click .tve-add-group":"openAddGroup"},viewItems:[],initialize:function(){this.collection.off(),this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne)},removeOne:function(){0===this.collection.length&&(this.$el.find(".hide-no-groups").hide(),this.$el.find(".show-no-groups").show())},addOne:function(t,i,s){t.get("active_tests")instanceof Backbone.Collection||t.set("active_tests",new ThriveLeads.collections.Tests(t.get("active_tests"))),t.get("completed_tests")instanceof Backbone.Collection||t.set("completed_tests",new ThriveLeads.collections.Tests(t.get("completed_tests"))),this.$el.find(".hide-no-groups").show(),this.$el.find(".show-no-groups").hide();var o=new ThriveLeads.views.Group({model:t});if(this.$el.find("#tve-group-list").append(o.render().$el),this.viewItems.push(o),s&&s.add){this.$el.find(".tve-expanded .tvd-collapsible-header").trigger("click");var n=this.$el.find("#tve-lead-group-"+t.get("ID"));setTimeout((function(){e("html,body").animate({scrollTop:n.offset().top-100},1e3),n.trigger("click")}),10)}},addAll:function(e){this.viewItems=[],this.$el.find("#tve-group-list").empty(),e.each(this.addOne,this)},render:function(){this.collection.length?(this.$el.find(".hide-no-groups").show(),this.$el.find(".show-no-groups").hide()):(this.$el.find(".hide-no-groups").hide(),this.$el.find(".show-no-groups").show());var e=this;return this.$el.find("#tve-group-list").sortable({placeholder:"ui-sortable-placeholder",handle:".tve-sort-handle",axis:"y",update:function(t,i){e.updateOrder()},start:function(e,t){t.item.removeClass("tve-expanded").find(".tve-form-types").hide()}}),this},updateOrder:function(){var e={};_.each(this.viewItems,(function(t){t.model.get("order")!=t.$el.index()&&(t.model.set("order",t.$el.index()),e[t.model.get("ID")]=t.$el.index())})),this.collection.sort(),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"groupAPI",custom:"update_order",new_order:e,security:ThriveLeadsConst.security}})},renderAll:function(){this.addAll(this.collection),this.render()},openAddGroup:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddGroup,{"max-width":"35%"})}}),ThriveLeads.views.FormTypeEdit=Backbone.View.extend({el:e("#tve-content"),template:TVE_Dash.tpl("form-type/edit"),events:{"click .tve-add-form":"addFormPopup","click .tve-start-variation-test":"startVariationTestPopup","click .tve-leads-main-php-code":"grabPHPCode","click .tve-leads-clear-cache":"clearCacheStats","click .tve-leads-delete-logs":"deleteConversionLogs","change .tve-setting-change":"globalSetting"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model.get("completed_tests"),"remove",this.render),t(this,!1)},clear:function(){this.$el.html(""),this.delegateEvents()},grabPHPCode:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.PHPInsertCode,{title:ThriveLeads.const.translations.PHPInsertCode,model:this.model})},render:function(){ThriveLeads.objects.titleChanger.replaceFirst(this.model.get("post_title")),this.FLAG_skipListener?delete this.FLAG_skipListener:(this.$el.html(this.template({model:this.model})),this.toggleLogic(),this.addPublished(this.model.get("variations")),this.addArchived(this.model.get("variations_archived")),this.addCompletedTests(this.model.get("completed_tests")),this.displayDetailsOfGroupModel(),ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard")),ThriveLeads.displayMessages(),new ThriveLeads.views.Breadcrumbs({collection:ThriveLeads.objects.BreadcrumbsCollection,el:"#tve-leads-breadcrumbs"}).render(),TVE_Dash.materialize(this.$el),TVE_Dash.hideLoader())},toggleLogic:function(){0===this.model.get("variations").length&&0===this.model.get("variations_archived").length&&0===this.model.get("completed_tests").length?(this.$el.find(".tl-show-no-forms").show(),this.$el.find(".tl-hide-no-forms").hide()):(this.$el.find(".tl-show-no-forms").hide(),this.$el.find(".tl-hide-no-forms").show()),this.model.get("variations").length?(this.$el.find(".hide-no-groups").show(),this.$el.find(".show-no-groups").hide()):(this.$el.find(".hide-no-groups").hide(),this.$el.find(".show-no-groups").show()),this.$el.find("#tl-completed-tests")[this.model.get("completed_tests").length?"show":"hide"](),this.$el.find("#tl-archived-forms")[this.model.get("variations_archived").length?"show":"hide"]()},displayDetailsOfGroupModel:function(){try{var e=ThriveLeads.objects.groups.findWhere({ID:this.model.get("post_parent")});e&&e.set("details_expanded",!0)}catch(e){console.log(e.message)}},addPublishedItem:function(e){var t=new ThriveLeads.views.FormVariation({model:e,collection:this.model.get("variations")});t.has_frequency_settings=this.model.get("has_frequency_settings"),t.has_position_settings=this.model.get("has_position_settings"),t.has_animation_settings=this.model.get("has_animation_settings"),t.has_trigger_settings=this.model.get("has_trigger_settings"),t.content_locking=this.model.get("content_locking"),this.$el.find("#tve-variation-list").append(t.render().el)},addPublished:function(e){if(this.$el.find("#tve-variation-list").empty(),!(e.length<=0)){e.each(this.addPublishedItem,this),e.length>1&&1===this.$el.find(".tve-start-variation-test").length&&this.$el.find(".tve-start-variation-test").show();try{this.model.get("post_type")===ThriveLeads.const.tve_leads_post_form_type&&ThriveLeads.objects.groups.findWhere({ID:this.model.get("post_parent")}).get("form_types").findWhere({ID:this.model.get("ID")}).get("variations").reset(this.model.get("variations").toJSON())}catch(e){console.log(e.message)}}},addArchivedItem:function(e){var t=new ThriveLeads.views.FormVariation({model:e});t.has_frequency_settings=this.model.get("has_frequency_settings"),t.has_position_settings=this.model.get("has_position_settings"),t.has_animation_settings=this.model.get("has_animation_settings"),t.has_trigger_settings=this.model.get("has_trigger_settings"),t.content_locking=this.model.get("content_locking"),this.$el.find("#tve-archive-list").append(t.render().el)},addArchived:function(e){e.length<=0||(this.$el.find("#tve-archive-list").empty(),e.each(this.addArchivedItem,this))},addCompletedTestItem:function(e){var t=new ThriveLeads.views.CompletedTestItem({model:e});this.$el.find("#tve-completed-test-list").append(t.render().el)},addCompletedTests:function(e){e.length<=0||(this.$el.find("#tve-completed-test-list .tvd-collapsible-body").empty(),e.each(this.addCompletedTestItem,this))},addFormPopup:function(e){TVE_Dash.modal(ThriveLeads.views.lightbox.AddForm,{title:ThriveLeads.const.translations.AddNewForm+" "+ThriveLeads.const.translations.AddNewFormVideo,model:new Backbone.Model({state:"add",form_type_id:this.model.get("ID"),group_id:this.model.get("post_parent"),form_variation:{},post_type:this.model.get("post_type"),content_locking:this.model.get("content_locking")})})},markRowErrors:function(e){var t=this;_.each(e,(function(e){t.$el.find("#variation-key-"+e).parents("tr").first().addClass("tve-form-no-content")}))},startVariationTestPopup:function(e){var t=this;this.$el.find("tr").removeClass("tve-form-no-content"),TVE_Dash.showLoader(),this.model.ajaxGetEmptyVariations().done((function(e){var i=e.ids?e.ids:[];if(i.length)return TVE_Dash.err(ThriveLeads.const.translations.MissingFormContent,ThriveLeads.const.toast_timeout),void t.markRowErrors(i);TVE_Dash.modal(ThriveLeads.views.lightbox.VariationTest,{title:ThriveLeads.const.translations.StartVariationTest+" "+ThriveLeads.const.translations.StartVariationTestVideo,model:t.model,width:700})})).fail((function(e,t,i){})).always((function(){TVE_Dash.hideLoader()}))},globalSetting:function(e){var t=jQuery(e.currentTarget),i={action:"thrive_leads_backend_ajax",route:"globalSettingsAPI",field:t.attr("name"),value:t.attr("value"),security:ThriveLeadsConst.security};t.is('input[type="checkbox"]')&&!t.is(":checked")&&(i.value=0),jQuery.post(ajaxurl,i)},clearCacheStats:function(){TVE_Dash.showLoader(),jQuery.post(ajaxurl,{action:"thrive_leads_backend_ajax",route:"clearCacheStatistics",security:ThriveLeadsConst.security},(function(){location.reload()}))},deleteConversionLogs:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DeleteConversionLogs)}}),ThriveLeads.views.Test=Backbone.View.extend({el:e("#tve-content"),template:TVE_Dash.tpl("tests/view"),events:{"click .tve-leads-clear-cache":"clearCacheStats","click .tve-leads-delete-logs":"deleteConversionLogs","change .tve-setting-change":"globalSetting"},render:function(){var e=this;if(ThriveLeads.objects.titleChanger.replaceFirst(this.model.get("title")),this.$el.html(this.template({test:this.model})),this.renderItems(),this.renderChart(),this.model.get("status")===ThriveLeads.const.test_status.running&&this.renderOptions(),this.model.get("test_type")===ThriveLeads.const.group_test_type)this.displayDetailsOfGroupModel(this.model.get("main_group_id"));else{var t=this.model.get("items").length?this.model.get("items").first().get("main_group_id"):0;this.displayDetailsOfGroupModel(t)}void 0!==this.collection&&this.collection instanceof ThriveLeads.collections.Tests&&(this.listenTo(this.collection,"add",this.addCompletedTestItem),this.collection.fetch({url:ThriveLeads.ajaxurl("action=thrive_leads_backend_ajax&route=completedTests&security="+ThriveLeadsConst.security+"&id="+this.model.get("main_group_id")),success:function(){e.$el.find("#tl-completed-tests-count").html("("+e.collection.length+")"),0===e.collection.length&&e.$el.find("#tve-completed-test-list").html('<li class="tvd-collection-item">'+ThriveLeadsConst.translations.NoTestCompleted+"</li>"),e.$el.find("#tl-completed-tests").slideDown(200)}})),TVE_Dash.materialize(this.$el)},addCompletedTestItem:function(e){var t=new ThriveLeads.views.CompletedTestItem({model:e});this.$el.find("#tve-completed-test-list").append(t.render().el)},renderOptions:function(){new ThriveLeads.views.TestOptions({model:this.model,collection:this.model.get("items"),el:this.$el.find("#tve-test-options")}).render()},renderChart:function(){var e=new ThriveLeads.models.TestChartModel({ID:this.model.get("id"),start_date:this.model.get("date_started"),interval:"day"}),t=new ThriveLeads.views.TestChartView({model:e,el:this.$el.find(".tve-chart-interval")});t.drawCandleStick(this.model.get("items"),"tve-candle-stick-chart"),this.model.get("stopped_items").length>0&&t.drawCandleStick(this.model.get("stopped_items"),"tve-candle-stick-chart-stopped"),e.fetch()},renderItems:function(){!this.model.get("items")||this.model.get("items").length<=0||(this.model.get("items")instanceof Backbone.Collection||this.model.set("items",new ThriveLeads.collections.TestItems(this.model.get("items"))),this.displayNoDataOverlay(this.model.get("items")),new ThriveLeads.views.TestItemList({model:this.model,collection:this.model.get("items"),el:this.$el.find("#tve-form-test-items")}).render(),new ThriveLeads.views.TestItemsTotals({model:this.model,collection:this.model.get("items"),el:this.$el.find("#tve-test-items-total")}).render(),!this.model.get("stopped_items")||this.model.get("stopped_items").length<=0||(this.model.get("stopped_items")instanceof Backbone.Collection||this.model.set("stopped_items",new ThriveLeads.collections.TestItems(this.model.get("stopped_items"))),new ThriveLeads.views.TestStoppedItemList({model:this.model,collection:this.model.get("stopped_items"),el:this.$el.find("#tve-form-test-stopped-items")}).render()))},displayDetailsOfGroupModel:function(e){try{var t=ThriveLeads.objects.groups.findWhere({ID:parseInt(e)});t&&t.set("details_expanded",!0)}catch(e){console.log(e.message)}},displayNoDataOverlay:function(e){var t=!0;e.each((function(e){parseInt(e.get("unique_impressions"))>0&&(t=!1)})),t?this.$el.find(".tve-chart-overlay").show():this.$el.find(".tve-chart-overlay").hide()},globalSetting:function(e){var t=jQuery(e.currentTarget),i={action:"thrive_leads_backend_ajax",route:"globalSettingsAPI",field:t.attr("name"),value:t.attr("value"),security:ThriveLeadsConst.security};t.is('input[type="checkbox"]')&&!t.is(":checked")&&(i.value=0),jQuery.post(ajaxurl,i)},clearCacheStats:function(){TVE_Dash.showLoader(),jQuery.post(ajaxurl,{action:"thrive_leads_backend_ajax",route:"clearCacheStatistics",security:ThriveLeadsConst.security},(function(){location.reload()}))},deleteConversionLogs:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DeleteConversionLogs)}}),ThriveLeads.views.CompletedTestItem=Backbone.View.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("tests/completed-test-item"),events:{"click .tve-form-type-test-delete":"deleteTest"},render:function(){return this.$el.html(this.template({test:this.model})),this},deleteTest:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.confirmDeleteTest,{title:ThriveLeads.const.translations.DeleteTest,model:this.model})}}),ThriveLeads.views.ActiveTestItem=Backbone.View.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("tests/active-test-item"),render:function(){return this.$el.html(this.template({test:this.model})),this}}),ThriveLeads.views.TestChartView=Backbone.View.extend({events:{"change #tve-chart-interval-select":"intervalChanged"},currentInterval:"day",initialize:function(){this.createChart();var e=this;this.listenTo(this.model,"change:interval",(function(){e.model.fetch()})),this.listenTo(this.model,"change",this.updateChart)},intervalChanged:function(){var e=this.$el.find("#tve-chart-interval-select").val();e!=this.currentInterval&&(this.currentInterval=e,void 0!==this.chart&&this.chart.showLoading(),this.model.set("interval",e))},updateChart:function(){this.chart.set("data",this.model.get("chart_data")),this.chart.set("title",this.model.get("chart_title")),this.chart.set("x_axis",this.model.get("chart_x_axis")),this.chart.set("y_axis",this.model.get("chart_y_axis")),this.chart.redraw()},createChart:function(){this.chart=new ThriveLeads.LineChart({title:"",data:[],renderTo:"tve-test-chart"}),this.chart.showLoading()},drawCandleStick:function(e,t){if(e&&e.length){var i=e.getCandleStickData();this.bar_chart=new ThriveLeads.BarChart({title:"",data:i.chartData,colors:i.chartColors,renderTo:t})}}}),ThriveLeads.views.TestItemList=Backbone.View.extend({addOne:function(e,t){var i=ThriveLeads.const.CHART_COLORS[e.get("index")%ThriveLeads.const.CHART_COLORS.length];e.set("show_graph",!0),e.set("index",t),e.set("parent_test_running",this.model.isRunning()),e.set("color",i);var s=new ThriveLeads.views.TestItem({model:e});this.$el.append(s.render().el)},addAll:function(e){e.each(this.addOne,this)},render:function(){return this.addAll(this.collection),this}}),ThriveLeads.views.TestItem=Backbone.View.extend({events:{"click .tve-stop-test-variation-modal":"stopTestVariationModal"},tagName:"tr",className:"tvd-collection-item",template:TVE_Dash.tpl("tests/item"),initialize:function(e){this.highest_id=e.highest_id},stopTestVariationModal:function(e){TVE_Dash.modal(ThriveLeads.views.lightbox.StopVariation,{model:this.model,"max-width":"60%",width:450})},render:function(){return this.$el.html(this.template({item:this.model})),this.highest_id===this.model.get("id")&&this.$el.addClass("highlight"),this}}),ThriveLeads.views.TestStoppedItemList=Backbone.View.extend({addOne:function(e,t){var i=ThriveLeads.const.CHART_COLORS[e.get("index")%ThriveLeads.const.CHART_COLORS.length];e.set("show_graph",!0),e.set("index",t),e.set("parent_test_running",this.model.isRunning()),e.set("color",i);var s=new ThriveLeads.views.TestStoppedItem({model:e});this.$el.append(s.render().el)},addAll:function(e){e.each(this.addOne,this)},render:function(){return this.addAll(this.collection),this}}),ThriveLeads.views.TestStoppedItem=Backbone.View.extend({tagName:"tr",className:"tvd-collection-item tvd-gray tvd-tooltipped",template:TVE_Dash.tpl("tests/stopped-item"),initialize:function(e){this.$el.attr("data-tooltip",ThriveLeads.const.translations.stoppedVariationRowTooltip+" "+this.model.get("stopped_date")).attr("data-position","top"),this.highest_id=e.highest_id},render:function(){return this.$el.html(this.template({item:this.model})),this.highest_id===this.model.get("id")&&this.$el.addClass("highlight"),this}}),ThriveLeads.views.TestItemsTotals=Backbone.View.extend({events:{"click .tve-edit-test":"editTest"},template:TVE_Dash.tpl("tests/totals"),initialize:function(){this.listenTo(this.model,"auto_win_changed",_.bind(this.render,this))},render:function(){this.$el.html(this.template({totals:this.collection.getTotals(),test:this.model}))},editTest:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.EditVariationTest,{title:ThriveLeads.const.translations.AutomaticWinnerSettings,model:this.model})}}),ThriveLeads.views.TestOptions=Backbone.View.extend({template:TVE_Dash.tpl("tests/options"),events:{"click .tve-stop-test":"stopTest"},stopTest:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.StopVariationTest,{title:ThriveLeads.const.translations.ChooseWinner,width:1230,"max-width":"90%",model:this.model,collection:this.collection})},render:function(){this.$el.append(this.template(this.model.toJSON()))}}),ThriveLeads.views.FiltersView=ThriveLeads.views.Base.extend({className:"tve_leads_filtersContainer",events:{"click .tve_leads_tabFilter":function(e){this.filterClicked(jQuery(e.target))}},initialize:function(){},render:function(){var e=this;_.each(this.collection.models,(function(t){e.renderFilter(t)}))},renderFilter:function(e){var t=TVE_Dash.tpl("groups/settings/filter",e.toJSON());this.$el.append(t)},filterClicked:function(e){this.$el.find(".tve_leads_tabFilter").removeClass("selected"),e.addClass("selected"),_.each(this.$el.parent().find(".tve_leads_optionContainer,.tve_leads_tab_content_toggle"),(function(t){var i=jQuery(t);i.children("label").data("type")===e.attr("id")?i.show():i.hide()})),this.renderSelectedFilter(e.text())},renderSelectedFilter:function(e){var t=this.$el.next(".tve_leads_selectedFilter");t.length&&t.remove();var i=TVE_Dash.tpl("groups/settings/selected_filter",{filter:e});this.$el.after(i)}}),ThriveLeads.views.OptionView=ThriveLeads.views.Base.extend({className:"tve_leads_optionContainer tvd-col tvd-s6 tvd-m6 tvd-l2",events:{"click .tve_leads_toggle_option":"toggle","click .tve_leads_removeDirectLink":"removeLink"},initialize:function(){this.listenTo(this.model,"change:isChecked",this.isCheckedChanged)},render:function(){var e;"direct_url"===this.model.get("type")?(this.$el.removeClass("tvd-l2"),e=TVE_Dash.tpl("groups/settings/direct_url",this.model.toJSON())):e=TVE_Dash.tpl("groups/settings/option",this.model.toJSON()),"item_page"===this.model.get("type")&&this.$el.removeClass("tvd-l2").addClass("tvd-l3"),this.$el.append(e)},toggle:function(){this.model.toggle()},isCheckedChanged:function(){this.$el.find('input[type="checkbox"]').prop("checked",this.model.get("isChecked"))},removeLink:function(){this.model.collection.remove(this.model)}}),ThriveLeads.views.tab_custom_views={_autocomplete:function(e,t,i){e.autocomplete({appendTo:e.parent(),minLength:2,delay:200,source:function(e,i){jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"thrive_leads_backend_ajax",route:t,q:e.term,tax:"post_tag",security:ThriveLeadsConst.security}}).done((function(e){i(e)}))},select:i})},taxonomy_terms:Backbone.View.extend({template:TVE_Dash.tpl("groups/settings/tags_filter"),render:function(e){var t=this;return this.$el.html(this.template(this.model.attributes)),this.$el.addClass("tve_leads_tab_content_toggle").hide(),ThriveLeads.views.tab_custom_views._autocomplete(this.$el.find(".tve-leads-autocomplete"),"tagSearch",(function(e,i){return t.model.get("options").add({isChecked:!0,type:"post_tag",id:i.item.id,label:i.item.label}),this.value="",!1})),e.find(".tve_leads_selectedFilter").after(this.$el),this}}),posts:Backbone.View.extend({template:TVE_Dash.tpl("groups/settings/posts_filter"),render:function(e){var t=this;this.$el.html(this.template(this.model.attributes)),ThriveLeads.views.tab_custom_views._autocomplete(this.$el.find(".tve-leads-autocomplete"),"postSearch",(function(e,i){return t.model.get("options").add({isChecked:!0,type:"",id:i.item.id,label:i.item.label}),this.value="",!1})),e.find(".tab-content-title").after(this.$el)}})},ThriveLeads.views.TabContentView=ThriveLeads.views.Base.extend({actionContainerClass:"tve_leads_actionContainer",actionDefaultClass:"tvd-btn-flat tvd-btn-flat-dark tvd-waves-effect",className:"tvd-row",events:{"click .selectAll":"checkAll","click .selectNone":"checkNone","click .tve_leads_addDirectLink":"addDirectLinkClicked","keypress .tve_leads_directUrl":"addDirectLinkClicked"},initialize:function(){this.listenTo(this.model.get("options"),"add",(function(e){this.renderOptions(e.get("type")),this.model.trigger("change",this.model)})),this.listenTo(this.model.get("options"),"remove",(function(){this.renderOptions(),this.model.trigger("change",this.model)}))},renderOthersTab:function(){this.$el.attr("id",this.model.getTabIdFromIdentifier()).append('<h5 class="tab-content-title">'+ThriveLeads.const.translations.VisitorStatus+"</h5>").append('<div class="tl-visitor-status clearfix"></div>').append('<div class="clear"></div><h5 class="tab-second-title">'+ThriveLeads.const.translations.DirecURL+"</h5>").append('<div class="tl-direct-urls tvd-row tve_leads_tab_content_direct_urls clearfix"></div>'),this.renderOptionsOthers(),this.renderAddDirectUrlForm()},renderOptionsOthers:function(){this.$el.find(".tl-visitor-status").empty(),this.$el.find(".tl-direct-urls").empty();var e=this;_.each(this.model.get("options").models,(function(t){var i="direct_url"==t.get("type")?e.$el.find(".tl-direct-urls"):e.$el.find(".tl-visitor-status");t.set("base_id",e.model.getTabIdFromIdentifier());var s=new ThriveLeads.views.OptionView({model:t});i.append(s.el),s.render(),t.on("change:isChecked",(function(){e.model.trigger("change")}))}))},render:function(){if("others"===this.model.get("identifier"))return this.renderOthersTab();this.$el.append('<span class="tab-content-title"></span>').attr("id",this.model.getTabIdFromIdentifier()),this.renderActions(),this.renderOptions(),this.renderFilters(),this.renderCustomHtml()},renderCustomHtml:function(){ThriveLeads.views.tab_custom_views[this.model.get("identifier")]&&new(ThriveLeads.views.tab_custom_views[this.model.get("identifier")])({model:this.model}).render(this.$el)},renderOptions:function(e){if("others"===this.model.get("identifier"))return this.renderOptionsOthers();this.$el.find(".tve_leads_optionContainer").remove();var t=this;_.each(this.model.get("options").models,(function(i){t.renderOption(i,e),i.on("change:isChecked",(function(){t.model.trigger("change",t.model)}))}))},renderOption:function(e,t){e.set("base_id",this.model.getTabIdFromIdentifier());var i=new ThriveLeads.views.OptionView({model:e});this.$el.append(i.el),i.render(),t&&e.get("type")!=t&&i.$el.hide()},renderActions:function(){if(this.model.get("actions").length){var e=jQuery('<div class="'+this.actionContainerClass+' tve_leads_clearfix" />'),t=this;this.$el.append(e),this.model.get("actions").length&&_.each(this.model.get("actions"),(function(e){t.$el.find("."+t.actionContainerClass).append('<a class="'+t.actionDefaultClass+" "+e.cssClass+'" href="javascript:void(0)">'+e.label+"</a>")}))}},renderFilters:function(){if(this.model.get("filters").length){var e=new ThriveLeads.views.FiltersView({model:this.model,collection:this.model.get("filters")});e.render(),this.$el.find(".tab-content-title").after(e.el),e.filterClicked(e.$el.children().first())}},renderAddDirectUrlForm:function(){var e=TVE_Dash.tpl("groups/settings/add_direct_url_form",{});this.$el.append(e)},checkAll:function(){_.each(this.model.get("options").models,(function(e){e.check()}))},checkNone:function(){_.each(this.model.get("options").models,(function(e){e.uncheck()}))},addDirectLinkClicked:function(e){if("keypress"!==e.type||13===e.which){var t=jQuery(e.target).parents(".tvd-add-link-row").find("input");this.model.get("options").add({id:t.val().trim(),label:t.val().trim(),type:"direct_url"},{validate:!0}),t.val("")}}}),ThriveLeads.views.TabLabelView=ThriveLeads.views.Base.extend({template:TVE_Dash.tpl("groups/settings/tab_label"),activeClass:"tve_leads_active_tab",className:"tvd-tab",tagName:"li",events:{},render:function(){this.$el.html(this.template({tab:this.model}))}}),ThriveLeads.views.HangerView=ThriveLeads.views.Base.extend({template:TVE_Dash.tpl("groups/settings/hanger"),initialize:function(){},render:function(){var e=this.template(this.model.toJSON()),t=this;this.$el.html(e),this.$tabLabelsContainer=this.$el.find(".tve_leads_tabs"),this.$tabContentsContainer=this.$el.find(".tve_leads_tabs_wrapper"),_.each(this.model.get("tabs").models,(function(e){e.set("exclusion",t.model.get("identifier").indexOf("hide")>=0);var i=t.renderTabLabels(e),s=t.renderTabContent(e);e.on("change:isActive",_.bind(t.activateTab,t,i,s)),e.on("change",_.bind((function(){"hide_group_options"===this.model.get("identifier")?jQuery("#exclusions-count").html("("+this.model.countCheckedOptions()+")"):jQuery("#inclusions-count").html("("+this.model.countCheckedOptions()+")")}),t,e))})),this.model.get("tabs").at(0).set("isActive",!0)},renderTabLabels:function(e){var t=new ThriveLeads.views.TabLabelView({model:e});return this.$tabLabelsContainer.append(t.el),t.render(),t},renderTabContent:function(e){var t=new ThriveLeads.views.TabContentView({model:e});return this.$tabContentsContainer.append(t.el),t.render(),t},activateTab:function(e,t,i,s){this.$tabLabelsContainer.find("li").removeClass(e.activeClass).find("a").removeClass("tvd-active"),this.$tabContentsContainer.find(".tve_leads_tabs_content").hide(),e.$el.addClass(e.activeClass).find("> a").addClass("tvd-active"),t.$el.show(),i.attributes.isActive=!1}}),ThriveLeads.views.DisplayGroupSettings=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("groups/settings/group_settings"),events:{"click .tve_leads_save_widget_options":"saveOptions","click .tve_leads_add_new_template":"saveTemplate","click .tve_leads_load_saved_options":"loadTemplate","click .tl-toggle-tab-display":"toggleTabDisplay"},toggleTabDisplay:function(e){var t=jQuery(e.currentTarget),i=t.hasClass("collapsed"),s=jQuery(t.data("target"));i?s.hide(0).removeClass("tvd-not-visible").slideDown(200):s.slideUp(200,(function(){s.addClass("tvd-not-visible")})),t.toggleClass("collapsed"),t.toggleClass("hover")},afterRender:function(){var e=ThriveLeads.objects.groups.get(parseInt(this.group));ThriveLeads.objects.titleChanger.replaceFirst(e.get("post_title")+" "+ThriveLeads.const.translations.DisplayGroupSettings),this.$templatesList=this.$el.find(".tve_leads_saved_options");var t=this;_.each(this.collection.models,(function(e){t.renderHangerView(e)})),this.$el.addClass("tvd-modal-fixed-footer tvd-modal-display-settings"),this.renderTemplatesList()},onClose:function(){},_render:function(){if(this.$el.html(this.template()),this.data.title){var t=this.$el.find("h3.tvd-modal-title");t.length||(t=e('<h3 class="tvd-modal-title"></h3>'),this.$el.find(".tvd-modal-content").prepend(t)),t.html(this.data.title)}this.afterRender(),TVE_Dash.materialize(this.$el),this.$el.children(".tvd-modal-close").length||this.$el.append('<a href="javascript:void(0)" class="tvd-modal-action tvd-modal-close tvd-modal-close-x"><i class="tvd-icon-close2"></i></a>')},renderHangerView:function(e){new ThriveLeads.views.HangerView({model:e,el:jQuery("#"+e.get("identifier"))}).render()},renderTemplatesList:function(){var t=this,i=ThriveLeads.objects.savedTemplates.size()>1;this.$templatesList.data("select2")&&this.$templatesList.data("select2").destroy(),this.$templatesList.find("optgroup, option").each((function(t){t>0&&e(this).remove()})),_.each(ThriveLeads.objects.savedTemplates.get("template_groups"),(function(s){if(0===s.size())return!0;var o=e('<optgroup label="'+s.group_name+'"></optgroup>');s.each((function(e){(i?o:t.$templatesList).append('<option value="'+e.get("id")+'">'+e.get("name")+"</option>")})),i&&t.$templatesList.append(o)})),this.$templatesList.select2()},loadTemplate:function(){var e=this;if(""===this.$templatesList.val())return this.collection=ThriveLeads.objects.hangers,void this._render();var t=this.$templatesList.val(),i=ThriveLeads.objects.savedTemplates.get_template({id:t});TVE_Dash.showLoader(),jQuery.ajax({url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"loadGroupTemplate",group:this.group,template_id:this.$templatesList.val(),security:ThriveLeadsConst.security}}).done((function(s){e.collection.reset(s),e._render(),TVE_Dash.success(i.get("name")+" "+ThriveLeads.const.translations.DisplaySettingsTemplateLoaded),TVE_Dash.hideLoader(),e.$templatesList.val(t).trigger("change")}))},saveOptions:function(t){var i={options:[JSON.stringify(this.collection.at(0).getDataForSave()),JSON.stringify(this.collection.at(1).getDataForSave())],group:this.group},s=e(t.target),o=s.html(),n=this;TVE_Dash.showLoader(),this.btnLoading(s),e.ajax({url:this.urlSaveOptions,type:"post",dataType:"json",data:i,success:function(e){e.success?(_.each(ThriveLeads.objects.groups.models,(function(e){e.get("ID")!=n.group||e.set("has_display_settings",1)})),n.close()):TVE_Dash.err(e.message?e.message:ThriveLeads.const.translations.GeneralError)},error:function(e,t,i){TVE_Dash.err(ThriveLeads.const.translations.GeneralError+" ( Error info: <strong>"+i+"</strong> )")},complete:function(){s.html(o).attr("disabled",!1)}})},saveTemplate:function(t){var i=e("input[name='tve_leads_new_template_name']"),s=this;if(!i.val().trim().length){"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer);var o=e('<p class="tve-error" style="display: none"></p>');return o.html(ThriveLeads.const.translations.PleaseSelectANameForYourTemplate),i.addClass("tvd-invalid").before(o),o.show(),i.focus(),void(testErrortimer=setTimeout((function(){s.$el.find(".tve-error, .tve-block-error").slideUp(200,(function(){jQuery(this).remove()})),s.$el.find("input").removeClass("tvd-invalid")}),5e3))}var n={name:i.val().trim(),options:[JSON.stringify(this.collection.at(0).getDataForSave()),JSON.stringify(this.collection.at(1).getDataForSave())]},a=!1;ThriveLeads.objects.savedTemplates.name_exists(n.name,"TL")&&(a=!confirm('"'+n.name+'" template already exists. Do you want to overwrite it ?')),a||(TVE_Dash.showLoader(),e.ajax({type:"post",dataType:"json",data:n,url:this.urlSaveTemplate,success:function(t){t.success?(i.val(""),ThriveLeads.objects.savedTemplates=new ThriveLeads.models.TemplateList(t.templates),s.$templatesList.find("option").each((function(){e(this).text()===n.name&&e(this).attr("selected","selected")})),s.renderTemplatesList(),TVE_Dash.success(ThriveLeads.const.translations.DisplaySettingsTemplateSaved)):TVE_Dash.err(t.message?t.message:ThriveLeads.const.translations.GeneralError)},error:function(e,t,i){TVE_Dash.err(ThriveLeads.const.translations.GeneralError+" ( Error info: <strong>"+i+"</strong> )")},complete:function(){TVE_Dash.hideLoader()}}))}}),ThriveLeads.views.Breadcrumbs=Backbone.View.extend({initialize:function(){this.listenTo(this.collection,"add",this.render)},render:function(){return this.collection.at(this.collection.length-1).set({last:1}),this.$el.empty(),this.collection.each(this.renderOne,this),this},renderOne:function(e){var t=new ThriveLeads.views.Breadcrumb({model:e}).render().$el;this.$el.append(t)}}),ThriveLeads.views.Breadcrumb=Backbone.View.extend({tagName:"li",className:"tvd-breadcrumb",template:TVE_Dash.tpl("breadcrumbs/item"),events:{},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),ThriveLeads.views.TriggerSettings=TVE_Dash.views.Modal.extend({events:{"change #trigger-type":"triggerChange","click .tve-save-trigger":"triggerSave"},model:null,$trigger_type:null,afterRender:function(){this.model=ThriveLeads.objects.current_variation,this.$trigger_type=this.$el.find("#trigger-type")},triggerChange:function(e){this.$el.find(".trigger-settings").hide(0).filter("#trigger-settings-"+this.$trigger_type.val()).show(0)},onClose:function(){"shortcode"===this.model.get("tve_form_type")?ThriveLeads.router.navigate("#shortcode/"+this.data.form_type_id,{trigger:!0}):"two_step_lightbox"===this.model.get("tve_form_type")?ThriveLeads.router.navigate("#2step-lightbox/"+this.data.form_type_id,{trigger:!0}):ThriveLeads.router.navigate("#form-type/"+this.data.form_type_id,{trigger:!0})},triggerSave:function(t){this.model.set({trigger:this.$trigger_type.val(),trigger_config:this.collect_config()}),this.btnLoading(t.currentTarget),TVE_Dash.showLoader(),this.model.save({},{success:function(){e(".tvd-modal-close").click()}})},collect_config:function(){var e={};return this.$el.find("#trigger-settings-"+this.$trigger_type.val()).find(".trigger-config").each((function(){var t=jQuery(this);t.attr("disabled")||(e[t.attr("name")]=t.is("input[type=checkbox]")?t.is(":checked")?t.val():"":t.val())})),e}}),ThriveLeads.views.PositionSettings=TVE_Dash.views.Modal.extend({events:{"click .tve-save-position":"positionSave"},model:null,positionSave:function(e){this.model.set({position:this.$el.find("#variation-position-settings").val()}),this.btnLoading(e.currentTarget),TVE_Dash.showLoader(),this.close(),this.model.save({},{success:function(){}})},afterRender:function(){this.model=ThriveLeads.objects.position_settings_model},afterOpen:function(){this.$el.find("#variation-position-settings").val(this.model.get("position")).trigger("change")},onClose:function(){"shortcode"===this.model.get("tve_form_type")?ThriveLeads.router.navigate("#shortcode/"+this.data.form_type_id,{trigger:!0}):"two_step_lightbox"===this.model.get("tve_form_type")?ThriveLeads.router.navigate("#2step-lightbox/"+this.data.form_type_id,{trigger:!0}):ThriveLeads.router.navigate("#form-type/"+this.data.form_type_id,{trigger:!0})}}),ThriveLeads.views.MessagesList=Backbone.View.extend({className:"messagesList",render:function(){var e=this;return this.collection.each((function(t){e.$el.append(e.renderMessage(t))})),this},renderMessage:function(e){return TVE_Dash.tpl("messages/item",{message:e})}}),ThriveLeads.views.lightbox={EditVariationTest:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/edit-variation-test"),events:{"click .tve-edit-variation-test":"saveTest","blur #auto_win_min_conversions":"checkMinimumConversions","blur #auto_win_min_duration":"checkMinimumDuration","blur #auto_win_chance_original":"checkChanceToBeatOriginal","change #tve-enable-test-settings":"toggleAutoWinSettings"},checkMinimumConversions:function(e){var t=jQuery(e.currentTarget);parseInt(t.val())<100?this.$el.find(".tve_engagements_notice").removeClass("tvd-hide"):this.$el.find(".tve_engagements_notice").addClass("tvd-hide")},checkMinimumDuration:function(e){var t=jQuery(e.currentTarget);parseInt(t.val())<7?this.$el.find(".tve_duration_notice").removeClass("tvd-hide"):this.$el.find(".tve_duration_notice").addClass("tvd-hide")},checkChanceToBeatOriginal:function(e){var t=jQuery(e.currentTarget);parseFloat(t.val())<90?this.$el.find(".tve_beat_original_notice").removeClass("tvd-hide"):this.$el.find(".tve_beat_original_notice").addClass("tvd-hide")},saveTest:function(e){var t=this,i=jQuery(e.target);this.model.set("auto_win_enabled",this.$el.find("input[name='auto_win_enabled']").is(":checked")),this.model.set("auto_win_min_conversions",this.$el.find('input[name="auto_win_min_conversions"]').val()),this.model.set("auto_win_min_duration",this.$el.find('input[name="auto_win_min_duration"]').val()),this.model.set("auto_win_chance_original",this.$el.find('input[name="auto_win_chance_original"]').val()),this.model.on("invalid",(function(e,i){t.showErrors(e,i)})),this.model.isValid()&&(this.model.trigger("auto_win_changed"),i.html(ThriveLeads.const.translations.Loading).removeClass("tve-edit-variation-test"),this.btnLoading(i),TVE_Dash.showLoader(),this.model.save({},{success:function(){t.close(),TVE_Dash.hideLoader()}}))},showErrors:function(e,t){var i=this;"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),i.$el.find(".tve-error, .tve-block-error, .tve-error-message").remove(),_.each(t,(function(e,t){var s;"auto_win_min_conversions"===t&&((s=jQuery('<p class="tve-error" style="display: none"></p>')).html(e),i.$el.find('input[name="auto_win_min_conversions"]').addClass("tve-leads-input-error").before(s),s.show()),"auto_win_min_duration"===t&&((s=jQuery('<p class="tve-error" style="display: none"></p>')).html(e),i.$el.find('input[name="auto_win_min_duration"]').addClass("tve-leads-input-error").before(s),s.show()),"auto_win_chance_original"===t&&((s=jQuery('<p class="tve-error" style="display: none"></p>')).html(e),i.$el.find('input[name="auto_win_chance_original"]').addClass("tve-leads-input-error").before(s),s.show())})),testErrortimer=setTimeout((function(){i.$el.find(".tve-error, .tve-block-error").slideUp(200,(function(){jQuery(this).remove()})),i.$el.find("input").removeClass("tve-leads-input-error")}),5e3)},toggleAutoWinSettings:function(e){jQuery(e.currentTarget).is(":checked")?this.$el.find(".tve-winner-settings-input").show(0):this.$el.find(".tve-winner-settings-input").hide(0),setTimeout(ThriveLeads.resize_thickbox,0)}}),StopVariationTest:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/stop-variation-test"),events:{"click .tve-test-item-winner":"setWinner"},afterRender:function(){this.$el.addClass("tvd-stop-test-modal");var e=this.$el.find("#tve-stop-variation"),t=this.collection.getHighestRateItem();return e.empty(),this.collection.each((function(i){i.set("show_graph",!1);var s=new ThriveLeads.views.TestItem({model:i,highest_id:t});e.append(s.render().el)})),this},setWinner:function(e){e.preventDefault();var t=jQuery(e.target),i=this;"a"!==t.prop("tagName").toLowerCase()&&(t=t.closest("a"));var s=this.collection.get(parseInt(t.attr("data-test-item-id")));this.btnLoading(t),TVE_Dash.showLoader(),s.set("is_winner",!0),s.save({},{success:function(e,t){i.model.get("test_type")==ThriveLeads.const.group_test_type?(ThriveLeads.addMessage({text:ThriveLeads.const.translations.SetWinnerGroupMessage}),ThriveLeads.objects.groups=new ThriveLeads.collections.Groups(t),ThriveLeads.objects.groups.findWhere({ID:parseInt(e.get("main_group_id"))}).set("details_expanded",!0),ThriveLeads.router.navigate("#dashboard",{trigger:!0})):i.model.get("test_type")==ThriveLeads.const.shortcode_test_type?(ThriveLeads.addMessage({text:ThriveLeads.const.translations.SetWinnerShortcodeMessage}),ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(s.get("main_group_id"))}).set("active_test",null),ThriveLeads.router.navigate("#shortcode/"+s.get("main_group_id"),{trigger:!0})):i.model.get("test_type")==ThriveLeads.const.two_step_lightbox_test_type?(ThriveLeads.addMessage({text:ThriveLeads.const.translations.SetWinnerTwoStepLightboxMessage}),ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(s.get("main_group_id"))}).set("active_test",null),ThriveLeads.router.navigate("#2step-lightbox/"+s.get("main_group_id"),{trigger:!0})):(ThriveLeads.addMessage({text:ThriveLeads.const.translations.SetWinnerFormTypeMessage}),ThriveLeads.objects.groups.findWhere({ID:parseInt(s.get("main_group_id"))}).get("form_types").findWhere({ID:parseInt(s.get("form_type_id"))}).set("active_test",new ThriveLeads.models.Test),ThriveLeads.router.navigate("#form-type/"+s.get("form_type_id"),{trigger:!0}))},complete:function(e){i.close()}}),TVE_Dash.showLoader()}}),VariationTest:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/variation-test"),events:{"click .tve-toggle-dropdown":"toggleSettings","click #tve-enable-test-settings":"toggleProperties","click .tve-start-variation-test":"addTest","blur #auto_win_min_conversions":"checkMinimumConversions","blur #auto_win_min_duration":"checkMinimumDuration","blur #auto_win_chance_original":"checkChanceToBeatOriginal","click .tve-redirect-to-form-type":"toFormType"},checkMinimumConversions:function(e){var t=jQuery(e.currentTarget);parseInt(t.val())<100?this.$el.find(".tve_engagements_notice").removeClass("tvd-hide"):this.$el.find(".tve_engagements_notice").addClass("tvd-hide")},checkMinimumDuration:function(e){var t=jQuery(e.currentTarget);parseInt(t.val())<7?this.$el.find(".tve_duration_notice").removeClass("tvd-hide"):this.$el.find(".tve_duration_notice").addClass("tvd-hide")},checkChanceToBeatOriginal:function(e){var t=jQuery(e.currentTarget);parseFloat(t.val())<90?this.$el.find(".tve_beat_original_notice").removeClass("tvd-hide"):this.$el.find(".tve_beat_original_notice").addClass("tvd-hide")},afterRender:function(){this.$el.addClass("tvd-animation-modal")},renderFormTypes:function(){var e=this.$el.find("#tve-form-types-list"),t=e.find(".tvd-row");e.show();var i=TVE_Dash.tpl("form-type/checkbox");this.model.get("form_types").each((function(e){t.append(i({form:e,active_test:e.get("active_test").toJSON()}))}))},addTest:function(){var e=this,t=new ThriveLeads.models.Test({title:this.$el.find('input[name="test_title"]').val(),notes:this.$el.find('textarea[name="test_notes"]').val(),auto_win_enabled:this.$el.find("input[name='auto_win_enabled']").is(":checked"),auto_win_min_conversions:this.$el.find('input[name="auto_win_min_conversions"]').val(),auto_win_min_duration:this.$el.find('input[name="auto_win_min_duration"]').val(),auto_win_chance_original:this.$el.find('input[name="auto_win_chance_original"]').val(),main_group_id:e.model.get("ID")});if(this.$el.find('input[name="form-types[]"]').length){var i=[];this.$el.find('input[name="form-types[]"]:checked').each((function(){i.push(jQuery(this).val())})),t.set("form_types",i),t.setAsGroupType()}this.model instanceof ThriveLeads.models.Shortcode&&t.setAsShortcodeType(),this.model instanceof ThriveLeads.models.TwoStepLightbox&&t.setAsTwoStepLightboxType(),t.on("invalid",(function(t,i){e.onInvalid(t,i)})),t.isValid()&&(TVE_Dash.showLoader(),t.save({},{success:function(i,s){t.set("id",s.id),t.get("form_types")?(s.item_ids=s.form_types,e.model.get("active_tests").add(new ThriveLeads.models.Test(s))):e.model instanceof ThriveLeads.models.Shortcode?(ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(t.get("main_group_id"))}).set("active_test",t),ThriveLeads.objects.Shortcode.set("active_test",t),ThriveLeads.router.navigate("#test/"+t.get("id")+"/completed",{trigger:!0})):e.model instanceof ThriveLeads.models.TwoStepLightbox?(ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(t.get("main_group_id"))}).set("active_test",t),ThriveLeads.objects.TwoStepLightbox.set("active_test",t),ThriveLeads.router.navigate("#test/"+t.get("id")+"/completed",{trigger:!0})):(ThriveLeads.objects.groups.findWhere({ID:e.model.get("post_parent")}).get("form_types").findWhere({ID:e.model.get("ID")}).set("active_test",t),ThriveLeads.router.navigate("#test/"+t.get("id")+"/completed",{trigger:!0}))},complete:function(){e.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(e,t){var i=this;i.$el.find(".tve-error, .tve-block-error, .tve-error-message").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(t,(function(e,t){var s;"title"===t&&((s=jQuery('<p class="tve-error" style="display: none;"></p>')).html(e),i.$el.find('input[name="test_title"]').addClass("tve-leads-input-error").before(s),s.show()),"auto_win_min_conversions"===t&&((s=jQuery('<p class="tve-error" style="display: none"></p>')).html(e),i.$el.find('input[name="auto_win_min_conversions"]').addClass("tve-leads-input-error").before(s),s.show()),"auto_win_min_duration"===t&&((s=jQuery('<p class="tve-error" style="display: none"></p>')).html(e),i.$el.find('input[name="auto_win_min_duration"]').addClass("tve-leads-input-error").before(s),s.show()),"auto_win_chance_original"===t&&((s=jQuery('<p class="tve-error" style="display: none"></p>')).html(e),i.$el.find('input[name="auto_win_chance_original"]').addClass("tve-leads-input-error").before(s),s.show()),"form_types"===t&&TVE_Dash.err(e,ThriveLeads.const.toast_timeout)})),testErrortimer=setTimeout((function(){i.$el.find(".tve-error, .tve-block-error").slideUp(200,(function(){jQuery(this).remove()})),i.$el.find("input").removeClass("tve-leads-input-error")}),5e3)},toggleSettings:function(){var e=this.$el.find("#tve-winner-test-container");this.$el.find("#tve-winner-test-settings"),e.is(":visible")?e.hide(0):e.fadeIn("fast"),setTimeout(ThriveLeads.resize_thickbox,0)},toggleProperties:function(e){e.target.checked?this.$el.find(".tve-winner-settings-input").show(0):this.$el.find(".tve-winner-settings-input").hide(0),setTimeout(ThriveLeads.resize_thickbox,0)}}),AddGroup:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-group"),events:{"click .tve-add-lead-group":"addGroup"},addGroup:function(t){var i=e(t.currentTarget),s=new ThriveLeads.models.Group({post_title:this.$el.find(".post_title").val(),order:ThriveLeads.objects.groups.length}),o=this;s.on("invalid",(function(e,t){o.onInvalid(e,t)})),s.isValid()&&(this.btnLoading(i),TVE_Dash.showLoader(),s.save({},{success:function(e,t){e.set("ID",t)},complete:function(e,t){ThriveLeads.objects.groups.add(s),o.$el.find(".post_title").val(""),o.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(e,t){var i=this;i.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(t,(function(e,t){if("post_title"===t){var s=jQuery('<p class="tve-error" style="display: none;"></p>');s.html(e),i.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(s),s.show()}})),testErrortimer=setTimeout((function(){i.$el.find(".tve-error, .tve-block-error").slideUp(200,(function(){jQuery(this).remove()})),i.$el.find("input").removeClass("tve-leads-input-error")}),5e3)}}),AddShortcode:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-shortcode"),events:{"click .tve-add-lead-shortcode":"addShortcode"},addShortcode:function(t){var i=e(t.currentTarget),s=new ThriveLeads.models.Shortcode({post_title:this.$el.find(".post_title").val()}),o=this;s.on("invalid",(function(e,t){o.onInvalid(e,t)})),s.isValid()&&(this.btnLoading(i),TVE_Dash.showLoader(),s.save({},{success:function(e,t){e.set("ID",t)},complete:function(){ThriveLeads.objects.shortcodeCollection.add(s),o.$el.find(".post_title").val(""),o.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(e,t){var i=this;i.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(t,(function(e,t){if("post_title"===t){var s=jQuery('<p class="tve-error" style="display: none;"></p>');s.html(e),i.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(s),s.show()}})),testErrortimer=setTimeout((function(){i.$el.find(".tve-error, .tve-block-error").slideUp(200,(function(){jQuery(this).remove()})),i.$el.find("input").removeClass("tve-leads-input-error")}),5e3)}}),AddTwoStepLightbox:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-two-step-lightbox"),events:{"click .tve-add-lead-two-step-lightbox":"addTwoStepLightbox"},addTwoStepLightbox:function(t){var i=e(t.currentTarget),s=new ThriveLeads.models.TwoStepLightbox({post_title:this.$el.find(".post_title").val()}),o=this;s.on("invalid",(function(e,t){o.onInvalid(e,t)})),s.isValid()&&(this.btnLoading(i),TVE_Dash.showLoader(),s.save({},{success:function(e,t){e.set("ID",t)},complete:function(){ThriveLeads.objects.TwoStepLightboxCollection.add(s),o.$el.find(".post_title").val(""),o.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(e,t){var i=this;i.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(t,(function(e,t){if("post_title"===t){var s=jQuery('<p class="tve-error" style="display: none;"></p>');s.html(e),i.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(s),s.show()}})),testErrortimer=setTimeout((function(){i.$el.find(".tve-error, .tve-block-error").slideUp(200,(function(){jQuery(this).remove()})),i.$el.find("input").removeClass("tve-leads-input-error")}),5e3)}}),AddOneClickSignup:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/one-click-signup/add-one-click-signup"),events:{"click .tve-add-lead-one-click-signup":"addOneClickSignup"},addOneClickSignup:function(t){var i=e(t.currentTarget),s=new ThriveLeads.models.OneClickSignup({post_title:this.$el.find(".post_title").val()}),o=this;s.on("invalid",(function(e,t){o.onInvalid(e,t)})),s.isValid()&&(this.btnLoading(i),TVE_Dash.showLoader(),s.save({},{success:function(e,t){var i=JSON.parse(t);e.set("ID",i.ID),e.set("post_link",i.post_link),e.set("valid",i.valid)},complete:function(){ThriveLeads.objects.OneClickSignupCollection.add(s),o.$el.find(".post_title").val(""),o.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(e,t){var i=this;i.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(t,(function(e,t){if("post_title"===t){var s=jQuery('<p class="tve-error" style="display: none;"></p>');s.html(e),i.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(s),s.show()}})),testErrortimer=setTimeout((function(){i.$el.find(".tve-error, .tve-block-error").slideUp(200,(function(){jQuery(this).remove()})),i.$el.find("input").removeClass("tve-leads-input-error")}),5e3)}}),addNewFile:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-asset-file"),events:{"click .tve-add-asset-file":"addFile"},addFile:function(t){var i=e(t.currentTarget),s=new ThriveLeads.models.AssetFile({name:this.$el.find(".name").val(),link_anchor:this.$el.find(".link_anchor").val(),link:this.$el.find(".link").val(),parent_ID:this.model.get("ID"),ID:""}),o=this;s.on("invalid",(function(e,t){o.onInvalid(e,t)})),s.isValid()&&(this.btnLoading(i),TVE_Dash.showLoader(),s.save({},{success:function(e,t){e.set("ID",t)},complete:function(){o.model.get("files").add(s),o.$el.find(".name").val(""),o.$el.find(".link_anchor").val(""),o.$el.find(".link").val(""),o.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(e,t){var i=this;i.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(t,(function(e,t){var s;"name"===t&&((s=jQuery('<p class="tve-error" style="display: none;"></p>')).html(e),i.$el.find('input[name="asset_file_name"]').addClass("tve-leads-input-error").before(s),s.show()),"link_anchor"===t&&((s=jQuery('<p class="tve-error" style="display: none;"></p>')).html(e),i.$el.find('input[name="asset_file_link_anchor"]').addClass("tve-leads-input-error").before(s),s.show()),"link"===t&&((s=jQuery('<p class="tve-error" style="display: none;"></p>')).html(e),i.$el.find('input[name="asset_file_link"]').addClass("tve-leads-input-error").before(s),s.show())})),testErrortimer=setTimeout((function(){i.$el.find(".tve-error, .tve-block-error").slideUp(200,(function(){jQuery(this).remove()})),i.$el.find("input").removeClass("tve-leads-input-error")}),5e3)}}),addPrevFile:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-prev-asset-file"),events:{"click .tve-add-asset-file":"addFile"},addFile:function(t){var i=e(t.currentTarget),s=this.$el.find(".tve-asset-prev-select"),o=new ThriveLeads.models.AssetFile({name:this.$el.find(".tve-asset-prev-select option:selected").text(),link_anchor:s.val(),link:this.$el.find(".tve-asset-prev-select option:selected").attr("data-link"),parent_ID:this.model.get("ID"),ID:""}),n=this;if(!o.get("link_anchor"))return s.trigger("tvderror"),!1;this.btnLoading(i),TVE_Dash.showLoader(),o.save({},{success:function(e,t){e.set("ID",t)},complete:function(){n.model.get("files").add(o),n.close(),TVE_Dash.hideLoader()}})}}),StopVariation:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-variation"),events:{"click .tve-stop-test-variation-modal-action":"stopVariation"},afterInitialize:function(e){this.$el.addClass("tvd-red")},stopVariation:function(t){var i=e(t.currentTarget),s=this;this.btnLoading(i),TVE_Dash.showLoader(),e.ajax({url:ajaxurl,dataType:"json",method:"POST",data:{action:"tve_leads_stop_variation",variation_id:s.model.get("id"),test_id:s.model.get("test_id"),security:ThriveLeadsConst.security},success:function(e){"ok"==e.status&&(ThriveLeads.router.viewTest(s.model.get("test_id"),!0),setTimeout((function(){TVE_Dash.success(ThriveLeads.const.translations.successfulStopVariation)}),600))},error:function(){TVE_Dash.err(ThriveLeads.const.translations.failStopVariation)},complete:function(){TVE_Dash.hideLoader(),s.close()}})}}),showShortcodes:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/shortcode-list"),events:{"click .tve-copy-to-clipboard":"bindZclip"},afterOpen:function(){ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))}}),ConfirmDeleteGroup:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-group"),events:{"click .tve-confirm-delete-lead-group":"deleteGroup"},afterInitialize:function(e){this.$el.addClass("tvd-red")},deleteGroup:function(t){var i=e(t.currentTarget),s=this;this.btnLoading(i),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){s.close(),TVE_Dash.hideLoader()}})}}),AddFormType:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("form-type/add-modal"),events:{"click .tve-select-form-type.tve_available":"addForm"},addForm:function(e){var t=this,i=e.currentTarget.getAttribute("data-form"),s=e.currentTarget.getAttribute("data-title"),o=this.model.findWhere({tve_form_type:i});o||(o=new ThriveLeads.models.FormType({tve_form_type:i,post_parent:this.post_parent,post_title:s}),this.model.add(o)),TVE_Dash.showLoader(),o.save({},{success:function(e,i){e.set("ID",i),e.set("display_on_mobile",0),e.set("display_status",0),jQuery(document).trigger("tl.form_type.added",{ID:i,post_parent:t.post_parent}).trigger("tl.form_type.update_display",{post_parent:t.post_parent}),t.model.add(e),TVE_Dash.hideLoader(),t.close()},complete:function(e){}})}}),ConfirmDeleteFormType:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("form-type/delete-modal"),events:{"click .tve-confirm-delete-form-type":"deleteFormType"},afterInitialize:function(e){this.$el.addClass("tvd-red")},deleteFormType:function(t){var i=this;e(document).trigger("tl.form_type.update_display",{post_parent:this.model.get("post_parent")}),TVE_Dash.showLoader(),this.model.destroy({complete:function(){i.close(),TVE_Dash.hideLoader(),i.model.set("ID","")}})}}),ConfirmDeleteShortcode:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-shortcode"),events:{"click .tve-confirm-delete-lead-group":"deleteGroup"},afterInitialize:function(e){this.$el.addClass("tvd-red")},deleteGroup:function(t){var i=e(t.currentTarget),s=this;this.btnLoading(i),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){s.close(),TVE_Dash.hideLoader()}})}}),confirmDeleteTest:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-test"),events:{"click .tve-confirm-delete-test":"deleteGroup"},afterInitialize:function(e){this.$el.addClass("tvd-red")},deleteGroup:function(t){var i=e(t.currentTarget),s=this.model,o=this;this.btnLoading(i),TVE_Dash.showLoader(),this.model.destroy({data:s,success:function(){},error:function(){},complete:function(){o.close(),TVE_Dash.hideLoader()}})}}),ConfirmDeleteTwoStepLightbox:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-two-step-lightbox"),events:{"click .tve-confirm-delete-lead-group":"deleteGroup"},afterInitialize:function(e){this.$el.addClass("tvd-red")},deleteGroup:function(t){var i=e(t.currentTarget),s=this;this.btnLoading(i),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){s.close(),TVE_Dash.hideLoader()}})}}),ConfirmDeleteOneClickSignup:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/one-click-signup/delete-one-click-signup"),events:{"click .tve-confirm-delete-lead-group":"deleteGroup"},afterInitialize:function(e){this.$el.addClass("tvd-red")},deleteGroup:function(t){var i=e(t.currentTarget),s=this;this.btnLoading(i),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){s.close(),TVE_Dash.hideLoader()}})}}),OneClickSignupRedirectSettings:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/one-click-signup/redirect-settings"),events:{"click .tl-save-redirect-url":"saveRedirectUrl","click .tl-specify-redirects":"saveRedirectUrl","click .tl-segue-back-button":"displayScheduleFields","change .tl-post-type-select":"displayPostTypeFields","click .tl-remove-redirect-url":"removeRedirectUrl","click input.tl-custom-url-radio":"changeCustomUrlOption","keyup input.tl-find-content-custom-url":"updateRedirectUrl","keyup .tl-event-time":"validateTime"},onOpen:function(){var t=this.model,i=this.$el;if(i.addClass("tvd-modal-redirect-settings"),t.has("redirect_url")){var s=t.get("redirect_url");e(".tl-post-type-select option[value='"+s.type+"']").prop("selected",!0),e(".tl-post-type-select").trigger("change"),["single","after","during","before"].forEach((function(t){var i=e("#"+s[t+"_url_type"]+"-"+t);i.prop("checked",!0),i.trigger("click")}))}i.find(".tl-event-start-time").timepicker({timeFormat:"HH:mm",interval:60,change:function(){e(this).blur()}}),i.find(".tl-event-duration-time").timepicker({timeFormat:"HH:mm",interval:60,change:function(){e(this).blur()}}),i.find(".tl-event-start-date").pickadate({format:"yyyy-mm-dd",onOpen:function(){jQuery('label[for="tl-event-start-date"]').addClass("tvd-active")}}),jQuery(document).on("click",".tl-redirect-start-date",(function(){jQuery(".tl-event-start-date").trigger("click")})),i.find(".tl-find-content-input").val("").each((function(){var i=jQuery(this);i.autocomplete({appendTo:i.parent(),minLength:2,delay:200,source:function(e,t){jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"tve_leads_find_post_and_page_action",q:e.term,security:ThriveLeadsConst.security}}).done((function(e){t(e)}))},select:function(i,s){var o=e(this).attr("data-type");e(".tl-"+o+" .tl-redirect-url-container").show(),e(".tl-"+o+" .tl-redirect-url").html(s.item.label).attr("href",s.item.url),e(".tl-"+o+" .tl-remove-redirect-url").show().attr("disabled",!1);var n=t.get("redirect_url");return n[o]=s.item.url,n[o+"_label"]=s.item.label,t.set("redirect_url",n),!1}})}))},displayRedirectFields:function(){this.$el.find(".tl-segue-settings-step1").hide(),this.$el.find(".tl-segue-settings-step2").show(),this.$el.find(".tl-segue-settings-controlls1").hide(),this.$el.find(".tl-segue-settings-controlls2").show(),this.$el.find(".tl-segue-back-button").show()},displayScheduleFields:function(){this.$el.find(".tl-segue-settings-step1").show(),this.$el.find(".tl-segue-settings-step2").hide(),this.$el.find(".tl-segue-settings-controlls1").show(),this.$el.find(".tl-segue-settings-controlls2").hide(),this.$el.find(".tl-segue-back-button").hide()},displayPostTypeFields:function(e){var t=jQuery(e.currentTarget);t.trigger("tvdclear");var i=t.find("option:selected").val();this.$el.find(".tl-segue-settings-controlls1").hide(),this.$el.find(".tl-segue-settings-controlls2").hide(),this.$el.find(".tl-segue-back-button").hide(),"single-redirect"==i?(this.$el.find(".tl-segue-settings-controlls2").show(),this.$el.find(".tl-single-redirect-box").show(),this.$el.find(".tl-conditional-redirect-box").hide()):"conditional-redirect"==i?(this.$el.find(".tl-single-redirect-box").hide(),this.$el.find(".tl-conditional-redirect-box").show(),this.$el.find(".tl-segue-settings-controlls1").show()):(this.$el.find(".tl-segue-settings-controlls2").show(),this.$el.find(".tl-single-redirect-box").hide(),this.$el.find(".tl-conditional-redirect-box").hide()),ThriveLeads.resize_thickbox(),this.$el.find(".messagesList").remove()},validateForm:function(t){e(t+" input").removeClass("tl-required-input");var i=!0,s=this.model.get("redirect_url");if(".tl-single-redirect-box"==t)s.single&&""!=s.single||(i=!1,e(t+" input").addClass("tl-required-input"));else if(".tl-segue-settings-step1"==t)e(t+" .tl-time-section input").each((function(){""==e(this).val()&&(i=!1,e(this).addClass("tl-required-input"))}));else for(var o=["before","during","after"],n=0;n<o.length;n++)s[o[n]]&&""!=s[o[n]]||(i=!1,e(t+" .tl-"+o[n]+" input").addClass("tl-required-input"));return i},saveRedirectUrl:function(t){var i,s=this.model,o=this,n=this.$el.find("#tl-post-type-select"),a=n.val();if(!a)return n.trigger("tvderror"),!1;var r=s.get("redirect_url");"single-redirect"==a?i=this.validateForm(".tl-single-redirect-box"):e(t.target).hasClass("tl-specify-redirects")?(i=this.validateForm(".tl-segue-settings-step1"),r.event_start_date=e(".tl-event-start-date").val(),r.event_start_time=e("input[name='event_start_time']").val(),r.event_duration_time=e("input[name='event_duration_time']").val()):i=this.validateForm(".tl-segue-settings-step2"),i?(r.type=a,s.set("redirect_url",r),s.unset("changed_redirect_url"),s.set("changed_redirect_url",1),this.btnLoading(t.currentTarget),TVE_Dash.showLoader(),s.save({},{success:function(){e(t.target).hasClass("tl-specify-redirects")?o.displayRedirectFields():o.close(),e(t.target).removeClass("tvd-disabled").removeAttr("disabled"),TVE_Dash.hideLoader()}})):TVE_Dash.err(ThriveLeads.const.translations.MissingRequiredParams)},removeRedirectUrl:function(t){var i=this.model,s=jQuery(t.currentTarget).attr("data-type"),o=i.get("redirect_url");o[s]="",o[s+"_label"]="",i.set("redirect_url",o),this.btnLoading(t.currentTarget),TVE_Dash.showLoader(),this.model.save({},{success:function(){TVE_Dash.hideLoader()}}),e(".tl-"+s+" .tl-redirect-url-container").hide(),e(".tl-"+s+" .tl-find-content-input").val(""),e(".tl-"+s+" .tl-find-content-custom-url").val("")},changeCustomUrlOption:function(t){var i=jQuery(t.currentTarget),s=i.closest(".find-content-box"),o=0==e("input.tl-custom-url-radio:checked",s).val(),n=i.attr("name"),a=this.model,r=a.get("redirect_url");r[n+"_url_type"]=o?"tl-targetAllGroups":"tl-targetCertainGroups",a.set("redirect_url",r),jQuery(s).find(".tl-find-content-input-container").toggle(o),jQuery(s).find(".tl-find-content-custom-url-container").toggle(!o)},updateRedirectUrl:function(t){var i=this.model,s=jQuery(t.currentTarget),o=s.attr("data-type"),n=s.val(),a=i.get("redirect_url");return a[o]=n,a[o+"_label"]=n,i.set("redirect_url",a),e(".tl-"+o+" .tl-redirect-url-container").show(),e(".tl-"+o+" .tl-redirect-url").html(n).attr("href",n),e(".tl-"+o+" .tl-remove-redirect-url").show().attr("disabled",!1),!1},validateTime:function(t){var i=jQuery(t.currentTarget),s=i.val(),o=s.replace(":","");if(s<0||!e.isNumeric(o)){var n=s.substring(0,s.length-1);i.val(n)}}}),OneClickSignupApiConnections:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/one-click-signup/connection-settings"),events:{"click .tl-save-connection":"saveApiConnection","change .tl-api-connection-options":"selectApiConnection","change .tl-api-change-list":"changeGroups","click .tl-remove-api-connection":"removeApiConnection","click .tl-add-connection":"addApiConnection","click .tl-reload-api-connections-list":"reloadApiConnectionList","click .tl-add-new-api-button":"displayAddEditApiBox","click .tl-close-api-add-edit":"displayExistingApiBox","click .tl-edit-api-connection":"editApiConnection"},api_connections:{},onOpen:function(){this.$el.css("min-height","400px"),this.api_connections=ThriveLeadsConst.api_connections,this.updateApiConnectionsDropdown()},changeGroups:function(){TVE_Dash.showLoader(),this.renderExtraFields()},updateApiConnectionsDropdown:function(t){var i=this.$el.find(".tl-api-connection-options"),s=_.map(this.model.get("api_connections"),(function(e){return e.apiName}));if(i.data("select2")&&i.data("select2").destroy(),_.isEmpty(this.api_connections))e(".tl-no-api-connection-box").show(),e(".tl-select-api-connection-box").hide();else{for(var o in e(".tl-no-api-connection-box").hide(),e(".tl-select-api-connection-box").show(),i.find("option:not(:first)").remove(),this.api_connections)if(-1===_.indexOf(s,o)||t==o){var n=t==o?' selected="selected"':"";i.append("<option "+n+'value="'+o+'">'+o+"</option>")}i.select2()}e(".tl-api-connection-extra").html(""),e(".tl-api-connection-list-box").hide()},reloadApiConnectionList:function(t,i){var s=this;if(i||(i=e(".tl-api-connection-options option:selected").val()),i){TVE_Dash.showLoader();var o=this.$el.find(".tl-api-connection-list");jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"tve_leads_get_api_connection_list",api:i,force_fetch:t&&t.currentTarget?"1":"",security:ThriveLeadsConst.security}}).done((function(n){if(o.data("select2")&&o.data("select2").destroy(),o.find("option").remove(),n&&0!==n.length){if(jQuery.each(n,(function(e,t){o.append("<option value='"+t.id+"'>"+t.name+"</option>")})),"edit"===t){var a=s.getConnectionValue(i,"list");e(".tl-api-connection-list option[value='"+a+"']").attr("selected","selected")}}else o.append("<option value=''>"+ThriveLeads.const.translations.NoListAvailable+"</option>");o.select2(),s.renderExtraFields(t),e(".tl-api-connection-list-box").show()}))}else e(".tl-api-connection-list-box").hide(),ThriveLeads.resize_thickbox()},renderExtraFields:function(t){TVE_Dash.showLoader(),this.$el;var i=e(".tl-api-connection-options option:selected").val();if(""!=i){var s=this.$el.find(".tl-api-connection-extra"),o={},n=this.model.get("api_connections");jQuery.each(n,(function(e,t){t.apiName==i&&jQuery.each(t,(function(e,t){"apiName"==e||"list"==e||(o[e]=t)}))})),"mailchimp"==i&&(o.list_id=e(".tl-api-connection-list option:selected").val()),jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"tve_leads_get_api_extra_fields",api:i,extra:o,security:ThriveLeadsConst.security}}).done((function(e){s.html(e.html),TVE_Dash.materialize(s),TVE_Dash.hideLoader(),ThriveLeads.resize_thickbox()}))}},getConnectionValue:function(e,t){var i=this.model,s="",o=i.get("api_connections");return jQuery.each(o,(function(i,o){if(o.apiName==e)return s=o[t],!1})),s},selectApiConnection:function(){this.reloadApiConnectionList()},editApiConnection:function(e){var t=jQuery(e.currentTarget).attr("rel");this.displayAddEditApiBox({type:"edit",selApiName:t})},addApiConnection:function(){var t=this.model,i=this.$el,s=e.map(t.get("api_connections"),(function(e){return e})),o=e(".tl-api-connection-options option:selected").val(),n=e(".tl-api-connection-list option:selected").val();if(""==o||""==n)return TVE_Dash.err(ThriveLeads.const.translations.SelectConnectionMsg),!1;this.displayExistingApiBox(),TVE_Dash.showLoader();var a=!1;jQuery.each(s,(function(e,t){if(t.apiName==o)return s.splice(e,1),a=!0,!1}));var r={apiName:o,list:n};i.find(".tve-api-extra").filter(":not(.tve_disabled)").each((function(){var t=e(this);t.attr("name").split("_")[1],t.is("input:radio, input:checkbox")?t.is(":radio")&&t.is(":checked")?r[t.attr("name")]=t.val():t.is(":checkbox")&&t.is(":checked")&&(r[t.attr("name")]?r[t.attr("name")]+=","+t.val():r[t.attr("name")]=t.val()):(r=r||{})[t.attr("name")]=t.val()})),s.push(r),a||(e(".tl-added-connections").append(this.renderAddSelectedApi(o)),e(".tl-connection-list").show(),e(".tl-empty-connection-list").hide()),t.set("api_connections",s),TVE_Dash.hideLoader()},renderAddSelectedApi:function(e){return TVE_Dash.tpl("lightbox/one-click-signup/selected-api-connection",{apiName:e})},saveApiConnection:function(e){var t=this.model,i=this;this.btnLoading(e.currentTarget),t.unset("changed_connection"),t.set("changed_connection",1),TVE_Dash.showLoader(),t.save({},{success:function(){i.close(),TVE_Dash.hideLoader()}})},removeApiConnection:function(t){var i=this.model,s=jQuery(t.currentTarget).attr("rel"),o=i.get("api_connections");jQuery.each(o,(function(e,t){if(t.apiName==s)return o.splice(e,1),!1})),i.set("api_connections",o),e("."+s+"_row").remove(),0===o.length&&(e(".tl-connection-list").hide(),e(".tl-empty-connection-list").show()),this.btnLoading(t.currentTarget),TVE_Dash.showLoader(),i.save({},{success:function(){TVE_Dash.hideLoader()}})},displayAddEditApiBox:function(t){var i=t.type,s=t.selApiName;this.updateApiConnectionsDropdown(s),e(".tl-add-connection-box").show(),e(".tl-existing-api-connection-box").hide(),e(".tl-api-connection-extra").html(""),i&&"edit"==i?this.reloadApiConnectionList(i,s):(e(".tl-api-connection-options option:first").attr("selected","selected"),e(".tl-api-connection-list-box").hide())},displayExistingApiBox:function(){e(".tl-existing-api-connection-box").show(),e(".tl-add-connection-box").hide(),ThriveLeads.resize_thickbox()}}),ConfirmDeleteAssetGroup:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-asset-group"),events:{"click .tve-confirm-delete-asset-group":"deleteAssetGroup"},afterRender:function(){this.$el.addClass("tvd-red")},deleteAssetGroup:function(t){var i=e(t.currentTarget),s=this;this.btnLoading(i),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){0==s.collection.length&&e(".tve-asset-group-links-status-green ").addClass("tve-asset-group-links-status-red").removeClass("tve-asset-group-links-status-green").attr("data-tooltip",ThriveLeads.const.translations.NotActive),s.close(),TVE_Dash.hideLoader()}})}}),ConfirmDeleteAssetFile:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-asset-file"),events:{"click .tve-confirm-delete-asset-file":"deleteAssetFile"},afterRender:function(){this.$el.addClass("tvd-red")},deleteAssetFile:function(t){var i=e(t.currentTarget),s=this;this.btnLoading(i),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){s.close(),TVE_Dash.hideLoader()}})}}),testAPIConnection:TVE_Dash.views.ModalSteps.extend({template:TVE_Dash.tpl("lightbox/test-api-connection"),events:{"click .tvd-modal-next-step":"next","click .tvd-modal-prev-step":"prev","click .tve-asset-delivery-conection":"openConnection","click .tve-leads-connection-edit":"openConnection","click .tvd-api-connect":"submitConnection","click .tvd-api-cancel":"closeConnection","click .tve-leads-asset-close":function(){this.close()}},onOpen:function(){ThriveLeads.objects.Apis.each(this.populateFields,this)},populateFields:function(e){var t=e.get("connection"),i=e.get("connection_instance"),s=this.$el.find(".tve-leads-connection-form[data-key="+t+"] form");i&&_.each(i,(function(e,t){var i=s.find(':input[name="connection['+t+']"]');(i.is("input")||i.is("textarea")||i.is("select"))&&i.val(e)}))},afterRender:function(){return new ThriveLeads.views.AssetConnections({collection:ThriveLeads.objects.AssetConnection,el:this.$el}).render(),this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this},openConnection:function(t){t.stopPropagation();var i=e(t.target),s=i.attr("data-key"),o=this.$el.find(".tve-leads-connection-form[data-key="+s+"]");this.$el.find(".tve-leads-connection-form").hide(),o.show(),i.hasClass("tve-asset-delivery-conection")||o.find(".tvd-api-cancel").addClass("tve-leads-gotostep-zero"),this.gotoStep(2)},closeConnection:function(t){if(e(t.target).hasClass("tve-leads-gotostep-zero"))return e(t.target).removeClass("tve-leads-gotostep-zero"),void this.gotoStep(0);this.gotoStep(1)},submitConnection:function(t){var i=this,s=(this.model,e(t.target).closest(".tve-leads-connection-form").find("form").serializeArray());TVE_Dash.showLoader(),jQuery.ajax({url:ThriveLeads.ajaxurl("action=thrive_leads_backend_ajax&route=addAssetAPI&security="+ThriveLeadsConst.security),type:"post",data:s}).done((function(t){TVE_Dash.hideLoader(),"true"==t?(jQuery.ajax({url:ThriveLeads.ajaxurl("action=thrive_leads_backend_ajax&route=getDefaultConnection&security="+ThriveLeadsConst.security),type:"post"}).done((function(t){if(JSON.parse(t),!ThriveLeads.objects.AssetsWizard.get("wizard_complete")){e(".tve-asset-service").removeClass("tvd-gray-accent").addClass("tvd-green-accent"),e(".tve-asset-service .tve-asset-service-status").text(" Ready!"),e(".tve-asset-group-connection-status").addClass("tve-asset-group-connection-status-green").removeClass("tve-asset-group-connection-status").attr("data-tooltip",ThriveLeads.const.translations.DeliveryStatus),e(".tve-asset-group-status-wrapper").hasClass("tve-asset-group-connection-status-red")&&e(".tve-asset-group-connection-status-red").addClass("tve-asset-group-connection-status-green tve-asset-group-existing-connection-event").removeClass("tve-asset-group-connection-status-red tve-asset-group-connection-event").attr("data-tooltip",ThriveLeads.const.translations.DeliveryStatus),ThriveLeads.objects.AssetsWizard.get("proprieties").connections=1;var o=ThriveLeads.objects.AssetsWizard.get("proprieties");1==o.connections&&1==o.files&&1==o.template&&(e(".tve-leads-asset-get-details").hide(),e(".tve-leads-asset-go-dashboard").show(),ThriveLeads.objects.AssetsWizard.set({wizard_complete:!0}),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"setWizardComplete",security:ThriveLeadsConst.security}}))}var n=new ThriveLeads.models.AssetWizardConnection,a=i.mapProprieties(s);n.set(a);var r=ThriveLeads.objects.Apis.findWhere({connection:a.connection});i.$el.find(".tve-leads-connection-name-success").text(a.connection),r.get("connected")||(r.set({connected:!0}),ThriveLeads.objects.AssetConnection.add(n)),r.set({connection_instance:a.connection_instance})})),i.gotoStep(3)):(e(".tve-leads-delivery-connection").find(".error").remove(),TVE_Dash.err(JSON.parse(t),ThriveLeads.const.toast_timeout),ThriveLeads.resize_thickbox())}))},mapProprieties:function(e){var t={connection:{},connection_instance:{}};return e.map((function(e){if("api"==e.name)t.connection=e.value;else{var i=e.name.match(/\[(.*?)\]/)[1];t.connection_instance[i]=e.value}})),t}}),emailTemplate:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-email-template"),events:{"click .tve-leads-submit-template":"submitTemplate","click .tl-toggle-tab-display":"toggleTabDisplay"},toggleTabDisplay:function(e){var t=jQuery(e.currentTarget),i=t.hasClass("collapsed"),s=jQuery(t.data("target"));i?s.hide(0).removeClass("tvd-not-visible").slideDown(200):s.slideUp(200,(function(){s.addClass("tvd-not-visible")})),t.toggleClass("collapsed"),t.toggleClass("hover")},afterRender:function(){this.$el.addClass("tve-assed-email-modal"),ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard")),this.$el.tve_toggle_visibility()},submitTemplate:function(){var t=this.$el.find("#wp-editor_ifr").contents().find("body").html(),i=this.$el.find(".tve-leads-asset-subject-input").val(),s={template_body:t,template_subject:i},o=this;this.model.set("email_data",s),TVE_Dash.showLoader(),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"setEmailTemplate",post_content:t,post_subject:i,security:ThriveLeadsConst.security}}).success((function(t){e(".tve-asset-template").removeClass("tvd-gray-accent").addClass("tvd-green-accent"),e(".tve-asset-template  .tve-asset-service-status").text(" Ready!"),e(".tve-asset-group-template-status").addClass("tve-asset-group-template-status-green").removeClass("tve-asset-group-template-status").attr("data-tooltip","Default template status: OK. Click to edit the default template."),e(".tve-asset-group-template-status-red").addClass("tve-asset-group-template-status-green").removeClass("tve-asset-group-template-status-red").attr("data-tooltip","Default template status: OK. Click to edit the default template."),ThriveLeads.objects.AssetsWizard.get("proprieties").template=1;var i=ThriveLeads.objects.AssetsWizard.get("proprieties");1==i.connections&&1==i.files&&1==i.template&&(e(".tve-leads-asset-get-details").hide(),e(".tve-leads-asset-go-dashboard").show(),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"setWizardComplete",security:ThriveLeadsConst.security}})),o.close(),TVE_Dash.hideLoader()}))}}),emailChange:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/change-email-template"),events:{"click .tve-leads-submit-template":"submitTemplate","click .tl-toggle-tab-display":"toggleTabDisplay"},afterOpen:function(){this.$el.addClass("tve-assed-email-modal"),ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))},toggleTabDisplay:function(e){var t=jQuery(e.currentTarget),i=t.hasClass("collapsed"),s=jQuery(t.data("target"));i?s.hide(0).removeClass("tvd-not-visible").slideDown(200):s.slideUp(200,(function(){s.addClass("tvd-not-visible")})),t.toggleClass("collapsed"),t.toggleClass("hover")},submitTemplate:function(){var e="#my-id-"+this.model.get("ID")+"_ifr",t=this.$el.find(e).contents().find("body").html(),i=this.$el.find(".tve-leads-asset-subject-input").val(),s=this;this.model.set("post_content",t),this.model.set("post_subject",i),TVE_Dash.showLoader(),this.model.save({},{success:function(e,t){},complete:function(){TVE_Dash.hideLoader(),s.close()}})}}),emailPreview:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/preview-email-template"),events:{"click .tve-leads-close-preview":function(){self.close()}}}),addWizardFiles:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-wizard-files"),events:{"click .tve-add-asset-group":"addGroup","click .tve-asset-save-group":"saveDetails","click .tve-leads-asset-media":"addMedia","click .tve-asset-files-back":"renderFiles"},addGroup:function(t){ThriveLeads.resize_thickbox(),e(t.currentTarget);var i=new ThriveLeads.models.Assets({post_title:this.$el.find(".post_title").val(),order:ThriveLeads.objects.AssetsCollection.length}),s=this;i.on("invalid",(function(e,t){s.onInvalid(e,t)})),i.isValid()&&(ThriveLeads.objects.WizardAddedGroup=i,s.$el.find(".post_title").val(""),TVE_Dash.hideLoader(),s.renderFiles())},onInvalid:function(e,t){var i=this;i.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(t,(function(e,t){if("post_title"===t){var s=jQuery('<p class="tve-error" style="display: none;"></p>');s.html(e),i.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(s),s.show()}})),testErrortimer=setTimeout((function(){i.$el.find(".tve-error, .tve-block-error").slideUp(200,(function(){jQuery(this).remove()})),i.$el.find("input").removeClass("tve-leads-input-error")}),5e3)},renderFiles:function(){var e=ThriveLeads.objects.WizardAddedGroup.get("files");0==e.length?this.$el.find(".asset-file-list-no-files").show():this.$el.find(".asset-file-list-no-files").hide(),this.$el.find(".asset-file-list-item").remove(),e.each(this.renderFile,this),this.$el.find(".tve-leads-files-step1").hide(),this.$el.find(".tve-leads-asset-files-add").hide(),this.$el.find(".tve-leads-asset-files-manager").show(),ThriveLeads.resize_thickbox()},renderFile:function(e){e.set("parent_ID",ThriveLeads.objects.WizardAddedGroup.get("ID"));var t=new ThriveLeads.views.AssetFileWizard({model:e});this.$el.find("#tve-asset-group-files").append(t.render().$el)},addMedia:function(){var e,t=ThriveLeads.objects.WizardAddedGroup.get("files"),i=t.at(t.length-1);if(i)var s=i.get("ID")+1;else s=0;var o=this;if(e)return e.open(),!1;(e=wp.media.frames.file_frame=wp.media({title:"Upload Asset Group Files (.zip, .pdf, .jpg, .png)",button:{text:"Use file"},frame:"post",state:"insert",multiple:!1})).on("insert",(function(){var t=e.state().get("selection").first().toJSON(),i=new ThriveLeads.models.AssetFile({name:t.name,link_anchor:t.name,link:t.url,parent_ID:"",ID:s});ThriveLeads.objects.WizardAddedGroup.get("files").add(i),o.renderFiles()})),e.state("embed").on("select",(function(){var t=e.state(),i=(t.get("type"),t.props.toJSON()),n=new ThriveLeads.models.AssetFile({name:i.linkText,link_anchor:i.linkText,link:i.url,parent_ID:"",ID:s});ThriveLeads.objects.WizardAddedGroup.get("files").add(n),o.renderFiles()})),e.open()},saveDetails:function(t){if(0!=ThriveLeads.objects.WizardAddedGroup.get("files").length){var i=e(t.currentTarget),s=new ThriveLeads.models.AssetWizard({post_title:ThriveLeads.objects.WizardAddedGroup.get("post_title"),files:ThriveLeads.objects.WizardAddedGroup.get("files"),order:ThriveLeads.objects.AssetsCollection.length}),o=this;this.btnLoading(i),TVE_Dash.showLoader(),s.save({},{success:function(e,t){e.set("ID",t)},complete:function(){ThriveLeads.objects.AssetsWizard.get("proprieties").files=1,e(".tve-asset-download-link").removeClass("tvd-gray-accent").addClass("tvd-green-accent"),e(".tve-asset-download-link").addClass("tve-asset-service-status-ready"),e(".tve-asset-download-link .tve-asset-service-status").text(" Ready!"),e(".tve-asset-group-links-status").addClass("tve-asset-group-links-status-green").removeClass("tve-asset-group-links-status").attr("data-tooltip","Downloadable asset status: OK."),e(".tve-asset-group-links-status-red").addClass("tve-asset-group-links-status-green").removeClass("tve-asset-group-links-status-red").attr("data-tooltip","Downloadable asset status: OK.");var t=ThriveLeads.objects.AssetsWizard.get("proprieties");ThriveLeads.objects.AssetsCollection.add(s),1==t.connections&&1==t.files&&1==t.template&&(e(".tve-leads-asset-get-details").hide(),e(".tve-leads-asset-go-dashboard").show(),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"setWizardComplete",security:ThriveLeadsConst.security}})),TVE_Dash.hideLoader(),o.close()}})}else TVE_Dash.err(ThriveLeads.const.translations.MissingAssetFiles)}}),AddForm:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-form-variation"),events:{"click .tve-add-form":"addForm"},triggerError:function(e,t){var i=jQuery('<p class="tve-error" style="display: none;">'.concat(t,"</p>"));e.addClass("tve-leads-input-error").before(i),i.show(),setTimeout((function(){i.slideUp(200,(function(){i.remove()})),e.removeClass("tve-leads-input-error")}),5e3)},addForm:function(t){var i=this.$el.find(".post_title"),s=i.val();if(s){var o,n=e(t.currentTarget),a=this;if(o=this.model.get("post_type")===ThriveLeads.const.tve_leads_post_shortcode_type||this.model.get("form_variation")instanceof ThriveLeads.models.ShortcodeVariation?new ThriveLeads.models.ShortcodeVariation:this.model.get("post_type")===ThriveLeads.const.tve_leads_post_two_step_lightbox_type||this.model.get("form_variation")instanceof ThriveLeads.models.TwoStepLightboxVariation?new ThriveLeads.models.TwoStepLightboxVariation:new ThriveLeads.models.FormVariation,"re-add"==this.model.get("state")){var r=this.model.get("form_variation").toJSON();o.set(r),o.set("key",""),o.set("post_status","publish"),o.set("readd_from",r.key)}else o.set("post_parent",this.model.get("form_type_id"));o.set("post_title",s),this.btnLoading(n),TVE_Dash.showLoader();var l=o.save({});ThriveLeads.addFailCallback(l,this),l.done((function(e){o.set(e)})).always((function(){if(!l.failed){if(a.model.get("post_type")===ThriveLeads.const.tve_leads_post_shortcode_type||a.model.get("form_variation")instanceof ThriveLeads.models.ShortcodeVariation){a.model.get("content_locking")&&o.set("content_lock_display","hide"),o.set("is_control",!ThriveLeads.objects.Shortcode.get("variations").length),ThriveLeads.objects.Shortcode.get("variations").add(o),ThriveLeads.objects.Shortcode.trigger("change");try{ThriveLeads.objects.shortcodeCollection.findWhere({ID:a.model.get("form_type_id")}).get("variations").add(o)}catch(e){ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(a.model.get("form_variation").get("post_parent"))}).get("variations").add(o)}}else if(a.model.get("post_type")===ThriveLeads.const.tve_leads_post_two_step_lightbox_type||a.model.get("form_variation")instanceof ThriveLeads.models.TwoStepLightboxVariation){o.set("is_control",!ThriveLeads.objects.TwoStepLightbox.get("variations").length),ThriveLeads.objects.TwoStepLightbox.get("variations").add(o),ThriveLeads.objects.TwoStepLightbox.trigger("change");try{ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:a.model.get("form_type_id")}).get("variations").add(o)}catch(e){ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(a.model.get("form_variation").get("post_parent"))}).get("variations").add(o)}}else{o.set("is_control",!ThriveLeads.objects.FormType.get("variations").length),ThriveLeads.objects.FormType.get("variations").add(o),ThriveLeads.objects.FormType.trigger("change");try{ThriveLeads.objects.groups.findWhere({ID:a.model.get("group_id")}).get("form_types").findWhere({ID:a.model.get("form_type_id")}).get("variations").add(o)}catch(e){console.log(e.message)}}a.$el.find(".post_title").val(""),a.close(),TVE_Dash.hideLoader()}}))}else this.triggerError(i,ThriveLeads.const.translations.FormNameRequired)}}),ArchiveForm:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/archive-form-variation"),events:{"click .tve-confirm":"confirm"},confirm:function(t){var i=e(t.currentTarget),s=this;this.btnLoading(i),TVE_Dash.showLoader(),s.close();var o=this.model.get("post_status");this.model.set("post_status",ThriveLeads.const.test_status.archived);var n=this.model.save({});ThriveLeads.addFailCallback(n),n.done((function(e){s.model.set(e)})),n.always((function(){if(n.failed)s.model.set("post_status",o);else{var e;(e=s.model instanceof ThriveLeads.models.ShortcodeVariation?ThriveLeads.objects.Shortcode:s.model instanceof ThriveLeads.models.TwoStepLightboxVariation?ThriveLeads.objects.TwoStepLightbox:ThriveLeads.objects.FormType).get("variations_archived").push(s.model),e.get("variations").remove(s.model),e.get("variations").determineControl(),e.trigger("change");try{if(e instanceof ThriveLeads.models.FormType){var t=ThriveLeads.objects.groups.findWhere({ID:e.get("post_parent")});t.get("form_types").findWhere({ID:parseInt(e.get("ID"))}).get("variations").remove(s.model),t.trigger("change")}else ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(s.model.get("post_parent"))}).get("variations").remove(s.model)}catch(e){console.log(e.message)}}}))}}),DeleteConversionLogs:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-archives"),events:{"click .tve-confirm-delete-archives":"deleteLogs"},deleteLogs:function(e){TVE_Dash.showLoader();var t={action:"thrive_leads_backend_ajax",route:"deleteLogs",security:ThriveLeadsConst.security};jQuery.post(ajaxurl,t),this.close(),TVE_Dash.hideLoader()}}),ConfirmDeleteVariation:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-form"),events:{"click .tve-confirm-delete-form":"deleteVariation"},afterRender:function(){this.$el.addClass("tvd-red")},deleteVariation:function(e){var t=this,i=this.model.toJSON();TVE_Dash.showLoader(),t.close();var s=this.model.destroy({data:jQuery.param(i)});ThriveLeads.addFailCallback(s,this),s.always((function(){if(!s.failed){if(TVE_Dash.hideLoader(),t.model instanceof ThriveLeads.models.ShortcodeVariation)return ThriveLeads.objects.Shortcode.trigger("change"),void setTimeout((function(){jQuery('.tl-clickable[data-target="#tl-toggle-forms"]').click()}),0);if(t.model instanceof ThriveLeads.models.TwoStepLightboxVariation)return ThriveLeads.objects.TwoStepLightbox.trigger("change"),void setTimeout((function(){jQuery('.tl-clickable[data-target="#tl-toggle-forms"]').click()}),0);ThriveLeads.objects.FormType.trigger("change"),setTimeout((function(){jQuery('.tl-clickable[data-target="#tl-toggle-forms"]').click()}),0)}}))}}),ConfirmResetStats:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/reset-form-stats"),events:{"click .tve-confirm-reset":"resetStats"},resetStats:function(e){var t,i=this;t=this.model instanceof ThriveLeads.models.ShortcodeVariation?ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(i.model.get("post_parent"))}):this.model instanceof ThriveLeads.models.TwoStepLightboxVariation?ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(i.model.get("post_parent"))}):ThriveLeads.objects.groups.findWhere({ID:parseInt(ThriveLeads.objects.FormType.get("post_parent"))}),TVE_Dash.showLoader(),t.decreaseStatistics(this.model),this.model.resetStatistics({success:function(e){i.model.set(e)},error:function(){},complete:function(){i.close(),TVE_Dash.hideLoader()}})}}),ConfirmFormTypeResetStats:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/reset-form-type-stats"),events:{"click .tve-confirm-reset":"resetStats"},resetStats:function(e){var t=this;if(this.model instanceof ThriveLeads.models.Shortcode||this.model instanceof ThriveLeads.models.TwoStepLightbox||this.model instanceof ThriveLeads.models.OneClickSignup)var i=this.model;else i=ThriveLeads.objects.groups.findWhere({ID:parseInt(this.model.get("post_parent"))});TVE_Dash.showLoader(),this.model.resetStatistics({success:function(){i.decreaseStatistics(t.model)},error:function(){},complete:function(){t.close(),TVE_Dash.hideLoader()}})}}),DisplayFrequencySettings:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/display-frequency-settings"),events:{"click .tve-save-frequency":"saveValue"},afterOpen:function(){this.$input=this.$el.find(".input-display-frequency"),this.$input.change()},clearData:function(){this.$input=null},saveValue:function(){this.model.set("display_frequency",this.$input.val()),TVE_Dash.showLoader(),this.close();var e=this,t=this.model.save({});ThriveLeads.addFailCallback(t),t.done((function(t){e.model.set(t),TVE_Dash.hideLoader()}))}}),AnimationSettings:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/animation-settings"),events:{"change #animation-type":"animate","click .tve-save-animation":"saveValue"},afterOpen:function(){this.$el.addClass("tvd-animation-modal"),this.$el.find("#animation-type").val(this.model.get("display_animation")),this.target=this.$el.find("#tve-anim-target"),this.animate(),ThriveLeads.objects.FormType&&"screen_filler"==ThriveLeads.objects.FormType.get("tve_form_type")&&(e("#animation-type option[value='blur']").remove(),e("#animation-type option[value='make_way']").remove())},animate:function(){var e=this.$el.find("#animation-type").val(),t=this.target,i=t.parents(".tve-animation-preview");jQuery("#TB_ajaxContent").css("overflow","hidden"),setTimeout((function(){clearTimeout(0),t.css("display","none").removeClass((function(e,t){var i=t.split(" "),s="";return _.each(i,(function(e){0===e.indexOf("tl-anim")&&(s+=e)})),s})).removeClass("tve-leads-triggered").addClass("tl-anim-"+e),i.removeClass((function(e,t){var i=t.split(" "),s="";return _.each(i,(function(e){0===e.indexOf("tl-anim")&&(s+=e)})),s})).addClass("tl-anim-"+e),setTimeout((function(){t.css("display","")}),400),setTimeout((function(){t.addClass("tve-leads-triggered")}),500)}),100)},saveValue:function(){this.model.set("display_animation",this.$el.find("#animation-type").val()),TVE_Dash.showLoader(),this.close();var e=this,t=this.model.save({});ThriveLeads.addFailCallback(t),t.done((function(t){e.model.set(t),TVE_Dash.hideLoader()}))}}),LockDisplaySettings:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/lock-display-settings"),events:{"click .tve-save-lead-lock":"saveValue","change #tve-lock-display":"lockDisplayChange"},lockDisplayChange:function(t){"blur"===e(t.currentTarget).val()?jQuery(".tve-blur-warning").show():jQuery(".tve-blur-warning").hide()},saveValue:function(){this.model.set("display_animation",this.$el.find("#tve-lock-display").val()),this.model.set("content_lock_display",this.$el.find("#tve-lock-display").val()),TVE_Dash.showLoader(),this.close();var e=this,t=this.model.save({});ThriveLeads.addFailCallback(t),t.done((function(t){e.model.set(t),TVE_Dash.hideLoader()}))}}),PHPInsertCode:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/php-insert-code"),afterOpen:function(){ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard")),this.$el.find(".tve-php-code").val(this.model.getPHPCode())}}),InboundLink:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/inbound-link-builder"),onOpen:function(){this.bindZclip()},bindZclip:function(){ThriveLeads.bindZClip(this.$el.find("a.tl-inbound-link-copy-btn"))},afterRender:function(){var e=this,t=this.$el.find(".home-base-url").val(),i=this.$el.find(".tl-step3-wrapper-options");return this.model.set("base_url",t),this.collection.each((function(t){i.append(e.renderGroup(t))})),this.updateInboundLink(),this},renderGroup:function(e){return TVE_Dash.tpl("lightbox/inbound-link/group-item",{group:e})},events:{'change input[name="targetAll"]':function(e){0===parseInt(e.currentTarget.value)?this.targetCertainGroups():this.targetAllGroups()},"change .tl-behaviour-period":"displayCustomPeriod","change .tl-post-type-select":"displayPostTypeFields","click .tl-targetGroup":"prepareGroupsArray","change .tl-form-behaviour":"prepareFormTypeArg","change .tl-custom-period-input":"prepareCustomPeriodDaysArg","click .tl-update-inbound-link":"prepareCustomBaseUrlArg","click .tl-inbound-link-copy-btn":"checkSetupsBeforeCopy"},checkSetupsBeforeCopy:function(){if(0==e("input.tl-targetGroup:checkbox:checked").length)return TVE_Dash.err(ThriveLeads.const.translations.MissingTargetGroup),!1},targetAllGroups:function(){this.$el.find(".tl-step3-wrapper-options input.tl-targetGroup").each((function(){e(this).attr("disabled",!0),e(this).attr("checked",!0)})),this.model.set("target_all",1),this.model.set("groups",[]),this.updateInboundLink()},targetCertainGroups:function(){this.$el.find(".tl-step3-wrapper-options input.tl-targetGroup").each((function(){e(this).removeAttr("disabled"),e(this).attr("checked",!1)})),this.model.set("target_all",0),this.updateInboundLink()},displayCustomPeriod:function(e){var t=jQuery(e.currentTarget).find("option:selected").val();if("2"==t){this.$el.find(".tl-custom-period").show();var i=this.$el.find(".tl-custom-period-input").val();this.model.set("period_days",i)}else this.$el.find(".tl-custom-period").hide(),this.model.set("period_days","");this.model.set("period_type",t),this.updateInboundLink()},displayPostTypeFields:function(e){var t=this,i=this.model,s=this.$el,o=jQuery(e.currentTarget).find("option:selected"),n=o.val();if("custom-url"==n)this.$el.find(".tl-custom-url").show(),this.$el.find(".tl-find-content").hide();else if(o.hasClass("request-posts"))this.$el.find(".tl-custom-url").hide(),this.$el.find(".tl-find-content").show(),s.find(".tl-find-content-input").val("").each((function(){var e=jQuery(this);e.autocomplete({appendTo:e.parent(),minLength:2,delay:200,source:function(e,t){jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"tve_leads_find_content_action",q:e.term,type:n,security:ThriveLeadsConst.security}}).done((function(e){t(e)}))},select:function(e,o){return s.find(".tl-find-content-input").val(o.item.label),i.set("base_url",o.item.url),t.updateInboundLink(),!1}})}));else{this.$el.find(".tl-custom-url").hide(),this.$el.find(".tl-find-content").hide();var a=o.attr("rel");i.set("base_url",a),this.updateInboundLink()}},prepareGroupsArray:function(){var t=[];e(".tl-targetGroup:checked").each((function(){t.push(this.value)})),this.model.set("groups",t),this.updateInboundLink()},prepareFormTypeArg:function(e){var t=jQuery(e.currentTarget).find("option:selected").val();this.model.set("form_type",t),this.updateInboundLink()},prepareCustomPeriodDaysArg:function(e){var t=jQuery(e.currentTarget),i=parseFloat(t.val());(isNaN(i)||i<0)&&(i=0),t.val(i),this.model.set("period_days",i),this.updateInboundLink()},prepareCustomBaseUrlArg:function(){var e=this.$el.find(".tl-custom-url-input").val();this.model.set("base_url",e),e?this.updateInboundLink():TVE_Dash.err(ThriveLeads.const.translations.MissingCustomUrl)},updateInboundLink:function(){var e=this.$el.find("a.tl-inbound-link-copy-btn");0==this.$el.find("input.tl-targetGroup:checkbox:checked").length?(e.addClass("tvd-disabled"),this.$el.find(".zclip").remove()):(e.removeClass("tvd-disabled"),this.bindZclip()),this.$el.find(".tl-inbound-link-input").val(this.model.getLink()),e.hasClass("tvd-btn-green")&&(e.removeClass("tvd-btn-green"),e.find(".tl-copy-text").text(ThriveLeads.const.translations.Copy))}})}}));