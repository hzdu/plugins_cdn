(()=>{var e=e||{},t=TVE.Views.Components.AnimationViews;e.views=e.views||{},e.views.components=e.views.components||{},e.views.ShortcodesPanel=TVE.Views.InlinePanel.extend({template:TVE.tpl("inline/content-templates"),after_initialize:function(){this.$(".drop-panel").addClass("small-pad tcb-autocomplete"),this.autocomplete()},autocomplete:function(){var e=this;this.$input=this.$(".tcb-search").autocomplete({minLength:0,appendTo:this.$(".popup-content"),source:function(e,t){t(jQuery.ui.autocomplete.filter(TVE.CONST.tl_shortcodes,e.term).slice(0,5))},select:function(t,i){return e.render_html(i.item.id),t.stopPropagation(),!1}}),this.$input.data("ui-autocomplete")._renderItem=function(e,t){e.addClass("tcb-suggest");var i=new RegExp(this.term,"i");return jQuery("<li></li>").data("item.autocomplete",t).append('<a href="#" class="tcb-truncate">'+t.label.replace(i,'<span class="highlight">'+this.term+"</span>")+"</a>").appendTo(e)}},render_html:function(e){var t={shortcode_id:e,external_action:"render_tl_shortcode"};TVE.ActiveElement.addClass("tcb-el-loading"),TVE.ajax("save_post_external","post",t,"json").done((function(e){var t=TVE.drag.insert(e.html,TVE.ActiveElement,!1,!0);TVE.Editor_Page.focus_element(t),TVE.inner.window.TCB_Front.handleIframes(t,!0),TVE.ActiveElement.removeClass("tcb-el-loading")}))},onOpen:function(){this.$input.val("").focus().autocomplete("search")}}),TVE.Views.Components.tl_shortcode=TVE.Views.Base.component.extend({before_update:function(){var e=TVE.ActiveElement.find(".tve-leads-conversion-object").data("tl-type"),t=null;e&&(t=parseInt(e.replace("shortcode_",""))),this.list.set_value(t)},controls_init:function(){var t=this;this.placeholder_panel=new e.views.ShortcodesPanel({component:this,minWidth:300,no_buttons:!0}),this.list=new TVE.Views.Controls.List({el:this.$("#tl_shortcodes_list")[0],items:TVE.CONST.tl_shortcodes}),this.list.on("change",(function(e){t.placeholder_panel.render_html(e)}))},placeholder_action:function(){this.placeholder_panel.open(TVE.ActiveElement,TVE.ActiveElement.find(".tcb-inline-placeholder-action"))}}),e.views.ThriveBoxAction=t.ThriveLightbox.extend({controls_init:function(){this.list=new TVE.Views.Controls.List({el:this.$(".state-list")[0],items:this.options.actions[this.key].options}),this.event_trigger="click",this.$animation=this.$("#lb-animation").hide()},apply_settings:function(e){return!!this.validate()&&(this.model.set({a:this.key,t:this.parent_tab.$("#a-popup-trigger").val(),config:{l_id:this.list.get_value()}}),!0)}}),function(e){function t(){var t=this,i=this.model.get("asset_delivery");if(1===parseInt(i._asset_option))return e.each(i,(function(e,i){var n=t.$("#"+e);if(n.length>0)n.val(i);else{var s=TVE.Components.lead_generation.generateHiddenInput({name:e,value:i});TVE.Components.lead_generation.getWrapper("form").append(s)}})),this;this.$("input[name*='asset']").remove()}function i(){var t={};return this.$("input[name*='asset']").each((function(){t[this.getAttribute("name")]=this.value})),this.model.set("asset_delivery",e.extend({_asset_group:0,_asset_option:0},t)),t}TVE.Views.Controls.AssetDelivery=TVE.Views.Controls.Switch.extend({after_initialize:function(){TVE.add_filter("lg_api_save."+this.component.key,this.update.bind(this)),TVE.add_filter("lg_custom_html_save."+this.component.key,this.update.bind(this))},update:function(){var e=this.component;void 0===e.leadGenerationView._read.asset_delivery&&(e.leadGenerationView._read.asset_delivery=i),e.leadGenerationView.read("asset_delivery");var t=e.leadGenerationModel.get("asset_delivery")._asset_option;this.setChecked(t),this.$el.parent().find("#tve-leads-asset-controls").toggleClass("tcb-hidden",!t)},input:function(e,i){var n=this.component;void 0===n.leadGenerationView._write.asset_delivery&&(n.leadGenerationView._write.asset_delivery=t);var s=n.leadGenerationModel.get("asset_delivery");s=jQuery.extend(s,{_asset_option:i.checked?1:0}),this.$el.parent().find("#tve-leads-asset-controls").toggleClass("tcb-hidden",!i.checked),n.leadGenerationModel.set("asset_delivery",s),n.leadGenerationView.write("asset_delivery"),i.checked&&this.$el.parent().find('[data-view="AssetGroup"] select').trigger("change")}}),TVE.Views.Controls.AssetGroup=TVE.Views.Controls.Select.extend({after_initialize:function(){TVE.add_filter("lg_consent_apis."+this.component.key,_.bind((function(e){return this.component.has_asset_delivery()&&e.push({key:"asset",label:this.model.config.consent_label.replace("{asset_name}",this.get_selected_label())}),e}),this))},update:function(){var e=this.component,i=e.leadGenerationModel.get("asset_delivery")._asset_group;void 0===e.leadGenerationView._write.asset_delivery&&(e.leadGenerationView._write.asset_delivery=t),0===i&&(i=this.$select.find("option").first().val(),e.leadGenerationModel.get("asset_delivery")._asset_group=i,e.leadGenerationView.write("asset_delivery")),this.setValue(i)},input:function(e,t){var i=this.component,n=i.leadGenerationModel.get("asset_delivery");n._asset_group=t.value,i.leadGenerationModel.set({asset_delivery:n,write:"asset_delivery"})}}),e((function(){TVE.add_filter("tcb_page_event_actions",(function(e,t){var i=t.extend({template:TVE.tpl("page-events/thrive-box"),get:function(){return TVE.Components.animation.options.actions.thrive_leads_2_step.options}});return delete e.thrive_leads_2_step.disabled,e.thrive_leads_2_step.view=new i,e})),TVE.add_filter("tve_custom_html_code",(function(t){if("undefined"!=typeof tve_leads_page_data){var i={group_id:tve_leads_page_data.group_id,form_type_id:tve_leads_page_data.post_id,variation_id:tve_leads_page_data._key};e("<div>",{html:"__CONFIG_tve_leads_additional_fields_filters__"+JSON.stringify(i)+"__CONFIG_tve_leads_additional_fields_filters__"}).hide().appendTo(t)}})),TVE.add_filter("should_have_width_on_float",(function(e){return e.push("thrive_leads_shortcode"),e})),TVE.add_action("tcb.symbol.after_save",(function(e){e.find(".tve-tl-anim").removeClass("tve-tl-anim")}))}))}(jQuery)})();