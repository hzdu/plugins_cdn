(()=>{var t,e=e||{},a=TVE.Views.Components.AnimationViews;e.views=e.views||{},TVE.leads=TVE.leads||{},e.views.ModalTemplates=TVE.modal.base.extend({el:TVE.modal.get_element("tl-templates"),initialize:function(){TVE.modal.base.prototype.initialize.apply(this,arguments),this.$error=this.$(".error-container"),this.$template_items=this.$(".tl-set-list"),this.$saved_templates_checkbox=this.$(".saved-templates-checkbox"),this.$warning=this.$(".warning-ct-change"),this.$footer=this.$(".tcb-modal-footer"),this.templateWasSelected=!1},after_initialize:function(t){this.initClickHandler()},before_open:function(){this.$el.addClass("modal-w-sidebar"),this.$template_items.empty(),this.$warning.css("display","none"),this.$footer.css("display","none"),this.$(".tl-category-filter.active").removeClass("active"),this.$(".tl-category-filter[data-content='default']").addClass("active"),this.$(".tve-c-modal-search-input").val(""),this.$modalContent=this.$(".tcb-modal-content").css("height","100%"),this.templatesType="default",this.renderTemplates()},filterClick:function(t){this.templatesType=t.currentTarget.getAttribute("data-content"),this.renderTemplates(),this.$(".tl-category-filter.active").removeClass("active"),t.currentTarget.classList.toggle("active")},onSearch:function(){_.throttle(this.renderTemplates(),420)},clearSearch:function(){this.$(".tve-c-modal-search-input").val(""),this.renderTemplates()},renderTemplates:function(){var t=this;this.$template_items.empty(),this.$saved_templates_checkbox.css("display","none"),"saved"===this.templatesType&&this.$saved_templates_checkbox.css("display","flex"),this.getItems().then((function(e){t.setItems(t.filterTemplates(e)).then((function(){t.applyMasonry()}))}))},getItems:function(){var t=this;return new Promise((function(e){if("default"===t.templatesType)t.setTemplates(TVE.CONST.tl_templates),e(t.templates);else if("saved"===t.templatesType){var a={external_action:tve_leads_page_data.tpl_action,route:"get_saved",current_template:t.$("#tl-filter-current-templates").is(":checked")?1:0,post_id:TVE.CONST.post_id,_key:tve_leads_page_data._key};TVE.main.overlay(),TVE.ajax("save_post_external","post",a).fail((function(){TVE.utils.message("Error fetching templates!","error")})).done((function(a){if(!a.success&&!a.main_page_content)return TVE.page_message(a.message,!0),TVE.main.overlay("close");t.setTemplates(a.templates),TVE.main.overlay("close"),e(t.templates)}))}}))},filterTemplates:function(t){var e=this.$(".tve-c-modal-search-input").val().trim().toLowerCase();return t.filter((function(t){var a=!0;return a&&e&&!t.attributes.name.toLowerCase().includes(e)&&(a=!1),a}))},setItems:function(t){var e=[],a=this,i=TVE.tpl("templates/item");return TVE.CONST.tl_templates_error.error&&this.$error.fadeIn(200).html(TVE.tpl("inline-error")({error_message:TVE.CONST.tl_templates_error.error})),0===t.length?a.$template_items.append("No templates found"):t.forEach((function(t,n,s){var o="saved"===a.templatesType,l=t.get("thumb_sizes");if(o&&l&&isNaN(parseInt(l.h))){var r=new Promise((function(e){var n=new Image;n.src=t.get("thumbnail"),n.onload=function(){t.set({thumb_sizes:{w:n.width,h:n.height}}),a.$template_items.append(i({item:t,saved:o})),e()}}));e.push(r)}else a.$template_items.append(i({item:t,saved:o}))})),Promise.allSettled(e)},setTemplates:function(t){this.templates=new Backbone.Collection(t)},selectTemplate:function(t){var e=jQuery(t.currentTarget);this.$el.find(".cloud-item.active").removeClass("active"),this.$el.find(".modal-title-w-options.active").removeClass("active");var a=jQuery(".tcb-modal-tl-templates").height();this.$modalContent.css("height",a-82),e.addClass("active"),e.siblings().addClass("active"),(tve_leads_page_data.has_content||this.templateWasSelected)&&this.$warning.css("display","block"),this.$footer.css("display","block")},openOptionsTooltip:function(t){this.closeOptionsTooltip(),jQuery(t.target).closest(".modal-title-w-options").toggleClass("tooltip-open"),this.tooltipOpen=!0},closeOptionsTooltip:function(){this.tooltipOpen&&(this.$el.find(".tooltip-open").removeClass("tooltip-open"),this.tooltipOpen=!1)},initClickHandler:function(){var t=this;this.$el.on("mousedown",(function(e){var a=jQuery(e.target);t.tooltipOpen&&0===a.closest(".modal-title-w-options, .tcb-dropdown-dots").length&&t.closeOptionsTooltip()}))},applyMasonry:function(){var t=parseInt(this.$el.find(".cloud-template-item").outerWidth(!0));this.$el.find("img").each((function(){var e=jQuery(this)[0].getAttribute("data-ratio");e&&jQuery(this).parent().css("height",t*parseFloat(e))})),this.$template_items.data("masonry")&&this.$template_items.data("masonry").destroy();var e=this;setTimeout((function(){e.$template_items.masonry()}),0)},deleteConfirmation:function(t){var e=jQuery(t.currentTarget).closest(".cloud-template-item");e.find(".cb-template-wrapper").hide(),e.find(".symbol-delete-notice").css("display","flex"),this.closeOptionsTooltip()},hideDelete:function(t){var e=jQuery(t.currentTarget).closest(".cloud-item");e.find(".cb-template-wrapper").show(),e.find(".symbol-delete-notice").css("display","none")},deleteSavedTemplate:function(t){var e=jQuery(t.currentTarget).closest(".cloud-template-item"),a=this,i={external_action:tve_leads_page_data.tpl_action,route:"delete",tpl:e.attr("data-id"),post_id:TVE.CONST.post_id,_key:tve_leads_page_data._key};TVE.main.overlay(),TVE.ajax("save_post_external","post",i).done((function(t){e.remove(),a.applyMasonry(),TVE.main.overlay("close")}))},applyTemplate:function(){this.templateWasSelected=!0;var t=this,a=this.$(".cloud-item.active");if(a.length<=0)return TVE.page_message(TVE.t.SelectTemplate,!0,5e3);var i=a.data("id"),n=this.templates.findWhere({id:i});if(!(n instanceof Backbone.Model))return TVE.page_message("Something is wrong here. Template model not found ",!0);var s={tpl:n.get("key"),external_action:tve_leads_page_data.tpl_action,post_id:TVE.CONST.post_id,_key:tve_leads_page_data._key,route:"choose",cloud:n.get("cloud")||0,multi_step:n.get("multi_step")||0,form_type:n.get("form_type")||""};TVE.main.overlay(),jQuery("#tl-form-states").find(".design-states").is(":visible")&&jQuery("#tl-form-states").find("button.state-close").trigger("click"),TVE.ajax("save_post_external","post",s).done((function(a){if(!a.success&&!a.main_page_content)return TVE.page_message(a.message,!0),TVE.main.overlay("close");e.state.insertResponse(a),TVE.Editor_Page.editor.find(TVE.identifier("lead_generation")).each((function(){TVE.Components.lead_generation.regenerateFormIdentifier(TVE.inner_$(this))}));try{localStorage.setItem("tve_add_content_variation",JSON.stringify({form_type_id:s.post_id,variation_id:s._key}))}catch(t){}t.close()}))}}),e.views.ModalTemplateSaving=TVE.modal.base.extend({el:TVE.modal.get_element("tl-template-saving"),after_initialize:function(){this.$el.addClass("medium")},save:function(){var t=this.$("input").val();if(t.length<=0)return TVE.page_message(TVE.t.tpl_name_required,!0,5e3);var a=this,i=t+TVE.CSS_Rule_Cache.generate_id(""),n={external_action:tve_leads_page_data.tpl_action,route:"save",post_id:TVE.CONST.post_id,_key:tve_leads_page_data._key,name:t,thumbnail:i};return TVE.main.overlay(),TVE.main.editor_settings.save(null,null,(function(){TVE.ajax("save_post_external","post",n).done((function(t){if(!t.success)return TVE.page_message(t.message,!0),TVE.main.overlay("close");e.savePreview(i),TVE.main.overlay("close"),a.close(),TVE.page_message(t.message)}))})),this}}),TVE.leads.LightboxStateAction=a.ThriveLightbox.extend({reinit:function(){this.options.actions[this.key]?(this.$el.closest(".action-item").show(),this.list.set_items(this.options.actions[this.key].options)):this.$el.closest(".action-item").hide()},controls_init:function(){this.list=new TVE.Views.Controls.List({el:this.$(".state-list")[0],items:this.options.actions[this.key].options}),this.event_trigger="click",this.$animation=this.$("#lb-animation"),TVE.CONST.options.animation.actions.tl_state_lightbox?(this.$animation.show(),_.each(TVE.CONST.options.animation.actions.tl_state_lightbox.animations,(function(t,e){this.$animation.append('<option value="'+e+'">'+t+"</option>")}),this)):this.$animation.hide()},set_model:function(t){return this.model=void 0!==t?t:new Backbone.Model({config:{}}),this.list.set_value(parseInt(this.model.get("config").s||0)),this.$animation.val(this.model.get("config").anim||"instant"),this},validate:function(){return!!this.list.get_value()||TVE.page_message(TVE.t.state_missing,!0)},apply_settings:function(t){return!!this.validate()&&(this.model.set({a:this.key,t:this.event_trigger,config:{anim:this.$animation.val()||"instant",s:this.list.get_value()}}),!0)}}),TVE.leads.StateSwitchAction=TVE.leads.LightboxStateAction.extend({controls_init:function(){TVE.leads.LightboxStateAction.prototype.controls_init.apply(this,arguments),this.$animation.hide()}}),t=jQuery,TVE.add_filter("tve_form_submit_options",(function(t){return _.findWhere(t,{key:"state"})||t.push({key:"state",label:tve_leads_page_data.L.switch_state,icon:"state"}),t})),t((function(){new TVE.leads.StateManager({el:t("#tl-form-states")[0]}),TVE.add_filter("editor_loaded_callback",e.tcb_editor_page_loaded),TVE.add_filter("before_editor_events",e.before_editor_loaded),TVE.add_filter("tcb_insert_content_template",e.pre_process_content_template),TVE.main.on("animation_update",(function(e,a){var i=a.read(e);t.each(i,(function(i,n){var s=n.a;if("thrive_leads_form_close"!==s){var o=parseInt(n.config.s),l=n.t,r=TVE.Components.animation.options.actions;if("click"===l){var d=r[s].options,_=[];d.length?(t.each(d,(function(t,e){e.id===o&&_.push(e.id)})),_.length||a.remove(e,l)):a.remove(e,l)}}}))}))})),TVE.leads.StateManager=TVE.Views.Base.base_view.extend({after_initialize:function(){this.dom={btn:this.$(".states-button-container")},e.state.fixed_height()},expand:function(){clearTimeout(this.hide_timeout),this.$(".design-states").removeClass("hide-from-view")},collapse:function(t){this.hide_timeout=setTimeout(this.bind((function(){this.$(".design-states").addClass("hide-from-view")})),200)},cancel_hide:function(){clearTimeout(this.hide_timeout)},toggle_add:function(e){t(e.currentTarget).toggleClass("tl-multistep-open")},add:function(t){var a=t.currentTarget;a.getAttribute("data-subscribed")?alert(tve_leads_page_data.L.only_one_subscribed):(this.collapse(),TVE.main.overlay(),TVE.Editor_Page.save(!1,(function(){TVE.KEEP_OVERLAY=!0,e.state.ajax({custom_action:"add",state:a.getAttribute("data-state")}).done((function(t){e.state.insertResponse(t),TVE.Components.lead_generation.removeSettingsId(TVE.Editor_Page.editor)}))})))},select:function(t){var a=t.currentTarget.getAttribute("data-id"),i=TVE.$(".preview-content"),n=i.attr("href");this.collapse(),TVE.main.overlay(),TVE.Editor_Page.save(!1,(function(){TVE.KEEP_OVERLAY=!0,e.state.ajax({custom_action:"display",id:a}).done(e.state.insertResponse)})),i.attr("href",this.updateUrlParameter(n,"_key",a))},updateUrlParameter:function(t,e,a){var i=new RegExp("("+e+"=)[^&]+");return t.replace(i,"$1"+a)},visibility:function(a){var i=t(a.currentTarget);if(i.parents("li").hasClass("lightbox-step-active")&&void 0!==i.attr("data-visible"))return TVE.main.overlay(),this.collapse(),e.state.ajax({custom_action:"visibility",visible:i.attr("data-visible")}).done((function(t){TVE.page_message(t.message),e.state.insertResponse(t)})),!1},duplicate:function(t,a){if("already_subscribed"!==a.getAttribute("data-state"))return this.collapse(),TVE.main.overlay(),TVE.Editor_Page.save(!1,(function(){TVE.KEEP_OVERLAY=!0,e.state.ajax({custom_action:"duplicate",id:a.getAttribute("data-id")}).done((function(t){e.state.insertResponse(t),TVE.Components.lead_generation.removeSettingsId(TVE.Editor_Page.editor)}))})),!1;alert(tve_leads_page_data.L.only_one_subscribed)},remove:function(t,a){return!!confirm(tve_leads_page_data.L.confirm_state_delete)&&(this.collapse(),TVE.main.overlay(),e.state.ajax({custom_action:"delete",id:a.getAttribute("data-id")}).done((function(t){TVE.page_message(tve_leads_page_data.L.state_deleted),e.state.insertResponse(t)})),!1)}}),e.state={fixed_height:function(){var e=t(".fix-height-states");"function"==typeof e.scrollbar?e.scrollbar():e.css("overflow-y","auto")},insertResponse:function(a){a||TVE.page_message("Something went wrong",!0),TVE.main&&TVE.main.$cpanel&&a.preview_link.length&&TVE.main.$cpanel.find(".preview-content").attr("href",decodeURIComponent(a.preview_link)),TL_Editor_Page.handle_state_response(a),t(".design-states").replaceWith(a.state_bar),e.state.fixed_height(),a.tve_path_params.tl_templates&&modal_templates.setTemplates(TVE.CONST.tl_templates),a.animation_options&&(TVE.Components.animation.options=a.animation_options,TVE.Components.animation.reinit(),e.FLAG_RE_RENDER_EVENTS=!0);var i=t(".total_states");a.tve_leads_page_data.states.length>=2?(i.show(),i.html(a.tve_leads_page_data.states.length-1)):i.hide(),setTimeout((function(){TVE.main.overlay("close")}),1)},ajax:function(t){return TVE.Editor_Page.blur(),t._key=tve_leads_page_data._key,t.post_id=tve_leads_page_data.post_id,t.active_state=tve_leads_page_data._key,t.external_action=tve_leads_page_data.state_action,TVE.ajax("save_post_external","post",t)}},e.tcbEditorSetSelector=function(){if(!tve_leads_page_data.form_type.includes("lightbox")){var t=_.findWhere(tve_leads_page_data.states,{key:tve_leads_page_data._key});TVE.CONST.editor_selector="lightbox"===t.form_state?"body":""}},e.savePreview=function(e){TVE.Editor_Page.blur(),TVE.Editor_Page.editor.find(".on_hover").removeClass("on_hover"),TVE.inner_$(".preview-cloned-content").remove();var a=TVE.inner_$(".thrv-leads-screen-filler, .thrv-leads-slide-in");0===a.length&&(a=TVE.Editor_Page.editor);var i=TVE.getContentToPreview(a);TVE.generateElementPreview(i,(function(a){var i=new FormData;a&&i.append("preview_file",a,e+".png"),i.append("route","save_thumbnail"),i.append("custom","save_thumbnail"),i.append("action",tve_leads_page_data.tpl_action),i.append("security",tve_leads_page_data.security),i.append("_key",tve_leads_page_data._key),i.append("post_id",tve_leads_page_data.post_id),i.append("file_name",e),t.ajax({type:"POST",url:tve_leads_page_data.ajaxurl,data:i,processData:!1,contentType:!1})}),{},!0)},e.tcb_editor_page_loaded=function(){TVE.StorageManager.unset("tl_design-"+tve_leads_page_data.post_id),e.tcbEditorSetSelector(),modal_templates=new e.views.ModalTemplates,TVE.main.on("lgRenderOptionForm",(function(e,a,i){if("state"===i){var n=TVE.tpl("lead-generation/switch-states-form"),s=t(n()),o=s.find("select"),l="__TCB_EVENT_[",r="]_TNEVE_BCT__",d=function(e){var i="tl_state_switch",n=parseInt(e);a.set("_state",n),t(tve_leads_page_data.states).each((function(t,e){parseInt(n)===parseInt(e.key)&&"lightbox"===e.form_state&&(i="tl_state_lightbox")}));var s={t:"click",a:i,elementType:"a",config:{s:n}};s=l+JSON.stringify(s)+r,TVE.ActiveElement.find(".tve-switch-state-trigger").remove();var o=t('<a href="javascript:void(0)" style="display: none;" class="tve-switch-state-trigger tve_evt_manager_listen tve_et_click"></a>');o.attr("data-tcb-events",s),TVE.Components.lead_generation.getWrapper("form").append(o)};if(o.on("change",(function(t){d(t.currentTarget.value)})),t.each(tve_leads_page_data.states,(function(e,a){if(parseInt(a.key)!==parseInt(tve_leads_page_data._key)&&"already_subscribed"!==a.form_state){var i=t('<option value="'+a.key+'">'+a.state_name+"</option>");o.append(i)}})),TVE.ActiveElement.find(".tve-switch-state-trigger").length){var _=JSON.parse(TVE.ActiveElement.find(".tve-switch-state-trigger").attr("data-tcb-events").replace(l,"").replace(r,"")).config;o.val(_.s),TVE.ActiveElement.data("lg").set("_state",_.s)}else d(o.val());e.find("#lg-state").html(s).removeClass("tcb-hidden")}})),TVE.Components.lead_generation.on("tcb_lg_manage_submit_options",(function(t,e){e._write._form_type=function(){TVE.Components.lead_generation.getWrapper("form").append(TVE.Components.lead_generation.generateHiddenInput({name:"_form_type",value:tve_leads_page_data.form_type}))}})),t(TVE.main).on("tcb.open_templates_picker",(function(t){return t.preventDefault(),modal_templates.open({}),!1})),tve_leads_page_data.has_content||modal_templates.open({dismissible:!1}),TVE.main.sidebar_extra.tl_template_reset=function(){if(confirm(tve_leads_page_data.L.confirm_tpl_reset)){TVE.Editor_Page.blur(),TVE.main.sidebar_extra.hide_drawers();var t={_key:tve_leads_page_data._key,post_id:TVE.CONST.post_id,external_action:tve_leads_page_data.tpl_action,route:"reset"};TVE.main.overlay(),TVE.ajax("save_post_external","post",t).done(e.state.insertResponse)}},TVE.main.sidebar_extra.tl_template_save=function(){if(this.modal instanceof Backbone.View)return this.modal.open();this.modal=new e.views.ModalTemplateSaving,this.modal.open()},TVE.add_filter("link_search_lightbox",(function(){return""})),TVE.add_filter("tcb_save_post_data_before",(function(t){var e={m:"600px",t:"1023px",d:"1366px"};t["form-height"]={};var a=TVE.Editor_Page.editor.find(".tve_editor_main_content"),i=TVE.main.$frame.width();for(var n in 0===a.length&&(a=TVE.Editor_Page.editor),a.css("border","1px solid transparent"),e)TVE.main.$frame.width(e[n]),t["form-height"][n]=a.outerHeight(!0);if(a.css("border",""),TVE.main.$frame.width(i),TVE.inner_$(".tve_p_lb_content").length){var s,o=TVE.CONST.tve_globals;(s=TVE.inner_$(".tve_p_lb_content").attr("data-css"))&&(o.content_css=s)}return t})),TVE.add_action("tve.save_post.success",(function(){TVE.StorageManager.set("tl_design-"+tve_leads_page_data.post_id,!0)})),TVE.add_action("component.update.layout.tl-slide-in",(function(t){t.disable_extra_controls(["right","left"].map((function(t){return"margin-"+t})))}))},e.before_editor_loaded=function(){var a=1,i=["thrive_leads_form_close","tl_state_lightbox","tl_state_switch"];TVE.add_filter("tcb_froala_config",(function(){return{linkEventActions:{getHtml:function(){var t=TVE.Components.animation.options.actions,e={thrive_leads_form_close:t.thrive_leads_form_close};return t.tl_state_switch&&t.tl_state_switch.options.length&&(e.tl_state_switch=t.tl_state_switch),t.tl_state_lightbox&&t.tl_state_lightbox.options.length&&(e.tl_state_lightbox=t.tl_state_lightbox),TVE.tpl("froala-leads-states")({actions:e,current_id:++a})},bindEvents:function(t){t.on("change",".fr-extra-action",(function(e){t.find(".tl-action-config").hide(),this.checked?(t.find(".tl-action-opts-"+this.getAttribute("data-key")).show(),t.find(".fr-link-atts,.fr-link-url").hide(),t.find(".fr-extra-action").not(this).prop("checked",!1)):t.find(".fr-link-atts,.fr-link-url").show()}))},hasSelected:function(t){return t.find(".fr-extra-action:checked").length},getEventConfig:function(t){var e={};return e.a=t.find(".fr-extra-action:checked").attr("data-key"),e.t="click",e.config={s:t.find(".tl-action-opts-"+e.a+' select[name="s"]').val(),anim:t.find(".tl-action-opts-"+e.a+' select[name="a"]').val()},e},reset:function(t){e.FLAG_RE_RENDER_EVENTS&&(t.find(".tl-link-actions").replaceWith(this.getHtml()),delete e.FLAG_RE_RENDER_EVENTS),t.find(".fr-extra-action").prop("checked",!1),t.find(".fr-link-atts,.fr-link-url").show(),t.find(".tl-action-config").hide()},updateFromLink:function(e,a){var n=!1;if(this.reset(a),e.hasClass("tve_evt_manager_listen")){var s=TVE.EventManager.get(e,"click");s&&-1!==t.inArray(s.a,i)&&(a.find('.fr-extra-action[data-key="'+s.a+'"]').prop("checked",!0).trigger("change"),a.find(".tl-action-opts-"+s.a+' select[name="s"]').val(s.config.s),n=!0,a.find(".tl-action-opts-"+s.a+' select[name="a"]').val(s.config.anim||"instant"))}return n}}}}));var n=TVE.CustomHTML;TVE.CustomHTML=TVE.CustomHTML.extend({append_extra_settings:function(){this.$(".extra-settings").remove()},after_initialize:function(){n.prototype.after_initialize.apply(this,arguments),this.$(".tcb-modal-title").after(TVE.tpl("custom-html-options")()),this.$lazy_load=this.$("#custom-html-lazy-load")},before_open:function(){n.prototype.before_open.apply(this,arguments),this.$("#tl-custom-html-opts").toggle(!tve_leads_page_data.is_default_state)},is_lazy_load:function(){return!tve_leads_page_data.is_default_state&&"lazy"===this.$lazy_load.val()},prepare_content_for_save:function(t){return this.is_lazy_load()&&(t='<script type="text/template" style="display: none" class="tcb-lazyload-template">'+t+"<\/script>"),t},prepare_content_for_load:function(){var t,e=TVE.ActiveElement.children().first();return 1===e.length&&e.is('script.tcb-lazyload-template[type="text/template"]')?(this.$lazy_load.val("lazy"),t=e.html()):t=TVE.ActiveElement.html(),t}})}})();