!function(i){var e,o,r,t,a,c,n,l,d,s,p,u,f,h,v,m,g,k,b,_=(o={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!(e=65)},r=function(o){var e,t=i(this).parent().parent();0<this.parentNode.className.indexOf("_hex")?t.data("colorpicker").color=e=m(v(this.value)):0<this.parentNode.className.indexOf("_hsb")?t.data("colorpicker").color=e=f({h:parseInt(t.data("colorpicker").fields.eq(4).val(),10),s:parseInt(t.data("colorpicker").fields.eq(5).val(),10),b:parseInt(t.data("colorpicker").fields.eq(6).val(),10)}):t.data("colorpicker").color=e=g(h({r:parseInt(t.data("colorpicker").fields.eq(1).val(),10),g:parseInt(t.data("colorpicker").fields.eq(2).val(),10),b:parseInt(t.data("colorpicker").fields.eq(3).val(),10)})),o&&(x(e,t.get(0)),y(e,t.get(0)),w(e,t.get(0))),C(e,t.get(0)),M(e,t.get(0)),q(e,t.get(0)),t.data("colorpicker").onChange.apply(t,[e,b(e),k(e)])},t=function(o){return o.data.field.val(Math.max(0,Math.min(o.data.max,parseInt(o.data.val+o.pageY-o.data.y,10)))),o.data.preview&&r.apply(o.data.field.get(0),[!0]),!1},a=function(o){return r.apply(o.data.field.get(0),[!0]),o.data.el.removeClass("colorpicker_slider").find("input").focus(),i(document).off("mouseup",a),i(document).off("mousemove",t),!1},c=function(o){return r.apply(o.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,o.pageY-o.data.y)))/150,10)).get(0),[o.data.preview]),!1},n=function(o){return x(o.data.cal.data("colorpicker").color,o.data.cal.get(0)),y(o.data.cal.data("colorpicker").color,o.data.cal.get(0)),i(document).off("mouseup",n),i(document).off("mousemove",c),!1},l=function(o){return r.apply(o.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,o.pageY-o.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,o.pageX-o.data.pos.left))/150,10)).get(0),[o.data.preview]),!1},d=function(o){return x(o.data.cal.data("colorpicker").color,o.data.cal.get(0)),y(o.data.cal.data("colorpicker").color,o.data.cal.get(0)),i(document).off("mouseup",d),i(document).off("mousemove",l),!1},s=function(o){p(o.data.cal.get(0),o.target,o.data.cal.get(0))||(0!=o.data.cal.data("colorpicker").onHide.apply(this,[o.data.cal.get(0)])&&o.data.cal.hide(),i(document).off("mousedown",s))},p=function(o,e,t){if(o==e)return!0;if(o.contains)return o.contains(e);if(o.compareDocumentPosition)return!!(16&o.compareDocumentPosition(e));for(var r=e.parentNode;r&&r!=t;){if(r==o)return!0;r=r.parentNode}return!1},u=function(){var o="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(o?document.documentElement:document.body).scrollLeft,t:window.pageYOffset||(o?document.documentElement:document.body).scrollTop,w:window.innerWidth||(o?document.documentElement:document.body).clientWidth,h:window.innerHeight||(o?document.documentElement:document.body).clientHeight}},f=function(o){return{h:Math.min(360,Math.max(0,o.h)),s:Math.min(100,Math.max(0,o.s)),b:Math.min(100,Math.max(0,o.b))}},h=function(o){return{r:Math.min(255,Math.max(0,o.r)),g:Math.min(255,Math.max(0,o.g)),b:Math.min(255,Math.max(0,o.b))}},v=function(o){var e=6-o.length;if(0<e){for(var t=[],r=0;r<e;r++)t.push("0");t.push(o),o=t.join("")}return o},m=function(o){return g((o=o,{r:(o=parseInt(-1<o.indexOf("#")?o.substring(1):o,16))>>16,g:(65280&o)>>8,b:255&o}))},g=function(o){var e={h:0,s:0,b:0},t=Math.min(o.r,o.g,o.b),r=Math.max(o.r,o.g,o.b),t=r-t;return e.b=r,e.s=0!=r?255*t/r:0,0!=e.s?o.r==r?e.h=(o.g-o.b)/t:o.g==r?e.h=2+(o.b-o.r)/t:e.h=4+(o.r-o.g)/t:e.h=-1,e.h*=60,e.h<0&&(e.h+=360),e.s*=100/255,e.b*=100/255,e},k=function(o){var e={},t=Math.round(o.h),r=Math.round(255*o.s/100),a=Math.round(255*o.b/100);return 0==r?e.r=e.g=e.b=a:(a=t%60*((o=a)-(r=(255-r)*a/255))/60,(t=360==t?0:t)<60?(e.r=o,e.b=r,e.g=r+a):t<120?(e.g=o,e.b=r,e.r=o-a):t<180?(e.g=o,e.r=r,e.b=r+a):t<240?(e.b=o,e.r=r,e.g=o-a):t<300?(e.b=o,e.g=r,e.r=r+a):t<360?(e.r=o,e.g=r,e.b=o-a):(e.r=0,e.g=0,e.b=0)),{r:Math.round(e.r),g:Math.round(e.g),b:Math.round(e.b)}},b=function(o){return o=k(o),t=[o.r.toString(16),o.g.toString(16),o.b.toString(16)],i.each(t,function(o,e){1==e.length&&(t[o]="0"+e)}),t.join("");var t},{init:function(t){if("string"==typeof(t=i.extend({},o,t||{})).color)t.color=m(t.color);else if(null!=t.color.r&&null!=t.color.g&&null!=t.color.b)t.color=g(t.color);else{if(null==t.color.h||null==t.color.s||null==t.color.b)return this;t.color=f(t.color)}return this.each(function(){var o,e;i(this).data("colorpickerId")||((o=i.extend({},t)).origColor=t.color,e="collorpicker_"+parseInt(1e3*Math.random()),i(this).data("colorpickerId",e),e=i('<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>').attr("id",e),o.flat?e.appendTo(this).show():e.appendTo(document.body),o.fields=e.find("input").on("keyup",P).on("change",r).on("blur",N).on("focus",S),e.find("span").on("mousedown",O).end().find(">div.colorpicker_current_color").on("click",B),o.selector=e.find("div.colorpicker_color").on("mousedown",H),o.selectorIndic=o.selector.find("div div"),o.el=this,o.hue=e.find("div.colorpicker_hue div"),e.find("div.colorpicker_hue").on("mousedown",z),o.newColor=e.find("div.colorpicker_new_color"),o.currentColor=e.find("div.colorpicker_current_color"),e.data("colorpicker",o),e.find("div.colorpicker_submit").on("mouseenter",Y).on("mouseleave",E).on("click",j),x(o.color,e.get(0)),w(o.color,e.get(0)),y(o.color,e.get(0)),M(o.color,e.get(0)),C(o.color,e.get(0)),I(o.color,e.get(0)),q(o.color,e.get(0)),o.flat?e.css({position:"relative",display:"block"}):i(this).on(o.eventName,T))})},showPicker:function(){return this.each(function(){i(this).data("colorpickerId")&&T.apply(this)})},hidePicker:function(){return this.each(function(){i(this).data("colorpickerId")&&i("#"+i(this).data("colorpickerId")).hide()})},setColor:function(e){if("string"==typeof e)e=m(e);else if(null!=e.r&&null!=e.g&&null!=e.b)e=g(e);else{if(null==e.h||null==e.s||null==e.b)return this;e=f(e)}return this.each(function(){var o;i(this).data("colorpickerId")&&((o=i("#"+i(this).data("colorpickerId"))).data("colorpicker").color=e,o.data("colorpicker").origColor=e,x(e,o.get(0)),w(e,o.get(0)),y(e,o.get(0)),M(e,o.get(0)),C(e,o.get(0)),I(e,o.get(0)),q(e,o.get(0)))})}});function x(o,e){o=k(o),i(e).data("colorpicker").fields.eq(1).val(o.r).end().eq(2).val(o.g).end().eq(3).val(o.b).end()}function w(o,e){i(e).data("colorpicker").fields.eq(4).val(o.h).end().eq(5).val(o.s).end().eq(6).val(o.b).end()}function y(o,e){i(e).data("colorpicker").fields.eq(0).val(b(o)).end()}function C(o,e){i(e).data("colorpicker").selector.css("backgroundColor","#"+b({h:o.h,s:100,b:100})),i(e).data("colorpicker").selectorIndic.css({left:parseInt(150*o.s/100,10),top:parseInt(150*(100-o.b)/100,10)})}function M(o,e){i(e).data("colorpicker").hue.css("top",parseInt(150-150*o.h/360,10))}function I(o,e){i(e).data("colorpicker").currentColor.css("backgroundColor","#"+b(o))}function q(o,e){i(e).data("colorpicker").newColor.css("backgroundColor","#"+b(o))}function P(o){if(o=o.charCode||o.keyCode||-1,e<o&&o<=90||32==o)return!1;!0===i(this).parent().parent().data("colorpicker").livePreview&&r.apply(this)}function N(o){i(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus")}function S(){e=0<this.parentNode.className.indexOf("_hex")?70:65,i(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),i(this).parent().addClass("colorpicker_focus")}function O(o){var e=i(this).parent().find("input").focus(),e={el:i(this).parent().addClass("colorpicker_slider"),max:0<this.parentNode.className.indexOf("_hsb_h")?360:0<this.parentNode.className.indexOf("_hsb")?100:255,y:o.pageY,field:e,val:parseInt(e.val(),10),preview:i(this).parent().parent().data("colorpicker").livePreview};i(document).on("mouseup",e,a),i(document).on("mousemove",e,t)}function z(o){var e={cal:i(this).parent(),y:i(this).offset().top};e.preview=e.cal.data("colorpicker").livePreview,i(document).bind("mouseup",e,n),i(document).on("mousemove",e,c)}function H(o){var e={cal:i(this).parent(),pos:i(this).offset()};e.preview=e.cal.data("colorpicker").livePreview,i(document).on("mouseup",e,d),i(document).on("mousemove",e,l)}function Y(o){i(this).addClass("colorpicker_focus")}function E(o){i(this).removeClass("colorpicker_focus")}function j(o){var e=i(this).parent(),t=e.data("colorpicker").color;e.data("colorpicker").origColor=t,I(t,e.get(0)),e.data("colorpicker").onSubmit(t,b(t),k(t),e.data("colorpicker").el)}function T(o){var e=i("#"+i(this).data("colorpickerId"));e.data("colorpicker").onBeforeShow.apply(this,[e.get(0)]);var t=i(this).offset(),r=u(),a=t.top+this.offsetHeight,t=t.left;return a+176>r.t+r.h&&(a-=this.offsetHeight+176),t+356>r.l+r.w&&(t-=356),e.css({left:t+"px",top:a+"px"}),0!=e.data("colorpicker").onShow.apply(this,[e.get(0)])&&e.show(),i(document).on("mousedown",{cal:e},s),!1}function B(){var o=i(this).parent(),e=o.data("colorpicker").origColor;o.data("colorpicker").color=e,x(e,o.get(0)),y(e,o.get(0)),w(e,o.get(0)),C(e,o.get(0)),M(e,o.get(0)),q(e,o.get(0))}i.fn.extend({ColorPicker:_.init,ColorPickerHide:_.hidePicker,ColorPickerShow:_.showPicker,ColorPickerSetColor:_.setColor})}(jQuery);
