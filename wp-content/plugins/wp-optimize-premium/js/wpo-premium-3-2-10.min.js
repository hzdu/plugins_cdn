jQuery(function(e){WP_Optimize_Premium=WP_Optimize_Premium()});var WP_Optimize_Premium=function(){function e(e,t,i){return t||(t={}),t.images_trash_command=e,M("images_trash_command",t,i)}function t(e){var t=A("#wp-optimize-wrap .nav-tab-wrapper .nav-tab-active").is(["#wp-optimize-nav-tab-",e].join(""));return t}function o(){he||(he=!0,ce.show(),me.hide(),u(de.DETECT_BOTH,!1,!0))}function s(e){ke.hasOwnProperty(e)&&(ke[e].abort(),delete ke[e])}function a(t){return d(!0),t||(t=ce.get_selected_images()),ce.show_custom_loader(wpoptimize.moving_selected_unused_images_to_trash),e("move_images_to_trash",{images:t},function(e){alert(e.message),d(!1),ce.remove_selected_images(),ce.hide_loader();for(i in t)image_val=t[i],blog_id=image_val.split("_").shift(),ge[blog_id]--,fe[blog_id]--;m(j()),ce.update_view(),B.data("dirty",!0)})}function n(t,i){return d(!0),t||(t=me.get_selected_images()),me.show_custom_loader(wpoptimize.deleting_unused_images_from_trash),e("remove_trash_images",{images:t},function(e){e.error?alert(e.error):e.message&&(alert(e.message),i?(i.remove(),p(j(),-t.length)):me.reload()),me.hide_loader(),d(!1)})}function _(t,i){return d(!0),s(de.DETECT_IMAGES),t||(t=me.get_selected_images()),me.show_custom_loader(wpoptimize.restoring_selected_unused_images_from_trash),e("restore_images_from_trash",{images:t},function(e){e.error?alert(e.error):e.message&&(alert(e.message),L.data("dirty",!0),i?i.remove():me.remove_selected_images(),me.load_next_page_if_need(),p(j(),-t.length)),me.hide_loader(),d(!1)})}function p(e,t){be.hasOwnProperty(e)&&(be[e]+=t),ze.hasOwnProperty(e)&&(ze[e]+=t),h(e)}function r(e){ge={},fe={},ye={};var t={support_ajax_get_info:!0,mode:de.DETECT_IMAGES};e&&(t.forced=!0),ce.show_loader(),A(document).trigger(le.GET_INFO_START,t),ke[t.mode]=N(A(".wpo-shade-progress-message"),"images",t).fail(function(){A(document).trigger(le.GET_INFO_DONE,t)})}function d(e){var t=A("#optimization_checkbox_images");A.each([$,q,A("#optimization_button_images_big"),A("#optimization_button_images_small"),t,J,V,Y,X,L,B],function(t,i){i.prop("disabled",e)}),e?(we=t.is(":checked"),t.prop("checked",!1)):(t.prop("checked",we),ce.update_view(),me.update_view())}function u(e,t,i){var o={support_ajax_get_info:!0,mode:e};t&&(o.forced=t),i&&(o.quickinfo=i),A(document).trigger(le.GET_INFO_START,o),ke[e]=N(A(".wpo-shade-progress-message"),"images",o).fail(function(){A(document).trigger(le.GET_INFO_DONE,o),ie.show()}).always(function(){delete ke[e]})}function l(){var e=j(),t=ge.hasOwnProperty(e)?ge[e]:0;if(0!=t&&(!ye.hasOwnProperty(e)||ue.BUSY!==ye[e]&&ue.COMPLETE!==ye[e])){A("#wpo_unused_images_loader_bottom").css("visibility","visible"),ye[e]=ue.BUSY;var i={optimization_id:"images",data:{mode:de.DETECT_IMAGES,blog_id:e,length:ve,offset:t}};M("get_optimization_info",i,function(t){var i=b(t.result.meta);m(j()),i==ve?ye[e]=ue.SUCCESS:ye[e]=ue.COMPLETE,A("#wpo_unused_images_loader_bottom").css("visibility","hidden"),ce.update_view()}).fail(function(){ye[e]=ue.FAILURE,A("#wpo_unused_images_loader_bottom").css("visibility","hidden")})}}function c(){var t=j(),i=me.get_images_count(t),o=me.get_visible_images_count(t);if(!Oe.hasOwnProperty(t)||ue.BUSY!==Oe[t]&&ue.COMPLETE!==Oe[t])return Oe[t]=ue.BUSY,A("#wpo_unused_images_loader_bottom").css("visibility","visible"),0==i&&(A(".wpo_shade",H).show(),A(".wpo-shade-progress-message").html(""),be[t]=0),e("get_trash_images",{offset:o,length:ve,blog_id:t},function(e){if(A("#wpo_unused_images_loader_bottom").css("visibility","hidden"),A(".wpo_shade",H).hide(),e.errors)return void alert(e.errors.join("\n"));var i,o,s,a;for(i in e.images)e.images.hasOwnProperty(i)&&(o=e.images[i][0],a=e.images[i].length>1?[e.images[i][0]," [id:",e.images[i][1]," ]"].join(""):e.images[i][0],s=[e.base_url,e.images[i][0]].join(""),me.append_image(t,o,s,s,a,a),be.hasOwnProperty(t)||(be[t]=0),be[t]++);ze[t]=e.total,h(j()),e.images&&e.images.length===ve?Oe[t]=ue.SUCCESS:Oe[t]=ue.COMPLETE,me.update_view()})}function m(e){if(fe.hasOwnProperty(e)&&fe[e]>0){var t=wpoptimize.x_of_x_images_loaded.replace("%s",ge[e]).replace("%s",fe[e]);A("#wpo_unused_images_loaded_count").text(t)}else A("#wpo_unused_images_loaded_count").text("")}function h(e){if(ze.hasOwnProperty(e)){var t=wpoptimize.x_of_x_images_loaded.replace("%s",be[e]).replace("%s",ze[e]);A("#wpo_unused_images_trash_loaded_count").text(t)}}function w(e){return!!(e.result&&e.result.hasOwnProperty("meta")&&e.result.meta)&&e.result.meta}function g(e,t){var i=w(e);i?t&&t(i):alert(wpoptimize.error_unexpected_response)}function f(e){var t=!e.hasOwnProperty("removed_message");t&&U.text("");var i=["last_scan_",de.DETECT_IMAGES].join("");if(A(".wpo-last-scan-text",H).text(e[i]),e&&e.hasOwnProperty("unused_images")){var o,s="",a=!1,n=ae.val();t&&b(e),ae.html("");for(o in e.unused_images)e.unused_images.hasOwnProperty(o)&&(e.images_loaded_info.hasOwnProperty(o)&&(fe[o]=e.images_loaded_info[o].total),e.multisite&&(a=!0,s=[e.sites[o].domain,e.sites[o].path].join(""),ae.append(['<option value="',o,'">',s,0==e.unused_images[o].length?" ("+wpoptimize.no_unused_images+")":"","</option>"].join(""))))}e&&0===e.files&&(fe[j()]=0,ye[j()]=ue.COMPLETE),a?(se.show(),n&&ae.val(n),z(ae.val())):se.hide(),m(j())}function v(e){var t=["last_scan_",de.DETECT_SIZES].join("");A(".wpo-last-scan-text",R).text(e[t]),O(A("#registered_image_sizes"),y(e.image_sizes,"used",!0),wpoptimize.no_registered_image_sizes),O(A("#unused_image_sizes"),y(e.image_sizes,"used",!1),wpoptimize.no_unsed_image_sizes),A("#registered_image_sizes, #unused_image_sizes").on("change",'input[type="checkbox"]',function(){S()}),S()}function b(e){var t,i,o=0,s="",a="",n="",_={};for(o in e.unused_images)if(e.unused_images.hasOwnProperty(o)){e.images_loaded_info.hasOwnProperty(o)&&(fe[o]=e.images_loaded_info[o].total),s=e[["baseurl_",o].join("")],a=e[["adminurl_",o].join("")],i=0;for(t in e.unused_images[o])e.unused_images[o].hasOwnProperty(t)&&(i++,_=e.unused_images[o][t],e.multisite&&(n=[e.sites[o].domain,e.sites[o].path].join("")),k(_,s,a,o,n));ge.hasOwnProperty(o)?ge[o]+=i:ge[o]=i}return i}function z(e){ce.filter_by_site(e),me.is_visible()&&me.reload()}function y(e,t,i){var o,s=[];for(o in e)e.hasOwnProperty(o)&&e[o].hasOwnProperty(t)&&i==e[o][t]&&(s[o]=e[o]);return s}function O(e,t,i){var o,s=!0;if(e.text(""),t)for(o in t)t.hasOwnProperty(o)&&(e.append(['<label for="chk_',o,'" class="unused-image-sizes__label"><input type="checkbox" id="chk_',o,'" class="unused-image-sizes" name="',o,'">',o," (",t[o].size_formatted," - Total: ",t[o].files,")</lalbel><br>"].join("")),s=!1);s?(A(".hide_on_empty",e.parent()).hide(),e.append(["<i>",i,"</i>"].join(""))):A(".hide_on_empty",e.parent()).show()}function k(e,t,i,o,s){var a=[o,e.id?e.id:e.orig_url].join("_"),n=e.id?[i,"post.php?post=",e.id,"&action=edit"].join(""):[t,"/",e.url].join(""),_=e.id?["#",e.id].join(""):e.url,p=[t,"/",e.url].join(""),r=[t,"/",e.id&&e.url?e.url.replace(/(\-[0-9]+x[0-9]+)(\.[a-z]+)$/i,"$2"):e.url,e.id?[" [id: ",e.id,"]"].join(""):""].join("");s&&(_=[_," [",s,"]"].join("")),ce.append_image(o,a,n,p,_,r)}function E(e){ce.switch_view_mode(e),me.switch_view_mode(e)}function T(){var e=[];e=0==A("#wpo_unused_images input:not(:checked)").length&&ue.COMPLETE==ye[j()]?"all":ce.get_selected_images(),0!=e.length&&P(e)}function P(e){return A(document).trigger(le.OPTIMIZATION_START),ce.show_custom_loader(wpoptimize.deleting_selected_unused_images),M("do_optimization",{optimization_id:"images",data:{selected_images:e,images_loaded:ge}},function(t){var i,o,s,a;for(i in e)e.hasOwnProperty(i)&&(s=e[i],o=A(['#wpo_unused_images input[value="',s,'"'].join("")),a=s.split("_").shift(),ge[a]--,fe[a]--,o.closest(".wpo_unused_image").remove());A(document).trigger(le.OPTIMIZATION_DONE,t),ce.hide_loader(),ce.load_next_page_if_need()}).fail(function(){ce.hide_loader(),alert(wpoptimize.error_unexpected_response)})}function x(){var e=[];return A('#registered_image_sizes input[type="checkbox"], #unused_image_sizes input[type="checkbox"]').each(function(){var t=A(this);t.is(":checked")&&e.push(t.prop("name"))}),e}function I(){var e=x();if(!q.prop("disabled")&&e&&0!=e.length){var t=A("#registered_image_sizes"),i=A("#unused_image_sizes"),o=t.parent(),s=A(".wpo_unused_images_loader",o);d(!0),s.show(),M("do_optimization",{optimization_id:"images",data:{selected_sizes:e}},function(e){g(e,function(e){O(t,y(e.image_sizes,"used",!0),wpoptimize.no_registered_image_sizes),O(i,y(e.image_sizes,"used",!1),wpoptimize.no_used_image_sizes)}),d(!1),S(),s.hide(),alert(e.result.meta.removed_message)}).fail(function(){d(!1),S(),s.hide(),alert(wpoptimize.error_unexpected_response)})}}function S(){var e=A("#registered_image_sizes"),t=A("#unused_image_sizes");A('input[type="checkbox"]:checked',e).length+A('input[type="checkbox"]:checked',t).length>0?q.prop("disabled",!1):q.prop("disabled",!0)}function j(){return ae.length&&ae.val()?ae.val():1}function C(e){var t="";t=A("#wpo_lazy_load_settings input[type='text'], #wpo_lazy_load_settings input[type='radio']").serialize(),A.each(A("#wpo_lazy_load_settings input[type='checkbox']"),function(){var e=A(this).prop("checked")?"1":"0";t+="&"+A(this).attr("name")+"="+e}),M("save_lazy_load_settings",t,function(t){A("body").trigger("wpo_purge_cache"),e&&e(t)})}function D(e){var t=e.id,i=e.title,o=A("#wpo-popup-preview"),s=['<table id="wpo-preview-tablesorter" cellspacing="2" cellpadding="2" class="tablesorter"></table>','<h4 id="wpo-preview-message" style="display: none;"></h4>'].join(""),a=['<div id="pager" class="pager" style="display: none">','<span class="first dashicons dashicons-controls-skipback"></span>','<span class="prev dashicons dashicons-controls-back"></span>','<input type="text" class="pagedisplay">','<span class="pagedisplay-count"></span>','<span class="next dashicons dashicons-controls-forward"></span>','<span class="last dashicons dashicons-controls-skipforward"></span>','<select class="pagesize">','<option value="50">50</option>','<option value="100">100</option>','<option value="200">200</option>','<option value="300">300</option>','<option value="400">400</option>','<option value="500">500</option>',"</select>","</div>"].join(""),n="",_=[],p={};if("undefined"!=typeof wpoptimize.sites&&wpoptimize.sites.length){for(var r in wpoptimize.sites)wpoptimize.sites.hasOwnProperty(r)&&_.push(['<option value="',wpoptimize.sites[r].blog_id,'">',wpoptimize.sites[r].domain,wpoptimize.sites[r].path,"</option>"].join(""));n=['<select id="wpo-preview-site" style="display: none">',_.join(""),"</select>"].join("")}p[wpoptimize.delete_selected_items_btn]=function(){var i=[],o=A("#wpo-preview-tablesorter");if(A("input:checkbox:checked",o).each(function(){A(this).is("#wpo-select-all-preview-rows")||i.push(A(this).val())}),0!=i.length){var s=e;s.ids=i,A("#wpo-preview-site").length&&(s.site_id=A("#wpo-preview-site").val()),d.show(),wp_optimize.send_command("do_optimization",{optimization_id:t,data:s},function(e){A("#wpo-preview-tablesorter").trigger("reload"),A("#wpo-select-all-preview-rows").prop("checked",!1),M("get_optimization_info",{optimization_id:t},function(e){var i=(e&&e.result&&e.result.meta?e.result.meta:{},e&&e.result&&e.result.output?e.result.output.join("<br>"):""),o={};if(""!=i){A(["#optimization_info_",t,' input[type="checkbox"]'].join("")).each(function(){o[A(this).attr("name")]=A(this).prop("checked")}),A(["#optimization_info_",t].join("")).html(i);for(var s in o)o.hasOwnProperty(s)&&A(["#optimization_info_",t,' input[name="',s,'"]'].join("")).prop("checked",o[s])}})})}},p[wpoptimize.close_btn]=function(){A(this).dialog("destroy")},o.dialog({autoOpen:!1,title:i,minWidth:800,minHeight:400,modal:!0,close:function(){A(this).dialog("destroy"),A("#wpo-popup-preview").html("")},buttons:p}),A("#wpo-preview-tablesorter").hide(),o.html(s),A(".ui-dialog-buttonpane button").first().hide(),A(".ui-dialog-buttonpane").prepend([a,n].join("")),A(".ui-dialog-title").append(['<i id="wpo-preview-loader"><img width="12" height="12" src="',wpoptimize.spinner_src,'" /></i>'].join(""));var d=A("#wpo-preview-loader > img"),u=A("#wpo-preview-site"),l=new TableSorter_DataSource({optimization_id:t,limit:1});for(var r in e)e.hasOwnProperty(r)&&"id"!=r&&"title"!=r&&l.set_option(r,e[r]);u.length&&u.val()&&l.set_option("site_id",u.val()),u.on("change",function(){l.set_option("site_id",u.val()),A("#wpo-preview-tablesorter").trigger("reload")}),l.fetch().done(function(e){var t=A("#wpo-preview-tablesorter");try{e=wpo_parse_json(e)}catch(i){return void alert(wpoptimize.error_unexpected_response)}t.hide();var o,s=[],a=[],n=1,_={0:{sorter:!1}};s.push('<th style="width: 20px"><input id="wpo-select-all-preview-rows" type="checkbox" /></th>'),a.push("<th></th>");for(o in e.result.columns)e.result.columns.hasOwnProperty(o)&&(_[n]={sorter:!1},n++,s.push(['<th class="header">',e.result.columns[o],"</th>"].join("")),a.push(["<th>",e.result.columns[o],"</th>"].join("")));t.append(["<thead><tr>",s,"</tr></thead>"].join("")),t.append(["<tfoot><tr>",a,"</tr></tfoot>"].join("")),t.append("<tbody></tbody>");var p=A("#pager");t.tablesorter({widthFixed:!0,widgets:["zebra"],headers:_}).tablesorterPager({container:p,size:parseInt(A(".pagesize",p).val()),dataSource:l}),t.on("load_start",function(){d.show()}),t.on("load_end",function(e,t){d.hide(),parseInt(t.result.total)>0?(A("#wpo-preview-tablesorter").show(),A("#wpo-preview-message").hide(),A(".ui-dialog-buttonpane #pager").show(),A(".ui-dialog-buttonpane button").first().show()):(A("#wpo-preview-tablesorter").hide(),A("#wpo-preview-message").text(t.result.message).show(),A(".ui-dialog-buttonpane #pager").hide(),A(".ui-dialog-buttonpane button").first().hide()),A("#wpo-preview-site").show()})}),o.dialog("open")}var A=jQuery,M=WP_Optimize.send_command,N=WP_Optimize.optimization_get_info,G=WP_Optimize.take_a_backup_with_updraftplus,F=WP_Optimize.save_auto_backup_options,W=A("#wp-optimize-nav-tab-wpo_images-unused-contents"),H=A("#wpo-unused-images-section"),R=A("#wpo-unused-image-sizes-section"),U=A("#wpo_unused_images"),Z=A("#wpo_unused_images_trash"),L=A("#wpo_unused_images_view_images_btn"),B=A("#wpo_unused_images_view_trash_btn"),Q=A("#wpo_scan_for_unused_images_trash_info > a"),Y=A("#wpo_restore_unused_images_from_trash_btn"),$=A("#wpo_remove_unused_images_btn"),V=A("#wpo_move_unused_images_to_trash_btn"),X=A("#wpo_remove_unused_images_from_trash_btn"),q=A("#wpo_remove_selected_sizes_btn"),J=A("#wpo_unused_images_refresh"),K=A("#wpo_unused_image_sizes_refresh"),ee=A("#wpo_unused_images_select_all"),te=A("#wpo_unused_images_select_none"),ie=A("#wpo_scan_for_unused_images"),oe=A("#wpo_scan_for_unused_image_sizes"),se=A("#wpo_unused_images_sites_select_container"),ae=A("#wpo_unused_images_sites_select"),ne=A("#enable-auto-backup-2"),_e=A("#enable-auto-backup-3"),pe=wpoptimize.sites.length>1?[A("#wpo_unused_images_loaded_count")]:[A("#wpo_unused_images_control_panel"),A("#wpo_unused_images_loaded_count")],re=wpoptimize.sites.length>1?[A("#wpo_unused_images_trash_loaded_count")]:[A("#wpo_unused_images_control_panel"),A("#wpo_unused_images_trash_loaded_count")],de={DETECT_IMAGES:"detect_unused_images",DETECT_SIZES:"detect_images_sizes",DETECT_BOTH:"detect_both"},ue={COMPLETE:"complete",SUCCESS:"success",FAILURE:"failure",BUSY:"busy"},le={GET_INFO_START:"optimization_get_info_images_start",GET_INFO_PROCESS:"optimization_get_info_images",GET_INFO_PROCESS_XHR_UPDATE:"optimization_get_info_xhr_images",GET_INFO_DONE:"optimization_get_info_images_done",OPTIMIZATION_START:"do_optimization_images_start",OPTIMIZATION_DONE:"do_optimization_images_done"},ce=new WP_Optimize_Images_View({container:U,no_images_found_message:wpoptimize.no_unused_images_found,related_elements:[A(".wpo-last-scan-info",H),A(".wpo-unused-images-el"),A(".wpo-image-sizes-section"),A("#wpo_unused_images_loaded_count"),A("#wpo_unused_images_refresh")],row_action_buttons:[{"class":"wpo_unused_images_move_to_trash_single button button-primary",title:wpoptimize.trash,hint:wpoptimize.move_to_trash},{"class":"wpo_unused_images_remove_single button button-link button-link-delete",title:wpoptimize["delete"],hint:wpoptimize.permanently_delete}],action_buttons:[$,V],hide_when_empty:pe,loader_additional_html:'<a class="wpo-unused-images-cancel-scan" data-mode="'+de.DETECT_IMAGES+'">'+wpoptimize.cancel_scan+"</a>",load_next_page_callback:l}),me=new WP_Optimize_Images_View({container:Z,no_images_found_message:wpoptimize.no_unused_trash_images_found,related_elements:[A(".wpo-unused-images-trash-el"),A("#wpo_unused_images_trash_loaded_count")],row_action_buttons:[{"class":"wpo_unused_images_restore_from_trash_single button",title:wpoptimize.restore,hint:wpoptimize.restore_from_trash},{"class":"wpo_unused_images_remove_single_from_trash button button-primary",title:wpoptimize["delete"],hint:wpoptimize.permanently_delete}],action_buttons:[Y,X],hide_when_empty:re,load_next_page_callback:c,onclear:function(){Oe[j()]=""}}),he=!1,we=!1,ge={},fe={},ve=parseInt(wpoptimize.unused_images_per_page),be={},ze={},ye={},Oe={},ke={};ie.on("click",function(){u(de.DETECT_IMAGES,!0)}),oe.on("click",function(){u(de.DETECT_SIZES,!0)}),W.on("click",".wpo-unused-images-cancel-scan",function(){var e=A(this),t=e.data("mode"),i={mode:t,cancel:!0},o={optimization_id:"images",data:i};e.prop("disabled")||(e.prop("disabled",!0),s(t),M("get_optimization_info",o,function(e){A(document).trigger(le.GET_INFO_DONE,o)}).always(function(){e.prop("disabled",!1)}))}),B.on("click",function(){return!A(this).prop("disabled")&&(B.hide(),L.show(),B.data("dirty")&&(B.data("dirty",!1),me.clear()),ce.hide(),me.show(),W.addClass("wpo-unused-images-trash-view"),!1)}),L.on("click",function(){return!A(this).prop("disabled")&&(L.hide(),B.show(),me.hide(),ce.show(),W.removeClass("wpo-unused-images-trash-view"),L.data("before-scan")&&(jQuery(".wpo-unused-images-section-loaded").addClass("wpo_hidden"),jQuery(".wpo-unused-images-section-unloaded").show(),L.data("before-scan",!1)),L.data("dirty")&&(L.data("dirty",!1),r(!1)),!1)}),Q.on("click",function(){jQuery(".wpo-unused-images-section-unloaded").hide(),jQuery(".wpo-unused-images-section-loaded").removeClass("wpo_hidden"),B.trigger("click"),L.data("before-scan",!0)}),A(document).on(le.GET_INFO_START,function(e,t){var i=t&&t.hasOwnProperty("mode")?t.mode:"";J.prop("disabled",!0),i==de.DETECT_IMAGES&&(A(".wpo_shade",H).show(),A(".wpo-shade-progress-message",H).text("")),i==de.DETECT_SIZES&&(A(".wpo_shade",R).show(),A(".wpo_unused_images_loader",R).show(),A(".wpo-shade-progress-message",R).text("")),d(!0)}),A(document).on(le.GET_INFO_PROCESS,function(e,t,i){var o=i&&i.hasOwnProperty("mode")?i.mode:"";o==de.DETECT_IMAGES&&(A(".wpo-shade-progress-message",H).text(t),ce.loader_message(t)),o==de.DETECT_IMAGES&&A(".wpo-shade-progress-message",R).text(t)}),A(document).on(le.GET_INFO_PROCESS_XHR_UPDATE,function(e,t,i){i.hasOwnProperty("mode")&&(ke[i.mode]=t)}),A(document).on(le.GET_INFO_DONE,function(e,t){A("#wpo_unused_images_shade").remove(),A(".wpo_unused_images_loader").hide(),J.prop("disabled",!1);var i=w(t),o=i&&i.hasOwnProperty("mode")?i.mode:!!(t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("mode"))&&t.data.mode,s=t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("cancel")||o&&ke.hasOwnProperty(o)&&ke[o].hasOwnProperty("statusText")&&"abort"==ke[o].statusText;if(de.DETECT_IMAGES==o&&(A(".wpo_shade",H).hide(),ce.hide_loader(),s||(A(".wpo-unused-images-section-unloaded").hide(),A(".wpo-unused-images-section-loaded").removeClass("wpo_hidden"),g(t,f))),de.DETECT_SIZES==o&&(A(".wpo_shade",R).hide(),s||(A(".wpo-unused-image-sizes-section-unloaded").hide(),A(".wpo-unused-image-sizes-section-loaded").removeClass("wpo_hidden"),g(t,v))),de.DETECT_BOTH==o){var a=["last_scan_",de.DETECT_IMAGES].join(""),n=["last_scan_",de.DETECT_SIZES].join("");i&&i[a]?(A(".wpo-unused-images-section-unloaded").hide(),A(".wpo-unused-images-section-loaded").removeClass("wpo_hidden"),A(".wpo_shade",H).hide(),g(t,f)):i.hasOwnProperty("trash_images_count")&&i.trash_images_count>0&&(A("#wpo_scan_for_unused_images_trash_info > span").text(i.trash_images_count_message),A("#wpo_scan_for_unused_images_trash_info").css("display","block")),i&&i[n]&&(A(".wpo-unused-image-sizes-section-unloaded").hide(),A(".wpo-unused-image-sizes-section-loaded").removeClass("wpo_hidden"),A(".wpo_shade",R).hide(),g(t,v))}d(!1)}),A(document).on(le.OPTIMIZATION_START,function(){he=!0,A(".wpo_unused_images_loader").show(),d(!0)}),A(document).on(le.OPTIMIZATION_DONE,function(e,t){A(".wpo_unused_images_loader").hide(),d(!1),g(t,f),alert(t.result.meta.removed_message)}),$.on("click",function(){0!=A('#wpo_unused_images input[type="checkbox"]:checked').length&&(F(),ne.is(":checked")?G(T,"uploads"):T())}),V.on("click",function(){0!=A('#wpo_unused_images input[type="checkbox"]:checked').length&&(F(),ne.is(":checked")?G(a,"uploads"):a())}),X.on("click",function(){0!=me.get_selected_images().length&&(F(),ne.is(":checked")?G(n,"uploads"):n())}),Y.on("click",function(){0!=me.get_selected_images().length&&(F(),ne.is(":checked")?G(_,"uploads"):_())}),q.on("click",function(){F(),_e.is(":checked")?G(I):I()}),J.on("click",function(e){e.preventDefault(),A(this).prop("disabled")||r(!0)}),K.on("click",function(e){if(e.preventDefault(),!A(this).prop("disabled")){var t={support_ajax_get_info:!0,forced:!0,mode:de.DETECT_SIZES};A(".wpo_unused_images_loader",R).show(),A(document).trigger(le.GET_INFO_START,t),N(A(".wpo-shade-progress-message"),"images",t).fail(function(){A(document).trigger(le.GET_INFO_DONE,t)})}}),ee.on("click",function(){ce.is_visible()&&ce.select_all(),me.is_visible()&&me.select_all()}),te.on("click",function(){ce.is_visible()&&ce.select_none(),me.is_visible()&&me.select_none()}),A("#wp-optimize-nav-tab-wrapper__wpo_images .nav-tab").on("click",function(){t("wpo_images-unused")&&o()}),t("wpo_images-unused")&&o(),ae.on("change",function(){var e=j();z(e),m(e)}),A(".wpo_unused_images_switch_view a").on("click",function(){E(A(this).data("mode"))}),U.on("click",".wpo_unused_images_remove_single",function(){var e=A(this),t=e.closest(".wpo_unused_image"),i=A('input[type="checkbox"]',t).attr("value");A("button",t).prop("disabled",!0),P([i]).done(function(){t.remove()})}),U.on("click",".wpo_unused_images_move_to_trash_single",function(){var e=A(this),t=e.closest(".wpo_unused_image"),i=A('input[type="checkbox"]',t).attr("value");A("button",t).prop("disabled",!0),a([i]).done(function(){t.remove()})}),Z.on("click",".wpo_unused_images_restore_from_trash_single",function(){var e=A(this),t=e.closest(".wpo_unused_image"),i=A('input[type="checkbox"]',t).attr("value");A("button",t).prop("disabled",!0),_([i],t).done(function(){t.remove()})}),Z.on("click",".wpo_unused_images_remove_single_from_trash",function(){var e=A(this),t=e.closest(".wpo_unused_image"),i=A('input[type="checkbox"]',t).attr("value");A("button",t).prop("disabled",!0),n([i],t).done(function(){t.remove()})}),A("#wpo_lazy_load_settings").on("click",".wp-optimize-settings-save",function(){var e=A(this),t=e.next(".wpo_spinner"),i=t.next(".dashicons-yes");t.show(),C(function(){t.hide(),i.removeClass("display-none").show().delay(5e3).fadeOut("fast",function(){i.addClass("display-none")})})}),A("body").append('<div id="wpo-popup-preview"></div>'),A("#wp-optimize-nav-tab-WP-Optimize-optimize-contents").on("click","#remove_all_transients",function(){var e=A(this).closest("td"),t=A(this).is(":checked");A("a",e).each(function(){A(this).data("remove_all_transients",t)})}),A("#wp-optimize-nav-tab-WP-Optimize-optimize-contents").on("click",".wpo-optimization-preview",function(){return D(A(this).data()),!1}),A("#wpo-popup-preview").on("change","#wpo-select-all-preview-rows",function(){var e=A(this).closest("table"),t=A(this).prop("checked");A("input:checkbox",e).each(function(){A(this).is("#wpo-select-all-preview-rows")||A(this).prop("checked",t)})}),A("#remove_all_transients").on("change",function(){var e=A(this).closest("td"),t=A(this).is(":checked");A("a",e).each(function(){A(this).data("remove_all_transients",t)})});var Ee=A("#wpo_always_purge_table"),Te=A("#wpo_always_purge_post_types_select"),Pe=A("#wpo_always_purge_post_id_select");A("#wpo_add_always_purge_btn").on("click",function(){var e=A(this),t=e.closest("tr"),i=A("#wpo_always_purge_post_types_select",t),o=i.val(),s=A("#wpo_always_purge_post_id_select",t),a=s.val(),n=A(['option[value="',a,'"]'].join("")).text(),_=!0,p=[];A("#wpo_always_purge_post_types_select",t).find(":selected").each(function(){p.push(A(this).text())});var r=['<tr><td><input type="hidden" class="cache-settings-array" name="always_purge_post_type" value="',o.join(","),'">',p.join(", "),'</td><td><input type="hidden" class="cache-settings-array" name="always_purge_post_id" value="',a,'">',n,'</td><td><a class="wpo-always-purge-delete wpo-delete" href="javascript: ;">',wpoptimize["delete"],"</a></td></tr>"].join("");0==o.length&&(_=!1,A(".select2-selection",i.next()).addClass("wpo_error_field")),a||(_=!1,A(".select2-selection",s.next()).addClass("wpo_error_field")),_&&(A(".select2-selection",i.next()).removeClass("wpo_error_field"),A(".select2-selection",s.next()).removeClass("wpo_error_field"),i.val(null).trigger("change"),s.val(null).trigger("change"),t.before(r))}),Ee.on("click",".wpo-always-purge-delete",function(){var e=A(this),t=e.closest("tr");t.remove()}),Te.select2(),Pe.select2({ajax:{url:ajaxurl,type:"post",dataType:"json",data:function(e){var t={action:"wp_optimize_ajax",subaction:"get_posts_list",nonce:wp_optimize_send_command_data.nonce,data:{search:e.term,page:e.page||1}};return t}}});var xe=A("#enable_per_role_cache"),Ie=A("#wpo_per_role_cache_roles_list");xe.on("change",function(){xe.prop("checked")?Ie.removeClass("wpo_hidden"):Ie.addClass("wpo_hidden")})};jQuery(function(e){function t(e,t){var i="";switch(e){case"wpo_once":i=WP_Optimize_Handlebars.once.handlebars({details:t});break;case"wpo_daily":i=WP_Optimize_Handlebars.daily.handlebars({details:t});break;case"wpo_weekly":i=WP_Optimize_Handlebars.weekly.handlebars({details:t});break;case"wpo_fortnightly":i=WP_Optimize_Handlebars.fortnightly.handlebars({details:t});break;case"wpo_monthly":i=WP_Optimize_Handlebars.monthly.handlebars({details:t})}return i}function i(){e(".wpo_auto_optimizations").select2({placeholder:wpoptimize.select_optimizations}),e(".wpo_auto_optimizations").on("select2:opening select2:closing",function(t){var i=e(this).parent().find(".select2-search__field");i.prop("disabled",!0)})}function o(){0===e(".wpo_scheduled_event:visible").length?(e(".wpo_auto_event_heading_container").hide(),e(".wpo_no_schedules").show()):(e(".wpo_auto_event_heading_container").show(),e(".wpo_no_schedules").hide()),0!==e(".wpo_scheduled_event:visible").length||0!==e(".wpo_auto_event:visible").length||e("#save_settings_reminder").is(":visible")?e(".wpo_no_schedules").hide():e(".wpo_no_schedules").show()}function s(e){return month=""+(e.getMonth()+1),day=""+e.getDate(),year=e.getFullYear(),month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),[year,month,day].join("-")}var a=e("#wp-optimize-auto-options"),n=e("#database_settings_form"),_=e('input[type="time"]'),p=e('input[type="date"]'),r=((new Date).toISOString().split("T")[0],e(".wpo_auto_event:last").data("count")||0);_.each(function(t,i){Modernizr.inputtypes.time||(e(i).timepicker({timeFormat:"H:i"}),e(i).addClass("no_date_time_support"),e(i).on("changeTime",function(){e(this).timepicker("hide")}))}),a.on("focus",'input[type="time"]',function(){var t=e(this).get(0);Modernizr.inputtypes.time||(e(t).timepicker({timeFormat:"H:i"}),e(t).on("changeTime",function(){e(this).timepicker("hide")}))}),a.on("keypress","input",function(e){if(13===e.keyCode)return!1}),p.each(function(t,i){Modernizr.inputtypes.date||(e(i).datepicker({dateFormat:"yy-mm-dd",minDate:0}),e(i).addClass("no_date_time_support"))}),a.on("focus",'input[type="date"]',function(){var t=e(this).get(0);Modernizr.inputtypes.date||e(t).datepicker({dateFormat:"yy-mm-dd",minDate:0})}),0!==e(".wpo_scheduled_event").length?e(".wpo_no_schedules").hide():e(".wpo_no_schedules").show(),e(".wpo_auto_optimizations").select2({placeholder:wpoptimize.select_optimizations}),e(".wpo_auto_optimizations").on("select2:opening select2:closing",function(t){var i=e(this).parent().find(".select2-search__field");i.prop("disabled",!0)}),e("#purge_cache_permissions").select2({placeholder:wpoptimize.select_roles}),a.on("change",'select, input[type="date"], input[type="time"]',function(){e("#save_settings_reminder").slideDown(),o()}),n.on("click","#wpo-add-event",function(t){t.preventDefault(),r++;var i=WP_Optimize_Handlebars.optimizations.handlebars({optimizations:wpoptimize.auto_optimizations,count:r}),o=WP_Optimize_Handlebars.schedule_types.handlebars({schedule_types:wpoptimize.schedule_types,count:r}),s=wpoptimize.add_schedule_new,a=wpoptimize.add_schedule_cancel,n=WP_Optimize_Handlebars.action.handlebars({count:r,add_schedule_new:s,add_schedule_cancel:a}),_='<div class="wpo_auto_event wpo_cf" data-count="'+r+'">';_+=i+o+n,_+="</div>",e("#wpo_auto_events").append(_),e(".wpo_auto_optimizations").select2({placeholder:wpoptimize.select_optimizations}),e(".wpo_auto_optimizations").on("select2:opening select2:closing",function(t){var i=e(this).parent().find(".select2-search__field");i.prop("disabled",!0)})}),n.on("change",".wpo_schedule_type",function(){var i=e(this).closest(".wpo_auto_event"),o=wpoptimize.add_schedule_new,a=wpoptimize.add_schedule_cancel,n=i.data("count")||r,_=e(this).val(),p="";Modernizr.inputtypes.date&&Modernizr.inputtypes.time||(p="no_date_time_support");var d=new Date,u=s(d),l={date:wpoptimize.date,time:wpoptimize.time,day:wpoptimize.day,day_number:wpoptimize.day_number,days:wpoptimize.days,date_value:u,time_value:"00:00",status:wpoptimize.active,status_value:"checked",week_days:wpoptimize.week_days,week:wpoptimize.week,count:n,class_name:p,today:d},c=t(_,l),m=WP_Optimize_Handlebars.status.handlebars({details:l}),h=WP_Optimize_Handlebars.action.handlebars({add_schedule_new:o,add_schedule_cancel:a});e(this).next().html(""),i.find(".wpo_event_status").remove(),i.find(".wpo_event_actions").remove(),""!==c&&e(this).next().html(c),i.append(m+h)}),n.on("click","#wp-optimize-auto-options .wpo_edit_event",function(){var t=e(this).closest(".wpo_scheduled_event");t.hide(),t.next().show(),o(),i()}),n.on("click",".wpo_remove_event",function(){var t=e(this).data("count"),i=confirm(wpoptimize.confirm_remove_task);if(!0===i){var s=e(this).closest(".wpo_scheduled_event"),a=e(this).closest(".wpo_auto_event");t==s.next().data("count")&&(s.next().remove(),s.remove()),t==a.prev().data("count")&&a.prev().remove(),a.remove(),setTimeout(function(){e("#wp-optimize-save-database-settings").trigger("click")},500),o()}}),n.on("click","#wp-optimize-auto-options .wpo_cancel_event",function(){var t=e(this).closest(".wpo_auto_event");t.hide(),t.prev().show()}),e("#database_settings_form").on("wpo-saving-form-data",function(t){var i=!0,s=e("#database_settings_form");s.find(".wpo_auto_optimizations").each(function(){var t=e(this).val();Array.isArray(t)&&0===t.length&&(i=!1)}),s.find(".wpo_schedule_type").each(function(){e(this).val()||(i=!1)}),s.find(".wpo_schedule_fields input").each(function(){var t=e(this).val(),o=e(this)[0].type;switch(o){case"date":var s=t.split("-"),a=parseInt(s[2]),n=parseInt(s[1])-1,_=parseInt(s[0]),p=new Date(_,n,a);p instanceof Date&&isNaN(p)&&(i=!1);break;case"time":var r=/^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/;r.test(t)||(i=!1)}}),!1===i?(s.form_errors.add("missing-fields",""),t.stopImmediatePropagation(),s.find(".wp-optimize-settings-save-results").show().addClass("wpo_alert_notice").text(wpoptimize.fill_all_fields).delay(5e3).fadeOut(3e3,function(){e(this).removeClass("wpo_alert_notice")})):s.form_errors.remove("missing-fields"),e("#save_settings_reminder").slideUp("normal",function(){o()})})});