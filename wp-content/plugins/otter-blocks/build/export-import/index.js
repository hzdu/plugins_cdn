!function(){"use strict";var e={n:function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,{a:o}),o},d:function(t,o){for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.i18n,o=window.wp.blocks,r=window.wp.plugins,n=window.wp.element,l=window.wp.primitives,c=(0,n.createElement)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,n.createElement)(l.Path,{d:"M18.2 17c0 .7-.6 1.2-1.2 1.2H7c-.7 0-1.2-.6-1.2-1.2V7c0-.7.6-1.2 1.2-1.2h3.2V4.2H7C5.5 4.2 4.2 5.5 4.2 7v10c0 1.5 1.2 2.8 2.8 2.8h10c1.5 0 2.8-1.2 2.8-2.8v-3.6h-1.5V17zM14.9 3v1.5h3.7l-6.4 6.4 1.1 1.1 6.4-6.4v3.7h1.5V3h-6.3z"})),i=window.lodash,s=window.wp.apiFetch,a=e.n(s),p=window.wp.data,d=window.wp.editPost,w=window.wp.components,u=window.wp.blockEditor,m=(0,w.withNotices)((e=>{let{clientId:r,attributes:l,noticeOperations:c,noticeUI:i}=e;(0,n.useEffect)((()=>{l.file&&b(l.file)}),[]);const[s,d]=(0,n.useState)(!1),{replaceBlocks:m}=(0,p.useDispatch)("core/block-editor"),b=e=>{d(!0);const l=e[0];if("application/json"!==l.type){const e=[(0,n.createElement)("strong",{key:"filename"},l.name),": ",(0,t.__)("Sorry, only JSON files are supported here.","otter-blocks")];return c.removeAllNotices(),c.createErrorNotice(e),void d(!1)}const i=new FileReader;i.onload=async()=>{let e;try{e=JSON.parse(i.result)}catch(e){return c.removeAllNotices(),c.createErrorNotice((0,t.__)("Invalid JSON file","otter-blocks")),void d(!1)}if(e.__file&&e.content&&"wp_export"===e.__file&&(e=(0,o.parse)(e.content)),e.__file&&e.content&&"wp_block"===e.__file){const r=await a()({path:"/wp/v2/types/wp_block"}),n=await a()({path:`/wp/v2/${r.rest_base}`,data:{title:e.title||(0,t.__)("Untitled Reusable Block","otter-blocks"),content:e.content,status:"publish"},method:"POST"});if(!n.id)return c.removeAllNotices(),c.createErrorNotice((0,t.__)("Invalid Reusable Block JSON file","otter-blocks")),void d(!1);e=`\x3c!-- wp:block { "ref": ${n.id} } /--\x3e`,e=(0,o.parse)(e)}m(r,e),d(!1)},i.readAsText(l)},_=(0,u.useBlockProps)();return s?(0,n.createElement)("div",_,(0,n.createElement)(w.Placeholder,null,(0,n.createElement)(w.Spinner,null))):(0,n.createElement)("div",_,(0,n.createElement)(w.Placeholder,{label:(0,t.__)("Import Blocks from JSON","otter-blocks"),instructions:(0,t.__)("Upload JSON file from your device.","otter-blocks"),icon:"category",notices:i},(0,n.createElement)(w.FormFileUpload,{accept:"text/json",onChange:e=>b(e.target.files),isSecondary:!0},(0,t.__)("Upload")),(0,n.createElement)(w.DropZone,{label:(0,t.__)("Import from JSON","otter-blocks"),onFilesDrop:b})))}));(0,o.registerBlockType)("themeisle-blocks/importer",{apiVersion:2,title:(0,t.__)("Import Blocks from JSON","otter-blocks"),description:(0,t.__)("Allows you import blocks from a JSON file.","blocks-export-import"),icon:"category",category:"widgets",keywords:[(0,t.__)("JSON","otter-blocks"),(0,t.__)("Importer","otter-blocks"),(0,t.__)("Import","blocks-export-import")],attributes:{file:{type:"object"}},transforms:{from:[{type:"files",isMatch:e=>"application/json"===e[0].type,transform:e=>(0,o.createBlock)("themeisle-blocks/importer",{file:e})}]},edit:m,save:()=>null}),(0,r.registerPlugin)("blocks-export-import",{render:()=>{var e,r;const l=null===(e=window)||void 0===e||null===(r=e.otterComponents)||void 0===r?void 0:r.OtterControlTools,{blocks:s,count:u}=(0,p.useSelect)((e=>{const{getSelectedBlockCount:t,getSelectedBlock:o,getMultiSelectedBlocks:r}=e("core/block-editor");return{blocks:1===t()?o():r(),count:t()}}),[]),{createNotice:m}=(0,p.useDispatch)("core/notices"),b=async()=>{if(!s)return;let e,r;if(1===u&&"core/block"===s.name){const t=s.attributes.ref,o=await a()({path:"/wp/v2/types/wp_block"});let n;try{n=await a()({path:`/wp/v2/${o.rest_base}/${t}?context=edit`})}catch(e){return void(e.message&&m("error",e.message,{type:"snackbar"}))}const l=n.title.raw,c=n.content.raw;r=(0,i.kebabCase)(l)+".json",e={__file:"wp_block",title:l,content:c}}else r="blocks-export.json",e={__file:"wp_export",version:2,content:(0,o.serialize)(s)};const n=JSON.stringify({...e},null,2);m("success",(0,t.__)("Blocks exported.","otter-blocks"),{type:"snackbar"}),((e,t,o)=>{const r=new window.Blob([t],{type:"application/json"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(r,e);else{const t=document.createElement("a");t.href=URL.createObjectURL(r),t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}})(r,n)};return(0,n.createElement)(n.Fragment,null,void 0===l&&(0,n.createElement)(d.PluginBlockSettingsMenuItem,{icon:c,label:(0,t.__)("Export as JSON","otter-blocks"),onClick:b}),void 0!==l&&(0,n.createElement)(l,{order:3},(0,n.createElement)(w.MenuGroup,null,(0,n.createElement)(w.MenuItem,{icon:c,onClick:b},(0,t.__)("Export as JSON","otter-blocks")))))}})}();