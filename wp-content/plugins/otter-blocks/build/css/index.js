!function(){"use strict";var e=window.wp.element,t=window.lodash,s=window.wp.i18n,r=window.wp.blocks,n=window.wp.blockEditor,c=window.wp.components,l=window.wp.compose,o=window.wp.data,u=window.wp.hooks,i=(0,e.memo)((t=>{let{attributes:r,setAttributes:n,clientId:c}=t;(0,e.useEffect)((()=>{if(r.customCSS){if(r.className){const e=r.className;e.includes("ticss-")&&(i.current=e.split(" "),i.current=i.current.find((e=>e.includes("ticss"))))}const e=new RegExp("."+i.current,"g"),t=r.customCSS.replace(e,"selector");u.current=t}else u.current="selector {\n}\n";o.current=wp.CodeMirror(document.getElementById("otter-css-editor"),{value:u.current,autoCloseBrackets:!0,continueComments:!0,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,lint:!0,gutters:["CodeMirror-lint-markers"],styleActiveLine:!0,styleActiveSelected:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-F":"findPersistent","Cmd-F":"findPersistent"}}),o.current.on("change",(()=>{const e=new RegExp("selector","g"),t=o.current.getValue().replace(e,`.${i.current}`);if(u.current=t,"selector {\n}\n".replace(/\s+/g,"")===u.current.replace(/\s+/g,""))return n({customCSS:null});n({customCSS:u.current})}))}),[]),(0,e.useEffect)((()=>{let e=l();n({hasCustomCSS:!0,className:e})}),[r]);const l=()=>{let e;const t=c.substr(0,8);return null!==u.current&&"selector {\n}\n".replace(/\s+/g,"")===u.current.replace(/\s+/g,"")?r.className:(r.className?(e=r.className,e.includes("ticss-")||(e=e.split(" "),e.push(`ticss-${t}`),e=e.join(" ")),i.current=e.split(" "),i.current=i.current.find((e=>e.includes("ticss")))):(e=`ticss-${t}`,i.current=e),e)},o=(0,e.useRef)(null),u=(0,e.useRef)(null),i=(0,e.useRef)(null);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,s.__)("Add your custom CSS.","otter-blocks")),(0,e.createElement)("div",{id:"otter-css-editor",className:"otter-css-editor"}),(0,e.createElement)("p",null,(0,s.__)("Use","otter-blocks")," ",(0,e.createElement)("code",null,"selector")," ",(0,s.__)("to target block wrapper.","otter-blocks")),(0,e.createElement)("br",null),(0,e.createElement)("p",null,(0,s.__)("Example:","otter-blocks")),(0,e.createElement)("pre",{className:"otter-css-editor-help"},"selector {\n    background: #000;\n}\n\nselector img {\n    border-radius: 100%;\n}"),(0,e.createElement)("p",null,(0,s.__)("You can also use other CSS syntax here, such as media queries.","otter-blocks")))}));let a=[];(0,o.subscribe)((()=>{const{getBlocks:e}=(0,o.select)("core/block-editor"),s=e(),n=(0,o.select)("core").getEntityRecords("postType","wp_block");if(!(0,t.isEqual)(a,s)){a=s;const e=((e,s)=>{if(!e)return"";const n=e=>{const t=[];if("core/block"===e.name&&null!==s){const c=s.find((t=>e.attributes.ref===t.id));if(c&&c.content){const e=c.content.hasOwnProperty("raw")?c.content.raw:c.content;t.push((0,r.parse)(e).map((e=>[e,n(e)])))}}return void 0!==e.innerBlocks&&0<e.innerBlocks.length&&t.push(e.innerBlocks.map((e=>[e,n(e)]))),t},c=e.map((e=>[e,n(e)]));return(0,t.flattenDeep)(c).map((e=>e.attributes&&e.attributes.hasCustomCSS&&e.attributes.customCSS&&null!==e.attributes.customCSS?e.attributes.customCSS+"\n":"")).reduce(((e,t)=>e+t),"")})(s,n);e&&(e=>{let t=document.getElementById("otter-css-editor-styles");null===t&&(t=document.createElement("style"),t.setAttribute("type","text/css"),t.setAttribute("id","otter-css-editor-styles"),document.getElementsByTagName("head")[0].appendChild(t)),t.textContent===e||(t.textContent=e)})(e)}}));const m=(0,l.createHigherOrderComponent)((t=>l=>(0,r.hasBlockSupport)(l.name,"customClassName",!0)&&l.isSelected?(0,e.createElement)(e.Fragment,null,(0,e.createElement)(t,l),(0,e.createElement)(n.InspectorControls,null,(0,e.createElement)(c.PanelBody,{title:(0,s.__)("Custom CSS","otter-blocks"),initialOpen:!1},(0,e.createElement)(i,{clientId:l.clientId,setAttributes:l.setAttributes,attributes:l.attributes}),(0,u.applyFilters)("otter.poweredBy","")))):(0,e.createElement)(t,l)),"withInspectorControl");(0,o.select)("core/edit-site")||((0,u.addFilter)("blocks.registerBlockType","themeisle-custom-css/attribute",(e=>((0,r.hasBlockSupport)(e,"customClassName",!0)&&(e.attributes=(0,t.assign)(e.attributes,{hasCustomCSS:{type:"boolean",default:!1},customCSS:{type:"string",default:null}})),e))),(0,u.addFilter)("editor.BlockEdit","themeisle-custom-css/with-inspector-controls",m))}();