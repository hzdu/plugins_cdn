import{j as l,k as h,m as o,n as p,o as g,T as f,p as n,l as c,D as P}from"./index-9200cb9a.js";import{H as k}from"./vidstack-db4cc3e9-5343399f.js";class T{constructor(t,e){this._=t,this.Lg=e,t.textTracks.onaddtrack=this.ea.bind(this),g(this.pg.bind(this))}ea(t){const e=t.track;if(!e||v(this._,e))return;const i=new f({id:e.id,kind:e.kind,label:e.label,language:e.language,type:"vtt"});i[n.va]={track:e},i[n.na]=2,i[n.ha]=!0;let s=0;const u=d=>{if(e.cues)for(let a=s;a<e.cues.length;a++)i.addCue(e.cues[a],d),s++};u(t),e.oncuechange=u,this.Lg.textTracks.add(i,t),i.setMode(e.mode,t)}pg(){var t;this._.textTracks.onaddtrack=null;for(const e of this.Lg.textTracks){const i=(t=e[n.va])==null?void 0:t.track;i!=null&&i.oncuechange&&(i.oncuechange=null)}}}function v(r,t){return Array.from(r.children).find(e=>e.track===t)}class _{constructor(t,e){this.R=(i,s)=>{this.u.delegate.t("picture-in-picture-change",{detail:i,trigger:s})},this._=t,this.u=e,c(this._,"enterpictureinpicture",this.Sg.bind(this)),c(this._,"leavepictureinpicture",this.Tg.bind(this))}get active(){return document.pictureInPictureElement===this._}get supported(){return o(this._)}async enter(){return this._.requestPictureInPicture()}exit(){return document.exitPictureInPicture()}Sg(t){this.R(!0,t)}Tg(t){this.R(!1,t)}}class m{constructor(t,e){this.ra="inline",this._=t,this.u=e,c(this._,"webkitpresentationmodechanged",this.Ca.bind(this))}get Wg(){return h(this._)}async Vg(t){this.ra!==t&&this._.webkitSetPresentationMode(t)}Ca(){var e;const t=this.ra;this.ra=this._.webkitPresentationMode,(e=this.u.player)==null||e.dispatch(new P("video-presentation-change",{detail:this.ra,trigger:event})),["fullscreen","picture-in-picture"].forEach(i=>{(this.ra===i||t===i)&&this.u.delegate.t(`${i}-change`,{detail:this.ra===i,trigger:event})})}}class x{constructor(t){this.Ug=t}get active(){return this.Ug.ra==="fullscreen"}get supported(){return this.Ug.Wg}async enter(){this.Ug.Vg("fullscreen")}async exit(){this.Ug.Vg("inline")}}class U{constructor(t){this.Ug=t}get active(){return this.Ug.ra==="picture-in-picture"}get supported(){return this.Ug.Wg}async enter(){this.Ug.Vg("picture-in-picture")}async exit(){this.Ug.Vg("inline")}}class I extends k{constructor(t,e){super(t),this.$$PROVIDER_TYPE="VIDEO",l(()=>{if(h(t)){const i=new m(t,e);this.fullscreen=new x(i),this.pictureInPicture=new U(i)}else o(t)&&(this.pictureInPicture=new _(t,e))},this.scope)}get type(){return"video"}setup(t){super.setup(t),p(this.video)&&new T(this.video,t),t.textRenderers.C(this.video),g(()=>{t.textRenderers.C(null)}),this.type==="video"&&t.delegate.t("provider-setup",{detail:this})}get video(){return this.u}}export{I as VideoProvider};
