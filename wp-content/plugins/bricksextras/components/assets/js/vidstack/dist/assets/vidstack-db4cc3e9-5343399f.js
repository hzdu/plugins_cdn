import{i as g,a as c,c as l,o as n,s as o,b as f,d as m,u as b,e as p,l as a,I as w,f as y,g as u,D as d,h as k,L as r}from"./index-9200cb9a.js";class T{constructor(t){this.cg=t}Cb(){g(this.Xb)&&this.Ej()}Db(){c(this.Xb)&&window.cancelAnimationFrame(this.Xb),this.Xb=void 0}Ej(){this.Xb=window.requestAnimationFrame(()=>{g(this.Xb)||(this.cg(),this.Ej())})}}class M{constructor(t,i){this.Mf=b(),this.fg=!1,this.hg=!1,this.ig=!1,this.gg=new T(this.mg.bind(this)),this.lg=void 0,this.Gg=void 0,this.bb=t,this.Pf=i,this.ng(),p(this.og.bind(this)),n(this.pg.bind(this))}get u(){return this.bb.media}get wc(){return this.Pf.delegate}pg(){this.hg=!1,this.ig=!1,this.gg.Db(),this.Mf.empty()}mg(){const t=this.bb.currentTime;this.Pf.$state.currentTime()!==t&&this.eg(t)}ng(){this.dg("loadstart",this.jf),this.dg("abort",this.kg),this.dg("emptied",this.qg),this.dg("error",this.Qc)}rg(){this.hg||(this.Mf.add(this.dg("loadeddata",this.sg),this.dg("loadedmetadata",this.tg),this.dg("canplay",this.Jc),this.dg("canplaythrough",this.ug),this.dg("durationchange",this.vg),this.dg("play",this.T),this.dg("progress",this.wg),this.dg("stalled",this.xg),this.dg("suspend",this.yg)),this.hg=!0)}zg(){this.ig||(this.Mf.add(this.dg("pause",this.U),this.dg("playing",this.Ag),this.dg("ratechange",this.Bg),this.dg("seeked",this.Cg),this.dg("seeking",this.Dg),this.dg("ended",this.Eg),this.dg("volumechange",this.Xc),this.dg("waiting",this.Fg)),this.ig=!0)}dg(t,i){return a(this.u,t,i.bind(this))}Hg(t){}eg(t,i){this.wc.t("time-update",{detail:{currentTime:Math.min(t,this.Pf.$state.seekableEnd()),played:this.u.played},trigger:i})}jf(t){if(this.u.networkState===3){this.kg(t);return}this.rg(),this.wc.t("load-start",{trigger:t})}kg(t){this.wc.t("abort",{trigger:t})}qg(){this.wc.t("emptied",{trigger:event})}sg(t){this.wc.t("loaded-data",{trigger:t})}tg(t){this.zg(),this.wc.t("volume-change",{detail:{volume:this.u.volume,muted:this.u.muted}}),this.wc.t("loaded-metadata",{trigger:t}),w&&y(this.Pf.$state.source())&&this.wc.Ig(this.jg(),t)}jg(){return{duration:this.u.duration,buffered:this.u.buffered,seekable:this.u.seekable}}T(t){this.Pf.$state.canPlay&&this.wc.t("play",{trigger:t})}U(t){this.u.readyState===1&&!this.fg||(this.fg=!1,this.gg.Db(),this.wc.t("pause",{trigger:t}))}Jc(t){this.wc.Ig(this.jg(),t)}ug(t){this.Pf.$state.started()||this.wc.t("can-play-through",{trigger:t,detail:this.jg()})}Ag(t){this.fg=!1,this.wc.t("playing",{trigger:t}),this.gg.Cb()}xg(t){this.wc.t("stalled",{trigger:t}),this.u.readyState<3&&(this.fg=!0,this.wc.t("waiting",{trigger:t}))}Fg(t){this.u.readyState<3&&(this.fg=!0,this.wc.t("waiting",{trigger:t}))}Eg(t){this.gg.Db(),this.eg(this.u.duration,t),this.wc.t("end",{trigger:t}),this.Pf.$state.loop()?this.Jg():this.wc.t("ended",{trigger:t})}og(){this.Pf.$state.paused()&&a(this.u,"timeupdate",this.Kg.bind(this))}Kg(t){this.eg(this.u.currentTime,t)}vg(t){this.Pf.$state.ended()&&this.eg(this.u.duration,t),this.wc.t("duration-change",{detail:this.u.duration,trigger:t})}Xc(t){this.wc.t("volume-change",{detail:{volume:this.u.volume,muted:this.u.muted},trigger:t})}Cg(t){this.eg(this.u.currentTime,t),this.wc.t("seeked",{detail:this.u.currentTime,trigger:t}),Math.trunc(this.u.currentTime)===Math.trunc(this.u.duration)&&u(this.u.duration)>u(this.u.currentTime)&&(this.eg(this.u.duration,t),this.u.ended||this.Pf.player.dispatch(new d("media-play-request",{trigger:t})))}Dg(t){this.wc.t("seeking",{detail:this.u.currentTime,trigger:t})}wg(t){this.wc.t("progress",{detail:{buffered:this.u.buffered,seekable:this.u.seekable},trigger:t})}Jg(){k(this.u.controls)&&(this.u.controls=!1),this.Pf.player.dispatch(new d("media-loop-request"))}yg(t){this.wc.t("suspend",{trigger:t})}Bg(t){this.wc.t("rate-change",{detail:this.u.playbackRate,trigger:t})}Qc(t){const i=this.u.error;i&&this.wc.t("error",{detail:{message:i.message,code:i.code,mediaError:i},trigger:t})}}class P{constructor(t,i){this.bb=t,this.Lg=i,this.Mg.onaddtrack=this.Og.bind(this),this.Mg.onremovetrack=this.Pg.bind(this),this.Mg.onchange=this.Qg.bind(this),a(this.Lg.audioTracks,"change",this.Rg.bind(this))}get Mg(){return this.bb.media.audioTracks}Og(t){const i=t.track;if(i.label==="")return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.Lg.audioTracks[r.h](s,t),i.enabled&&(s.selected=!0)}Pg(t){const i=this.Lg.audioTracks.getById(t.track.id);i&&this.Lg.audioTracks[r.f](i,t)}Qg(t){let i=this.Ng();if(!i)return;const s=this.Lg.audioTracks.getById(i.id);s&&this.Lg.audioTracks[r.D](s,!0,t)}Ng(){return Array.from(this.Mg).find(t=>t.enabled)}Rg(t){const{current:i}=t.detail;if(!i)return;const s=this.Mg.getTrackById(i.id);if(s){const e=this.Ng();e&&(e.enabled=!1),s.enabled=!0}}}class A{constructor(t){this.scope=l(),this.A=null,this.u=t}setup(t){new M(this,t),"audioTracks"in this.media&&new P(this,t);const{muted:i,volume:s,playsinline:e}=t.$state;this.muted=i(),this.volume=s(),this.playsinline=e(),n(()=>{this.u.setAttribute("src",""),this.u.load()})}get type(){return""}get media(){return this.u}get currentSrc(){return this.A}get paused(){return this.u.paused}get muted(){return this.u.muted}set muted(t){this.u.muted=t}get volume(){return this.u.volume}set volume(t){this.u.volume=t}get currentTime(){return this.u.currentTime}set currentTime(t){this.u.currentTime=t}get playsinline(){return this.u.hasAttribute("playsinline")}set playsinline(t){o(this.u,"playsinline",t)}get playbackRate(){return this.u.playbackRate}set playbackRate(t){this.u.playbackRate=t}async play(){return this.u.play()}async pause(){return this.u.pause()}async loadSource({src:t,type:i},s){this.u.preload=s||"",f(t)?this.u.srcObject=t:(this.u.srcObject=null,this.u.src=m(t)?t:window.URL.createObjectURL(t)),this.u.load(),this.A={src:t,type:i}}}export{A as H,T as R};
