"use strict";var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.Notifications=WPForms.Admin.Builder.Notifications||function(o,r){let e={};const a={removeItemButton:!0,shouldSort:!1},l={init:function(){r(l.ready)},ready:function(){l.setup(),l.bindEvents(),l.maybeSaveFormState()},setup:function(){l.choicesJSHelperMethods.extendChoicesJS(),e={$builder:r("#wpforms-builder")},r(".wpforms-notification.wpforms-builder-settings-block").each(function(e,t){l.initEntryCSVSection(r(t))})},initEntryCSVSection:function(e,t=!1,i=""){var n=e.data("blockId");if("notification"===e.data("blockType")&&n){var o=e.find(".notifications_enable_entry_csv_attachment_toggle").first();if(!(o.length<=0)){if(l.setupEnableEntryCSVAttachmentConditional(o,n),!t)return(o=e.find(".entry_csv_attachment_entry_information").first()).length<=0?void 0:void l.initChoicesJS(o);n=!i,t=i?r(`#wpforms-panel-field-notifications-${i}-entry_csv_attachment_file_name`).val():"";l.initDynamicallyAddedEntryInformationChoicesJS(e,n),l.setDynamicallyAddedEntryInformationFileNameFieldValue(e,t)}}},setupEnableEntryCSVAttachmentConditional:function(e,t){t=`#wpforms-panel-field-notifications-${t}-entry_csv_attachment_entry_information-wrap`+","+`#wpforms-panel-field-notifications-${t}-entry_csv_attachment_file_name-wrap`;e.conditions([{conditions:{element:e,type:"checked",operator:"is",condition:"1"},actions:{if:{element:t,action:"show"},else:{element:t,action:"hide"}},effect:"appear"}])},initChoicesJS:function(e){var t,i,n=e.attr("name");return!(!n||"function"!=typeof o.Choices)&&(t=e.val(),i=new Choices(e[0],a),e.data("choicesjs",i),n=r(`<input type="hidden" name="${n}[hidden]">`),t&&n.val(JSON.stringify(t)),e.closest(".wpforms-panel-field").append(n),e.on("change",l.changeEntryCSVAttachment),l.choicesJSHelperMethods.populateInstance(i,t),i)},bindEvents:function(){e.$builder.on("wpformsSettingsBlockAdded",l.notificationBlockAdded).on("wpformsFieldAdd",l.newFieldAdded).on("wpformsFieldDelete",l.fieldDeleted).on("wpformsSettingsBlockCloned",l.notificationsBlockCloned)},notificationBlockAdded:function(e,t){l.initEntryCSVSection(t,!0)},initDynamicallyAddedEntryInformationChoicesJS:function(e,t){var i,n=e.data("blockId"),e=e.find(`#wpforms-panel-field-notifications-${n}-entry_csv_attachment_entry_information-wrap`);e.length<=0||((n=e.find(".choices")).length<=0||((i=n.find(".entry_csv_attachment_entry_information").first()).length<=0||(i.removeClass("choices__input").removeAttr("hidden").removeAttr("data-choice").removeData("choice").appendTo(e.first()),n.first().remove(),t&&i.val([]),l.initChoicesJS(i))))},setDynamicallyAddedEntryInformationFileNameFieldValue:function(e,t){e=e.find(".entry_csv_attachment_file_name");e.length<=0||e.val(t||wpforms_builder.entry_information.default_file_name)},changeEntryCSVAttachment:function(){var e=r(this),t=e.data("choicesjs").getValue(),i=e.attr("name");if(i&&t){i=i+"[hidden]",e=e.closest(".wpforms-panel-field").find(`input[name="${i}"]`);if(!(e.length<=0)){var n=[];for(let e=0;e<t.length;e++)n.push(t[e].value);e.val(JSON.stringify(n))}}},newFieldAdded:function(e,t,i){wpforms_builder.entry_information.excluded_field_types.includes(i)||(i=wpf.getField(t))&&l.updateChoicesJSFields(i.id,i.label,!1)},fieldDeleted:function(e,t,i){l.updateChoicesJSFields(t,"",!0)},updateChoicesJSFields:function(t,i,n){r(".entry_csv_attachment_entry_information").each(function(){var e=r(this).data("choicesjs");e&&(n?l.choicesJSHelperMethods.deleteChoices(e,t):l.choicesJSHelperMethods.addNewFieldsInAvailableFieldsGroup(e,t,i))})},notificationsBlockCloned:function(e,t,i){l.initEntryCSVSection(t,!0,i)},maybeSaveFormState:function(){var e=wpf.getFormState("#wpforms-builder-form");wpf.savedState!==e&&(wpf.savedState=e)},choicesJSHelperMethods:{extendChoicesJS:function(){Choices.prototype.renderAfterRemoveChoice=function(){this._store.isLoading()||(this._currentState=this._store.state,this._renderChoices(),this._prevState=this._currentState)}},addNewFieldsInAvailableFieldsGroup:function(e,t,i){var n=l.choicesJSHelperMethods.findAvailableFieldsGroupId(e);n&&(e._addChoice({value:t,label:i,groupId:n}),e.renderAfterRemoveChoice())},findAvailableFieldsGroupId:function(e){for(const t of e._currentState.groups)if("Available Fields"===t.value)return t.id;return!1},deleteChoices:function(t,i){for(let e=t._currentState.choices.length-1;0<=e;e--){var n=t._currentState.choices[e];i.toString()===n.value.toString()&&(t.removeActiveItemsByValue(n.value),t._currentState.choices.splice(e,1))}t.renderAfterRemoveChoice()},getAvailableChoices:function(){var e=[],t=wpf.getFields(!1,!0);for(const n of wpf.orders.fields){var i=t[n];i&&!wpforms_builder.entry_information.excluded_field_types.includes(i.type)&&e.push({label:i.label,value:i.id.toString()})}return e},getOtherChoices:function(){var e,t=[];for(const i in wpforms_builder.smart_tags)wpforms_builder.entry_information.excluded_tags.includes(i)||(e=Object.hasOwn(wpforms_builder.entry_information.replacement_tags,i)?wpforms_builder.entry_information.replacement_tags[i]:i,t.push({label:wpforms_builder.smart_tags[i],value:e}));return t},populateInstance:function(t,e=[]){t&&(t.clearStore(),t.setChoices([{label:"hidden",choices:[{value:"all_fields",label:wpforms_builder.entry_information.localized.all_fields}]},{label:wpforms_builder.fields_available,choices:l.choicesJSHelperMethods.getAvailableChoices()},{label:wpforms_builder.other,choices:l.choicesJSHelperMethods.getOtherChoices()}]),Array.isArray(e)&&e.forEach(function(e){t.setChoiceByValue(e)}))}}};return l}((document,window),jQuery),WPForms.Admin.Builder.Notifications.init();