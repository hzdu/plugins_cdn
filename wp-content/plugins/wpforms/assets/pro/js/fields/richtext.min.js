"use strict";var WPFormsRichTextField=window.WPFormsRichTextField||function(n,a,s){var e={mediaPostIdUpdateEvent:!1},r={init:function(){s(n).on("wpformsReady",r.customizeRichTextField)},customizeRichTextField:function(){var d=s(n);d.on("tinymce-editor-setup",function(e,t){r.addMediaButton(t),t.on("keyup",function(){r.validateRichTextField(t)}),t.on("focus",function(e){s(e.target.editorContainer).closest(".wp-editor-wrap").addClass("wpforms-focused")}),t.on("blur",function(e){s(e.target.editorContainer).closest(".wp-editor-wrap").removeClass("wpforms-focused")})}),d.on("wpformsRichTextContentChange",function(e,t,i){r.validateRichTextField(i),r.enableAddMediaButtons(t)}),d.on("tinymce-editor-init",function(e,t){var i=t.getDoc().body.style,o=s("body");i.fontFamily=o.css("font-family"),i.background="transparent",r.initEditorModernMarkupMode(t),r.mediaPostIdUpdate(),r.observeEditorChanges(t),d.trigger("wpformsRichTextEditorInit",[t])}),a.addEventListener("elementor/popup/show",function(e){r.reInitRichTextFields(e.detail.instance.$element)}),s("textarea.wp-editor-area").each(function(){var e=s(this);e.hasClass("wpforms-field-required")&&e.prop("required",!0)}),d.on("click",".media-modal-close, .media-modal-backdrop",r.enableAddMediaButtons),wp.media&&wp.media.view.Modal.prototype.on("escape",function(){r.enableAddMediaButtons("escapeEvent")}),d.on("click",".switch-html",function(){const e=s(this).closest(".wp-editor-wrap");setTimeout(function(){e.find(".wp-editor-area").trigger("focus"),e.addClass("wpforms-focused")},0)}),d.on("click",".switch-tmce",function(e){var t=s(this).closest(".wp-editor-wrap").find(".wp-editor-area").attr("id"),t=tinyMCE.get(t);t&&t.focus()}),d.on("focus",".wp-editor-area",function(){s(this).closest(".wp-editor-wrap").addClass("wpforms-focused")}),d.on("blur",".wp-editor-area",function(e){s(this).closest(".wp-editor-wrap").removeClass("wpforms-focused")})},addMediaButton:function(e){wpforms_settings.richtext_add_media_button&&e.addButton("wp_add_media",{tooltip:"Add Media",icon:"dashicon dashicons-admin-media",cmd:"WP_Medialib"})},enableAddMediaButtons:function(e){("escapeEvent"===e||r.isCloseEvent(e)||r.isMutationImage(e))&&s(".mce-btn-group button i.dashicons-admin-media").closest(".mce-btn").removeClass("mce-btn-disabled")},isCloseEvent:function(e){return void 0!==e.target&&(e.target.classList.contains("media-modal-icon")||e.target.classList.contains("media-modal-backdrop"))},isMutationImage:function(e){var t;return void 0!==e.addedNodes&&void 0!==e.addedNodes[0]&&(t=!1,e.addedNodes.forEach(function(e){return"IMG"===e.tagName||"A"===e.tagName&&e.querySelector("img")?!(t=!0):void 0}),t)},disableAddMediaButtons:function(){s(".mce-btn-group button i.dashicons-admin-media").closest(".mce-btn").addClass("mce-btn-disabled")},mediaPostIdUpdate:function(){e.mediaPostIdUpdateEvent||(s(".wpforms-field-richtext-media-enabled .mce-toolbar .mce-btn").on("click",function(e){var t,e=s(e.target);!e.hasClass("dashicons-admin-media")&&0===e.find(".dashicons-admin-media").length||(t=e.closest("form").data("formid"),e=e.closest(".wpforms-field-richtext").data("field-id"),wp.media.model.settings.post.id="wpforms-"+t+"-field_"+e,r.disableAddMediaButtons())}),e.mediaPostIdUpdateEvent=!0)},observeEditorChanges:function(o){new MutationObserver(function(e,t){for(var i in e)"childList"===e[i].type&&s(n).trigger("wpformsRichTextContentChange",[e[i],o])}).observe(o.iframeElement.contentWindow.document.body,{childList:!0,subtree:!0,attributes:!0})},validateRichTextField:function(e){var t;e&&s(e.iframeElement).closest("form").data("validator")&&(t=s("#"+e.id),e.getContent()!==t.val())&&(e.save(),t.valid())},reInitRichTextFields:function(e){e.find(".wp-editor-area").each(function(){var e=s(this).attr("id");tinymce.get(e)&&tinyMCE.execCommand("mceRemoveEditor",!1,e),a.quicktags(tinyMCEPreInit.qtInit[e]),s("#"+e).css("visibility","initial"),tinymce.init(tinyMCEPreInit.mceInit[e])})},initEditorModernMarkupMode:function(e){var t,i,o,d,n;wpforms.isModernMarkupEnabled()&&!a.WPFormsEditEntry&&a.WPForms.FrontendModern&&(t=e.getDoc().body.style,n=(i=s(e.getElement())).closest(".wpforms-field"),i=i.closest(".wpforms-form"),o=(i=a.WPForms.FrontendModern.getCssVars(i))["field-size-input-height"]?i["field-size-input-height"].replace("px",""):43,d="medium",d=n.hasClass("wpforms-field-small")?"small":"medium",d=n.hasClass("wpforms-field-large")?"large":d,n=e.getWin().clientWidth,e.theme.resizeTo(n,o*{small:1.8,medium:2.79,large:5.12}[d]),t.color=i["field-text-color"],t.fontSize=i["field-size-font-size"])}};return r}(document,window,jQuery);WPFormsRichTextField.init();