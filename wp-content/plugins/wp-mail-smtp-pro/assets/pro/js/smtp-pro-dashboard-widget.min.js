"use strict";var WPMailSMTPDashboardWidget=window.WPMailSMTPDashboardWidget||function(e){var i={$widget:e("#wp_mail_smtp_reports_widget_pro"),$daysSelect:e("#wp-mail-smtp-dash-widget-timespan"),$emailTypeSelect:e("#wp-mail-smtp-dash-widget-email-type"),$canvas:e("#wp-mail-smtp-dash-widget-chart"),$emailStatsBlock:e("#wp-mail-smtp-dash-widget-email-stats-block"),$recomBlockDismissBtn:e("#wp-mail-smtp-dash-widget-dismiss-recommended-plugin-block"),$settingsBtn:e("#wp-mail-smtp-dash-widget-settings-button"),$emailAlertsDismissBtn:e("#wp-mail-smtp-dash-widget-dismiss-email-alert-block")},a=wp_mail_smtp_dashboard_widget.no_send_confirmations?[{label:wp_mail_smtp_dashboard_widget.texts.sent_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(106, 160, 139, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"},{label:wp_mail_smtp_dashboard_widget.texts.failed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(214, 54, 56, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"}]:[{label:wp_mail_smtp_dashboard_widget.texts.confirmed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(106, 160, 139, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"},{label:wp_mail_smtp_dashboard_widget.texts.unconfirmed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(167, 170, 173, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"},{label:wp_mail_smtp_dashboard_widget.texts.failed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(214, 54, 56, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"}],d={instance:null,cachedData:{confirmed:[],unconfirmed:[],sent:[],failed:[]},settings:{type:"line",data:{labels:[],datasets:a.slice()},options:{maintainAspectRatio:!1,scales:{xAxes:[{type:"time",time:{unit:"day",tooltipFormat:"MMM D"},distribution:"series",ticks:{beginAtZero:!0,source:"labels",padding:10,minRotation:25,maxRotation:25,callback:function(a,t,e){var s=Math.floor(e.length/7);return s<1||(e.length-t-1)%s==0?a:void 0}},offset:!1,gridLines:{offsetGridLines:!1}}],yAxes:[{ticks:{beginAtZero:!0,maxTicksLimit:6,padding:20,callback:function(a){if(Math.floor(a)===a)return a}}}]},elements:{line:{tension:0}},animation:{duration:0},hover:{animationDuration:0},legend:{display:!1},tooltips:{displayColors:!1},responsiveAnimationDuration:0}},init:function(){var a;i.$canvas.length&&(a=i.$canvas[0].getContext("2d"),d.instance=new WPMailSMTPChart(a,d.settings),d.updateUI(wp_mail_smtp_dashboard_widget.chart_data))},ajaxUpdate:function(a){a={_wpnonce:wp_mail_smtp_dashboard_widget.nonce,action:"wp_mail_smtp_"+wp_mail_smtp_dashboard_widget.slug+"_get_chart_data",days:a};i.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.ajaxUpdate"),e.post(ajaxurl,a,function(a){d.updateUI(a)})},updateUI:function(a){i.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.updateUI");var t=i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val();e.isEmptyObject(a)?(t="line",d.updateWithDummyData(),d.showEmptyDataMessage()):(d.updateData(a),d.removeEmptyDataMessage()),d.updateColorScheme(i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val()),d.updateStyle(t),d.updateDatasets(),d.instance.update()},updateData:function(a){d.settings.data.labels=[],d.cachedData.confirmed=[],d.cachedData.unconfirmed=[],d.cachedData.sent=[],d.cachedData.failed=[],e.each(a,function(a,t){var e=moment(t.day);d.settings.data.labels.push(e),d.cachedData.confirmed.push({t:e,y:t.delivered}),d.cachedData.unconfirmed.push({t:e,y:t.sent}),d.cachedData.sent.push({t:e,y:t.sent+t.delivered}),d.cachedData.failed.push({t:e,y:t.unsent})}),d.updateChartData()},updateChartData:function(){d.settings.data.datasets=a.slice(),wp_mail_smtp_dashboard_widget.no_send_confirmations?(d.settings.data.datasets[0].data=d.cachedData.sent,d.settings.data.datasets[1].data=d.cachedData.failed):(d.settings.data.datasets[0].data=d.cachedData.confirmed,d.settings.data.datasets[1].data=d.cachedData.unconfirmed,d.settings.data.datasets[2].data=d.cachedData.failed)},updateWithEmptyData:function(){d.settings.data.labels=[];for(var a,t=moment().startOf("day"),e=i.$daysSelect.val()||7,s=1;s<=e;s++)a=t.clone().subtract(s,"days"),d.settings.data.labels.push(a)},updateWithDummyData:function(){d.settings.data.labels=[],d.settings.data.datasets[0].data=[],1<d.settings.data.datasets.length&&(d.settings.data.datasets[1].data=[]),2<d.settings.data.datasets.length&&(d.settings.data.datasets[2].data=[]);for(var a,t=moment().startOf("day"),e=i.$daysSelect.val()||7,s=1;s<=e;s++)a=t.clone().subtract(s,"days"),d.settings.data.labels.push(a),d.settings.data.datasets[0].data.push({t:a,y:Math.floor(16*Math.random())+5})},updateColorScheme:function(a){var t=i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val(),e=["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)"];"smtp"===a?e=d.updateSmtpColorScheme():"wp"===a&&(e=d.updateWpColorScheme()),"bar"===t&&(wp_mail_smtp_dashboard_widget.no_send_confirmations?(e[0]=d.settings.data.datasets[0].borderColor,e[2]=d.settings.data.datasets[1].borderColor):(e[0]=d.settings.data.datasets[0].borderColor,e[1]=d.settings.data.datasets[1].borderColor,e[2]=d.settings.data.datasets[2].borderColor)),wp_mail_smtp_dashboard_widget.no_send_confirmations?(d.settings.data.datasets[0].backgroundColor=e[0],d.settings.data.datasets[1].backgroundColor=e[2]):(d.settings.data.datasets[0].backgroundColor=e[0],d.settings.data.datasets[1].backgroundColor=e[1],d.settings.data.datasets[2].backgroundColor=e[2])},updateSmtpColorScheme:function(){var a="rgba(0, 0, 0, 0)",t="rgba(0, 0, 0, 0)",e="rgba(0, 0, 0, 0)";return"all"!==i.$emailTypeSelect.val()&&(a="rgba(106, 160, 139, 0.16)",t="rgba(167, 170, 173, 0.16)",e="rgba(214, 54, 56, 0.16)"),wp_mail_smtp_dashboard_widget.no_send_confirmations?(d.settings.data.datasets[0].borderColor="rgba(106, 160, 139, 1)",d.settings.data.datasets[1].borderColor="rgba(214, 54, 56, 1)"):(d.settings.data.datasets[0].borderColor="rgba(106, 160, 139, 1)",d.settings.data.datasets[1].borderColor="rgba(167, 170, 173, 1)",d.settings.data.datasets[2].borderColor="rgba(214, 54, 56, 1)"),[a,t,e]},updateWpColorScheme:function(){var a="rgba(0, 0, 0, 0)",t="rgba(0, 0, 0, 0)",e="rgba(0, 0, 0, 0)";return"all"!==i.$emailTypeSelect.val()&&(a="rgba(34, 113, 177, 0.16)",t="rgba(167, 170, 173, 0.16)",e="rgba(214, 54, 56, 0.16)"),wp_mail_smtp_dashboard_widget.no_send_confirmations?(d.settings.data.datasets[0].borderColor="rgba(34, 113, 177, 1)",d.settings.data.datasets[1].borderColor="rgba(214, 54, 56, 1)"):(d.settings.data.datasets[0].borderColor="rgba(34, 113, 177, 1)",d.settings.data.datasets[1].borderColor="rgba(167, 170, 173, 1)",d.settings.data.datasets[2].borderColor="rgba(214, 54, 56, 1)"),[a,t,e]},updateDatasets:function(){var a=i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val();"line"===a?d.updateLineDatasets():"bar"===a&&d.updateBarDatasets()},updateLineDatasets:function(){switch(i.$emailTypeSelect.val()){case"delivered":d.settings.data.datasets[1].data=[],wp_mail_smtp_dashboard_widget.no_send_confirmations||(d.settings.data.datasets[2].data=[]);break;case"sent":wp_mail_smtp_dashboard_widget.no_send_confirmations?d.settings.data.datasets[1].data=[]:(d.settings.data.datasets[0].data=[],d.settings.data.datasets[2].data=[]);break;case"unsent":d.settings.data.datasets[0].data=[],wp_mail_smtp_dashboard_widget.no_send_confirmations||(d.settings.data.datasets[1].data=[])}},updateBarDatasets:function(){switch(i.$emailTypeSelect.val()){case"delivered":d.settings.data.datasets=d.settings.data.datasets.slice(0,1);break;case"sent":d.settings.data.datasets=wp_mail_smtp_dashboard_widget.no_send_confirmations?d.settings.data.datasets.slice(0,1):d.settings.data.datasets.slice(1,2);break;case"unsent":d.settings.data.datasets=wp_mail_smtp_dashboard_widget.no_send_confirmations?d.settings.data.datasets.slice(1):d.settings.data.datasets.slice(2)}},updateStyle:function(a){"line"===(d.settings.type=a)?(d.settings.options.scales.xAxes[0].offset=!1,d.settings.options.scales.xAxes[0].gridLines.offsetGridLines=!1):"bar"===a&&(d.settings.options.scales.xAxes[0].offset=!0,d.settings.options.scales.xAxes[0].gridLines.offsetGridLines=!0)},showEmptyDataMessage:function(){d.removeEmptyDataMessage(),i.$canvas.after(wp_mail_smtp_dashboard_widget.empty_chart_html)},removeEmptyDataMessage:function(){i.$canvas.siblings(".wp-mail-smtp-error").remove()},events:{daysChanged:function(){var a=i.$daysSelect.val();d.ajaxUpdate(a),i.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.daysChanged",a)},emailTypeChanged:function(){var a=i.$emailTypeSelect.val();d.updateChartData(),d.updateColorScheme(i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val()),d.updateDatasets(),d.instance.update(),i.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.emailTypeChanged",a)}}},s={chart:d,init:function(){e(s.ready)},ready:function(){s.events(),d.init(),s.refreshEmailStats(i.$emailTypeSelect.val())},events:function(){s.chartEvents(),s.miscEvents()},chartEvents:function(){i.$daysSelect.on("change",function(){d.events.daysChanged(),s.updateEmailStats(e(this).val(),i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val())}),i.$emailTypeSelect.on("change",function(){d.events.emailTypeChanged(),s.refreshEmailStats(e(this).val())})},miscEvents:function(){i.$recomBlockDismissBtn.on("click",function(){s.dismissRecommendedBlock()}),i.$settingsBtn.on("click",function(a){e(this).toggleClass("open"),e(this).siblings(".wp-mail-smtp-dash-widget-settings-menu").fadeToggle(200)}),i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu-save").on("click",function(){s.saveSettings()}),i.$widget.on("WPMailSMTP.Admin.DashboardWidget.ajaxUpdate",function(){s.addOverlay(i.$canvas)}),i.$widget.on("WPMailSMTP.Admin.DashboardWidget.updateUI",function(){s.removeOverlay(i.$canvas)}),i.$widget.on("WPMailSMTP.Admin.DashboardWidget.daysChanged",function(a,t){s.saveWidgetMeta("timespan",t)}),i.$widget.on("WPMailSMTP.Admin.DashboardWidget.emailTypeChanged",function(a,t){s.saveWidgetMeta("email_type",t)}),i.$emailAlertsDismissBtn.on("click",s.dismissEmailAlerts)},updateEmailStats:function(t,a){a={_wpnonce:wp_mail_smtp_dashboard_widget.nonce,action:"wp_mail_smtp_"+wp_mail_smtp_dashboard_widget.slug+"_get_email_stats",days:t,color:a};s.addOverlay(i.$emailStatsBlock.children().first()),e.post(ajaxurl,a,function(a){i.$emailStatsBlock.html(a),s.refreshEmailStats(i.$emailTypeSelect.val()),s.saveWidgetMeta("timespan",t)})},refreshEmailStats:function(a){var t=i.$emailStatsBlock.find(".wp-mail-smtp-dash-widget-email-stats-table-cell");"all"!==a?(t.hide(),i.$emailStatsBlock.find(".wp-mail-smtp-dash-widget-email-stats-table-cell--"+a).show()):t.show()},saveSettings:function(){var a=i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val(),t=i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val();a&&s.saveWidgetMeta("graph_style",a),t&&s.saveWidgetMeta("color_scheme",t),s.updateEmailStats(i.$daysSelect.val(),t),d.updateChartData(),d.updateColorScheme(t),d.updateStyle(a),d.updateDatasets(),d.instance.update(),i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu").slideUp(100),i.$settingsBtn.removeClass("active")},saveWidgetMeta:function(a,t){t={_wpnonce:wp_mail_smtp_dashboard_widget.nonce,action:"wp_mail_smtp_"+wp_mail_smtp_dashboard_widget.slug+"_save_widget_meta",meta:a,value:t};e.post(ajaxurl,t)},addOverlay:function(a){a.parent().closest(".wp-mail-smtp-dash-widget-block").length&&(s.removeOverlay(a),a.after('<div class="wp-mail-smtp-dash-widget-overlay"></div>'))},removeOverlay:function(a){a.siblings(".wp-mail-smtp-dash-widget-overlay").remove()},dismissRecommendedBlock:function(){e(".wp-mail-smtp-dash-widget-recommended-plugin-block").remove(),s.saveWidgetMeta("hide_recommended_block",1)},dismissEmailAlerts:function(a){a.preventDefault(),e("#wp-mail-smtp-dash-widget-email-alerts-education").remove(),s.saveWidgetMeta("hide_email_alerts_banner",1)}};return s}((document,window,jQuery));WPMailSMTPDashboardWidget.init();