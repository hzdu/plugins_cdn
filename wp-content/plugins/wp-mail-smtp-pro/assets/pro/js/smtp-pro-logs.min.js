"use strict";var WPMailSMTP=window.WPMailSMTP||{};WPMailSMTP.Admin=WPMailSMTP.Admin||{},WPMailSMTP.Admin.Logs=WPMailSMTP.Admin.Logs||function(t,l){var a={isEmailValid:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},areEmailsValid:function(e){Array.isArray(e)||(e=e.split(","));for(var t=0;t<e.length;t++){var i=e[t].trim();if(!a.isEmailValid(i))return!1}return!0}},s={init:function(){l(s.ready)},ready:function(){s.pageHolder=l(".wp-mail-smtp-page-logs"),s.bindActions(),s.pageHolder.hasClass("wp-mail-smtp-page-logs-archive")&&s.archive.ready(),s.pageHolder.trigger("WPMailSMTP.Admin.Logs.ready")},bindActions:function(){l(".wp-mail-smtp-page-logs-archive").on("click","#wp-mail-smtp-reset-filter .reset",s.archive.resetFilter).on("click","#doaction, #doaction2",s.archive.onBulkSubmit),l(".wp-mail-smtp-page-logs-single").on("click",".js-wp-mail-smtp-pro-logs-email-delete",s.single.processDelete).on("click",".js-wp-mail-smtp-pro-logs-toggle-extra-details",s.single.processExtraDetailsToggle).on("click",".js-wp-mail-smtp-pro-logs-close-extra-details",s.single.processExtraDetailsClose).on("click","#wp-mail-smtp-email-actions .wp-mail-smtp-email-log-resend > a",s.single.processResendEmail),s.pageHolder.on("click","#wp-mail-smtp-delete-all-logs-button",s.archive.deleteAllEmailLogs),s.pageHolder.on("click","#wp-mail-smtp-recheck-all-email-logs-status-button",s.archive.recheckAllEmailLogsStatus)},single:{processDelete:function(){return confirm(wp_mail_smtp_logs.text_email_delete_sure)},processExtraDetailsToggle:function(){var e=l(this).closest(".postbox");e.hasClass("closed")?e.find(".inside").slideDown("fast",function(){e.removeClass("closed"),e.find(".handle-actions .dashicons").removeClass("dashicons-arrow-down").addClass("dashicons-arrow-up")}):e.find(".inside").slideUp("fast",function(){e.addClass("closed"),e.find(".handle-actions .dashicons").removeClass("dashicons-arrow-up").addClass("dashicons-arrow-down")})},processExtraDetailsClose:function(e){l(e.target).closest(".postbox").find("h2.hndle:not(.closed)").trigger("click")},processResendEmail:function(e){e.preventDefault(),s.displayConfirmModal(wp_mail_smtp_logs.resend_email_confirmation_text,function(){var e=wp_mail_smtp_logs.email_id,t=this.$content.find('input[name="email"]').val();if(!a.areEmailsValid(t))return s.displayModal(wp_mail_smtp_logs.resend_email_invalid_recipients_addresses,"exclamation-circle-regular-red","red"),!1;s.displayModal(function(){return s.single.resendEmail(e,t,this)})})},resendEmail:function(e,t,i){t={action:"wp_mail_smtp_resend_email",nonce:wp_mail_smtp.nonce,email_id:e,recipients:t};return i.setTitle(wp_mail_smtp_logs.resend_email_processing_text),l.post(wp_mail_smtp.ajax_url,t,function(e){var t=e.data;i.setTitle(""),e.success?(i.setType("green"),i.setIcon(s.getModalIcon("check-circle-solid-green"))):(i.setType("red"),i.setIcon(s.getModalIcon("exclamation-circle-regular-red"))),i.setContent(t)}).fail(function(){i.setTitle(""),i.setType("red"),i.setIcon(s.getModalIcon("exclamation-circle-regular-red")),i.setContent(wp_mail_smtp_logs.error_occurred)}).always(function(){i.isOpen()||i.open()})}},archive:{ready:function(){s.archive.initFlatpickr()},deleteAllEmailLogs:function(e){e.preventDefault();var t=l(e.target);s.displayConfirmModal(wp_mail_smtp_logs.delete_all_email_logs_confirmation_text,function(){s.archive.executeAllEmailLogEntriesDeletion(t)})},executeAllEmailLogEntriesDeletion:function(e){e.prop("disabled",!0),s.archive.sendAjaxRequest({action:"wp_mail_smtp_delete_all_log_entries",nonce:l("#wp-mail-smtp-delete-log-entries-nonce",s.pageHolder).val()},function(){return location.reload(),!1}).always(function(){e.prop("disabled",!1)})},recheckAllEmailLogsStatus:function(e){e.preventDefault();var t=l(e.target);s.displayConfirmModal(wp_mail_smtp_logs.recheck_all_email_logs_status_confirmation_text,function(){s.archive.executeRecheckAllEmailLogEntriesStatus(t)})},executeRecheckAllEmailLogEntriesStatus:function(e){e.prop("disabled",!0),s.archive.sendAjaxRequest({action:"wp_mail_smtp_recheck_all_email_logs_status",nonce:l("#wp-mail-smtp-recheck-all-email-logs-status-nonce",s.pageHolder).val()},function(){}).always(function(){e.prop("disabled",!1)})},sendAjaxRequest:function(e,a){return l.post(wp_mail_smtp.ajax_url,e,function(e){var t,i=e.data,e=e.success?(t="check-circle-solid-green","green"):(t="exclamation-circle-regular-red","red");s.displayModal(i,t,e,a)}).fail(function(){s.displayModal(wp_mail_smtp_logs.error_occurred,"exclamation-circle-regular-red","red")})},initFlatpickr:function(){var e={rangeSeparator:" - "},t={altInput:!0,altFormat:"M j, Y",dateFormat:"Y-m-d",mode:"range"};"undefined"!==flatpickr&&Object.prototype.hasOwnProperty.call(flatpickr,"l10ns")&&Object.prototype.hasOwnProperty.call(flatpickr.l10ns,wp_mail_smtp_logs.lang_code)&&((e=flatpickr.l10ns[wp_mail_smtp_logs.lang_code]).rangeSeparator=" - "),t.locale=e,l(".wp-mail-smtp-filter-date-selector").flatpickr(t)},resetFilter:function(){var e=l(this).parents("form");e.find(l(this).data("scope")).find("input,select").each(function(){var e=l(this);s.isIgnoredForResetInput(e)||s.resetInput(e)}),e.trigger("submit")},onBulkSubmit:function(e){var t=l(this).parents(".bulkactions").find("select[name^=action]").val(),i=[];l('.wp-list-table.emails input[name="email_id[]"]:checked').each(function(){i.push(l(this).val())}),0!==i.length&&"resend"===t&&(e.preventDefault(),s.archive.processResendEmails(i))},resetBulkActionUI:function(){l(".bulkactions select[name^=action]").val("-1"),l('.wp-list-table.emails input[name="email_id[]"]').prop("checked",!1),l('.wp-list-table.emails input[id^="cb-select-all"]').prop("checked",!1)},processResendEmails:function(e){s.displayConfirmModal(wp_mail_smtp_logs.bulk_resend_email_confirmation_text,function(){s.displayModal(function(){return s.archive.resendEmails(e,this)})})},resendEmails:function(e,i){e={action:"wp_mail_smtp_bulk_resend_emails",nonce:wp_mail_smtp.nonce,email_ids:e};return i.setTitle(wp_mail_smtp_logs.bulk_resend_email_processing_text),l.post(wp_mail_smtp.ajax_url,e,function(e){var t=e.data;i.setTitle(""),e.success?(i.setType("green"),i.setIcon(s.getModalIcon("check-circle-solid-green")),s.archive.resetBulkActionUI()):(i.setType("red"),i.setIcon(s.getModalIcon("exclamation-circle-regular-red"))),i.setContent(t)}).fail(function(){i.setTitle(""),i.setType("red"),i.setIcon(s.getModalIcon("exclamation-circle-regular-red")),i.setContent(wp_mail_smtp_logs.error_occurred)}).always(function(){i.isOpen()||i.open()})}},displayConfirmModal:function(e,t){l.confirm({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,type:"orange",icon:s.getModalIcon("exclamation-circle-solid-orange"),title:wp_mail_smtp_logs.heads_up_title,content:e,buttons:{confirm:{text:wp_mail_smtp_logs.yes_text,btnClass:"btn-confirm",keys:["enter"],action:t},cancel:{text:wp_mail_smtp_logs.cancel_text,btnClass:"btn-cancel"}}})},displayModal:function(e,t,i,a){a=a||function(){},l.alert({backgroundDismiss:!0,escapeKey:!0,animationBounce:1,type:i=i||"default",title:!1,icon:t?s.getModalIcon(t):"",content:e,buttons:{confirm:{text:wp_mail_smtp_logs.ok,btnClass:"btn-confirm",keys:["enter"],action:a}}})},getModalIcon:function(e){return'"></i><img src="'+wp_mail_smtp_logs.plugin_url+"/assets/images/font-awesome/"+e+'.svg" style="width: 40px; height: 40px;" alt="'+wp_mail_smtp_logs.icon+'"><i class="'},resetInput:function(e){switch(e.prop("tagName").toLowerCase()){case"input":e.val("");break;case"select":e.val(e.find("option").first().val())}},isIgnoredForResetInput:function(e){return-1!==["submit","hidden"].indexOf((e.attr("type")||"").toLowerCase())&&!e.hasClass("flatpickr-input")},openLinkInNewTab:function(e){e.preventDefault(),t.open(l(this).attr("href"))}};return s}((document,window),jQuery),WPMailSMTP.Admin.Logs.init();