"use strict";var WPMailSMTP=window.WPMailSMTP||{};WPMailSMTP.Admin=WPMailSMTP.Admin||{},WPMailSMTP.Admin.Logs=WPMailSMTP.Admin.Logs||function(t,n){var a={isEmailValid:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},areEmailsValid:function(e){Array.isArray(e)||(e=e.split(","));for(var t=0;t<e.length;t++){var i=e[t].trim();if(!a.isEmailValid(i))return!1}return!0}},l={init:function(){n(l.ready)},ready:function(){l.pageHolder=n(".wp-mail-smtp-page-logs"),l.bindActions(),l.pageHolder.hasClass("wp-mail-smtp-page-logs-archive")&&l.archive.ready(),l.pageHolder.trigger("WPMailSMTP.Admin.Logs.ready")},bindActions:function(){n(".wp-mail-smtp-page-logs-archive").on("click","#wp-mail-smtp-reset-filter .reset",l.archive.resetFilter).on("click","#doaction, #doaction2",l.archive.onBulkSubmit),n(".wp-mail-smtp-page-logs-single").on("click",".js-wp-mail-smtp-pro-logs-email-delete",l.single.processDelete).on("click",".js-wp-mail-smtp-pro-logs-toggle-extra-details",l.single.processExtraDetailsToggle).on("click",".js-wp-mail-smtp-pro-logs-close-extra-details",l.single.processExtraDetailsClose).on("click","#wp-mail-smtp-email-actions .wp-mail-smtp-email-log-resend > a",l.single.processResendEmail),l.pageHolder.on("click","#wp-mail-smtp-delete-all-logs-button",l.archive.deleteAllEmailLogs),l.pageHolder.on("click","#wp-mail-smtp-recheck-all-email-logs-status-button",l.archive.recheckAllEmailLogsStatus)},single:{processDelete:function(){return confirm(wp_mail_smtp_logs.text_email_delete_sure)},processExtraDetailsToggle:function(){var e=n(this).closest(".postbox");e.hasClass("closed")?e.find(".inside").slideDown("fast",function(){e.removeClass("closed"),e.find(".handle-actions .dashicons").removeClass("dashicons-arrow-down").addClass("dashicons-arrow-up")}):e.find(".inside").slideUp("fast",function(){e.addClass("closed"),e.find(".handle-actions .dashicons").removeClass("dashicons-arrow-up").addClass("dashicons-arrow-down")})},processExtraDetailsClose:function(e){n(e.target).closest(".postbox").find("h2.hndle:not(.closed)").trigger("click")},processResendEmail:function(e){e.preventDefault(),l.displayConfirmModal(wp_mail_smtp_logs.resend_email_confirmation_text,function(){var e=wp_mail_smtp_logs.email_id,t=this.$content.find('input[name="email"]').val(),i=this.$content.find('select[name="connection_id"]').val();if(!a.areEmailsValid(t))return l.displayModal(wp_mail_smtp_logs.resend_email_invalid_recipients_addresses,"exclamation-circle-regular-red","red"),!1;l.displayModal(function(){return l.single.resendEmail(e,t,this,i)})})},resendEmail:function(e,t,i,a){a={action:"wp_mail_smtp_resend_email",nonce:wp_mail_smtp.nonce,email_id:e,recipients:t,connection_id:a||""};return i.setTitle(wp_mail_smtp_logs.resend_email_processing_text),n.post(wp_mail_smtp.ajax_url,a,function(e){var t=e.data;i.setTitle(""),e.success?(i.setType("green"),i.setIcon(l.getModalIcon("check-circle-solid-green"))):(i.setType("red"),i.setIcon(l.getModalIcon("exclamation-circle-regular-red"))),i.setContent(t)}).fail(function(){i.setTitle(""),i.setType("red"),i.setIcon(l.getModalIcon("exclamation-circle-regular-red")),i.setContent(wp_mail_smtp_logs.error_occurred)}).always(function(){i.isOpen()||i.open()})}},archive:{ready:function(){l.archive.initFlatpickr()},deleteAllEmailLogs:function(e){e.preventDefault();var t=n(e.target);l.displayConfirmModal(wp_mail_smtp_logs.delete_all_email_logs_confirmation_text,function(){l.archive.executeAllEmailLogEntriesDeletion(t)})},executeAllEmailLogEntriesDeletion:function(e){e.prop("disabled",!0),l.archive.sendAjaxRequest({action:"wp_mail_smtp_delete_all_log_entries",nonce:n("#wp-mail-smtp-delete-log-entries-nonce",l.pageHolder).val()},function(){return location.reload(),!1}).always(function(){e.prop("disabled",!1)})},recheckAllEmailLogsStatus:function(e){e.preventDefault();var t=n(e.target);l.displayConfirmModal(wp_mail_smtp_logs.recheck_all_email_logs_status_confirmation_text,function(){l.archive.executeRecheckAllEmailLogEntriesStatus(t)})},executeRecheckAllEmailLogEntriesStatus:function(e){e.prop("disabled",!0),l.archive.sendAjaxRequest({action:"wp_mail_smtp_recheck_all_email_logs_status",nonce:n("#wp-mail-smtp-recheck-all-email-logs-status-nonce",l.pageHolder).val()},function(){}).always(function(){e.prop("disabled",!1)})},sendAjaxRequest:function(e,a){return n.post(wp_mail_smtp.ajax_url,e,function(e){var t,i=e.data,e=e.success?(t="check-circle-solid-green","green"):(t="exclamation-circle-regular-red","red");l.displayModal(i,t,e,a)}).fail(function(){l.displayModal(wp_mail_smtp_logs.error_occurred,"exclamation-circle-regular-red","red")})},initFlatpickr:function(){var e={rangeSeparator:" - "},t={altInput:!0,altFormat:"M j, Y",dateFormat:"Y-m-d",mode:"range"};"undefined"!==flatpickr&&Object.prototype.hasOwnProperty.call(flatpickr,"l10ns")&&Object.prototype.hasOwnProperty.call(flatpickr.l10ns,wp_mail_smtp_logs.lang_code)&&((e=flatpickr.l10ns[wp_mail_smtp_logs.lang_code]).rangeSeparator=" - "),t.locale=e,n(".wp-mail-smtp-filter-date-selector").flatpickr(t)},resetFilter:function(){var e=n(this).parents("form");e.find(n(this).data("scope")).find("input,select").each(function(){var e=n(this);l.isIgnoredForResetInput(e)||l.resetInput(e)}),e.trigger("submit")},onBulkSubmit:function(e){var t=n(this).parents(".bulkactions").find("select[name^=action]").val(),i=[];n('.wp-list-table.emails input[name="email_id[]"]:checked').each(function(){i.push(n(this).val())}),0!==i.length&&"resend"===t&&(e.preventDefault(),l.archive.processResendEmails(i))},resetBulkActionUI:function(){n(".bulkactions select[name^=action]").val("-1"),n('.wp-list-table.emails input[name="email_id[]"]').prop("checked",!1),n('.wp-list-table.emails input[id^="cb-select-all"]').prop("checked",!1)},processResendEmails:function(t){l.displayConfirmModal(wp_mail_smtp_logs.bulk_resend_email_confirmation_text,function(){var e=this.$content.find('select[name="connection_id"]').val();l.displayModal(function(){return l.archive.resendEmails(t,this,e)})})},resendEmails:function(e,i,t){t={action:"wp_mail_smtp_bulk_resend_emails",nonce:wp_mail_smtp.nonce,email_ids:e,connection_id:t||""};return i.setTitle(wp_mail_smtp_logs.bulk_resend_email_processing_text),n.post(wp_mail_smtp.ajax_url,t,function(e){var t=e.data;i.setTitle(""),e.success?(i.setType("green"),i.setIcon(l.getModalIcon("check-circle-solid-green")),l.archive.resetBulkActionUI()):(i.setType("red"),i.setIcon(l.getModalIcon("exclamation-circle-regular-red"))),i.setContent(t)}).fail(function(){i.setTitle(""),i.setType("red"),i.setIcon(l.getModalIcon("exclamation-circle-regular-red")),i.setContent(wp_mail_smtp_logs.error_occurred)}).always(function(){i.isOpen()||i.open()})}},displayConfirmModal:function(e,t){n.confirm({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,type:"orange",icon:l.getModalIcon("exclamation-circle-solid-orange"),title:wp_mail_smtp_logs.heads_up_title,content:e,buttons:{confirm:{text:wp_mail_smtp_logs.yes_text,btnClass:"btn-confirm",keys:["enter"],action:t},cancel:{text:wp_mail_smtp_logs.cancel_text,btnClass:"btn-cancel"}}})},displayModal:function(e,t,i,a){a=a||function(){},n.alert({backgroundDismiss:!0,escapeKey:!0,animationBounce:1,type:i=i||"default",title:!1,icon:t?l.getModalIcon(t):"",content:e,buttons:{confirm:{text:wp_mail_smtp_logs.ok,btnClass:"btn-confirm",keys:["enter"],action:a}}})},getModalIcon:function(e){return'"></i><img src="'+wp_mail_smtp_logs.plugin_url+"/assets/images/font-awesome/"+e+'.svg" style="width: 40px; height: 40px;" alt="'+wp_mail_smtp_logs.icon+'"><i class="'},resetInput:function(e){switch(e.prop("tagName").toLowerCase()){case"input":e.val("");break;case"select":e.val(e.find("option").first().val())}},isIgnoredForResetInput:function(e){return-1!==["submit","hidden"].indexOf((e.attr("type")||"").toLowerCase())&&!e.hasClass("flatpickr-input")},openLinkInNewTab:function(e){e.preventDefault(),t.open(n(this).attr("href"))}};return l}((document,window),jQuery),WPMailSMTP.Admin.Logs.init();