_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},jQuery(document).ready((function(e){TVE_Dash.ERROR_LOG=TVE_Dash.ERROR_LOG||{},TVE_Dash.ERROR_LOG.models=TVE_Dash.ERROR_LOG.models||{},TVE_Dash.ERROR_LOG.collections=TVE_Dash.ERROR_LOG.collections||{},TVE_Dash.ERROR_LOG.views=TVE_Dash.ERROR_LOG.views||{},TVE_Dash.ERROR_LOG.delay=4e3,TVE_Dash.ERROR_LOG.models.LogEntry=Backbone.Model.extend({}),TVE_Dash.ERROR_LOG.collections.LogEntries=Backbone.Collection.extend({order:"DESC",orderby:"date",per_page:10,current_page:1,total_pages:null,total_items:null,model:TVE_Dash.ERROR_LOG.models.LogEntry,url:function(){var e="?action="+TVE_Dash_Const.actions.backend_ajax+"&_wpnonce="+TVE_Dash_Const.nonce,t="&route="+TVE_Dash_Const.routes.error_log,r="&order="+this.order,n="&orderby="+this.orderby,o="&per_page="+this.per_page,a="&current_page="+this.current_page;return ajaxurl+e+t+r+n+o+a},parse:function(e){return this.total_pages=e.settings.pages,this.total_items=e.settings.items,e.models}}),TVE_Dash.ERROR_LOG.views.LogEntryView=Backbone.View.extend({tagName:"tr",template:TVE_Dash.tpl("tvd-error-log-entry-template"),className:"tvd-error-log-entry tvd-collection-item tvd-row",events:{"click .delete span, .retry span":function(t){e(t.currentTarget).parent().hasClass("retry")&&this.entryAction("retry"),e(t.currentTarget).parent().hasClass("delete")&&this.entryAction("delete")}},render:function(){return this.$el.html(this.template({item:this.model})),this},entryAction:function(t){var r=this.$el,n=(this.$el.find(".tvd-error-entry-actions").attr("data-id"),JSON.parse(this.model.get("api_data"))),o={action:"delete"===t?"tve_dash_api_delete_log":"tve_dash_api_form_retry",connection_name:this.model.get("connection"),list_id:this.model.get("list_id"),log_id:this.model.get("id"),_wpnonce:TVE_Dash_Const.nonce};e.extend(o,n),"retry"==t&&r.find(".retry span").addClass("mdi-pulse");var a=e.ajax({url:ajaxurl,type:"post",data:o,dataType:"json"});return a.fail((function(){"retry"==t&&r.find(".retry span").removeClass("mdi-pulse"),alert(TVE_Dash_Const.translations.RequestError)})),a.done((function(e){"error"===e.status?("retry"==t&&r.find(".retry span").removeClass("mdi-pulse"),r.css("background-color","pink"),setTimeout((function(){r.css({"background-color":""})}),TVE_Dash.ERROR_LOG.delay)):"success"===e.status&&(r.css("background","lightgreen"),setTimeout((function(){r.remove()}),TVE_Dash.ERROR_LOG.delay)),"retry"==t&&r.find(".retry span").removeClass("mdi-pulse")})),this}}),TVE_Dash.ERROR_LOG.views.Table=Backbone.View.extend({el:".tvd-error-log-table",events:{"change #tvd-row-nr-per-page":"changeNrOfRows","click .tvd-jump-to-page-button":"jumpToPage","click .tvd-previous-page":"previousPage","click .tvd-next-page":"nextPage","keypress .tvd-jump-to-page":"keyread","click .tvd-error-log-connection, .tvd-error-log-date":function(t){this.$el.find(".tvd-order-filter-active").removeClass("tvd-order-filter-active"),e(t.currentTarget).addClass("tvd-order-filter-active");var r=e(t.currentTarget).attr("data-val");"connection"==r&&(this.collection.orderby="connection"),"date"==r&&(this.collection.orderby="date"),"DESC"==this.collection.order?(this.collection.order="ASC",e(t.currentTarget).find(".tvd-orderby-icons").removeClass("tvd-icon-expanded").addClass("tvd-icon-collapsed")):(e(t.currentTarget).find(".tvd-orderby-icons").removeClass("tvd-icon-collapsed").addClass("tvd-icon-expanded"),this.collection.order="DESC");var n="tvd_filter_"+this.collection.order.toLowerCase();t.currentTarget.className=t.currentTarget.className.replace(/\btvd_filter_.*?\b/g,""),e(t.currentTarget).addClass(n),this.render()}},previousPage:function(){this.collection.current_page>1&&(this.collection.current_page=--this.collection.current_page,this.render())},nextPage:function(){this.collection.current_page<this.collection.total_pages&&(this.collection.current_page=++this.collection.current_page,this.render())},keyread:function(e){13===e.which&&this.jumpToPage()},jumpToPage:function(){var e=parseInt(this.$el.find("#current-page-input").val());this.$el.find("#current-page-input").removeClass("tvd-invalid"),e<=this.collection.total_pages&&e>0?(this.collection.current_page=this.$el.find("#current-page-input").val(),this.render()):(TVE_Dash.err(this.$el.find(".tvd-jump-to-page").attr("data-error")),this.$el.find("#current-page-input").addClass("tvd-invalid"))},changeNrOfRows:function(){this.collection.per_page=this.$el.find("#tvd-row-nr-per-page").val(),this.collection.current_page=1,this.render()},renderPageSettings:function(){this.$el.find(".tvd-error-log-item-number").html(this.collection.total_items),this.$el.find(".tvd-error-log-current-page").html(this.collection.current_page),this.$el.find(".tvd-error-log-total-pages").html(this.collection.total_pages),this.$el.find("#tvd-row-nr-per-page").val(this.collection.per_page),this.$el.find(".tvd-next-page").removeClass("tvd-nav-disabled"),this.$el.find(".tvd-previous-page").removeClass("tvd-nav-disabled"),this.collection.current_page==this.collection.total_pages&&this.$el.find(".tvd-next-page").addClass("tvd-nav-disabled"),1==this.collection.current_page&&this.$el.find(".tvd-previous-page").addClass("tvd-nav-disabled"),this.$el.find(".tvd-jump-to-page").removeClass("tvd-invalid")},render:function(){TVE_Dash.showLoader(),this.$el.find("#tvd-row-nr-per-page").select2(),this.$el.find(".tvd-error-log-table-content").html("");var e=this.collection.fetch(),t=this;return e.done((function(){t.collection.each(t.renderOne,t),t.renderPageSettings()})).always((function(){setTimeout((function(){TVE_Dash.hideLoader()}),300)})),this},renderOne:function(e){var t=new TVE_Dash.ERROR_LOG.views.LogEntryView({model:e});return this.$el.find(".tvd-error-log-table-content").append(t.render().$el),this}}),e((function(){TVE_Dash.ERROR_LOG.errorLogPage=new TVE_Dash.ERROR_LOG.collections.LogEntries,window.errorLog=new TVE_Dash.ERROR_LOG.views.Table({collection:TVE_Dash.ERROR_LOG.errorLogPage}),window.errorLog.render()}))}));