!function(){"use strict";var e={n:function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,{a:r}),r},d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.element,r=window.wp.compose,n=window.wp.components,o=window.wp.hooks,a=window.wp.blockEditor,c=window.wp.i18n;(0,o.addFilter)("blocks.registerBlockType","neve/custom-attributes",(function(e,t){return"core/button"!==t||void 0!==e.attributes&&(e.attributes=Object.assign(e.attributes,{autoAddToCart:{type:"boolean",default:!1},autoApplyDiscount:{type:"boolean",default:!1},discountCode:{type:"string"}})),e}));const l=(0,r.createHigherOrderComponent)((e=>r=>{if("core/button"!==r.name)return(0,t.createElement)(e,r);const{attributes:o,setAttributes:l,isSelected:s}=r,{autoAddToCart:i,autoApplyDiscount:u,discountCode:m}=o;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(e,r),s&&(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(n.PanelBody,{title:(0,c.__)("Advanced link settings","sparks-for-woocommerce")},(0,t.createElement)(n.ToggleControl,{label:(0,c.__)("Automatically add to cart"),checked:!!i,onChange:()=>l({autoAddToCart:!i}),help:(0,c.__)("This works if the button uses a product link.","sparks-for-woocommerce")}),i&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.ToggleControl,{label:(0,c.__)("Automatically apply discount"),checked:!!u,onChange:()=>l({autoApplyDiscount:!u})}),u&&(0,t.createElement)(n.TextControl,{label:(0,c.__)("Discount code","sparks-for-woocommerce"),value:m,onChange:e=>l({discountCode:e})})))))}),"withAdvancedControls");(0,o.addFilter)("editor.BlockEdit","neve/cart-notice-advanced-button",l);var s=window.wp.data,i=window.wp.richText,u=e=>{const{selectionStart:r,selectionEnd:o,block:l}=(0,s.useSelect)((e=>({selectionStart:e("core/block-editor").getSelectionStart(),selectionEnd:e("core/block-editor").getSelectionEnd(),block:e("core/block-editor").getSelectedBlock()}))),{getMetaValue:u}=e,{updateBlock:m}=(0,s.useDispatch)("core/block-editor"),_=[{name:"{time_left}",isActive:!!u("nv_cn_expiration_end")},{name:"{amount_left}",isActive:!("amount"!==u("nv_cn_trigger")||!u("nv_cn_trigger_amount_max"))},{name:"{products_in_cart}",isActive:!("product"!==u("nv_cn_trigger")||!u("nv_cn_trigger_product_include")||!JSON.parse(u("nv_cn_trigger_product_include")).length)},{name:"{quantity_left}",isActive:!("product"!==u("nv_cn_trigger")||!u("nv_cn_trigger_product_max_qty"))},{name:"{quantity_over}",isActive:!("product"!==u("nv_cn_trigger")||!u("nv_cn_trigger_product_min_qty"))},{name:"{categories_in_cart}",isActive:!("category"!==u("nv_cn_trigger")||!u("nv_cn_trigger_category_include")||!JSON.parse(u("nv_cn_trigger_category_include")).length)}].filter((e=>!0===e.isActive))||[];return(0,t.createElement)(a.BlockControls,null,(0,t.createElement)(n.ToolbarGroup,null,(0,t.createElement)(n.ToolbarItem,null,(e=>(0,t.createElement)(n.DropdownMenu,{className:"sp-magic-tags-dropdown",icon:"image-filter",label:(0,c.__)("Magic tags","sparks-for-woocommerce"),toggleProps:e},(()=>(0,t.createElement)(n.MenuGroup,null,_.length>0?(0,t.createElement)(t.Fragment,null,_.map(((e,a)=>(0,t.createElement)(n.MenuItem,{onClick:()=>{const t=l.clientId,n=r.offset,a=o.offset,c=l.attributes.content;let s=(0,i.create)({html:c});s=(0,i.insert)(s,e.name,n,a),m(t,{attributes:{content:(0,i.toHTMLString)({value:s})}})},key:a},e.name)))):(0,t.createElement)(n.MenuItem,null,(0,c.__)("There are no available magic tags for this notice.","sparks-for-woocommerce")))))))))},m=window.wp.blocks;function _(){return _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_.apply(this,arguments)}var p=e=>{let{getMetaValue:r,setMetaValue:o}=e;return(0,t.createElement)(n.PanelBody,{title:(0,c.__)("Display location","sparks-for-woocommerce"),initialOpen:!0},(0,t.createElement)(n.ToggleControl,{label:(0,c.__)("Show on cart","sparks-for-woocommerce"),checked:!!r("nv_cn_location_cart")&&JSON.parse(r("nv_cn_location_cart")),onChange:e=>{o("nv_cn_location_cart",e)}}),(0,t.createElement)(n.ToggleControl,{label:(0,c.__)("Show on checkout","sparks-for-woocommerce"),checked:!!r("nv_cn_location_checkout")&&JSON.parse(r("nv_cn_location_checkout")),onChange:e=>{o("nv_cn_location_checkout",e)}}),(0,t.createElement)(n.ToggleControl,{label:(0,c.__)("Show on product catalog","sparks-for-woocommerce"),checked:!!r("nv_cn_location_shop")&&JSON.parse(r("nv_cn_location_shop")),onChange:e=>{o("nv_cn_location_shop",e)}}),(0,t.createElement)(n.ToggleControl,{label:(0,c.__)("Show on single product","sparks-for-woocommerce"),checked:!!r("nv_cn_location_single")&&JSON.parse(r("nv_cn_location_single")),onChange:e=>{o("nv_cn_location_single",e)}}))},g=e=>{let{getMetaValue:r,setMetaValue:o}=e;return(0,t.createElement)(n.PanelBody,{title:(0,c.__)("Display settings","sparks-for-woocommerce"),initialOpen:!1},(0,t.createElement)(n.SelectControl,{label:(0,c.__)("Display notice for:","sparks-for-woocommerce"),options:[{label:(0,c.__)("All users","sparks-for-woocommerce"),value:"all"},{label:(0,c.__)("Registered users","sparks-for-woocommerce"),value:"registered"}],onChange:e=>{o("nv_cn_user_status",e)},value:r("nv_cn_user_status")?r("nv_cn_user_status"):"all"}),(0,t.createElement)(n.PanelRow,null,(0,t.createElement)("span",null,(0,t.createElement)("strong",null,(0,c.__)("Start date:","sparks-for-woocommerce"))),(0,t.createElement)(n.Dropdown,{className:"sp-cn-expiration-start",position:"bottom right",renderToggle:e=>{let{isOpen:o,onToggle:a}=e;return(0,t.createElement)(n.Button,{isTertiary:!0,onClick:a,"aria-expanded":o},r("nv_cn_expiration_start")?r("nv_cn_expiration_start"):(0,c.__)("Immediately","sparks-for-woocommerce"))},renderContent:()=>(0,t.createElement)(n.DateTimePicker,{currentDate:r("nv_cn_expiration_start")?r("nv_cn_expiration_start"):"",onChange:e=>{const t=null!==e?moment(e).format("MMMM D, YYYY HH:mm"):"";o("nv_cn_expiration_start",t)}})})),(0,t.createElement)(n.PanelRow,null,(0,t.createElement)("span",null,(0,t.createElement)("strong",null,(0,c.__)("End date:","sparks-for-woocommerce"))),(0,t.createElement)(n.Dropdown,{className:"sp-cn-expiration-end",position:"bottom right",renderToggle:e=>{let{isOpen:o,onToggle:a}=e;return(0,t.createElement)(n.Button,{isTertiary:!0,onClick:a,"aria-expanded":o},r("nv_cn_expiration_end")?r("nv_cn_expiration_end"):(0,c.__)("No date defined","sparks-for-woocommerce"))},renderContent:()=>(0,t.createElement)(n.DateTimePicker,{currentDate:r("nv_cn_expiration_end")?r("nv_cn_expiration_end"):"",onChange:e=>{const t=null!==e?moment(e).format("MMMM D, YYYY HH:mm"):"";o("nv_cn_expiration_end",t)}})})))},d=window.wp.apiFetch,v=e.n(d);function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(r,!0).forEach((function(t){f(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var b={adminUrl:"",countries:[],currency:{code:"USD",precision:2,symbol:"$",symbolPosition:"left",decimalSeparator:".",priceFormat:"%1$s%2$s",thousandSeparator:","},defaultDateRange:"period=month&compare=previous_year",locale:{siteLocale:"en_US",userLocale:"en_US",weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},orderStatuses:[],siteTitle:"",wcAssetUrl:""},k=y({},b,{},"object"===("undefined"==typeof wcSharedSettings?"undefined":w(wcSharedSettings))?wcSharedSettings:{});function E(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return k.hasOwnProperty(e)?k[e]:t}k.currency=y({},b.currency,{},k.currency),k.locale=y({},b.locale,{},k.locale),k.adminUrl,k.countries,k.currency,k.locale,k.orderStatuses,k.siteTitle,k.wcAssetUrl,k.defaultDateRange;var C=window.wp.url,S=window.lodash,x=e=>{let{getMetaValue:r,setMetaValue:o}=e;const[a,l]=(0,t.useState)({}),[s,i]=(0,t.useState)({});function u(e){let t,{type:r="products",queryArgs:n=[]}=e;return"products"===r&&(t=function(e){let{queryArgs:t=[]}=e;const r={per_page:E("isLargeCatalog")?100:0,catalog_visibility:"any",orderby:"title",order:"asc"},n=[(0,C.addQueryArgs)("/wc/store/products",{...r,...t})];return E("isLargeCatalog")&&n.push((0,C.addQueryArgs)("/wc/store/products",{catalog_visibility:"any"})),n}({queryArgs:n})),"categories"===r&&(t=function(e){let{queryArgs:t=[]}=e;return[(0,C.addQueryArgs)("/wc/store/products/categories",{per_page:0,...t})]}({queryArgs:n})),Promise.all(t.map((e=>v()({path:e})))).then((e=>{const t=[];return(0,S.uniqBy)((0,S.flatten)(e),"id").forEach((e=>{t.push({value:e.id,title:e.name})})),t})).catch((e=>{throw e}))}(0,t.useEffect)((()=>{let e=!0;return u({type:"products"}).then((t=>{const r=t.reduce(((e,t)=>({...e,[t.title]:t.value})),{});e&&l(r)})).catch((e=>console.log(e))),u({type:"categories"}).then((t=>{const r=t.reduce(((e,t)=>({...e,[t.title]:t.value})),{});e&&i(r)})).catch((e=>console.error(e))),()=>e=!1}),[]);const m=function(e){switch(e){case"no-trigger":return(0,c.__)("The notice is always present on the selected locations.","sparks-for-woocommerce");case"amount":return(0,c.__)("The notice is shown based on cart amount.","sparks-for-woocommerce");case"product":return(0,c.__)("The notice is shown based on what products are in cart and/or their number.","sparks-for-woocommerce");case"category":return(0,c.__)("The notice is shown based on categories of products that are in cart.","sparks-for-woocommerce");default:return""}}(r("nv_cn_trigger"));function _(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=[],c=r?s:a;e.forEach((e=>{const t="string"==typeof e?c[e]:e.id;t&&n.push({id:t,value:"string"==typeof e?e:e.value})})),o(t,JSON.stringify(n))}return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.PanelBody,{title:(0,c.__)("Display conditions","sparks-for-woocommerce"),initialOpen:!1},(0,t.createElement)(n.BaseControl,{className:"sp-cn-trigger",help:m},(0,t.createElement)(n.SelectControl,{options:[{label:(0,c.__)("Always","sparks-for-woocommerce"),value:"no-trigger"},{label:(0,c.__)("Cart amount","sparks-for-woocommerce"),value:"amount"},{label:(0,c.__)("Product in cart","sparks-for-woocommerce"),value:"product"},{label:(0,c.__)("Category in cart","sparks-for-woocommerce"),value:"category"}],onChange:e=>{o("nv_cn_trigger",e)},value:r("nv_cn_trigger")?r("nv_cn_trigger"):"no-trigger"})),(0,t.createElement)(n.Dropdown,{className:"sp-cn-magic-tags",position:"bottom right",renderToggle:e=>{let{isOpen:r,onToggle:o}=e;return(0,t.createElement)(n.Button,{isLink:!0,onClick:o,"aria-expanded":r},(0,c.__)("How to add magic tags","sparks-for-woocommerce"))},renderContent:()=>(0,t.createElement)("div",{className:"sp-cn-magic-tags-info"},(0,t.createElement)("p",null," ",(0,c.__)("Based on your notice settings, different magic tags will be available for you to add.","sparks-for-woocommerce")," "),(0,t.createElement)("h4",null,(0,c.__)("How to add magic tags","sparks-for-woocommerce")),(0,t.createElement)("p",null," ",(0,c.__)("Click on the text notice and a toolbar will be available.","sparks-for-woocommerce")," "),(0,t.createElement)("p",null,void 0!==t.createInterpolateElement&&(0,t.createInterpolateElement)((0,c.__)("Click on <span></span> and the list with magic tags will be available. Click on any tag to insert it in your text.","sparks-for-woocommerce"),{span:(0,t.createElement)("span",{className:"dashicon dashicons dashicons-image-filter"})})),(0,t.createElement)("img",{src:sparksCartNotice.magicTagInfoImage,alt:(0,c.__)("Magic tags","sparks-for-woocommerce")}))}),function(e){switch(e){case"amount":return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.TextControl,{label:(0,c.__)("Maximum cart amount","sparks-for-woocommerce"),type:"number",value:r("nv_cn_trigger_amount_max")?r("nv_cn_trigger_amount_max"):"",onChange:e=>{e=parseInt(e)<0?"0":e;const t=r("nv_cn_trigger_amount_min");e=parseInt(e)<parseInt(t)?t:e,o("nv_cn_trigger_amount_max",e)},min:0}),(0,t.createElement)(n.TextControl,{label:(0,c.__)("Minimum cart amount","sparks-for-woocommerce"),type:"number",value:r("nv_cn_trigger_amount_min")?r("nv_cn_trigger_amount_min"):"",onChange:e=>{e=parseInt(e)<0?"0":e;const t=r("nv_cn_trigger_amount_max");e=parseInt(e)>parseInt(t)?t:e,o("nv_cn_trigger_amount_min",e)},min:0}),(0,t.createElement)(n.SelectControl,{label:(0,c.__)("Should include tax","sparks-for-woocommerce"),options:[{label:(0,c.__)("No","sparks-for-woocommerce"),value:"no"},{label:(0,c.__)("Yes","sparks-for-woocommerce"),value:"yes"}],onChange:e=>{o("nv_cn_trigger_amount_tax",e)},value:r("nv_cn_trigger_amount_tax")?r("nv_cn_trigger_amount_tax"):"yes"}));case"product":return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.BaseControl,{id:"sp-cn-product-include",label:(0,c.__)("Include","sparks-for-woocommerce"),help:(0,c.__)("The notice is shown when any of the products from the list is in the cart.","sparks-for-woocommerce"),className:"sp-products-control"},(0,t.createElement)(n.FormTokenField,{value:r("nv_cn_trigger_product_include")?JSON.parse(r("nv_cn_trigger_product_include")):[],suggestions:Object.keys(a),onChange:e=>_(e,"nv_cn_trigger_product_include")})),(0,t.createElement)(n.BaseControl,{id:"sp-cn-product-exclude",label:(0,c.__)("Exclude","sparks-for-woocommerce"),help:(0,c.__)("The notice is shown when none of the products from the list is in the cart.","sparks-for-woocommerce"),className:"sp-products-control"},(0,t.createElement)(n.FormTokenField,{value:r("nv_cn_trigger_product_exclude")?JSON.parse(r("nv_cn_trigger_product_exclude")):[],suggestions:Object.keys(a),onChange:e=>_(e,"nv_cn_trigger_product_exclude")})),(0,t.createElement)(n.TextControl,{label:(0,c.__)("Minimum quantity","sparks-for-woocommerce"),type:"number",value:r("nv_cn_trigger_product_min_qty")?r("nv_cn_trigger_product_min_qty"):"",onChange:e=>{o("nv_cn_trigger_product_min_qty",e)},min:0}),(0,t.createElement)(n.TextControl,{label:(0,c.__)("Maximum quantity","sparks-for-woocommerce"),type:"number",value:r("nv_cn_trigger_product_max_qty")?r("nv_cn_trigger_product_max_qty"):"",onChange:e=>{o("nv_cn_trigger_product_max_qty",e)},min:0}));case"category":return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.BaseControl,{id:"sp-cn-category-include",label:(0,c.__)("Include","sparks-for-woocommerce"),help:(0,c.__)("The notice is shown when any of the products from cart is in a category from this list.","sparks-for-woocommerce"),className:"sp-products-control"},(0,t.createElement)(n.FormTokenField,{value:r("nv_cn_trigger_category_include")?JSON.parse(r("nv_cn_trigger_category_include")):[],suggestions:Object.keys(s),onChange:e=>_(e,"nv_cn_trigger_category_include",!0)})),(0,t.createElement)(n.BaseControl,{id:"sp-cn-category-exclude",label:(0,c.__)("Exclude","sparks-for-woocommerce"),help:(0,c.__)("The notice is shown when any of the products from cart is not in a category from this list.","sparks-for-woocommerce"),className:"sp-products-control"},(0,t.createElement)(n.FormTokenField,{value:r("nv_cn_trigger_category_exclude")?JSON.parse(r("nv_cn_trigger_category_exclude")):[],suggestions:Object.keys(s),onChange:e=>_(e,"nv_cn_trigger_category_exclude",!0)})));default:return""}}(r("nv_cn_trigger"))))},T=e=>{let{attributes:r,setAttributes:o}=e;const{backgroundColor:l}=r;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.PanelBody,{title:(0,c.__)("Styling","sparks-for-woocommerce"),initialOpen:!1},(0,t.createElement)(n.BaseControl,{id:"sp-cn-background",label:(0,c.__)("Background color:","sparks-for-woocommerce")},(0,t.createElement)(a.ColorPalette,{value:l,onChange:e=>o({backgroundColor:e})}))))},O=e=>{let{getMetaValue:r,setMetaValue:n,attributes:o,setAttributes:c}=e;return(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(p,{getMetaValue:r,setMetaValue:n}),(0,t.createElement)(g,{getMetaValue:r,setMetaValue:n}),(0,t.createElement)(x,{getMetaValue:r,setMetaValue:n}),(0,t.createElement)(T,{attributes:o,setAttributes:c}))};(0,m.registerBlockType)("sparks/cart-notices",{title:"Cart notice",icon:"admin-comments",category:"design",attributes:{content:{type:"string",source:"html",selector:"p"},backgroundColor:{type:"string",default:"var(--sp-c-1)"}},supports:{multiple:!1},edit:e=>{const{attributes:r,setAttributes:n}=e,{content:o,backgroundColor:l}=r,{meta:i}=(0,s.useSelect)((e=>({meta:e("core/editor").getEditedPostAttribute("meta")||{}}))),{editPost:m}=(0,s.useDispatch)("core/editor"),p=e=>i[e]||"",g={backgroundColor:l,color:"var(--sp-text-dark-bg)",padding:"20px"},d=(0,a.useBlockProps)();return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(O,{getMetaValue:p,setMetaValue:(e,t)=>{m({meta:{[e]:t}})},attributes:r,setAttributes:n}),(0,t.createElement)("div",{className:"sp-cn-wrapper",style:g},(0,t.createElement)("div",{className:"sp-cn-content"},(0,t.createElement)(u,{getMetaValue:p}),(0,t.createElement)(a.RichText,_({},d,{className:"sp-cn-content",placeholder:(0,c.__)("Cart notice text","sparks-for-woocommerce"),tagName:"p",onChange:e=>n({content:e}),value:o}))),(0,t.createElement)("div",{className:"sp-cn-cta"},(0,t.createElement)(a.InnerBlocks,{allowedBlocks:["core/button"],template:[["core/button",{placeholder:(0,c.__)("Call to action","sparks-for-woocommerce"),className:"is-style-primary alignright",formattingControls:[]}]],templateLock:"all"}))))},save:e=>{const{attributes:{backgroundColor:r,content:n}}=e,o={backgroundColor:r,padding:"20px"},c=a.useBlockProps.save();return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:"sp-cn-wrapper",style:o},(0,t.createElement)("div",{className:"sp-cn-content"},(0,t.createElement)(a.RichText.Content,_({},c,{tagName:"p",value:n}))),(0,t.createElement)("div",{className:"sp-cn-cta"},(0,t.createElement)(a.InnerBlocks.Content,null))))}})}();