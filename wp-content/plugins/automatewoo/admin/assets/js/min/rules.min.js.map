{"version":3,"file":"rules.min.js","mappings":"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","sources":["webpack://automatewoo/./admin/assets/js/rules.js"],"sourcesContent":["// Register eslint ignored glabals - to be revisited.\n// https://github.com/woocommerce/automatewoo/issues/1212\n/* global AW, Backbone, _, ajaxurl, automatewooWorkflowLocalizeScript */\n( function ( $, data ) {\n\t// MODELS\n\n\tAW.Rules = Backbone.Model.extend( {\n\t\tinitialize() {\n\t\t\tconst ruleOptions = [];\n\n\t\t\tif ( this.get( 'rawRuleOptions' ) ) {\n\t\t\t\t// convert rule options from json to models\n\n\t\t\t\t_.each( this.get( 'rawRuleOptions' ), ( rawRuleGroup ) => {\n\t\t\t\t\tconst group = new AW.RuleGroup( this );\n\t\t\t\t\tconst rules = [];\n\n\t\t\t\t\t_.each( rawRuleGroup, function ( rawRule ) {\n\t\t\t\t\t\tconst rule = new AW.Rule( group );\n\n\t\t\t\t\t\trule.set( 'name', rawRule.name );\n\t\t\t\t\t\trule.resetOptions();\n\t\t\t\t\t\trule.set( 'compare', rawRule.compare );\n\t\t\t\t\t\trule.set( 'value', rawRule.value );\n\n\t\t\t\t\t\t// for objects\n\t\t\t\t\t\tif ( rawRule.selected ) {\n\t\t\t\t\t\t\trule.set( 'selected', rawRule.selected );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trules.push( rule );\n\t\t\t\t\t} );\n\n\t\t\t\t\tgroup.set( 'rules', rules );\n\t\t\t\t\truleOptions.push( group );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tthis.set( 'ruleOptions', ruleOptions );\n\n\t\t\tthis.resetAvailableRules();\n\t\t},\n\n\t\tdefaults() {\n\t\t\treturn {\n\t\t\t\tallRules: {},\n\t\t\t\tavailableRules: {},\n\n\t\t\t\t// array of condition group models\n\t\t\t\truleOptions: [],\n\t\t\t};\n\t\t},\n\n\t\tresetAvailableRules() {\n\t\t\t// calculate available conditions based on the selected trigger\n\n\t\t\tconst trigger = AW.workflow.get( 'trigger' );\n\n\t\t\tthis.set(\n\t\t\t\t'availableRules',\n\t\t\t\t_.filter( this.get( 'allRules' ), function ( rule ) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\ttrigger &&\n\t\t\t\t\t\ttrigger.supplied_data_items.indexOf(\n\t\t\t\t\t\t\trule.data_item\n\t\t\t\t\t\t) !== -1\n\t\t\t\t\t);\n\t\t\t\t} )\n\t\t\t);\n\n\t\t\t// put rules into groups for select\n\t\t\tconst groupedRules = {};\n\n\t\t\t_.each( this.get( 'availableRules' ), function ( rule ) {\n\t\t\t\tif ( ! groupedRules[ rule.group ] ) {\n\t\t\t\t\tgroupedRules[ rule.group ] = [];\n\t\t\t\t}\n\t\t\t\tgroupedRules[ rule.group ].push( rule );\n\t\t\t} );\n\n\t\t\tthis.set( 'groupedRules', groupedRules );\n\t\t},\n\n\t\tisRuleAvailable( ruleName ) {\n\t\t\tconst availableRules = AW.rules.get( 'availableRules' );\n\t\t\tconst names = _.pluck( availableRules, 'name' );\n\t\t\treturn _.indexOf( names, ruleName ) !== -1;\n\t\t},\n\n\t\tclearIncompatibleRules() {\n\t\t\tconst rulesToRemove = [];\n\n\t\t\t_.each( AW.rules.get( 'ruleOptions' ), function ( ruleGroup ) {\n\t\t\t\t_.each( ruleGroup.get( 'rules' ), function ( rule ) {\n\t\t\t\t\tif (\n\t\t\t\t\t\trule &&\n\t\t\t\t\t\t! AW.rules.isRuleAvailable( rule.get( 'name' ) )\n\t\t\t\t\t) {\n\t\t\t\t\t\trulesToRemove.push( rule );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t\t// clear out of initial loop to avoid index changing issues, when rules are cleared\n\t\t\t_.each( rulesToRemove, function ( rule ) {\n\t\t\t\trule.clear();\n\t\t\t} );\n\t\t},\n\n\t\tcreateGroup() {\n\t\t\tconst groups = this.get( 'ruleOptions' );\n\n\t\t\tconst group = new AW.RuleGroup( this );\n\t\t\tgroup.createRule();\n\t\t\tgroups.push( group );\n\n\t\t\tthis.set( 'ruleOptions', groups );\n\t\t\tthis.trigger( 'ruleGroupChange' );\n\n\t\t\treturn group;\n\t\t},\n\n\t\tremoveGroup( id ) {\n\t\t\tconst groups = this.get( 'ruleOptions' );\n\n\t\t\t// find index - note we cant use _.findIndex due to backwards compatibility\n\t\t\tconst index = groups\n\t\t\t\t.map( function ( group ) {\n\t\t\t\t\treturn group.id;\n\t\t\t\t} )\n\t\t\t\t.indexOf( id );\n\n\t\t\tgroups[ index ].destroy();\n\t\t\tgroups.splice( index, 1 );\n\t\t\tthis.set( 'ruleOptions', groups );\n\t\t\tthis.trigger( 'ruleGroupChange' );\n\t\t},\n\t} );\n\n\tAW.Rule = Backbone.Model.extend( {\n\t\tinitialize( group ) {\n\t\t\tthis.set( 'id', _.uniqueId( 'rule_' ) );\n\t\t\tthis.set( 'group', group );\n\n\t\t\tthis.resetOptions();\n\t\t},\n\n\t\tgetRuleObject() {\n\t\t\treturn data.allRules[ this.get( 'name' ) ];\n\t\t},\n\n\t\tresetOptions() {\n\t\t\tconst name = this.get( 'name' );\n\t\t\tconst ruleObject = this.getRuleObject();\n\n\t\t\tif ( name ) {\n\t\t\t\tthis.set( 'object', ruleObject );\n\t\t\t} else {\n\t\t\t\tthis.set( 'object', {} );\n\t\t\t}\n\n\t\t\tthis.set( 'compare', false );\n\t\t\tthis.set( 'value', false );\n\n\t\t\tthis.loadSelectOptions();\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * async gather rule select choices, if not already loaded\n\t\t */\n\t\tloadSelectOptions() {\n\t\t\tconst ruleObject = this.getRuleObject();\n\n\t\t\tif (\n\t\t\t\t! ruleObject ||\n\t\t\t\truleObject.type !== 'select' ||\n\t\t\t\truleObject.select_choices\n\t\t\t) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tthis.set( 'isValueLoading', true );\n\n\t\t\t$.getJSON(\n\t\t\t\tajaxurl,\n\t\t\t\t{\n\t\t\t\t\taction: 'aw_get_rule_select_choices',\n\t\t\t\t\trule_name: ruleObject.name,\n\t\t\t\t},\n\t\t\t\t( response ) => {\n\t\t\t\t\tif ( ! response.success ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\truleObject.select_choices = response.data.select_choices;\n\n\t\t\t\t\tthis.set( 'isValueLoading', false );\n\t\t\t\t\tthis.set( 'object', ruleObject );\n\t\t\t\t\tthis.trigger( 'optionsLoaded' );\n\t\t\t\t}\n\t\t\t);\n\n\t\t\treturn this;\n\t\t},\n\n\t\tclear() {\n\t\t\tconst group = this.get( 'group' );\n\t\t\tgroup.removeRule( this.id );\n\t\t},\n\n\t\tdestroy() {\n\t\t\tthis.trigger( 'destroy' );\n\t\t},\n\t} );\n\n\tAW.RuleGroup = Backbone.Model.extend( {\n\t\tinitialize( app ) {\n\t\t\tthis.set( 'id', _.uniqueId( 'rule_group_' ) );\n\t\t\tthis.set( 'app', app );\n\t\t\tthis.set( 'rules', [] );\n\t\t},\n\n\t\tcreateRule() {\n\t\t\tconst rules = this.get( 'rules' );\n\t\t\tconst rule = new AW.Rule( this );\n\t\t\trules.push( rule );\n\t\t\tthis.set( 'rules', rules );\n\t\t\treturn rule;\n\t\t},\n\n\t\tremoveRule( id ) {\n\t\t\tconst rules = this.get( 'rules' );\n\n\t\t\t// find rule index - note we cant use _.findIndex due to backwards compatibility\n\t\t\tconst index = rules\n\t\t\t\t.map( function ( rule ) {\n\t\t\t\t\treturn rule.id;\n\t\t\t\t} )\n\t\t\t\t.indexOf( id );\n\n\t\t\t// if only 1 rule left delete the whole group object\n\t\t\tif ( rules.length > 1 ) {\n\t\t\t\trules[ index ].destroy();\n\t\t\t\trules.splice( index, 1 );\n\t\t\t\tthis.set( 'rules', rules );\n\t\t\t} else {\n\t\t\t\trules[ index ].destroy(); // destroy the last rule\n\t\t\t\tthis.clear();\n\t\t\t}\n\t\t},\n\n\t\tclear() {\n\t\t\tconst app = this.get( 'app' );\n\t\t\tapp.removeGroup( this.id );\n\t\t},\n\n\t\tdestroy() {\n\t\t\tthis.trigger( 'destroy' );\n\t\t},\n\t} );\n\n\t// VIEWS\n\n\tAW.RuleView = Backbone.View.extend( {\n\t\tclassName: 'automatewoo-rule-container',\n\n\t\ttemplate: wp.template( 'aw-rule' ),\n\n\t\tevents: {\n\t\t\t'change .js-rule-select': 'updatedName',\n\t\t\t'change .js-rule-compare-field': 'updatedCompare',\n\t\t\t'change .js-rule-value-field': 'updatedValue',\n\t\t\t'click .js-remove-rule': 'clear',\n\t\t\t'change .js-rule-value-from': 'updateMinFromValueDate',\n\t\t},\n\n\t\tinitialize() {\n\t\t\tthis.listenTo( this.model, 'change:id', this.render );\n\t\t\tthis.listenTo( this.model, 'change:group', this.render );\n\t\t\tthis.listenTo( this.model, 'optionsLoaded', this.render );\n\t\t\tthis.listenTo( this.model, 'destroy', this.remove );\n\t\t},\n\n\t\trender() {\n\t\t\tthis.$el.html(\n\t\t\t\tthis.template( {\n\t\t\t\t\trule: this.model.toJSON(),\n\t\t\t\t\tgroupedRules: AW.rules.get( 'groupedRules' ),\n\t\t\t\t\tfieldNameBase: this.getFieldNameBase(),\n\t\t\t\t} )\n\t\t\t);\n\n\t\t\tthis.setName();\n\t\t\tthis.setCompare();\n\t\t\tthis.setValue();\n\t\t\tthis.maybeToggleValueDisplay();\n\t\t\tthis.initDatepicker();\n\n\t\t\t$( document.body ).trigger( 'wc-enhanced-select-init' );\n\n\t\t\treturn this;\n\t\t},\n\n\t\tsetName() {\n\t\t\tthis.$el.find( '.js-rule-select' ).val( this.model.get( 'name' ) );\n\t\t},\n\n\t\tsetCompare() {\n\t\t\tconst $compareField = this.$el.find( '.js-rule-compare-field' );\n\t\t\tconst compare = this.model.get( 'compare' );\n\n\t\t\t// Default selected value to first option.\n\t\t\tif ( $compareField.filter( 'select' ).length && ! compare ) {\n\t\t\t\tconst $option = $compareField.find( 'option:first-child' );\n\t\t\t\tconst optionValue = $compareField\n\t\t\t\t\t.find( 'option:first-child' )\n\t\t\t\t\t.prop( 'value' );\n\n\t\t\t\t$option.prop( 'selected', true );\n\t\t\t\t$compareField.val( optionValue );\n\t\t\t\tthis.model.set( 'compare', optionValue );\n\t\t\t}\n\n\t\t\tif ( compare ) {\n\t\t\t\t$compareField.val( compare );\n\t\t\t\t$compareField\n\t\t\t\t\t.find( 'option[value~=\"' + compare + '\"]' )\n\t\t\t\t\t.prop( 'selected', true );\n\t\t\t}\n\t\t},\n\n\t\tsetValue() {\n\t\t\tconst selectedTitle = this.model.get( 'selected' );\n\t\t\tconst selectedId = this.model.get( 'value' );\n\t\t\tlet $valueField;\n\n\t\t\tif ( selectedTitle ) {\n\t\t\t\t$valueField = this.$el.find( '.js-rule-value-field' );\n\n\t\t\t\tif ( $valueField.is( 'select' ) ) {\n\t\t\t\t\tif ( _.isArray( selectedId ) ) {\n\t\t\t\t\t\t_.each( selectedId, function ( id, i ) {\n\t\t\t\t\t\t\t$valueField.append(\n\t\t\t\t\t\t\t\t$( '<option>', {\n\t\t\t\t\t\t\t\t\tvalue: id,\n\t\t\t\t\t\t\t\t\ttext: selectedTitle[ i ],\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$valueField.append(\n\t\t\t\t\t\t\t$( '<option>', {\n\t\t\t\t\t\t\t\tvalue: selectedId,\n\t\t\t\t\t\t\t\ttext: selectedTitle,\n\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// wc 3.0\n\t\t\t\t\t$valueField.attr( 'data-selected', selectedTitle );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( selectedId ) {\n\t\t\t\tconst $fields = this.$el.find( '.js-rule-value-field' );\n\n\t\t\t\tif ( this.hasMultipleValueFields() ) {\n\t\t\t\t\tif ( _.isArray( selectedId ) ) {\n\t\t\t\t\t\t$fields.each( function ( i, el ) {\n\t\t\t\t\t\t\t$( el ).val( selectedId[ i ] );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( _.isObject( selectedId ) ) {\n\t\t\t\t\t\tObject.keys( selectedId ).forEach( ( key ) => {\n\t\t\t\t\t\t\t$( '.js-rule-value-' + key, this.$el ).val(\n\t\t\t\t\t\t\t\tselectedId[ key ]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$fields.val( selectedId );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tupdatedName( e ) {\n\t\t\tthis.model.set( 'name', e.target.value ).resetOptions();\n\t\t\tthis.render();\n\t\t},\n\n\t\tupdatedCompare( e ) {\n\t\t\tthis.model.set( 'compare', e.target.value );\n\t\t\tthis.render();\n\t\t},\n\n\t\t/**\n\t\t * There can be more than one value field.\n\t\t *\n\t\t * @param {Event} event\n\t\t */\n\t\tupdatedValue( event ) {\n\t\t\tlet value;\n\n\t\t\tif ( this.hasMultipleValueFields() ) {\n\t\t\t\tvalue = [];\n\n\t\t\t\tthis.$el.find( '.js-rule-value-field' ).each( function () {\n\t\t\t\t\tvalue.push( $( this ).val() );\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tvalue = event.target.value;\n\t\t\t}\n\n\t\t\tthis.model.set( 'value', value );\n\t\t},\n\n\t\tgetFieldNameBase() {\n\t\t\tconst id = this.model.get( 'id' );\n\t\t\tconst group = this.model.get( 'group' );\n\t\t\treturn (\n\t\t\t\t'aw_workflow_data[rule_options][' + group.id + '][' + id + ']'\n\t\t\t);\n\t\t},\n\n\t\tclear() {\n\t\t\tthis.model.clear();\n\t\t},\n\n\t\t/**\n\t\t * @return {boolean|undefined} Whether the model object `has_multiple_value_fields`.\n\t\t */\n\t\thasMultipleValueFields() {\n\t\t\tconst object = this.model.get( 'object' );\n\t\t\treturn object && object.has_multiple_value_fields;\n\t\t},\n\n\t\tmaybeToggleValueDisplay() {\n\t\t\tconst compare = this.model.get( 'compare' );\n\t\t\tconst $valueFields = this.$el.find( '[data-aw-compare]' );\n\n\t\t\tif ( $valueFields.length ) {\n\t\t\t\t// Hide value fields.\n\t\t\t\t$valueFields\n\t\t\t\t\t.addClass( 'aw-hidden' )\n\t\t\t\t\t.prop( 'required', false )\n\t\t\t\t\t.find( 'select, input' )\n\t\t\t\t\t.prop( 'required', false );\n\n\t\t\t\t// Show our selected rules.\n\t\t\t\t$valueFields\n\t\t\t\t\t.filter( '[data-aw-compare~=\"' + compare + '\"]' )\n\t\t\t\t\t.removeClass( 'aw-hidden' )\n\t\t\t\t\t.prop( 'required', true )\n\t\t\t\t\t.find( 'select, input' )\n\t\t\t\t\t.prop( 'required', true );\n\t\t\t}\n\t\t},\n\n\t\tinitDatepicker() {\n\t\t\tthis.$el.find( '.js-date-picker' ).datepicker( {\n\t\t\t\tdateFormat: 'yy-mm-dd',\n\t\t\t\tshowButtonPanel: true,\n\t\t\t} );\n\t\t},\n\n\t\tupdateMinFromValueDate() {\n\t\t\tconst $from = this.$el.find( '.js-rule-value-from' );\n\t\t\tconst $to = this.$el.find( '.js-rule-value-to' );\n\n\t\t\tif ( $from.length && $to.length ) {\n\t\t\t\t$to.datepicker( 'option', 'minDate', $from.val() );\n\t\t\t}\n\t\t},\n\t} );\n\n\tAW.RuleGroupView = Backbone.View.extend( {\n\t\tclassName: 'aw-rule-group',\n\n\t\ttemplate: wp.template( 'aw-rule-group' ),\n\n\t\tevents: {\n\t\t\t'click .js-add-rule': 'addRule',\n\t\t},\n\n\t\tinitialize() {\n\t\t\tthis.listenTo( this.model, 'refreshRules', this.refreshRules );\n\t\t\tthis.listenTo( this.model, 'change:id', this.refreshRules );\n\t\t\tthis.listenTo( this.model, 'destroy', this.remove );\n\t\t},\n\n\t\trender() {\n\t\t\tif ( this.model.get( 'rules' ).length ) {\n\t\t\t\tthis.$el.html( this.template( this.model.toJSON() ) );\n\n\t\t\t\tthis.$el.find( '.rules' ).empty();\n\n\t\t\t\t_.each( this.model.get( 'rules' ), ( rule ) => {\n\t\t\t\t\tconst view = new AW.RuleView( { model: rule } );\n\t\t\t\t\tthis.$el.find( '.rules' ).append( view.render().el );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t$( document.body ).trigger( 'wc-enhanced-select-init' );\n\n\t\t\treturn this;\n\t\t},\n\n\t\taddRule() {\n\t\t\tconst model = this.model.createRule();\n\t\t\tconst view = new AW.RuleView( { model } );\n\n\t\t\tthis.$el.find( '.rules' ).append( view.render().el );\n\n\t\t\t$( document.body ).trigger( 'wc-enhanced-select-init' );\n\n\t\t\treturn this;\n\t\t},\n\n\t\trefreshRules() {\n\t\t\t_.each( this.model.get( 'rules' ), function ( rule ) {\n\t\t\t\trule.trigger( 'change:group' );\n\t\t\t} );\n\t\t},\n\n\t\tclear() {\n\t\t\tthis.undelegateEvents();\n\t\t\tthis.model.clear();\n\t\t},\n\t} );\n\n\tAW.RulesView = Backbone.View.extend( {\n\t\t/**\n\t\t * Element\n\t\t */\n\t\tel: $( '#aw-rules-container' ),\n\n\t\t$meta_box: $( '#aw_rules_box' ),\n\n\t\ttemplate: wp.template( 'aw-rules-container' ),\n\n\t\tevents: {\n\t\t\t'click .js-add-rule-group': 'addGroup',\n\t\t},\n\n\t\tinitialize() {\n\t\t\tthis.listenTo(\n\t\t\t\tthis.model,\n\t\t\t\t'ruleGroupChange',\n\t\t\t\tthis.maybeShowEmptyMessage\n\t\t\t);\n\t\t\tthis.listenTo(\n\t\t\t\tthis.model,\n\t\t\t\t'change:groupedRules',\n\t\t\t\tthis.refreshRules\n\t\t\t);\n\n\t\t\tthis.render();\n\t\t},\n\n\t\trender() {\n\t\t\tconst trigger = AW.workflow.get( 'trigger' );\n\n\t\t\tthis.$el.html(\n\t\t\t\tthis.template( {\n\t\t\t\t\tapp: this,\n\t\t\t\t\ttrigger,\n\t\t\t\t} )\n\t\t\t);\n\n\t\t\tconst $groups = this.$el.find( '.aw-rule-groups' );\n\t\t\tconst groups = this.model.get( 'ruleOptions' );\n\n\t\t\tif ( groups.length ) {\n\t\t\t\t_.each( groups, function ( group ) {\n\t\t\t\t\tconst view = new AW.RuleGroupView( { model: group } );\n\t\t\t\t\t$groups.append( view.render().el );\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tthis.addEmptyMessage();\n\t\t\t}\n\n\t\t\t$( document.body ).trigger( 'wc-enhanced-select-init' );\n\n\t\t\treturn this;\n\t\t},\n\n\t\taddGroup() {\n\t\t\tconst model = this.model.createGroup();\n\t\t\tconst view = new AW.RuleGroupView( { model } );\n\n\t\t\tthis.$el.find( '.aw-rule-groups' ).append( view.render().el );\n\n\t\t\t$( document.body ).trigger( 'wc-enhanced-select-init' );\n\n\t\t\treturn this;\n\t\t},\n\n\t\tmaybeShowEmptyMessage() {\n\t\t\tif ( this.model.get( 'ruleOptions' ).length ) {\n\t\t\t\tthis.removeEmptyMessage();\n\t\t\t} else {\n\t\t\t\tthis.addEmptyMessage();\n\t\t\t}\n\t\t},\n\n\t\taddEmptyMessage() {\n\t\t\tthis.$el\n\t\t\t\t.find( '.aw-rule-groups' )\n\t\t\t\t.html( wp.template( 'aw-rule-groups-empty' ) );\n\t\t},\n\n\t\tremoveEmptyMessage() {\n\t\t\tthis.$el.find( '.aw-rules-empty-message' ).remove();\n\t\t},\n\n\t\trefreshRules() {\n\t\t\t_.each( this.model.get( 'ruleOptions' ), function ( group ) {\n\t\t\t\tgroup.trigger( 'refreshRules' );\n\t\t\t} );\n\t\t},\n\t} );\n\n\t$( function () {\n\t\tAW.rules = new AW.Rules( {\n\t\t\tallRules: data.allRules,\n\t\t\trawRuleOptions: data.ruleOptions,\n\t\t} );\n\n\t\tAW.rulesView = new AW.RulesView( {\n\t\t\tmodel: AW.rules,\n\t\t} );\n\t} );\n} )( jQuery, automatewooWorkflowLocalizeScript );\n"],"names":["$","data","AW","Rules","Backbone","Model","extend","initialize","ruleOptions","this","get","_","each","rawRuleGroup","group","RuleGroup","rules","rawRule","rule","Rule","set","name","resetOptions","compare","value","selected","push","resetAvailableRules","defaults","allRules","availableRules","trigger","workflow","filter","supplied_data_items","indexOf","data_item","groupedRules","isRuleAvailable","ruleName","names","pluck","clearIncompatibleRules","rulesToRemove","ruleGroup","clear","createGroup","groups","createRule","removeGroup","id","index","map","destroy","splice","uniqueId","getRuleObject","ruleObject","loadSelectOptions","type","select_choices","getJSON","ajaxurl","action","rule_name","response","success","removeRule","app","length","RuleView","View","className","template","wp","events","listenTo","model","render","remove","$el","html","toJSON","fieldNameBase","getFieldNameBase","setName","setCompare","setValue","maybeToggleValueDisplay","initDatepicker","document","body","find","val","$compareField","$option","optionValue","prop","selectedTitle","selectedId","$valueField","is","isArray","i","append","text","attr","$fields","hasMultipleValueFields","el","isObject","Object","keys","forEach","key","updatedName","e","target","updatedCompare","updatedValue","event","object","has_multiple_value_fields","$valueFields","addClass","removeClass","datepicker","dateFormat","showButtonPanel","updateMinFromValueDate","$from","$to","RuleGroupView","refreshRules","empty","view","addRule","undelegateEvents","RulesView","$meta_box","maybeShowEmptyMessage","$groups","addEmptyMessage","addGroup","removeEmptyMessage","rawRuleOptions","rulesView","jQuery","automatewooWorkflowLocalizeScript"],"sourceRoot":""}