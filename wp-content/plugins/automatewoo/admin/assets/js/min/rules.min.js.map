{"version":3,"file":"rules.min.js","mappings":"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","sources":["webpack://automatewoo/./admin/assets/js/rules.js"],"sourcesContent":["// Register eslint ignored glabals - to be revisited.\n// https://github.com/woocommerce/automatewoo/issues/1212\n/* global AW, Backbone, _, ajaxurl, automatewooWorkflowLocalizeScript */\n( function ( $, data ) {\n\t// MODELS\n\n\tAW.Rules = Backbone.Model.extend( {\n\t\tinitialize() {\n\t\t\tconst app = this;\n\t\t\tconst ruleOptions = [];\n\n\t\t\tif ( this.get( 'rawRuleOptions' ) ) {\n\t\t\t\t// convert rule options from json to models\n\n\t\t\t\t_.each(\n\t\t\t\t\tthis.get( 'rawRuleOptions' ),\n\t\t\t\t\tfunction ( rawRuleGroup ) {\n\t\t\t\t\t\tconst group = new AW.RuleGroup( app );\n\t\t\t\t\t\tconst rules = [];\n\n\t\t\t\t\t\t_.each( rawRuleGroup, function ( rawRule ) {\n\t\t\t\t\t\t\tconst rule = new AW.Rule( group );\n\n\t\t\t\t\t\t\trule.set( 'name', rawRule.name );\n\t\t\t\t\t\t\trule.resetOptions();\n\t\t\t\t\t\t\trule.set( 'compare', rawRule.compare );\n\t\t\t\t\t\t\trule.set( 'value', rawRule.value );\n\n\t\t\t\t\t\t\t// for objects\n\t\t\t\t\t\t\tif ( rawRule.selected ) {\n\t\t\t\t\t\t\t\trule.set( 'selected', rawRule.selected );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trules.push( rule );\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tgroup.set( 'rules', rules );\n\t\t\t\t\t\truleOptions.push( group );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.set( 'ruleOptions', ruleOptions );\n\n\t\t\tthis.resetAvailableRules();\n\t\t},\n\n\t\tdefaults() {\n\t\t\treturn {\n\t\t\t\tallRules: {},\n\t\t\t\tavailableRules: {},\n\n\t\t\t\t// array of condition group models\n\t\t\t\truleOptions: [],\n\t\t\t};\n\t\t},\n\n\t\tresetAvailableRules() {\n\t\t\t// calculate available conditions based on the selected trigger\n\n\t\t\tconst trigger = AW.workflow.get( 'trigger' );\n\n\t\t\tthis.set(\n\t\t\t\t'availableRules',\n\t\t\t\t_.filter( this.get( 'allRules' ), function ( rule ) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\ttrigger &&\n\t\t\t\t\t\ttrigger.supplied_data_items.indexOf(\n\t\t\t\t\t\t\trule.data_item\n\t\t\t\t\t\t) !== -1\n\t\t\t\t\t);\n\t\t\t\t} )\n\t\t\t);\n\n\t\t\t// put rules into groups for select\n\t\t\tconst groupedRules = {};\n\n\t\t\t_.each( this.get( 'availableRules' ), function ( rule ) {\n\t\t\t\tif ( ! groupedRules[ rule.group ] )\n\t\t\t\t\tgroupedRules[ rule.group ] = [];\n\t\t\t\tgroupedRules[ rule.group ].push( rule );\n\t\t\t} );\n\n\t\t\tthis.set( 'groupedRules', groupedRules );\n\t\t},\n\n\t\tisRuleAvailable( ruleName ) {\n\t\t\tconst availableRules = AW.rules.get( 'availableRules' );\n\t\t\tconst names = _.pluck( availableRules, 'name' );\n\t\t\treturn _.indexOf( names, ruleName ) !== -1;\n\t\t},\n\n\t\tclearIncompatibleRules() {\n\t\t\tconst rulesToRemove = [];\n\n\t\t\t_.each( AW.rules.get( 'ruleOptions' ), function ( ruleGroup ) {\n\t\t\t\t_.each( ruleGroup.get( 'rules' ), function ( rule ) {\n\t\t\t\t\tif (\n\t\t\t\t\t\trule &&\n\t\t\t\t\t\t! AW.rules.isRuleAvailable( rule.get( 'name' ) )\n\t\t\t\t\t) {\n\t\t\t\t\t\trulesToRemove.push( rule );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t\t// clear out of initial loop to avoid index changing issues, when rules are cleared\n\t\t\t_.each( rulesToRemove, function ( rule ) {\n\t\t\t\trule.clear();\n\t\t\t} );\n\t\t},\n\n\t\tcreateGroup() {\n\t\t\tconst groups = this.get( 'ruleOptions' );\n\n\t\t\tconst group = new AW.RuleGroup( this );\n\t\t\tgroup.createRule();\n\t\t\tgroups.push( group );\n\n\t\t\tthis.set( 'ruleOptions', groups );\n\t\t\tthis.trigger( 'ruleGroupChange' );\n\n\t\t\treturn group;\n\t\t},\n\n\t\tremoveGroup( id ) {\n\t\t\tconst groups = this.get( 'ruleOptions' );\n\n\t\t\t// find index - note we cant use _.findIndex due to backwards compatibility\n\t\t\tconst index = groups\n\t\t\t\t.map( function ( group ) {\n\t\t\t\t\treturn group.id;\n\t\t\t\t} )\n\t\t\t\t.indexOf( id );\n\n\t\t\tgroups[ index ].destroy();\n\t\t\tgroups.splice( index, 1 );\n\t\t\tthis.set( 'ruleOptions', groups );\n\t\t\tthis.trigger( 'ruleGroupChange' );\n\t\t},\n\t} );\n\n\tAW.Rule = Backbone.Model.extend( {\n\t\tinitialize( group ) {\n\t\t\tthis.set( 'id', _.uniqueId( 'rule_' ) );\n\t\t\tthis.set( 'group', group );\n\n\t\t\tthis.resetOptions();\n\t\t},\n\n\t\tgetRuleObject() {\n\t\t\treturn data.allRules[ this.get( 'name' ) ];\n\t\t},\n\n\t\tresetOptions() {\n\t\t\tconst name = this.get( 'name' );\n\t\t\tconst ruleObject = this.getRuleObject();\n\n\t\t\tif ( name ) {\n\t\t\t\tthis.set( 'object', ruleObject );\n\t\t\t} else {\n\t\t\t\tthis.set( 'object', {} );\n\t\t\t}\n\n\t\t\tthis.set( 'compare', false );\n\t\t\tthis.set( 'value', false );\n\n\t\t\tthis.loadSelectOptions();\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * async gather rule select choices, if not already loaded\n\t\t */\n\t\tloadSelectOptions() {\n\t\t\tconst self = this;\n\t\t\tconst ruleObject = this.getRuleObject();\n\n\t\t\tif (\n\t\t\t\t! ruleObject ||\n\t\t\t\truleObject.type !== 'select' ||\n\t\t\t\truleObject.select_choices\n\t\t\t) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tself.set( 'isValueLoading', true );\n\n\t\t\t$.getJSON(\n\t\t\t\tajaxurl,\n\t\t\t\t{\n\t\t\t\t\taction: 'aw_get_rule_select_choices',\n\t\t\t\t\trule_name: ruleObject.name,\n\t\t\t\t},\n\t\t\t\tfunction ( response ) {\n\t\t\t\t\tif ( ! response.success ) return;\n\n\t\t\t\t\truleObject.select_choices = response.data.select_choices;\n\n\t\t\t\t\tself.set( 'isValueLoading', false );\n\t\t\t\t\tself.set( 'object', ruleObject );\n\t\t\t\t\tself.trigger( 'optionsLoaded' );\n\t\t\t\t}\n\t\t\t);\n\n\t\t\treturn this;\n\t\t},\n\n\t\tclear() {\n\t\t\tconst group = this.get( 'group' );\n\t\t\tgroup.removeRule( this.id );\n\t\t},\n\n\t\tdestroy() {\n\t\t\tthis.trigger( 'destroy' );\n\t\t},\n\t} );\n\n\tAW.RuleGroup = Backbone.Model.extend( {\n\t\tinitialize( app ) {\n\t\t\tthis.set( 'id', _.uniqueId( 'rule_group_' ) );\n\t\t\tthis.set( 'app', app );\n\t\t\tthis.set( 'rules', [] );\n\t\t},\n\n\t\tcreateRule() {\n\t\t\tconst rules = this.get( 'rules' );\n\t\t\tconst rule = new AW.Rule( this );\n\t\t\trules.push( rule );\n\t\t\tthis.set( 'rules', rules );\n\t\t\treturn rule;\n\t\t},\n\n\t\tremoveRule( id ) {\n\t\t\tconst rules = this.get( 'rules' );\n\n\t\t\t// find rule index - note we cant use _.findIndex due to backwards compatibility\n\t\t\tconst index = rules\n\t\t\t\t.map( function ( rule ) {\n\t\t\t\t\treturn rule.id;\n\t\t\t\t} )\n\t\t\t\t.indexOf( id );\n\n\t\t\t// if only 1 rule left delete the whole group object\n\t\t\tif ( rules.length > 1 ) {\n\t\t\t\trules[ index ].destroy();\n\t\t\t\trules.splice( index, 1 );\n\t\t\t\tthis.set( 'rules', rules );\n\t\t\t} else {\n\t\t\t\trules[ index ].destroy(); // destroy the last rule\n\t\t\t\tthis.clear();\n\t\t\t}\n\t\t},\n\n\t\tclear() {\n\t\t\tconst app = this.get( 'app' );\n\t\t\tapp.removeGroup( this.id );\n\t\t},\n\n\t\tdestroy() {\n\t\t\tthis.trigger( 'destroy' );\n\t\t},\n\t} );\n\n\t// VIEWS\n\n\tAW.RuleView = Backbone.View.extend( {\n\t\tclassName: 'automatewoo-rule-container',\n\n\t\ttemplate: wp.template( 'aw-rule' ),\n\n\t\tevents: {\n\t\t\t'change .js-rule-select': 'updatedName',\n\t\t\t'change .js-rule-compare-field': 'updatedCompare',\n\t\t\t'change .js-rule-value-field': 'updatedValue',\n\t\t\t'click .js-remove-rule': 'clear',\n\t\t\t'change .js-rule-value-from': 'updateMinFromValueDate',\n\t\t},\n\n\t\tinitialize() {\n\t\t\tthis.listenTo( this.model, 'change:id', this.render );\n\t\t\tthis.listenTo( this.model, 'change:group', this.render );\n\t\t\tthis.listenTo( this.model, 'optionsLoaded', this.render );\n\t\t\tthis.listenTo( this.model, 'destroy', this.remove );\n\t\t},\n\n\t\trender() {\n\t\t\tconst self = this;\n\n\t\t\tself.$el.html(\n\t\t\t\tself.template( {\n\t\t\t\t\trule: self.model.toJSON(),\n\t\t\t\t\tgroupedRules: AW.rules.get( 'groupedRules' ),\n\t\t\t\t\tfieldNameBase: self.getFieldNameBase(),\n\t\t\t\t} )\n\t\t\t);\n\n\t\t\tself.setName();\n\t\t\tself.setCompare();\n\t\t\tself.setValue();\n\t\t\tself.maybeToggleValueDisplay();\n\t\t\tself.initDatepicker();\n\n\t\t\t$( document.body ).trigger( 'wc-enhanced-select-init' );\n\n\t\t\treturn this;\n\t\t},\n\n\t\tsetName() {\n\t\t\tthis.$el.find( '.js-rule-select' ).val( this.model.get( 'name' ) );\n\t\t},\n\n\t\tsetCompare() {\n\t\t\tconst $compareField = this.$el.find( '.js-rule-compare-field' );\n\t\t\tconst compare = this.model.get( 'compare' );\n\n\t\t\t// Default selected value to first option.\n\t\t\tif ( $compareField.filter( 'select' ).length && ! compare ) {\n\t\t\t\tconst $option = $compareField.find( 'option:first-child' );\n\t\t\t\tconst optionValue = $compareField\n\t\t\t\t\t.find( 'option:first-child' )\n\t\t\t\t\t.prop( 'value' );\n\n\t\t\t\t$option.prop( 'selected', true );\n\t\t\t\t$compareField.val( optionValue );\n\t\t\t\tthis.model.set( 'compare', optionValue );\n\t\t\t}\n\n\t\t\tif ( compare ) {\n\t\t\t\t$compareField.val( compare );\n\t\t\t\t$compareField\n\t\t\t\t\t.find( 'option[value~=\"' + compare + '\"]' )\n\t\t\t\t\t.prop( 'selected', true );\n\t\t\t}\n\t\t},\n\n\t\tsetValue() {\n\t\t\tconst selectedTitle = this.model.get( 'selected' );\n\t\t\tconst selectedId = this.model.get( 'value' );\n\t\t\tlet $valueField;\n\n\t\t\tif ( selectedTitle ) {\n\t\t\t\t$valueField = this.$el.find( '.js-rule-value-field' );\n\n\t\t\t\tif ( $valueField.is( 'select' ) ) {\n\t\t\t\t\tif ( _.isArray( selectedId ) ) {\n\t\t\t\t\t\t_.each( selectedId, function ( id, i ) {\n\t\t\t\t\t\t\t$valueField.append(\n\t\t\t\t\t\t\t\t$( '<option>', {\n\t\t\t\t\t\t\t\t\tvalue: id,\n\t\t\t\t\t\t\t\t\ttext: selectedTitle[ i ],\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$valueField.append(\n\t\t\t\t\t\t\t$( '<option>', {\n\t\t\t\t\t\t\t\tvalue: selectedId,\n\t\t\t\t\t\t\t\ttext: selectedTitle,\n\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// wc 3.0\n\t\t\t\t\t$valueField.attr( 'data-selected', selectedTitle );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( selectedId ) {\n\t\t\t\tconst $fields = this.$el.find( '.js-rule-value-field' );\n\t\t\t\tconst thisModel = this;\n\n\t\t\t\tif ( this.hasMultipleValueFields() ) {\n\t\t\t\t\tif ( _.isArray( selectedId ) ) {\n\t\t\t\t\t\t$fields.each( function ( i, el ) {\n\t\t\t\t\t\t\t$( el ).val( selectedId[ i ] );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( _.isObject( selectedId ) ) {\n\t\t\t\t\t\tObject.keys( selectedId ).forEach( function ( key ) {\n\t\t\t\t\t\t\t$( '.js-rule-value-' + key, thisModel.$el ).val(\n\t\t\t\t\t\t\t\tselectedId[ key ]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$fields.val( selectedId );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tupdatedName( e ) {\n\t\t\tthis.model.set( 'name', e.target.value ).resetOptions();\n\t\t\tthis.render();\n\t\t},\n\n\t\tupdatedCompare( e ) {\n\t\t\tthis.model.set( 'compare', e.target.value );\n\t\t\tthis.render();\n\t\t},\n\n\t\t/**\n\t\t * There can be more than one value field.\n\t\t *\n\t\t * @param {Event} event\n\t\t */\n\t\tupdatedValue( event ) {\n\t\t\tlet value;\n\n\t\t\tif ( this.hasMultipleValueFields() ) {\n\t\t\t\tvalue = [];\n\n\t\t\t\tthis.$el.find( '.js-rule-value-field' ).each( function () {\n\t\t\t\t\tvalue.push( $( this ).val() );\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tvalue = event.target.value;\n\t\t\t}\n\n\t\t\tthis.model.set( 'value', value );\n\t\t},\n\n\t\tgetFieldNameBase() {\n\t\t\tconst id = this.model.get( 'id' );\n\t\t\tconst group = this.model.get( 'group' );\n\t\t\treturn (\n\t\t\t\t'aw_workflow_data[rule_options][' + group.id + '][' + id + ']'\n\t\t\t);\n\t\t},\n\n\t\tclear() {\n\t\t\tthis.model.clear();\n\t\t},\n\n\t\t/**\n\t\t * @return {boolean|undefined} Whether the model object `has_multiple_value_fields`.\n\t\t */\n\t\thasMultipleValueFields() {\n\t\t\tconst object = this.model.get( 'object' );\n\t\t\treturn object && object.has_multiple_value_fields;\n\t\t},\n\n\t\tmaybeToggleValueDisplay() {\n\t\t\tconst compare = this.model.get( 'compare' );\n\t\t\tconst $valueFields = this.$el.find( '[data-aw-compare]' );\n\n\t\t\tif ( $valueFields.length ) {\n\t\t\t\t// Hide value fields.\n\t\t\t\t$valueFields\n\t\t\t\t\t.addClass( 'aw-hidden' )\n\t\t\t\t\t.prop( 'required', false )\n\t\t\t\t\t.find( 'select, input' )\n\t\t\t\t\t.prop( 'required', false );\n\n\t\t\t\t// Show our selected rules.\n\t\t\t\t$valueFields\n\t\t\t\t\t.filter( '[data-aw-compare~=\"' + compare + '\"]' )\n\t\t\t\t\t.removeClass( 'aw-hidden' )\n\t\t\t\t\t.prop( 'required', true )\n\t\t\t\t\t.find( 'select, input' )\n\t\t\t\t\t.prop( 'required', true );\n\t\t\t}\n\t\t},\n\n\t\tinitDatepicker() {\n\t\t\tthis.$el.find( '.js-date-picker' ).datepicker( {\n\t\t\t\tdateFormat: 'yy-mm-dd',\n\t\t\t\tshowButtonPanel: true,\n\t\t\t} );\n\t\t},\n\n\t\tupdateMinFromValueDate() {\n\t\t\tconst $from = this.$el.find( '.js-rule-value-from' );\n\t\t\tconst $to = this.$el.find( '.js-rule-value-to' );\n\n\t\t\tif ( $from.length && $to.length ) {\n\t\t\t\t$to.datepicker( 'option', 'minDate', $from.val() );\n\t\t\t}\n\t\t},\n\t} );\n\n\tAW.RuleGroupView = Backbone.View.extend( {\n\t\tclassName: 'aw-rule-group',\n\n\t\ttemplate: wp.template( 'aw-rule-group' ),\n\n\t\tevents: {\n\t\t\t'click .js-add-rule': 'addRule',\n\t\t},\n\n\t\tinitialize() {\n\t\t\tthis.listenTo( this.model, 'refreshRules', this.refreshRules );\n\t\t\tthis.listenTo( this.model, 'change:id', this.refreshRules );\n\t\t\tthis.listenTo( this.model, 'destroy', this.remove );\n\t\t},\n\n\t\trender() {\n\t\t\tconst self = this;\n\n\t\t\tif ( self.model.get( 'rules' ).length ) {\n\t\t\t\tself.$el.html( self.template( self.model.toJSON() ) );\n\n\t\t\t\tself.$el.find( '.rules' ).empty();\n\n\t\t\t\t_.each( self.model.get( 'rules' ), function ( rule ) {\n\t\t\t\t\tconst view = new AW.RuleView( { model: rule } );\n\t\t\t\t\tself.$el.find( '.rules' ).append( view.render().el );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t$( document.body ).trigger( 'wc-enhanced-select-init' );\n\n\t\t\treturn this;\n\t\t},\n\n\t\taddRule() {\n\t\t\tconst model = this.model.createRule();\n\t\t\tconst view = new AW.RuleView( { model } );\n\n\t\t\tthis.$el.find( '.rules' ).append( view.render().el );\n\n\t\t\t$( document.body ).trigger( 'wc-enhanced-select-init' );\n\n\t\t\treturn this;\n\t\t},\n\n\t\trefreshRules() {\n\t\t\t_.each( this.model.get( 'rules' ), function ( rule ) {\n\t\t\t\trule.trigger( 'change:group' );\n\t\t\t} );\n\t\t},\n\n\t\tclear() {\n\t\t\tthis.undelegateEvents();\n\t\t\tthis.model.clear();\n\t\t},\n\t} );\n\n\tAW.RulesView = Backbone.View.extend( {\n\t\t/**\n\t\t * Element\n\t\t */\n\t\tel: $( '#aw-rules-container' ),\n\n\t\t$meta_box: $( '#aw_rules_box' ),\n\n\t\ttemplate: wp.template( 'aw-rules-container' ),\n\n\t\tevents: {\n\t\t\t'click .js-add-rule-group': 'addGroup',\n\t\t},\n\n\t\tinitialize() {\n\t\t\tthis.listenTo(\n\t\t\t\tthis.model,\n\t\t\t\t'ruleGroupChange',\n\t\t\t\tthis.maybeShowEmptyMessage\n\t\t\t);\n\t\t\tthis.listenTo(\n\t\t\t\tthis.model,\n\t\t\t\t'change:groupedRules',\n\t\t\t\tthis.refreshRules\n\t\t\t);\n\n\t\t\tthis.render();\n\t\t},\n\n\t\trender() {\n\t\t\tconst self = this,\n\t\t\t\ttrigger = AW.workflow.get( 'trigger' );\n\n\t\t\tself.$el.html(\n\t\t\t\tself.template( {\n\t\t\t\t\tapp: self,\n\t\t\t\t\ttrigger,\n\t\t\t\t} )\n\t\t\t);\n\n\t\t\tconst $groups = self.$el.find( '.aw-rule-groups' );\n\t\t\tconst groups = self.model.get( 'ruleOptions' );\n\n\t\t\tif ( groups.length ) {\n\t\t\t\t_.each( groups, function ( group ) {\n\t\t\t\t\tconst view = new AW.RuleGroupView( { model: group } );\n\t\t\t\t\t$groups.append( view.render().el );\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tthis.addEmptyMessage();\n\t\t\t}\n\n\t\t\t$( document.body ).trigger( 'wc-enhanced-select-init' );\n\n\t\t\treturn this;\n\t\t},\n\n\t\taddGroup() {\n\t\t\tconst model = this.model.createGroup();\n\t\t\tconst view = new AW.RuleGroupView( { model } );\n\n\t\t\tthis.$el.find( '.aw-rule-groups' ).append( view.render().el );\n\n\t\t\t$( document.body ).trigger( 'wc-enhanced-select-init' );\n\n\t\t\treturn this;\n\t\t},\n\n\t\tmaybeShowEmptyMessage() {\n\t\t\tif ( this.model.get( 'ruleOptions' ).length ) {\n\t\t\t\tthis.removeEmptyMessage();\n\t\t\t} else {\n\t\t\t\tthis.addEmptyMessage();\n\t\t\t}\n\t\t},\n\n\t\taddEmptyMessage() {\n\t\t\tthis.$el\n\t\t\t\t.find( '.aw-rule-groups' )\n\t\t\t\t.html( wp.template( 'aw-rule-groups-empty' ) );\n\t\t},\n\n\t\tremoveEmptyMessage() {\n\t\t\tthis.$el.find( '.aw-rules-empty-message' ).remove();\n\t\t},\n\n\t\trefreshRules() {\n\t\t\t_.each( this.model.get( 'ruleOptions' ), function ( group ) {\n\t\t\t\tgroup.trigger( 'refreshRules' );\n\t\t\t} );\n\t\t},\n\t} );\n\n\t$( function () {\n\t\tAW.rules = new AW.Rules( {\n\t\t\tallRules: data.allRules,\n\t\t\trawRuleOptions: data.ruleOptions,\n\t\t} );\n\n\t\tAW.rulesView = new AW.RulesView( {\n\t\t\tmodel: AW.rules,\n\t\t} );\n\t} );\n} )( jQuery, automatewooWorkflowLocalizeScript );\n"],"names":["$","data","AW","Rules","Backbone","Model","extend","initialize","app","this","ruleOptions","get","_","each","rawRuleGroup","group","RuleGroup","rules","rawRule","rule","Rule","set","name","resetOptions","compare","value","selected","push","resetAvailableRules","defaults","allRules","availableRules","trigger","workflow","filter","supplied_data_items","indexOf","data_item","groupedRules","isRuleAvailable","ruleName","names","pluck","clearIncompatibleRules","rulesToRemove","ruleGroup","clear","createGroup","groups","createRule","removeGroup","id","index","map","destroy","splice","uniqueId","getRuleObject","ruleObject","loadSelectOptions","self","type","select_choices","getJSON","ajaxurl","action","rule_name","response","success","removeRule","length","RuleView","View","className","template","wp","events","listenTo","model","render","remove","$el","html","toJSON","fieldNameBase","getFieldNameBase","setName","setCompare","setValue","maybeToggleValueDisplay","initDatepicker","document","body","find","val","$compareField","$option","optionValue","prop","selectedTitle","selectedId","$valueField","is","isArray","i","append","text","attr","$fields","thisModel","hasMultipleValueFields","el","isObject","Object","keys","forEach","key","updatedName","e","target","updatedCompare","updatedValue","event","object","has_multiple_value_fields","$valueFields","addClass","removeClass","datepicker","dateFormat","showButtonPanel","updateMinFromValueDate","$from","$to","RuleGroupView","refreshRules","empty","view","addRule","undelegateEvents","RulesView","$meta_box","maybeShowEmptyMessage","$groups","addEmptyMessage","addGroup","removeEmptyMessage","rawRuleOptions","rulesView","jQuery","automatewooWorkflowLocalizeScript"],"sourceRoot":""}