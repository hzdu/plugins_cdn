{"version":3,"file":"rules.min.js","names":["$","data","AW","Rules","Backbone","Model","extend","initialize","app","this","ruleOptions","get","_","each","rawRuleGroup","group","RuleGroup","rules","rawRule","rule","Rule","set","name","resetOptions","compare","value","selected","push","resetAvailableRules","defaults","allRules","availableRules","trigger","workflow","filter","supplied_data_items","indexOf","data_item","groupedRules","isRuleAvailable","rule_name","names","pluck","clearIncompatibleRules","rulesToRemove","ruleGroup","clear","createGroup","groups","createRule","removeGroup","id","index","map","destroy","splice","uniqueId","getRuleObject","ruleObject","loadSelectOptions","self","type","select_choices","getJSON","ajaxurl","action","response","success","removeRule","length","RuleView","View","className","template","wp","events","listenTo","model","render","remove","$el","html","toJSON","fieldNameBase","getFieldNameBase","setName","setCompare","setValue","maybeToggleValueDisplay","initDatepicker","document","body","find","val","$compareField","$option","optionValue","prop","$value_field","selected_title","selected_id","is","isArray","i","append","text","attr","$fields","thisModel","hasMultipleValueFields","el","isObject","Object","keys","forEach","key","updatedName","e","target","updatedCompare","updatedValue","object","has_multiple_value_fields","$valueFields","addClass","removeClass","datepicker","dateFormat","showButtonPanel","updateMinFromValueDate","$from","$to","RuleGroupView","refreshRules","empty","view","addRule","undelegateEvents","RulesView","$meta_box","maybeShowEmptyMessage","$groups","addEmptyMessage","addGroup","removeEmptyMessage","rawRuleOptions","rulesView","jQuery","automatewooWorkflowLocalizeScript"],"sources":["rules.js"],"sourcesContent":["(function( $, data ) {\n\n    // MODELS\n\n    AW.Rules = Backbone.Model.extend({\n\n\n        initialize: function() {\n\n            var app = this;\n            var ruleOptions = [];\n\n            if ( this.get( 'rawRuleOptions' ) ) {\n\n                // convert rule options from json to models\n\n                _.each( this.get( 'rawRuleOptions' ), function( rawRuleGroup ) {\n\n                    var group = new AW.RuleGroup( app );\n                    var rules = [];\n\n                    _.each( rawRuleGroup, function( rawRule ) {\n\n                        var rule = new AW.Rule( group );\n\n                        rule.set('name', rawRule.name );\n                        rule.resetOptions();\n                        rule.set('compare', rawRule.compare );\n                        rule.set('value', rawRule.value );\n\n                        // for objects\n                        if ( rawRule.selected ) {\n                            rule.set( 'selected', rawRule.selected );\n                        }\n\n                        rules.push( rule );\n                    });\n\n                    group.set( 'rules', rules );\n                    ruleOptions.push( group );\n\n                });\n\n            }\n\n            this.set('ruleOptions', ruleOptions );\n\n            this.resetAvailableRules();\n        },\n\n\n        defaults: function() {\n            return {\n\n                allRules: {},\n                availableRules: {},\n\n                // array of condition group models\n                ruleOptions: []\n\n            };\n        },\n\n\n        resetAvailableRules: function(){\n            // calculate available conditions based on the selected trigger\n\n            var trigger = AW.workflow.get('trigger');\n\n            this.set('availableRules', _.filter( this.get('allRules'), function(rule) {\n                return trigger && trigger.supplied_data_items.indexOf(rule.data_item) !== -1;\n            }));\n\n\n            // put rules into groups for select\n            var groupedRules = {};\n\n            _.each( this.get('availableRules'), function( rule ){\n\n                if ( ! groupedRules[rule.group] ) groupedRules[rule.group] = [];\n                groupedRules[rule.group].push(rule);\n\n            });\n\n            this.set( 'groupedRules', groupedRules );\n        },\n\n\n        isRuleAvailable: function( rule_name ) {\n            var availableRules = AW.rules.get('availableRules');\n            var names = _.pluck( availableRules, 'name' );\n            return _.indexOf( names, rule_name ) !== -1;\n        },\n\n\n        clearIncompatibleRules: function() {\n\n            var rulesToRemove = [];\n\n            _.each( AW.rules.get( 'ruleOptions' ), function( ruleGroup ) {\n                _.each( ruleGroup.get( 'rules' ), function( rule ) {\n                    if ( rule && ! AW.rules.isRuleAvailable( rule.get('name') ) ) {\n                        rulesToRemove.push( rule );\n                    }\n                });\n            });\n\n            // clear out of initial loop to avoid index changing issues, when rules are cleared\n            _.each( rulesToRemove, function( rule ) {\n                rule.clear();\n            });\n        },\n\n\n\n        createGroup: function() {\n\n            var groups = this.get('ruleOptions');\n\n            var group = new AW.RuleGroup( this );\n            group.createRule();\n            groups.push( group );\n\n            this.set( 'ruleOptions', groups );\n            this.trigger('ruleGroupChange');\n\n            return group;\n        },\n\n\n        removeGroup: function( id ) {\n\n            var groups = this.get('ruleOptions');\n\n            // find index - note we cant use _.findIndex due to backwards compatibility\n            var index = groups.map( function( group ) {\n                return group.id;\n            }).indexOf( id );\n\n            groups[index].destroy();\n            groups.splice( index, 1 );\n            this.set( 'ruleOptions', groups );\n            this.trigger('ruleGroupChange');\n        }\n\n    });\n\n\n\n    AW.Rule = Backbone.Model.extend({\n\n        initialize: function( group ) {\n            this.set( 'id', _.uniqueId( 'rule_' ) );\n            this.set( 'group', group );\n\n            this.resetOptions();\n        },\n\n\n        getRuleObject: function() {\n            return data.allRules[ this.get('name') ];\n        },\n\n\n        resetOptions: function() {\n\n            var name = this.get('name');\n            var ruleObject = this.getRuleObject();\n\n            if ( name ) {\n                this.set( 'object', ruleObject );\n            }\n            else {\n                this.set( 'object', {} );\n            }\n\n            this.set( 'compare', false );\n            this.set( 'value', false );\n\n            this.loadSelectOptions();\n\n            return this;\n        },\n\n\n\n        /**\n         * async gather rule select choices, if not already loaded\n         */\n        loadSelectOptions: function() {\n\n            var self = this;\n            var ruleObject = this.getRuleObject();\n\n            if ( ! ruleObject || ruleObject.type !== 'select' || ruleObject.select_choices ) {\n                return this;\n            }\n\n            self.set( 'isValueLoading', true );\n\n            $.getJSON( ajaxurl, {\n                action: 'aw_get_rule_select_choices',\n                rule_name: ruleObject.name\n            }, function( response ) {\n\n                if ( ! response.success )\n                    return;\n\n                ruleObject.select_choices = response.data.select_choices;\n\n                self.set( 'isValueLoading', false );\n                self.set( 'object', ruleObject );\n                self.trigger('optionsLoaded');\n            });\n\n            return this;\n        },\n\n\n        clear: function() {\n            var group = this.get('group');\n            group.removeRule( this.id );\n        },\n\n\n        destroy: function() {\n            this.trigger('destroy');\n        }\n\n    });\n\n\n\n    AW.RuleGroup = Backbone.Model.extend({\n\n        initialize: function( app ) {\n            this.set( 'id', _.uniqueId('rule_group_') );\n            this.set( 'app', app );\n            this.set( 'rules', [] );\n        },\n\n\n        createRule: function() {\n            var rules = this.get('rules');\n            var rule = new AW.Rule( this );\n            rules.push( rule );\n            this.set( 'rules', rules );\n            return rule;\n        },\n\n\n        removeRule: function( id ) {\n\n            var rules = this.get('rules');\n\n            // find rule index - note we cant use _.findIndex due to backwards compatibility\n            var index = rules.map( function( rule ) {\n                return rule.id;\n            }).indexOf( id );\n\n            // if only 1 rule left delete the whole group object\n            if ( rules.length > 1 ) {\n                rules[index].destroy();\n                rules.splice( index, 1 );\n                this.set( 'rules', rules );\n            }\n            else {\n                rules[index].destroy(); // destroy the last rule\n                this.clear();\n            }\n        },\n\n\n        clear: function() {\n            var app = this.get('app');\n            app.removeGroup( this.id );\n        },\n\n\n        destroy: function() {\n            this.trigger('destroy');\n        }\n\n    });\n\n\n    // VIEWS\n\n\n    AW.RuleView = Backbone.View.extend({\n\n        className: 'automatewoo-rule-container',\n\n        template: wp.template( 'aw-rule' ),\n\n        events: {\n            'change .js-rule-select': 'updatedName',\n            'change .js-rule-compare-field': 'updatedCompare',\n            'change .js-rule-value-field': 'updatedValue',\n            'click .js-remove-rule': 'clear',\n            'change .js-rule-value-from': 'updateMinFromValueDate',\n        },\n\n\n        initialize: function() {\n            this.listenTo( this.model, 'change:id', this.render );\n            this.listenTo( this.model, 'change:group', this.render );\n            this.listenTo( this.model, 'optionsLoaded', this.render );\n            this.listenTo( this.model, 'destroy', this.remove );\n        },\n\n\n        render: function() {\n\n            var self = this;\n\n            self.$el.html( self.template({\n                rule: self.model.toJSON(),\n                groupedRules: AW.rules.get('groupedRules'),\n                fieldNameBase: self.getFieldNameBase()\n            }));\n\n            self.setName();\n            self.setCompare();\n            self.setValue();\n            self.maybeToggleValueDisplay();\n            self.initDatepicker();\n\n            $(document.body).trigger('wc-enhanced-select-init');\n\n            return this;\n        },\n\n\n        setName: function() {\n            this.$el.find('.js-rule-select').val( this.model.get('name') );\n        },\n\n\n        setCompare: function() {\n            var $compareField = this.$el.find( '.js-rule-compare-field' );\n            var compare = this.model.get( 'compare' );\n\n            // Default selected value to first option.\n            if ( $compareField.filter( 'select' ).length && ! compare ) {\n                var $option = $compareField.find( 'option:first-child' );\n                var optionValue = $compareField.find( 'option:first-child' ).prop( 'value' );\n\n                $option.prop( 'selected', true );\n                $compareField.val( optionValue );\n                this.model.set( 'compare', optionValue );\n            }\n\n            if ( compare ) {\n                $compareField.val( compare );\n                $compareField.find( 'option[value~=\"' + compare + '\"]' ).prop( 'selected', true );\n            }\n        },\n\n\n        setValue: function() {\n            var selected_title = this.model.get('selected');\n            var selected_id = this.model.get('value');\n            var $value_field;\n\n            if ( selected_title ) {\n\n                $value_field = this.$el.find('.js-rule-value-field');\n\n                if ( $value_field.is('select') ) {\n\n                    if ( _.isArray( selected_id ) ) {\n                        _.each( selected_id, function( id, i ){\n                            $value_field.append( $('<option>', {\n                                value: id,\n                                text: selected_title[i],\n                            }) );\n                        });\n                    } else {\n                        $value_field.append( $('<option>', {\n                            value: selected_id,\n                            text: selected_title\n                        }) );\n                    }\n                }\n                else {\n                    // wc 3.0\n                    $value_field.attr( 'data-selected', selected_title );\n                }\n            }\n\n            if ( selected_id ) {\n\n                var $fields = this.$el.find('.js-rule-value-field');\n                var thisModel = this;\n\n                if ( this.hasMultipleValueFields() ) {\n                    if ( _.isArray( selected_id ) ) {\n                        $fields.each(function( i, el ){\n                            $(el).val( selected_id[i] );\n                        });\n                    }\n\n                    if ( _.isObject( selected_id ) ) {\n                        Object.keys( selected_id ).forEach( function (key) {\n                            $( '.js-rule-value-' + key, thisModel.$el ).val( selected_id[key] );\n                        } );\n                    }\n                }\n                else {\n                    $fields.val( selected_id );\n                }\n            }\n        },\n\n\n        updatedName: function(e) {\n            this.model.set( 'name', e.target.value ).resetOptions();\n            this.render();\n        },\n\n\n        updatedCompare: function(e) {\n            this.model.set( 'compare', e.target.value );\n            this.render();\n        },\n\n\n        /**\n         * there can be more than one value field\n         */\n        updatedValue: function(e) {\n\n            var value;\n\n            if ( this.hasMultipleValueFields() ) {\n                value = [];\n\n                this.$el.find('.js-rule-value-field').each(function() {\n                    value.push( $(this).val() );\n                });\n            }\n            else {\n                value = e.target.value;\n            }\n\n            this.model.set( 'value', value );\n        },\n\n\n        getFieldNameBase: function() {\n            var id = this.model.get( 'id' );\n            var group = this.model.get( 'group' );\n            return 'aw_workflow_data[rule_options]['+group.id+']['+id+']';\n        },\n\n\n        clear: function() {\n            this.model.clear();\n        },\n\n\n        /**\n         * @return boolean\n         */\n        hasMultipleValueFields: function() {\n            var object = this.model.get('object');\n            return object && object.has_multiple_value_fields;\n        },\n\n\n        maybeToggleValueDisplay: function () {\n            var compare = this.model.get( 'compare' );\n            var $valueFields = this.$el.find( '[data-aw-compare]' );\n\n            if ( $valueFields.length ) {\n                // Hide value fields.\n                $valueFields.addClass( 'aw-hidden' ).prop( 'required', false ).find( 'select, input' ).prop( 'required', false );\n\n                // Show our selected rules.\n                $valueFields.filter( '[data-aw-compare~=\"' + compare + '\"]' ).removeClass( 'aw-hidden' ).prop( 'required', true ).find( 'select, input' ).prop( 'required', true );\n            }\n        },\n\n        initDatepicker: function() {\n            this.$el.find( '.js-date-picker' ).datepicker( {\n                dateFormat: 'yy-mm-dd',\n                showButtonPanel: true,\n            } );\n        },\n\n        updateMinFromValueDate: function () {\n            var $from = this.$el.find( '.js-rule-value-from' );\n            var $to = this.$el.find( '.js-rule-value-to' );\n\n            if ( $from.length && $to.length ) {\n                $to.datepicker( 'option', 'minDate', $from.val() );\n            }\n        }\n    });\n\n\n\n\n    AW.RuleGroupView = Backbone.View.extend({\n\n        className: 'aw-rule-group',\n\n        template: wp.template( 'aw-rule-group' ),\n\n        events: {\n            'click .js-add-rule': 'addRule'\n        },\n\n\n        initialize: function() {\n            this.listenTo( this.model, 'refreshRules', this.refreshRules );\n            this.listenTo( this.model, 'change:id', this.refreshRules );\n            this.listenTo( this.model, 'destroy', this.remove );\n        },\n\n\n        render: function() {\n\n            var self = this;\n\n            if ( self.model.get('rules').length ) {\n                self.$el.html( self.template( self.model.toJSON() ) );\n\n                self.$el.find('.rules').empty();\n\n                _.each( self.model.get('rules'), function( rule ) {\n                    var view = new AW.RuleView({ model: rule } );\n                    self.$el.find( '.rules' ).append( view.render().el );\n                });\n            }\n\n            $(document.body).trigger('wc-enhanced-select-init');\n\n            return this;\n        },\n\n\n        addRule: function() {\n            var model = this.model.createRule();\n            var view = new AW.RuleView({ model: model } );\n\n            this.$el.find( '.rules').append( view.render().el );\n\n            $(document.body).trigger('wc-enhanced-select-init');\n\n            return this;\n        },\n\n\n        refreshRules: function() {\n            _.each(this.model.get('rules'), function( rule ) {\n                rule.trigger('change:group');\n            });\n        },\n\n\n        clear: function() {\n            this.undelegateEvents();\n            this.model.clear();\n        }\n\n    });\n\n\n\n    AW.RulesView = Backbone.View.extend({\n\n        /**\n         * Element\n         */\n        el: $( '#aw-rules-container' ),\n\n        $meta_box: $( '#aw_rules_box' ),\n\n        template: wp.template( 'aw-rules-container' ),\n\n        events: {\n            'click .js-add-rule-group': 'addGroup'\n        },\n\n\n        initialize: function(){\n            this.listenTo( this.model, 'ruleGroupChange', this.maybeShowEmptyMessage );\n            this.listenTo( this.model, 'change:groupedRules', this.refreshRules );\n\n            this.render();\n        },\n\n\n        render: function() {\n\n            var self = this,\n                trigger = AW.workflow.get('trigger');\n\n            self.$el.html( self.template({\n                app: self,\n                trigger: trigger\n            }));\n\n            var $groups = self.$el.find( '.aw-rule-groups' );\n            var groups = self.model.get('ruleOptions');\n\n            if ( groups.length ) {\n                _.each( groups, function( group ){\n                    var view = new AW.RuleGroupView({ model: group } );\n                    $groups.append( view.render().el );\n                });\n            }\n            else {\n                this.addEmptyMessage();\n            }\n\n\n            $(document.body).trigger('wc-enhanced-select-init');\n\n            return this;\n        },\n\n\n        addGroup: function() {\n            var model = this.model.createGroup();\n            var view = new AW.RuleGroupView({ model: model } );\n\n            this.$el.find( '.aw-rule-groups').append( view.render().el );\n\n            $(document.body).trigger('wc-enhanced-select-init');\n\n            return this;\n        },\n\n\n        maybeShowEmptyMessage: function() {\n            if ( this.model.get('ruleOptions').length ) {\n                this.removeEmptyMessage();\n            }\n            else {\n                this.addEmptyMessage();\n            }\n        },\n\n        addEmptyMessage: function() {\n            this.$el.find( '.aw-rule-groups' ).html( wp.template( 'aw-rule-groups-empty' ) );\n        },\n\n\n        removeEmptyMessage: function() {\n            this.$el.find('.aw-rules-empty-message').remove();\n        },\n\n\n        refreshRules: function() {\n            _.each( this.model.get('ruleOptions'), function( group ) {\n                group.trigger('refreshRules');\n            });\n        },\n\n\n    });\n\n\n    $(function(){\n\n        AW.rules = new AW.Rules({\n            allRules: data.allRules,\n            rawRuleOptions: data.ruleOptions\n        });\n\n        AW.rulesView = new AW.RulesView({\n            model: AW.rules\n        });\n\n    });\n\n\n\n})( jQuery, automatewooWorkflowLocalizeScript );\n"],"mappings":"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"}