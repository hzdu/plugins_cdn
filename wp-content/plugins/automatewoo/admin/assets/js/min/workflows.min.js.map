{"version":3,"file":"workflows.min.js","names":["$","data","AW","Workflow","Backbone","Model","extend","getAction","action_name","actions","workflow","get","WorkflowView","View","el","$triggerSelect","$triggerDescription","initialize","this","listenTo","model","changeTrigger","set","val","insertMetaboxHelpTips","rules","resetAvailableRules","document","body","trigger","initTooltips","Validate","validateAllFields","AutomateWoo","Workflows","trigger_compatibility_warning","workflowView","completeTriggerChange","clearIncompatibleRules","clearIncompatibleActions","Modal","close","refine_variables","refine_action_selects","maybe_disable_queueing","updateTriggerDescription","cancelTriggerChange","description","html","initAction","$action","attr","group","can_be_previewed","removeAttr","find","each","i","initDynamicActionSelect","action_dependent_fields","$field","reference_field_name","$reference_field","on","updateDynamicActionSelect","is","remove","$fieldRow","parents","addClass","action","target_field_name","reference_field_value","post","ajaxurl","response","removeClass","success","value","text","append","tips","_","tip_html","id","$metabox","TriggerCompatibilityModalView","className","template","wp","$el","render","TriggerPresetActivationModalView","modalView","disableButtons","open","contents","tracks","recordEvent","is_active","isActive","addEventListener","once","init","jQuery","automatewooWorkflowLocalizeScript","init_customer_win_back_trigger","$min_field","$max_field","min_val","parseInt","placeholder","$triggers_box","$manual_workflow_box","$actions_box","$actions_container","$action_template","$trigger_select","first","$manual_trigger_select","init_triggers_box","init_actions_box","init_options_box","fill_trigger_fields","fill_manual_workflow_trigger_fields","action_edit_open","e","preventDefault","add_new_action","action_edit_close","action_delete","fill_action_fields","preview_action","$checkbox_click_tracking","maybe_hide_tracking_options","show","hide","trigger_name","fetch_trigger_data","done","fields","ajax","method","url","workflow_id","is_new_workflow","$new_action","action_number","get_number_of_actions","clone","get_editing_action_cookie_name","slideDown","Cookies","sameSite","$this","$dependency","$parentRow","closest","$checkbox","checked","slideUp","selected_action","$select","title","length","inArray","supplied_data_items","prop","is_action_compatible_with_current_trigger","allow_queueing","incompatibleRules","incompatibleActions","ruleGroup","rule","isRuleAvailable","ruleObject","push","uniq","compatible","required_data_items","name_selector","isEmailPreviewOpen","tinyMCE","triggerSave","field_name","element_name","is_grouped","test","replace","hasOwnProperty","openLoadingEmailPreview","name","action_fields","open_email_preview","complete","init_ajax_wysiwyg","tinymce","tinyMCEPreInit","mceInit","automatewoo_editor","qtInit","qtags","selector","wp_autoresize_on","hasClass","quicktags","init_wysiwyg_buttons","canvas","settings","theButtons","use","buttons","edButtons","indexOf","instance","inst","fullscreen","qt","FullscreenButton","getElementsByTagName","dir","textdirection","TextDirectionButton","toolbar","innerHTML","$form","isConfirmed","window","location","href","$typeSelectField","updateType","type","doReset","css","selectedIndex","init_workflow_type"],"sources":["workflows.js"],"sourcesContent":["/**\n * AutomateWoo Workflows Admin\n */\n(function( $, data ) {\n\tAW.Workflow = Backbone.Model.extend({\n\n\t\tgetAction: function( action_name ) {\n\t\t\tvar actions = AW.workflow.get('actions');\n\n\t\t\tif ( actions[action_name] ) {\n\t\t\t\treturn actions[action_name];\n\t\t\t}\n\t\t}\n\n\t});\n\n\n\tAW.WorkflowView = Backbone.View.extend({\n\n\t\tel: $( 'form#post' ),\n\n\t\t$triggerSelect: $('.js-trigger-select'),\n\n\t\t$triggerDescription: $('.js-trigger-description'),\n\n\n\t\tinitialize: function() {\n\n\t\t\tthis.listenTo( this.model, 'change:trigger', this.changeTrigger );\n\n\t\t\tthis.model.set( 'prevTrigger', this.$triggerSelect.val() );\n\n\t\t\tthis.insertMetaboxHelpTips();\n\n\t\t},\n\n\n\t\tchangeTrigger: function() {\n\n\t\t\tAW.rules.resetAvailableRules();\n\n            $(document.body).trigger('wc-enhanced-select-init');\n\t\t\tAW.initTooltips();\n\t\t\tAW.Validate.validateAllFields();\n\n\t\t\tif ( AutomateWoo.Workflows.trigger_compatibility_warning() ){\n\t\t\t\tAW.workflowView.completeTriggerChange();\n\t\t\t}\n\t\t},\n\n\n\t\tcompleteTriggerChange: function() {\n\n\t\t\tAW.rules.clearIncompatibleRules();\n\t\t\tAutomateWoo.Workflows.clearIncompatibleActions();\n\n\t\t\tAutomateWoo.Modal.close();\n\n\t\t\tAutomateWoo.Workflows.refine_variables();\n\t\t\tAutomateWoo.Workflows.refine_action_selects();\n\t\t\tAutomateWoo.Workflows.maybe_disable_queueing();\n\n\t\t\tthis.updateTriggerDescription();\n\n\t\t\t// update the prev trigger value\n\t\t\tthis.model.set( 'prevTrigger', this.$triggerSelect.val() );\n\n\t\t\t$(document.body).trigger('automatewoo_trigger_changed');\n\t\t},\n\n\n\t\tcancelTriggerChange: function() {\n\t\t\tthis.$triggerSelect.val( this.model.get('prevTrigger') ).trigger('change');\n\t\t},\n\n\n\t\t/**\n\t\t * Update the trigger description\n\t\t */\n\t\tupdateTriggerDescription: function() {\n\t\t\tvar trigger = this.model.get('trigger');\n\n\t\t\tif ( trigger && trigger.description ) {\n\t\t\t\tthis.$triggerDescription.html( '<p class=\"aw-field-description\">' + trigger.description + '</p>' );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.$triggerDescription.html('');\n\t\t\t}\n\t\t},\n\n\n\n\t\tinitAction: function( action_name, $action ) {\n\n\t\t\tvar data = this.model.getAction( action_name );\n\n\t\t\tif ( data ) {\n\t\t\t\t$action.attr( 'data-automatewoo-action-name', action_name );\n\t\t\t\t$action.attr( 'data-automatewoo-action-group', data.group );\n\t\t\t\t$action.attr( 'data-automatewoo-action-can-be-previewed', data.can_be_previewed );\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$action.removeAttr( 'data-automatewoo-action-name' );\n\t\t\t\t$action.removeAttr( 'data-automatewoo-action-group' );\n\t\t\t\t$action.removeAttr( 'data-automatewoo-action-can-be-previewed' );\n\t\t\t}\n\n\t\t\t// update dynamic fields\n\t\t\t$action.find( '[data-automatewoo-dynamic-select]' ).each(function( i, el ){\n\t\t\t\tAW.workflowView.initDynamicActionSelect( $(el), $action );\n\t\t\t});\n\n\t\t\tAW.initTooltips();\n\t\t\tAutomateWoo.Workflows.action_dependent_fields($action);\n\t\t},\n\n\n\t\tinitDynamicActionSelect: function( $field, $action ) {\n\n\t\t\tvar reference_field_name = $field.attr( 'data-automatewoo-dynamic-select-reference' );\n\t\t\tvar $reference_field = $action.find( '.automatewoo-field[data-name=\"' + reference_field_name + '\"]' );\n\n\t\t\t$reference_field.on( 'change', function() {\n\t\t\t\tAW.workflowView.updateDynamicActionSelect( $field, $reference_field, $action )\n\t\t\t});\n\t\t},\n\n\n\t\tupdateDynamicActionSelect: function( $field, $reference_field, $action ) {\n\n\t\t\tif ( $field.is( '.automatewoo-field--loading' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// remove existing options\n\t\t\t$field.find( \"option[value!='']\" ).remove();\n\n\t\t\tif ( ! $reference_field.val() ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar $fieldRow = $field.parents( '.automatewoo-table__row' );\n\t\t\t$fieldRow.addClass( 'automatewoo-field-row--loading' );\n\n\t\t\tvar data = {\n\t\t\t\taction: 'aw_update_dynamic_action_select',\n\t\t\t\taction_name: $action.data( 'automatewoo-action-name' ),\n\t\t\t\ttarget_field_name: $field.attr( 'data-name' ),\n\t\t\t\treference_field_value: $reference_field.val()\n\t\t\t};\n\n\t\t\t$.post( ajaxurl, data, function( response ) {\n\t\t\t\t$fieldRow.removeClass( 'automatewoo-field-row--loading' );\n\n\t\t\t\tif ( response.success ) {\n\t\t\t\t\t$.each( response.data, function ( value, text ) {\n\t\t\t\t\t\t$field.append( $('<option/>', {\n\t\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\t\ttext: text\n\t\t\t\t\t\t}));\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t});\n\t\t},\n\n\n\t\t/**\n\t\t * Add helplinks to top of meta box\n\t\t */\n\t\tinsertMetaboxHelpTips: function() {\n\t\t\tvar tips = this.model.get('metaBoxHelpTips');\n\n\t\t\t_.each( tips, function( tip_html, id ) {\n\t\t\t\t$metabox = $( '#aw_' + id );\n\t\t\t\t$metabox.find('h2.hndle').append(tip_html);\n\t\t\t});\n\t\t}\n\n\n\t});\n\n\n\n\tAW.TriggerCompatibilityModalView = Backbone.View.extend({\n\n\t\tclassName: 'aw-view-trigger-compatibility-modal',\n\n\t\ttemplate: wp.template('aw-trigger-compatibility-modal'),\n\n\t\tdata: null,\n\n\t\tinitialize: function( data ) {\n\t\t\tthis.data = data;\n\n\t\t\tthis.$el.on('click', '.js-confirm', function(){\n\t\t\t\tAW.workflowView.completeTriggerChange()\n\t\t\t});\n\n\t\t\tthis.$el.on('click', '.js-close-automatewoo-modal', function(){\n\t\t\t\tAW.workflowView.cancelTriggerChange()\n\t\t\t});\n\t\t},\n\n\t\trender: function() {\n\t\t\tthis.$el.html( this.template( this.data ));\n\t\t\treturn this;\n\t\t}\n\n\t});\n\n\tAW.TriggerPresetActivationModalView = Backbone.View.extend({\n\n\t\tclassName: 'aw-view-trigger-preset-activation-modal',\n\n\t\ttemplate: wp.template('aw-trigger-preset-activation-modal'),\n\n\t\tdata: null,\n\n\t\tinitialize: function( data ) {\n\t\t\tthis.data = data;\n\t\t\tlet modalView = this;\n\n\t\t\tthis.$el.on('click', '.js-confirm', function(){\n\t\t\t\tmodalView.disableButtons();\n\n\t\t\t\t// Close with applicable tracking action set up.\n\t\t\t\tdata.action = 'confirm';\n\t\t\t\tAutomateWoo.Modal.close();\n\n\t\t\t\t// submit\n\t\t\t\t$(AW.workflowView.el).data( 'aw-preset-workflow-confirmed', true ).trigger( 'submit' );\n\t\t\t});\n\n\t\t\tthis.$el.on('click', '.js-close-automatewoo-modal', function(){\n\t\t\t\tdata.action = 'cancel';\n\n\t\t\t\tmodalView.disableButtons();\n\t\t\t});\n\t\t},\n\n\t\tdisableButtons: function() {\n\t\t\tthis.$el.find('.automatewoo-modal__footer button').addClass('disabled');\n\t\t},\n\n\t\trender: function() {\n\t\t\tthis.$el.html( this.template( this.data ));\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Opens `AutomateWoo.Modal`, fills it with rendered message.\n\t\t * Record Tracking events `preset_activation_alert_rendered` when executed, \n\t\t * and 'preset_activation_alert_closed' with applicable `action` and `is_active` once eventually closed. \n\t\t */\n\t\topen: function() {\n\t\t\t// Once the modal is open, the default close action for built-in Modal close features is 'dismiss'.\n\t\t\tthis.data.action = 'dismiss';\n\n\t\t\tAutomateWoo.Modal.open();\n\t\t\tAutomateWoo.Modal.contents( this.render().el );\n\n\t\t\tAW.tracks.recordEvent( 'preset_activation_alert_rendered', { is_active: this.data.isActive } );\n\n\t\t\t// If the modal is dismissed by AutomateWoo.Modal features.\n\t\t\tdocument.body.addEventListener(\n\t\t\t\t'awmodal-close',\n\t\t\t\t() => AW.tracks.recordEvent( 'preset_activation_alert_closed', {\n\t\t\t\t\tis_active: this.data.isActive,\n\t\t\t\t\taction: this.data.action\n\t\t\t\t} ),\n\t\t\t\t{ once: true }\n\t\t\t);\n\t\t}\n\n\t});\n\n\n\tAW.workflow = new AW.Workflow( data );\n\n\tAW.workflowView = new AW.WorkflowView({\n\t\tmodel: AW.workflow\n\t});\n\n\tAW.Validate.init();\n\n\n})( jQuery, automatewooWorkflowLocalizeScript );\n\n\njQuery(function($) {\n\n\n\tAutomateWoo.Workflows = {\n\n\t\t$triggers_box: $('#aw_trigger_box'),\n\t\t$manual_workflow_box: $('#aw_manual_workflow_box'),\n\n\t\t$actions_box: $('#aw_actions_box'),\n\n\t\t$actions_container: $('.aw-actions-container'),\n\n\t\t$action_template: $('.aw-action-template'),\n\n\t\t$trigger_select: $('.js-trigger-select').first(),\n\t\t$manual_trigger_select: $('.js-manual-trigger-select').first(),\n\n\n\t\tinit: function() {\n\t\t\tAutomateWoo.Workflows.init_triggers_box();\n\t\t\tAutomateWoo.Workflows.init_actions_box();\n\t\t\tAutomateWoo.Workflows.init_options_box();\n\t\t},\n\n\n\n\t\t/**\n\t\t *\n\t\t */\n\t\tinit_triggers_box: function() {\n\t\t\tAutomateWoo.Workflows.$trigger_select.on( 'change', function(){\n\t\t\t\tAutomateWoo.Workflows.fill_trigger_fields( $(this).val() );\n\t\t\t});\n\n\t\t\tAutomateWoo.Workflows.$manual_trigger_select.on( 'change', function(){\n\t\t\t\tAutomateWoo.Workflows.fill_manual_workflow_trigger_fields( $(this).val() );\n\t\t\t});\n\t\t},\n\n\n\t\t/**\n\t\t *\n\t\t */\n\t\tinit_actions_box: function() {\n\n\n\t\t\t$('.automatewoo-action.js-open').each(function(){\n\t\t\t\tAutomateWoo.Workflows.action_edit_open( $(this) );\n\t\t\t});\n\n\n\t\t\t$('.js-aw-add-action').on( 'click', function (e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tAutomateWoo.Workflows.add_new_action();\n\t\t\t});\n\n\t\t\t$(document).on('click', '.js-edit-action', function (e) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tvar $action = $(this).parents('.automatewoo-action').first();\n\n\t\t\t\tif ($action.is('.js-open')) {\n\t\t\t\t\tAutomateWoo.Workflows.action_edit_close($action);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tAutomateWoo.Workflows.action_edit_open($action);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$(document).on('click', '.js-delete-action', function (e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar $action = $(this).parents('.automatewoo-action').first();\n\t\t\t\tAutomateWoo.Workflows.action_delete($action);\n\t\t\t});\n\n\t\t\t// Action select change\n\t\t\t$(document).on('change', '.js-action-select', function () {\n\t\t\t\tvar $action = $(this).parents('.automatewoo-action').first();\n\t\t\t\tAutomateWoo.Workflows.fill_action_fields( $action, $(this).val() );\n\t\t\t});\n\n\t\t\t// preview links\n\t\t\t$(document).on('click', '[data-automatewoo-preview]', function(e){\n\t\t\t\te.preventDefault();\n\t\t\t\tvar $action = $(this).parents('.automatewoo-action').first();\n\t\t\t\tAutomateWoo.Workflows.preview_action($action);\n\t\t\t});\n\n\n\t\t\tif ( ! AW.workflow.get('isNew') ) {\n\t\t\t\tAutomateWoo.Workflows.refine_action_selects();\n\t\t\t\tAutomateWoo.Workflows.refine_variables();\n\t\t\t\tAutomateWoo.Workflows.maybe_disable_queueing();\n\n\t\t\t\t$('.automatewoo-action').each(function( i, el ) {\n\t\t\t\t\tAW.workflowView.initAction( $(el).find('.js-action-select').val(), $(el) );\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\n\n\n\t\tinit_options_box: function() {\n\n\t\t\tvar $checkbox_click_tracking = $('.aw-checkbox-enable-click-tracking');\n\n\t\t\tAutomateWoo.Workflows.maybe_hide_tracking_options();\n\n\t\t\t$checkbox_click_tracking.on( 'click', function(){\n\t\t\t\tAutomateWoo.Workflows.maybe_hide_tracking_options();\n\t\t\t});\n\n\t\t},\n\n\n\n\t\tmaybe_hide_tracking_options: function() {\n\n\t\t\tvar $checkbox_click_tracking = $('.aw-checkbox-enable-click-tracking');\n\t\t\tvar checked = $checkbox_click_tracking.is(':checked');\n\n\t\t\tif ( ! checked ) {\n\t\t\t\t$('.js-require-email-tracking').hide();\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$('.js-require-email-tracking').show();\n\t\t\t}\n\t\t},\n\n\n\n\t\t/**\n\t\t * @param trigger_name\n\t\t */\n\t\tfill_trigger_fields: function( trigger_name ) {\n\t\t\t// Remove existing fields\n\t\t\tAutomateWoo.Workflows.$triggers_box.find('tr.aw-trigger-option').remove();\n\n\t\t\tif ( trigger_name ) {\n\t\t\t\tAutomateWoo.Workflows.$triggers_box.addClass('aw-loading');\n\n\t\t\t\tthis.fetch_trigger_data( trigger_name )\n\t\t\t\t\t.done(function(response){\n\t\t\t\t\t\tif ( ! response.success ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tAutomateWoo.Workflows.$triggers_box.find('tbody').append( response.data.fields );\n\t\t\t\t\t\tAutomateWoo.Workflows.$triggers_box.removeClass('aw-loading');\n\n\t\t\t\t\t\tAW.workflow.set( 'trigger', response.data.trigger );\n\t\t\t\t\t});\n\n\t\t\t}\n\t\t\telse {\n\t\t\t\tAW.workflow.set( 'trigger', false );\n\t\t\t}\n\t\t},\n\n\n\t\tfetch_trigger_data: function( trigger_name ) {\n\t\t\treturn $.ajax({\n\t\t\t\tmethod: 'GET',\n\t\t\t\turl: ajaxurl,\n\t\t\t\tdata: {\n\t\t\t\t\taction: 'aw_fill_trigger_fields',\n\t\t\t\t\ttrigger_name: trigger_name,\n\t\t\t\t\tworkflow_id: AW.workflow.get('id'),\n\t\t\t\t\tis_new_workflow: AW.workflow.get('isNew')\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\n\t\t/**\n\t\t * @param trigger_name\n\t\t */\n\t\tfill_manual_workflow_trigger_fields: function( trigger_name ) {\n\t\t\tvar $metabox = AutomateWoo.Workflows.$manual_workflow_box;\n\n\t\t\t// Remove existing fields\n\t\t\t$metabox.find('tr.aw-trigger-option').remove();\n\n\t\t\tif ( trigger_name ) {\n\t\t\t\t$metabox.addClass('aw-loading');\n\n\t\t\t\tthis.fetch_trigger_data( trigger_name )\n\t\t\t\t\t.done(function(response){\n\t\t\t\t\t\tif ( ! response.success ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$metabox.find('tbody').append( response.data.fields );\n\t\t\t\t\t\t$metabox.removeClass('aw-loading');\n\n\t\t\t\t\t\tAW.workflow.set( 'trigger', response.data.trigger );\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tAW.workflow.set( 'trigger', false );\n\t\t\t}\n\t\t},\n\n\n\t\tadd_new_action: function() {\n\n\t\t\tvar $new_action,\n\t\t\t\taction_number = AutomateWoo.Workflows.get_number_of_actions() + 1;\n\n\t\t\t$('.js-aw-no-actions-message').hide();\n\n\t\t\t$new_action = AutomateWoo.Workflows.$action_template.clone();\n\t\t\t$new_action.removeClass('aw-action-template');\n\t\t\t$new_action.addClass('automatewoo-action');\n\n\t\t\tAutomateWoo.Workflows.$actions_container.append($new_action);\n\n\t\t\t$new_action.attr( 'data-action-number', action_number );\n\n\t\t\tAutomateWoo.Workflows.action_edit_open($new_action);\n\t\t},\n\n\t\t/**\n\t\t * Get the name for the cookie that stores if an action is being edited.\n\t\t *\n\t\t * @param {Number} action_number\n\t\t * @returns {string}\n\t\t */\n\t\tget_editing_action_cookie_name: function( action_number ) {\n\t\t\tconst workflow_id = AW.workflow.get( 'id' );\n\t\t\treturn `aw_editing_action_${ workflow_id }_${ action_number }`;\n\t\t},\n\n\t\taction_edit_open: function( $action ) {\n\t\t\tvar action_number = $action.data('action-number');\n\n\t\t\t$action.addClass('js-open');\n\t\t\t$action.find('.automatewoo-action__fields').slideDown(150);\n\n\t\t\tAW.initTooltips();\n\n\t\t\t// save open state\n\t\t\tCookies.set(\n\t\t\t\tthis.get_editing_action_cookie_name( action_number ),\n\t\t\t\t1,\n\t\t\t\t{ sameSite: 'strict' },\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Set up fields that are dependent on each other.\n\t\t * @param {jQuery} $action\n\t\t */\n\t\taction_dependent_fields: function( $action ) {\n\t\t\tvar $hideWhenChecked = $action.find( '[data-hide-when-checked]' );\n\t\t\t$hideWhenChecked.each( function() {\n\t\t\t\tvar $this = $( this );\n\t\t\t\tvar $dependency = $this.data( 'hideWhenChecked' );\n\t\t\t\tvar $parentRow = $this.closest( 'tr.automatewoo-table__row' );\n\t\t\t\tvar $checkbox = $( `[data-name=\"${$dependency}\"]` ).find( 'input[type=\"checkbox\"]' );\n\n\t\t\t\tif ( !$checkbox ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$checkbox.on( 'change', function() {\n\t\t\t\t\tthis.checked ? $parentRow.hide() : $parentRow.show();\n\t\t\t\t} ).trigger( 'change' );\n\t\t\t} );\n\t\t},\n\n\n\t\taction_edit_close: function( $action ) {\n\n\t\t\tvar action_number = $action.data('action-number');\n\n\t\t\t$action.removeClass('js-open');\n\t\t\t$action.find('.automatewoo-action__fields').slideUp(150);\n\n\t\t\tCookies.remove(\n\t\t\t\tthis.get_editing_action_cookie_name( action_number ),\n\t\t\t);\n\t\t},\n\n\n\t\t/**\n\t\t * @param $action\n\t\t */\n\t\taction_delete: function( $action ) {\n\t\t\t$action.remove();\n\t\t},\n\n\n\t\t/**\n\t\t *\n\t\t */\n\t\tfill_action_fields: function( $action, selected_action ) {\n\n\t\t\tvar action_number = $action.data('action-number');\n\t\t\tvar $select = $action.find('.js-action-select');\n\n\t\t\tAutomateWoo.Workflows.$actions_box.addClass('aw-loading');\n\n\t\t\t// Remove existing fields\n\t\t\t$action.find('tr.automatewoo-table__row:not([data-name=\"action_name\"])').remove();\n\n\n\t\t\t$.ajax({\n\t\t\t\tmethod: 'GET',\n\t\t\t\turl: ajaxurl,\n\t\t\t\tdata: {\n\t\t\t\t\taction: 'aw_fill_action_fields',\n\t\t\t\t\taction_name: selected_action,\n\t\t\t\t\taction_number: action_number,\n\t\t\t\t\tworkflow_id: AW.workflow.get('id')\n\t\t\t\t}\n\t\t\t})\n\t\t\t\t.done(function(response){\n\n\t\t\t\t\t$action.find('.automatewoo-table tbody').append( response.data.fields );\n\t\t\t\t\tAutomateWoo.Workflows.$actions_box.removeClass('aw-loading');\n\n\t\t\t\t\t// Fill select box name\n\t\t\t\t\t$select.attr('name', 'aw_workflow_data[actions]['+action_number+'][action_name]' );\n\n\t\t\t\t\t// Pre fill title\n\t\t\t\t\t$action.find('.action-title').text( response.data.title );\n\n\t\t\t\t\t$action.find('.js-action-description').html( response.data.description );\n\n\t\t\t\t\tAW.workflowView.initAction( selected_action, $action );\n\n\t\t\t\t})\n\t\t\t;\n\n\t\t},\n\n\n\n\t\tget_number_of_actions: function () {\n\t\t\treturn $('.automatewoo-action').length;\n\t\t},\n\n\n\n\t\t/**\n\t\t * Show or hide text var groups based on the selected trigger\n\t\t */\n\t\trefine_variables: function() {\n\n\t\t\tvar trigger = AW.workflow.get('trigger');\n\n\t\t\t$('.aw-variables-group').each(function( i, el ){\n\n\t\t\t\tvar group = $(el).data( 'automatewoo-variable-group' );\n\n\t\t\t\tif ( $.inArray( group, trigger.supplied_data_items ) == -1 ) {\n\t\t\t\t\t$(el).hide();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$(el).show();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\n\t\t/**\n\t\t * Show or hide select options based on the selected trigger\n\t\t * Also what if a trigger is changed after an action is already added\n\t\t */\n\t\trefine_action_selects: function() {\n\n\t\t\t$('.js-action-select').each(function(){\n\t\t\t\t$(this).find('option').each(function(){\n\t\t\t\t\t$(this).prop(\n\t\t\t\t\t\t'disabled',\n\t\t\t\t\t\t! AutomateWoo.Workflows.is_action_compatible_with_current_trigger( $(this).val() )\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t});\n\t\t},\n\n\n\t\t/**\n\t\t * Hide queue if disabled for the selected trigger\n\t\t */\n\t\tmaybe_disable_queueing: function() {\n\t\t\tvar trigger = AW.workflow.get('trigger');\n\n\t\t\tif ( trigger && trigger.allow_queueing ) {\n\t\t\t\t$('#aw_timing_box').show();\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$('#aw_timing_box').hide();\n\t\t\t}\n\t\t},\n\n\n\t\t/**\n\t\t * Be sure to run this before refine_action_selects\n\t\t *\n\t\t * Returns false if switching back to stop the trigger change\n\t\t *\n\t\t * @return boolean\n\t\t */\n\t\ttrigger_compatibility_warning: function(){\n\n\t\t\tvar incompatibleRules = [];\n\t\t\tvar incompatibleActions = [];\n\n\t\t\t_.each( AW.rules.get( 'ruleOptions' ), function( ruleGroup ) {\n\t\t\t\t_.each( ruleGroup.get( 'rules' ), function( rule ) {\n\t\t\t\t\tif ( rule.get('name') && ! AW.rules.isRuleAvailable( rule.get('name') ) ) {\n\t\t\t\t\t\tvar ruleObject = rule.get( 'object' );\n\t\t\t\t\t\tincompatibleRules.push( ruleObject.title );\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\n\t\t\t$('.js-action-select').each(function(){\n\t\t\t\tif ( ! AutomateWoo.Workflows.is_action_compatible_with_current_trigger( $(this).val() ) ) {\n\t\t\t\t\tincompatibleActions.push( $(this).find('option:selected').text() )\n\t\t\t\t}\n\t\t\t});\n\n\n\t\t\tif ( incompatibleRules.length || incompatibleActions.length ) {\n\n\t\t\t\tincompatibleActions = _.uniq( incompatibleActions );\n\t\t\t\tincompatibleRules = _.uniq( incompatibleRules );\n\n\t\t\t\tvar modalView = new AW.TriggerCompatibilityModalView({\n\t\t\t\t\tincompatibleRules: incompatibleRules,\n\t\t\t\t\tincompatibleActions: incompatibleActions\n\t\t\t\t});\n\n\t\t\t\tAutomateWoo.Modal.open();\n\t\t\t\tAutomateWoo.Modal.contents( modalView.render().el );\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\n\n\t\tclearIncompatibleActions: function() {\n\t\t\t$('.js-action-select').each(function(){\n\t\t\t\tif ( ! AutomateWoo.Workflows.is_action_compatible_with_current_trigger( $(this).val() ) ) {\n\t\t\t\t\tvar $action = $(this).parents('.automatewoo-action').first();\n\t\t\t\t\tAutomateWoo.Workflows.action_delete( $action );\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\n\n\t\t/**\n\t\t *\n\t\t * @param action_name\n\t\t *\n\t\t * @return boolean\n\t\t */\n\t\tis_action_compatible_with_current_trigger: function( action_name ) {\n\n\t\t\tvar compatible = true,\n\t\t\t \ttrigger = AW.workflow.get('trigger'),\n\t\t\t\taction = AW.workflow.getAction(action_name);\n\n\t\t\t// Not a valid action\n\t\t\tif ( ! action ) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// No data items required\n\t\t\tif ( ! action.required_data_items.length ){\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t$.each( action.required_data_items, function(i, value){\n\n\t\t\t\tif ( $.inArray( value, trigger.supplied_data_items ) == -1 ) {\n\t\t\t\t\tcompatible = false\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn compatible;\n\t\t},\n\n\n\n\t\tpreview_action: function( $action ) {\n\n\t\t\tvar action_number = $action.data('action-number');\n\t\t\tvar name_selector;\n\t\t\tvar trigger = AW.workflow.get('trigger');\n\t\t\tvar fields = {};\n\n\t\t\tif ( AutomateWoo.isEmailPreviewOpen() ) {\n\t\t\t\tAutomateWoo.Workflows.$actions_box.addClass('aw-loading');\n\t\t\t}\n\n\t\t\tif ( typeof tinyMCE !== 'undefined' ) {\n\t\t\t\ttinyMCE.triggerSave();\n\t\t\t}\n\n\t\t\tname_selector = 'aw_workflow_data[actions]['+action_number+']';\n\n\t\t\t// get fields to preview\n\t\t\t$action.find('[name*=\"' + name_selector + '\"]').each(function( i, el ){\n\n\t\t\t\tvar field_name, element_name, val, is_grouped;\n\n\t\t\t\telement_name = $(el).attr('name')\n\t\t\t\tis_grouped = /\\[]$/.test( element_name );\n\n\t\t\t\tif ( is_grouped ) {\n\t\t\t\t\telement_name = element_name.replace( '[]', '' );\n\t\t\t\t}\n\n\t\t\t\t// get the name\n\t\t\t\tfield_name = element_name.replace(name_selector, '').replace('[', '').replace(']', '');\n\n\t\t\t\tif ( $(el).attr('type') === 'checkbox' ) {\n                    val = el.checked ? '1' : '';\n\t\t\t\t} else {\n\t\t\t\t\tval = $(el).val();\n\t\t\t\t}\n\n\t\t\t\tif ( is_grouped ) {\n\t\t\t\t\tif ( ! fields.hasOwnProperty( field_name ) ) {\n\t\t\t\t\t\tfields[ field_name ] = [];\n\t\t\t\t\t}\n\t\t\t\t\tfields[field_name].push( val );\n\t\t\t\t} else {\n\t\t\t\t\tfields[field_name] = val;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tAutomateWoo.openLoadingEmailPreview(); // open the preview window before saving so that the popup is not blocked\n\n\t\t\t$.ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\turl: ajaxurl,\n\t\t\t\tdata: {\n\t\t\t\t\taction: 'aw_save_preview_data',\n\t\t\t\t\tworkflow_id: AW.workflow.get('id'),\n\t\t\t\t\ttrigger_name: trigger ? trigger.name : '',\n\t\t\t\t\taction_fields: fields,\n\t\t\t\t},\n\t\t\t\tsuccess: function(response) {\n\t\t\t\t\tAutomateWoo.open_email_preview( 'workflow_action', {\n\t\t\t\t\t\tworkflow_id: AW.workflow.get('id'),\n\t\t\t\t\t\taction_number: action_number\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tcomplete: function() {\n\t\t\t\t\tAutomateWoo.Workflows.$actions_box.removeClass('aw-loading');\n\t\t\t\t}\n\t\t\t});\n\n\t\t},\n\n\n\t\t/**\n\t\t * @param id\n         */\n\t\tinit_ajax_wysiwyg: function( id ){\n\n\t\t\tif ( typeof tinymce === 'undefined' || typeof tinyMCEPreInit.mceInit.automatewoo_editor === 'undefined' )\n\t\t\t\treturn;\n\n\t\t\tvar $wrap,\n\t\t\t\tmceInit,\n\t\t\t\tqtInit,\n\t\t\t\tqtags;\n\n\t\t\tmceInit = $.extend({}, tinyMCEPreInit.mceInit.automatewoo_editor );\n\t\t\tqtInit = $.extend({}, tinyMCEPreInit.qtInit.automatewoo_editor );\n\n\t\t\tmceInit.selector = '#' + id;\n\t\t\tmceInit.id = id;\n\t\t\tmceInit.wp_autoresize_on = false;\n\n\t\t\ttinyMCEPreInit.mceInit[ mceInit.id ] = mceInit;\n\n\n\t\t\tqtInit.id = id;\n\n\t\t\t$wrap = tinymce.$( '#wp-' + id + '-wrap' );\n\n\t\t\tif ( ( $wrap.hasClass( 'tmce-active' ) || ! tinyMCEPreInit.qtInit.hasOwnProperty( id ) ) ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\ttinymce.init( mceInit );\n\n\t\t\t\t} catch(e){}\n\t\t\t}\n\n\t\t\ttry {\n\n\t\t\t\tqtags = quicktags( qtInit );\n\n\t\t\t\tthis.init_wysiwyg_buttons( qtags );\n\n\t\t\t} catch(e){}\n\n\t\t},\n\n\n\t\t/**\n\t\t *\n\t\t * @param qtags\n         */\n\t\tinit_wysiwyg_buttons: function( qtags ) {\n\n\t\t\tvar defaults = ',strong,em,link,block,del,ins,img,ul,ol,li,code,more,close,';\n\n\t\t\tcanvas = qtags.canvas;\n\t\t\tname = qtags.name;\n\t\t\tsettings = qtags.settings;\n\t\t\thtml = '';\n\t\t\ttheButtons = {};\n\t\t\tuse = '';\n\n\t\t\t// set buttons\n\t\t\tif ( settings.buttons ) {\n\t\t\t\tuse = ','+settings.buttons+',';\n\t\t\t}\n\n\t\t\tfor ( i in edButtons ) {\n\t\t\t\tif ( !edButtons[i] ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tid = edButtons[i].id;\n\t\t\t\tif ( use && defaults.indexOf( ',' + id + ',' ) !== -1 && use.indexOf( ',' + id + ',' ) === -1 ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif ( !edButtons[i].instance || edButtons[i].instance === inst ) {\n\t\t\t\t\ttheButtons[id] = edButtons[i];\n\n\t\t\t\t\tif ( edButtons[i].html ) {\n\t\t\t\t\t\thtml += edButtons[i].html(name + '_');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( use && use.indexOf(',fullscreen,') !== -1 ) {\n\t\t\t\ttheButtons.fullscreen = new qt.FullscreenButton();\n\t\t\t\thtml += theButtons.fullscreen.html(name + '_');\n\t\t\t}\n\n\n\t\t\tif ( 'rtl' === document.getElementsByTagName('html')[0].dir ) {\n\t\t\t\ttheButtons.textdirection = new qt.TextDirectionButton();\n\t\t\t\thtml += theButtons.textdirection.html(name + '_');\n\t\t\t}\n\n\t\t\tqtags.toolbar.innerHTML = html;\n\t\t\tqtags.theButtons = theButtons;\n\n\t\t}\n\n\n\t};\n\n\n\tAutomateWoo.Workflows.init();\n\n\n\n\t/**\n\t * Customer win back trigger.\n\t *\n\t * Changes the max field placeholder so it's 3 days after the min field val.\n\t */\n\tfunction init_customer_win_back_trigger() {\n\t\tvar $min_field = $('input[name=\"aw_workflow_data[trigger_options][days_since_last_purchase]\"]');\n\t\tvar $max_field = $('input[name=\"aw_workflow_data[trigger_options][days_since_last_purchase_max]\"]');\n\t\tvar default_range = 3;\n\n\t\t$min_field.on( 'change keyup', function(){\n\t\t\tvar min_val = $min_field.val() ? parseInt( $min_field.val() ) : 0;\n\t\t\tvar placeholder = '';\n\n\t\t\tif ( min_val ) {\n\t\t\t\tplaceholder = min_val + default_range;\n\t\t\t}\n\n\t\t\t$max_field.attr('min', min_val + 1 );\n\t\t\t$max_field.attr('placeholder', placeholder );\n\t\t}).trigger( 'change' );\n\t}\n\n\t$(document.body).on('automatewoo_trigger_changed', function(){\n\t\tinit_customer_win_back_trigger();\n\t});\n\n\n\tfunction init_workflow_type() {\n\t\tvar $typeSelectField = $('.automatewoo-workflow-type-field');\n\n\t\tfunction updateType( type, doReset ) {\n\t\t\tif ( type === 'manual' ) {\n\t\t\t\t$('#aw_trigger_box, #automatewoo-workflow-status-field-row').hide();\n\t\t\t\t$('#aw_manual_workflow_box').show();\n\t\t\t\t$('#automatewoo-workflow-run-btn').show().css('display','inline-block');\n\t\t\t} else {\n\t\t\t\t$('#automatewoo-workflow-run-btn, #aw_manual_workflow_box').hide();\n\t\t\t\t$('#aw_trigger_box, #automatewoo-workflow-status-field-row').show();\n\t\t\t}\n\n\t\t\tif ( doReset ) {\n\t\t\t\t// Reset select box to first option on type change\n\t\t\t\tAutomateWoo.Workflows.$manual_trigger_select[0].selectedIndex = 0;\n\t\t\t\tAutomateWoo.Workflows.$trigger_select[0].selectedIndex = 0;\n\t\t\t\tAW.workflow.set( 'trigger', false );\n\t\t\t}\n\t\t}\n\n\t\t$typeSelectField.on( 'change', function() {\n\t\t\tupdateType( $typeSelectField.val(), true );\n\t\t} );\n\n\t\tupdateType( $typeSelectField.val(), false )\n\t}\n\n\t$('#automatewoo-workflow-run-btn').on( 'click', function(){\n\t\t$('input[name=\"automatewoo_redirect_to_runner\"]').val(1);\n\t\t$('#publish').trigger( 'click' );\n\t\treturn false;\n\t});\n\n\t$( 'form#post' ).on( 'submit', function(){\n\t\tlet $form             = $(this);\n\t\tlet isActive          = 'active' === $('select[name=workflow_status]', $form).val();\n\t\tlet isConfirmed       = $form.data('aw-preset-workflow-confirmed');\n\t\tlet isFirstPresetSave = /workflow-origin=preset/.test( window.location.href );\n\n\t\tif ( isFirstPresetSave && ! isConfirmed ) {\n\t\t\tconst activationModalView = new AW.TriggerPresetActivationModalView( { isActive } );\n\t\t\tactivationModalView.open();\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t});\n\n\tinit_customer_win_back_trigger();\n\tinit_workflow_type();\n\n});\n"],"mappings":"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"}