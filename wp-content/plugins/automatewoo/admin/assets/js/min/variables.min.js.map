{"version":3,"file":"variables.min.js","mappings":"AAOAA,QAAQ,SAAWC,GAClBC,YAAYC,UAAY,CACvBC,UAAWH,EAAG,qBAEd,IAAAI,GACCC,KAAKC,iBAELN,EAAGO,SAASC,MAAOC,GAClB,eACA,kCACAJ,KAAKK,sBAENV,EAAGO,SAASC,MAAOC,GAClB,WACA,uCACAJ,KAAKM,0BAGNN,KAAKF,UAAUM,GACd,QACA,wBACAJ,KAAKO,WAEP,EAIA,cAAAN,GACmB,IAAIO,YAAa,oBAAqB,CACvD,IAAAC,GACC,IAAIA,EAAOd,EACV,uCACCc,OAgBF,OAdAd,EAAG,mCAAoCe,MACtC,SAAWC,EAAGC,GACb,GACCjB,EAAGiB,GAAQC,KAAM,cACflB,EAAGiB,GAAQE,IAAK,GAAIC,gBAKtB,OAHApB,EAAGiB,GAAQE,IAAK,GAAIE,iBACpBP,GAAO,GAEA,CAET,IAGMA,CACR,IAGSL,GAAI,WAAW,WACxBT,EAAG,qBAAsBsB,KAAM,WAE/BC,YAAY,WACXtB,YAAYuB,MAAMC,OACnB,GAAG,IACJ,GACD,EAEA,UAAAb,GACCX,YAAYuB,MAAME,OAClBzB,YAAYuB,MAAMG,UAElB,MAAMC,EAAW,CAChBC,OAAQ,yBACRC,SAAU9B,EAAGK,MAAOS,QAGrBd,EAAE+B,KAAMC,QAASJ,GAAU,SAAWK,GACrChC,YAAYuB,MAAMU,SAAUD,GAC5BhC,YAAYC,UAAUQ,sBACvB,GACD,EAKA,oBAAAA,GACC,MAAMyB,EAAgBnC,EAAG,uCACnB8B,EAAWK,EAAcC,KAAM,YAC/BC,EAAa,GAEnBrC,EAAG,mCAAoCe,MAAM,WAC5C,MAAMuB,EAAYtC,EAAGK,MAAOkC,QAC3B,8CAID,GAAKD,EAAUF,KAAM,kBAAqB,CACzC,MAAMI,EAAYF,EAChBF,KAAM,kBACNK,MAAO,KAEHC,EAAkB1C,EACvB,yCACCwC,EAAW,GACX,MAGF,IACCE,EAAgBC,QAChBD,EAAgBE,QAAUJ,EAAW,GAKrC,YADAF,EAAUO,OAFVP,EAAUQ,MAKZ,CAEA,MAAMC,EAAQ,CACbC,KAAMhD,EAAGK,MAAO4C,KAAM,QACtBC,SAAUZ,EAAUF,KAAM,eAC1Be,MAAOnD,EAAGK,MAAOuC,OAGlBP,EAAWe,KAAML,EAClB,IAEA,MAAMM,EAASpD,YAAYC,UAAUoD,yBACpCxB,EACAO,GAGDF,EAAcrB,KAAMuC,EACrB,EAOA,wBAAAC,CAA0BxB,EAAUO,GACnC,IAAIgB,EAAS,MAAQvB,EAErB,GAAKO,EAAWM,OAAS,CACxB,MAAMY,EAAa,GAEnBvD,EAAEe,KAAMsB,GAAY,SAAWrB,EAAG+B,GAC5BA,EAAMI,MACVI,EAAWH,KACVL,EAAMC,KAAO,MAAQD,EAAMI,MAAQ,KAEzBJ,EAAMG,UACjBK,EAAWH,KAAML,EAAMC,KAAO,UAEhC,IAEKO,EAAWZ,OAAS,IACxBU,GAAU,MACVA,GAAUE,EAAWC,KAAM,MAE7B,CAEA,OAAOH,EAAS,KACjB,EAKA,wBAAA1C,CAA0B8C,GAGzB,IAA+C,IAA1CzD,EAAE0D,QAASD,EAAME,MAFH,CAAE,GAAI,IAAK,IAAK,MAGlC,OAAO,CAET,GAGD1D,YAAYC,UAAUE,MACvB","sources":["webpack://automatewoo/./admin/assets/js/variables.js"],"sourcesContent":["// Register eslint ignored glabals - to be revisited.\n// https://github.com/woocommerce/automatewoo/issues/1212\n/* global AutomateWoo, ClipboardJS, ajaxurl */\n/**\n * AutomateWoo Variables\n */\n\njQuery( function ( $ ) {\n\tAutomateWoo.Variables = {\n\t\t$meta_box: $( '#aw_variables_box' ),\n\n\t\tinit() {\n\t\t\tthis.init_clipboard();\n\n\t\t\t$( document.body ).on(\n\t\t\t\t'change keyup',\n\t\t\t\t'.aw-workflow-variable-parameter',\n\t\t\t\tthis.update_preview_field\n\t\t\t);\n\t\t\t$( document.body ).on(\n\t\t\t\t'keypress',\n\t\t\t\t'input.aw-workflow-variable-parameter',\n\t\t\t\tthis.restrict_parameter_chars\n\t\t\t);\n\n\t\t\tthis.$meta_box.on(\n\t\t\t\t'click',\n\t\t\t\t'.aw-workflow-variable',\n\t\t\t\tthis.open_modal\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t */\n\t\tinit_clipboard() {\n\t\t\tconst clipboard = new ClipboardJS( '.aw-clipboard-btn', {\n\t\t\t\ttext() {\n\t\t\t\t\tlet text = $(\n\t\t\t\t\t\t'#aw_workflow_variable_preview_field'\n\t\t\t\t\t).text();\n\n\t\t\t\t\t$( '.aw-workflow-variable-parameter' ).each(\n\t\t\t\t\t\tfunction ( i, field ) {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t$( field ).prop( 'required' ) &&\n\t\t\t\t\t\t\t\t! $( field ).get( 0 ).checkValidity()\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t$( field ).get( 0 ).reportValidity();\n\t\t\t\t\t\t\t\ttext = false;\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\treturn text;\n\t\t\t\t},\n\t\t\t} );\n\n\t\t\tclipboard.on( 'success', function () {\n\t\t\t\t$( '.aw-clipboard-btn' ).html( 'Copied!' );\n\n\t\t\t\tsetTimeout( function () {\n\t\t\t\t\tAutomateWoo.Modal.close();\n\t\t\t\t}, 500 );\n\t\t\t} );\n\t\t},\n\n\t\topen_modal() {\n\t\t\tAutomateWoo.Modal.open();\n\t\t\tAutomateWoo.Modal.loading();\n\n\t\t\tconst ajaxData = {\n\t\t\t\taction: 'aw_modal_variable_info',\n\t\t\t\tvariable: $( this ).text(),\n\t\t\t};\n\n\t\t\t$.post( ajaxurl, ajaxData, function ( response ) {\n\t\t\t\tAutomateWoo.Modal.contents( response );\n\t\t\t\tAutomateWoo.Variables.update_preview_field();\n\t\t\t} );\n\t\t},\n\n\t\t/**\n\t\t * Updates the variable preview text field\n\t\t */\n\t\tupdate_preview_field() {\n\t\t\tconst $previewField = $( '#aw_workflow_variable_preview_field' );\n\t\t\tconst variable = $previewField.data( 'variable' );\n\t\t\tconst parameters = [];\n\n\t\t\t$( '.aw-workflow-variable-parameter' ).each( function () {\n\t\t\t\tconst $paramRow = $( this ).parents(\n\t\t\t\t\t'.aw-workflow-variables-parameter-row:first'\n\t\t\t\t);\n\n\t\t\t\t// Check 'show' logic\n\t\t\t\tif ( $paramRow.data( 'parameter-show' ) ) {\n\t\t\t\t\tconst showLogic = $paramRow\n\t\t\t\t\t\t.data( 'parameter-show' )\n\t\t\t\t\t\t.split( '=' );\n\n\t\t\t\t\tconst $conditionField = $(\n\t\t\t\t\t\t'.aw-workflow-variable-parameter[name=\"' +\n\t\t\t\t\t\t\tshowLogic[ 0 ] +\n\t\t\t\t\t\t\t'\"]'\n\t\t\t\t\t);\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t$conditionField.length &&\n\t\t\t\t\t\t$conditionField.val() === showLogic[ 1 ]\n\t\t\t\t\t) {\n\t\t\t\t\t\t$paramRow.show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$paramRow.hide();\n\t\t\t\t\t\treturn; // don't add parameter to preview\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst param = {\n\t\t\t\t\tname: $( this ).attr( 'name' ),\n\t\t\t\t\trequired: $paramRow.data( 'is-required' ),\n\t\t\t\t\tvalue: $( this ).val(),\n\t\t\t\t};\n\n\t\t\t\tparameters.push( param );\n\t\t\t} );\n\n\t\t\tconst string = AutomateWoo.Variables.generate_variable_string(\n\t\t\t\tvariable,\n\t\t\t\tparameters\n\t\t\t);\n\n\t\t\t$previewField.text( string );\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * @param {string}        variable\n\t\t * @param {Array<Object>} parameters\n\t\t */\n\t\tgenerate_variable_string( variable, parameters ) {\n\t\t\tlet string = '{{ ' + variable;\n\n\t\t\tif ( parameters.length ) {\n\t\t\t\tconst paramParts = [];\n\n\t\t\t\t$.each( parameters, function ( i, param ) {\n\t\t\t\t\tif ( param.value ) {\n\t\t\t\t\t\tparamParts.push(\n\t\t\t\t\t\t\tparam.name + \": '\" + param.value + \"'\"\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if ( param.required ) {\n\t\t\t\t\t\tparamParts.push( param.name + \": '...'\" );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tif ( paramParts.length > 0 ) {\n\t\t\t\t\tstring += ' | ';\n\t\t\t\t\tstring += paramParts.join( ', ' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn string + ' }}';\n\t\t},\n\n\t\t/**\n\t\t * @param {Event} event jQuery `keypress` event, with `which` property.\n\t\t */\n\t\trestrict_parameter_chars( event ) {\n\t\t\tconst restricted = [ 39, 123, 124, 125 ];\n\n\t\t\tif ( $.inArray( event.which, restricted ) !== -1 ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t};\n\n\tAutomateWoo.Variables.init();\n} );\n"],"names":["jQuery","$","AutomateWoo","Variables","$meta_box","init","this","init_clipboard","document","body","on","update_preview_field","restrict_parameter_chars","open_modal","ClipboardJS","text","each","i","field","prop","get","checkValidity","reportValidity","html","setTimeout","Modal","close","open","loading","ajaxData","action","variable","post","ajaxurl","response","contents","$previewField","data","parameters","$paramRow","parents","showLogic","split","$conditionField","length","val","hide","show","param","name","attr","required","value","push","string","generate_variable_string","paramParts","join","event","inArray","which"],"sourceRoot":""}