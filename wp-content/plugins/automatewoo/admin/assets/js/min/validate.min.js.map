{"version":3,"file":"validate.min.js","names":["$","localizedErrorMessages","self","AW","Validate","errorMessages","init","setInterval","tinyMCE","triggerSave","each","this","attr","validateField","document","body","on","event","target","validateAllFields","$field","workflow","errors","text","val","clearFieldErrors","usedVariables","getVariablesFromText","fieldSupports","trigger","get","_","variable","valid","isVariableValidForTrigger","push","getErrorMessage","getVariableWithoutParams","length","setFieldErrors","addClass","$wrap","parents","append","$errors","find","is","error","removeClass","remove","option","options","data","split","indexOf","dataType","getDataTypeFromVariable","dataField","getDataFieldFromVariable","supplied_data_items","variables","match","i","replace","trim","dotpos","substring","message","jQuery","automatewooValidateLocalizedErrorMessages"],"sources":["validate.js"],"sourcesContent":["/**\n * Workflow field validator\n */\n\n(function( $, localizedErrorMessages ) {\n\n    var self;\n\n    AW.Validate = {\n\n        errorMessages: {},\n\n\n        init: function() {\n\n            setInterval(function() {\n\n                if ( typeof tinyMCE !== 'undefined' ) {\n                    tinyMCE.triggerSave();\n                }\n\n                $('.automatewoo-field-wrap textarea.wp-editor-area').each(function() {\n                    $(this).attr( 'data-automatewoo-validate', 'variables' );\n                    self.validateField( $(this) );\n                });\n\n            }, 2000 );\n\n\n            $( document.body ).on( 'keyup blur change', '[data-automatewoo-validate]', function( event ){\n                self.validateField( $(event.target) )\n            });\n\n            self.validateAllFields();\n\n        },\n\n\n\n        validateAllFields: function() {\n            $( '[data-automatewoo-validate]' ).each( function() {\n                self.validateField( $(this) );\n            });\n        },\n\n\n\n        validateField: function( $field ) {\n\n            if ( ! AW.workflow )\n                return;\n\n            var errors = [];\n            var text = $field.val();\n\n            self.clearFieldErrors( $field );\n\n            var usedVariables = AW.Validate.getVariablesFromText( text );\n\n            if ( self.fieldSupports( 'variables', $field ) ) {\n\n                var trigger = AW.workflow.get( 'trigger' );\n\n                _.each( usedVariables, function( variable ) {\n\n                    var valid = self.isVariableValidForTrigger( variable, trigger );\n\n                    if ( valid !== true ) {\n                        errors.push( self.getErrorMessage( valid, self.getVariableWithoutParams( variable ) ) );\n                    }\n\n                });\n\n            }\n            else {\n                if ( usedVariables ) {\n                    errors.push( self.getErrorMessage( 'noVariablesSupport' ) );\n                }\n            }\n\n\n            if ( errors.length ) {\n                self.setFieldErrors( $field, errors );\n            }\n\n        },\n\n\n\n        setFieldErrors: function( $field, errors ) {\n\n            $field.addClass( 'automatewoo-field--invalid' );\n            var $wrap = $field.parents( '.automatewoo-field-wrap:first' );\n            $wrap.append('<div class=\"automatewoo-field-errors\"></div>');\n            var $errors = $wrap.find( '.automatewoo-field-errors' );\n\n            if ( $field.is( '.wp-editor-area' ) ) {\n                $wrap.find( '.wp-editor-container' ).addClass( 'automatewoo-field--invalid' )\n            }\n\n            _.each( errors, function( error ) {\n                $errors.append( '<div class=\"automatewoo-field-errors__error\">'+ error + '</div>' );\n            });\n        },\n\n\n        clearFieldErrors: function( $field ) {\n            var $wrap = $field.parents( '.automatewoo-field-wrap:first' );\n            $field.removeClass( 'automatewoo-field--invalid' );\n\n            if ( $field.is( '.wp-editor-area' ) ) {\n                $wrap.find( '.wp-editor-container' ).removeClass( 'automatewoo-field--invalid' )\n            }\n\n            $wrap.find( '.automatewoo-field-errors' ).remove();\n        },\n\n\n        fieldSupports: function( option, $field ) {\n            var options = $field.data( 'automatewoo-validate' ).split( ' ' );\n            return _.indexOf( options, option ) !== -1\n        },\n\n\n        /**\n         * @param variable\n         * @param trigger\n         * @return boolean|string\n         */\n        isVariableValidForTrigger: function( variable, trigger ) {\n\n            var dataType = self.getDataTypeFromVariable( variable );\n            var dataField = self.getDataFieldFromVariable( variable );\n\n            if ( dataType && _.indexOf( trigger.supplied_data_items, dataType ) === -1 ) {\n               return 'invalidDataType';\n            }\n\n            var variables = AW.workflow.get('variables');\n\n            if ( variables && variables[dataType] ) {\n                if ( variables[dataType].indexOf( dataField ) === -1 ) {\n                    return 'invalidVariable';\n                }\n            }\n\n            return true;\n        },\n\n\n        /**\n         * Extract variables from a text field\n         * @param text\n         * @returns array|false\n         */\n        getVariablesFromText: function( text ) {\n\n            var variables = text.match(/{{(.*?)}}/g);\n\n            if ( ! variables ) {\n                return false;\n            }\n\n            _.each( variables, function( variable, i ) {\n                variables[i] = variable.replace( /{|}/g, '' ).trim();\n            });\n\n            return variables;\n        },\n\n\n        getVariableWithoutParams: function( variable ) {\n            return variable.replace( /(\\|.*)/, '' );\n        },\n\n\n        getDataTypeFromVariable: function( variable ) {\n            if ( variable.indexOf('.') === -1 ) return false;\n            return variable.replace( /(\\..*)/, '' );\n        },\n\n\n        getDataFieldFromVariable: function( variable ) {\n            variable = self.getVariableWithoutParams( variable );\n            var dotpos = variable.indexOf('.');\n            if ( dotpos === -1 ) return false;\n            return variable.substring( dotpos + 1 ).trim();\n        },\n\n\n\n        getErrorMessage: function( error, replace ) {\n\n            if ( ! self.errorMessages[error] ) {\n                return 'Unknown error, please try refreshing your browser.';\n            }\n\n            var message = self.errorMessages[error];\n\n            if ( typeof replace == 'string' ) {\n                message = message.replace( '%s', replace );\n            }\n\n            return message;\n        }\n\n    };\n\n\n    self = AW.Validate;\n    self.errorMessages = localizedErrorMessages;\n\n})( jQuery, automatewooValidateLocalizedErrorMessages );"],"mappings":"CAIA,SAAWA,EAAGC,GAEV,IAAIC,EAEJC,GAAGC,SAAW,CAEVC,cAAe,CAAC,EAGhBC,KAAM,WAEFC,aAAY,WAEgB,oBAAZC,SACRA,QAAQC,cAGZT,EAAE,mDAAmDU,MAAK,WACtDV,EAAEW,MAAMC,KAAM,4BAA6B,aAC3CV,EAAKW,cAAeb,EAAEW,MAC1B,GAEJ,GAAG,KAGHX,EAAGc,SAASC,MAAOC,GAAI,oBAAqB,+BAA+B,SAAUC,GACjFf,EAAKW,cAAeb,EAAEiB,EAAMC,QAChC,IAEAhB,EAAKiB,mBAET,EAIAA,kBAAmB,WACfnB,EAAG,+BAAgCU,MAAM,WACrCR,EAAKW,cAAeb,EAAEW,MAC1B,GACJ,EAIAE,cAAe,SAAUO,GAErB,GAAOjB,GAAGkB,SAAV,CAGA,IAAIC,EAAS,GACTC,EAAOH,EAAOI,MAElBtB,EAAKuB,iBAAkBL,GAEvB,IAAIM,EAAgBvB,GAAGC,SAASuB,qBAAsBJ,GAEtD,GAAKrB,EAAK0B,cAAe,YAAaR,GAAW,CAE7C,IAAIS,EAAU1B,GAAGkB,SAASS,IAAK,WAE/BC,EAAErB,KAAMgB,GAAe,SAAUM,GAE7B,IAAIC,EAAQ/B,EAAKgC,0BAA2BF,EAAUH,IAEvC,IAAVI,GACDX,EAAOa,KAAMjC,EAAKkC,gBAAiBH,EAAO/B,EAAKmC,yBAA0BL,IAGjF,GAEJ,MAESN,GACDJ,EAAOa,KAAMjC,EAAKkC,gBAAiB,uBAKtCd,EAAOgB,QACRpC,EAAKqC,eAAgBnB,EAAQE,EAhCvB,CAmCd,EAIAiB,eAAgB,SAAUnB,EAAQE,GAE9BF,EAAOoB,SAAU,8BACjB,IAAIC,EAAQrB,EAAOsB,QAAS,iCAC5BD,EAAME,OAAO,gDACb,IAAIC,EAAUH,EAAMI,KAAM,6BAErBzB,EAAO0B,GAAI,oBACZL,EAAMI,KAAM,wBAAyBL,SAAU,8BAGnDT,EAAErB,KAAMY,GAAQ,SAAUyB,GACtBH,EAAQD,OAAQ,gDAAiDI,EAAQ,SAC7E,GACJ,EAGAtB,iBAAkB,SAAUL,GACxB,IAAIqB,EAAQrB,EAAOsB,QAAS,iCAC5BtB,EAAO4B,YAAa,8BAEf5B,EAAO0B,GAAI,oBACZL,EAAMI,KAAM,wBAAyBG,YAAa,8BAGtDP,EAAMI,KAAM,6BAA8BI,QAC9C,EAGArB,cAAe,SAAUsB,EAAQ9B,GAC7B,IAAI+B,EAAU/B,EAAOgC,KAAM,wBAAyBC,MAAO,KAC3D,OAAyC,IAAlCtB,EAAEuB,QAASH,EAASD,EAC/B,EAQAhB,0BAA2B,SAAUF,EAAUH,GAE3C,IAAI0B,EAAWrD,EAAKsD,wBAAyBxB,GACzCyB,EAAYvD,EAAKwD,yBAA0B1B,GAE/C,GAAKuB,IAAoE,IAAxDxB,EAAEuB,QAASzB,EAAQ8B,oBAAqBJ,GACtD,MAAO,kBAGV,IAAIK,EAAYzD,GAAGkB,SAASS,IAAI,aAEhC,OAAK8B,IAAaA,EAAUL,KAC2B,IAA9CK,EAAUL,GAAUD,QAASG,IACvB,iBAKnB,EAQA9B,qBAAsB,SAAUJ,GAE5B,IAAIqC,EAAYrC,EAAKsC,MAAM,cAE3B,QAAOD,IAIP7B,EAAErB,KAAMkD,GAAW,SAAU5B,EAAU8B,GACnCF,EAAUE,GAAK9B,EAAS+B,QAAS,OAAQ,IAAKC,MAClD,IAEOJ,EACX,EAGAvB,yBAA0B,SAAUL,GAChC,OAAOA,EAAS+B,QAAS,SAAU,GACvC,EAGAP,wBAAyB,SAAUxB,GAC/B,OAAgC,IAA3BA,EAASsB,QAAQ,MACftB,EAAS+B,QAAS,SAAU,GACvC,EAGAL,yBAA0B,SAAU1B,GAEhC,IAAIiC,GADJjC,EAAW9B,EAAKmC,yBAA0BL,IACpBsB,QAAQ,KAC9B,OAAiB,IAAZW,GACEjC,EAASkC,UAAWD,EAAS,GAAID,MAC5C,EAIA5B,gBAAiB,SAAUW,EAAOgB,GAE9B,IAAO7D,EAAKG,cAAc0C,GACtB,MAAO,qDAGX,IAAIoB,EAAUjE,EAAKG,cAAc0C,GAMjC,MAJuB,iBAAXgB,IACRI,EAAUA,EAAQJ,QAAS,KAAMA,IAG9BI,CACX,IAKJjE,EAAOC,GAAGC,UACLC,cAAgBJ,CAExB,CAhND,CAgNImE,OAAQC"}