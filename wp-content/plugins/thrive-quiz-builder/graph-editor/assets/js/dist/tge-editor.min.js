(()=>{var e={296:e=>{!function(t){e.exports=Backbone.View.extend({events:{"click .click":"_call","mousedown .mousedown":"_call","mouseover .mouseover":"_call","mouseenter .mouseenter":"_call","change .change":"_call","input .input":"_call"},initialize:function(e){e&&e.template&&(this.template=e.template),this.afterInitialize(e)},_call:function(e){var t=e.currentTarget.dataset.fn;if("function"==typeof this[t])return this[t].call(this,e,e.currentTarget)},render:function(){return"string"==typeof this.template&&(this.template=TVE_Dash.tpl(this.template)),"function"==typeof this.template&&this.$el.html(this.template(this.getRenderParams())),this.afterRender(),this},getRenderParams:function(){return{model:this.model}},afterRender:t.noop,afterInitialize:t.noop})}(jQuery)},468:(e,t,i)=>{e.exports=i(296).extend({template:TVE_Dash.tpl("question/max_allowed_answers"),className:"",afterInitialize:function(e){this.answersCollection=e.answersCollection,this.questionSettings=e.questionSettings,this.listenTo(this.answersCollection,"add remove",this.answersChanged)},answersChanged:function(){this.$input.attr({max:this.answersCollection.length}),parseInt(this.$input.val())>this.answersCollection.length&&(this.$input.val(this.answersCollection.length),this.$input.trigger("input"))},afterRender:function(){this.$input=this.$("input"),this.$input.attr({min:1,max:this.answersCollection.length}).val(parseInt(this.questionSettings.get("allowed_answers")||1))},input:function(e,t){var i=parseInt(t.max),s=parseInt(t.value);s<1||isNaN(s)?(s=1,this.$input.val(s)):s>i&&(s=i,this.$input.val(s)),this.questionSettings.set("allowed_answers",s)}})}},t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}(()=>{function e(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}TGE_Editor.models=TGE_Editor.models||{},TGE_Editor.collections=TGE_Editor.collections||{},TGE_Editor.default_video_options=TGE_Editor.default_video_options||{},TGE_Editor.default_audio_options=TGE_Editor.default_audio_options||{},TGE_Editor.default_text_options=TGE_Editor.default_text_options||{},TGE_Editor.default_video_style=TGE_Editor.default_video_style||{},function(t){var i;Backbone.emulateHTTP=!0,Backbone.Collection.prototype.save=function(e){Backbone.sync("update",this,e)},TGE_Editor.models.Base=Backbone.Model.extend({defaults:{},toDeepJSON:function(){var e=t.extend(!0,{},this.attributes);return _.each(_.keys(e),(function(t){_.isUndefined(e[t])||_.isNull(e[t])||!_.isFunction(e[t].toJSON)||(e[t]=e[t].toJSON())})),e},validation_error:function(e,t,i){return{field:e,message:t,callback:i}},url:function(e){return e=e||{},e=_.extend({},e,{action:TGE_Editor.ajax_controller_action,_nonce:TGE_Editor.nonce}),TGE_Editor.ajaxurl+"?"+t.param(e)},sync:function(e,t,i){return this.beforeSync(),Backbone.sync(e,t,i)},beforeSync:function(){return this}}),TGE_Editor.models.Question=TGE_Editor.models.Base.extend({defaults:_.extend({},TGE_Editor.models.Base.prototype.defaults,{quiz_id:TGE_Editor.quiz.ID,text:"",position:{x:100,y:100},display_type_labels:{0:TGE_Editor.t.type_text,1:TGE_Editor.t.type_video,2:TGE_Editor.t.type_audio},video_source:"youtube",display_settings:{display_type:0,default_video:TGE_Editor.default_video,video_style:{selected:0,labels:{0:TGE_Editor.t.video_style_no_style,1:TGE_Editor.t.video_style_gray_monitor,2:TGE_Editor.t.video_style_black_monitor,3:TGE_Editor.t.video_style_black_tablet,4:TGE_Editor.t.video_style_white_tablet,5:TGE_Editor.t.video_style_white_frame,6:TGE_Editor.t.video_style_gray_frame,7:TGE_Editor.t.video_style_dark_frame,8:TGE_Editor.t.video_style_light_frame,9:TGE_Editor.t.video_style_lifted_style1,10:TGE_Editor.t.video_style_lifted_style2,11:TGE_Editor.t.video_style_lifted_style3,12:TGE_Editor.t.video_style_lifted_style4,13:TGE_Editor.t.video_style_lifted_style5,14:TGE_Editor.t.video_style_lifted_style6}},type:"text",source:"youtube",audio_source:"custom",source_labels:{youtube:TGE_Editor.t.video_source_youtube,vimeo:TGE_Editor.t.video_source_vimeo,wistia:TGE_Editor.t.video_source_wistia,custom:TGE_Editor.t.video_source_custom},source_audio_labels:{spotify:TGE_Editor.t.audio_source_spotify,soundcloud:TGE_Editor.t.audio_source_soundcloud,custom:TGE_Editor.t.video_source_custom},url:"",color:"#0FACF2",options:{},new_question:1,allowed_answers:1}}),initialize:function(e){null===this.get("display_settings")&&this.set("display_settings",this.defaults.display_settings);var t=[];e&&e.image&&this.set("image",new TGE_Editor.models.Image(e.image)),e&&e.answers?(t=new TGE_Editor.collections.Answers(e.answers,{q_type:this.get_type_key()}),this.set("answers",t)):(t=new TGE_Editor.collections.Answers([]),this.set("answers",t)),this.set("settings",new TGE_Editor.models.QuestionSettings(e&&e.settings?e.settings:void 0))},set:function(e,t,i){return"string"==typeof e&&this.get("settings")instanceof Backbone.Model&&0===e.indexOf("settings.")?(this.get("settings").set(e,t,i),this):Backbone.Model.prototype.set.apply(this,arguments)},get_type_key:function(){return 1==this.get("q_type")?"button":"image"},parse:function(e){if(e.answers=new TGE_Editor.collections.Answers(e.answers||[]),e.image&&(e.image=new TGE_Editor.models.Image(e.image)),e.settings&&(e.settings=new TGE_Editor.models.QuestionSettings(e.settings)),void 0!==e.display_settings){var t="Text";if(e.display_settings instanceof Backbone.Model)switch(e.display_settings.get("display_type")){case 0:default:display_settings.type="text",t="Text";break;case 1:display_settings.type="video",t="Video";break;case 2:display_settings.type="audio",t="Audio"}e.display_settings="function"==typeof TGE_Editor.models[t]?new TGE_Editor.models[t](e.display_settings):new Backbone.Model(e.display_settings)}return e},validate:function(){var e=[];if(!this.get("text")||0===this.get("text").length)return e.push(this.validation_error("text",TGE_Editor.t.question_text_required)),e;var i=!0;if(this.get("answers").each((function(e,t,s){if(i){var o=this.factory_answer(e.toJSON());o.isValid()||(i=!1,e.trigger("invalid",e,o.validationError))}}),this),!i)return[];!1===this.isOpenEndedType()&&!e.length&&this.get("answers")instanceof Backbone.Collection&&this.get("answers").length<1&&(e=TGE_Editor.t.insufficient_answers),this.isOpenEndedType()&&!1===this.get("settings").isValid()&&(e=t.merge(e,this.get("settings").validationError)),"video"===this.get("type")&&this.get("display_settings")instanceof Backbone.Model&&this.get("displaY_setting").validate(e);var s=this.get("display_settings"),o=[],n=this.changedAttributes();return!(n&&"undefined"!==n.position)&&s instanceof TGE_Editor.models.Video&&(o=s.validate())&&o.length&&e.push(o),e.length?e:void 0},factory_answer:function(e){var t=TGE_Editor.globals.question_types.findWhere({id:parseInt(this.get("q_type"))});if(!t)return new TGE_Editor.models.Answer(e);var i="Answer";return i+=TVE_Dash.upperFirst(t.get("key")),new TGE_Editor.models[i](e)},url:function(){var e={route:"question"};return this.get("id")&&(e.id=this.get("id")),TGE_Editor.models.Base.prototype.url.call(this,e)},clear_for_duplicate:function(){this.attributes.id="",delete this.attributes.rendered,delete this.attributes.level,delete this.attributes.start,this.attributes.next_question_id=null,this.attributes.previous_question_id=null,this.attributes.views=0,this.attributes.position={x:20+this.attributes.position.x,y:20+this.attributes.position.y},this.attributes.answers.each((function(e,t,i){e.clear_for_duplicate()}))},isType:function(e){var t=isNaN(e)?{key:e}:{id:parseInt(e)},i=TGE_Editor.globals.question_types.findWhere(t);return i instanceof Backbone.Model&&parseInt(this.get("q_type"))===parseInt(i.get("id"))},isOpenEndedType:function(){return this.isType(3)},isImageType:function(){return this.isType(2)},isButtonType:function(){return this.isType(1)},pushOpenEndedAnswer:function(){var e=this.get("answers");if(this.isOpenEndedType()&&e&&0===e.length)var t=this.get("answers").add(t);return this},beforeSync:function(){this.isOpenEndedType()&&this.get("answers").each((function(e){e.set({points:0},{silent:!0})}))},display_feedback:function(){var e=this.get("id")?!0===this.get("settings").get("display_question_feedback"):TGE_Editor.globals.settings.get_model("display_feedback").get("value");return!0===TGE_Editor.globals.display_feedback()&&e},resetDisplaySettings:function(){var e=Object.assign({},this.defaults.display_settings);delete e.type,this.set("display_settings",e)}}),TGE_Editor.collections.Questions=Backbone.Collection.extend({model:TGE_Editor.models.Question}),TGE_Editor.models.Answer=TGE_Editor.models.Base.extend({defaults:_.extend({},TGE_Editor.models.Base.prototype.defaults,{text:"",points:1}),initialize:function(e){e&&e.image&&this.set("image",new TGE_Editor.models.Image(e.image))},validate:function(){var e=[];return this.get("points").length<=0&&e.push(this.validation_error("points","personality"!==TGE_Editor.quiz.quiz_type?TGE_Editor.t.answer_points_required:TGE_Editor.t.answer_weight_required)),this.get("points")&&(isNaN(this.get("points"))||this.get("points")%1!=0)&&e.push(this.validation_error("points",null,(function(e){e.attr("data-position","bottom"),e.attr("data-tooltip",TGE_Editor.t.points_input_number),e.attr("data-class","tvd-red"),e.addClass("tvd-tooltipped"),e.removeClass("tvd-validate"),e.trigger("mouseenter.tooltip")}))),e.length||e.length?e:void 0},clear_for_duplicate:function(){delete this.attributes.id,delete this.attributes.next_question_id,delete this.attributes.question_id,this.get("image")instanceof TGE_Editor.models.Image&&this.set("image",new TGE_Editor.models.Image(this.get("image").toJSON().attributes))}}),TGE_Editor.models.AnswerImage=TGE_Editor.models.Answer.extend({defaults:_.extend({},TGE_Editor.models.Answer.prototype.defaults,{image:""}),initialize:function(){TGE_Editor.models.Answer.prototype.initialize.apply(this,arguments)},validate:function(){var e=TGE_Editor.models.Answer.prototype.validate.apply(this,arguments)||[];if(this.get("image")&&0!==this.get("image").length||e.push(this.validation_error("image",null,(function(e){e.attr("data-position","bottom"),e.attr("data-tooltip",TGE_Editor.t.answer_image_required),e.attr("data-class","tvd-red"),e.addClass("tvd-tooltipped"),e.trigger("mouseenter.tooltip")}))),e.length)return e}}),TGE_Editor.models.Image=TGE_Editor.models.Base.extend({defaults:_.extend({},TGE_Editor.models.Base.prototype.defaults,{sizes:{thumbnail:{url:null}}}),initialize:function(e){"string"==typeof e&&this.set(_.extend({},this.defaults,{sizes:{full:{url:e},thumbnail:{url:e}},url:e}))},get_thumb:function(){return this.attributes.sizes.thumbnail?this.attributes.sizes.thumbnail.url||this.get("url")||null:this.get("url")||null}}),TGE_Editor.models.Media=TGE_Editor.models.Base.extend({defaults:_.extend({},TGE_Editor.models.Base.prototype.defaults,{display_type:0,type:"",source:"",url:"",color:"",style:"",options:[]}),buildEmbedCode:function(){if(this.attributes.url){var e=this.videoIdAndParams();e&&this.set("video_id",e)}},reset:function(){}}),TGE_Editor.models.Video=TGE_Editor.models.Media.extend({defaults:_.extend({},TGE_Editor.models.Media.prototype.defaults,{video_id:"",style:{},thumb:"",source:"youtube",url:"",options:{autoplay:{id:"autoplay",label:TGE_Editor.t.autoplay,value:1},disable_playbar:{id:"disable_playbar",label:TGE_Editor.t.disable_playbar,value:1}},players:{youtube:{autoplay:"autoplay",hide_logo:"modestbranding",optimize_related:"rel",hide_controls:"controls",hide_full_screens:"fs"},vimeo:{autoplay:"autoplay",disable_playbar:"controls"},wistia:{autoplay:"autoplay",disable_playbar:"playbar",hide_full_screens:"fullscreenButton"},custom:{}}}),initialize:function(e){this.get("thumb")&&(this.set("thumb",new TGE_Editor.models.Image(this.get("thumb"))),this.set("show_thumb",1)),this.set("options",this.getOptions()),this.buildEmbedCode()},allowedMimeTypes:{asf:"video/x-ms-asf",asx:"video/x-ms-asf",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wm:"video/x-ms-wm",avi:"video/avi",divx:"video/divx",flv:"video/x-flv",mov:"video/quicktime",qt:"video/quicktime",mpeg:"video/mpeg",mpg:"video/mpeg",mpe:"video/mpeg",mp4:"video/mp4",m4v:"video/mp4",ogv:"video/ogg",webm:"video/webm",mkv:"video/x-matroska"},getSource:function(){return this.get("source")},hasOption:function(e){return!!this.getMediaOptionsBySource(this.get("source"))[e]},getMediaOptionsBySource:function(e){var t={};switch(e){case"youtube":t={autoplay:{id:"autoplay",label:TGE_Editor.t.autoplay,value:0},hide_logo:{id:"hide_logo",label:TGE_Editor.t.hide_logo,value:1},optimize_related:{id:"optimize_related",label:TGE_Editor.t.optimize_related,value:0},hide_controls:{id:"hide_controls",label:TGE_Editor.t.hide_controls,value:0},hide_full_screens:{id:"hide_full_screens",label:TGE_Editor.t.hide_full_screens,value:0}};break;case"vimeo":t={autoplay:{id:"autoplay",label:TGE_Editor.t.autoplay,value:0},disable_playbar:{id:"disable_playbar",label:TGE_Editor.t.disable_playbar,value:0},hide_full_screens:{id:"hide_full_screens",label:TGE_Editor.t.hide_full_screens_wistia,value:0}};case"wistia":t={autoplay:{id:"autoplay",label:TGE_Editor.t.autoplay,value:0},disable_playbar:{id:"disable_playbar",label:TGE_Editor.t.disable_playbar,value:0},hide_full_screens:{id:"hide_full_screens",label:TGE_Editor.t.hide_full_screens_wistia,value:0}};break;case"custom":t={autoplay:{id:"autoplay",label:TGE_Editor.t.autoplay,value:0},hide_controls:{id:"hide_controls",label:TGE_Editor.t.hide_controls,value:0},loop:{id:"loop",label:TGE_Editor.t.loop,value:0}}}return t},setDefaults:function(){this.attributes.source="youtube"},buildEmbedCode:function(){if(this.attributes.url){var e=this.videoIdAndParams();e&&this.set("video_id",e)}},videoIdAndParams:function(){var e="";switch(this.attributes.source){case"youtube":var t=this.attributes.url.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);e=t&&11==t[7].length?t[7]:"";break;case"vimeo":case"wistia":e=this.attributes.url.substring(this.attributes.url.lastIndexOf("/")+1)}return this.buildVideoParams(e)},buildVideoParams:function(e){var t=void 0!==this.attributes.options?this.attributes.options:[],i=void 0!==this.attributes.players?this.attributes.players:[],s=this.attributes.source,o=this.attributes.color?this.attributes.color.replace("#",""):"ffffff",n=[];if("vimeo"===s&&(n.push("color="+this.attributes.color.replace("#","")),n.push("muted=1")),"wistia"===s&&(n.push("chromeless=false"),n.push("controlsVisibleOnLoad=true"),n.push("playerColor="+o),n.push("muted=true")),"youtube"===s){var r=t&&t.hide_logo&&1===parseInt(t.hide_logo.value)?1:0;n.push("mute=1"),n.push("modestbranding="+r)}return _.each(i[s],(function(e,i){var o=i,r=e,d=void 0!==t[o]?t[o].value:"0";switch(i){case"autoplay":"youtube"!==s&&"wistia"!==s&&"vimeo"!==s||(d=1===parseInt(d)?"true":"false");break;case"hide_logo":case"hide_controls":d=1===parseInt(d)?0:1;break;case"hide_full_screens":d=1===parseInt(d)?0:1,"wistia"===s&&(d=1===parseInt(d)?"true":"false");break;case"disable_playbar":d=1===parseInt(d)?0:1,"wistia"!==s&&"vimeo"!==s||(d=1===parseInt(d)?"true":"false")}"youtube"===s&&"hide_logo"===i||n.push(r+"="+d)})),"wistia"===s&&n.push("videoFoam=true"),n.length>1?e+="?"+n.join("&"):e},valid_bind_url:function(e){var t=!!this.validateUrlBySource(e);return this.trigger(t?"tge:video:valid:url":"tge:video:invalid:url",this),t},validateUrlBySource:function(e){var t=e||this.attributes.url,i=!1,s="validate"+TVE_Dash.upperFirst(this.attributes.source)+"Url";return"function"==typeof this[s]&&(i=this[s](t)),i},validate:function(){var e=[];return this.validateUrlBySource()?e.length?e:void 0:(this.trigger("tge:video:invalid:url",this),e.push(this.validation_error("url",TVE_Dash.sprintf(TGE_Editor.t.media_url_required,[this.get("type")]))),e)},validation_error:function(e,t,i){return{field:e,message:t,callback:i}},validateYoutubeUrl:function(e){if(null!=e||""!=e){var t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/);if(t&&11==t[2].length)return!0}return!1},validateWistiaUrl:function(e){return-1!==e.indexOf("wistia")},validateVimeoUrl:function(e){return-1!==e.indexOf("vimeo")},validateCustomUrl:function(e){var t=e.split(".").pop().toLowerCase();return"string"==typeof this.allowedMimeTypes[t]&&this.allowedMimeTypes[t]},reset:function(){this.set(_.extend({type:"video",display_type:1},this.defaults))},getOptions:function(){return _.extend({},this.defaults.options,this.getMediaOptionsBySource(this.getSource()),TGE_Editor.default_video_options[this.getSource()]||{},this.get("options"))},saveGlobals:function(){TGE_Editor["default_"+this.get("type")+"_options"][this.getSource()]=this.get("options"),TGE_Editor.default_video_style=this.get("style")},getUrlPlaceholder:function(){return"custom"===this.get("source")?TGE_Editor.t.media.placeholder_file_name:TGE_Editor.t.media.placeholder_url}}),TGE_Editor.models.Audio=TGE_Editor.models.Video.extend({defaults:_.extend({},TGE_Editor.models.Video.prototype.defaults,{source:"custom",url:"",options:{autoplay:{id:"autoplay",label:TGE_Editor.t.autoplay,value:0},loop:{id:"loop",label:TGE_Editor.t.loop,value:0},show_artwork:{id:"show_artwork",label:TGE_Editor.t.hide_artwork,value:0},show_user:{id:"show_user",label:TGE_Editor.t.hide_user,value:0}},players:{spotify:{},soundcloud:{auto_play:"auto_play",show_artwork:"show_artwork",show_user:"show_user"},custom:{autoplay:"autoplay",loop:"loop"}},audio_source:"custom",source_audio_labels:{spotify:TGE_Editor.t.audio_source_spotify,soundcloud:TGE_Editor.t.audio_source_soundcloud,custom:TGE_Editor.t.video_source_custom}}),allowedMimeTypes:{mp3:"audio/mpeg",mpeg:"audio/mpeg",m4a:"audio/mpeg",m4b:"audio/mpeg",ra:"audio/x-realaudio",ram:"audio/x-realaudio",wav:"audio/wav",ogg:"audio/ogg",oga:"audio/ogg",mid:"audio/midi",midi:"audio/midi",wma:"audio/x-ms-wma",wax:"audio/x-ms-wax",mka:"audio/x-matroska"},validateUrlBySource:function(e){var t=e||this.attributes.url,i=!1,s="validate"+TVE_Dash.upperFirst(this.attributes.audio_source)+"Url";return"function"==typeof this[s]&&(i=this[s](t)),i},hasOption:function(e){return!!this.getMediaOptionsBySource(this.get("audio_source"))[e]},getMediaOptionsBySource:function(e){var t={};switch(e){case"spotify":t={};break;case"soundcloud":t={auto_play:{id:"auto_play",label:TGE_Editor.t.autoplay,value:0},show_artwork:{id:"show_artwork",label:TGE_Editor.t.hide_artwork,value:0},show_user:{id:"show_user",label:TGE_Editor.t.hide_user,value:0}};break;case"custom":t={autoplay:{id:"autoplay",label:TGE_Editor.t.autoplay,value:0},loop:{id:"loop",label:TGE_Editor.t.loop,value:0}}}return t},validateSpotifyUrl:function(e){return 0===e.indexOf("https://open.spotify.com")},validateSoundcloudUrl:function(e){return 0===e.indexOf("https://soundcloud.com")},valid_bind_url:function(e){var t=!!this.validateUrlBySource(e);return this.trigger(t?"tge:video:valid:url":"tge:video:invalid:url",this),t},buildVideoParams:function(e){var t=void 0!==this.attributes.options?this.attributes.options:[],i=this.defaults.players,s=this.attributes.audio_source,o=[];return"spotify"===s&&(e=this.attributes.url.replace("https://open.spotify.com","")),_.each(i[s],(function(e,i){var n=i,r=e,d=void 0!==t[n]?t[n].value:"0";switch(i){case"show_user":case"show_artwork":"soundcloud"===s&&(d=1===parseInt(d)?"false":"true");break;default:d=1===parseInt(d)?"true":"false"}o.push(r+"="+d)})),o.length>1?e+=o.join("&"):e},videoIdAndParams:function(){return this.buildVideoParams("")},reset:function(){this.set(_.extend({type:"audio",display_type:2},this.defaults))},getSource:function(){return this.get("audio_source")},getOptions:function(){return _.extend({},this.defaults.options,TGE_Editor.default_audio_options[this.getSource()]||{},this.get("options"))},sourceIsSpotify:function(){return"spotify"===this.getSource()},saveGlobals:function(){TGE_Editor["default_"+this.get("type")+"_options"][this.getSource()]=this.get("options"),TGE_Editor.default_video_style=this.get("style")},buildAutoplayParam:function(){var e=this.get("options");return void 0!==e.autoplay&&1===parseInt(e.autoplay.value)?"autoplay":""},buildLoopParam:function(){var e=this.get("options");return void 0!==e.loop&&1===parseInt(e.loop.value)?"loop":""},getUrlPlaceholder:function(){return"custom"===this.get("audio_source")?TGE_Editor.t.media.placeholder_file_name:TGE_Editor.t.media.placeholder_url}}),TGE_Editor.models.Text=TGE_Editor.models.Base.extend((e(i={getSource:function(){return""},getOptions:function(){return{}}},"getSource",(function(){return"text"})),e(i,"saveGlobals",(function(){TGE_Editor["default_"+this.get("type")+"_options"][this.getSource()]=this.get("options"),TGE_Editor.default_video_style=this.get("style")})),i)),TGE_Editor.models.AnswerButton=TGE_Editor.models.Answer.extend({defaults:_.extend({},TGE_Editor.models.Answer.prototype.defaults,{}),validate:function(){var e=TGE_Editor.models.Answer.prototype.validate.apply(this,arguments)||[];if(this.get("text").length<=0&&e.push(this.validation_error("text",TGE_Editor.t.answer_text_required)),e.length)return e}}),TGE_Editor.models.AnswerOpen=TGE_Editor.models.Answer.extend({defaults:_.extend({points:0},{}),validate:function(){}}),TGE_Editor.collections.Answers=Backbone.Collection.extend({model:function(e,t){var i="Answer",s=t.q_type?t.q_type:"";return i+=TVE_Dash.upperFirst(s),new TGE_Editor.models[i](e,t)},comparator:function(e,t){return(e=e.get("order"))-t.get("order")},resetToFirst:function(){var e=this.first();e.attributes.is_right=0,this.reset(e)}}),TGE_Editor.models.Connection=TGE_Editor.models.Base.extend({defaults:_.extend({},TGE_Editor.models.Base.prototype.defaults,{id:""}),url:function(){return TGE_Editor.models.Base.prototype.url.call(this,{route:"connection"})}}),TGE_Editor.models.Disconnecion=TGE_Editor.models.Base.extend({defaults:_.extend({},TGE_Editor.models.Base.prototype.defaults,{id:""}),url:function(){return TGE_Editor.models.Base.prototype.url.call(this,{route:"disconnection"})}}),TGE_Editor.models.Setting=TGE_Editor.models.Base.extend({defaults:_.extend({},TGE_Editor.models.Base.prototype.defaults,{quiz_id:TGE_Editor.quiz.ID,key:"",value:"",label:""}),modelId:function(){return this.get("key")},url:function(){return TGE_Editor.models.Base.prototype.url.call(this,{route:"settings"})},is_checked:function(){return void 0!==this.get("value")&&(!0===this.get("value")||this.get("value").length>0)}}),TGE_Editor.models.WeightsSetting=TGE_Editor.models.Setting.extend({defaults:_.extend({},TGE_Editor.models.Setting.prototype.defaults,{label:"Weights",key:"display_weight"})}),TGE_Editor.models.TagsSetting=TGE_Editor.models.Setting.extend({defaults:_.extend({},TGE_Editor.models.Setting.prototype.defaults,{label:"Tags",key:"display_tags"})}),TGE_Editor.models.FeedbackSetting=TGE_Editor.models.Setting.extend({defaults:_.extend({},TGE_Editor.models.Setting.prototype.defaults,{label:"Feedback",key:"display_feedback"})}),TGE_Editor.models.ProgressSetting=TGE_Editor.models.Setting.extend({defaults:_.extend({},TGE_Editor.models.Setting.prototype.defaults,{label:"",key:"display_progress"})}),TGE_Editor.models.ScrollSetting=TGE_Editor.models.Setting.extend({defaults:_.extend({},TGE_Editor.models.Setting.prototype.defaults,{label:"",key:"enable_scroll"})}),TGE_Editor.models.Scroll=TGE_Editor.models.Base.extend({defaults:function(){return{quiz_id:TGE_Editor.quiz.ID,enable_scroll:0}},url:function(){return TGE_Editor.models.Base.prototype.url.call(this,{route:"scroll"})}}),TGE_Editor.collections.Settings=Backbone.Collection.extend({url:function(e){return e=e||{route:"settings"},e=_.extend({},e,{action:TGE_Editor.ajax_controller_action,_nonce:TGE_Editor.nonce}),TGE_Editor.ajaxurl+"?"+t.param(e)},get_model:function(e){var t=this.findWhere({key:e});return t instanceof TGE_Editor.models.Setting?t:new TGE_Editor.models.Setting}}),TGE_Editor.models.QuestionSettings=TGE_Editor.models.Base.extend({defaults:{required:!1,form_size:1,placeholder:"Write your response here"},initialize:function(e){void 0===e&&this.set_defaults(),this.get("answer_limits")||this.set("answer_limits",this.get_answer_limits());var t=void 0===e||void 0===e.display_question_feedback?TGE_Editor.globals.settings.get_model("display_feedback").get("value"):e.display_question_feedback;this.set("display_feedback",TGE_Editor.quiz.display_feedback),this.set("display_question_feedback",t)},get_answer_limits:function(){return{min:{value:1,error_message:"Please write a minimum of (limit) characters"},max:{value:500,error_message:"You've exceeded the maximum number of (limit) characters"}}},set_defaults:function(){this.attributes.answer_limits=this.get_answer_limits()},set:function(e,t,i){if("string"==typeof e&&0===e.indexOf("settings.")){var s=e.split(".");return 4===s.length?this.attributes[s[1]][s[2]][s[3]]=t:2===s.length&&(this.attributes[s[1]]=t),this.trigger("change:"+e,this),this}return Backbone.Model.prototype.set.apply(this,arguments)}}),TGE_Editor.models.ProgressSettings=TGE_Editor.models.Base.extend({defaults:function(){return{percentage:60}},getTemplateId:function(){return TGE_Editor.quiz_style},url:function(){return TGE_Editor.models.Base.prototype.url.call(this,{route:"progress"})},getDefaultLabel:function(){return"percentage_completed"===this.get("percent_type")?"COMPLETED":"REMAINING"},getPercentToDisplay:function(){return"percentage_completed"===this.get("percent_type")?this.get("percentage"):100-this.get("percentage")}})}(jQuery)})(),TGE_Editor.modals=TGE_Editor.modals||{},function(e){e((function(){TGE_Editor.modals.ModalSteps=TVE_Dash.views.Modal.extend({stepClass:".tge-modal-step",currentStep:0,$step:null,events:{"click .tge-modal-next-step":"next","click .tge-modal-prev-step":"prev"},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this},gotoStep:function(e){var t=this.steps.hide().eq(e).show(),i=this;return this.$step=t,setTimeout((function(){i.input_focus(t)}),50),this.currentStep!==e&&(this.currentStep=e,this.trigger("modal:step_changed",parseInt(e))),this},next:function(){this.beforeNext(),this.gotoStep(this.currentStep+1),this.afterNext()},prev:function(){this.beforePrev(),this.gotoStep(this.currentStep-1),this.afterPrev()},beforeNext:function(){return this},afterNext:function(){return this},beforePrev:function(){return this},afterPrev:function(){return this},beforeClose:function(){this.$el.live_tooltip("remove"),e(".tvd-toast").remove(),e(".tvd-material-tooltip").remove()}}),TGE_Editor.modals.AddQuestion=TGE_Editor.modals.ModalSteps.extend({className:"tvd-modal-fixed-footer tvd-modal tge-modal tge-add-question-modal",template:TVE_Dash.tpl("modals/add-question"),events:_.extend({},TGE_Editor.modals.ModalSteps.prototype.events,{"click .tge-q-type":"onTypeSelected","click .tvd-modal-submit":"saveQuestion"}),initialize:function(e){TGE_Editor.modals.ModalSteps.prototype.initialize.apply(this,arguments),this.on("modal:step_changed",(function(e){this.$el.toggleClass("tqb-add-edit-q",1===parseInt(e)),1===e?(this.renderQuestionForm(this._getFormWrapper()),this.$el.css({"max-width":"1100px",width:"80%",height:"90%","max-height":"90%"})):(this.$el.css({"max-width":this.data["max-width"],width:"",height:""}),this.form_view.remove())}),this)},afterRender:function(){return this.renderTypes(TGE_Editor.globals.question_types),TGE_Editor.modals.ModalSteps.prototype.afterRender.apply(this,arguments),this},input_focus:function(e){},renderTypes:function(e){var t=TVE_Dash.tpl("question/type-card");if(!(e instanceof Backbone.Collection))return!1;e.each((function(e,i,s){this._getListWrapper().append(t({item:e,selected:e.get("id")==this.model.get("q_type")}))}),this)},_getListWrapper:function(){return this.$types_list_wrapper||(this.$types_list_wrapper=this.$("#tge-question-types")),this.$types_list_wrapper},_getFormWrapper:function(){return this.$form_wrapper||(this.$form_wrapper=this.$("#tge-question-form")),this.$form_wrapper},renderQuestionForm:function(e){this.$el.css({"max-width":"80%"});var t=_.extend({},this.model.defaults,{q_type:this.model.get("q_type"),position:this.model.get("position"),answers:new TGE_Editor.collections.Answers,settings:this.model.get("settings"),id:""});this.model.clear({silent:!0}),this.model.set(t),this.form_view=new TGE_Editor.views.GeneralQuestion({model:this.model}),this.form_view.render(),e.html(this.form_view.$el),TVE_Dash.materialize(e)},onTypeSelected:function(t){this.model.set("q_type",t.currentTarget.dataset.id),TVE_Dash.select_card(e(t.currentTarget),this._getListWrapper().find(".tge-q-type"))},next:function(){this.beforeNext()&&(this.gotoStep(this.currentStep+1),this.afterNext())},beforeNext:function(){return!!this.model.get("q_type")||(TVE_Dash.err(TGE_Editor.t.select_question_type),!1)},validateSettings:function(){var e=this.model.get("settings").get("answer_limits").min.value,t=this.model.get("settings").get("answer_limits").max.value,i=!0;return(isNaN(e)||parseInt(e)<0)&&(TVE_Dash.err("Invalid minimum characters limit"),i=!1),(isNaN(t)||parseInt(t)<0)&&(TVE_Dash.err("Invalid maximum characters limit"),i=!1),parseInt(e.length)<=0&&(TVE_Dash.err("Error message for minimum characters limit cannot be empty"),i=!1),parseInt(t.length)<=0&&(TVE_Dash.err("Error message for maximum characters limit cannot be empty"),i=!1),parseInt(e)>parseInt(t)&&(TVE_Dash.err("Minimum limit cannot be higher than the maximum limit"),i=!1),this.model.get("settings").get("placeholder").length||(TVE_Dash.err("Placeholder text cannot be empty"),i=!1),i},saveDisplayGlobals:function(){var e=this.model.get("display_settings");void 0!==e&&e.saveGlobals()},saveQuestion:function(){if(this.model.isValid()&&(this.saveDisplayGlobals(),this.validateSettings())){var e=this;0===window.tge_app_view.questions.length&&(this.model.set("start","1"),this.model.set("position",{x:tge_app_view.startFlow.position().x+tge_app_view.startFlow.get("size").width/2,y:tge_app_view.startFlow.position().y+100})),window.tge_app_view.saving(),TVE_Dash.showLoader(),this.model.save(null,{success:function(t,i,s){window.tge_app_view.questions.add(e.model),window.opener&&window.opener.postMessage({event:"tqb_question_counter_update",number:window.tge_app_view.questions.length},"*")},error:function(e,t){TVE_Dash.err(t.responseJSON.data.message)},complete:function(){TVE_Dash.hideLoader(),window.tge_app_view.change_automatically_saved(),e.close()}})}}}),TGE_Editor.modals.DeleteQuestion=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/delete-question"),events:{"click .tve-confirm-delete-action":"delete"},afterRender:function(){this.$el.addClass("tvd-red")},delete:function(){var e=window.tge_app_view.questions.findWhere({id:this.model.id});if(e instanceof TGE_Editor.models.Question){var t=this;TVE_Dash.showLoader(),e.destroy({success:function(e,i){TVE_Dash.success(TGE_Editor.t.question_success_deleted),t.model.remove(),window.opener&&window.opener.postMessage({event:"tqb_question_counter_update",number:window.tge_app_view.questions.length},"*")},error:function(e,t){TVE_Dash.err(TGE_Editor.t.question_error_deleted)},complete:function(){TVE_Dash.hideLoader(),t.close()}})}}}),TGE_Editor.modals.EditQuestion=TGE_Editor.modals.AddQuestion.extend({renderQuestionForm:function(e){this.$el.css({"max-width":"80%"}),this.model.isOpenEndedType()&&this.model.get("answers").length>1&&this.model.get("answers").resetToFirst(),this.form_view=new TGE_Editor.views.GeneralQuestionEdit({model:this.model}),this.form_view.render(),e.html(this.form_view.$el),TVE_Dash.materialize(e)},afterRender:function(){TGE_Editor.modals.AddQuestion.prototype.afterRender.apply(this,arguments),this.next(),this.$(".tge-modal-prev-step").html(TGE_Editor.t.change_question_type),this.$(".tvd-modal-title").html(TGE_Editor.t.edit_question)},htmlDecode:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},saveQuestion:function(){if(this.model.isValid()&&(this.saveDisplayGlobals(),this.validateSettings())){var e=this;TVE_Dash.showLoader(),window.tge_app_view.saving(),this.model.set("text",this.htmlDecode(this.model.get("text"))),this.model.save(null,{success:function(e,t,i){window.tge_app_view.graph.getCell(e.get("id")).set(e.toDeepJSON())},error:function(e,t){TVE_Dash.err(t.responseJSON.data.message)},complete:function(){TVE_Dash.hideLoader(),window.tge_app_view.change_automatically_saved(),e.close()}})}}}),TGE_Editor.modals.QuizzSettings=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/quiz-settings"),className:"tvd-modal tqb-progressbar-modal",events:{"click .tvd-modal-submit":"save","click .tvd-modal-close":"_close","click .tqb-reset-progress-bar":"resetProgressBar"},afterInitialize:function(){this.listenTo(this.model,"change",this.renderProgressBar)},afterRender:function(){this.$el.css({"max-width":"830px"}),new TGE_Editor.views.Switcher({model:new TGE_Editor.models.ProgressSetting({value:1===parseInt(this.model.get("display_progress")),key:"display_progress",label:"Progress bar"}),el:this.$("#tge-progress-switcher")}).render().model.on("change:value",(function(e){this.model.set("display_progress",!0===e.get("value")?1:0),this.$(".tqb-progress-options").toggleClass("tvd-hide",!1===e.get("value"))}),this),this.$(".tqb-progress-options").toggleClass("tvd-hide",1!==parseInt(this.model.get("display_progress"))),this.renderContent()},renderContent:function(){this.renderOptions(),this.renderColorPicker(),this.renderProgressBar(),TVE_Dash.data_binder(this),TVE_Dash.materialize(this.$el)},resetProgressBar:function(e){e.preventDefault(),this.model.attributes.percent_type=TGE_Editor.progress_bar_defaults.percent_type,this.model.set(_.extend({},TGE_Editor.progress_bar_defaults,{label_text:this.model.getDefaultLabel()})),this.renderContent()},renderColorPicker:function(){var e=this;this.$color_picker=this.$("#tqb-color-fill-overlay").spectrum({containerClassName:"tqb-color-picker",allowEmpty:!0,showInitial:!0,showButtons:!0,cancelText:TGE_Editor.t.media.cancel,preferredFormat:"hex",showInput:!0,change:function(t){e.model.set("fill_color",t.toHexString()),e.$("#tqb-fill-overlay-code").val(t.toHexString())},move:function(e){}}),this.$next_step_picker=this.$("#tqb-color-next-step-overlay").spectrum({containerClassName:"tqb-color-picker",allowEmpty:!0,showInitial:!0,showButtons:!0,cancelText:TGE_Editor.t.media.cancel,preferredFormat:"hex",showInput:!0,change:function(t){e.model.set("next_step_color",t.toHexString()),e.$("#tqb-color-overlay-code").val(t.toHexString())},move:function(e){}}),this.$background_picker=this.$("#tqb-color-background-overlay").spectrum({containerClassName:"tqb-color-picker",allowEmpty:!0,showInitial:!0,showButtons:!0,cancelText:TGE_Editor.t.media.cancel,preferredFormat:"hex",showInput:!0,change:function(t){e.model.set("background_color",t.toHexString()),e.$("#tqb-background-color-code").val(t.toHexString())},move:function(e){}}),this.$label_picker=this.$("#tqb-color-label-overlay").spectrum({containerClassName:"tqb-color-picker",allowEmpty:!0,showInitial:!0,showButtons:!0,cancelText:TGE_Editor.t.media.cancel,preferredFormat:"hex",showInput:!0,change:function(t){e.model.set("label_color",t.toHexString()),e.$("#tqb-color-label-code").val(t.toHexString())},move:function(e){}})},renderOptions:function(){new TGE_Editor.views.ProgressBarOptions({model:this.model,el:this.$(".tqb-progress-bar-options")}).render()},renderProgressBar:function(){new TGE_Editor.views.ProgressBar({model:this.model,el:this.$(".tqb-progress-bar")}).render()},validate:function(){return this.model.get("font_size")<10?(TVE_Dash.err(TGE_Editor.t.low_font_size_value),!1):!(this.model.get("font_size")>50&&(TVE_Dash.err(TGE_Editor.t.high_font_size_value),1))},hideColorPickers:function(){this.$color_picker.spectrum("destroy"),this.$next_step_picker.spectrum("destroy"),this.$background_picker.spectrum("destroy"),this.$label_picker.spectrum("destroy")},save:function(){if(!0===this.validate()){TVE_Dash.showLoader(),this.hideColorPickers();var e=this;this.model.save(null,{success:function(e,t,i){TGE_Editor.globals.preogress_settings.set(JSON.parse(JSON.stringify(e)))},error:function(e,t){TVE_Dash.err(t.responseJSON.data.message)},complete:function(){TVE_Dash.hideLoader(),e.close()}})}},_close:function(){this.hideColorPickers(),this.close()}})}))}(jQuery),(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}TGE_Editor.views=TGE_Editor.views||{},TGE_Editor.globals=TGE_Editor.globals||{},TGE_Editor.const=TGE_Editor.const||{},_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},TGE_Editor.const={answers_per_row:5,answer:{margin:{left:20,bottom:10},image:{size:{width:100,height:100}},size:{width:150,height:30}},question:{image:{size:{width:100}},size:{height:30}},navigator:{size:{width:250,height:250}},paper:{size:{width:5e3,height:5e3}}},TGE_Editor.globals.question_types=new Backbone.Collection(TGE_Editor.question_types);var t=new TGE_Editor.models.WeightsSetting({value:TGE_Editor.quiz.display_weight,key:"display_weight",label:"Weights"}),s=new TGE_Editor.models.TagsSetting({value:TGE_Editor.quiz.display_tags,key:"display_tags",label:"Tags"});TGE_Editor.globals.display_feedback=function(){return void 0!==TGE_Editor.quiz.highlight_settings&&"undefined"!==TGE_Editor.quiz.feedback_settings&&"survey"!==TGE_Editor.quiz.quiz_type&&("right_wrong"===TGE_Editor.quiz.quiz_type?1===TGE_Editor.quiz.highlight_settings.highlight_and_show_feedback:1===TGE_Editor.quiz.feedback_settings.display_feedback||1===TGE_Editor.quiz.feedback_settings.press_next)};var o=new TGE_Editor.models.FeedbackSetting({value:TGE_Editor.globals.display_feedback(),key:"display_feedback",label:"Feedback"});TGE_Editor.globals.settings=new TGE_Editor.collections.Settings,TGE_Editor.globals.settings.add(t),TGE_Editor.globals.settings.add(s),TGE_Editor.globals.settings.add(o);var n={quiz_id:TGE_Editor.quiz.ID};_.each(TGE_Editor.quiz.progress_settings,(function(e,t){n[t]=e})),TGE_Editor.globals.preogress_settings=new TGE_Editor.models.ProgressSettings(n),TGE_Editor.globals.settings.on("change",(function(){this.save()})),function(t){t((function(){TGE_Editor.views.AppView=Backbone.View.extend({el:"#tge-app",selectedCell:null,notMovableModels:["tge.Answer","tge.AnswerImage","tge.NewQuestion","tge.StartFlow"],sidebarList:null,costs:[],$saving_status:null,attrLinks:{".connection":{stroke:"#87548d","stroke-width":2}},events:{scroll:"on_scroll"},initialize:function(){this.$scrollers=t(".tge-scroll"),this.$collapseBtn=t("#tge-slide-cp"),this.$collapseBtn.click(_.bind(this.toggle_control_panel,this)),this.$saving_status=t("#tge-saving-status"),this.sidebarList=t("#tge-items-list"),this.questions=new TGE_Editor.collections.Questions(TGE_Editor.questions),this.answers=new Backbone.Collection,this.$add_new_question=t("#tge-add-new-question").click(this.add_new_question),t(".tqb-quiz-settings").click(this.showProgressSettings),this.listenTo(this.questions,"add",(function(e){this.loadNewQuestion(e)}),this),this.listenTo(this.questions,"remove",(function(){this.render_sidebar_list()}),this),this.listenTo(this.questions,"change:text",(function(){this.updateAnswersCollection(),this.render_sidebar_list()})),this.render_sidebar_list(),this.renderProgressSettings(),this.initializePaper(),this.initializeNavigatorPaper(),this.loadQuestions(),this.initializeStart(),this.updateAnswersCollection(),this.int_navigator(),this.$scrollers.hide(),this.$(".tge-loader").remove()},initializeNewQuestionButton:function(){_.isUndefined(this.newQuestionButton)&&(this.newQuestionButton=new joint.shapes.tge.NewQuestion({id:"new-question"}),this.graph.addCell(this.newQuestionButton));var e={x:TGE_Editor.const.paper.size.width/2-this.$el.width()/2+50,y:50};this.newQuestionButton.position(e.x,e.y)},initializeStart:function(){_.isUndefined(this.startFlow)&&(this.startFlow=new joint.shapes.tge.StartFlow({id:"start"}),this.graph.addCell(this.startFlow));var e={x:TGE_Editor.const.paper.size.width/2-this.startFlow.get("size").width/2,y:50};this.startFlow.position(e.x,e.y);var t=this.graph.get("cells").findWhere({start:"1"});t&&this.createStartLink(t)},createStartLink:function(e){this.create_link({id:"start",port:"start-port",selector:"g:nth-child(1) > g:nth-child(5) > circle:nth-child(1)"},{id:e.id,port:"q-in-port-"+e.id,selector:"g:nth-child(1) > g:nth-child(3) > circle:nth-child(1)"})},initializeNavigatorPaper:function(){var e=new joint.dia.FastPaper({preventContextMenu:!1,el:t("#tge-nav-paper"),width:TGE_Editor.const.navigator.size.width,height:TGE_Editor.const.navigator.size.height,model:this.graph});this.scale=TGE_Editor.const.navigator.size.width/this.paper.options.width,e.scale(this.scale);var i,s=this,o=(this.$el.scrollTop(),this.$el.scrollLeft(),TGE_Editor.const.paper.size.width/TGE_Editor.const.navigator.size.width),n=TGE_Editor.const.paper.size.height/TGE_Editor.const.navigator.size.height,r=this.$el.width(),d=this.$el.height();setTimeout((function(){s.$el.animate({scrollLeft:TGE_Editor.const.paper.size.width/2-r/2},500,"swing")}),500),this.$scrollers.on("mouseover",(function(e){var t=e.target.dataset.dir;i=setInterval((function(){!function(e){var t=s.$el.scrollTop(),i=s.$el.scrollLeft();switch(e){case"bottom":if(t>=TGE_Editor.const.paper.size.height-d)return;t+=10,s.$el.scrollTop(t),s.$nav_handler.css({top:t/n});break;case"top":if(t<=-10)return;t-=10,s.$el.scrollTop(t),s.$nav_handler.css({top:t/n});break;case"right":if(i>=TGE_Editor.const.paper.size.width-r)return;i+=10,s.$el.scrollLeft(i),s.$nav_handler.css({left:i/o});break;case"left":if(i<=-10)return;i-=10,s.$el.scrollLeft(i),s.$nav_handler.css({left:i/o})}}(t)}),10)})).on("mouseout",(function(){clearInterval(i)}))},initializePaper:function(){var e=this;this.graph=new joint.dia.Graph,this.paper=new joint.dia.FastPaper({preventContextMenu:!1,restrictTranslate:!0,el:this.$("#tge-paper"),width:TGE_Editor.const.paper.size.width,height:TGE_Editor.const.paper.size.height,model:this.graph,gridSize:1,snapLinks:{radius:50},linkPinning:!1,markAvailable:!0,clickThreshold:1,defaultLink:new tgeLink({router:{name:"manhattan"},connector:{name:"rounded"},attrs:this.attrLinks}),interactive:function(e){return!(e.model instanceof joint.dia.Link)||{vertexAdd:!1}},validateConnection:function(t,i,s,o,n,r){var d=t.model.get("question_id");if(d&&o.getAttribute("qid")===d+"q")return!1;var a=i.getAttribute("port"),l=e.graph.getConnectedLinks(t.model,{outbound:!0});return!(_.filter(l,(function(e){return e.get("source").port==a})).length>1||i&&"in"===i.getAttribute("port-group")||o&&"out"===o.getAttribute("port-group")||i&&o&&i.getAttribute("qid")===o.getAttribute("qid")||t===s)}}),this.paper.on("cell:pointerdown",this.onCellPointerdown,this),this.paper.on("cell:pointerup",this.onCellPointerup,this),this.paper.on("link:connect",this.onLinkConnect,this),this.paper.on("cell:mouseover",this.onCellMouseover,this),this.paper.on("cell:mouseout",this.onCellMouseout,this),this.graph.on("remove",this.onGraphRemove,this),this.graph.on("add",this.onGraphAdd,this),this.graph.on("change:position",this.onGraphChangePosition,this)},loadQuestions:function(){this.graph.fromJSON({cells:TGE_Editor.questions},{silent:!1});var e=this.graph.get("cells").where({type:"tge.Answer"}),t=this.graph.get("cells").where({type:"tge.AnswerImage"});_.each(_.union(e,t),(function(e,t,i){var s,o;e.get("next_question_id")&&(s={id:e.get("id"),selector:"g:nth-child(1) > g:nth-child(3) > circle:nth-child(1)",port:"a-port-"+e.get("id")},o={id:e.get("next_question_id")+"q",selector:"g:nth-child(1) > g:nth-child(3) > circle:nth-child(1)",port:"q-in-port-"+e.get("next_question_id")+"q"},this.create_link(s,o))}),this);var i=this.graph.get("cells").where({type:"tge.Question"});_.each(i,(function(e,t,i){var s,o;e.get("next_question_id")&&(s={id:e.get("id"),selector:"g:nth-child(1) > g:nth-child(4) > circle:nth-child(1)",port:"q-out-port-"+e.get("id")},o={id:e.get("next_question_id"),selector:"g:nth-child(1) > g:nth-child(3) > circle:nth-child(1)",port:"q-in-port-"+e.get("next_question_id")},this.create_link(s,o))}),this)},loadNewQuestion:function(e){var t,i=e.toDeepJSON(),s=this.graph.getCell(i.id),o=-1,n=0;if(s?(s.set(i),t=s):(t=new joint.shapes.tge.Question(_.extend(i,{})),this.graph.addCell(t)),_.each(i.answers,(function(e,s,r){s&&s%TGE_Editor.const.answers_per_row==0&&(o=-1,n++),o++,this.loadNewAnswer(e,t,i,o,n)}),this),1==t.get("start")){this.createStartLink(t);var r=t.position(),d={x:r.x-t.get("size").width/2,y:r.y};this.selectedCell=this.paper.findViewByModel(t),t.position(d.x,d.y),t.loadAnswers(),this.paper.trigger("cell:pointerup",this.selectedCell),this.render_sidebar_list()}},loadNewAnswer:function(e,t,i,s,o){var n,r=this.graph.getCell(e.id);r?r.set(e):(n=new joint.shapes.tge.Answer(_.extend(e,{col:s,row:o,jQuestion:t.toJSON()})),t.embed(n),this.graph.addCell(n))},create_link:function(e,t){var i={type:"link",source:{id:"qqqq1",selector:"g:nth-child(1) > g:nth-child(4) > circle:nth-child(1)",port:"q-out-port-q1"},target:{id:"q2",selector:"g:nth-child(1) > g:nth-child(3) > circle:nth-child(1)",port:"q-in-port-q2"},router:{name:"manhattan"},connector:{name:"rounded"},embeds:"",z:16,attrs:this.attrLinks};if(e&&(i.source=e),t&&(i.target=t),this.graph.getCell(i.source.id)&&this.graph.getCell(i.target.id)){var s=new tgeLink(i);this.graph.addCell(s)}},disconnect_link:function(e,t){if(e.id&&t.id){var i=new TGE_Editor.models.Disconnecion({source:e,target:t});window.tge_app_view.saving(),i.save(null,{error:function(e,t){TVE_Dash.err(t.responseJSON.data.message)},complete:function(){window.tge_app_view.change_automatically_saved()}})}},save_link:function(e,t,i){return new Promise((function(s){var o=new TGE_Editor.models.Connection({source:e,target:t});window.tge_app_view.saving(),o.save(null,{error:function(e,t){i.model.disconnect(),TVE_Dash.err(t.responseJSON.data.message),s()},complete:function(){window.tge_app_view.change_automatically_saved(),s()}})}))},renderQuestion:function(e){var t=new TGE_Editor.views.QuestionView({model:e});this.sidebarList.append(t.render().$el)},onCellPointerup:function(e,t){this.selectedCell=null;var i=t?t.target.getAttribute("class"):null;if("tge-remove-tool"!==i&&"tge-edit-tool"!==i&&"tge.Question"===e.model.get("type")&&e.model.changed.position){var s=this.questions.findWhere({id:e.model.id});s.set("position",e.model.get("position")),window.tge_app_view.saving(),s.save(null,{complete:function(){window.tge_app_view.change_automatically_saved()}})}this.$scrollers.hide()},onCellPointerdown:function(e){this.selectedCell=e,this.$scrollers.show()},onCellMouseover:function(e){"tge.Question"===e.model.get("type")&&e.$(".tge-question-tools").attr("style","display: inline")},onCellMouseout:function(e){"tge.Question"===e.model.get("type")&&e.$(".tge-question-tools").attr("style","display: none")},onLinkConnect:function(e){var t=this,i=this.save_link(e.model.get("source"),e.model.get("target"),e);if("start"===e.model.get("source").id){var s=this.questions.findWhere({id:e.model.get("target").id});s instanceof Backbone.Model&&s.set("start","1")}else{var o,n=e.model.get("source").id;(o=-1!==n.indexOf("a")?this.answers.findWhere({id:n}):this.questions.findWhere({id:n}))instanceof Backbone.Model&&o.set("next_question_id",e.model.get("target").id)}this.render_sidebar_list()||i.then((function(){t.onGraphRemove(e.model),e.model.disconnect()}))},onGraphRemove:function(e){if(e.isLink()&&!_.isUndefined(e.get("source").id)&&!_.isUndefined(e.get("target").id)){if(this.disconnect_link(e.get("source"),e.get("target")),"start"===e.get("source").id){var t=this.questions.findWhere({id:e.get("target").id});t instanceof Backbone.Model&&t.set("start",null)}else{var i,s=e.get("source").id;(i=-1!==s.indexOf("a")?this.answers.findWhere({id:s}):this.questions.findWhere({id:s}))instanceof Backbone.Model&&i.set("next_question_id",null)}this.render_sidebar_list()}},onGraphAdd:function(e){"tge.Question"===e.get("type")&&e.loadAnswers()},onGraphChangePosition:function(e){this.selectedCell&&-1!==_.indexOf(this.notMovableModels,this.selectedCell.model.get("type"))&&e.set("position",e.previous("position"))},render_questions:function(e,t){if(void 0===t&&(t=0),e instanceof Backbone.Model&&e.get("answers")instanceof Backbone.Collection){e.attributes.level=t,!0!==e.get("rendered")&&this.renderQuestion(e);var i=e.get("next_question_id"),s=null;i&&(s=this.questions.findWhere({id:i.replace("q","")+"q"})),e.get("answers").each((function(e,i,s){if(e.get("next_question_id")){var o=e.get("next_question_id"),n=this.questions.findWhere({id:o.replace("q","")+"q"}),r=t;n instanceof Backbone.Model&&(r++,this.render_questions(n,r))}}),this),s instanceof Backbone.Model&&this.render_questions(s,t)}},_get_paths:function(e,t,i,s){if(!_.isUndefined(e)){var o={q:e.get("text"),points:t,path_key:i,paths:[],level:s};return!0!==e.get("rendered")&&(e.attributes.level=s,e.attributes.path=i,this.renderQuestion(e)),e.get("answers").each((function(n,r,d){var a=s;n.get("next_question_id")&&a++;var l=n.get("next_question_id")?n.get("next_question_id"):e.get("next_question_id");l=l||"";var h=this.questions.findWhere({id:l.replace("q","")+"q"}),u=parseInt(n.get("points"));h instanceof Backbone.Model?o.paths.push(this._get_paths(h,t+u,i+":"+n.get("text"),a)):(o.paths.push({path_key:i+":"+n.get("text"),points:n.get("points")}),this.costs.push(t+u))}),this),o}},render_sidebar_list:function(){var e=!0;this.sidebarList.empty(),this.questions.each((function(e){e.attributes.rendered=!1}));try{this.render_questions(this.questions.findWhere({start:"1"}),0,"Start",0)}catch(t){e=!1,TVE_Dash.err("Links that form a loop is not permitted!")}return e},updateAnswersCollection:function(){this.answers.reset(),this.questions.each((function(e){e.get("answers").each((function(e){this.answers.push(e)}),this)}),this)},saving:function(){this.$saving_status.html(TGE_Editor.t.saving)},change_automatically_saved:function(){this.$saving_status.html('<span class="tvd-icon-question-circle"></span><span>'+TGE_Editor.t.changes_automatically_saved+"</span>")},toggle_control_panel:function(e){var i=this,s="tge-cp-collapsed";t("#tge-control-panel").toggleClass(s),this.$el.toggleClass(s),setTimeout((function(){e.cp_collapsed=i.$el.hasClass(s),i.trigger("tge:cp:collapse",e)}),700)},int_navigator:function(){t("#tge-nav-control").click((function(){var e=t(this);if(e.hasClass("tvd-icon-minus"))return t("#tge-nav-paper").css({height:0}),e.removeClass("tvd-icon-minus").addClass("tvd-icon-plus"),void e.attr("data-tooltip",TGE_Editor.t.maximize);t("#tge-nav-paper").css({height:250}),e.removeClass("tvd-icon-plus").addClass("tvd-icon-minus"),e.attr("data-tooltip",TGE_Editor.t.minimize)}));var e=function(e){var t={width:10,height:10},i=TGE_Editor.const.paper.size.width,s=TGE_Editor.const.paper.size.height,o=e.width/i,n=e.height/s;return t.width=TGE_Editor.const.navigator.size.width*o,t.height=TGE_Editor.const.navigator.size.height*n,{width:t.width+"px",height:t.height+"px"}},i=this,s={width:this.$el.width(),height:this.$el.height()};this.$nav_handler=t("#tge-nav-handler");var o=TGE_Editor.const.paper.size.width/TGE_Editor.const.navigator.size.width,n=TGE_Editor.const.paper.size.height/TGE_Editor.const.navigator.size.height;this.$nav_handler.css(e(s)),this.$nav_handler.draggable({containment:"parent",drag:function(e,t){var i=t.position.left*o,s=t.position.top*n;tge_app_view.$el.scrollLeft(i),tge_app_view.$el.scrollTop(s)}}),this.on("tge:cp:collapse",(function(t){var s={width:this.$el.width(),height:this.$el.height()},o=e(s);i.$nav_handler.css(o)}))},on_scroll:function(e){var t=e.target.scrollTop,i=e.target.scrollLeft,s=TGE_Editor.const.paper.size.width/TGE_Editor.const.navigator.size.width,o=TGE_Editor.const.paper.size.height/TGE_Editor.const.navigator.size.height;this.$nav_handler.css({top:t/o,left:i/s})},add_new_question:function(){var e={x:150+tge_app_view.$el.scrollLeft(),y:150+tge_app_view.$el.scrollTop()},t=new TGE_Editor.models.Question({position:e});TVE_Dash.modal(TGE_Editor.modals.AddQuestion,{model:t,dismissible:!1,"max-width":"40%"})},renderProgressSettings:function(){new TGE_Editor.views.ProgressSettings({el:t(".tqb-progress-settings"),model:TGE_Editor.globals.preogress_settings}).render()},showProgressSettings:function(){t(".tqb-progress-settings").addClass("tqb-show-progress"),t(".tqb-quiz-settings").addClass("tqb-qs-gray")}}),TGE_Editor.views.ProgressSettings=Backbone.View.extend({template:TVE_Dash.tpl("progress/settings"),events:{"click .tqb-hide-progress-settings":function(){this.$el.removeClass("tqb-show-progress"),t(".tqb-quiz-settings").removeClass("tqb-qs-gray")},"click .tqb-progress-holder":function(){TVE_Dash.modal(TGE_Editor.modals.QuizzSettings,{"max-width":"80%",model:new TGE_Editor.models.ProgressSettings(JSON.parse(JSON.stringify(TGE_Editor.globals.preogress_settings))),complete:function(){}})}},initialize:function(){this.listenTo(this.model,"change:display_progress",this.render)},render:function(){return this.$el.html(this.template({model:this.model})),this.renderScrollSettings(),this},renderScrollSettings:function(){new TGE_Editor.views.ScrollSettings({el:t(".tqb-scroll-settings"),model:new TGE_Editor.models.Scroll(TGE_Editor.quiz.scroll_settings)}).render()}}),TGE_Editor.views.ScrollSettings=Backbone.View.extend({template:TVE_Dash.tpl("scroll/settings"),render:function(){return this.$el.html(this.template({model:this.model})),new TGE_Editor.views.Switcher({model:new TGE_Editor.models.ScrollSetting({value:1===parseInt(this.model.get("enable_scroll"))}),el:this.$("#tge-scroll-switcher")}).render().model.on("change:value",(function(e){this.model.attributes.enable_scroll=!0===e.get("value")?1:0,this.model.save(null,{complete:function(){TVE_Dash.success(TGE_Editor.t.scroll_settings_saved)}})}),this),this}}),TGE_Editor.views.TypeSwitcher=Backbone.View.extend({events:{"click #tge-question-type-selector":function(){this.closeDropdowns(),this.toggleOptions()}},template:TVE_Dash.tpl("question/type_switcher"),render:function(){return this.$el.html(this.template({model:this.model})),this},toggleOptions:function(){this.$(".tge-question-display-type").toggleClass("tvd-hiddendiv")},closeDropdowns:function(){t(".tge-video-source-dropdown, .tge-video-style-dropdown, .tge-display-options-data").addClass("tvd-hiddendiv")}}),TGE_Editor.views.FormQuestion=Backbone.View.extend({template:TVE_Dash.tpl("question/form"),settingsTemplate:TVE_Dash.tpl("question/settings"),answers_views:[],events:{"click #tge-qf-add-description":"add_description_field","click #tge-gf-delete-description":"remove_description_field","click #tge-qf-add-answer":function(){this.model.isOpenEndedType()||this.add_answer()},"keyup #tge-question-description-textarea":function(e){e.stopPropagation()},"keyup .tge-answer-text":function(e){e.stopPropagation(),13===e.keyCode&&this.add_answer()},"keyup #tge-question-feedback":function(e){this.model.set({feedback:e.target.value},{silent:!0})}},initialize:function(){this.listenTo(this.model.get("answers"),"add",this.renderAnswerForm),this.listenTo(this.model.get("answers"),"remove",(function(e){1===parseInt(e.get("is_right"))&&this.model.get("answers").first().set("is_right",1)}));var e=this;this.model.on("tge:video:renderEmbed",(function(t){e.renderEmbededVideo()})),this.model.on("tge:video:disableAutoplay",(function(t){e.disableAutoplay()})),this.model.on("tge:video:enableAutoplay",(function(t){e.enableAutoplay()}))},toggle_feedback:function(){!0===this.model.display_feedback()?this.$(".tge-feedback-column").show():this.$(".tge-feedback-column").hide()},render:function(){return this.$el.html(this.template({item:this.model})),this.model.isOpenEndedType()&&(this.$("#tge-qf-add-answer").hide(),this.renderSettings()),TVE_Dash.data_binder(this),this.renderAnswers(this.model.get("answers")),this.renderImagePicker(this.$("#tge-qf-image-loader")),"personality"===TGE_Editor.quiz.quiz_type&&!1===this.model.isOpenEndedType()&&this.render_weight_switcher(),!1===this.model.isOpenEndedType()&&(this.render_tags_switcher(),this.render_feedback_switcher()),0===this.model.get("answers").length&&this.add_answer(),this.renderMaxAllowedAnswers(),setTimeout((function(e){e.$("input#tge-question-text").first().focus()}),10,this),this},checkDisabledThumb:function(){var e=this.model.get("display_settings")instanceof Backbone.Model?this.model.get("display_settings"):this.model,t=e.get("options");void 0!==e&&void 0!==t.autoplay&&1===parseInt(t.autoplay.value)&&(this.model.trigger("tge:video:disableVideoThumb"),this.model.trigger("tge:video:removeVideoThumb"))},disableAutoplay:function(){this.$(".tge-v_option-autoplay").attr("disabled","disabled")},enableAutoplay:function(){this.$(".tge-v_option-autoplay").removeAttr("disabled")},render_weight_switcher:function(){new TGE_Editor.views.Switcher({model:TGE_Editor.globals.settings.get_model("display_weight"),el:this.$("#tge-points-switcher")}).render()},render_tags_switcher:function(){new TGE_Editor.views.TagsSwitcher({model:TGE_Editor.globals.settings.get_model("display_tags"),el:this.$("#tge-tags-switcher")}).render()},render_feedback_switcher:function(){if(TGE_Editor.globals.display_feedback()){var e=new TGE_Editor.views.Switcher({model:new TGE_Editor.models.FeedbackSetting({value:this.model.get("id")?this.model.get("settings").get("display_question_feedback"):TGE_Editor.globals.settings.get_model("display_feedback").get("value"),key:"display_feedback",label:"Feedback"}),el:this.$("#tge-feedback-switcher")});e.render(),this.toggle_feedback(),this.listenTo(e.model,"change:value",(function(){this.model.get("settings").set({display_question_feedback:e.model.get("value")},{silent:!0}),TGE_Editor.globals.settings.get_model("display_feedback").set({value:e.model.get("value")}),this.toggle_feedback()}))}},renderMaxAllowedAnswers:function(){this.model.isOpenEndedType()||"survey"===TGE_Editor.quiz.quiz_type?this.$(".tqb-max-allowed-answers-wrapper").hide():this.$(".tqb-max-allowed-answers-wrapper").html(new(i(468))({questionSettings:this.model.get("settings"),answersCollection:this.model.get("answers")}).render().$el)},renderAnswerForm:function(e){e.off("change:is_right");var t=this,i=TGE_Editor.globals.question_types.findWhere({id:parseInt(this.model.get("q_type"))});if(i instanceof Backbone.Model&&"function"==typeof TGE_Editor.views["FormAnswer"+TVE_Dash.upperFirst(i.get("key"))]){var s=new(TGE_Editor.views["FormAnswer"+TVE_Dash.upperFirst(i.get("key"))])({model:e,collection:this.model.get("answers"),question:this.model});this.answers_views.push(s),this._getAnswersWrapper().append(s.render().$el).sortable({handle:this.$(".tge-sort-handle"),placeholder:"tge-sortable-placeholder",sort:function(e,t){t.placeholder.css({border:"2px dashed gray",width:t.helper.css("width"),height:t.helper.css("height"),margin:t.helper.css("margin")})},update:function(){t.update_answers_order()}}),TVE_Dash.materialize(s.$el)}},update_answers_order:function(){_.each(this.answers_views,(function(e,t,i){e.model.attributes.order=e.$el.index()}),this)},_getAnswersWrapper:function(){return this.$answers_wrapper||(this.$answers_wrapper=this.$("#tge-answers-wrapper")),this.$answers_wrapper},add_description_field:function(){this.$("#tge-question-description").show(),this.$("#tge-qf-add-description").hide(),this.$("#tge-question-description-textarea").trigger("autoresize").focus().select()},add_answer:function(){if(this.model.get("answers").findWhere(this.model.isImageType()?{image:""}:{text:""})instanceof Backbone.Model)TVE_Dash.err(this.model.isImageType()?TGE_Editor.t.invalid_image_answer:TGE_Editor.t.invalid_text_answer);else{var e=TGE_Editor.globals.question_types.findWhere({id:parseInt(this.model.get("q_type"))}),t="Answer";e instanceof Backbone.Model&&"function"==typeof TGE_Editor.models[t+TVE_Dash.upperFirst(e.get("key"))]&&(t+=TVE_Dash.upperFirst(e.get("key")));var i=new TGE_Editor.models[t]({order:this.model.get("answers").length});"right_wrong"===TGE_Editor.quiz.quiz_type&&(i.set("points",0),0===this.model.get("answers").length&&(i.set("is_right",1),i.set("points",1))),"personality"===TGE_Editor.quiz.quiz_type&&i.set("result_id",0),this.model.get("answers").push(i),this.$el.find(".tge-answer-text").last().focus()}},remove_description_field:function(){this.model.set("description",""),this.$("#tge-qf-add-description").html(TGE_Editor.t.add_description),this.$("#tge-question-description").hide(),this.$("#tge-qf-add-description").show()},renderAnswers:function(e){this.answers_views=[],e instanceof Backbone.Collection&&e.each((function(e,t,i){this.renderAnswerForm(e)}),this)},renderImagePicker:function(e){new TGE_Editor.views.ImagePicker({model:this.model,el:e}).render()},renderEmbededVideo:function(e){e=e||this.$el.find("#tge-qf-video-loader");var i=this.model instanceof TGE_Editor.models.Video?this.model:this.model.get("display_settings"),s=i.getSource();if(i.set("url",t.trim(i.get("url"))),""!==i.get("url")){switch(i.buildEmbedCode(),s){case"youtube":default:o=new TGE_Editor.views.YotubeEmbededVideo({model:this.model,el:e});break;case"vimeo":o=new TGE_Editor.views.VimeoEmbededVideo({model:this.model,el:e});break;case"wistia":o=new TGE_Editor.views.WistiaEmbededVideo({model:this.model,el:e});break;case"custom":o=new TGE_Editor.views.CustomEmbededVideo({model:this.model,el:e})}o.render()}else{var o;(o=new TGE_Editor.views.ErrEmbededVideo({model:i,el:e})).render()}},renderSettings:function(){var e="tge_question_settings_toggle";this.$("#tge-question-settings").append(this.settingsTemplate({settings:this.model.get("settings")}));var t=this.$("#tge-answer-limits");!0===TVE_Dash.LocalStorage.get(e)&&t.css("display","flex"),this.$('input[name="form_size"][value="'+this.model.get("settings").get("form_size")+'"]').prop("checked",!0),new TGE_Editor.views.Switcher({model:new TGE_Editor.models.Setting({label:"Required field",key:"req-toggle",value:this.model.get("settings").get("required")}),el:this.$("#tge-required-switcher")}).render().model.on("change:value",(function(e){this.model.get("settings").set("required",e.get("value"))}),this),new TGE_Editor.views.Accordion({model:new TGE_Editor.models.Setting({label:"Advanced Answer Settings",value:!!TVE_Dash.LocalStorage.get(e)}),el:this.$("#tge-question-switcher-settings")}).render().model.on("change:value",(function(i,s){var o=s?"flex":"none";TVE_Dash.LocalStorage.set(e,!!s),t.css({display:o}),this.$(".tge-accordion").toggleClass("tge-active",s)}),this),this.model.get("settings").on("change:settings.placeholder",(function(e){this.$("#tge-open-question-preview").attr("placeholder",e.get("placeholder"))}),this),this.model.get("settings").on("change:settings.answer_limits.min.error_message",(function(e){this.$("#tge-min-error_message-preview").text(e.get("answer_limits").min.error_message)}),this),this.model.get("settings").on("change:settings.form_size",(function(e){this.$("#tge-open-question-preview").attr("rows",e.get("form_size"))}),this)}}),TGE_Editor.views.FormQuestionDisplayText=TGE_Editor.views.FormQuestion.extend({template:TVE_Dash.tpl("question/form-text")}),TGE_Editor.views.FormQuestionDisplayVideo=TGE_Editor.views.FormQuestion.extend({template:TVE_Dash.tpl("question/form-video"),events:_.extend({},TGE_Editor.views.FormQuestion.prototype.events,{"change #tge-display-settings-url":function(e){var t=this.model.get("display_settings");t.validateUrlBySource(),this.closeDropdowns(),this.renderEmbededVideo(),this.setDisplayOptions(),t.trigger("tge:video:renderOptions")},"click .tge-display-checkbox":"handleAdvancedOptions","change #tge-display-url-source":"setSource"}),render:function(){return this.$el.html(this.template({item:this.model})),this.renderVideoSettings(),this.renderEmbededVideo(),this.model.isOpenEndedType()&&(this.$("#tge-qf-add-answer").hide(),this.renderSettings()),TVE_Dash.data_binder(this),this.renderAnswers(this.model.get("answers")),this.renderImagePicker(this.$("#tge-qf-image-loader")),"personality"===TGE_Editor.quiz.quiz_type&&!1===this.model.isOpenEndedType()&&this.render_weight_switcher(),!1===this.model.isOpenEndedType()&&(this.render_tags_switcher(),this.render_feedback_switcher()),this.checkDisabledThumb(),this.renderMaxAllowedAnswers(),TVE_Dash.materialize(this.$el),setTimeout((function(e){e.$("input#tge-question-text").first().focus()}),10,this),this},setDisplayOptions:function(){var t=this.model.get("source"),i=this.model.get("new_question"),s="object"===e(TGE_Editor.default_video_options)?TGE_Editor.default_video_options:JSON.parse(TGE_Editor.default_video_options);s&&t in s&&1===i&&(this.model.set("options",s[t]),this.model.trigger("tge:video:renderOptions"))},renderVideoSettings:function(){var e=this.model.get("display_settings"),t=this.model;this.settings_view=new TGE_Editor.views.FormVideoDisplaySettings({model:e,el:this.$el.find(".tge-media-prop"),question_model:t}),this.settings_view.render()},setSource:function(e){this.model.set("source",e.currentTarget.value)},handleAdvancedOptions:function(e){"autoplay"===t(e.currentTarget).data("id")&&this.model.trigger(t(e.currentTarget).is(":checked")?"tge:video:disableVideoThumb":"tge:video:enableVideoThumb"),this.model.get("display_settings").buildEmbedCode(),this.renderEmbededVideo()},closeDropdowns:function(){this.$(".tge-display-options-data, .tge-video-style-dropdown, .tge-question-display-type").addClass("tvd-hiddendiv")}}),TGE_Editor.views.FormQuestionDisplayAudio=TGE_Editor.views.FormQuestionDisplayVideo.extend({template:TVE_Dash.tpl("question/form-audio"),render:function(){return TGE_Editor.views.FormQuestionDisplayVideo.prototype.render.call(this),this.model.trigger("tge:video:disableVideoThumb"),this},renderVideoSettings:function(){var e=this.model.get("display_settings");this.settings_view=new TGE_Editor.views.FormAudioDisplaySettings({model:e,el:this.$el.find(".tge-media-prop")}),this.settings_view.render()},setDisplayOptions:function(){var t=this.model.get("audio_source"),i=this.model.get("new_question"),s="object"===e(TGE_Editor.default_audio_options)?TGE_Editor.default_audio_options:JSON.parse(TGE_Editor.default_audio_options);s&&t in s&&1===i&&(this.model.set("options",s[t]),this.model.trigger("tge:video:renderOptions"))},renderEmbededVideo:function(e){e=e||this.$el.find("#tge-qf-video-loader");var i=this.model instanceof TGE_Editor.models.Audio?this.model:this.model.get("display_settings"),s=i.get("audio_source");if(i instanceof TGE_Editor.models.Audio)if(i.set("url",t.trim(i.get("url"))),""!==i.get("url")){switch(i.buildEmbedCode(),s){case"custom":default:o=new TGE_Editor.views.CustomEmbededAudio({model:i,el:e});break;case"spotify":o=new TGE_Editor.views.SpotifyEmbededAudio({model:i,el:e});break;case"soundcloud":o=new TGE_Editor.views.SoundCloudEmbededAudio({model:i,el:e})}o.render()}else{var o;(o=new TGE_Editor.views.ErrEmbededAudio({model:i,el:e})).render()}},handleAdvancedOptions:function(e){this.model.get("display_settings").buildEmbedCode(),this.renderEmbededVideo()}}),TGE_Editor.views.GeneralQuestion=Backbone.View.extend({template:TVE_Dash.tpl("question/general"),events:{"click .tge-dropdown-type-item":function(e){var i=parseInt(t(e.currentTarget).data("id"));this.form_view.undelegateEvents(),this.setRelatedModel(i),this.handleDropdown(e),this.renderQuestionForm(),TVE_Dash.materialize(this.$el)}},render:function(){return this.$el.html(this.template({item:this.model})),this.setRelatedModel(),this.renderDisplayType(),this.renderQuestionForm(),this.closeDropdowns(),this},closeDropdowns:function(){t(document).click((function(e){t(e.target).is(".tge-display-checkbox, .tge-display-options-data, .tge-vopts-selected-elem, .tge-selected-video-source, #tge-question-type-selector, .tge-selected-video-style, #tge-display-video-options, .tge-vopts-selected-elem")||t(e.target).parents(".tge-display-options-data").length>0||t(".tge-video-source-dropdown, .tge-video-style-dropdown, .tge-display-options-data, .tge-question-display-type").addClass("tvd-hiddendiv")}))},setRelatedModel:function(e){void 0!==e&&this.model.resetDisplaySettings(),2===e&&this.model.unset("image");var t=this.model.get("display_settings")instanceof Backbone.Model?this.model.get("display_settings").toDeepJSON():this.model.get("display_settings"),i=t&&t.display_type?t.display_type:0,s="",o={};switch(e=void 0!==e?e:i){case 1:o.type="video",o.source="youtube",s="Video";break;case 2:o.type="audio",o.source="custom",s="Audio";break;default:o.type="text",s="Text"}t=_.extend({},o,t);var n="function"==typeof TGE_Editor.models[s]?new TGE_Editor.models[s](t):new Backbone.Model(t);if(n.set("display_type",e),void 0!==n.get("new_question")&&1===parseInt(n.get("new_question"))){var r=n.get("video_style");r.selected=TGE_Editor.default_video_style,n.set("video_style",r),n.set("style",r.selected)}n instanceof TGE_Editor.models.Audio&&this.model.set("image",""),n.set("options",n.getOptions()),this.model.set("display_settings",n)},handleDropdown:function(e){var i=t(e.currentTarget).data("id"),s="text";switch(parseInt(i)){case 0:s="text";break;case 1:s="video";break;case 2:s="audio"}t(".tge-question-type-selector").removeClass((function(e,t){return(t.match(/\btge-vicon-\S+/g)||[]).join(" ")})),t(".tge-question-type-selector").addClass("tge-vicon-"+s),t(".tge-question-type-selector").text(this.model.get("display_type_labels")[i]),t(".tge-question-display-type").addClass("tvd-hiddendiv")},renderDisplayType:function(){new TGE_Editor.views.TypeSwitcher({model:this.model,el:this.$el.find(".tge-display-holder")}).render()},renderQuestionForm:function(){var e=this.model.get("display_settings").get("display_type");switch(parseInt(e)){case 0:default:this.form_view=new TGE_Editor.views.FormQuestionDisplayText({model:this.model,el:this.$el.find(".tge-q-form-wrapper")});break;case 1:this.form_view=new TGE_Editor.views.FormQuestionDisplayVideo({model:this.model,el:this.$el.find(".tge-q-form-wrapper")});break;case 2:this.form_view=new TGE_Editor.views.FormQuestionDisplayAudio({model:this.model,el:this.$el.find(".tge-q-form-wrapper")})}this.form_view.render()}}),TGE_Editor.views.FormQuestionEdit=TGE_Editor.views.FormQuestion.extend({render:function(){return this.$el.html(this.template({item:this.model})),this.model.get("description")&&this.model.get("description").length&&this.$("#tge-qf-add-description").html(TGE_Editor.t.edit_description),this.model.isOpenEndedType()?(this.$("#tge-qf-add-answer").hide(),this.renderSettings()):(this.render_tags_switcher(),this.render_feedback_switcher()),TVE_Dash.data_binder(this),this.renderAnswers(this.model.get("answers")),this.renderImagePicker(this.$("#tge-qf-image-loader")),"personality"===TGE_Editor.quiz.quiz_type&&!1===this.model.isOpenEndedType()&&this.render_weight_switcher(),this.renderMaxAllowedAnswers(),this}}),TGE_Editor.views.FormQuestionDisplayTextEdit=TGE_Editor.views.FormQuestionEdit.extend({template:TVE_Dash.tpl("question/form-text")}),TGE_Editor.views.FormQuestionDisplayVideoEdit=TGE_Editor.views.FormQuestionEdit.extend({template:TVE_Dash.tpl("question/form-video"),events:function(){return _.extend({},TGE_Editor.views.FormQuestion.prototype.events,{"change #tge-display-settings-url":function(e){this.model.get("display_settings").validateUrlBySource(),this.closeDropdowns(),this.setDisplayOptions(),this.renderEmbededVideo()},"click .tge-display-checkbox":function(e){"autoplay"===t(e.currentTarget).data("id")&&this.model.trigger(t(e.currentTarget).is(":checked")?"tge:video:disableVideoThumb":"tge:video:enableVideoThumb"),this.model.get("display_settings").buildEmbedCode(),this.renderEmbededVideo()},"change #tge-display-url-source":"setSource"})},render:function(){var e=this.model.get("display_settings");return 0==e instanceof Backbone.Model&&(e=new TGE_Editor.models.Video(e),this.model.set({display_settings:e})),this.$el.html(this.template({item:this.model})),this.renderVideoSettings(),this.renderEmbededVideo(),this.model.isOpenEndedType()&&(this.$("#tge-qf-add-answer").hide(),this.renderSettings()),TVE_Dash.data_binder(this),this.renderAnswers(this.model.get("answers")),this.renderImagePicker(this.$("#tge-qf-image-loader")),"personality"===TGE_Editor.quiz.quiz_type&&!1===this.model.isOpenEndedType()&&this.render_weight_switcher(),!1===this.model.isOpenEndedType()&&(this.render_tags_switcher(),this.render_feedback_switcher()),this.checkDisabledThumb(),this.renderMaxAllowedAnswers(),TVE_Dash.materialize(this.$el),setTimeout((function(e){e.$("input#tge-question-text").first().focus()}),10,this),this},checkDisabledThumb:function(){var e=this.model.get("display_settings"),t=e.get("options");void 0!==e&&void 0!==t.autoplay&&1===parseInt(t.autoplay.value)&&this.model.trigger("tge:video:disableVideoThumb")},setDisplayOptions:function(){var t=this.model.get("source"),i=this.model.get("new_question"),s="object"===e(TGE_Editor.default_video_options)?TGE_Editor.default_video_options:JSON.parse(TGE_Editor.default_video_options);s&&t in s&&1===i&&(this.model.set("options",s[t]),this.model.trigger("tge:video:renderOptions"))},renderVideoSettings:function(){var e=this.model.get("display_settings"),t=this.model;this.settings_view=new TGE_Editor.views.FormVideoDisplaySettings({model:e,el:this.$el.find(".tge-media-prop"),question_model:t}),this.settings_view.render()},toggleStyleOptions:function(){this.$(".tge-video-style-dropdown").toggleClass("tvd-hiddendiv")},setSource:function(e){this.model.set("source",e.currentTarget.value)},closeDropdowns:function(){this.$(".tge-display-options-data, .tge-video-style-dropdown, .tge-question-display-type").addClass("tvd-hiddendiv")}}),TGE_Editor.views.FormQuestionDisplayAudioEdit=TGE_Editor.views.FormQuestionDisplayAudio.extend({template:TVE_Dash.tpl("question/form-audio")}),TGE_Editor.views.QuestionVideoStyles=Backbone.View.extend({template:TVE_Dash.tpl("question/video-styles"),events:{"click #tge-display-video-style":"toggleStyles","click .tge-video-monitor-image":"saveStyle"},render:function(){return this.$el.html(this.template({item:this.model.get("video_style")})),this.renderElements(),this},renderElements:function(){var e=this.model.get("video_style"),t=TVE_Dash.tpl("question/_video-style");_.each(e.labels,(function(i,s){var o={id:s,item:i,selected:e.selected};this.$(".tge-video-style-dropdown").append(t({item:o}))}),this)},toggleStyles:function(e){this.closeDropdowns(),this.$(".tge-video-style-dropdown").toggleClass("tvd-hiddendiv")},saveStyle:function(e){this.selectCurrentElem(e);var i=this.model.get("video_style");i.selected=t(e.currentTarget).data("id"),t(this.el).find(".tge-selected-video-style").html(i.labels[t(e.currentTarget).data("id")]),this.model.set("style",i.selected),this.model.set("video_style",i),this.model.set("new_question",0),this.model.trigger("tge:video:renderEmbedVideo",e)},selectCurrentElem:function(e){this.$(e.currentTarget).siblings().removeClass("tge-video-style-active"),this.$(e.currentTarget).addClass("tge-video-style-active")},closeDropdowns:function(){t(".tge-video-source-dropdown, .tge-display-options-data, .tge-question-display-type").addClass("tvd-hiddendiv")}}),TGE_Editor.views.QuestionVideoSource=TGE_Editor.views.QuestionVideoStyles.extend({template:TVE_Dash.tpl("question/video-source"),events:{"click #tge-display-video-source":function(){this.model.trigger("tge:video:set:placeholderUrl"),this.toggleStyles()},"click .tge-video-source-type":"saveSource"},initialize:function(e){e.question_model instanceof Backbone.Model&&(this.question_model=e.question_model)},render:function(){var e={selected:this.model.get("source"),labels:this.model.get("source_labels")};return this.$el.html(this.template({item:e})),this.renderElements(),this},renderElements:function(){var e=this.model.get("source_labels"),t=TVE_Dash.tpl("question/_video-source"),i=this.model.get("source");_.each(e,(function(e,s){var o={id:s,item:e,selected:i};this.$(".tge-video-source-dropdown").append(t({item:o}))}),this)},toggleStyles:function(e){this.closeDropdowns(),this.$(".tge-video-source-dropdown").toggleClass("tvd-hiddendiv")},saveSource:function(e){this.toggleActiveElem(e);var i=t(e.currentTarget).data("id"),s=this.model.get("source_labels"),o=this.model instanceof TGE_Editor.models.Audio?"audio_source":"source";this.optionsByVideoSource(i),t(this.el).find(".tge-selected-video-source").html(s[i]),this.model.set("url",""),this.model.set(o,i),this.model.trigger("tge:video:resetUrl",e),this.model.trigger("tge:video:renderEmbedVideo",e),this.handleSourceColor(),this.setDisplayOptions(),this.toggleMediaSelect(i),this.checkDisabledThumb()},checkDisabledThumb:function(){var e=this.model.get("display_settings")instanceof Backbone.Model?this.model.get("display_settings"):this.model,t=e.getOptions(),i=void 0!==t.autoplay?parseInt(t.autoplay.value):"";this.question_model.trigger(1===i?"tge:video:disableVideoThumb":"tge:video:enableVideoThumb"),1===i&&(e.set("thumb",""),this.question_model.set("image",""),this.question_model.trigger("tge:video:removeVideoThumb"))},optionsByVideoSource:function(e){var t=this.model.getMediaOptionsBySource(e);this.model.set("options",t),this.model.trigger("tge:video:renderOptions")},toggleMediaSelect:function(e){"custom"===e?t(".tge-select-media-video").removeClass("tvd-hiddendiv"):t(".tge-select-media-video").addClass("tvd-hiddendiv")},handleSourceColor:function(){"youtube"===this.model.get("source")||"custom"===this.model.get("source")?t(".tqb-video-color-container").hide():t(".tqb-video-color-container").show()},closeDropdowns:function(){t(".tge-video-style-dropdown, .tge-display-options-data, .tge-question-display-type").addClass("tvd-hiddendiv")},setDisplayOptions:function(){var t=this.model.get("source"),i=this.model.get("new_question"),s="object"===e(TGE_Editor.default_video_options)?TGE_Editor.default_video_options:JSON.parse(TGE_Editor.default_video_options);s&&t in s&&1===i&&(this.model.set("options",s[t]),this.model.trigger("tge:video:renderOptions"))},toggleActiveElem:function(e){this.$(".tge-video-source-type").removeClass("tge-video-source-type-active"),this.$(e.currentTarget).addClass("tge-video-source-type-active")}}),TGE_Editor.views.QuestionAudioSource=TGE_Editor.views.QuestionVideoSource.extend({render:function(){var e={selected:this.model.get("audio_source"),labels:this.model.get("source_audio_labels")};return this.$el.html(this.template({item:e})),this.renderElements(),this},renderElements:function(){var e=this.model.get("source_audio_labels"),t=TVE_Dash.tpl("question/_video-source"),i=this.model.get("audio_source");_.each(e,(function(e,s){var o={id:s,item:e,selected:i};this.$(".tge-video-source-dropdown").append(t({item:o}))}),this)},saveSource:function(e){this.toggleActiveElem(e);var i=e.currentTarget.dataset.id,s=this.model.get("source_audio_labels"),o=this.model instanceof TGE_Editor.models.Audio?"audio_source":"source";this.model.set(o,i),this.model.set("url",""),this.optionsByVideoSource(i),t(this.el).find(".tge-selected-video-source").html(s[i]),this.model.trigger("tge:video:resetUrl",e),this.model.trigger("tge:video:renderEmbedVideo",e),this.setDisplayOptions(),this.toggleMediaSelect(i)},setDisplayOptions:function(){var t=this.model.get("audio_source"),i=this.model.get("new_question"),s="object"===e(TGE_Editor.default_audio_options)?TGE_Editor.default_audio_options:JSON.parse(TGE_Editor.default_audio_options);s&&t in s&&1===i&&(this.model.set("options",s[t]),this.model.trigger("tge:video:renderOptions"))},optionsByVideoSource:function(e){var t=this.model.getMediaOptionsBySource(e);this.model.set("options",t),this.model.trigger("tge:video:renderOptions")}}),TGE_Editor.views.FormVideoDisplaySettings=TGE_Editor.views.FormQuestionEdit.extend({template:TVE_Dash.tpl("question/video-display-settings"),events:{"change #tge-display-url-source":function(e){this.closeDropdowns(),this.model.set("source",e.currentTarget.value)},"click #tge-display-video-options":function(){this.closeDropdowns(),this.toggleOptions()},"click .tge-display-checkbox":"toggleChecked","click .tge-select-media-video":"selectWpMedia"},initialize:function(e){var i=this;e.question_model instanceof Backbone.Model&&(this.question_model=e.question_model),this.listenTo(this.model,"change:source",this.renderOptions),this.model.on("tge:video:renderEmbedVideo",(function(e){i.renderEmbededVideo(t("#tge-qf-video-loader"))})),this.model.on("tge:video:resetUrl",(function(){i.$("#tge-display-settings-url").removeClass("tvd-invalid"),i.resetUrl()})),this.model.on("tge:video:renderOptions",(function(e){i.renderOptions()})),this.model.on("tge:video:invalid:url",(function(e){i.$("#tge-display-settings-url").addClass("tvd-invalid"),TVE_Dash.err(TVE_Dash.sprintf(i.model instanceof TGE_Editor.models.Audio?TGE_Editor.t.add_valid_audio_url:TGE_Editor.t.add_valid_video_url,[TVE_Dash.upperFirst(i.model.get(i.model instanceof TGE_Editor.models.Audio?"audio_source":"source"))]),3e3),i.model.set("url",""),i.renderEmbededVideo(),i.renderOptions(),i.$("input#tge-display-settings-url").first().focus()})),this.model.on("tge:video:valid:url",(function(e){i.$("#tge-display-settings-url").removeClass("tvd-invalid"),i.$(".tge-vopts-selected-elem").removeClass("tge-options-disabled")})),this.model.on("tge:video:valid:url:focus",(function(e){i.$("input#tge-display-settings-url").first().focus()})),this.model.on("tge:video:set:placeholderUrl",(function(){i.setUrlPlaceholder()}))},allowedMimeTypes:{asf:"video/x-ms-asf",asx:"video/x-ms-asf",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wm:"video/x-ms-wm",avi:"video/avi",divx:"video/divx",flv:"video/x-flv",mov:"video/quicktime",qt:"video/quicktime",mpeg:"video/mpeg",mpg:"video/mpeg",mpe:"video/mpeg",mp4:"video/mp4",m4v:"video/mp4",ogv:"video/ogg",webm:"video/webm",mkv:"video/x-matroska"},render:function(){return this.$("#tge-display-url-source").removeClass("tge-invalid"),this.$el.html(this.template({item:this.model})),this.initColorPicker(),TVE_Dash.data_binder(this),TVE_Dash.materialize(this.$el),this.renderSource(),this.model instanceof TGE_Editor.models.Audio||this.renderStyles(),this.renderOptions(),this.handleSourceColor(),this},setUrlPlaceholder:function(){var e=this.model.getUrlPlaceholder();this.$(".tge-media-url-name").text(e)},selectWpMedia:function(){this.handleMedia()},handleMedia:function(){var e=this,i=wp.media({title:TGE_Editor.t.media.video_title,multiple:!1,frame:"select",library:{type:["video"]}});i.on("select",(function(){var s=i.state().get("selection").first().toJSON(),o=s.subtype;if("string"==typeof e.allowedMimeTypes[o])return e.question_model instanceof Backbone.Model&&e.model.set("thumb",e.question_model.get("image")),e.$(".tge-select-media-video-err").empty(),e.model.set("url",s.url),e.renderEmbededVideo(t("#tge-qf-video-loader")),e.model.trigger("tge:video:valid:url",e),void e.model.trigger("tge:video:valid:url:focus",e);e.$(".tge-select-media-video-err").html(TGE_Editor.t.media.video_error)})),i.open()},renderStyles:function(){new TGE_Editor.views.QuestionVideoStyles({model:this.model,el:this.$el.find(".tge-display-style-container")}).render()},resetUrl:function(){this.$("#tge-display-settings-url").val("")},renderSource:function(){new TGE_Editor.views.QuestionVideoSource({model:this.model,el:this.$el.find(".tge-display-url-source"),question_model:this.question_model}).render()},renderOptions:function(){var e=TVE_Dash.tpl("question/_checkbox"),t=0!==Object.keys(this.model.get("options")).length?this.model.get("options"):this.model.getMediaOptionsBySource(this.model.get("source")),i=this.question_model.get("image");this.optionsVisibility(),this.model.set("options",t),this.$(".tge-display-options-data").empty(),_.each(t,(function(t){if(!1!==this.model.hasOption(t.id)){var s="autoplay"===t.id&&TGE_Editor.t.media.autoplay_tooltip,o=!1;"autoplay"===t.id&&i instanceof Backbone.Model&&(o=!0),this.$(".tge-display-options-data").append(e({item:t,tooltip:s,disabled:o}))}}),this)},optionsVisibility:function(){""===this.model.get("url")?this.$(".tge-vopts-selected-elem").addClass("tge-options-disabled"):this.$(".tge-vopts-selected-elem").removeClass("tge-options-disabled")},handleSourceColor:function(){"youtube"===this.model.get("source")||"custom"===this.model.get("source")?this.$(".tqb-video-color-container").hide():this.$(".tqb-video-color-container").show()},toggleOptions:function(){this.$(".tge-vopts-selected-elem").hasClass("tge-options-disabled")||this.$(".tge-display-options-data").toggleClass("tvd-hiddendiv")},initColorPicker:function(){var e=this;this.$color_picker=this.$(".tqb-video-color").spectrum({containerClassName:"tqb-video-color-holder tqb-color-picker",showInitial:!0,showInput:!0,allowEmpty:!1,showButtons:!0,cancelText:TGE_Editor.t.media.cancel,preferredFormat:"hex",change:function(t){e.model.set("color",null!==t?t.toHexString():""),e.$("#tqb-video-color-overlay-code").val(null!==t?t.toHexString():"#000000"),e.model.buildEmbedCode(),e.model.trigger("tge:video:renderEmbedVideo")},move:function(t){e.$("#tqb-video-color-overlay-code").val(null!==t?t.toHexString():"#000000")},beforeShow:function(t){e.closeAllDropdowns()}})},toggleChecked:function(e){var i=t(e.currentTarget).is(":checked"),s=t(e.currentTarget).data("id"),o=this.model.get("options");"autoplay"===s&&this.model.set("show_thumb",!0===i?0:1),o[s].value=!0===i?1:0,this.model.set({options:o})},closeDropdowns:function(){t(".tge-video-source-dropdown, .tge-video-style-dropdown, .tge-question-display-type").addClass("tvd-hiddendiv")},closeAllDropdowns:function(){t(".tge-video-source-dropdown, .tge-video-style-dropdown, .tge-question-display-type, .tge-display-options-data").addClass("tvd-hiddendiv")}}),TGE_Editor.views.FormAudioDisplaySettings=TGE_Editor.views.FormVideoDisplaySettings.extend({template:TVE_Dash.tpl("question/audio-display-settings"),initialize:function(){TGE_Editor.views.FormVideoDisplaySettings.prototype.initialize.apply(this,arguments)},renderSource:function(){new TGE_Editor.views.QuestionAudioSource({model:this.model,el:this.$el.find(".tge-display-url-source")}).render()},renderStyles:function(){},initColorPicker:function(){},toggleChecked:function(e){var i=t(e.currentTarget).is(":checked"),s=t(e.currentTarget).data("id"),o=this.model.get("options");o[s].value=!0===i?1:0,this.model.set({options:o})},renderEmbededVideo:function(e){e=e||this.$el.find("#tge-qf-video-loader");var i=this.model.get("audio_source");if(this.model.set("url",t.trim(this.model.get("url"))),""!==this.model.get("url")){switch(i){case"custom":default:s=new TGE_Editor.views.CustomEmbededAudio({model:this.model,el:e});break;case"spotify":s=new TGE_Editor.views.SpotifyEmbededAudio({model:this.model,el:e});break;case"soundcloud":s=new TGE_Editor.views.SoundcloudEmbededAudio({model:this.model,el:e})}s.render()}else{var s;(s=new TGE_Editor.views.ErrEmbededAudio({model:this.model,el:e})).render()}},handleMedia:function(){var e=this,i=wp.media({title:TGE_Editor.t.media.video_title,multiple:!1,frame:"select",library:{type:["audio"]}});i.on("select",(function(){var s=i.state().get("selection").first().toJSON(),o=s.subtype;if("string"==typeof e.model.allowedMimeTypes[o])return e.$(".tge-select-media-video-err").empty(),e.model.set("url",s.url),e.renderEmbededVideo(t("#tge-qf-video-loader")),e.model.trigger("tge:video:valid:url",e),void e.model.trigger("tge:video:valid:url:focus",e);e.$(".tge-select-media-video-err").html(TGE_Editor.t.media.video_error)})),i.open()},renderOptions:function(){var e=TVE_Dash.tpl("question/_checkbox"),t=0!==Object.keys(this.model.get("options")).length?this.model.get("options"):this.model.getMediaOptionsBySource(this.model.get("audio_source"));this.optionsVisibility(),this.toggleSpotifyTooltip(),this.model.set("options",t),this.$(".tge-display-options-data").empty(),_.each(t,(function(t){!1!==this.model.hasOption(t.id)&&this.$(".tge-display-options-data").append(e({item:t,tooltip:!1,disabled:!1}))}),this)},toggleSpotifyTooltip:function(){this.$("#tge-display-video-options").removeClass("tvd-tooltipped"),this.model.sourceIsSpotify()&&this.$("#tge-display-video-options").addClass("tvd-tooltipped").attr("data-tooltip",TGE_Editor.t.media.spotify_options_tooltip).attr("data-position","top")},optionsVisibility:function(){""===this.model.get("url")||"spotify"===this.model.get("audio_source")?this.$(".tge-vopts-selected-elem").addClass("tge-options-disabled"):this.$(".tge-vopts-selected-elem").removeClass("tge-options-disabled")}}),TGE_Editor.views.GeneralQuestionEdit=TGE_Editor.views.GeneralQuestion.extend({renderQuestionForm:function(){var e=this.model.get("display_settings").get("display_type");switch(parseInt(e)){case 0:default:this.form_view=new TGE_Editor.views.FormQuestionDisplayTextEdit({model:this.model,el:this.$el.find(".tge-q-form-wrapper")});break;case 1:this.form_view=new TGE_Editor.views.FormQuestionDisplayVideoEdit({model:this.model,el:this.$el.find(".tge-q-form-wrapper")});break;case 2:this.form_view=new TGE_Editor.views.FormQuestionDisplayAudioEdit({model:this.model,el:this.$el.find(".tge-q-form-wrapper")})}this.form_view.render()}}),TGE_Editor.views.FormAnswer=Backbone.View.extend({className:"tvd-white tge-answer "+("personality"===TGE_Editor.quiz.quiz_type?"tge-personality-answer":""),events:{"click .tvd-icon-trash-o":function(){this.collection.remove(this.model),this.remove()}},initialize:function(e){this.question=e.question,this.listenTo(TGE_Editor.globals.settings.get_model("display_weight"),"change:value",this.toggle_points),this.listenTo(TGE_Editor.globals.settings.get_model("display_tags"),"change:value",this.toggle_tags),this.listenTo(this.model,"change:is_right",(function(e){e.attributes.is_right=!0===e.get("is_right")?1:0,e.attributes.points=1===e.get("is_right")?1:0})),this.listenTo(this.model,"change:points",(function(){this.$('input[data-bind="points"]').removeClass("tvd-invalid tvd-tooltipped")}))},toggle_tags:function(e){e.get("value")?this.tags_view.$el.show():this.tags_view.$el.hide()},toggle_points:function(e,t){this._get_points_column().css({display:t?"block":"none"})},toggle_feedback:function(){this.model.get("feedback")&&0===this.model.get("feedback").length&&this.$("#tge-question-feedback").val(""),!0===this.question.display_feedback()?this.feedback_view.$el.show():this.feedback_view.$el.hide()},render:function(){return this.$el.html(this.template({item:this.model})),"right_wrong"===TGE_Editor.quiz.quiz_type?this._render_right_wrong_input():"survey"!==TGE_Editor.quiz.quiz_type&&this._render_points_input(),"personality"===TGE_Editor.quiz.quiz_type&&this.render_results_options(),this.render_tags(),this.render_feedback_form(),TVE_Dash.data_binder(this),this},render_tags:function(){this.tags_view=new TGE_Editor.views.TagsView({model:this.model,el:this.$(".tge-tags-column")}),this.tags_view.render(),this.toggle_tags(TGE_Editor.globals.settings.get_model("display_tags"))},render_feedback_form:function(){this.feedback_view=new TGE_Editor.views.FeedbackView({model:this.model,el:this.$(".tge-feedback-column")}),this.feedback_view.render(),this.toggle_feedback()},render_results_options:function(){this.results_view=new TGE_Editor.views.QuizResults({collection:new Backbone.Collection(TGE_Editor.quiz.results),model:this.model}),this._get_points_column().before(this.results_view.render().$el),TGE_Editor.globals.settings.get_model("display_weight").is_checked()?this._get_points_column().css({display:"block"}):this._get_points_column().css({display:"none"})},_render_points_input:function(){var e=TVE_Dash.tpl("answer/form/points");this._get_points_column().html(e({item:this.model}))},_render_right_wrong_input:function(){var e=TVE_Dash.tpl("answer/form/right_wrong");this._get_points_column().html(e({item:this.model}))},_get_points_column:function(){return this.$points_column||(this.$points_column=this.$(".tge-points-column")),this.$points_column},_set_wrong:function(e){e.each((function(e){e.attributes.is_right=0,e.attributes.points=0}))}}),TGE_Editor.views.FormAnswerImage=TGE_Editor.views.FormAnswer.extend({template:TVE_Dash.tpl("answer/form/image"),render:function(){return TGE_Editor.views.FormAnswer.prototype.render.apply(this,arguments),this.renderImagePicker(this.$(".tge-image-loader")),this},renderImagePicker:function(e){new TGE_Editor.views.ImagePickereAnswer({model:this.model,el:e}).render()}}),TGE_Editor.views.FormAnswerButton=TGE_Editor.views.FormAnswer.extend({template:TVE_Dash.tpl("answer/form/button"),events:_.extend({},TGE_Editor.views.FormAnswer.prototype.events,{})}),TGE_Editor.views.ImagePicker=Backbone.View.extend({template:TVE_Dash.tpl("image/form"),events:{"click .tge-add-image, .tge-image-placeholder":"open_media","click .tge-remove-image":"remove","click .tge-change-image":"open_media"},initialize:function(){var e=this;this.model.on("tge:video:disableVideoThumb",(function(t){e.disableVideoThumb()})),this.model.on("tge:video:enableVideoThumb",(function(t){e.enableVideoThumb()})),this.model.on("tge:video:removeVideoThumb",(function(t){e.remove()}))},render:function(){var e=this.model.get("display_settings"),t=e instanceof Backbone.Model?e.get("type"):"";return this.$el.html(this.template({item:this.model,display_type:t})),this.$form=this.$(".tge-image-form"),this.$buttonAdd=this.$(".tge-add-image"),this.$buttonRemove=this.$(".tge-remove-image"),this.$buttonChange=this.$(".tge-change-image"),this.$placeholder=this.$(".tge-image-placeholder"),this.load_image(),TVE_Dash.data_binder(this),this},open_media:function(){var e=this,t=wp.media({title:"tge-qf-image-loader"===this.el.id?TGE_Editor.t.media.question_title:TGE_Editor.t.media.answer_title});t.on("select",(function(){var i=t.state().get("selection").first().toJSON();i.sizes.thumbnail||(i.sizes.thumbnail=i.sizes.full),e.$placeholder.removeClass("tvd-invalid tvd-tooltipped"),e.model.set("image",new TGE_Editor.models.Image(i));var s=e.model.get("display_settings");void 0!==s&&s instanceof TGE_Editor.models.Video&&(s.set("thumb",new TGE_Editor.models.Image(i)),s.set("show_thumb",1),e.model.trigger("tge:video:renderEmbed"),e.model.trigger("tge:video:disableAutoplay")),e.load_image()})),t.open()},remove:function(){this.$placeholder.css({"background-image":"","background-size":""});var e=this.model.get("display_settings")instanceof TGE_Editor.models.Video&&this.model.get("display_settings");this.$form.removeClass("tge-has-image"),this.model.set("image",""),e&&(e.set("thumb",""),e.set("show_thumb",0),this.model.trigger("tge:video:renderEmbed"),this.model.trigger("tge:video:enableAutoplay")),this.$buttonAdd.css({display:"block"})},load_image:function(){this.model.get("image")&&this.model.get("image").get_thumb()&&(this.$placeholder.css({"background-image":"url("+this.model.get("image").get_thumb()+")","background-size":"cover"}),this.$form.addClass("tge-has-image"),this.$buttonAdd.css({display:"none"}))},disableVideoThumb:function(){this.$el.find(".tge-image-form ").addClass("tge-disabled-thumb")},enableVideoThumb:function(){this.$el.find(".tge-image-form ").removeClass("tge-disabled-thumb")}}),TGE_Editor.views.VideoImageOverlay=Backbone.View.extend({template:TVE_Dash.tpl("video/image-overlay"),events:{"click .tqb_video_overlay_image":"hideOverlayImage"},render:function(){var e=this.model.get("thumb")instanceof Backbone.Model&&this.model.get("thumb"),t=e?e.get("url"):"",i=this.model.get("source");return this.$(".tqb-video-container-responsive").prepend(this.template({source:i,url:t})),this},hideOverlayImage:function(e){this.model.set("show_thumb",0),this.$(".tqb_video_overlay_image").addClass("tvd-hiddendiv"),this.model.trigger("tge:video:renderEmbedVideo")}}),TGE_Editor.views.MediaEmbeded=Backbone.View.extend({render:function(){return TVE_Dash.showLoader(),this.$el.html(this.template({item:this.model})),TVE_Dash.hideLoader(),this},renderVideoImageOverlay:function(){var e=this.model instanceof TGE_Editor.models.Video?this.model:this.model.get("display_settings");this.model.get("image")instanceof Backbone.Model&&e.set("thumb",this.model.get("image"));var t=this.model.get("image")instanceof Backbone.Model?this.model.get("image"):e.get("thumb"),i=e.get("show_thumb");if(void 0===i||0===parseInt(i)||0==t instanceof Backbone.Model)return!1;new TGE_Editor.views.VideoImageOverlay({model:e,el:this.$el}).render()}}),TGE_Editor.views.CustomEmbededVideo=TGE_Editor.views.MediaEmbeded.extend({template:TVE_Dash.tpl("video/custom"),allowedMimeTypes:{asf:"video/x-ms-asf",asx:"video/x-ms-asf",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wm:"video/x-ms-wm",avi:"video/avi",divx:"video/divx",flv:"video/x-flv",mov:"video/quicktime",qt:"video/quicktime",mpeg:"video/mpeg",mpg:"video/mpeg",mpe:"video/mpeg",mp4:"video/mp4",m4v:"video/mp4",ogv:"video/ogg",webm:"video/webm",mkv:"video/x-matroska"},render:function(){var e=this.media_mime(),t=this.model instanceof TGE_Editor.models.Video?this.model:this.model.get("display_settings");return this.$el.html(this.template({mime:e,item:t})),this.renderVideoImageOverlay(),TVE_Dash.data_binder(this),this},media_mime:function(){var e=(this.model instanceof TGE_Editor.models.Video?this.model:this.model.get("display_settings")).get("url").split(".").pop().toLowerCase();return"string"==typeof this.allowedMimeTypes[e]?this.allowedMimeTypes[e]:""}}),TGE_Editor.views.CustomEmbededAudio=TGE_Editor.views.CustomEmbededVideo.extend({template:TVE_Dash.tpl("audio/custom"),allowedMimeTypes:{mp3:"audio/mpeg",m4a:"audio/mpeg",m4b:"audio/mpeg",ra:"audio/x-realaudio",ram:"audio/x-realaudio",wav:"audio/wav",ogg:"audio/ogg",oga:"audio/ogg",mid:"audio/midi",midi:"audio/midi",wma:"audio/x-ms-wma",wax:"audio/x-ms-wax",mka:"audio/x-matroska"},render:function(){var e=this.media_mime(),t=this.model instanceof TGE_Editor.models.Question?this.model.get("display_settings"):this.model;return this.$el.html(this.template({mime:e,item:t})),TVE_Dash.data_binder(this),this}}),TGE_Editor.views.YotubeEmbededVideo=TGE_Editor.views.MediaEmbeded.extend({template:TVE_Dash.tpl("video/youtube"),render:function(){var e=this.model instanceof TGE_Editor.models.Video?this.model:this.model.get("display_settings");return e.buildEmbedCode(),TVE_Dash.showLoader(),this.$el.html(this.template({item:e})),this.renderVideoImageOverlay(),TVE_Dash.hideLoader(),this}}),TGE_Editor.views.SpotifyEmbededAudio=TGE_Editor.views.MediaEmbeded.extend({template:TVE_Dash.tpl("audio/spotify"),render:function(){this.model.buildEmbedCode();var e="//open.spotify.com/embed"+this.model.get("video_id");return TVE_Dash.showLoader(),this.$el.html(this.template({item:this.model,src:e})),TVE_Dash.hideLoader(),this}}),TGE_Editor.views.ErrEmbededVideo=TGE_Editor.views.MediaEmbeded.extend({template:TVE_Dash.tpl("video/_err"),render:function(){return TVE_Dash.showLoader(),this.model.buildEmbedCode(),this.$el.html(this.template({item:this.model})),TVE_Dash.hideLoader(),this}}),TGE_Editor.views.ErrEmbededAudio=TGE_Editor.views.ErrEmbededVideo.extend({template:TVE_Dash.tpl("audio/_err")}),TGE_Editor.views.WistiaEmbededVideo=TGE_Editor.views.MediaEmbeded.extend({template:TVE_Dash.tpl("video/wistia"),render:function(){var e=this.model instanceof TGE_Editor.models.Video?this.model:this.model.get("display_settings");return TVE_Dash.showLoader(),e.buildEmbedCode(),this.$el.html(this.template({item:e})),this.renderVideoImageOverlay(),TVE_Dash.hideLoader(),this}}),TGE_Editor.views.VimeoEmbededVideo=TGE_Editor.views.MediaEmbeded.extend({template:TVE_Dash.tpl("video/vimeo"),render:function(){var e=this.model instanceof TGE_Editor.models.Video?this.model:this.model.get("display_settings");return TVE_Dash.showLoader(),e.buildEmbedCode(),this.$el.html(this.template({item:e})),this.renderVideoImageOverlay(),TVE_Dash.hideLoader(),this}}),TGE_Editor.views.SoundCloudEmbededAudio=TGE_Editor.views.MediaEmbeded.extend({template:TVE_Dash.tpl("audio/soundcloud")}),TGE_Editor.views.ImagePickereAnswer=TGE_Editor.views.ImagePicker.extend({template:TVE_Dash.tpl("image/answer")}),TGE_Editor.views.QuizResults=Backbone.View.extend({className:"tge-category-field",template:TVE_Dash.tpl("quiz/responses"),render:function(){return this.$el.html(this.template({item:this.model})),this.$select=this.$("select"),this.collection.each((function(e,i,s){var o=t("<option/>");o.val(e.get("id")),o.text(e.get("text")),this.model.get("result_id")===e.get("id")&&o.attr("selected","selected"),this.$select.append(o)}),this),0==this.model.get("result_id")&&this.$select.find('option[value="0"]').attr("selected","selected"),this}}),TGE_Editor.views.QuestionView=Backbone.View.extend({tagName:"li",className:"tvd-collection-item tge-q-item",template:TVE_Dash.tpl("question/item"),events:{click:"onClick"},render:function(){return this.$el.html(this.template({item:this.model})),this.$el.attr("id","tge-question-"+this.model.get("id")),this.$el.css({"border-left-width":2*this.model.get("level")+"px"}),this.model.attributes.rendered=!0,this},highlight_callView:function(e){var t=".question-body",i={highlighter:{name:"addClass",options:{className:"tge-opacity"}}};e.highlight(t,i),setTimeout((function(){e.unhighlight(t,i)}),150)},onClick:function(){var e=tge_app_view.paper.findViewByModel(this.model.get("id")),t=tge_app_view.graph.getCell(this.model.get("id")),i=tge_app_view.$el.scrollLeft(),s=tge_app_view.$el.scrollTop(),o=this.model.get("position").y-(tge_app_view.$el.height()-t.get("size").height)/2,n=this.model.get("position").x-(tge_app_view.$el.width()-t.get("size").width)/2,r=TGE_Editor.const.paper.size.width/TGE_Editor.const.navigator.size.width,d=TGE_Editor.const.paper.size.height/TGE_Editor.const.navigator.size.height;if(!0===tge_app_view.scrolling||s===o&&i===n)this.highlight_callView(e);else{var a=this,l=o/d,h=n/r;tge_app_view.$nav_handler.animate({top:l<0?0:l,left:h<0?0:h}),tge_app_view.scrolling=!0,tge_app_view.$el.animate({scrollTop:o+"px",scrollLeft:n+"px"},600,"swing",(function(){a.highlight_callView(e),tge_app_view.scrolling=!1}))}}}),TGE_Editor.views.Switcher=Backbone.View.extend({template:TVE_Dash.tpl("question/switcher"),events:{"change input":function(){this.model.set("value",!this.model.attributes.value)}},render:function(){return this.$el.html(this.template({item:this.model})),this}}),TGE_Editor.views.Accordion=TGE_Editor.views.Switcher.extend({template:TVE_Dash.tpl("question/accordion"),events:{"click .tge-accordion":function(){this.model.set("value",!this.model.get("value"))}}}),TGE_Editor.views.TagsSwitcher=TGE_Editor.views.Switcher.extend({template:TVE_Dash.tpl("question/tags-switcher"),initialize:function(){this.listenTo(this.model,"change:value",(function(){this.toggle_texts(!0)}))},render:function(){return TGE_Editor.views.Switcher.prototype.render.apply(this,arguments),this.toggle_texts(),this},toggle_texts:function(e){var i=this.model.get("value"),s=this.$(".tvd-switch").first(),o=i?TGE_Editor.t.tags_switcher_off_tooltip:TGE_Editor.t.tags_switcher_on_tooltip,n=i?TGE_Editor.t.tags_switcher_on_toast:TGE_Editor.t.tags_switcher_off_toast,r=i?"green accent-5":"yellow accent-5";s.attr("data-tooltip",o),e&&(t(".tvd-toast").remove(),Materialize.toast(n,3e4,"tvd-toast tvd-pointer tge-tags-toast "+r,(function(){}),"bottom"),t(".tvd-toast").click((function(e){t(this).remove(),e.stopPropagation()})))}}),TGE_Editor.views.TagsView=Backbone.View.extend({template:TVE_Dash.tpl("answer/tags"),render:function(){this.$el.html(this.template({item:this.model}));var e=this.$("input");return this.$chips=e.materialtags({maxTags:5,trimValue:!0,confirmKeys:[9,13,44,188]}),this}}),TGE_Editor.views.FeedbackView=Backbone.View.extend({template:TVE_Dash.tpl("answer/feedback"),render:function(){return this.$el.html(this.template({item:this.model})),this}}),TGE_Editor.views.ProgressBar=Backbone.View.extend({template:TVE_Dash.tpl("quiz/progress-bar"),render:function(){return this.$el.html(this.template({model:this.model})),new TGE_Editor.views.ProgressPreview({model:this.model,el:this.$(".tqb-progress-bar-holder")}).render(),this}}),TGE_Editor.views.ProgressBarOptions=Backbone.View.extend({template:TVE_Dash.tpl("quiz/progress-bar/options"),events:{"change #tqb-progress-bar-type":function(){this.$("#tqb_progress_label").val(this.model.getDefaultLabel()),this.model.set({percent_type:this.$("#tqb-progress-bar-type").val()},{silent:!0}),this.model.set({label_text:this.model.getDefaultLabel()}),this.$(".tqb-default-percentage").html(this.model.getPercentToDisplay()+"%")},"change #tqb-progress-bar-position":function(){this.model.set({progress_position:this.$("#tqb-progress-bar-position").val()},{silent:!0})}},render:function(){return this.$el.html(this.template({model:this.model})),this.$("#tqb-progress-bar-type").val(this.model.get("percent_type")),this.$("#tqb-progress-bar-position").val(this.model.get("progress_position")),this}}),TGE_Editor.views.ProgressPreview=Backbone.View.extend({template:function(e){return TVE_Dash.tpl("quiz/progress-bar/skin/"+this.model.getTemplateId())(e)},render:function(){return this.$el.html(this.template({model:this.model,remaining:20,estimatedProgress:20})),this.$(".tqb-progress-completed").css("background-color",this.model.get("fill_color")),this.$(".tqb-progress-label").css("color",this.model.get("label_color")),this.$(".tqb-progress-label, .tqb-next-item, .tqb-remaining-progress").css("font-size",parseInt(this.model.get("font_size"))),this.$(".tqb-next-item").css("background-color",this.model.get("next_step_color")),this.$(".tqb-remaining-progress").css("background-color",this.model.get("background_color")),this}})}))}(jQuery)})(),joint.shapes.tge={},joint.shapes.tge.Question=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><rect class="question-body"/></g><image class="multiple-answers" width="10" height="10"/><image class="display-type" width="17" height="10"/><text class="question-text"/><image class="question-image"/></g>',portMarkup:'<circle class="port-body" r="7" fill="gray" />',toolsMarkup:'<g class="tge-question-tools"><image class="tge-remove-tool" width="13" height="14"/><image class="tge-edit-tool" width="14" height="15"/><image class="tge-duplicate-tool" width="14" height="14"/></g>',defaults:joint.util.deepSupplement({position:{x:0,y:0},type:"tge.Question",attrs:{".":{magnet:!1},".question-body":{rx:"4px",ry:"4px",fill:"#595c60",filter:{name:"dropShadow",args:{dx:2,dy:2,blur:3}}},".question-image":{x:0,y:0,width:TGE_Editor.const.question.image.size.width,preserveAspectRatio:"xMidYMid slice"},".question-text":{ref:".question-body",fill:"white","ref-x":.5,"ref-y":15,"x-alignment":"middle","font-size":"13px","font-family":"Arial"},".tge-question-tools>image":{preserveAspectRatio:"xMidYMid meet"},".multiple-answers":{ref:".question-body","ref-x":21,"ref-y":16},".display-type":{ref:".question-body","ref-x":35,"ref-y":16},".tge-remove-tool":{ref:".question-body","ref-x":7,"ref-y":5,filter:{name:"dropShadow",args:{dx:0,dy:0,blur:2}}},".tge-duplicate-tool":{ref:".question-body","ref-dx":-42,"ref-y":5,filter:{name:"dropShadow",args:{dx:0,dy:0,blur:2}}},".tge-edit-tool":{ref:".question-body","ref-dx":-20,"ref-y":5,filter:{name:"dropShadow",args:{dx:0,dy:0,blur:2}}}},ports:{groups:{in:{position:{name:"top"}},out:{position:{name:"bottom"}}},items:[]}},joint.dia.Element.prototype.defaults),initialize:function(){this.on("change:allowed_answers",(function(){this.loadAnswers(),this.handleAllowedIcon(),this.handleDisplayIcons()})),this.on("change:display_settings",(function(){this.handleAllowedIcon(),this.handleDisplayIcons()})),this.on("change:text",(function(e,t,i){this.attr(".question-text/text",this.get_text())})),this.on("change:image",(function(){this.attr(".question-image/xlink:href",this.get_image()),this.auto_resize(),this.loadAnswers(),this.attr(".question-text/text",this.get_text()),this.handleAllowedIcon(),this.handleDisplayIcons()})),this.on("change:q_type",(function(){this.trigger("change:answers")})),this.on("change:answers",(function(){this.loadAnswers(),this.auto_resize(),this.attr(".question-image/height",this.get("size").height),this.attr(".question-text/text",this.get_text())}),this),this.auto_resize(),this.initializePorts(),this.attr(".question-text/text",this.get_text()),this.get("image")&&this.attr(".question-image/xlink:href",this.get_image()),this.attr(".tge-remove-tool/xlink:href",TGE_Editor.icons.delete),this.attr(".tge-edit-tool/xlink:href",TGE_Editor.icons.edit),this.attr(".tge-duplicate-tool/xlink:href",TGE_Editor.icons.duplicate),joint.dia.Element.prototype.initialize.apply(this,arguments),this.handleAllowedIcon(),this.handleDisplayIcons()},handleAllowedIcon:function(){this.attr(".multiple-answers/xlink:href",""),this.attr(".multiple-answers/ref-x",21),this.get("allowed_answers")>1&&(this.attr(".multiple-answers/xlink:href",TGE_Editor.icons.multiple),this.get("image")&&this.attr(".multiple-answers/ref-x",121))},handleDisplayIcons:function(){var e,t=35;switch(this.get("display_settings")&&this.get("display_settings").type?this.get("display_settings").type:"text"){case"audio":e=TGE_Editor.icons.audio;break;case"video":e=TGE_Editor.icons.video;break;case"text":e=TGE_Editor.icons.text}this.get("allowed_answers")<=1&&(t=21),this.get("image")&&(t=135,this.get("allowed_answers")<=1&&(t=121)),this.attr(".display-type/xlink:href",e),this.attr(".display-type/ref-x",t)},loadAnswers:function(){var e=-1,t=0,i=_.map(this.getEmbeddedCells(),"id"),s=_.map(this.get("answers"),"id"),o=_.difference(i,s);_.each(o,(function(e,t,i){window.tge_app_view.graph.getCell(e).remove()}),this);var n=_.sortBy(this.get("answers"),(function(e){return parseInt(e.order)}));_.each(n,(function(i,s,o){s&&s%TGE_Editor.const.answers_per_row==0&&(e=-1,t++),e++,this.loadAnswer(i,e,t)}),this)},loadAnswer:function(e,t,i){var s=this.graph.getCell(e.id),o=this.toJSON();if(s)s.set(_.extend({},e,{col:t,row:i,jQuestion:{position:o.position,image:o.image,text_size:o.text_size,q_type:o.q_type,allowed_answers:o.settings.allowed_answers}})),s.trigger(2===parseInt(this.get("q_type"))?"change:image":"change:text");else{var n=new joint.shapes.tge.Answer(_.extend(e,{col:t,row:i,jQuestion:{position:o.position,image:o.image,text_size:o.text_size,q_type:o.q_type,allowed_answers:o.settings.allowed_answers}}));this.embed(n),this.graph.addCell(n)}},get_image:function(){return null===this.get("image")?"":this.get("image").sizes&&this.get("image").sizes.thumbnail?"string"==typeof this.get("image")?this.get("image"):this.get("image").sizes.thumbnail.url:""},get_text:function(){var e=this.get("size").width;if(e-=2*TGE_Editor.const.answer.margin.left,0===this.get("answers").length&&3!==parseInt(this.get("q_type")))return this.get("text");var t=_.unescape(this.get("text")),i=this.get("text_size");i=joint.util.measureText(t,{fontSize:this.attr(".question-text/font-size")}),this.set("text_size",i),this.get("q_type")&&this.get("image")?(this.attr(".question-text/x-alignment",null),this.attr(".question-text/ref-x",null),this.attr(".question-text/x",160),e-=145):(this.attr(".question-text/x-alignment","middle"),this.attr(".question-text/ref-x",.5),this.attr(".question-text/x",null),i.width>e-80&&(this.attr(".question-text/x-alignment",null),this.attr(".question-text/ref-x",60),e-=45));var s,o=i.width<e;for(o||(e-=10,s="...");!o;)t=t.slice(0,t.length-1),o=(i=joint.util.measureText(t,{fontSize:this.attr(".question-text/font-size")})).width<e;return s?t+s:t},initializePorts:function(){var e={".port-body":{magnet:!0,stroke:"white","stroke-width":1,qid:this.get("id")}};this.get("ports").items.push({id:"q-in-port-"+this.get("id"),group:"in",attrs:e}),this.get("ports").items.push({id:"q-out-port-"+this.get("id"),group:"out",attrs:e})},auto_resize:function(){var e=this._calculate_width(),t=this._calculate_height();t+=TGE_Editor.const.question.size.height,this.attr(".question-body/width",e),this.attr(".question-body/height",t),this.attr(".question-image/height",t),this.resize(e,t)},_calculate_width:function(){var e=this.get("answers").length,t=TGE_Editor.const.answers_per_row,i=TGE_Editor.const.answer.margin.left,s=2===parseInt(this.get("q_type"))?TGE_Editor.const.answer.image.size.width:TGE_Editor.const.answer.size.width,o=e*s+i*(e+1);return e>=t&&(o=t*s+i*(t+1)),this.get("image")&&(o+=TGE_Editor.const.question.image.size.width),o||1},_calculate_height:function(){var e=this.get("answers").length,t=Math.ceil(e/TGE_Editor.const.answers_per_row);return t*(2===parseInt(this.get("q_type"))?TGE_Editor.const.answer.image.size.height:TGE_Editor.const.answer.size.height)+t*TGE_Editor.const.answer.margin.bottom+25||1},save:function(){new TGE_Editor.models.Question(this.toJSON()).save()}}),joint.shapes.tge.QuestionView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments)},render:function(){joint.dia.ElementView.prototype.render.apply(this,arguments),this.renderTools(),this.update()},renderTools:function(){var e=this.model.toolsMarkup||this.model.get("toolsMarkup");if(e){var t=V(e);V(this.el).append(t)}},pointerclick:function(e){if("tge-remove-tool"===e.target.getAttribute("class")&&TVE_Dash.modal(TGE_Editor.modals.DeleteQuestion,{model:this.model}),"tge-duplicate-tool"===e.target.getAttribute("class"))return this.duplicate_question();if("tge-edit-tool"===e.target.getAttribute("class")){var t=window.tge_app_view.questions.findWhere({id:this.model.id});t.get("answers").sort(),TVE_Dash.modal(TGE_Editor.modals.EditQuestion,{model:t,dismissible:!1,"max-width":"40%"})}joint.dia.ElementView.prototype.pointerclick.apply(this,arguments)},duplicate_question:function(){var e=window.tge_app_view.questions.findWhere({id:this.model.id});if(e instanceof Backbone.Model){var t=new TGE_Editor.models.Question(e.toDeepJSON());t.clear_for_duplicate(),window.tge_app_view.saving(),TVE_Dash.showLoader(),t.save(null,{success:function(e,i,s){window.tge_app_view.questions.add(t),window.opener&&window.opener.postMessage({event:"tqb_question_counter_update",number:window.tge_app_view.questions.length},"*")},error:function(e,t){TVE_Dash.err(t.responseJSON.data.message)},complete:function(){TVE_Dash.hideLoader(),window.tge_app_view.change_automatically_saved()}})}}}),joint.shapes.tge.Answer=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><image/><text class="answer-text"/><g class="text-icon" fill="white"><path d="M13.085 0l-1 1H0V0h13.085zm-4 4l-1 1H0V4h9.085zM0 9V8h5v1H0zm0 4v-1h5v1H0zM12.332 9.934v.003l4.295-4.323-2.24-2.241-4.324 4.295h.003L8.671 9.044l.006.002-.31 1.869.718.717 1.869-.308.464-.467v-.004l.914-.92zm7.15-8.065c.691.691.685 1.772.016 2.44l-8.006 8.059-3.783.624a.61.61 0 0 1-.7-.7l.623-3.784L15.691.502c.67-.67 1.754-.67 2.424 0l1.367 1.367zm-.774 1.65c.236-.236.235-.609-.016-.86l-1.367-1.367a.596.596 0 0 0-.844 0l-.001.001-.002.002-1.227 1.219 2.235 2.235 1.22-1.227V3.52h.002z"/></g></g>',portMarkup:'<circle class="port-body" r="6" fill="gray" />',defaults:joint.util.deepSupplement({type:"tge.Answer",attrs:{".":{magnet:!1},".body":{width:TGE_Editor.const.answer.size.width,height:TGE_Editor.const.answer.size.height,rx:"3px",ry:"3px",fill:"#797e84"},image:{width:TGE_Editor.const.answer.image.size.width,height:TGE_Editor.const.answer.image.size.height,preserveAspectRatio:"xMidYMid slice"},text:{ref:"rect","ref-x":.5,"ref-y":.5,"y-alignment":"middle","x-alignment":"middle",fill:"white","font-size":"11px",filter:{name:"dropShadow",args:{blur:1,opacity:1,color:"black"}}},".text-icon":{display:"none",ref:"rect","ref-x":.5,"ref-y":.5,"x-alignment":"middle","y-alignment":"middle",filter:{name:"dropShadow",args:{blur:1,opacity:1,color:"black"}}}},ports:{groups:{out:{position:{name:"bottom"}}},items:[]}},joint.dia.Element.prototype.defaults),initialize:function(){this.on("change:text",(function(){this.attr(".answer-text/text",this.get_text()),this.attr("image/xlink:href",null),this.auto_resize(),this.auto_position(),this.toggle_port(),this.toggle_text_icon()})),this.on("change:image",(function(){this.attr("image/xlink:href",this.get_image()),this.attr(".answer-text/text",this.get_text()),this.auto_resize(),this.auto_position(),this.toggle_port(),this.toggle_text_icon()})),this.on("change:is_right",(function(){this.style_right_wrong(),this.auto_resize(),this.auto_position()})),this.get("image")&&2===parseInt(this.get("jQuestion").q_type)&&this.attr("image/xlink:href",this.get_image()),this.style_right_wrong(),this.attr(".answer-text/text",this.get_text()),this.toggle_text_icon(),this.auto_position(),this.auto_resize(),this.initializePorts(),joint.dia.Element.prototype.initialize.apply(this,arguments)},initializePorts:function(){if(3===parseInt(this.get("jQuestion").q_type)||parseInt(this.get("jQuestion").allowed_answers)>1)return this;this.get("ports").items.push(this.port_definition())},port_definition:function(){var e={".port-body":{magnet:!0,stroke:"#393d44","stroke-width":1,aid:this.get("id")}};return{id:"a-port-"+this.get("id"),group:"out",attrs:e}},auto_resize:function(){var e=2==this.get("jQuestion").q_type?TGE_Editor.const.answer.image.size.width:TGE_Editor.const.answer.size.width,t=2==this.get("jQuestion").q_type?TGE_Editor.const.answer.image.size.height:TGE_Editor.const.answer.size.height;this.attr(".body/width",e),this.attr(".body/height",t),this.get("image")&&2==this.get("jQuestion").q_type?(this.attr("image/width",TGE_Editor.const.answer.image.size.width),this.attr("image/height",TGE_Editor.const.answer.image.size.height)):(this.attr("image/width",0),this.attr("image/height",0)),this.resize(e,t)},auto_position:function(){var e=this.get("jQuestion").position.x,t=this.get("jQuestion").position.y,i=this.get("jQuestion").image,s=this.get("jQuestion").text_size,o=2==this.get("jQuestion").q_type?TGE_Editor.const.answer.image.size.width:TGE_Editor.const.answer.size.width,n=2==this.get("jQuestion").q_type?TGE_Editor.const.answer.image.size.height:TGE_Editor.const.answer.size.height,r=this.get("col"),d=this.get("row");t+=Math.round(s.height)+25,e+=TGE_Editor.const.answer.margin.left*(r?r+1:1)+r*o,t+=n*d+TGE_Editor.const.answer.margin.bottom*d,i&&(e+=TGE_Editor.const.question.image.size.width),this.set("position",{x:e,y:t})},get_image:function(){return null===this.get("image")?"":"string"==typeof this.get("image")?this.get("image"):this.get("image")instanceof Backbone.Model?this.get("image").get("sizes").thumbnail.url:this.get("image").sizes.thumbnail.url},get_text:function(){if(2===parseInt(this.get("jQuestion").q_type))return this.get("points")+"p";if(3===parseInt(this.get("jQuestion").q_type))return"";var e=this.get("points")+"p - "+_.unescape(this.get("text"));return e.length<=24?e:e.slice(0,24)+"..."},style_right_wrong:function(){var e=parseInt(this.get("jQuestion").q_type),t=1===parseInt(this.get("is_right")),i=3===parseInt(this.get("jQuestion").q_type),s=2!==e?2:4;this.attr(".body/stroke",t?"#62c343":"red"),this.attr(".body/stroke-width",t&&!1===i?s:"0")},toggle_text_icon:function(){this.attr(".text-icon",{display:3===parseInt(this.get("jQuestion").q_type)?"block":"none"})},toggle_port:function(){return 3===parseInt(this.get("jQuestion").q_type)||parseInt(this.get("jQuestion").allowed_answers)>1?this.removePort(this.port_definition().id):(!1===this.hasPort(this.port_definition().id)&&this.addPort(this.port_definition()),this)}}),joint.shapes.tge.StartFlow=joint.dia.Element.extend({markup:'<g class="rotatable" style="cursor: pointer"><g class="scalable"><rect class="body"/></g><text/><g><g class="video-icon"><circle class="bg-video-icon" r="9" fill="white" transform="translate(20,19)"></circle><path class="path1" d="M16 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zM16 29c-7.18 0-13-5.82-13-13s5.82-13 13-13 13 5.82 13 13-5.82 13-13 13zM12 9l12 7-12 7z"></path></g></g></g>',portMarkup:'<circle class="port-body" r="7" fill="gray" />',defaults:joint.util.deepSupplement({type:"tge.StartFlow",size:{width:130,height:40},ports:{groups:{out:{position:{name:"bottom"}}},items:[]},attrs:{".":{magnet:!1},".body":{width:130,height:40,fill:"white",rx:3,ry:3,stroke:"#595c60","stroke-width":.5},".path1":{fill:"#87548d",transform:"translate(9,8),scale(0.7)"},text:{ref:".body",x:40,"ref-y":.5,"y-alignment":"middle","font-family":"Arial","font-size":"16px","font-weight":"bold",text:TGE_Editor.t.quiz_start,fill:"#87548d"}}},joint.dia.Element.prototype.defaults),initialize:function(){this.initializePorts(),joint.dia.Element.prototype.initialize.apply(this,arguments)},initializePorts:function(){this.get("ports").items.push({id:"start-port",group:"out",attrs:{".port-body":{magnet:!0,stroke:"white",fill:"#87548d","stroke-width":2}}})}}),joint.shapes.tge.StartFlowView=joint.dia.ElementView.extend({pointerclick:function(e){if($(e.target).is("path")||$(e.target).is(".bg-video-icon"))TGE_Editor.wistia.start_quiz.play();else{var t={x:100+tge_app_view.$el.scrollLeft(),y:100},i=new TGE_Editor.models.Question({text:"question",position:t});TVE_Dash.modal(TGE_Editor.modals.AddQuestion,{model:i,dismissible:!1,"max-width":"40%"}),joint.dia.ElementView.prototype.pointerclick.apply(this,arguments)}}}),joint.util.measureText=function(e,t){var i=parseInt(t.fontSize,10)||10,s=V("svg").node,o=V("<text><tspan></tspan></text>").node,n=o.firstChild,r=document.createTextNode("");n.setAttribute("font-size",t.fontSize),n.appendChild(r),s.appendChild(o),document.body.appendChild(s);var d=e.split("\n"),a=0;_.each(d,(function(e){r.data=e;var t=n.getComputedTextLength();a=Math.max(a,t)}));var l=d.length*(1.2*i);return V(s).remove(),{width:a,height:l}},window.tgeLink=joint.dia.Link.extend({arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<path class="marker-arrowhead" d="M 10 0 L 0 5 L 10 10 z" />',"</g>"].join(""),toolMarkup:['<g class="link-tool">','<g class="tool-remove" event="remove">','<circle r="9" />','<path transform="scale(.6) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z" />',"<title>Remove link.</title>","</g>",'<g class="tool-options" event="link:options">','<circle r="11" transform="translate(25)"/>','<path fill="white" transform="scale(.55) translate(29, -16)" d="M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z"/>',"<title>Link options.</title>","</g>","</g>"].join("")}),TGE_Editor.views=TGE_Editor.views||{},function(e){e((function(){var t=e("html");e("html").css({height:window.innerHeight-parseInt(t.css("margin-top"))-4}),window.tge_app_view=new TGE_Editor.views.AppView,TGE_Editor.wistia={},window._wq=window._wq||[],_wq.push({id:"f6sh0ulno2",onReady:function(e){TGE_Editor.wistia.start_quiz=e}})}))}(jQuery)})();