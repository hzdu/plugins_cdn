(()=>{var e;window.ThriveQuizB=window.ThriveQuizB||{},ThriveQuizB.views=ThriveQuizB.views||{},ThriveQuizB.flows=ThriveQuizB.flows||{},e=jQuery,"ontouchstart"in document.documentElement||(document.documentElement.className+=" no-touch"),ThriveQuizB.loadedShortcodes=[],ThriveQuizB.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},ThriveQuizB.ajaxurl=function(e){var t=-1!==TQB_Front.ajax_url.indexOf("?")?"&":"?";return e&&e.length?(e=e.replace(/^(\?|&)/,""),e+="&_nonce="+TQB_Front.nonce,e+="&tqb-post-id="+TQB_Front.post_id,TQB_Front.ajax_url+t+e):TQB_Front.ajax_url+t+"_nonce="+ThriveQuizB.admin_nonce},ThriveQuizB.tpl=function(t,i){var s=e("script#"+t.replace(/\//g,"-")).html()||"";return s=s.replace(/(\n|\t|\r)/g,""),i?_.template(s,ThriveQuizB.templateSettings)(i):_.template(s,ThriveQuizB.templateSettings)},ThriveQuizB.getQueryParams=function(){var e=window.location.search||"",t={};if(e=e.substr(1),window.tqb_restart_quiz&&(t.restart_quiz=1),!e.length)return t;var i=e.split("&");return _.each(i,(function(e){var i=e.split("=")[0];i&&(t[i]=decodeURIComponent(e.split("=")[1]))})),t},e.fn.tqb=function(t,i){if(t||(t={}),i=i||!1,window.TQB_Front=window.TQB_Front||window.TQB_Front_Ajax||null,window.TQB_Front){if(e.each(t,(function(e,i){-1!==ThriveQuizB.loadedShortcodes.indexOf(e)&&delete t[e],ThriveQuizB.loadedShortcodes.push(e)})),0===Object.keys(t).length)return!1;!0!==i?window.TVE_Dash&&!TVE_Dash.ajax_sent?e(document).on("tve-dash.load",(function(e){o()})):o():ThriveGlobal.$j.ajax({url:TQB_Front.ajax_url,type:"get",data:_.extend(n(),{route:"get_quiz_data"})}).done(s)}function s(e,t){void 0!==t&&t.lazy_load_conditional_preview&&tcb_condition_sets&&(tcb_condition_sets=tcb_condition_sets.concat(t.lazy_load_conditional_preview));var i=new ThriveQuizB.collections.Shortcodes;Object.keys(e).forEach((function(t){TQB_Front.quiz_options[e[t].quiz_id]={feedback_settings:e[t].feedback_settings,highlight_settings:e[t].highlight_settings,progress_settings:e[t].progress_settings,scroll_settings:e[t].scroll_settings,quiz_style:e[t].quiz_style},e[t].id=t;var s=new ThriveQuizB.models.Shortcode(e[t]);i.add([s])})),ThriveQuizB.shortcode_list&&ThriveQuizB.shortcode_list.destroy(),ThriveQuizB.shortcode_list=new ThriveQuizB.views.ShortcodeList({collection:i}),ThriveQuizB.shortcode_list.render()}function n(){return _.extend({},{quiz_ids:t,tqb_scripts_loaded:!0},ThriveQuizB.getQueryParams())}function o(){window.TVE_Dash&&TVE_Dash.add_load_item("tqb_lazy_load",n(),s)}},e((function(){var t=e(this);ThriveGlobal.$j(window).on("conditional_display_loaded",(function(){ThriveQuizB.shortcode_list&&ThriveQuizB.shortcode_list.render()})),ThriveGlobal.$j(document).on("tqb_quiz_loaded",(function(i,s){var n={};_.each([s.quiz_id],(function(t){var i=e("[data-quiz-id="+t+"]"),s=i.attr("data-unique");n[s]=i.attr("data-quiz-id")})),t.tqb(n,!0)}));var i={};e(".tqb-shortcode-wrapper").each((function(){i[this.getAttribute("data-unique")]=this.getAttribute("data-quiz-id")})),t.tqb(i)})),window.ThriveQuizB=window.ThriveQuizB||{},ThriveQuizB.models=ThriveQuizB.models||{},ThriveQuizB.collections=ThriveQuizB.collections||{},function(e){e((function(){ThriveQuizB.models.Base=Backbone.Model.extend({idAttribute:"ID",validation_error:function(e,t){return{field:e,message:t}},custom_action:function(e,t,i){t||(t={});var s=_.extend({type:"post",dataType:"json",url:this.url()+"&custom_action="+i,data:t},e);return jQuery.ajax(s)}}),ThriveQuizB.collections.Base=Backbone.Collection.extend({last:function(){return this.at(this.size()-1)}}),ThriveQuizB.models.Shortcode=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,quiz_id:null,user_unique:null,page_type:"",page:{page_id:null,variation_id:null,html:"",css:"",fonts:""},question:null},parse:function(t){return e(TCB_Front).trigger("tqb_shortcode_response",t),t},url:function(){return ThriveQuizB.ajaxurl("&route=shortcode")},logSocialShareConversion:function(e,t){this.custom_action(e,t,"log_social_share_conversion")},saveUserCustomSocialShareBadge:function(e,t){this.custom_action(e,t,"save_user_custom_social_share_badge")},initialize:function(e){this.set("results_settings",new ThriveQuizB.models.ResultsSettings(e.results_settings||{}))},has_optin_page:function(){return this.get("structure")&&this.get("structure").optin},tpl:function(t){var i=this.get("tve_qna_templates");return(i=(i=i&&i[this.get("quiz_style")])&&i[t])?(i=e("<textarea/>").html(i).text(),_.template(i,ThriveQuizB.templateSettings)):null},hasQnaTpl:function(){var e=this.get("tve_qna_templates");return(e=e&&e[this.get("quiz_style")])&&Object.keys(e).length>0},getSharedStyles:function(){var e="";return this.get("tve_shared_styles")&&(e=this.get("tve_shared_styles")[this.get("page_type")]),e}}),ThriveQuizB.models.ResultsSettings=ThriveQuizB.models.Base.extend({initialize:function(e){this.set("message",new Backbone.Model(e.message)),e.links&&this.set("links",new Backbone.Collection(e.links))},get_type:function(){return this.get("type")},isURL:function(){return"url"===this.get_type()},get_redirect_url:function(t,i){var s="",n={tqb_email:(i=i||{}).email||"",tqb_name:_.escape(i.name)||"",tqb_quiz_result:"personality"===t.quiz_type||"percentage"===t.quiz_type?t.explicit:t.user_points};t=_.extend({result_id:null,user_points:0,min_points:0,max_points:0},t||{});var o=parseInt(t.user_points);if(t.result_id){var r=this.get("links").findWhere({result_id:t.result_id});s=r.get("link")}else if("percentage"===this.get("quiz_type")){var a;a=t.min_points===t.max_points?100:100*(o-parseInt(t.min_points))/(parseInt(t.max_points)-parseInt(t.min_points)),this.get("links").each((function(e){a>=parseInt(e.get("lower_bound"))&&a<=parseInt(e.get("upper_bound"))&&(s=e.get("link"))}))}else this.get("links").each((function(e){o>=parseInt(e.get("lower_bound"))&&o<=parseInt(e.get("upper_bound"))&&(s=e.get("link"))}));return s.length&&this.get("forward_results")&&(s+="?"+e.param(n)),s}}),ThriveQuizB.models.Image=ThriveQuizB.models.Base.extend({defaults:_.extend({},ThriveQuizB.models.Base.prototype.defaults,{sizes:{thumbnail:{url:null}}}),initialize:function(e){"string"==typeof e&&this.set(_.extend({},this.defaults,{sizes:{full:{url:e},thumbnail:{url:e}},url:e}))},get_thumb:function(){return this.attributes.sizes.thumbnail?this.attributes.sizes.thumbnail.url||this.get("url")||null:this.get("url")||null}}),ThriveQuizB.models.Media=ThriveQuizB.models.Base.extend({defaults:_.extend({},ThriveQuizB.models.Base.prototype.defaults,{display_type:0,type:"",source:"",url:"",color:"",style:"",options:[]})}),ThriveQuizB.models.Video=ThriveQuizB.models.Media.extend({defaults:_.extend({},ThriveQuizB.models.Media.prototype.defaults,{video_id:"",style:{},thumb:"",source:"youtube",url:""}),initialize:function(e){this.get("thumb")&&this.set("thumb",new ThriveQuizB.models.Image(this.get("thumb"))),e.url&&0!==e.url.length||this.setDefaults(),this.buildEmbedCode()},setDefaults:function(){this.attributes.source="youtube"},buildEmbedCode:function(){if(this.attributes.url){var e=this.videoIdAndParams();e&&this.set("video_id",e)}},videoIdAndParams:function(){var e="";switch(this.attributes.source){case"youtube":var t=this.attributes.url.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);e=t&&11==t[7].length?t[7]:"";break;case"vimeo":case"wistia":e=this.attributes.url.substring(this.attributes.url.lastIndexOf("/")+1)}return this.buildVideoParams(e)},buildVideoParams:function(e){var t=void 0!==this.attributes.options?this.attributes.options:[],i=void 0!==this.attributes.players?this.attributes.players:[],s=this.attributes.source,n=this.attributes.color?this.attributes.color.replace("#",""):"ffffff",o=[];if("vimeo"===s&&o.push("color="+this.attributes.color.replace("#","")),"wistia"===s&&(o.push("chromeless=false"),o.push("controlsVisibleOnLoad=true"),o.push("playerColor="+n)),"youtube"===s){var r=t&&1===parseInt(t.hide_logo.value)?1:0;o.push("modestbranding="+r)}return _.each(i[s],(function(e,i){var n=i,r=e,a=void 0!==t[n]?t[n].value:"0";switch(i){case"autoplay":if(["youtube","wistia","vimeo"].includes(s)&&"true"==(a=1===parseInt(a)?"true":"false"))switch(s){case"youtube":o.push("mute=1");break;case"vimeo":case"wistia":o.push("muted=1")}break;case"hide_logo":case"hide_controls":a=1===parseInt(a)?0:1;break;case"hide_full_screens":a=1===parseInt(a)?0:1,"wistia"===s&&(a=1===parseInt(a)?"true":"false");break;case"disable_playbar":a=1===parseInt(a)?0:1,"wistia"!==s&&"vimeo"!==s||(a=1===parseInt(a)?"true":"false")}"youtube"===s&&"hide_logo"===i||o.push(r+"="+a)})),"wistia"===s&&o.push("videoFoam=true"),o.length>1?e+="?"+o.join("&"):e}}),ThriveQuizB.models.Audio=ThriveQuizB.models.Video.extend({buildEmbedCode:function(){if(this.attributes.url){var e=this.videoIdAndParams();e&&this.set("video_id",e)}},videoIdAndParams:function(){return this.buildVideoParams("")},buildVideoParams:function(e){var t=void 0!==this.attributes.options?this.attributes.options:[],i=void 0!==this.attributes.players?this.attributes.players:[],s=this.attributes.audio_source,n=[];return"spotify"===s&&(e=this.attributes.url.replace("https://open.spotify.com","")),_.each(i[s],(function(e,i){var o=i,r=e,a=void 0!==t[o]?t[o].value:"0";switch(i){case"show_user":case"show_artwork":"soundcloud"===s&&(a=1===parseInt(a)?"false":"true");break;default:a=1===parseInt(a)?"true":"false"}n.push(r+"="+a)})),n.length>1?e+=n.join("&"):e}}),ThriveQuizB.models.Question=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,question_id:null,type:null,text:"",image:"",description:""},initialize:function(e){this.set("settings",new ThriveQuizB.models.QuestionSettings(e.settings)),null!==e.display_settings&&("video"===e.display_settings.type?this.set("display_settings",new ThriveQuizB.models.Video(e.display_settings)):this.set("display_settings",new ThriveQuizB.models.Audio(e.display_settings)))},get_image:function(){return"string"==typeof this.get("image")?this.get("image"):this.get("image").sizes.full.url},isTypeOf:function(e){var t=!1;return["button","image","open"].indexOf(e)>=0&&("button"===e&&1===parseInt(this.get("q_type"))||"image"===e&&2===parseInt(this.get("q_type"))||"open"===e&&3===parseInt(this.get("q_type")))&&(t=!0),t},isOpenEndedType:function(){return this.isTypeOf("open")},showFeedback:function(){return!0===this.get("settings").get("display_question_feedback")}}),ThriveQuizB.models.FeedbackSettings=ThriveQuizB.models.Base.extend({defaults:{display_feedback:1,display_feedback_time:2,press_next:0},getFeedbackTime:function(){return parseInt(this.get("display_feedback_time"))},showFeedback:function(){return 1===this.get("display_feedback")||1===this.get("press_next")},showNextButton:function(){return 1===this.get("press_next")}}),ThriveQuizB.models.HilightSettings=ThriveQuizB.models.Base.extend({defaults:{highlight_answer:1,load_next_question:0,highlight_and_show_feedback:0},highlight:function(){return 0===this.get("load_next_question")},showFeedback:function(){return 1===this.get("highlight_and_show_feedback")},loadNext:function(){return 1===this.get("load_next_question")}}),ThriveQuizB.models.Answer=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,order:null,text:"",image:""},initialize:function(){var e=TQB_Front.quiz_options[this.get("quiz_id")];e.feedback_settings.quiz_type=this.get("quiz_type"),e.highlight_settings.quiz_type=this.get("quiz_type"),this.set("highlight_settings",new ThriveQuizB.models.HilightSettings(e.highlight_settings)),this.set("feedback_settings",new ThriveQuizB.models.FeedbackSettings(e.feedback_settings))},highlight:function(){return this.get("highlight_settings")},feedback:function(){return this.get("feedback_settings")},isRightWrong:function(){return"right_wrong"===this.get("quiz_type")},hasFeedback:function(){return this.get("feedback")&&this.get("feedback").length>0},showFeedback:function(){return!!this.hasFeedback()&&(this.isRightWrong()?this.highlight().showFeedback():this.feedback().showFeedback())},showNextButton:function(){return this.isRightWrong()?this.highlight().loadNext():this.feedback().showNextButton()&&this.hasFeedback()},highlightAnswer:function(){return this.isRightWrong()&&(1===this.highlight().get("highlight_answer")||1===this.highlight().get("highlight_and_show_feedback"))},getShowFeedbackTime:function(){return 1e3*this.feedback().getFeedbackTime()},getDelayFeedbackTime:function(){return 1===parseInt(this.get("is_right"))?0:this.isRightWrong()?2e3:0},getTimeBeforeNextQuestion:function(){return this.showFeedback()||this.highlightAnswer()?this.getShowFeedbackTime():0},get_image:function(){return"string"==typeof this.get("image")?this.get("image"):this.get("image").sizes.full.url},validate:function(e,t){var i=[];if(!0===t.get("required")){var s=this.get("answer_text");if(!s||s.length<t.get_min_value())return[t.min_error()]}if(i.length)return i}}),ThriveQuizB.models.QuestionSettings=Backbone.Model.extend({get_max_value:function(){return parseInt(this.get("answer_limits").max.value)},get_min_value:function(){return parseInt(this.get("answer_limits").min.value)},min_error:function(){return this.get("answer_limits").min.error_message.replace("(limit)",this.get_min_value())},max_error:function(){return this.get("answer_limits").max.error_message.replace("(limit)",this.get_max_value())}}),ThriveQuizB.collections.Shortcodes=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Shortcode}),ThriveQuizB.collections.Answers=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Answer}),ThriveQuizB.models.ProgressSettings=ThriveQuizB.models.Base.extend({defaults:function(){return{quiz_id:"",display_progress:0}},getPercentToDisplay:function(){return"percentage_completed"===this.get("percent_type")?this.get("percentage"):100-this.get("percentage")}}),ThriveQuizB.models.ScrollSetting=ThriveQuizB.models.Base.extend({defaults:function(){return{enable_scroll:0}}})}))}(jQuery),(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}window.ThriveQuizB=window.ThriveQuizB||{},ThriveQuizB.views=ThriveQuizB.views||{};var t=function(e){return{initQuizFlows:function(){return e.each((function(e){var t=this;e.on("tqb.count",(function(e){Object.keys(e).forEach((function(i){Object.keys(e[i].flows.items).length&&(e[i].count=t._getHighestCount(e[i])+1)}))}))}),this),_.extend({first_question:this.getFirstQuestion().get("text")},{flows:{items:this.setQuestionFlows(this.getFirstQuestion())}})},_getHighestCount:function(e){var t=1;return Object.keys(e.flows.items).forEach((function(i){e.flows.items[i].count>t&&(t=e.flows.items[i].count)})),t},_setQuestionFlow:function(e){var t={};return null!==e.get("next_question_id")&&(t=this.setQuestionFlows(this.getQuestion(e.get("next_question_id")))),t},setQuestionFlows:function(e){if(void 0===e)return{};var t={},i="q_"+e.get("id");return t[i]={question:e.get("text"),count:1,flows:{items:this._setQuestionFlow(e)}},e.get("answers").each((function(e){var i=this.setAnswerFlows(e);t["a_"+e.get("id")]={answer:e.get("text"),flows:i,count:1}}),this),e.trigger("tqb.count",t),t},setAnswerFlows:function(e){var t={items:{}};return null!==e.get("next_question_id")&&0!==parseInt(e.get("next_question_id"))&&(t=_.extend({items:this.setQuestionFlows(this.getQuestion(e.get("next_question_id")))},{count:1,next_question_id:e.get("next_question_id")})),t},calculateFlows:function(){var e="quiz_"+this.getQuizId();ThriveQuizB.flows[e]=_.extend({flowsSet:!1},this.initQuizFlows()),ThriveQuizB.flows[e].flowsSet=!0},getFirstQuestion:function(){return e.findWhere({start:"1"})},getQuestion:function(t){return e.findWhere({id:t})},getQuizId:function(){return parseInt(this.getFirstQuestion().get("quiz_id"))}}},i=function(e,t){t=t||1e3,e.parents(".tve-leads-lightbox")&&setTimeout((function(){ThriveGlobal.$j(window).trigger("resize")}),t)};window.addEventListener("scroll",(function(){window.tqbLastScrollTime=(new Date).getTime()})),function(s){s((function(){ThriveQuizB.views.Base=Backbone.View.extend({render:function(){return this}}),ThriveQuizB.views.ShortcodeList=ThriveQuizB.views.Base.extend({events:{},el:s("body"),children:[],render:function(){return this.collection.each(this.renderOne,this),this},renderOne:function(e){if(e.get("page").html||e.get("question")){var t=this.$el.find("#tqb-shortcode-wrapper-".concat(e.get("quiz_id"),"-").concat(e.get("id").replace(".","\\.")));t.length||(t=this.$el.find('[id^="tqb-shortcode-wrapper-'.concat(e.get("quiz_id"),'"]')));var i=new ThriveQuizB.views.Shortcode({model:e,collection:this.collection,questions:e.get("all_questions"),el:t});i.render(),this.children.push(i)}e.get("error")&&TQB_Front.is_preview&&this.$el.find("#tqb-shortcode-wrapper-"+e.get("quiz_id")+"-"+e.get("id")).find(".tqb-frontend-error-message").html(e.get("error"))},destroy:function(){this.undelegateEvents(),_.each(this.children,(function(e){e.undelegateEvents()}))}}),ThriveQuizB.views.Shortcode=ThriveQuizB.views.Base.extend({events:{"click .tqb-shortcode-new-content .tqb-shortcode-submit-action":"nextPage","click .tqb-shortcode-new-content .tve_evt_manager_listen":"runEvent","click .tqb-shortcode-new-content .tve-dynamic-link":"restartQuiz"},to_load:0,sec_delay:1,powered_by_tqb:ThriveQuizB.tpl("powered-by-thrive-themes"),questions:null,quiz_type:null,render_count:0,initialize:function(e){this.questions=new Backbone.Collection(e.questions),this.quiz_type=this.model.get("quiz_type"),this.percentage=0,this.generateQuizFlows();var t="quiz_"+this.model.get("quiz_id");this.flows=ThriveQuizB.flows[t]?ThriveQuizB.flows[t].flows.items:{},this.listenTo(this.questions,"remove",this.getNextQuestion),this.model.get("resume_flow")&&Array.isArray(this.model.get("resume_flow"))&&this.model.get("resume_flow").forEach(function(e){var t="q_"+e.question_id,i="a_"+e.answer_id,s={},n=1,o=this.questions.findWhere({id:e.question_id}).get("answers").find((function(t){return t.id=e.answer_id}));null!==o.next_question_id&&0!==parseInt(o.next_question_id)&&this.flows[i].count?(s=this.flows[i].flows.items,n=this.flows[i].count):(s=this.flows[t].flows.items,n=this.flows[t].count);var r=this.percentage+(100-this.percentage)/n;r=Math.round(r),this.percentage=r,this.flows=s}.bind(this)),this.questions.on("tqb.set_progress",(function(e){var t="a_"+e.selectedAnswer.get("id"),i="q_"+this.questions.findWhere({id:e.selectedAnswer.get("question_id")}).get("id"),s={},n=1;null!==e.selectedAnswer.get("next_question_id")&&0!==parseInt(e.selectedAnswer.get("next_question_id"))&&this.flows[t].count?(s=this.flows[t].flows.items,n=this.flows[t].count):(s=this.flows[i].flows.items,n=this.flows[i].count);var o=this.percentage+(100-this.percentage)/n;o=Math.round(o),e.percentage=this.percentage=o,this.flows=s}),this),ThriveGlobal.$j(".tve_p_lb_content").on("tve.lightbox-open",(function(){i(s(this).find(".tqb-shortcode-wrapper"),3e3)}))},render:function(){return this.showLoader(),this.loadScripts(),this.initListeners(this.model),this.hideLoader(),this.render_count>0&&this.scrollQuiz(),this.render_count++,"ontouchstart"in document.documentElement||this.$el.addClass("no-touch"),this},generateQuizFlows:function(){var i=TQB_Front.quiz_options[this.model.get("quiz_id")],s=i.progress_settings;if(s=(s="object"===e(s)&&i.progress_settings)&&1===parseInt(i.progress_settings.display_progress))try{new t(this.getDataForProgress()).calculateFlows()}catch(e){}},getDataForProgress:function(){var e=JSON.parse(JSON.stringify(this.questions));return(e=new Backbone.Collection(e)).each((function(e){e.set("answers",new Backbone.Collection(e.get("answers")))})),e},getNextQuestion:function(e){var t=this.questions.findWhere({id:e.get("next_question_id")}),i=new Backbone.Collection(e.get("answers")).findWhere({id:e.get("user_answer_id")});setTimeout((function(n){t?(n.renderQuestion(t),n.scrollQuiz(),s.ajax({type:"post",url:ThriveQuizB.ajaxurl("&route=shortcode&custom_action=register_question_answer"),data:{user_unique:n.model.get("user_unique"),quiz_id:n.model.get("quiz_id"),answer_id:e.get("user_answer_id"),answer_text:e.get("user_answer_model").get("answer_text")},success:function(){}})):(i.set("answer_text",e.get("user_answer_model").get("answer_text")),n.shortcodeAction(i))}),this._get_delay(),this)},loadScripts:function(){var e=this,t=this.model.get("page"),i=[],n=s("head"),o=this.$(".tqb-shortcode-new-content");if(t&&t.optimized_assets){if(t.optimized_assets.style){var r=document.createElement("style");document.head.prepend(r),r.setAttribute("data-tqb-variation",t.variation_id),r.appendChild(document.createTextNode(t.optimized_assets.style))}if(t.optimized_assets.files)for(var a in t.optimized_assets.files){var d="flat"===a;(!n.find('link[href*="thrive_flat.css"]').length&&d||!d)&&n.append(t.optimized_assets.files[a])}t.optimized_assets.js&&n.append(t.optimized_assets.js)}if(o.html("").append(this.model.getSharedStyles()),this.model.get("tve_custom_style")){var l=s("<style/>").addClass("tve_custom_style").html(this.model.get("tve_custom_style"));o.append(l)}t&&(i=(i=i.concat(t.css)).concat(t.fonts)),this.model.get("question")&&(i=i.concat(this.model.get("question").css)),this.to_load=i.length,_.each(i,(function(t,n,o){var r=s('<link rel="stylesheet" type="text/css" media="all" href="'+t+'">');e.$(".tqb-shortcode-new-content").append(r),r.on("load",(function(){e.to_load--,n===i.length-1&&e.check_loaded()}))}))},loadHTML:function(){if(1!=navigator.userAgent.toLowerCase().indexOf("firefox")>-1||!0!==(window.tqbLastScrollTime&&(new Date).getTime()<window.tqbLastScrollTime+100)||!this.$el.closest(".tve-scroll-sticky").length){if(_.isEmpty(this.model.get("page"))){this.template=ThriveQuizB.tpl("question-wrapper");var e=this.model.get("tve_qna_templates");if(e){var t=e[this.model.get("quiz_style")];t&&t.questionWrapper&&(this.template=_.template(t.questionWrapper,ThriveQuizB.templateSettings))}this.$el.find(".tqb-shortcode-new-content").append(this.template()),this.renderQuestion(),this.model.trigger("tqb:close_loader",this.model)}else{this.template=_.template(this.model.get("page").html,ThriveQuizB.templateSettings),this.$el.find(".tqb-shortcode-new-content").append(this.template(this.model.toJSON())),this.$el.find(".tqb-shortcode-new-content").append('<style type="text/css">'+this.model.get("page").user_css.replace(/\\/g,"")+"</style>"),this.setUserIdentifier(),this.listener(),TQB_Front.settings.tqb_promotion_badge&&this.$el.find(".tqb-shortcode-new-content .tve-tqb-page-type").after(this.powered_by_tqb()),"results"===this.model.get("page_type")?this.model.get("results_settings").isURL()?this.$el.find(".tqb-shortcode-new-content").html(this.redirectToResultHTML()):this.resultPageListener():this.model.trigger("tqb:close_loader",this.model);var i=this.model.get("page")&&this.model.get("page").quiz_user_result;"optin"!==this.model.get("page_type")&&"results"!==this.model.get("page_type")||void 0===i||this.$(".thrv_lead_generation form").append('<input type="hidden" name="tqb-quiz-user-result" value="'+i+'">')}setTimeout((function(e){e.hideLoader(),e.setOverlayHeight(),e.$el.offset().top,"splash"!==e.model.get("page_type")&&e.scrollQuiz()}),50,this),TCB_Front.onDOMReady(ThriveGlobal.$j(this.$el)),TCB_Front.handleIframes(ThriveGlobal.$j(this.$el),!0),ThriveGlobal.$j(TCB_Front).trigger("content_loaded.thrive",[this.$el.find(".tqb-shortcode-new-content")])}},check_loaded:function(){var e,t=this;if(this.to_load<=0)return this.loadHTML(),void clearTimeout(e);e=setTimeout((function(){t.check_loaded()}),50)},scrollQuiz:function(){var e,t=this.$el.parents(".thrive-quiz-builder-shortcode");if(t.length&&t.data("enable_scroll"))e="on"===t.data("enable_scroll");else{var i=TQB_Front.quiz_options[parseInt(this.model.get("quiz_id"))].scroll_settings,n=new ThriveQuizB.models.ScrollSetting(i);e=1===parseInt(n.get("enable_scroll"))}if(!0===e&&!this.$el.closest(".thrv-leads-slide-in").length)if(this.$el.parents(".tve_p_lb_background").length)s(".tve_p_lb_background").animate({scrollTop:0});else{var o=this;setTimeout((function(){var e=s(".thrv_header.tve-scroll-sticky").length?s(".thrv_header.tve-scroll-sticky").outerHeight():0;s("html,body").animate({scrollTop:o.$el.offset().top-e})}),500)}},runEvent:function(e){var t=s(e.currentTarget),i=t.attr("data-tcb-events");if("string"==typeof t.data("shortcode-id")&&t.data("shortcode-id").includes("next_step_in_quiz"))return e.preventDefault(),void this.shortcodeAction();if("string"==typeof i){var n=!1,o=ThriveGlobal.$j.parseJSON(i.replace("__TCB_EVENT_","").replace("_TNEVE_BCT__",""));t.is("a")&&t.closest(".tve_ea_thrive_quiz_next_step ").length&&e.preventDefault(),e.stopPropagation();for(var r=0,a=o.length;r<a;r++)if("thrive_quiz_next_step"===o[r].a)n=!0;else if("thrive_animation"===o[r].a){var d=t.is("a")?t:t.parent("a"),l=d.attr("href");l&&(d.attr("target")?window.open(l,"_blank"):window.location.href=l)}n&&(e.preventDefault(),this.shortcodeAction())}},restartQuiz:function(e){if("tqb_quiz_options"===this.$(e.currentTarget).data("dynamic-link"))if(e.preventDefault(),this.$(e.currentTarget).data("shortcode-id").includes("restart_quiz")){this.model.trigger("tqb:show_loader"),this.undelegateEvents();var t={},i=this.$el.data("unique");t[i]=this.$el.data("quiz-id"),Object.keys(ThriveQuizB.loadedShortcodes).forEach((function(e){"undefined"!==t[e]&&delete ThriveQuizB.loadedShortcodes[e]})),window.tqb_restart_quiz=1,s(this).tqb(t),delete window.tqb_restart_quiz}else this.$(e.currentTarget).data("shortcode-id").includes("next_step_in_quiz")&&this.runEvent(e)},setUserIdentifier:function(){this.$el.find(".tqb-hidden-form-info.tqb-hidden-user-unique").val(this.model.get("user_unique"))},setOverlayHeight:function(){var e=this.$el.find(".tqb-shortcode-new-content").outerHeight();this.$el.find(".tqb-loading-overlay").css({height:e+"px"})},listener:function(){var e=this,t=this.$el.find(".tve_et_tve-viewport"),i=function(t){e.model.set("form_data",_.extend({email:"",name:""},t.form_data||{})),e.model.set({$leadGeneration:t.$leadGeneration,$form:t.$form}),e.nextPage()};ThriveGlobal.$j(this.$el).off("lead_conversion_error_code.tcb").on("lead_conversion_error_code.tcb",".thrv_lead_generation",(function(e){"no_connection"===e.errorCode&&i(e)})),ThriveGlobal.$j(this.$el).off("lead_conversion_success.tcb").on("lead_conversion_success.tcb",".thrv_lead_generation",(function(t){t.content_unlocked="results"!==e.model.get("page_type"),i(t)})),ThriveGlobal.$j(this.$el).off("should_submit_form.tcb").on("should_submit_form.tcb",".thrv_lead_generation",(function(e){return e.flag_need_data=!0,!0})),this.$el.find(".tqb-shortcode-new-content").addClass("ajax-content"),"function"==typeof window.tar_trigger_viewport&&"function"==typeof window.tar_trigger_exit_viewport&&(jQuery(window).scroll((function(){window.tar_trigger_viewport(t.filter(":not(.tve-viewport-triggered)")),window.tar_trigger_exit_viewport(t.filter(".tve-viewport-triggered"))})),setTimeout((function(){window.tar_trigger_viewport(t),e.$el.find(".tqb-shortcode-new-content").trigger("content-inserted.tcb").removeClass("ajax-content")}),200)),TCB_Front.onDOMReady(ThriveGlobal.$j(e.$el.find(".tqb-shortcode-new-content"))),TCB_Front.event_triggers(e.$el.find(".tqb-shortcode-new-content"))},switchContent:function(){var e=this.$el.find(".tqb-shortcode-old-content"),t=this.$el.find(".tqb-shortcode-new-content");e.html(t.html())},nextPage:function(){this.shortcodeAction()},shortcodeAction:function(e){if("results"!==this.model.get("page_type")){this.hideErrorToast();var t=this,s=e?this.getQuestionData(e):this.getPageData(),n=this.model.has_optin_page()&&void 0===e&&"optin"===s.page_type;s=_.extend({},s,ThriveQuizB.getQueryParams()),(n=n||!this.model.has_optin_page()&&void 0!==e&&"splash"===s.page_type)&&this.model.get("results_settings").isURL()&&this.model.get("results_settings").get("display_message")?this.model.trigger("tqb:show_redirect_loader",this.model):this.model.trigger("tqb:show_loader",this.model),s.form_data=this.model.get("form_data");var o=this.model.get("$leadGeneration");o&&o.length&&(s.form_data._tcb_id=o.attr("data-settings-id")),this.model.fetch({data:s,success:function(e){if("results"===e.get("page_type")&&e.get("results_settings").isURL()){var s=e.get("results_settings").get("message"),n=parseInt(s.get("duration"));n=isNaN(n)?0:n,n*=1e3,e.get("results_settings").get("display_message")||(n=0),setTimeout((function(e){t.redirectToResultURL(e)}),n,e)}else t.render();i(t.$el)}})}},isSavingUserProgress:function(){var e=this.$el.attr("data-save-user-progress");return e&&1===Number(e)},redirectToResultHTML:function(){return new ThriveQuizB.views.ResultRedirect({view:this,model:new Backbone.Model({results_label:this.$el.attr("data-red-results-label"),retake_quiz:parseInt(this.$el.attr("data-red-retake-quiz")),retake_quiz_label:this.$el.attr("data-red-retake-quiz-label"),completed_quiz_label:this.$el.attr("data-red-quiz-completed-label")})}).render().$el},redirectToResultURL:function(e){var t=(e=e||this.model).get("results_settings").get_redirect_url(e.get("points"),e.get("form_data"));t.length&&(window.location=t)},hideErrorToast:function(){s("#tve-lg-error-container").hide()},getQuestionData:function(e){return{user_unique:this.model.get("user_unique"),quiz_id:this.model.get("quiz_id"),page_type:this.model.get("page_type"),answer_id:e.get("id"),answer_text:e.get("answer_text")||""}},getPageData:function(){var e=this.model.get("page");return{user_unique:this.model.get("user_unique"),quiz_id:this.model.get("quiz_id"),page_type:this.model.get("page_type"),variation:{page_id:e&&e.page_id||"",id:e&&e.variation_id||""}}},renderQuestion:function(e){e=void 0===e?this.questions.findWhere({start:"1"}):e,1===this.model.get("resume")&&this.model.get("question")&&(e=this.questions.findWhere({id:this.model.get("question").data.id}),this.model.set("resume",0)),_.each(e.get("answers"),(function(e){e.quiz_type=this.quiz_type}),this);var t=new ThriveQuizB.collections.Answers(e.get("answers")),i=e.toJSON();delete i.answers,new ThriveQuizB.views.Question({model:new ThriveQuizB.models.Question(i),questions:this.questions,collection:t,quiz_type:this.quiz_type,flows:this.flows,percentage:this.percentage,shortcode:this.model,el:this.$el.find(".tqb-shortcode-new-content .tqb-question-wrapper")}).render()},resultPageListener:function(){var e=this;ThriveGlobal.$j(tve_frontend_options.is_editor_page?"#tve_editor":"body").on("click",".thrv_social_custom .tve_s_link",(function(){e.model.logSocialShareConversion({},{page_id:e.model.get("page").page_id,quiz_id:e.model.get("page").quiz_id,variation_id:e.model.get("page").variation_id,"tqb-variation-user_unique":e.model.get("user_unique")})}));var t=this.model.get("page").badge_url||null,i=e.model.get("page").has_social_badge&&1==e.model.get("page").has_social_badge&&e.model.get("page").html_canvas&&!t,n=s('<div id="tie-preloader-gif"></div>'),o=e.$(".tqb-social-share-badge-container"),r=o.find(".tve_s_fb_share"),a=o.find("img"),d=s('<div id="tie-html-canvas" style="overflow: visible; position: absolute; z-index: -1; visibility: hidden;">'+(e.model.get("page").html_canvas?e.model.get("page").html_canvas:"")+"</div>"),l=((new Date).getTime(),0);function h(){r.removeAttr("data-image"),a.removeAttr("src"),o.children().hide(),o.append(n),s("style[onLoad]").removeAttr("onLoad")}function u(t){l++,a.attr("src",t),2===l&&r.attr("data-image",t);var i=e.model.get("quiz_url"),s="",n=r.attr("data-description");"I got: "===n&&(n=""),s+="&tqb_redirect_post_id="+TQB_Front.post_id,s+="&image_url="+t,s+="&description="+encodeURIComponent(n),-1===i.indexOf("?")&&(s+="?"+s.substr(1)),i+=s,r.attr("data-href",i),ThriveGlobal.$j(tve_frontend_options.is_editor_page?"#tve_editor":"body").on("click",".tqb-social-share-badge-container .tve_s_link",(function(){e.model.logSocialShareConversion({},{page_id:e.model.get("page").page_id,quiz_id:e.model.get("page").quiz_id,variation_id:e.model.get("page").variation_id,"tqb-variation-user_unique":e.model.get("user_unique")});var t=ThriveGlobal.$j(this).parents(".tve_s_item"),i=t.attr("data-s");TCB_Front.onSocialCustomClick[i]&&TCB_Front.onSocialCustomClick[i](t)})),d.remove()}function c(e){u(e),a.load((function(){n.remove(),o.children().fadeIn(),(new Date).getTime()}))}ThriveGlobal.$j(document).trigger("tve_shortcode_content_loaded",this),t&&(h(),u(t)),i&&(e.$el.find(".tqb-shortcode-new-content").parents().each((function(e,t){s(t).addClass("tqb-overflow-visible-badge")})),s("body").append(d),h(),setTimeout((function(){html2canvas([d.get(0)],{logging:void 0!==ThriveQuizB.html2canvas,onrendered:function(t){var i=t.toDataURL("image/png");u(i),e.$el.find(".tqb-shortcode-new-content").parents().each((function(e,t){s(t).removeClass("tqb-overflow-visible-badge")}));var n=function(e){for(var t=atob(e.split(",")[1]),i=[],s=0;s<t.length;)i.push(t.charCodeAt(s)),s++;return new Blob([new Uint8Array(i)],{type:"image/jpg"})}(i),o=new FormData,r=e.model.get("quiz_id"),a=e.model.get("user_id"),d=e.model.get("page").result;o.append("user_badge",n,d+"-"+r+".png"),o.append("quiz_id",r),o.append("user_id",a),o.append("result",d),o.append("action","tqb_frontend_ajax_controller"),s.ajax({type:"post",url:ThriveQuizB.ajaxurl("&route=shortcode&custom_action=save_user_custom_social_share_badge"),data:o,processData:!1,contentType:!1,success:c})}})}),500))},showLoader:function(){this.$el.find(".tqb-loading-overlay").show(),this.$el.find(".tqb-shortcode-new-content").html("")},showRedirectLoader:function(){var e=this.$el.find(".tqb-loading-overlay"),t=ThriveQuizB.tpl("loaders/redirect");e.html(t({display_message:this.model.get("results_settings").get("display_message"),item:this.model.get("results_settings").get("message")})),e.show(),this.$el.find(".tqb-shortcode-new-content").html("")},hideLoader:function(){this.$(".tqb-loading-overlay").hide(),this.$el.css({"--tqb-placeholder-height-m":"","--tqb-placeholder-height-t":"","--tqb-placeholder-height-d":""})},initListeners:function(e){e.off("tqb:show_loader").on("tqb:show_loader",_.bind(this.showLoader,this)).off("tqb:show_redirect_loader").on("tqb:show_redirect_loader",_.bind(this.showRedirectLoader,this)),e.off("tqb:close_loader").on("tqb:close_loader",_.bind(this.hideLoader,this))},_get_delay:function(){var e=0;return"right_wrong"===this.quiz_type&&1===this.highlight_answer&&(e=1e3*this.sec_delay),e}}),ThriveQuizB.views.VideoImageOverlay=Backbone.View.extend({template:ThriveQuizB.tpl("video/image-overlay"),events:{"click .tqb_video_overlay_image":"hideOverlayImage"},render:function(){var e=this.model.get("thumb")instanceof Backbone.Model&&this.model.get("thumb"),t=e?e.get("url"):"",i=this.model.get("source");return this.$el.find(".tqb-video-container-responsive").prepend(this.template({source:i,url:t})),this},hideOverlayImage:function(){this.$(".tqb_video_overlay_image").hide();var e,t=this.$el.find("iframe"),i=t.attr("src"),s=this.model.get("source");switch(s){case"youtube":i=(i=i.replace("&autoplay=0","")).replace("&autoplay=false","&autoplay=1"),e="&autoplay=true";break;case"vimeo":e="&autoplay=true";break;case"wistia":e="&autoPlay=true"}if("youtube"===s||"vimeo"===s||"wistia"===s)t=this.$el.find("iframe"),0!==i.length&&t.attr("src",i+e);else if((!TCB_Front.browser.safari||0===parseInt(data_controls)&&1===parseInt(data_overlay))&&("custom"===s||"self"===s)){var n=this.$el.find("video").get(0);n.paused?n.play():n.pause()}}}),ThriveQuizB.views.Media=Backbone.View.extend({renderVideoImageOverlay:function(){var e=this.model.get("thumb"),t=this.model.get("options");0==e instanceof Backbone.Model||void 0===t||void 0!==t.autoplay&&1===t.autoplay.value||new ThriveQuizB.views.VideoImageOverlay({model:this.model,el:this.$el}).render()},showLoader:function(){this.$el.find(".tqb-loading-overlay").show(),this.$el.find(".tqb-shortcode-new-content").html("")},hideLoader:function(){this.$el.find(".tqb-loading-overlay").hide()}}),ThriveQuizB.views.YotubeEmbededVideo=ThriveQuizB.views.Media.extend({template:ThriveQuizB.tpl("video/youtube"),render:function(){return this.showLoader(),this.$el.html(this.template({item:this.model})),this.renderVideoImageOverlay(),this.hideLoader(),this}}),ThriveQuizB.views.WistiaEmbededVideo=ThriveQuizB.views.Media.extend({template:ThriveQuizB.tpl("video/wistia"),render:function(){return this.showLoader(),this.$el.html(this.template({item:this.model})),this.renderVideoImageOverlay(),this.hideLoader(),this}}),ThriveQuizB.views.VimeoEmbededVideo=ThriveQuizB.views.Media.extend({template:ThriveQuizB.tpl("video/vimeo"),render:function(){return this.showLoader(),this.$el.html(this.template({item:this.model})),this.renderVideoImageOverlay(),this.hideLoader(),this}}),ThriveQuizB.views.CustomEmbededVideo=ThriveQuizB.views.Media.extend({template:ThriveQuizB.tpl("video/custom"),allowedMimeTypes:{asf:"video/x-ms-asf",asx:"video/x-ms-asf",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wm:"video/x-ms-wm",avi:"video/avi",divx:"video/divx",flv:"video/x-flv",mov:"video/quicktime",qt:"video/quicktime",mpeg:"video/mpeg",mpg:"video/mpeg",mpe:"video/mpeg",mp4:"video/mp4",m4v:"video/mp4",ogv:"video/ogg",webm:"video/webm",mkv:"video/x-matroska"},render:function(){var e=this.media_mime();return this.$el.html(this.template({mime:e,item:this.model})),this.renderVideoImageOverlay(),this},media_mime:function(){var e=this.model.get("url").split(".").pop().toLowerCase();return"string"==typeof this.allowedMimeTypes[e]?this.allowedMimeTypes[e]:""}}),ThriveQuizB.views.CustomEmbededAudio=ThriveQuizB.views.CustomEmbededVideo.extend({allowedMimeTypes:{mp3:"audio/mpeg",mpeg:"audio/mpeg",m4a:"audio/m4a",m4b:"audio/mpeg",ra:"audio/x-realaudio",ram:"audio/x-realaudio",wav:"audio/wav",ogg:"audio/ogg",oga:"audio/ogg",mid:"audio/midi",midi:"audio/midi",wma:"audio/x-ms-wma",wax:"audio/x-ms-wax",mka:"audio/x-matroska"},template:ThriveQuizB.tpl("audio/custom")}),ThriveQuizB.views.SpotifyEmbededAudio=ThriveQuizB.views.CustomEmbededVideo.extend({template:ThriveQuizB.tpl("audio/spotify"),render:function(){var e="//open.spotify.com/embed"+this.model.get("video_id");return this.$el.html(this.template({item:this.model,src:e})),this}}),ThriveQuizB.views.SoundcloudEmbededAudio=ThriveQuizB.views.CustomEmbededVideo.extend({template:ThriveQuizB.tpl("audio/soundcloud")}),ThriveQuizB.views.Question=ThriveQuizB.views.Base.extend({template:ThriveQuizB.tpl("question"),powered_by_tqb:ThriveQuizB.tpl("powered-by-thrive-themes"),events:{"click .tqb-next-button":function(t){if(!this.$(".tqb-open-ended-wrapper").length){var i=this.$('[data-clicked="1"]');if(i.length){this.collection.findWhere({id:i.data("id")});var s=this.collection.findWhere({id:i.data("id").toString()});"object"===e(s)&&s.trigger("tqb:choose_answer",s)}}}},initialize:function(e){this.questions=e.questions,this.quiz_type=e.quiz_type,this.flows=e.flows,this.percentage=e.percentage,this.shortcode=e.shortcode,this.collection.on("tqb:disable_answer",_.bind(this.disableAnswer,this)).on("tqb:show_next",_.bind(this.showNext,this)).on("tqb:show_right_answer",_.bind(this.showRightAnswer,this)).on("tqb:handle_progress",_.bind(this.handleProgress,this))},showRightAnswer:function(e){_.each(this.collection.where({is_right:"1"}),(function(e){var t=this.$("#tqb-answer-"+e.get("id"));t.addClass("tqb-right tqb-right-answer tqb-rw"),t.attr("data-css",this.$("tqb-active-answer").attr("data-css"))}),this),"1"!==e.get("is_right")&&this.$("#tqb-answer-"+e.get("id")).addClass("tqb-wrong tqb-wrong-answer tqb-rw")},showNext:function(){this.$(".tqb-button-holder").removeClass("tqb-hide").addClass("tqb-clear"),this.$("#tqb-thrv-label").css({position:"relative","z-index":"-1"})},disableAnswer:function(){this.$(".tqb-answer-inner-wrapper").addClass("tqb-disable-answer")},handleProgress:function(e){this.selectedAnswer=e,this.questions.trigger("tqb.set_progress",this),this.renderProgress()},_qnaHtml:function(){if(this.shortcode.hasQnaTpl()){var e=this.model.get("display_settings")instanceof Backbone.Model&&this.model.get("display_settings"),t=e&&e.get("type")?e.get("type"):"";this.$el.html(jQuery(this.shortcode.tpl("questionWrapper")({item:this.model,display_type:t})).html()),this.$(".tqb-question-container").replaceWith(this.shortcode.tpl("questionContainer")({item:this.model,display_type:t})),this.$(".tqb-question-text").replaceWith(this.shortcode.tpl("questionText")({item:this.model})),this.$(".tqb-question-description").replaceWith(this.shortcode.tpl("questionDescription")({item:this.model})),"text"===t&&this.model.get("image")&&this.$(".tqb-question-container").append('<div class="tqb-question-image-container"><img src="'+this.model.get_image()+'" alt="question-image"></div>'),this.$(".tqb-answers-container").replaceWith(this.shortcode.tpl("answersContainer")())}},_html:function(){var e=this.model.get("display_settings")instanceof Backbone.Model&&this.model.get("display_settings"),t=e&&e.get("type")?e.get("type"):"";this.$el.html(this.template({item:this.model,display_type:t}))},render:function(){if(this._html(),this._qnaHtml(),this.renderMedia(),this.renderProgress(),this.renderAnswers(),this.shortcode.hasQnaTpl()){var e=this.model.isOpenEndedType()?".tqb-open-type-button":".tqb-button-holder",t=this.model.isOpenEndedType()?"html":"replaceWith";this.$(e)[t](this.shortcode.tpl("nextQuestion")()),this.$(".tqb-open-ended-wrapper .tqb-button-holder").removeClass("tqb-hide")}return TQB_Front.settings.tqb_promotion_badge&&!this.$("#tqb-thrv-label").length&&(this.$el.append(this.powered_by_tqb()),this.$("#tqb-thrv-label").addClass("tqb-clear")),"1"!==this.model.get("start")&&this.$("#tqb-open-type-answer").focus(),i(this.$el),this},renderMedia:function(){var e=this.model.get("display_settings");if(null!==e)switch(parseInt(e.get("display_type"))){case 0:default:this.renderText();break;case 1:this.renderVideo();break;case 2:this.renderAudio()}},renderText:function(){},renderAudio:function(){var e=e||this.$el.find(".tqb-question-media"),t=this.model.get("display_settings");switch(t.get("audio_source")){case"soundcloud":var i=new ThriveQuizB.views.SoundcloudEmbededAudio({model:t,el:e});break;case"spotify":i=new ThriveQuizB.views.SpotifyEmbededAudio({model:t,el:e});break;default:i=new ThriveQuizB.views.CustomEmbededAudio({model:t,el:e})}i.render()},renderVideo:function(e){e=e||this.$el.find(".tqb-question-media");var t=this.model.get("display_settings");switch(t.get("source")){case"youtube":var i=new ThriveQuizB.views.YotubeEmbededVideo({model:t,el:e});break;case"vimeo":i=new ThriveQuizB.views.VimeoEmbededVideo({model:t,el:e});break;case"wistia":default:i=new ThriveQuizB.views.WistiaEmbededVideo({model:t,el:e});break;case"custom":i=new ThriveQuizB.views.CustomEmbededVideo({model:t,el:e})}i.render()},renderProgress:function(){var e=TQB_Front.quiz_options[this.model.get("quiz_id")],t=new ThriveQuizB.models.ProgressSettings(e.progress_settings);1===parseInt(t.get("display_progress"))&&(t.set("percentage",this.percentage),this.$(".tqb-progress-container").remove(),"position_top"===e.progress_settings.progress_position?this.$el.prepend('<div class="tqb-progress-container tqb-hide"></div>'):this.$el.append('<div class="tqb-progress-container tqb-hide"></div>'),new ThriveQuizB.views.ProgressBar({template:this.shortcode.tpl("progressbarContainer"),shortcode:this.shortcode,model:t,flows:this.flows,hasSelectedAnswer:!!this.selectedAnswer,el:this.$(".tqb-progress-container"),quizId:this.model.get("quiz_id")}).render())},renderAnswers:function(){return 2===parseInt(this.model.get("q_type"))&&this.$el.find(".tqb-answers-container").addClass("tqb-answer-has-image"),new ThriveQuizB.views.Answers({model:this.model,collection:this.collection,questions:this.questions,quiz_type:this.quiz_type,shortcode:this.shortcode,el:this.$el.find(".tqb-answers-container")}).render()}}),ThriveQuizB.views.Answers=ThriveQuizB.views.Base.extend({events:{},initialize:function(e){this.questions=e.questions,this.quiz_type=e.quiz_type,this.shortcode=e.shortcode},render:function(){return this.$el.empty(),this.collection.each(this.renderOne,this),this},renderOne:function(e){e.on("tqb:choose_answer",(function(){var t=this.questions.findWhere({id:e.get("question_id")}),i=TQB_Front.quiz_options[this.model.get("quiz_id")];if(parseInt(e.get("next_question_id"))&&t.set({next_question_id:e.get("next_question_id")}),t.set("user_answer_id",e.get("id")),t.set("user_answer_model",e),this.questions.remove(t),!0!==i.press_next&&"right_wrong"===this.quiz_type&&0===parseInt(e.get("is_right"))){var s=this.collection.findWhere({is_right:"1"});s instanceof ThriveQuizB.models.Answer&&s.trigger("tqb:indicate-right")}}),this);var t=new ThriveQuizB.views.Answer({model:e,question:this.model,quiz_type:this.quiz_type,collection:this.collection,shortcode:this.shortcode});return this.$el.append(t.render().$el),this}}),ThriveQuizB.views.Answer=ThriveQuizB.views.Base.extend({className:"tqb-answer-inner-wrapper",template:ThriveQuizB.tpl("answer"),template_image:ThriveQuizB.tpl("answer-image"),template_open:ThriveQuizB.tpl("answer-open"),events:{"click .tqb-answer-action":"answerAction","keyup textarea":function(e){var t=this.question.get("settings"),i=this.$(".tqb-answer-status"),s=t.get_max_value()-e.currentTarget.value.length;s<0?(e.currentTarget.value=e.currentTarget.value.substr(0,t.get_max_value()),this.model.trigger("invalid",this.model,[t.max_error()])):(i.html(TQB_Front.t.chars+": %s".replace("%s",s)),this.set_status("typing"))}},right_class:"tqb-right-answer",wrong_class:"tqb-wrong-answer",quiz_type:null,$status:null,initialize:function(e){this.shortcode=e.shortcode,e.quiz_type&&(this.quiz_type=e.quiz_type),e.question&&e.question instanceof ThriveQuizB.models.Question&&(this.question=e.question),this.model.on("tqb:indicate-right",this.indicate_right,this),this.model.on("invalid",(function(e,t){this.set_status("error").html(t.shift())}),this)},indicate_right:function(){this.$el.addClass(this.right_class)},_tpl:function(e){var t=this.template,i=this.shortcode.tpl("answerItem");this.isQnaTpl=!1,this.question.isTypeOf("image")?(i=this.shortcode.tpl("answerImageItem"),t=this.template_image):this.question.isTypeOf("open")&&(i=this.shortcode.tpl("answerOpenItem"),t=this.template_open),i&&i.length&&(t=i,this.isQnaTpl=!0);var n=t(e);if(this.isQnaTpl){var o=s(n);this.$el.attr("data-css",o.data("css")),this.$el.addClass("tqb-editor-answer-wrapper"),o.find(".tqb-answer-icon").replaceWith(this.shortcode.tpl("answerIcon")()),o.find(".tcb-icon").removeClass("tcb-icon"),this.model.get("image")&&(o.find(".tqb-fancy-icon").addClass("tqb-fancy-rel"),o.find(".tqb-answer-image-container").html('<img src="'+this.model.get_image()+'" alt="" class="tqb-answer-image">')),n=o.find(".tqb-answer-content")[0].outerHTML}return n},_html:function(){var e=this._tpl({item:this.model,question:this.question,settings:this.question.get("settings")});this.isQnaTpl&&this.$el.attr("data-css",s(e).data("css")),this.$el.html(e)},render:function(){return this._html(),this.question.isTypeOf("open")&&this.$el.addClass("tqb-open-ended-wrapper"),this.$status=this.$(".tqb-answer-status"),this.$el.attr("id","tqb-answer-"+this.model.get("id")),this.$el.attr("data-id",this.model.get("id")),this},answerAction:function(e){if("BUTTON"!==e.target.tagName&&!s(e.target).is(".tqb-next-icon")||(this.model.set("answer_text",this.$("textarea").val()),!1!==this.model.isValid(this.question.get("settings")))){var t=e.currentTarget.classList.contains("tqb-open-ended-wrapper");if(t=(t=t&&"BUTTON"!==e.target.tagName)&&!s(e.target).is(".tqb-next-icon"))return e.stopPropagation();this.$el.data("clicked")||(this.$el.attr("data-clicked",1),this.handleProgress()&&this.collection.trigger("tqb:handle_progress",this.model),this.showNextButton()&&this.collection.trigger("tqb:show_next",this.model),this.$el.find(".tqb-answer-action").addClass("tqe-selected-answer"),this.$el.addClass("tqb-active-answer"),this.question.isOpenEndedType()||(this.collection.trigger("tqb:disable_answer",this.model),this.highlightAnswer(),this.handleFeedback()),this.next())}else this.$("textarea").focus()},next:function(){if(!this.showNextButton()){var e=this;setTimeout((function(){e.model.trigger("tqb:choose_answer",e.model)}),this.getTimeBeforeNextQuestion())}},getTimeBeforeNextQuestion:function(){var e=(this.model.highlightAnswer()||this.model.showFeedback())&&this.question.showFeedback(),t=!this.question.isOpenEndedType()&&e?this.model.getTimeBeforeNextQuestion():0;return"right_wrong"!==this.quiz_type||0!==t||this.model.highlight().loadNext()||this.question.isOpenEndedType()||(t=this.model.getShowFeedbackTime()),t},showNextButton:function(){var e=!this.question.isOpenEndedType()&&!this.model.highlight().loadNext();return"right_wrong"===this.quiz_type?e&&this.model.feedback().showNextButton():e&&this.hasFeedback()&&this.model.feedback().showNextButton()&&this.question.showFeedback()},hasFeedback:function(){return this.model.get("feedback")&&this.model.get("feedback").length>0},displayFeedback:function(){return!0===this.question.get("settings").get("display_question_feedback")&&this.model.showFeedback()},highlightAnswer:function(){!1===this.model.highlightAnswer()&&!1===this.question.isOpenEndedType()||this.collection.trigger("tqb:show_right_answer",this.model)},handleFeedback:function(){if(this.displayFeedback()){this.renderFeedback();var e=this;setTimeout((function(){e.$(".tqb-answer-feedback").removeClass("tqb-hide")}),this.model.getDelayFeedbackTime()),this.showNextButton()||setTimeout((function(){e.$(".tqb-answer-feedback").addClass("tqb-hide")}),this.model.getShowFeedbackTime())}},renderFeedback:function(){if(this.model.hasFeedback()){var e="";_.each(this.model.get("feedback").split("\n"),(function(t){e+='<p class="tqb-feedback-text">'+_.escape(t)+"</p>"}),this),this.$(".tqb-feedback-inner").html(e)}},set_status:function(e){switch(this.$status.removeAttr("class"),e){case"typing":this.$status.addClass("tqb-typing-text");break;case"error":this.$status.addClass("tqb-error-text")}return this.$status.addClass("tqb-answer-status"),this.$status},handleProgress:function(){var e=TQB_Front.quiz_options[this.model.get("quiz_id")];return e.progress_settings&&1===e.progress_settings.display_progress}}),ThriveQuizB.views.ResultRedirect=ThriveQuizB.views.Base.extend({template:ThriveQuizB.tpl("result-redirect"),events:{"click .tqb-restart-quiz":"restartQuiz","click .tqb-show-results":"redirectToResultURL"},initialize:function(e){this.ShortcodeView=e.view},restartQuiz:function(e){this.ShortcodeView.restartQuiz(e)},redirectToResultURL:function(e){this.ShortcodeView.redirectToResultURL()},render:function(){return this.$el.html(this.template({model:this.model})),this}}),ThriveQuizB.views.ProgressBar=Backbone.View.extend({template:function(e){return e._template&&e._template.length?e._template(e):ThriveQuizB.tpl("progress-bar-skin-"+TQB_Front.quiz_options[this.quizId].quiz_style)(e)},initialize:function(e){this._template=e.template,this.shortcode=e.shortcode,this.flows=e.flows,this.hasSelectedAnswer=e.hasSelectedAnswer,this.quizId=e.quizId},render:function(){var e=this.model.get("percentage"),t=!0!==this.hasSelectedAnswer?Math.round((100-this.model.get("percentage"))/this.getHighestCount()):0,i=100-this.model.get("percentage")>t?Math.round(100-t-this.model.get("percentage")):0,n=s(this.template({_template:this._template,model:this.model,completed:e,estimatedProgress:t,remaining:i}));return this.shortcode.hasQnaTpl()?(this.$el.attr("data-css",n.attr("data-css")),this.$el.html(n.html())):this.$el.html(n[0].outerHTML),this.$(".tqb-progress-completed").css("background-color",this.model.get("fill_color")),this.$(".tqb-progress-label").css("color",this.model.get("label_color")),this.$(".tqb-progress-label, .tqb-next-item, .tqb-remaining-progress").css("font-size",parseInt(this.model.get("font_size"))),this.$(".tqb-next-item").css("background-color",this.model.get("next_step_color")),this.$(".tqb-remaining-progress").css({width:"calc("+i+"%)","background-color":this.model.get("background_color")}),this.$(".tqb-next-item").toggleClass("tqb-hide",!0===this.hasSelectedAnswer),this.$el.removeClass("tqb-hide"),this},getHighestCount:function(e){var t=1;return e=e||this.flows,Object.keys(e).forEach((function(i){e[i].count>t&&(t=e[i].count)})),t}})}))}(jQuery)})()})();