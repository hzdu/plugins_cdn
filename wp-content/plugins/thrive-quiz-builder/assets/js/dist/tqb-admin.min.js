(()=>{var e;(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}var t;ThriveQuizB.models=ThriveQuizB.models||{},ThriveQuizB.collections=ThriveQuizB.collections||{},(t=jQuery)((function(){Backbone.emulateHTTP=!0,ThriveQuizB.models.Base=Backbone.Model.extend({idAttribute:"ID",validation_error:function(e,t){return{field:e,message:t}},saveState:function(){return this.__saved_state={},t.extend(!0,this.__saved_state,this.attributes),this},restoreState:function(e){return this.__saved_state?(e||(e=!1),this.set(this.__saved_state,{silent:e}),this):this}}),ThriveQuizB.models.Quiz=ThriveQuizB.models.Base.extend({defaults:{ID:"",shortcode_code:"",type:"",results:[],minimum_results:2,style:"",tpl:"",structure:[],state:ThriveQuizB.util.states.normal,validation:{valid:!1,error:{qna:ThriveQuizB.t.NoQuestionError,results:ThriveQuizB.t.ResultPageError}}},parse:function(e){e.results=new ThriveQuizB.collections.Options(e.results);var t=this.getQuizTypeText(e.type);return e.quiz_type_text=t.text,e.quiz_type_label=t.label,e.thrive_images&&(e.thrive_images=new ThriveQuizB.collections.ThriveImages(e.thrive_images)),e},getQuizTypeText:function(e){var t={text:ThriveQuizB.t.quiz_type_text_not_set,label:ThriveQuizB.t.quiz_type_text_not_set};switch(e){case ThriveQuizB.data.quiz_types.personality:t.text=ThriveQuizB.t.quiz_type_text_personality,t.label=ThriveQuizB.t.quiz_type_label_personality;break;case ThriveQuizB.data.quiz_types.number:t.text=ThriveQuizB.t.quiz_type_text_number,t.label=ThriveQuizB.t.quiz_type_label_number;break;case ThriveQuizB.data.quiz_types.percentage:t.text=ThriveQuizB.t.quiz_type_text_percentage,t.label=ThriveQuizB.t.quiz_type_label_percentage;break;case ThriveQuizB.data.quiz_types.right_wrong:t.text=ThriveQuizB.t.quiz_type_text_right_wrong,t.label=ThriveQuizB.t.quiz_type_label_right_wrong;break;case ThriveQuizB.data.quiz_types.survey:t.text=ThriveQuizB.t.quiz_type_text_survey,t.label=ThriveQuizB.t.quiz_type_label_survey}return t},url:function(){var e=ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=quiz");return this.get("ID")&&(e+="&ID="+this.get("ID")),e},getCode:function(){if(this.get("shortcode_code").length)return this.get("shortcode_code");var e="["+ThriveQuizB.shortcode_name+" id='"+this.get("ID")+"']";return this.set("shortcode_code",e),this.get("shortcode_code")},validate:function(e,t){var i=[];if(e.post_title||i.push(this.validation_error("post_title",ThriveQuizB.t.invalid_name)),i.length)return i},get_settings_step:function(){return this.get("type")?this.get("style")?void 0:"style":"type"},load_chart_data:function(e){return this.get("ID")?this.has("chart_data")?e.call(null,this.get("chart_data")):void t.ajax({url:this.url(),data:{custom:"chart_data",_nonce:ThriveQuizB.admin_nonce},type:"post",dataType:"json"}).done(_.bind((function(t){this.set("chart_data",t),e.call(null,this.get("chart_data"))}),this)).fail(_.bind((function(){e.call(null,null)}),this)):null},get_chart_dummy_data:function(){var e={conversions:[11,8,14,11,17,12,9,19,17,11,21,13,4],impressions:[64,58,89,85,93,75,74,83,88,72,90,82,27]};return e.labels=_.map((function(){return""}),_.range(e.impressions.length)),e},get_edit_route:function(){return"#dashboard/quiz/"+this.get("ID")},get_report_route:function(){return"#reports/"+this.get("ID")},resetStatistics:function(e){e=e||{};var i=_.extend({type:"post",dataType:"json",url:this.url()+"&custom=reset_statistics"},e);return t.ajax(i)},anonymizeResults:function(e){e=e||{};var i=_.extend({type:"post",dataType:"json",url:this.url()+"&custom=anonymize_results"},e);return t.ajax(i)},structure_set:function(){return this.get("page_variations")>0||this.get("structure").tge_question_number},hasBadge:function(){if(!this.get("thrive_images")instanceof ThriveQuizB.collections.ThriveImages)return!1;var e=this.get("thrive_images").first();return e&&null!==e.get("image_url")},hasQuestions:function(){return this.get("structure")&&parseInt(this.get("structure").tge_question_number)>0},hasResultLinks:function(){return this.get("structure")&&this.get("structure").results_page&&this.get("structure").results_page.links&&this.get("structure").results_page.links.length>0}}),ThriveQuizB.models.Page=ThriveQuizB.models.Base.extend({defaults:{ID:""},parse:function(e){return e.variations&&(e.variations=new ThriveQuizB.collections.Variations(e.variations)),e.archived_variations&&(e.archived_variations=new ThriveQuizB.collections.Variations(e.archived_variations)),e},url:function(){var e=ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=page");return this.get("ID")&&(e+="&ID="+this.get("ID")),e},checkVariationsContent:function(e,t){return this.customAction("check_variations_content",e,t)},customAction:function(e,i,s){if(e)return s||(s={}),t.ajax(_.extend({type:"post",dataType:"json",url:this.url()+"&custom_action="+e,data:s},i))}}),ThriveQuizB.models.Variation=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:"",quiz_id:"",page_id:"",parent_id:"",is_control:0,post_title:"",post_status:ThriveQuizB.data.variation_status.publish,state_order:"",cache_impressions:0,cache_optins:0,cache_optin_conversion_rate:"N/A",cache_social_shares:0,cache_social_share_conversion_rate:"N/A",content:""},validate:function(e,t){var i=[];if(e.post_title||e.default_name||i.push(this.validation_error("post_title",ThriveQuizB.t.invalid_name)),i.length)return i},url:function(){var e=ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=variation");return this.get("id")&&(e+="&id="+this.get("id")),e},resetStatistics:function(e,t){t||(t={});var i=_.extend({type:"post",dataType:"json",url:this.url()+"&custom_action=reset_statistics",data:t},e);return jQuery.ajax(i)},generateFirstVariation:function(e,t){t||(t={});var i=_.extend({type:"post",dataType:"json",url:this.url()+"&custom_action=generate_first_variation",data:t},e);return jQuery.ajax(i)},cloneVariation:function(e,t){t||(t={});var i=_.extend({type:"post",dataType:"json",url:this.url()+"&custom_action=clone_variation",data:t},e);return jQuery.ajax(i)},get_name:function(){var e;try{e=ThriveQuizB.data.quiz_structure_item_types[this.get("type")].name}catch(e){return this.get("name")}return e}}),ThriveQuizB.models.BreadcrumbLink=ThriveQuizB.models.Base.extend({defaults:{ID:"",hash:"",label:"",full_link:!1},initialize:function(e){this.get("ID")||this.set("ID",e.label.split(" ").join("").toLowerCase()),this.set("full_link",e.hash.match(/^http/))},get_url:function(){return this.get("full_link")?this.get("hash"):"#"+this.get("hash")}}),ThriveQuizB.collections.Base=Backbone.Collection.extend({last:function(){return this.at(this.size()-1)},first:function(){return this.at(0)}}),ThriveQuizB.collections.Quizzes=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Quiz,comparator:function(e){return parseInt(e.get("order"))},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=quizzes&start=0&end=15")}}),ThriveQuizB.collections.ReportQuizzes=ThriveQuizB.collections.Quizzes.extend({url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=quizzes&all_quizzes=1")}}),ThriveQuizB.collections.Breadcrumbs=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Base.extend({defaults:{hash:"",label:""}}),add_page:function(e,t){var i=new ThriveQuizB.models.BreadcrumbLink({hash:e,label:t});return this.add(i)}}),ThriveQuizB.models.Option=ThriveQuizB.models.Base.extend({defaults:{}}),ThriveQuizB.models.StructureItem=ThriveQuizB.models.Base.extend({defaults:{image:null,type:null,name:null,mandatory:!1,last:!1,viewed:!1},is_results_page:function(){return void 0!==this.get("results_page")},is_results_url:function(){return!1!==this.is_results_page()&&"url"===this.get("results_page").type}}),ThriveQuizB.models.Structure=ThriveQuizB.models.Base.extend({defaults:{splash:!1,qna:!1,optin:!1,results:!1},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=structure")}}),ThriveQuizB.collections.Options=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Option}),ThriveQuizB.models.ThriveImage=ThriveQuizB.models.Base.extend({defaults:{ID:"",state:"normal"},url:function(){var e=ajaxurl+"?action="+TIE.admin_ajax_controller+"&route=image&_nonce="+TIE.nonce;return parseInt(this.get("ID"))&&(e+="&ID="+this.get("ID")),e},get_bg_style:function(){var e="background-image: ",t=ThriveQuizB.globals.badge_templates.findWhere({key:this.get("settings").template});return this.get("image_url")?e+="url("+this.get("image_url")+")":e+="url("+t.get("thumb")+")",e}}),ThriveQuizB.collections.ThriveImages=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.ThriveImage}),ThriveQuizB.models.QuizStyle=ThriveQuizB.models.Base.extend({idAttribute:"ID",defaults:{ID:"",quiz_id:"",style:""},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=style")},validate:function(e,t){var i=[];if(e.style||i.push(this.validation_error("style",ThriveQuizB.t.invalid_name)),i.length)return i}}),ThriveQuizB.models.QuizHilightSettings=ThriveQuizB.models.Base.extend({defaults:{highlight_answer:1,load_next_question:0,highlight_and_show_feedback:0},initialize:function(e){e=e||{},"right_wrong"===this.get("quiz_type")&&e.hasOwnProperty("highlight_answer")&&!e.hasOwnProperty("highlight_and_show_feedback")&&1!==e.highlight_answer&&(this.attributes.load_next_question=1,this.attributes.highlight_answer=0)},getKeysToReset:function(){return this.defaults},resetValues:function(){_.each(this.getKeysToReset(),(function(e,t){this.attributes[t]=0}),this)}}),ThriveQuizB.models.QuizFeedbackSettings=ThriveQuizB.models.QuizHilightSettings.extend({defaults:{display_feedback:1,display_feedback_time:10,press_next:0},initialize:function(e){e=e||{},this.get("quiz_type")&&"right_wrong"!==this.get("quiz_type")&&!e.hasOwnProperty("display_feedback")&&(this.attributes.display_feedback=0)},getKeysToReset:function(){return{display_feedback:0,press_next:1,dont_display_feedback:1}}}),ThriveQuizB.models.QuizType=ThriveQuizB.models.Base.extend({idAttribute:"ID",defaults:{ID:"",type:"",results:[],minimum_results:2},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=type")},validate:function(e,t){var i=[],s=!1;if(e.display_feedback_time&&(isNaN(e.display_feedback_time)||e.display_feedback_time<=0))return TVE_Dash.err("The value must be a number greater than zero"),i;if(e.type&&e.type===ThriveQuizB.data.quiz_types.personality){if(e.results.length<e.minimum_results)s=!0;else{var r=[];e.results.each((function(e,t){e.get("text")&&r.push(e.get("text"))})),r.length<e.minimum_results&&(s=!0)}if(s)return i.push(ThriveQuizB.t.minimum_results_warning),i}},prepareForSave:function(){this.get("feedback_settings")instanceof Backbone.Model&&this.set({feedback_settings:this.get("feedback_settings").toJSON()},{silent:!0}),this.get("highlight_settings")instanceof Backbone.Model&&this.set({highlight_settings:this.get("highlight_settings").toJSON()},{silent:!0})}}),ThriveQuizB.models.Test=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:function(){return{id:"",item_ids:[],auto_win_min_conversions:100,auto_win_min_duration:14,auto_win_chance_original:95,conversion_goal:null,title:"",notes:"",page_id:null}},validate:function(e){var t=[];if(e.title||t.push(this.validation_error("test_title",ThriveQuizB.t.TestTitleRequired)),!e.conversion_goal&&e.is_results&&(t.push(this.validation_error("conversion_goal",ThriveQuizB.t.ConversionGoalRequired)),TVE_Dash.err(ThriveQuizB.t.ConversionGoalRequired)),e.auto_win_enabled&&(e.auto_win_min_conversions.length<=0?t.push(this.validation_error("auto_win_min_conversions",ThriveQuizB.t.AutoWinMinConversionsRequired)):(isNaN(e.auto_win_min_conversions)||e.auto_win_min_conversions<0||e.auto_win_min_conversions!=parseInt(e.auto_win_min_conversions,10))&&t.push(this.validation_error("auto_win_min_conversions",ThriveQuizB.t.PositiveIntegerNumber)),e.auto_win_min_duration.length<=0?t.push(this.validation_error("auto_win_min_duration",ThriveQuizB.t.AutoWinMinDurationRequired)):(isNaN(e.auto_win_min_duration)||e.auto_win_min_duration<0||e.auto_win_min_duration!=parseInt(e.auto_win_min_duration,10))&&t.push(this.validation_error("auto_win_min_duration",ThriveQuizB.t.PositiveIntegerNumber)),e.auto_win_chance_original.length<=0?t.push(this.validation_error("auto_win_chance_original",ThriveQuizB.t.AutoWinChanceOriginalRequired)):(isNaN(e.auto_win_chance_original)||e.auto_win_chance_original>100||e.auto_win_chance_original<0)&&t.push(this.validation_error("auto_win_chance_original",ThriveQuizB.t.PositivePercentNumber))),e.form_types&&e.form_types.length<2&&t.push(this.validation_error("form_types",ThriveQuizB.t.MinimumTwoFormTypesAreRequired)),t.length)return t},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=test&id="+this.get("id"))}}),ThriveQuizB.collections.Tests=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Test}),ThriveQuizB.models.TestItem=ThriveQuizB.models.Base.extend({defaults:{ID:"",active:1,conversions:0,id:null,impressions:0,is_control:0,is_winner:0,social_shares:0,stopped_date:null,test_id:null,variation_id:null},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=test_item")},getConversionRate:function(){var e=parseInt(this.get("impressions"))?parseInt(this.get("optins_conversions"))/parseInt(this.get("impressions"))*100:0;return(e=ThriveQuizB.util.roundNumber(e,3)).toFixed(2)},getPercentageImprovementColor:function(){var e=parseFloat(this.get("percentage_improvement"));return isNaN(e)?"":e<0?ThriveQuizB.data.colors.red:e>0?ThriveQuizB.data.colors.green:""}}),ThriveQuizB.collections.TestItems=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.TestItem,getTotals:function(){return{impressions:this.getTotalImpressions(),conversions:this.getTotalConversions(),conversions_rate:this.getConversionRate()}},getTotalImpressions:function(){var e=0;return _.each(this.models,(function(t){e+=parseInt(t.get("impressions"))})),e},getTotalConversions:function(){var e=0;return _.each(this.models,(function(t){e+=parseInt(t.get("optins_conversions"))})),e},getConversionRate:function(){var e=0!==this.getTotalImpressions()?this.getTotalConversions()/this.getTotalImpressions()*100:0;return e.toFixed(2)},getCandleStickData:function(){var e=[];_.each(this.models,(function(t){var i=parseInt(t.get("conversion_rate")),s=parseInt(t.get("impressions"));if(isNaN(i)||isNaN(s)||0===s)e.push([0,0]);else{var r=Math.round(100*Math.sqrt(i*(100-i)/s))/100;e.push([i-r,i+r])}}));var t=ThriveQuizB.data.colors.red,i=ThriveQuizB.data.colors.grey,s=ThriveQuizB.data.colors.green,r=e[0],n=[],a=[];return _.each(e,(function(e){var o=[],l=[];e[0]<r[0]?(l.push(t),o.push(e[0]),e[1]<r[0]?o.push(e[1]):e[1]<r[1]?(l.push(i),o.push(r[0]),o.push(e[1])):r[1]<e[1]&&(l.push(i),l.push(s),o.push(r[0]),o.push(r[1]),o.push(e[1]))):e[0]<r[1]?(l.push(i),o.push(e[0]),e[1]<=r[1]?o.push(e[1]):r[1]<e[1]&&(l.push(s),o.push(r[1]),o.push(e[1]))):r[1]<e[1]&&(l.push(s),o.push(e[0]),o.push(e[1])),n.push(o),a.push(l)})),{chartData:n,chartColors:a}},getHighestRateItem:function(){var e,t=0;return this.each((function(i){parseFloat(i.getConversionRate())>=t&&(e=i.get("id"),t=parseFloat(i.getConversionRate()))})),0===t?void 0:e}}),ThriveQuizB.models.QuizUserAnswer=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,question:"",answers:{}}}),ThriveQuizB.models.QuizUser=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,random_identifier:null,date_started:null,date_finished:null,social_badge_lin:null,email:null,points:null,quiz_id:null,completed_quiz:null}}),ThriveQuizB.models.Reporting=ThriveQuizB.models.Base.extend({defaults:{report_type:"completions",quiz_id:null,location:"all"},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=reporting")}}),ThriveQuizB.models.CompletionQuiz=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,name:"",count:null}}),ThriveQuizB.models.CompletionPagination=ThriveQuizB.models.Base.extend({defaults:{currentPage:null,pageCount:null,totalItems:null,itemsPerPage:null,pagesToDisplay:null}}),ThriveQuizB.collections.CompletionTableModel=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.CompletionQuiz}),ThriveQuizB.models.QuestionsReportItem=ThriveQuizB.models.Base.extend({defaults:{id:null,text:null,total:null,answers:{}}}),ThriveQuizB.collections.QuestionsReportItems=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.QuestionsReportItem}),ThriveQuizB.models.QuestionsReportAnswer=ThriveQuizB.models.Base.extend({defaults:{count:null,percent:null,text:null}}),ThriveQuizB.collections.QuestionsReportAnswers=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.QuestionsReportAnswer}),ThriveQuizB.collections.QuizUsers=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.QuizUser}),ThriveQuizB.collections.QuizUserAnswers=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.QuizUserAnswer,url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=user_answers")}}),ThriveQuizB.collections.QuizStyles=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Base}),ThriveQuizB.collections.Variations=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Variation}),ThriveQuizB.collections.Pages=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Page}),ThriveQuizB.models.UserQuestion=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:"",quiz_id:null,image:"",q_type:null,text:""}}),ThriveQuizB.collections.UserQuestions=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.UserQuestion}),ThriveQuizB.models.UserAnswer=ThriveQuizB.models.Base.extend({defaults:{question_id:"",quiz_id:null,image:"",result_id:null,text:"",chosen:!1},get_thumb_url:function(){var t="";return this.get("image")&&"object"===e(this.get("image"))&&this.get("image").sizes&&this.get("image").sizes.thumbnail&&this.get("image").sizes.thumbnail.url&&(t=this.get("image").sizes.thumbnail.url),"string"==typeof this.get("image")&&(t=this.get("image")),t}}),ThriveQuizB.collections.UserAnswers=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.UserAnswer}),ThriveQuizB.models.CompletionReport=ThriveQuizB.models.Base.extend({idAttribute:"ID",defaults:function(){return{interval:"day",chart_data:[],chart_title:"",chart_x_axis:[],chart_y_axis:""}}}),ThriveQuizB.models.ChartModel=ThriveQuizB.models.Base.extend({idAttribute:"ID",defaults:function(){return{interval:"day",chart_data:[],chart_title:"",chart_x_axis:[],chart_y_axis:""}},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=chartAPI&chart_type=testChart&id="+this.get("ID")+"&interval="+this.get("interval"))}}),ThriveQuizB.models.CompletionChartModel=ThriveQuizB.models.Base.extend({idAttribute:"quiz_id",defaults:function(){return{interval:"day",quiz_id:"",chart_data:[],chart_title:"",chart_x_axis:[],chart_y_axis:""}},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=completionchart&id="+this.get("id")+"&interval="+this.get("interval")+"&date="+this.get("date"))}}),ThriveQuizB.models.UsersList=ThriveQuizB.models.Base.extend({defaults:function(){return{current_page:1,total_items:null,per_page:10,total_pages:null,quiz_id:null,date_started:null,date_finished:null,progress:null,categories:[],location:"all"}},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=users_reporting")},validate:function(e){var t,i=[],s=[];if(e instanceof Backbone.Model&&"completed"===this.get("progress")&&void 0!==e.get("min")&&void 0!==e.get("max")&&(s=this.validateNumberInterval(e)),t=this.validateDate(),s&&s.length&&(i=i.concat(s)),t&&t.length&&(i=i.concat(t)),i.length)return i},validateNumberInterval:function(e){var t=[],i=this.get("result_min"),s=this.get("result_max"),r=e.get("max"),n=e.get("min");return void 0!==i&&(""===i&&t.push(ThriveQuizB.t.numeric_general_error),isNaN(i)&&t.push(ThriveQuizB.t.numeric_general_error),i<n&&t.push(ThriveQuizB.t.numeric_general_error),parseInt(i)>r&&t.push(ThriveQuizB.t.numeric_general_error),s&&i>s&&t.push(ThriveQuizB.t.numeric_general_error)),void 0!==s&&(""===s&&t.push(ThriveQuizB.t.numeric_general_error),isNaN(s)&&t.push(ThriveQuizB.t.numeric_general_error),s<n&&t.push(ThriveQuizB.t.numeric_general_error),s>r&&t.push(ThriveQuizB.t.numeric_general_error)),t},validateDate:function(){var e=[];return this.get("date_started")||this.get("date_finished")||!this.tqb_filters?this.get("date_started")&&this.get("date_finished")&&this.get("date_started")>this.get("date_finished")&&e.push(ThriveQuizB.t.invalid_date_interval):e.push(ThriveQuizB.t.date_not_selected),e}}),ThriveQuizB.models.FlowReport=ThriveQuizB.models.Base.extend({defaults:{splash:null,qna:null,optin:null,results:null,quiz_id:null}}),ThriveQuizB.models.FlowReportSection=ThriveQuizB.models.Base.extend({defaults:{type:"splash",data:null}}),ThriveQuizB.collections.BadgeTemplates=ThriveQuizB.collections.Base.extend({}),ThriveQuizB.models.Settings=ThriveQuizB.models.Base.extend({url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=settings")},defaults:{tqb_promotion_badge:1}}),ThriveQuizB.collections.PaginatedCollection=Backbone.Collection.extend({currentPage:1,perPage:10,totalItems:0,initialize:function(e){this.totalItems=e.length},pageInfo:function(){var e=(this.currentPage-1)*this.perPage,t={offset:e,startItem:e+1,stopItem:e+this.perPage>this.totalItems?this.totalItems:e+this.perPage,currentPage:this.currentPage,totalItems:this.totalItems,perPage:this.perPage,totalPages:Math.ceil(this.totalItems/this.perPage),pages:[],prev:!1,next:!1},i=[1];if(this.currentPage-2>2&&i.push("..."),this.currentPage>2)for(var s=this.currentPage-2;s<this.currentPage;s++)-1===i.indexOf(s)&&i.push(s);this.currentPage>1&&i.push(this.currentPage);for(var r=this.currentPage+1;r<=this.currentPage+2&&r<=t.totalPages;r++)i.push(r);return this.currentPage+2<t.totalPages-1&&i.push("..."),-1===i.indexOf(t.totalPages)&&i.push(t.totalPages),t.pages=i,this.currentPage>1&&(t.prev=!0),this.currentPage<t.totalPages&&(t.next=!0),t},getItems:function(){var e=this.pageInfo();return this.slice(e.offset,e.stopItem)},nextPage:function(){this.currentPage=this.currentPage+1,this.trigger("refresh")},previousPage:function(){this.currentPage=this.currentPage-1,this.trigger("refresh")},goToPage:function(e){e=parseInt(e),isNaN(e)&&(e=1),this.currentPage=e,this.trigger("refresh")}}),ThriveQuizB.models.ResultsSettings=ThriveQuizB.models.Base.extend({defaults:{display_message:!1,forward_results:!1},initialize:function(e){this.init_message(void 0!==e.message?e.message:void 0),this.init_links(void 0!==e.links?e.links:[])},parse:function(e){return e&&e.links&&(this.init_links(e.links),delete e.links),this.init_message(e.message),delete e.message,e},init_message:function(e){if(this.get("message")instanceof ThriveQuizB.models.RedirectMessage)return this.get("message").set(e);this.set("message",new ThriveQuizB.models.RedirectMessage(e))},init_links:function(e){this.set("links",new ThriveQuizB.collections.RedirectLinks(Array.isArray(e)?e:[]))},validate:function(){if(!1===this.get("message").isValid())return this.get("message").validationError},url:function(){var e=ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=resultspage");return this.get("ID")&&(e+="&ID="+this.get("ID")),e}}),ThriveQuizB.models.RedirectLink=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{type:"local"},url:function(){var e=ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=redirectlink");return this.get("id")&&(e+="&id="+this.get("id")),e},validate:function(e,t){e=e||{};var i=ThriveQuizB.t.redirect_link.errors,s=parseInt(e.lower_bound),r=parseInt(e.upper_bound);return void 0!==e.quiz_id&&e.quiz_id?void 0!==e.page_id&&e.page_id?"local"!==e.type&&"external"!==e.type?"Something went wrong: link type not set":isNaN(s)?i.invalid_lower_bound:s<t.minimum_result?i.lower_bound_lower_than_minimum_result:s>t.maximum_result?i.lower_bound_greater_than_maximum_result:isNaN(r)?i.invalid_upper_bound:r>t.maximum_result?i.upper_bound_greater_than_maximum_result:r<t.minimum_result?i.upper_bound_lower_than_minimum_result:r<s?i.lower_bound_greater_than_upper_bound:"external"===e.type&&(!e.link||e.link.length<=0)?i.url_not_set:"external"!==e.type||this.isValidURL(e.link)?"local"!==e.type||e.post_id?void 0:i.no_content:i.invalid_url:"Something went wrong: page is not set":"Something went wrong: quiz is not set"},isValidURL:function(e){try{return new URL(e),!0}catch(e){return!1}},isLast:function(){return parseInt(this.collection.last().get("id"))===parseInt(this.get("id"))},isFirst:function(){return parseInt(this.collection.first().get("id"))===parseInt(this.get("id"))},reset_target:function(){this.set({post_id:null,link:null},{silent:!0})},setLowerBound:function(e){e=parseInt(e)||0,this.set("lower_bound",e);var t=this.prev();if(t)return e<=t.get("lower_bound")?(t.set("status","invalid"),t.set("lower_bound",0),void t.setLowerBound(e)):void(e<=t.get("upper_bound")&&(t.setUpperBound(e-1),t.set("status","valid")))},setUpperBound:function(e){e=parseInt(e)||0,this.set("upper_bound",e);var t=this.next();if(t)return e>=t.get("upper_bound")?(t.set("status","invalid"),t.set("lower_bound",0),void t.setUpperBound(e)):void(t.get("lower_bound")<=e&&(t.setLowerBound(e+1),t.set("status","valid")))},prev:function(){var e=this.collection.indexOf(this);return e>0?this.collection.at(e-1):null},next:function(){var e=this.collection.indexOf(this);return e<this.collection.length-1?this.collection.at(e+1):null}}),ThriveQuizB.collections.RedirectLinks=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.RedirectLink,initialize:function(e){return e},comparator:function(e){return e.get("lower_bound")},save:function(){new ThriveQuizB.collections.RedirectLinksWrapper({links:this}).save()},validate:function(e){if(e=e instanceof Backbone.Model?e:new Backbone.Model,this.length<=0)return!1;if(this.where({status:"invalid"}).length>0)return!1;if("personality"!==e.get("quiz_type")){var t=this.findWhere({lower_bound:parseInt(e.get("minimum_result"))}),i=this.findWhere({upper_bound:parseInt(e.get("maximum_result"))});if(void 0===t||void 0===i)return!1}return!0}}),ThriveQuizB.collections.RedirectLinksWrapper=Backbone.Model.extend({url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=redirectlink&custom=bulk_save")}}),ThriveQuizB.models.RedirectMessage=ThriveQuizB.models.Base.extend({defaults:{title:ThriveQuizB.t.redirect_message.title,text:ThriveQuizB.t.redirect_message.message,duration:3},validate:function(e){var t=parseInt(e.duration),i=e.title||"",s=e.text||"",r=ThriveQuizB.t.redirect_message.errors;return isNaN(t)||t<1||t>10?r.invalid_duration:i.length<=0?r.invalid_title:s.length<=0?r.invalid_text:void 0}})}))})(),ThriveQuizB.views=ThriveQuizB.views||{},(e=jQuery)((function(){Backbone.View.prototype.tvd_clear_errors=function(){return this.$(".tvd-invalid").removeClass("tvd-invalid"),this.$("select").trigger("tvdclear"),this},e(document).keypress((function(e){13!=e.which&&13!=e.keyCode||jQuery("a").is(":focus")||jQuery(".tqb-detele-structure-card-modal").is(":visible")&&jQuery(".tqb-detele-structure-card-action").focus().click()})),Backbone.View.prototype.tvd_show_errors=function(t){if(t=t||this.model){var i=t instanceof Backbone.Model?t.validationError:t,s=this,r=e();return Array.isArray(i)?_.each(i,(function(e){n(e)})):n(i),r.not(".tvd-no-focus").first().focus(),this.scroll_first_error(r.first()),this}function n(t){if("string"==typeof t)return TVE_Dash.err(t);r=r.add(s.$("[data-field="+t.field+"]").addClass("tvd-invalid").each((function(){var i=e(this);i.is("select")?i.trigger("tvderror",t.message):i.next("label").attr("data-error",t.message)})))}},Backbone.View.prototype.scroll_first_error=function(e){if(!(this instanceof TVE_Dash.views.Modal&&e.length))return this;var t=e.offset().top,i=this.$_content.offset().top,s=this.$_content.scrollTop(),r=this.$_content.outerHeight();if(t>=i&&t<r+i-50)return this;this.$_content.animate({scrollTop:s+t-i-40},200,"swing")},ThriveQuizB.views.Base=Backbone.View.extend({render:function(){return this},modal:function(e,t){return TVE_Dash.modal(e,t)},bind_zclip:function(){TVE_Dash.bindZClip(this.$el.find("a.tvd-copy-to-clipboard"))}}),ThriveQuizB.views.Dashboard=ThriveQuizB.views.Base.extend({className:"tvd-container",template:TVE_Dash.tpl("dashboard"),events:{"click .tqb-add-quiz-dashboard":"addNew","click .tqb-import-quiz":"import"},addNew:function(){return this.modal(ThriveQuizB.views.ModalNewQuiz,{model:new ThriveQuizB.models.Quiz({}),collection:this.collection,className:"tvd-modal tvd-qt-modal",width:"90%","max-width":"700px",in_duration:200,out_duration:0,templates:new Backbone.Collection(ThriveQuizB.quiz_templates)}),this},render:function(){this.$el.html(this.template({}));var e=new ThriveQuizB.views.QuizList({el:this.$("#tqb-quiz-list"),collection:this.collection}),t=new ThriveQuizB.views.Pagination({el:this.$(".tqb-load-more-section"),collection:this.collection,$quiz_list:this.$("#tqb-quiz-list")});return ThriveQuizB.quizzes_details.quizzes_number<ThriveQuizB.quizzes_details.max_quiz_number&&(ThriveQuizB.quizzes_details.quizzes_number=ThriveQuizB.quizzes_details.quizzes_displayed),e.render(),t.render(),this.search(),TVE_Dash.hideLoader(),this},search:function(){var e=this.$(".tqb-search-quiz"),t=new Backbone.Model({placeholder:ThriveQuizB.t.search_quizzes,label:ThriveQuizB.t.quiz_name,required:!1}),i=new ThriveQuizB.views.TextSearch({model:t,collection:this.collection,tagName:"div",dashboard_el:this.$el});e.prepend(i.render().$el),i.focus()},import:function(){this.modal(ThriveQuizB.views.ModalImportQuiz,{})}}),ThriveQuizB.views.Pagination=ThriveQuizB.views.Base.extend({className:"tqb-load-more-section",events:{"click .tqb-load-all":"loadAll","click .tqb-load-more":"loadMore"},initialize:function(e){this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",this.render),this.$quiz_list=e.$quiz_list},render:function(){TVE_Dash.showLoader();var e=ThriveQuizB.quizzes_details.quizzes_displayed,t=ThriveQuizB.quizzes_details.quizzes_number,i=ThriveQuizB.quizzes_details.max_quiz_number,s=t-e,r=this.$el.find(".tqb-remaining-quizzes");t&&t!==e?(r.text(s+" "+ThriveQuizB.t.more_quizzes),i<=s&&(s=i),ThriveQuizB.quizzes_details.to_be_loaded=s,this.$el.find(".tqb-load-more").text(ThriveQuizB.t.load_more.replace("%d",s))):this.$el.addClass("tvd-hide"),TVE_Dash.hideLoader()},loadAll:function(){TVE_Dash.showLoader();var t=this;return e.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quizzes",start:ThriveQuizB.quizzes_details.quizzes_displayed,end:ThriveQuizB.quizzes_details.quizzes_number,_nonce:ThriveQuizB.admin_nonce}}).done((function(e){for(var i in e){var s=e[i].ID,r=new ThriveQuizB.models.Quiz;ThriveQuizB.shown_quizzes.visible[s]=!0,e[i].tqb_quiz_source="add",r.set(e[i]),t.collection.add(r)}ThriveQuizB.quizzes_details.quizzes_displayed=ThriveQuizB.quizzes_details.quizzes_number,t.render(),TVE_Dash.hideLoader()})),this},loadMore:function(){TVE_Dash.showLoader();var t=this,i=ThriveQuizB.quizzes_details.quizzes_displayed,s=i+ThriveQuizB.quizzes_details.to_be_loaded;return e.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quizzes",start:i,end:s,_nonce:ThriveQuizB.admin_nonce}}).done((function(e){for(var i in e){var s=e[i].ID,r=new ThriveQuizB.models.Quiz;ThriveQuizB.shown_quizzes.visible[s]=!0,e[i].tqb_quiz_source="add",r.set(e[i]),t.collection.add(r)}ThriveQuizB.quizzes_details.quizzes_displayed+=ThriveQuizB.quizzes_details.to_be_loaded,t.render(),TVE_Dash.hideLoader()})),this}}),ThriveQuizB.views.QuizList=ThriveQuizB.views.Base.extend({events:{"click .tqb-add-quiz":"addNew"},itemViews:[],initialize:function(){this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",(function(e){if(!_.isEmpty(e.get("tqb_quiz_source")))switch(e.get("tqb_quiz_source")){case"clone":this.renderClone(e);break;case"add":this.renderOne(e),this.updateOrder()}}))},render:function(){function t(t,i){var s=e(i.placeholder),r=s.prevAll().not(i.item).length+1;s.html("<div class='tqb-inside-placeholder'><span>"+r+(ThriveQuizB.t.n_suffix[r]?ThriveQuizB.t.n_suffix[r]:ThriveQuizB.t.n_th)+" "+ThriveQuizB.t.priority+"</span></div>")}return this.$el.find(".tqb-quiz-item").remove(),this.itemViews=[],this.collection.each(this.renderOne,this),this.$el.sortable({placeholder:"ui-sortable-placeholder",items:".tqb-quiz-item",forcePlaceholderSize:!0,handle:".tqb-drag-card",update:_.bind(this.updateOrder,this),tolerance:"pointer",change:t,start:function(i,s){t(0,s),e("body").addClass("tqb-sorting")},stop:function(){setTimeout((function(){e("body").removeClass("tqb-sorting")}),200)}}),this},updateOrder:function(){var t={};_.each(this.itemViews,(function(e){e.model.get("order")!=e.$el.index()&&(e.model.set("order",e.$el.index()),t[e.model.get("ID")]=e.$el.index())})),this.collection.sort(),e.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quiz",custom:"update_order",new_order:t,_nonce:ThriveQuizB.admin_nonce}})},renderOne:function(e){var t=this.$el.find(".tqb-quiz-item").last(),i=new ThriveQuizB.views.Quiz({model:e,collection:this.collection});return!!ThriveQuizB.shown_quizzes.visible[e.get("ID")]&&(t.length?t.after(i.render().$el):this.$el.prepend(i.render().$el),this.itemViews.push(i),this)},addNew:function(){return this.modal(ThriveQuizB.views.ModalNewQuiz,{model:new ThriveQuizB.models.Quiz({}),collection:this.collection,className:"tvd-modal tvd-qt-modal",width:"90%","max-width":"700px",in_duration:200,out_duration:0,templates:new Backbone.Collection(ThriveQuizB.quiz_templates)}),this},renderClone:function(e){var t=new ThriveQuizB.views.Quiz({model:e,collection:this.collection});if(this.$el.prepend(t.render().$el),this.itemViews.push(t),ThriveQuizB.quizzes_details.quizzes_displayed!==ThriveQuizB.quizzes_details.quizzes_number&&this.$el.find(".tqb-quiz-item").length%ThriveQuizB.quizzes_details.max_quiz_number==1){var i=this.$el.find(".tqb-quiz-item").last(),s=i.find(".tqb-copy-shortcode").attr("data-id");i.remove(),this.collection.remove(this.collection.get(parseInt(s)),{silent:!0}),this.itemViews=this.itemViews.filter((function(e){return e.model.get("ID")!==parseInt(s)}))}return this.updateOrder(),this}}),ThriveQuizB.views.Quiz=ThriveQuizB.views.Base.extend({initialize:function(){this.listenTo(this.model,"change:state",this.renderState)},render:function(){return this.renderState(),this},renderState:function(){var e=this.model.get("state");if(ThriveQuizB.views["Quiz"+TVE_Dash.upperFirst(e)+"State"]){var t=new(ThriveQuizB.views["Quiz"+TVE_Dash.upperFirst(e)+"State"])({model:this.model,collection:this.collection});t.render(),this.$el.replaceWith(t.$el),this.setElement(t.$el)}}}),ThriveQuizB.views.QuizNormalState=ThriveQuizB.views.Base.extend({className:"tvd-col tvd-s6 tvd-ms6 tvd-m4 tvd-l3 tqb-quiz-item",template:TVE_Dash.tpl("quiz/item"),events:{"click .tqb-delete-quiz":"setDeleteState","click .tqb-edit-quiz-title":"editTitle","click .tqb-copy-shortcode":"copyShortcodeModal","click .tqb-clone-quiz":"cloneQuiz"},render:function(){return this.$el.html(this.template({item:this.model})),this.$quizTitle=this.$(".tvd-card-title"),this},setDeleteState:function(){this.$el.live_tooltip("destroy");var e=this.collection.findWhere({state:"delete"});e&&e.set("state",ThriveQuizB.util.states.normal),this.model.set("state",ThriveQuizB.util.states.delete)},editTitle:function(){var e=this,t=this.$(".tqb-edit-quiz-title"),i=new Backbone.Model({value:this.model.get("post_title"),label:ThriveQuizB.t.quiz_name,required:!0});t.hide();var s=new ThriveQuizB.views.TextEdit({model:i,tagName:"div"});this.$quizTitle.hide().after(s.render().$el),i.on("change:value",(function(){e.saveTitle.apply(e,arguments),s.remove(),e.$quizTitle.show(),t.show()})),i.on("tqb_no_change",(function(){e.$quizTitle.html(e.model.get("post_title")).show(),s.remove(),t.show()})),s.focus()},saveTitle:function(e,t){var i=this;this.model.set("post_title",t),this.model.save(null,{success:function(){i.$quizTitle.html(t),TVE_Dash.success(ThriveQuizB.t.quiz_title_save_success_toast)},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_title_save_fail_toast)}})},copyShortcodeModal:function(){this.modal(ThriveQuizB.views.ModalCopyShortcode,{item:this.model,width:"800px"})},cloneQuiz:function(){TVE_Dash.showLoader();var t=this.model,i=t.clone(),s=this,r={};e.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quiz",custom:"clone_current",quiz_id:t.get("ID"),_nonce:ThriveQuizB.admin_nonce}}).done((function(e){if(_.isNumber(e)){var n=ThriveQuizB.shown_quizzes.order[ThriveQuizB.quizzes_details.quizzes_displayed-1];r={completed_count:0,comment_count:0,social_shares:0,subscribers:0,users_started:0,post_title:"["+ThriveQuizB.t.copy+"] "+t.get("post_title"),order:0,menu_order:0,ID:e,tqb_quiz_source:"clone"},i.set(r),ThriveQuizB.quizzes_details.quizzes_number===ThriveQuizB.quizzes_details.quizzes_displayed||ThriveQuizB.quizzes_details.quizzes_displayed<ThriveQuizB.quizzes_details.quizzes_displayed.max_quiz_number?ThriveQuizB.quizzes_details.quizzes_displayed+=1:ThriveQuizB.shown_quizzes.visible[n]=!1,ThriveQuizB.quizzes_details.quizzes_number+=1,s.collection.unshift(i),ThriveQuizB.shown_quizzes.visible[e]=!0,TVE_Dash.success(ThriveQuizB.t.clone_quiz_success)}else TVE_Dash.err(ThriveQuizB.t.clone_quiz_error)})).fail((function(){TVE_Dash.err(ThriveQuizB.t.clone_quiz_error)})).always((function(){TVE_Dash.hideLoader()}))},chart:function(e){var t=!0,i=this.$(".tqb-chart-no-data").clone();(!e||e.impressions.length<2)&&(t=!1,e=this.model.get_chart_dummy_data());var s=[{title:{text:ThriveQuizB.t.no_of_impressions}}],r=[{name:ThriveQuizB.t.impressions,type:"line",data:e.impressions}];e.conversions&&(s.push({labels:{format:"{value}"},title:{text:ThriveQuizB.t.no_of_conversions},opposite:!0}),r.push({name:ThriveQuizB.t.conversions,type:"line",yAxis:1,data:e.conversions,tooltip:{valueSuffix:""}})),setTimeout(_.bind((function(){this.$(".tqb-quiz-chart").highcharts({colors:t?["#3498db","#47bb28"]:["#fff","#fff"],credits:{enabled:!1},plotOptions:{line:{marker:{enabled:!1}}},title:{text:" "},xAxis:{categories:e.labels,labels:{enabled:!1}},yAxis:s,tooltip:{shared:!0},legend:{enabled:!1},series:r}),t||this.$(".tqb-quiz-chart").addClass("tvd-relative tqb-blurred").append(i.removeClass("tvd-hide"))}),this))}}),ThriveQuizB.views.QuizDeleteState=ThriveQuizB.views.Base.extend({className:"tvd-col tvd-s6 tvd-m4 tvd-ms6 tvd-l3 tqb-quiz-item",template:TVE_Dash.tpl("quiz/delete-state"),events:{"click .tqb-delete-no":function(){this.model.set("state",ThriveQuizB.util.states.normal)},"click .tqb-delete-yes":"yes",keydown:"keyAction"},initialize:function(){this.listenTo(this.collection,"remove",this.remove)},render:function(){this.$el.html(this.template({item:this.model}));var e=this;return _.defer((function(){e.$(".tve-delete-quiz-card").focus()})),this},keyAction:function(e){var t=e.which;13==t?this.yes():27==t&&this.model.set("state",ThriveQuizB.util.states.normal)},yes:function(){var t=this,i=this.model.get("ID");TVE_Dash.cardLoader(this.$el),this.model.destroy({wait:!0,success:function(){TVE_Dash.success(ThriveQuizB.t.quiz_deleted_success_toast),ThriveQuizB.util.showHideNoQuizInfo(),ThriveQuizB.quizzes_details.quizzes_number-=1,delete ThriveQuizB.shown_quizzes.visible[i],ThriveQuizB.quizzes_details.quizzes_number+1<=ThriveQuizB.quizzes_details.quizzes_displayed?ThriveQuizB.quizzes_details.quizzes_displayed-=1:e.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quizzes",start:ThriveQuizB.quizzes_details.quizzes_displayed-1,end:ThriveQuizB.quizzes_details.quizzes_displayed-1,_nonce:ThriveQuizB.admin_nonce}}).done((function(e){var i=e[0].ID,s=new ThriveQuizB.models.Quiz;ThriveQuizB.shown_quizzes.visible[i]=!0,e[0].tqb_quiz_source="add",s.set(e[0]),t.collection.add(s)})),ThriveQuizB.globals.quizzes.length<ThriveQuizB.quizzes_details.max_quiz_number&&e("#tqb-no-search-result, .tqb-load-more-section").hide()},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_deleted_fail_toast)}})}}),ThriveQuizB.views.EditQuiz=ThriveQuizB.views.Base.extend({className:"tvd-container",template:TVE_Dash.tpl("quiz/edit"),events:{"click .tqb-edit-quiz-title":"editTitle","click .tqb-quiz-action":"handleAction","click #tqb-export-quiz-button":"onExportClicked"},initialize:function(){this.model.on("tqb_style_changed",_.bind((function(){this.model.get("type")&&this.check_structure(),this.render()}),this)),this.listenTo(this.model,"change:type",(function(e){this.model.get("style")&&this.check_structure(),this.render()}),this),this.listenTo(this.model.get("thrive_images"),"add",this.render_badge_card)},render:function(){this.$el.html(this.template({item:this.model})),this.$quizTitle=this.$(".tqb-quiz-title"),this.model.get("style")&&this.model.get("type")&&this.renderStructure(),this.render_type_card(),this.render_style_card(),this.render_badge_card(),this.model.hasQuestions()&&(this.$(".tqb-export-quiz").removeClass("tqb-disabled"),this.$(".tqb-export-container").removeClass("tvd-tooltipped"));var t=this;return this.model.get("wizard_complete")||this.model.get("type")&&this.model.get("style")&&this.model.get("structure").viewed&&this.model.get("structure").viewed.results&&this.model.get("structure").tge_question_number>0&&e.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quiz",custom:"wizard_complete",ID:this.model.get("ID"),_nonce:ThriveQuizB.admin_nonce},success:function(e){e&&(t.model.set("wizard_complete",1),TVE_Dash.success(ThriveQuizB.t.wizard_complete))}}),this.bind_zclip(),TVE_Dash.materialize(this.$el),this},check_structure:function(){this.model.get("structure").length||this.renderStructure(!0)},render_type_card:function(){this.$(".tqb-quiz-action").text(this.model.structure_set()?ThriveQuizB.t.quiz_settings:ThriveQuizB.t.change_type);var e=this.model.getQuizTypeText(this.model.get("type")),t=ThriveQuizB.data.quiz_types.survey===this.model.get("type")&&this.model.structure_set();this.$el.find(".tqb-quiz-type").text(e.label),this.$el.find(".tqb-quiz-card-summary").text(e.text),this.$el.find(".tqb-logo-holder i").attr("id",this.model.get("type")),this.$(".tqb-quiz-action, .tqb-quiz-description").toggleClass("tqb-hide",t)},render_style_card:function(){var e=new ThriveQuizB.views.QuizStyle({model:this.model,collection:new ThriveQuizB.collections.QuizStyles(ThriveQuizB.quiz_styles)});this.$("#tqb-quiz-style-card").html(e.render().$el)},render_badge_card:function(){var e=this.$("#tqb-badge-card");new ThriveQuizB.views.Badge({el:e,model:this.model.get("thrive_images").first(),collection:this.model.get("thrive_images"),quiz_type:this.model.get("type")}).render()},renderStructure:function(e){var t=this;if(this.model.get("style")){var i,s=null;(i=this.model.get("structure")).quiz_type=this.model.get("type"),i.style=parseInt(this.model.get("style")),this.structure_view&&this.structure_view.remove(),void 0!==i.ID?(s=new ThriveQuizB.models.Structure(i),this.structure_view=new ThriveQuizB.views.QuizStructure({model:s}),this.$el.find("#tqb-quiz-structure-row").append(this.structure_view.render().$el),setTimeout((function(){ThriveQuizB.util.bind_wistia()}),0)):(ThriveQuizB.quiz_templates.forEach((function(e,s){e.id===t.model.get("tpl")&&(i=e)})),"survey"===this.model.get("type")&&(i.splash=!0),i.ID=t.model.get("ID"),s=new ThriveQuizB.models.Structure(i),e&&s.save(null,{success:function(e,i){e.attributes.quiz_type=t.model.get("type"),t.structure_view=new ThriveQuizB.views.QuizStructure({model:e}),t.$el.find("#tqb-quiz-structure-row").append(t.structure_view.render().$el),t.model.set("structure",i),TVE_Dash.materialize(t.$el),setTimeout((function(){ThriveQuizB.util.bind_wistia()}),0)},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_structure_save_fail_toast)}}))}},editTitle:function(){var e=this,t=this.$el.find(".tqb-edit-quiz-title"),i=new Backbone.Model({value:this.model.get("post_title"),label:ThriveQuizB.t.quiz_name,required:!0});t.hide(),i.on("change:value",(function(){e.saveTitle.apply(e,arguments),e.$quizTitle.show(),s.remove(),t.show()})),i.on("tqb_no_change",(function(){e.$quizTitle.html(e.model.get("post_title")).show(),s.remove(),t.show()}));var s=new ThriveQuizB.views.TextEdit({model:i,tagName:"div"});this.$quizTitle.hide().after(s.render().$el),s.focus()},handleAction:function(){this.model.structure_set()?this.openSettingsModal(this._getModalModel()):this.modal(ThriveQuizB.views.ModalEditQuizType,this._getModalArgs())},_getModalModel:function(){return new ThriveQuizB.models.QuizType({ID:this.model.get("ID"),type:this.model.get("type"),results:this.model.get("results"),feedback_settings:new ThriveQuizB.models.QuizFeedbackSettings(_.extend(this.model.get("feedback_settings"),{quiz_type:this.model.get("type")})),highlight_settings:new ThriveQuizB.models.QuizHilightSettings(_.extend(this.model.get("highlight_settings"),{quiz_type:this.model.get("type")}))})},_getModalArgs:function(){var e,t=0;if(this.model.structure_set())switch(e=!0,this.model.get("type")){case ThriveQuizB.data.quiz_types.personality:t=1;break;case ThriveQuizB.data.quiz_types.right_wrong:t=2}return{model:this._getModalModel(),quiz_model:this.model,types:new Backbone.Collection(ThriveQuizB.quiz_types),width:"90%","max-width":"980px",modal_step:t,edit_mode:e}},openSettingsModal:function(e){e=e instanceof ThriveQuizB.models.QuizType?e:new ThriveQuizB.models.QuizType,this.modal(ThriveQuizB.views.QuizSettings,{model:e,quiz_model:this.model,width:"800px","max-width":"60%"})},saveTitle:function(e,t){var i=this;this.model.set({post_title:t}),this.model.save(null,{success:function(e,s){i.$quizTitle.html(t);try{var r=ThriveQuizB.globals.quizzes.findWhere({ID:i.model.get("ID")});r instanceof ThriveQuizB.models.Quiz&&r.set("post_title",t)}catch(e){console.log("Error: "+e)}TVE_Dash.success(ThriveQuizB.t.quiz_title_save_success_toast)},error:function(e,t){TVE_Dash.err(ThriveQuizB.t.quiz_title_save_fail_toast)}})},onExportClicked:function(){this.modal(ThriveQuizB.views.ModalExportQuiz,{title:ThriveQuizB.t.export_quiz+" "+this.model.get("post_title"),"max-width":"50%",dismissible:!1,model:this.model})}}),ThriveQuizB.views.TextEdit=ThriveQuizB.views.Base.extend({className:"tvd-input-field tqb-inline-edit",template:TVE_Dash.tpl("textedit"),events:{"keyup input":"keyup","change input":function(){return e.trim(this.input.val())?(this.model.set("value",this.input.val()),!1):(this.input.addClass("tvd-invalid"),!1)},"blur input":function(){this.model.trigger("tqb_no_change")}},keyup:function(e){27===e.which&&this.model.trigger("tqb_no_change")},render:function(){return this.$el.html(this.template({item:this.model})),this.input=this.$("input"),this},focus:function(){this.input.focus().select()}}),ThriveQuizB.views.TextSearch=ThriveQuizB.views.TextEdit.extend({show_pagination:!1,className:"tvd-input-field tqb-inline-search",template:TVE_Dash.tpl("search"),events:{"keyup input":"keyup","click svg":function(){this.input.val()&&this.request_search()}},initialize:function(e){this.dashboard_el=e.dashboard_el,this.listenTo(this.collection,"reset",_.bind((function(e){this.dashboard_el.find(".tqb-load-more-section").toggleClass("tvd-hide",!this.show_pagination),this.dashboard_el.find("#tqb-quiz-list .tvd-card-new").toggleClass("tvd-hide",!this.show_pagination),e.length?this.dashboard_el.find("#tqb-no-search-result").hide():this.dashboard_el.find("#tqb-no-search-result").show(),TVE_Dash.hideLoader()}),this))},keyup:_.debounce((function(e){_.isEmpty(this.input.val())&&8===e.keyCode?this.restore_quizzes():_.isEmpty(this.input.val())||!/[a-zA-Z0-9!@#$&()\[\]\\-`.+,/\"]/i.test(e.key)&&8!==e.keyCode&&13!==e.keyCode||this.request_search()}),1e3),request_search:function(){var t=this;TVE_Dash.showLoader(),e.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quizzes",search_title:this.input.val(),_nonce:ThriveQuizB.admin_nonce}}).done((function(e){for(var i in e){var s=e[i].ID;ThriveQuizB.shown_quizzes.visible[s]=!0,e[i].tqb_quiz_source="search"}t.show_pagination=!1,t.collection.reset(e)})).always((function(){TVE_Dash.hideLoader()}))},restore_quizzes:function(){TVE_Dash.showLoader();var t=this;e.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quizzes",start:0,end:ThriveQuizB.quizzes_details.max_quiz_number,_nonce:ThriveQuizB.admin_nonce}}).done((function(e){for(var i in e){var s=e[i].ID;ThriveQuizB.shown_quizzes.visible[s]=!0,e[i].tqb_quiz_source="search"}t.show_pagination=ThriveQuizB.quizzes_details.quizzes_number>ThriveQuizB.quizzes_details.max_quiz_number,t.collection.reset(e)})).always((function(){TVE_Dash.hideLoader()}))}}),ThriveQuizB.views.Breadcrumbs=ThriveQuizB.views.Base.extend({el:e("#tqb-breadcrumbs-wrapper")[0],template:TVE_Dash.tpl("breadcrumbs"),initialize:function(){this.$title=e("head > title"),this.original_title=this.$title.html(),this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"add",this.render)},render:function(){this.$el.empty().html(this.template({links:this.collection}))}}),ThriveQuizB.views.Badge=ThriveQuizB.views.Base.extend({initialize:function(e){this.quiz_type=e.quiz_type,this.listenTo(this.model,"change:state",this.render_state)},render:function(){this.render_state()},render_state:function(){var e;e=this.model&&this.model.get("settings").template?this.model.get("state"):"survey"===this.quiz_type?"unavailable":"add";var t="Badge"+TVE_Dash.upperFirst(e)+"State";if(ThriveQuizB.views[t]){var i=new ThriveQuizB.views[t]({model:this.model,collection:this.collection});i.render(),this.$el.replaceWith(i.$el),this.setElement(i.$el)}}}),ThriveQuizB.views.BadgeNormalState=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("badge/card"),className:"tvd-col tvd-s12 tvd-m4 tvd-l4",id:"tqb-badge-card",events:{"click #tqb-remove-badge":"remove"},render:function(){return this.$el.html(this.template({item:this.model})),this},remove:function(){this.model.set("state","delete")}}),ThriveQuizB.views.BadgeAddState=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("badge/add"),className:"tvd-col tvd-s12 tvd-m4 tvd-l4 tvd-pointer",id:"tqb-badge-card",events:{"click #tqb-add-badge":"add_badge"},initialize:function(e){this.quiz_type=e.quiz_type},render:function(){return this.$el.html(this.template({item:this.model})),this},add_badge:function(){this.model||this.modal(ThriveQuizB.views.ModalBadgeTemplates,{collection:this.collection,"max-width":"80%"})}}),ThriveQuizB.views.BadgeUnavailableState=ThriveQuizB.views.BadgeAddState.extend({render:function(){return this.$el.html(this.template({item:this.model})),this.$(".tqb-new-button").removeAttr("data-tooltip").removeClass("tvd-tooltipped"),this.$(".tvd-card-content").addClass("tqb-disabled"),this.$el.append('<div class="tqb-no-badge"><b class="tqb-title">'+ThriveQuizB.t.unavailableBadgeTitle+'</b><p class="tqb-info">'+ThriveQuizB.t.unavailableBadge+"</p></div>"),this}}),ThriveQuizB.views.BadgeDeleteState=ThriveQuizB.views.Base.extend({className:"tvd-col tvd-s12 tvd-m4 tvd-l4",template:TVE_Dash.tpl("badge/delete"),id:"tqb-badge-card",events:{"click .tqb-delete-no":function(){this.model.set("state",ThriveQuizB.util.states.normal)},"click .tqb-delete-yes":"yes",keydown:"keyAction"},render:function(){return this.$el.html(this.template({item:this.model})),this},keyAction:function(e){var t=e.which;13==t?this.yes():27==t&&this.model.set("state",ThriveQuizB.util.states.normal)},yes:function(){var e=this;TVE_Dash.cardLoader(this.$el);var t=new ThriveQuizB.models.ThriveImage({post_parent:ThriveQuizB.globals.quiz.get("ID")});this.model.destroy({wait:!0,success:function(){t.save(null,{success:function(t,i,s){e.collection.push(t),TVE_Dash.success(ThriveQuizB.t.badge_deleted_success)}})}})}}),ThriveQuizB.views.QuizStyle=ThriveQuizB.views.Base.extend({className:"tvd-card",events:{click:"editQuizStyle"},render:function(){return 0===this.model.get("style").length?this.render_new_button():this.render_card_content(),this.model.on("change:structure",this.render_card_content,this),TVE_Dash.materialize(this.$el),this},render_card_content:function(){var e=TVE_Dash.tpl("quiz/style/card");this.$el.html(e({model:this.collection.findWhere({id:this.model.get("style")}),qna_editor_url:this.model.get("structure").qna_editor_url})),this.$el.addClass("tvd-white")},render_new_button:function(){var e=TVE_Dash.tpl("quiz/style/new-button"),t=ThriveQuizB.t.choose_quiz_style;this.$el.html(e({item:new Backbone.Model({label:t}),model:this.model})),this.$el.addClass("tvd-medium-xxsmall tvd-card-new tvd-valign-wrapper tvd-relative tqb-new-button")},editQuizStyle:function(t){e(t.target).is(".tqb-edit-design")||this.modal(ThriveQuizB.views.ModalEditQuizStyle,{collection:this.collection,model:this.model,styles:[],width:"800px","max-width":"60%"})}}),ThriveQuizB.views.QuizStyleItem=ThriveQuizB.views.Base.extend({className:"tvd-row tvd-no-margin-bottom tvd-collapse tvd-pointer tqb-quiz-style-item",template:TVE_Dash.tpl("quiz/style/item"),render:function(e){return this.$el.html(this.template({item:this.model,selected:!0===e})),this.$el.attr("data-style",this.model.get("id")),this.model.get("tqb_splash")&&this.render_page(new Backbone.Model(this.model.get("tqb_splash"))),this.model.get("tqb_qna")&&this.render_page(new Backbone.Model(this.model.get("tqb_qna"))),this.model.get("tqb_optin")&&this.render_page(new Backbone.Model(this.model.get("tqb_optin"))),this.model.get("tqb_results")&&this.render_page(new Backbone.Model(this.model.get("tqb_results"))),TVE_Dash.materialize(this.$el),this},render_page:function(e){new ThriveQuizB.views.StyleItemCard({el:this.$(".tbq-style-pages"),model:e}).render()}}),ThriveQuizB.views.QuizPageVariations=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("variations/dashboard"),events:{"click .tqb-add-new-form":"addNewForm","click .tqb-toggle-display":"toggleDisplay","click .tqb-start-variation-test":"startVariationTestPopup"},initialize:function(e){this.completed_tests=e.completed_tests,this.model.on("tqb_variation_removed",_.bind((function(){this.render()}),this)),this.model.on("tqb_variation_added",_.bind((function(){this.render()}),this)),this.model.on("tqb_completed_test_removed",_.bind((function(){this.render()}),this)),this.model.on("adjust_completed_tests_counter",_.bind((function(){this.$el.find("#tqb-completed-tests-count").html("("+this.completed_tests.length+")")}),this))},render:function(){return this.$el.html(this.template({model:this.model})),this.toggleLogic(),this.renderVariationList(),this.renderCompletedtests(),this.renderArchivedVariationList(),this.renderSkipOptin(),_.contains([ThriveQuizB.data.quiz_structure_item_types.optin.key,ThriveQuizB.data.quiz_structure_item_types.results.key],this.model.get("post_type"))&&this.renderGdprUserConsent(),TVE_Dash.materialize(this.$el),this},renderCompletedtests:function(){this.completed_tests.length&&(new ThriveQuizB.views.CompletedTestItemList({model:this.model,collection:this.completed_tests,el:this.$el.find("#tqb-completed-test-list")}).render(),this.$el.find("#tqb-completed-tests-count").html("("+this.completed_tests.length+")"),this.$el.find("#tqb-completed-tests").show())},renderVariationList:function(){this.variation_list&&this.variation_list.remove(),this.variation_list=new ThriveQuizB.views.VariationList({el:this.$("#tqb-page-variations-list"),collection:this.model.get("variations"),model:this.model}),this.$el.find("#tqb-page-variations-list").append(this.variation_list.render().$el)},renderArchivedVariationList:function(){this.model.get("archived_variations").length<=0||(this.archived_variation_list&&this.archived_variation_list.remove(),this.archived_variation_list=new ThriveQuizB.views.VariationList({el:this.$("#tqb-archived-page-variations-list"),collection:this.model.get("archived_variations"),model:this.model}),this.$el.find("#tqb-archived-page-variations-list").append(this.archived_variation_list.render().$el))},renderGdprUserConsent:function(){this.gdpr_user_consent&&this.gdpr_user_consent.remove(),this.gdpr_user_consent=new ThriveQuizB.views.VariationCheckbox({el:this.$("#tqb-page-gdpr-user-consent"),checked:1===parseInt(this.model.get("gdpr_user_consent")),customAction:"gdpr_user_consent",template:TVE_Dash.tpl("variations/gdpr-user-consent"),model:this.model}).render()},renderSkipOptin:function(){ThriveQuizB.data.quiz_structure_item_types.optin.key===this.model.get("post_type")&&(this.skipOptinView&&this.skipOptinView.remove(),this.skipOptinView=new ThriveQuizB.views.VariationCheckbox({el:this.$("#tqb-page-skip-optin"),checked:1===parseInt(this.model.get("skip_optin")),customAction:"skip_optin",template:TVE_Dash.tpl("variations/skip-optin"),model:this.model}).render())},toggleDisplay:function(e){var t=jQuery(e.currentTarget),i=t.hasClass("collapsed");jQuery(t.data("target"))[i?"slideDown":"slideUp"](200),t.toggleClass("collapsed"),t.toggleClass("hover")},toggleLogic:function(){this.$el.find("#tqb-archived-forms")[this.model.get("archived_variations").length?"show":"hide"]()},addNewForm:function(){this.modal(ThriveQuizB.views.ModalAddVariation,{collection:this.model.get("variations"),model:new ThriveQuizB.models.Variation({name:this.model.get("post_title"),page_id:this.model.get("ID"),quiz_id:this.model.get("post_parent")}),width:"800px","max-width":"60%"})},startVariationTestPopup:function(e){var t=this;TVE_Dash.showLoader(),this.model.checkVariationsContent({success:function(e){if(t.$el.find(".tvd-collection-item").removeClass("tve-form-no-content"),e.length>0)e.forEach((function(e,i){t.$el.find("[data-id='"+e+"']").addClass("tve-form-no-content")})),TVE_Dash.err(ThriveQuizB.t.MissingFormContent);else{var i=[];t.model.get("variations").each((function(e){i.push(e.get("id"))}));var s=new ThriveQuizB.models.Test({item_ids:i,page_id:t.model.get("ID"),is_results:t.model.get("post_type")==ThriveQuizB.data.quiz_structure_item_types.results.key});t.modal(ThriveQuizB.views.ModalVariationTest,{model:s,width:"800px","max-width":"60%"})}},error:function(){},complete:function(){TVE_Dash.hideLoader()}},{quiz_id:this.model.get("post_parent")})}}),ThriveQuizB.views.QuizPageTest=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("tests/view"),events:{"click .tqb-toggle-display":"toggleDisplay"},initialize:function(e){this.completed_tests=e.completed_tests;var t=0;this.model.get("test_items").forEach((function(e){e.color=ThriveQuizB.chart_colors[t%ThriveQuizB.chart_colors.length],t++})),this.model.get("stopped_items").forEach((function(e){e.color=ThriveQuizB.chart_colors[t%ThriveQuizB.chart_colors.length]})),this.model.set("test_items",new ThriveQuizB.collections.TestItems(this.model.get("test_items"))),this.model.set("stopped_items",new ThriveQuizB.collections.TestItems(this.model.get("stopped_items")))},render:function(){return this.$el.html(this.template({test:this.model})),this.model.get("test_items").each(this.renderOne,this),this.renderTotal(),this.renderStoppedItems(),this.renderChart(),this.renderCompletedtests(),this.model.get("status")&&this.renderOptions(),this.displayNoDataOverlay(this.model.get("test_items")),TVE_Dash.materialize(this.$el),this},renderStoppedItems:function(){this.model.get("stopped_items").length&&new ThriveQuizB.views.TestStoppedItemList({model:this.model,collection:this.model.get("stopped_items"),el:this.$el.find("#tqb-form-test-stopped-items")}).render()},renderChart:function(){var e=new ThriveQuizB.models.ChartModel({ID:this.model.get("id"),start_date:this.model.get("date_started"),interval:"day"}),t=new ThriveQuizB.views.ChartView({model:e,el:this.$el.find(".tve-chart-interval")});t.drawCandleStick(this.model.get("test_items"),"tve-candle-stick-chart"),this.model.get("stopped_items")&&t.drawCandleStick(this.model.get("stopped_items"),"tve-candle-stick-chart-stopped"),e.fetch()},renderOptions:function(){new ThriveQuizB.views.TestOptions({model:this.model,collection:this.model.get("test_items"),el:this.$el.find("#tqb-test-options")}).render()},renderCompletedtests:function(){this.completed_tests.length&&(new ThriveQuizB.views.CompletedTestItemList({model:this.model,collection:this.completed_tests,el:this.$el.find("#tqb-completed-test-list")}).render(),this.$el.find("#tqb-completed-tests-count").html("("+this.completed_tests.length+")"),this.$el.find("#tqb-completed-tests").show())},renderTotal:function(){new ThriveQuizB.views.TestItemsTotals({model:this.model,collection:this.model.get("test_items"),el:this.$el.find("#tqb-test-items-total")}).render()},renderOne:function(e,t){e.set("show_graph",!0),e.set("parent_test_running",this.model.get("status"));var i=new ThriveQuizB.views.TestItem({model:e,collection:this.model.get("test_items")});this.$el.find("#tqb-form-test-items").append(i.render().$el)},toggleDisplay:function(e){var t=jQuery(e.currentTarget),i=t.hasClass("collapsed");jQuery(t.data("target"))[i?"slideDown":"slideUp"](200),t.toggleClass("collapsed"),t.toggleClass("hover")},displayNoDataOverlay:function(e){var t=!0;e.each((function(e){parseInt(e.get("impressions"))>0&&(t=!1)})),t?this.$el.find(".tve-chart-overlay").show():this.$el.find(".tve-chart-overlay").hide()}}),ThriveQuizB.views.CompletedTestItemList=ThriveQuizB.views.Base.extend({initialize:function(){this.collection.on("tqb_test_removed",_.bind((function(){this.render(),0==this.collection.length?this.model.trigger("tqb_completed_test_removed"):this.model.trigger("adjust_completed_tests_counter")}),this))},addOne:function(e,t){var i=ThriveQuizB.data.colors[e.get("index")%ThriveQuizB.data.colors.length];e.set("show_graph",!0),e.set("parent_test_running",this.model.get("status")),e.set("color",i);var s=new ThriveQuizB.views.CompletedTestItem({model:e,collection:this.collection});this.$el.append(s.render().el)},addAll:function(e){e.each(this.addOne,this)},render:function(){var e=this.$el.find(".tvd-collection-header");return this.$el.html(e),this.addAll(this.collection),this}}),ThriveQuizB.views.CompletedTestItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("tests/completed-item"),tagName:"li",className:"tvd-collection-item tvd-gray",events:{"click .tqb-test-delete":"deleteTest","click .tqb-view-test":"viewTest"},initialize:function(e){this.highest_id=e.highest_id,this.model.on("tqb_test_removed",_.bind((function(){this.collection.trigger("tqb_test_removed")}),this))},render:function(){return this.$el.html(this.template({test:this.model})),this.highest_id===this.model.get("id")&&this.$el.addClass("highlight"),this},viewTest:function(){ThriveQuizB.router.navigate("#dashboard/test/"+this.model.get("id"),{trigger:!0})},deleteTest:function(){this.modal(ThriveQuizB.views.ModalDeleteTest,{width:"800px","max-width":"60%",model:this.model})}}),ThriveQuizB.views.TestOptions=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("tests/options"),events:{"click .tqb-stop-test":"stopTest"},stopTest:function(){this.modal(ThriveQuizB.views.ModalStopVariationTest,{title:ThriveQuizB.t.ChooseWinner,width:1230,"max-width":"90%",model:this.model,collection:this.collection})},render:function(){this.$el.append(this.template(this.model.toJSON()))}}),ThriveQuizB.views.TestItemsTotals=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("tests/test-total"),events:{"click .tqb-edit-test":"editTest"},initialize:function(){this.listenTo(this.model,"auto_win_changed",_.bind(this.render,this))},render:function(){this.$el.html(this.template({totals:this.collection.getTotals(),test:this.model}))},editTest:function(){this.modal(ThriveQuizB.views.ModalEditVariationTest,{title:ThriveQuizB.t.AutomaticWinnerSettings,model:this.model,width:"800px","max-width":"60%"})}}),ThriveQuizB.views.TestItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("tests/test-item"),tagName:"tr",className:"tvd-collection-item",initialize:function(e){this.page_id=e.page_id},events:{"click .tqb-test-item-winner":"setWinner","click .tqb-stop-test-variation-modal":"stopVariation"},render:function(){return this.$el.html(this.template({item:this.model})),this},setWinner:function(e){e.preventDefault();var t=this;TVE_Dash.showLoader(),this.model.set("is_winner",!0),this.model.save({},{success:function(e,i){ThriveQuizB.router.navigate("#dashboard/page/"+t.page_id,{trigger:!0})},complete:function(e){t.model.trigger("tqb_close_modal")}}),TVE_Dash.showLoader()},stopVariation:function(e){this.modal(ThriveQuizB.views.ModalStopVariation,{model:this.model,collection:this.collection,"max-width":"60%",width:450})}}),ThriveQuizB.views.VariationList=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("variations/list"),initialize:function(){this.listenTo(this.collection,"remove",this.removeAction),this.listenTo(this.collection,"add",this.addAction)},removeAction:function(){this.model.trigger("tqb_variation_removed")},addAction:function(){this.model.trigger("tqb_variation_added")},render:function(){return this.$el.html(this.template({model:this.model,collection:this.collection})),this.collection.each(this.renderOne,this),TVE_Dash.materialize(this.$el),this},renderOne:function(e){this.model.get("is_default")&&e.set("is_default",!0);var t=new ThriveQuizB.views.VariationItem({item:e,page_model:this.model});this.$el.find("#tqb-page-variations-item").append(t.render().$el)}}),ThriveQuizB.views.VariationItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("variations/item"),tagName:"tr",className:"tvd-collection-item",events:{"click .tqb-variation-archive":"archive","click .tqb-variation-reset":"reset","click .tqb-variation-delete":"delete","click .tqb-variation-re-add":"reAdd","click .tqb-variation-clone":"clone","click .tqb-edit-variation-title":"editVariationTitle"},initialize:function(e){this.item=e.item,this.page_model=e.page_model,this.$el.attr("data-id",this.item.get("id")),this.item.get("post_status")===ThriveQuizB.data.variation_status.archive?this.template=TVE_Dash.tpl("variations/item-archived"):this.template=TVE_Dash.tpl("variations/item"),this.listenTo(this.item,"change:cache_impressions",this.render),this.listenTo(this.item,"change:is_control",this.render)},render:function(){return this.$el.html(this.template({item:this.item,page_model:this.page_model})),this.$variationTitle=this.$el.find(".tqb-variation-title"),this},archive:function(){1==this.page_model.get("variations").length?TVE_Dash.modal(ThriveQuizB.views.ModalArchiveLastVariation,{model:this.item,page_model:this.page_model}):TVE_Dash.modal(ThriveQuizB.views.ModalArchiveVariation,{model:this.item,page_model:this.page_model})},reset:function(){TVE_Dash.modal(ThriveQuizB.views.ModalResetVariation,{model:this.item})},reAdd:function(){var e=this.item.toJSON(),t=new ThriveQuizB.models.Variation;delete e.id,delete e.post_title,t.set(e),t.set({post_status:ThriveQuizB.data.variation_status.publish,name:this.page_model.get("post_title")}),TVE_Dash.modal(ThriveQuizB.views.ModalReAddVariation,{model:t,page_model:this.page_model,width:"800px","max-width":"60%"})},clone:function(){TVE_Dash.showLoader();var e=this.item.toJSON(),t=this,i=new ThriveQuizB.models.Variation;delete e.is_control,e.cache_impressions=0,e.cache_optins=0,e.cache_optins_conversions=0,e.cache_social_shares=0,e.cache_social_shares_conversions=0,i.set(e),i.set("post_title",ThriveQuizB.t.copy_of+" "+e.post_title),TVE_Dash.showLoader(),i.cloneVariation({success:function(e){i.trigger("add:parent_post",e),i.set({id:e.id,tcb_editor_url:e.tcb_editor_url,cache_optin_conversion_rate:"N/A",cache_social_share_conversion_rate:"N/A"}),t.page_model.get("variations").add(i)},error:function(){},complete:function(){TVE_Dash.hideLoader()}},i.toJSON())},delete:function(){TVE_Dash.modal(ThriveQuizB.views.ModalDeleteVariation,{model:this.item})},editVariationTitle:function(){var e=this,t=this.$el.find(".tqb-edit-variation-title"),i=new Backbone.Model({value:this.item.get("post_title"),label:ThriveQuizB.t.variation_name,required:!0});t.hide(),i.on("change:value",(function(){e.saveTitle.apply(e,arguments),e.$variationTitle.show(),s.remove(),t.show()})),i.on("tqb_no_change",(function(){e.$variationTitle.html(e.item.get("post_title")).show(),s.remove(),t.show()}));var s=new ThriveQuizB.views.TextEdit({model:i,tagName:"div"});this.$variationTitle.hide().after(s.render().$el),s.focus()},saveTitle:function(e,t){var i=this;this.item.set({post_title:t}),this.item.save(null,{success:function(e,s){i.$variationTitle.html(t),TVE_Dash.success(ThriveQuizB.t.variation_title_save_success_toast)},error:function(e,t){TVE_Dash.err(ThriveQuizB.t.variation_title_save_fail_toast)}})}}),ThriveQuizB.views.VariationCheckbox=ThriveQuizB.views.Base.extend({events:{"click .tqb-checkbox-action":"checkboxClicked"},initialize:function(e){e.template&&(this.template=e.template),this.checked=!!e.checked,this.action=e.customAction},render:function(){return this.template&&this.$el.html(this.template({checked:this.checked})),this},checkboxClicked:function(e){this.action&&(TVE_Dash.showLoader(),this.model.customAction(this.action,{success:function(e){1===parseInt(e.ok)?TVE_Dash.success(e.msg):TVE_Dash.err(e.msg)},complete:function(){TVE_Dash.hideLoader()}},{checked:e.currentTarget.checked?1:0}))}}),ThriveQuizB.views.QuizStructureItem=ThriveQuizB.views.Base.extend({className:"tvd-col tvd-s12 tvd-m3 tvd-valign tqb-structure-item-wrapper tqb-relative-tooltip-position",template:TVE_Dash.tpl("quiz/structure-item"),events:{"click .tqb-structure-item-card-delete":"deleteCardModal","click .tqb-add-form":"addNewForm","click .tqb-view-test":"viewTest"},initialize:function(e){this.model.on("tqb_render_structure_item",this.deleteCard,this)},render:function(){return this.$el.html(this.template({item:this.model,tge_url:ThriveQuizB.globals.quiz.get("tge_url")})),this},deleteCardModal:function(){this.modal(ThriveQuizB.views.ModalDeleteStructureItem,{model:this.model,width:"600px","max-width":"60%"})},deleteCard:function(){this.model.trigger("delete:structureItem",this.model),this.remove()},addNewForm:function(){var e=this.model.get("has_running_test"),t="";e&&ThriveQuizB.router.navigate("#dashboard/test/"+e.id,{trigger:!0}),this.model.get("viewed")||(t="/true"),ThriveQuizB.router.navigate("#dashboard/page/"+this.model.get("ID")+t,{trigger:!0})},viewTest:function(){ThriveQuizB.router.navigate("#dashboard/test/"+this.model.get("has_running_test").id,{trigger:!0})}}),ThriveQuizB.views.QuizStructureResultsItem=ThriveQuizB.views.QuizStructureItem.extend({template:TVE_Dash.tpl("quiz/structure-results-item"),events:function(){return _.extend({},ThriveQuizB.views.QuizStructureItem.prototype.events,{"change #tqb-result-types":function(e){this.change_type(e.currentTarget.value)}})},render:function(){return ThriveQuizB.views.QuizStructureItem.prototype.render.apply(this,arguments),this.render_types(ThriveQuizB.results_page_types),this.toggleTooltip(),this},toggleTooltip:function(){var e=this.$("#tqb-results-tooltip");e.hide(),"url"===this.model.get("results_page").type&&0===this.model.get("results_page").links.length?(e.find("span").html(ThriveQuizB.t.create_redirect_link),e.show()):"page"===this.model.get("results_page").type&&!1===this.model.get("viewed")&&this.model.get("question_number")>0&&(e.find("span").html(ThriveQuizB.t.create_result_page),e.show())},change_type:function(e){-1!==Object.keys(ThriveQuizB.results_page_types).indexOf(e)&&(this.$el.find(".tqb-structure-item-card").removeClass("page url").addClass(e),this.model.get("results_page").type=e,this.save_results_page(this.model.get("results_page")),this.toggleTooltip())},save_results_page:function(t){this.toggleManageButton(!0),e.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"structure_item",model:t,_nonce:ThriveQuizB.admin_nonce},success:_.bind((function(){this.toggleManageButton(!1)}),this)})},render_types:function(e){var t=null;void 0!==this.model.get("results_page")&&this.model.get("results_page").type&&(t=this.model.get("results_page").type);var i=this.$("#tqb-result-types");this.$el.find(".tqb-structure-item-card").removeClass("page url").addClass(t),this.$(".tqb-wizard-tooltip span."+t).show(),_.each(e,(function(e,t,s){var r=_.extend({label:"Undefined",value:"Undefined"},e);i.append('<option value="'+r.value+'">'+r.label+"</option>")}),this),i.val(t)},toggleManageButton:function(e){e=!!e,this.$(".tqb-add-form").toggleClass("tvd-btn-purple",!e),this.$(".tqb-add-form").toggleClass("tvd-btn-gray",e)},addNewForm:function(){if(!this.$(".tqb-add-form").is(".tvd-btn-gray")){var e=this.model.get("has_running_test"),t="";if(e)return ThriveQuizB.router.navigate("#dashboard/test/"+e.id,{trigger:!0});if(this.model.is_results_url())return ThriveQuizB.router.navigate("#dashboard/page/"+this.model.get("ID")+"/redirect-settings",{trigger:!0});this.model.get("viewed")||(t="/true"),ThriveQuizB.router.navigate("#dashboard/page/"+this.model.get("ID")+t,{trigger:!0})}}}),ThriveQuizB.views.QuizStructureButton=ThriveQuizB.views.Base.extend({className:"tvd-row tvd-center",template:TVE_Dash.tpl("quiz/structure-button"),events:{"click .tqb-dotted-holder":"addCard"},render:function(){return this.$el.html(this.template({item:this.model})),this},addCard:function(){this.model.trigger("add:structureItem",this.model),this.remove(),e(".tvd-material-tooltip").hide()}}),ThriveQuizB.views.QuizStructure=ThriveQuizB.views.Base.extend({className:"tvd-col tvd-s12",template:TVE_Dash.tpl("quiz/structure"),initialize:function(e){},render:function(){return this.$el.html(this.template()),this.renderItem("splash"),this.renderItem("qna"),this.renderItem("optin"),this.renderItem("results"),this.hideShowExtra(),this},renderItem:function(e){var t,i={},s=null,r=this,n=this.model.get(e),a="number"==typeof n&&n;i.last="results"===e,i.type=e,i.quiz_type=this.model.get("quiz_type"),i.parent_id=this.model.get("ID"),i.viewed=!this.model.get("viewed")||this.model.get("viewed")[e],i.mandatory=ThriveQuizB.data.quiz_structure_item_types[e].mandatory,i.post_type=ThriveQuizB.data.quiz_structure_item_types[e].key,i.name=ThriveQuizB.data.quiz_structure_item_types[e].name,this.model.get("running_tests")?i.has_running_test=this.model.get("running_tests")[e]:i.has_running_test=!1,i.question_number=this.model.get("tge_question_number")?this.model.get("tge_question_number"):0,i.nr_of_variations=this.model.get("nr_of_variations")&&this.model.get("nr_of_variations")[e]?this.model.get("nr_of_variations")[e]:0,i.ID=a,i.style=this.model.get("style"),"results"===i.type&&void 0!==this.model.get("results_page")&&(i.results_page=this.model.get("results_page"));var o=new ThriveQuizB.models.StructureItem(i);if(o.on("add:structureItem",(function(e){r.addCard(e)})),o.on("delete:structureItem",(function(e){r.deleteCard(e)})),n){switch(e){case"results":t=new ThriveQuizB.views.QuizStructureResultsItem({model:o});break;case"qna":o.set("qna_editor_url",this.model.get("qna_editor_url")),(t=new ThriveQuizB.views.QuizStructureItem({model:o})).template=TVE_Dash.tpl("quiz/structure-item-qna");break;default:t=new ThriveQuizB.views.QuizStructureItem({model:o})}s=this.$el.find("#tqb-structure-card-"+e)}else t=new ThriveQuizB.views.QuizStructureButton({model:o}),s=this.$el.find("#tqb-structure-button-"+e);return s.append(t.render().$el),this},addCard:function(e){var t=e.get("type"),i=this;this.model.set(t,!0),this.model.save(null,{success:function(e){ThriveQuizB.globals.quiz.set("structure",e.toJSON()),i.renderItem(t),ThriveQuizB.util.bind_wistia()},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_structure_save_fail_toast)}}),this.hideShowExtra()},deleteCard:function(e){var t=e.get("type"),i=this;this.model.set(t,!1),this.model.save(null,{success:function(e){ThriveQuizB.globals.quiz.set("structure",e.toJSON()),i.renderItem(t)},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_structure_save_fail_toast)}}),this.hideShowExtra()},checkIfFull:function(){var e=this,t=!0;return Object.keys(ThriveQuizB.data.quiz_structure_item_types).forEach((function(i,s){e.model.get(i)||(t=!1)})),t},hideShowExtra:function(){this.checkIfFull()?this.$el.find("#tqb-structure-button-wrapper").hide():this.$el.find("#tqb-structure-button-wrapper").show()}}),ThriveQuizB.views.StyleItemCard=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("quiz/style/item/card"),render:function(){return this.$el.append(this.template({item:this.model})),this}}),ThriveQuizB.views.ChartView=ThriveQuizB.views.Base.extend({events:{"change #tqb-chart-interval-select":"intervalChanged"},currentInterval:"day",currentSource:"",currentDate:"",initialize:function(){this.source=this.model.get("quiz_id"),this.createChart();var e=this;this.listenTo(this.model,"change:interval",(function(){e.model.fetch()})),this.listenTo(this.model,"change:date",(function(){e.model.fetch()})),this.listenTo(this.model,"change",this.updateChart)},intervalChanged:function(){var e=this.$el.find("#tqb-chart-interval-select").val();e!=this.currentInterval&&(this.currentInterval=e,void 0!==this.chart&&this.chart.showLoading(),this.model.set("interval",e))},updateChart:function(){this.chart.set("data",this.model.get("chart_data")),this.chart.set("title",this.model.get("chart_title")),this.chart.set("x_axis",this.model.get("chart_x_axis")),this.chart.set("y_axis",this.model.get("chart_y_axis")),this.chart.redraw()},createChart:function(){var e=!1;(this.model.get("quiz_id")||0==this.model.get("quiz_id"))&&(e=!0),this.chart=new ThriveQuizB.LineChart({title:"",data:[],renderTo:"tqb-chart-container",legend:e}),this.chart.showLoading()},drawCandleStick:function(e,t){if(e){var i=e.getCandleStickData();this.bar_chart=new ThriveQuizB.BarChart({title:"",data:i.chartData,colors:i.chartColors,renderTo:t})}}}),ThriveQuizB.views.TestStoppedItemList=ThriveQuizB.views.Base.extend({addOne:function(e,t){e.set("show_graph",!0),e.set("parent_test_running",this.model.get("status"));var i=new ThriveQuizB.views.TestStoppedItem({model:e});this.$el.append(i.render().el)},addAll:function(e){e.each(this.addOne,this)},render:function(){return this.addAll(this.collection),this}}),ThriveQuizB.views.TestStoppedItem=ThriveQuizB.views.Base.extend({tagName:"tr",className:"tvd-collection-item tvd-gray",template:TVE_Dash.tpl("tests/stopped-item"),initialize:function(e){this.highest_id=e.highest_id},render:function(){return this.$el.html(this.template({item:this.model})),this.highest_id===this.model.get("id")&&this.$el.addClass("highlight"),this}}),ThriveQuizB.views.BadgeTemplateItem=ThriveQuizB.views.Base.extend({className:"tqb-badge-template-card",template:TVE_Dash.tpl("badge/template"),events:{"click .tvd-card":"toggle_selected"},render:function(){return this.$el.html(this.template({item:this.model})),this},toggle_selected:function(t){var i=e(t.currentTarget),s=t.currentTarget.dataset.key;this.collection.each((function(e,t,i){e.set("selected",!1,{silent:!0})})),TVE_Dash.select_card(i,i.parents("#tqb-badge-templates-list").first().find(".tvd-card")),this.collection.findWhere({key:s}).set("selected",!0)}}),ThriveQuizB.views.ReportSources=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/source-options"),render:function(){return this.$el.html(this.template({sources:this.collection})),TVE_Dash.materialize(this.$el),this}}),ThriveQuizB.views.ReportLocations=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/location-options"),labels:{page:ThriveQuizB.t.pages,tva_lesson:ThriveQuizB.t.lessons,tva_module:ThriveQuizB.t.modules,tva_course_overview:ThriveQuizB.t.course_overviews,product:ThriveQuizB.t.products,post:ThriveQuizB.t.posts},render:function(e){this.$el.html(this.template({locations:e,labels:this.labels}));for(var t="",i=0,s=Object.keys(e);i<s.length;i++){var r=s[i];t+='<optgroup label="'.concat(this.labels[r]?this.labels[r]:r+" "+this.labels.post,'">'),e[r].forEach((function(e){t+='<option value="'.concat(e.post_id,'">').concat(e.post_title,"</option>")})),t+="</optgroup>"}return this.$el.find("#tqb-report-location").append(t),TVE_Dash.materialize(this.$el),this}}),ThriveQuizB.views.Reporting=ThriveQuizB.views.Base.extend({className:"tvd-container",template:TVE_Dash.tpl("reporting-main"),type:null,events:{"change #tqb-report-source":"changeQuiz","change #tqb-report-type":"changeReport","change #tqb-chart-date-select":"changeDateInterval","change #tqb-chart-interval-select":"changeReport","change #tqb-report-location":"changeLocation","click .calendar-trigger-icon":"triggerDatepicker","click #tqb-reset-quiz-stats":"resetStats","click #tqb-anonymize-quiz-results":"anonymizeResults"},initialize:function(e){void 0!==e&&e.model.set("selected",0),this.listenTo(this.collection,"tqb:reset-stats",(function(){this.changeReport(!0)})),e.report_type&&(this.report_type=e.report_type)},render:function(){return this.$el.html(this.template({item:this.model})),this.$el.find(".tqb-secondary-selectors").hide(),this.$el.find(".tqb-custom-filter").hide(),this.$("#tqb-report-type").val(this.report_type),TVE_Dash.materialize(this.$el),this.renderQuizList(),this},buildCsvUrl:function(){var t=e(".tqb-answers-csv"),i=t.attr("href"),s=this.model.get("quiz_id"),r=this.updateQueryStringParameter(i,"quiz_id",s);r=this.updateQueryStringParameter(r,"tqb_answ_csv_nonce",ThriveQuizB.admin_answ_csv_nonce),t.attr("href",r)},updateQueryStringParameter:function(e,t,i){var s=new RegExp("([?&])"+t+"=.*?(&|$)","i"),r=-1!==e.indexOf("?")?"&":"?";return e.match(s)?e.replace(s,"$1"+t+"="+i+"$2"):e+r+t+"="+i},renderQuizList:function(){var e=this;this.collection.fetch({success:function(t,i){var s=new ThriveQuizB.views.ReportSources({collection:e.collection});e.$("#tqb-report-source-container").html(s.render().$el),e.model.get("selected")&&e.$el.find("#tqb-report-source").val(e.model.get("selected")),e.changeQuiz(),e.changeReport(),e.getReport(),TVE_Dash.materialize(e.$el)}})},renderLocations:function(e){if("all"===this.model.get("location")){var t=new ThriveQuizB.views.ReportLocations({locations:e}),i=this.$("#tqb-report-location-container");i.html(t.render(e).$el),"0"===this.model.get("quiz_id")?(this.$el.find("#tqb-report-location").attr("disabled",!0),i.addClass("tvd-tooltipped"),i.attr("data-tooltip",ThriveQuizB.t.location_unavailable),i.attr("data-position","top")):i.hasClass("tvd-tooltipped")&&(i.removeClass("tvd-tooltipped"),i.attr("data-tooltip",""),i.attr("data-position","")),this.$el.find("#tqb-report-location").val(this.model.get("location"))}},_get_reset_stats_button:function(){return this.$btnResetStats||(this.$btnResetStats=this.$("#tqb-reset-quiz-stats")),this.$btnResetStats.length?this.$btnResetStats:this.$el},changeQuiz:function(e){var t=this.$el.find("#tqb-report-source");t.val()||t.val(this.collection.first().get("ID")),this.model.set({quiz_id:t.val(),location:"all"}),0!=this.model.get("quiz_id")?this._get_reset_stats_button().removeClass("tvd-disabled").removeAttr("disabled"):this.$("#tqb-reset-quiz-stats").addClass("tvd-disabled").attr("disabled","disabled"),e&&this.getReport()},changeLocation:function(){this.model.set("location",this.$el.find("#tqb-report-location").val()),this.getReport()},changeDateInterval:function(e){if(this.setModel(),"completions"==this.model.get("report_type")&&this.model.get("date")==ThriveQuizB.date_intervals.custom)return this.$el.find(".tqb-custom-filter").show(),void this.getReport();this.$el.find(".tqb-custom-filter").hide(),e&&this.getReport()},changeReport:function(e){if(e&&e.target&&"tqb-report-type"===e.target.id)return ThriveQuizB.router.navigate("#reports/"+this.model.get("quiz_id")+"/"+e.currentTarget.value,{trigger:!0});this.setModel(),this.hideAllOption(),e&&this.getReport(),"users"===this.model.get("report_type")?this.$("#tqb-anonymize-quiz-results").removeClass("tvd-hide"):this.$("#tqb-anonymize-quiz-results").addClass("tvd-hide"),this.toggleAnswCsvBtn(this.report_type),this.report_type&&this.$("#tqb-report-type").attr("value",this.report_type)},toggleAnswCsvBtn:function(e){this.$(".tqb-answers-csv").hide(),"questions"===e&&this.$(".tqb-answers-csv").show()},hideAllOption:function(){"completions"!==this.model.get("report_type")?(0==this.$el.find("#tqb-report-source").val()&&this.$el.find("#tqb-report-source").val(this.$el.find("#tqb-report-source option:first").val()).trigger("change"),this.$el.find('#tqb-report-source option[value="0"]').detach()):0==this.$el.find('#tqb-report-source option[value="0"]').length&&this.$el.find("#tqb-report-source").append(TVE_Dash.tpl("reporting/all-source"))},setModel:function(){this.model.set("report_type",this.report_type),this.model.set("date",this.$el.find("#tqb-chart-date-select").val()),this.model.set("interval",this.$el.find("#tqb-chart-interval-select").val()),this.model.set("start_date",this.$el.find("#tqb-report-start-date").val()),this.model.set("end_date",this.$el.find("#tqb-report-end-date").val())},getReport:function(){TVE_Dash.showLoader();var e=this;this.model.save(null,{success:function(t,i){i?(i.locations&&e.renderLocations(i.locations),"users"==e.model.get("report_type")&&e.renderUsersView(i),"flow"==e.model.get("report_type")&&e.renderFlowView(i),"completions"==e.model.get("report_type")&&e.renderCompletionView(i),"questions"==e.model.get("report_type")&&e.renderQuestionsView(i)):TVE_Dash.err(ThriveQuizB.t.SourceNotFound)},error:function(e,t){},complete:function(){TVE_Dash.hideLoader()}})},renderCompletionView:function(e){new ThriveQuizB.views.CompletionReport({model:new ThriveQuizB.models.CompletionReport(e),el:this.$el.find("#tqb-report-content")}).render();var t=this;return this.$el.find("#tqb-report-start-date").pickadate({format:"yyyy-mm-dd",format_submit:"yyyy-mm-dd",onClose:function(){t.validateDate("start",t.$el.find("#tqb-report-start-date").val())},onStart:function(){var e=new Date;t.model.set("start_date",[e.getFullYear(),e.getMonth(),e.getDate()-7]),this.set("select",t.model.get("start_date"))}}),this.$el.find("#tqb-report-end-date").pickadate({format:"yyyy-mm-dd",format_submit:"yyyy-mm-dd",onClose:function(){t.validateDate("end",t.$el.find("#tqb-report-end-date").val())},onStart:function(){var e=new Date;t.model.set("end_date",[e.getFullYear(),e.getMonth(),e.getDate()]),this.set("select",t.model.get("end_date"))}}),this.changeReport(),this.$el.find(".tqb-secondary-selectors").show(),this},validateDate:function(e,t){"start"===e&&this.model.get("start_date")!==t&&(this.model.set("start_date",t),this.changeReport(!0)),"end"===e&&this.model.get("end_date")!==t&&(this.model.set("end_date",t),this.changeReport(!0))},renderUsersView:function(e){var t=new ThriveQuizB.views.QuizUsersList({collection:new ThriveQuizB.collections.QuizUsers(e.data),model:new ThriveQuizB.models.UsersList({total_items:e.total_items,total_pages:e.total_pages,per_page:e.per_page,current_page:e.current_page,offset:e.offset,quiz_id:this.model.get("quiz_id"),since:e.since,location:this.model.get("location")})});return this.$el.find("#tqb-report-content").html(t.render().el),this.$el.find(".tqb-secondary-selectors").hide(),this},renderFlowView:function(e){return new ThriveQuizB.views.FlowReport({model:new ThriveQuizB.models.FlowReport(e),el:this.$el.find("#tqb-report-content")}).render(),this.$el.find(".tqb-secondary-selectors").hide(),this},renderQuestionsView:function(e){this.buildCsvUrl();var t,i=new ThriveQuizB.collections.CompletionTableModel;this.parseQuestions(e.questions).forEach((function(e,s){t=new ThriveQuizB.models.QuestionsReportItem(e),i.push(t)}));var s=new ThriveQuizB.views.QuestionsReport({collection:i,el:this.$el.find("#tqb-report-content")});return s.since=e.since,s.render(),this.$el.find(".tqb-secondary-selectors").hide(),this},parseQuestions:function(t){return e.map(t,(function(e,t){return e}))},resetStats:function(){this.modal(ThriveQuizB.views.ModalResetQuiz,{model:this.collection.findWhere({ID:parseInt(this.model.get("quiz_id"))}),collection:this.collection})},anonymizeResults:function(){this.modal(ThriveQuizB.views.ModalAnonymizeResults,{model:this.collection.findWhere({ID:parseInt(this.model.get("quiz_id"))}),collection:this.collection})}}),ThriveQuizB.views.QuestionsReport=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/questions-report"),render:function(){return this.$el.html(this.template({date:this.since})),this.renderQuestions(),this},renderQuestions:function(){return this.collection.length?(e(".tqb-answers-csv").removeClass("tqb-disabled"),this.collection.each(this.renderOne,this)):(e(".tqb-answers-csv").addClass("tqb-disabled"),this.$el.find(".tqb-questions-report-no-data").show()),this},renderOne:function(e){var t;return t=3===parseInt(e.get("question_type"))?new ThriveQuizB.views.OpenQuestionsReportItem({model:e}):new ThriveQuizB.views.QuestionsReportItem({model:e}),this.$el.find(".tqb-questions-container").append(t.render().$el),t.renderChart(),this}}),ThriveQuizB.views.QuestionsReportItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/questions-question"),render:function(){return this.$el.html(this.template({item:this.model})),this.renderAnswers(),this},renderChart:function(){this.pie_chart=new ThriveQuizB.Pie3DChart({title:"",data:e.map(this.model.get("answers"),(function(e,t){return e})),renderTo:"tqb-chart-container-"+this.model.get("id")}),0==this.model.get("total")&&this.$(".tve-chart-overlay").show()},renderAnswers:function(){var e,t=new ThriveQuizB.collections.QuestionsReportAnswers;return this.parseQuestions(this.model.get("answers")).forEach((function(i,s){e=new ThriveQuizB.models.QuestionsReportAnswer(i),t.push(e)})),new ThriveQuizB.views.QuestionsReportAnswers({collection:t,el:this.$el.find(".tqb-answer-table")}).render(),this},parseQuestions:function(t){return e.map(t,(function(e,t){return e}))}}),ThriveQuizB.views.OpenQuestionsReportItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/questions-open-question"),className:"tqb-oeq-reporting",render:function(){this.$el.html(this.template({item:this.model}));var t=this.$(".tqb-csv-download"),i=t.attr("href");return t.attr("href",i+"&"+e.param({question_id:this.model.get("id"),tqb_csv_nonce:ThriveQuizB.admin_csv_nonce})),new ThriveQuizB.views.PaginationView({el:this.$(".tqb-answers-box"),model:this.model,collection:new ThriveQuizB.collections.PaginatedCollection(this.model.get("user_answers"))}).render(),this},renderChart:function(){}}),ThriveQuizB.views.PaginationView=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/pagination"),events:{"click .tqb-next":"nextPage","click .tqb-previous":"previousPage","click .tqb-page":"goToPage","change .tqb-perPage":function(e){if(e&&e.currentTarget.value){var t=parseInt(e.currentTarget.value);isNaN(t)&&(t=this.collection.length),this.collection.perPage=t,this.collection.currentPage=1,this.collection.trigger("refresh")}}},initialize:function(e){0==e.collection instanceof ThriveQuizB.collections.PaginatedCollection&&(this.collection=new ThriveQuizB.collections.PaginatedCollection),_.bindAll(this,"render"),this.collection.bind("refresh",this.render)},render:function(){var e=this.collection.pageInfo(),t=this.collection.getItems(),i=TVE_Dash.tpl("reporting/questions/open/answer");return this.$el.html(this.template(e)),_.each(t,(function(e){this.$el.append(i({answer:e}))}),this),TVE_Dash.materialize(this.$el),this},nextPage:function(e){e&&e.currentTarget.dataset.page<=this.collection.pageInfo().totalPages&&this.collection.nextPage()},previousPage:function(e){e&&e.currentTarget.dataset.page>=1&&this.collection.previousPage()},goToPage:function(e){e&&e.currentTarget.dataset.page&&this.collection.goToPage(e.currentTarget.dataset.page)}}),ThriveQuizB.views.QuestionsReportAnswers=ThriveQuizB.views.Base.extend({render:function(){return this.collection.each(this.renderOne,this),this},renderOne:function(e){var t=new ThriveQuizB.views.QuestionsReportAnswer({model:e});return this.$el.append(t.render().$el),this}}),ThriveQuizB.views.QuestionsReportAnswer=ThriveQuizB.views.Base.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("reporting/questions-answer"),render:function(){return this.$el.html(this.template({item:this.model})),this}}),ThriveQuizB.views.CompletionReport=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/completion-report"),render:function(){this.$el.html(this.template({item:this.model})),this.updateColorList(this.model);var e=new ThriveQuizB.models.CompletionChartModel(this.model.toJSON()),t=new ThriveQuizB.views.ChartView({model:e,el:this.$el.find(".tve-chart-interval")});this.validateChartData(),t.updateChart();var i,s=this.parseTableQuizzes(this.model.get("quiz_list")),r=new ThriveQuizB.collections.CompletionTableModel,n=this;return s.length?(s.forEach((function(e,t){(i=new ThriveQuizB.models.CompletionQuiz(e)).set("color",n.colors[e.quiz_id]),r.push(i)})),new ThriveQuizB.views.CompletionTable({collection:r,el:this.$el.find(".tqb-table-container")}).render(),this.$el.find("#tqb-table-items").show()):this.$el.find("#tqb-table-items").hide(),TVE_Dash.materialize(this.$el),this},updateColorList:function(){this.colors=[];var e=this;this.parseTableQuizzes(this.model.get("chart_data")).forEach((function(t,i){e.colors[t.id]=ThriveQuizB.chart_colors[i%ThriveQuizB.chart_colors.length]}))},parseTableQuizzes:function(t){return e.map(t,(function(e,t){return e}))},validateChartData:function(){_.isEmpty(this.model.get("chart_data"))&&this.$el.find(".tve-chart-overlay").show()}}),ThriveQuizB.views.CompletionQuiz=ThriveQuizB.views.Base.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("reporting/completion-quiz"),render:function(){return this.$el.html(this.template({item:this.model})),this}}),ThriveQuizB.views.CompletionTable=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/completion-table"),currentPage:1,pageCount:1,pagesToDisplay:2,itemsPerPage:10,totalItems:0,collectionSlice:null,from:(this.currentPage-1)*this.itemsPerPage,events:{"click a.page":"changePage"},initialize:function(){this.collectionSlice||(this.collectionSlice=this.collection),this.collectionSlice.length>this.itemsPerPage&&this.getItemsToDisplay(this.collectionSlice),this.totalItems=this.collection.length,this.pageCount=Math.ceil(this.totalItems/this.itemsPerPage)},getItemsToDisplay:function(e){var t=(this.currentPage-1)*this.itemsPerPage;this.collectionSlice=new ThriveQuizB.collections.CompletionTableModel(e.chain().rest(t).first(this.itemsPerPage).value())},render:function(){return this.$el.html(this.template({item:this.model})),this.totalItems>this.itemsPerPage&&this.renderPagination(),this.renderList(this.collectionSlice),this},renderList:function(e){var t=this.$el.find("#tqb-table-items .tvd-collection-header");this.$el.find("#tqb-table-items").html(t),e.each(this.renderOne,this)},renderOne:function(e){var t=new ThriveQuizB.views.CompletionQuiz({model:e});return this.$el.find("#tqb-table-items").append(t.render().$el),this},renderPagination:function(){var e=this,t=new ThriveQuizB.views.CompletionReportPagination({model:new ThriveQuizB.models.CompletionPagination({currentPage:parseInt(e.currentPage),pageCount:parseInt(e.pageCount),totalItems:parseInt(e.totalItems),itemsPerPage:parseInt(e.itemsPerPage),pagesToDisplay:parseInt(e.pagesToDisplay)})});return e.$el.find("#tqb-completion-pagination").html(t.render().$el),!0},changePage:function(e,t){var i=this;return i.itemsPerPage,e&&void 0!==e.currentTarget?i.currentPage=jQuery(e.currentTarget).attr("value"):t&&void 0!==t.page&&(i.currentPage=parseInt(t.page)),i.currentPage<1&&(i.currentPage=1),this.getItemsToDisplay(this.collection),this.renderList(this.collectionSlice),this.renderPagination(),!1}}),ThriveQuizB.views.QuizUsersList=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/users-list"),events:{"click .tqb-view-quiz-user-data":"viewUserAnswers","click .tqb-previous-page":"previousPage","click .tqb-next-page":"nextPage","change #tqb-user-per-page":"changeNrOfRows","click .tqb-jump-to-page-button":"jumpToPage","click .tqb-filter-reports":"openFiltersModal","click .tqb-reset-filter-reports":"resetFilters"},initialize:function(){this.listenTo(this.model,"tqb:filtered",_.bind((function(e){this.collection=e,this.render()}),this))},render:function(){return this.$el.html(this.template({item:this.model})),this.collection.each(this.renderOne,this),Number(this.model.get("total_items"))<Number(this.model.get("per_page"))&&this.hidePagination(),this.$el.find("#tqb-user-per-page").val(this.model.get("per_page")),this.enterPress(),this},renderOne:function(e){var t=new ThriveQuizB.views.User({model:e,collection:this.collection});return this.$el.find(".tqb-users-list-table-content").append(t.render().$el),this},hidePagination:function(){this.$el.find(".tqb-users-report-jump").hide(),this.$el.find(".tqb-users-report-pagination").hide()},enterPress:function(){var t=this;return e(document).off("keypress"),e(document).on("keypress",(function(e){13!=e.which&&13!=e.keyCode||t.jumpToPage()})),this},jumpToPage:function(){var e=this.$el.find("#tqb-current-page-input").val();if(e<=this.model.get("total_pages")&&e>=1){var t=this.model.get("per_page");this.model.set("current_page",e),this.model.set("jump_page",e),this.model.set("offset",(e-1)*t),this.refreshList()}else TVE_Dash.err(this.$el.find("#tqb-current-page-input").attr("data-error")),this.$el.find("#tqb-current-page-input").addClass("tvd-invalid")},changeNrOfRows:function(){this.model.set("offset",0),this.model.set("current_page",0),this.model.set("per_page",this.$el.find("#tqb-user-per-page").val()),this.refreshList()},previousPage:function(){var e=this.model.get("current_page"),t=this.model.get("per_page");e>1&&(this.model.set("offset",(e-2)*t),this.model.set("current_page",--e),this.refreshList())},nextPage:function(){var e=this.model.get("current_page"),t=this.model.get("per_page");e<this.model.get("total_pages")&&(this.model.set("offset",e*t),this.model.set("current_page",++e),this.refreshList())},refreshList:function(){TVE_Dash.showLoader();var e=this;this.model.save(null,{success:function(t,i){e.collection=new ThriveQuizB.collections.QuizUsers(i.data),e.model.set("total_pages",i.total_pages),e.render()},error:function(e,t){},complete:function(){TVE_Dash.hideLoader()}})},resetFilters:function(){this.model.set({categories:[],progress:null,date_finished:null,date_started:null,result_min:null,result_max:null,offset:0},{silent:!0}),this.model.tqb_filters=!1,this.refreshList()},openFiltersModal:function(){this.modal(ThriveQuizB.views.ModalFilterReports,{model:this.model,collection:this.collection,quizModel:ThriveQuizB.globals.quizzes.get(this.model.get("quiz_id"))})}}),ThriveQuizB.views.User=ThriveQuizB.views.Base.extend({tagName:"tr",className:"tqb-user-table-item tvd-gray",template:TVE_Dash.tpl("reporting/users-item"),events:{"click .tqb-view-users-answers":"showAnswers"},render:function(){return this.$el.html(this.template({item:this.model})),this},showAnswers:function(){var e=this;(new ThriveQuizB.collections.QuizUserAnswers).fetch({data:{quiz_id:e.model.get("quiz_id"),user_id:e.model.get("id")},success:function(t,i){e.modal(ThriveQuizB.views.ModalViewUserAnswers,{model:e.model,collection:new ThriveQuizB.collections.UserQuestions(i),width:"750px"})},error:function(e,t,i){}})}}),ThriveQuizB.views.UserQuestion=ThriveQuizB.views.Base.extend({className:"tvd-collection-item",tagName:"li",template:TVE_Dash.tpl("reporting/user-question"),initialize:function(){this.collection=new ThriveQuizB.collections.UserAnswers(this.model.get("answers"))},render:function(){this.$el.html(this.template({item:this.model}));var e=this.$el.find(".tqb-user-answers"),t=parseInt(this.model.get("q_type"));return e.empty(),e.addClass(1===t||3===t?"tqb-text-question":"tqb-image-question"),this.collection.each((function(i){var s=new ThriveQuizB.views.UserQuestionAnswer({model:i,q_type:t});e.append(s.render().el)}),this),this}}),ThriveQuizB.views.CompletionReportPagination=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/completion-pagination"),render:function(){return this.$el.html(this.template({item:this.model})),this}}),ThriveQuizB.views.UserQuestionAnswer=ThriveQuizB.views.Base.extend({className:"tvd-collection-item tvd-gray tqb-flex-item",q_type:1,initialize:function(e){this.q_type=parseInt(e.q_type||this.q_type)},render:function(){return this.$el.html(this.template({item:this.model})),this},template:function(e){e=e||{};var t="text";switch(this.q_type){case 2:t="image";break;case 3:t="open"}return TVE_Dash.tpl("reporting/user-answer-"+t,e)}}),ThriveQuizB.views.FlowReport=ThriveQuizB.views.Base.extend({className:"tqb-flow-report",template:TVE_Dash.tpl("reporting/flow-report"),render:function(){return this.$el.html(this.template({item:this.model})),this.model.get("splash")&&this.renderSplash(),this.renderQNA(),this.model.get("optin")&&this.renderOptin(),this.renderResults(),this.renderConclusion(),this},renderConclusion:function(){var e=this.model.get("splash")?this.model.get("splash")[ThriveQuizB.event_types.impression]:this.model.get("qna")[ThriveQuizB.event_types.impression],t=this.model.get("results")[ThriveQuizB.event_types.conversion];this.$el.find(".tqb-visitors-completed").html(t),this.$el.find(".tqb-conversion-rate").html((100*t/e).toFixed(2)+"%"),this.$el.find(".tqb-flow-report-conclusion").show(),this.$el.find(".tqb-flow-report-no-data").hide()},renderSplash:function(){var e=new ThriveQuizB.views.FlowReportSection({model:new ThriveQuizB.models.FlowReportSection({type:"splash",data:this.model.get("splash"),total:this.model.get("users")})});this.$el.find(".tqb-flow-report-splash").html(e.render().el)},renderQNA:function(){var e=new ThriveQuizB.views.FlowReportSection({model:new ThriveQuizB.models.FlowReportSection({type:"qna",data:this.model.get("qna"),total:this.model.get("users")})});this.$el.find(".tqb-flow-report-qna").html(e.render().el)},renderOptin:function(){var e=new ThriveQuizB.views.FlowReportSection({model:new ThriveQuizB.models.FlowReportSection({type:"optin",data:this.model.get("optin"),subscribers:this.model.get("optin_subscribers"),total:this.model.get("users")})});this.$el.find(".tqb-flow-report-optin").html(e.render().el)},renderResults:function(){var e=new ThriveQuizB.views.FlowReportSection({model:new ThriveQuizB.models.FlowReportSection({type:"results",data:this.model.get("results"),subscribers:this.model.get("results_subscribers"),social_shares:this.model.get("results_social_shares"),total:this.model.get("users"),results_page:new Backbone.Model(this.model.get("results_page"))})});this.$el.find(".tqb-flow-report-results").html(e.render().el)}}),ThriveQuizB.views.FlowReportSection=ThriveQuizB.views.Base.extend({className:"tvd-collection-item tvd-row",template:TVE_Dash.tpl("reporting/flow-section"),initialize:function(){var e=this.model.get("data");if(void 0===this.model.get("data")[ThriveQuizB.event_types.skip_optin]&&(e[ThriveQuizB.event_types.skip_optin]=0,this.model.set("data",e)),void 0===this.model.get("data")[ThriveQuizB.event_types.conversion]&&(e[ThriveQuizB.event_types.conversion]=0,this.model.set("data",e)),void 0===this.model.get("data")[ThriveQuizB.event_types.impression]&&(e[ThriveQuizB.event_types.impression]=0,this.model.set("data",e)),this.model.get("data")[ThriveQuizB.event_types.skip_optin]){var t=Number(e[ThriveQuizB.event_types.skip_optin])+Number(e[ThriveQuizB.event_types.conversion]);e[ThriveQuizB.event_types.conversion]=t,this.model.set("data",e)}},render:function(){return this.$el.html(this.template({item:this.model})),this}}),ThriveQuizB.views.CategoryItem=ThriveQuizB.views.Base.extend({className:"tqb-quiz-category",template:TVE_Dash.tpl("category-item"),events:{"click .tqb-remove-input":"remove_option"},initialize:function(e){this.quiz_model=e.quiz_model,e.item&&(this.item=e.item)},render:function(){return this.$el.append(this.template({item:this.model})),this},remove_option:function(){this.quiz_model.get("results").remove(this.model),this.remove()}}),ThriveQuizB.views.QuizHilightSettings=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("quiz/settings/highlight-answer"),events:{"click .tqb-radio-option":"handle"},render:function(){return this.$el.html(this.template({model:this.model})),TVE_Dash.data_binder(this),this},handle:function(t){this.$(".tqb-radio-option").attr("checked",!1),this.model.resetValues(),this.model.set(t.currentTarget.dataset.attr,1);var i=this.model;e(".tqb-highlight-answer").each((function(){i.set(e(this).attr("data-attr"),e(this).is(":checked")?1:0,{silent:!0})})),this.render()}}),ThriveQuizB.views.AnswerFeedbackSettings=ThriveQuizB.views.QuizHilightSettings.extend({template:TVE_Dash.tpl("quiz/settings/feedback")}),ThriveQuizB.views.AnswerFeedbackExtendedSettings=ThriveQuizB.views.QuizHilightSettings.extend({template:TVE_Dash.tpl("quiz/settings/feedback-extended")}),ThriveQuizB.views.PreviewFeedbackSettings=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("quiz/settings/feedback-preview"),render:function(){return this.$el.html(this.template({model:this.model})),this}}),ThriveQuizB.views.QuizExtraSettings=ThriveQuizB.views.Base.extend({initialize:function(e){this.quiz_model=e.quiz_model},render:function(){var e="render_"+this.model.get("type")+"_settings";return this[e="function"==typeof this[e]?e:"render_default_settings"](),this},render_right_wrong_settings:function(){this.hilight_view=new ThriveQuizB.views.QuizHilightSettings({model:this.model.get("highlight_settings"),el:this.$(".tqb-highlight-settings")}).render(),this.feedback_view=new ThriveQuizB.views.AnswerFeedbackSettings({model:this.model.get("feedback_settings"),el:this.$(".tqb-feedback-settings")}).render(),new ThriveQuizB.views.PreviewFeedbackSettings({el:this.$(".tqb-preview-settings")}).render(),this.hilight_view.model.on("change",(function(e){this.$(".tqb-feedback-settings, .tqb-preview-settings").toggleClass("tqb-hide",1===e.get("load_next_question")),this.$(".tqb-tooltip-demo").toggleClass("tqb-hide",1!==e.get("highlight_and_show_feedback")),this.$(".tqb-feedback-text").html(1===e.get("highlight_and_show_feedback")?ThriveQuizB.t.highlight_and_feedback_text:ThriveQuizB.t.feedback_text)}),this),this.feedback_view.model.on("change",(function(e){this.$(".tqb-button-holder").toggleClass("tqb-hide",1!==e.get("press_next"))}),this),this.$(".tqb-feedback-settings, .tqb-preview-settings").toggleClass("tqb-hide",1===this.hilight_view.model.get("load_next_question")),this.$(".tqb-tooltip-demo").toggleClass("tqb-hide",1!==this.hilight_view.model.get("highlight_and_show_feedback")),this.$(".tqb-button-holder").toggleClass("tqb-hide",1!==this.feedback_view.model.get("press_next")),this.$(".tqb-feedback-text").html(1===this.hilight_view.model.get("highlight_and_show_feedback")?ThriveQuizB.t.highlight_and_feedback_text:ThriveQuizB.t.feedback_text)},render_default_settings:function(){this.feedback_view=new ThriveQuizB.views.AnswerFeedbackExtendedSettings({model:this.model.get("feedback_settings"),el:this.$(".tqb-feedback-settings")}),this.feedback_view.render(),new ThriveQuizB.views.PreviewFeedbackSettings({el:this.$(".tqb-preview-settings")}).render(),this.feedback_view.model.on("change",(function(e){this.showPreview(e)}),this),this.showPreview(this.feedback_view.model),this.$(".tqb-prev-demo").addClass("tqb-normal-answer")},showPreview:function(e){if(!(!e instanceof Backbone.Model)){var t=1===e.get("display_feedback")||1===e.get("press_next");this.$(".tqb-feedback-settings, .tqb-preview-settings").toggleClass("tqb-hide",1===e.get("load_next_question")),this.$(".tqb-feedback-settings, .tqb-preview-settings").toggleClass("tqb-hide",1===e.get("load_next_question")),this.$(".tqb-tooltip-demo").toggleClass("tqb-hide",!t),this.$(".tqb-button-holder").toggleClass("tqb-hide",1!==e.get("press_next"))}},render_personality_settings:function(){this.renderAddCategoryItem(),this.model.get("results").each(this.renderCategoryItem,this),this.model.get("results").on("add_item",(function(e){this.model.get("results").add(e),this.renderCategoryItem(e),this.renderAddCategoryItem()}),this),this.render_default_settings()},renderAddCategoryItem:function(){this.addCatView&&(this.addCatView.undelegateEvents(),this.addCatView.$el.empty()),this.addCatView=new ThriveQuizB.views.AddCategoryItem({model:new ThriveQuizB.models.Base({quiz_id:this.model.get("ID"),text:""}),el:this.$(".add-category-holder"),collection:this.model.get("results")}),this.addCatView.render()},renderCategoryItem:function(e){var t=new ThriveQuizB.views.CategoryItem({item:e.get("text"),quiz_model:this.model,model:e});this.$("#tqb-multiple-input-wrapper").append(t.render().$el)}}),ThriveQuizB.views.AddCategoryItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("new-category-item"),events:{"click #tqb-add-result":"add","keypress input":function(e){13===e.which&&(this.model.get("text").length||this.model.set("text",e.currentTarget.value),this.add())}},render:function(){return this.$el.html(this.template({model:this.model})),TVE_Dash.data_binder(this),this},add:function(){this.collection.length>=ThriveQuizB.data.max_interval_number?TVE_Dash.err(ThriveQuizB.t.maximum_limit_of_results):this.model.get("text").length?this.model.get("text").length>255?TVE_Dash.err(ThriveQuizB.t.category_title_too_long):this.collection.trigger("add_item",this.model):TVE_Dash.err(ThriveQuizB.t.category_title_required)}}),ThriveQuizB.views.ResultsSettings=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("redirect-settings"),messageView:null,events:{"click .tqb-add-new-link":function(){if(!this.$(".tqb-redirect-link-form").length){var e=new ThriveQuizB.models.RedirectLink({lower_bound:this.model.get("minimum_result"),upper_bound:this.model.get("maximum_result"),quiz_id:this.model.get("post_parent"),page_id:this.model.get("ID")}),t=new ThriveQuizB.views.RedirectLinkForm({model:e,settings:this.model.toJSON()});e.on("tqb:added",(function(e){this.model.get("links")instanceof ThriveQuizB.collections.RedirectLinks&&(this.model.get("links").add(e),this.renderLinks(this.model.get("links")))}),this),this.$("#tgb-redirect-links").after(t.render().$el)}}},render:function(){return this.$el.html(this.template({item:this.model})),TVE_Dash.data_binder(this),this.model.get("links")instanceof ThriveQuizB.collections.RedirectLinks&&(this.renderLinks(this.model.get("links")),this.listenTo(this.model.get("links"),"tqb:link:saved",(function(){this.renderLinks(this.model.get("links"))})),this.listenTo(this.model.get("links"),"remove",(function(){this.renderLinks(this.model.get("links"))})),this.listenTo(this.model.get("links"),"change",this.toggleQuizStatus)),"personality"===this.model.get("quiz_type")?this.$(".tqb-add-new-link").hide():this.$(".tqb-add-new-link").css("display","inline-block"),this.listenTo(this.model,"change:display_message",_.bind((function(e,t){t?this.messageView=this.renderMessageView():this.messageView.remove(),e.isValid()&&e.save()}),this)),this.listenTo(this.model,"change:forward_results",_.bind((function(e,t){this.$("#tqb-redirect-params-wrapper").toggle(t),e.isValid()&&e.save()}),this)),this.listenTo(this.model.get("message"),"change",(function(e){e.isValid()&&this.model.save()})),this.model.get("display_message")&&(this.messageView=this.renderMessageView()),this.$("#tqb-redirect-params-wrapper").toggle(!!this.model.get("forward_results")),this},toggleQuizStatus:function(){if(this.model.get("links")instanceof ThriveQuizB.collections.RedirectLinks){var e=this.model.get("links").validate(this.model);this.$(".tqb-quiz-not-ready").toggle(!e),this.$(".tqb-quiz-ready").toggle(e)}},renderLinks:function(e){if(e instanceof ThriveQuizB.collections.RedirectLinks){this.toggleQuizStatus(),e.sort(),this.$("#tqb-redirect-links-header")[e.length?"show":"hide"](),this.$("#tqb-no-redirect-links")[e.length?"hide":"show"](),"personality"===this.model.get("quiz_type")&&this.$("#tqb-redirect-links-header").hide();var t=this.$("#tqb-redirect-links");t.empty();var i=this;e.each((function(e,s,r){var n=new ThriveQuizB.views.RedirectLink({model:e,settings:i.model.toJSON()});t.append(n.render().$el)}),this)}},renderMessageView:function(){var e=new ThriveQuizB.views.RedirectMessage({model:this.model.get("message")}).render();return this.$("#tqb-message-wrapper").html(e.$el),e}}),ThriveQuizB.views.RedirectMessage=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("results-links/message"),initialize:function(e){e.model||(this.model=new ThriveQuizB.models.RedirectMessage)},render:function(){return this.$el.html(this.template({model:this.model})),TVE_Dash.data_binder(this),this}}),ThriveQuizB.views.RedirectLink=ThriveQuizB.views.Base.extend({className:"tvd-row",template:TVE_Dash.tpl("results-links/item"),result_template:TVE_Dash.tpl("results-links/category-item"),settings:{minimum_result:0,maximum_result:0},events:{"change select":"on_type_changed","click .tqb-delete-link":function(){var e={itemView:this,model:this.model,width:"600px","max-width":"60%"};this.modal(ThriveQuizB.views.ModalDeleteRedirectLink,e)},"change .tqb-lower-bound":function(e){var t=parseInt(e.currentTarget.value);return t<this.settings.minimum_result||t>this.settings.maximum_result?TVE_Dash.err(TVE_Dash.sprintf("Invalid Lower Bound. It should be between %s and %s !",[this.settings.minimum_result,this.settings.maximum_result])):t>this.model.get("upper_bound")?TVE_Dash.err(ThriveQuizB.t.redirect_link.errors.lower_bound_greater_than_upper_bound):(this.model.set("status","valid"),this.model.setLowerBound(t),void this.model.collection.save())},"change .tqb-upper-bound":function(e){var t=parseInt(e.currentTarget.value);return t<this.settings.minimum_result||t>this.settings.maximum_result?TVE_Dash.err(TVE_Dash.sprintf("Invalid Upper Bound. It should be between %s and %s !",[this.settings.minimum_result,this.settings.maximum_result])):t<this.model.get("lower_bound")?TVE_Dash.err(ThriveQuizB.t.redirect_link.errors.upper_bound_lower_than_lower_bound):(this.model.set("status","valid"),this.model.setUpperBound(t),void this.model.collection.save())},"change .tqb-link-target":function(e){if("external"===this.model.get("type")&&this.model.set("link",e.currentTarget.value),!1===this.model.isValid())return TVE_Dash.err(this.model.validationError);"personality"===this.settings.quiz_type&&this.model.set("status","valid");var t=this;this.model.save(null,{success:function(){t.render()}})},"click .tqb-edit-redirect-link":function(){var e=this.$(".tqb-link-target").show();"local"===this.model.get("type")?(e.val(TVE_Dash.escapeHTML(this.model.get("post_title"))),this.init_autocomplete()):(e.val(this.model.get("link")),this.$(".tqb-link-target").autocomplete(),this.$(".tqb-link-target").autocomplete("destroy"));var t=e.val(),i=this;e.focus().blur((function(){this.value===t&&i.render()}))}},initialize:function(t){t&&t.settings&&(this.settings=e.extend({},this.settings,t.settings)),this.listenTo(this.model,"change:status",this.render),this.listenTo(this.model,"change:lower_bound",this.render),this.listenTo(this.model,"change:upper_bound",this.render)},render:function(){return"personality"===this.settings.quiz_type?this.$el.html(this.result_template({item:this.model})):this.$el.html(this.template({item:this.model})),this.model.get("post_title")&&0!==this.model.get("post_title").length||0!==this.model.get("link").length||(this.$(".tqb-edit-redirect-link").hide(),this.$(".tqb-link-target").show().attr("placeholder","Search for content"),this.init_autocomplete()),this.$(".tqb-redirect-status-icon").toggleClass("tqb-redirect-hidden","valid"===this.model.get("status")),this.$("select").val(this.model.get("type")),TVE_Dash.materialize(this.$el),this},on_type_changed:function(e){var t=this.model.get("type"),i=e.currentTarget.value;this.$(".tqb-redirect-link-target").remove(),this.$(".tqb-link-target").val("").show().attr("placeholder","local"===i?ThriveQuizB.t.redirect_link.search_content:ThriveQuizB.t.redirect_link.add_url),this.model.set("type",i),this.$(".tqb-edit-redirect-link").hide(),"local"===i?this.init_autocomplete():(this.$(".tqb-link-target").autocomplete(),this.$(".tqb-link-target").autocomplete("destroy"));var s=this;this.$(".tqb-link-target").blur((function(){""===this.value&&(s.model.set("type",t),s.render())})),setTimeout((function(e){e.$(".tqb-link-target").focus()}),0,this)},init_autocomplete:function(){var t=this,i=this.$(".tqb-link-target");i.autocomplete({minLength:3,source:function(t,i){e.ajax({url:ajaxurl,dataType:"json",type:"post",data:{action:"tqb_admin_ajax_controller",route:"post_search",s:t.term,_nonce:ThriveQuizB.admin_nonce},success:function(e){i(e)},error:function(){i([])}})},select:function(e,s){return t.model.reset_target(),t.model.set("post_id",s.item.id),t.model.set("post_title",s.item.label),t.model.set("status","valid"),i.val(TVE_Dash.escapeHTML(s.item.label)).trigger("change").blur(),!1}}).data("ui-autocomplete")._renderItem=function(t,i){var s=e("<span>"),r=e("<span>");return e(t).addClass("tqb-redirect-dropdown"),s.append(i.label),r.append(i.type),e("<li>").append(s,r).appendTo(t)}}}),ThriveQuizB.views.RedirectLinkForm=ThriveQuizB.views.Base.extend({className:"tqb-redirect-link-form",template:TVE_Dash.tpl("results-links/form"),$link_type:null,settings:{minimum_result:0,maximum_result:0},events:{"click .tqb-cancel-link":"remove","click .tqb-save-link":"save","change #tqb-link-target":function(e){"external"===this.model.get("type")&&this.model.set("link",e.currentTarget.value)}},initialize:function(e){this.settings=e&&e.settings||this.settings,this.listenTo(this.model,"change:type",this.type_changed)},render:function(){return this.$el.html(this.template({item:this.model})),this.$link_type=this.$("#tqb-link-type"),this.$link_type.val(this.model.get("type")),this.$search=this.$("#tqb-link-target"),"local"===this.model.get("type")&&this.autocomplete(),TVE_Dash.data_binder(this),TVE_Dash.materialize(this.$el),this},type_changed:function(e,t){this.model.reset_target(),this.$search.val(""),"external"===t?(this.$search.autocomplete("destroy"),this.$search.attr("placeholder",ThriveQuizB.t.redirect_link.add_url)):(this.$search.attr("placeholder",ThriveQuizB.t.redirect_link.search_content),this.autocomplete())},save:function(){if(!1!==this.model.isValid(this.settings)){if(this.settings.links instanceof ThriveQuizB.collections.RedirectLinks){var e=!1,t=!1;if(this.settings.links.each((function(i){!e&&parseInt(this.model.get("lower_bound"))>=parseInt(i.get("lower_bound"))&&parseInt(this.model.get("lower_bound"))<=parseInt(i.get("upper_bound"))&&(e=!0),!t&&parseInt(this.model.get("upper_bound"))>=parseInt(i.get("lower_bound"))&&parseInt(this.model.get("upper_bound"))<=parseInt(i.get("upper_bound"))&&(t=!0)}),this),e||t)return TVE_Dash.err("Lower or Upper bounds are already set for another link")}this.model.save({},{success:function(e){e.trigger("tqb:added",e)},error:function(e){TVE_Dash.err(e.responseText)}}),this.remove()}},autocomplete:function(){var t=this;this.$search.autocomplete({minLength:3,source:function(t,i){e.ajax({url:ajaxurl,dataType:"json",type:"post",data:{action:"tqb_admin_ajax_controller",route:"post_search",s:t.term,_nonce:ThriveQuizB.admin_nonce},success:function(e){i(e)},error:function(){i([])}})},select:function(e,i){t.model.set("post_id",i.item.id)},close:function(){var e=TVE_Dash.escapeHTML(t.$search.val());t.$search.val(e)}}).data("ui-autocomplete")._renderItem=function(t,i){var s=e("<span>"),r=e("<span>");return e(t).addClass("tqb-redirect-dropdown"),s.append(i.label),r.append(i.type),e("<li>").append(s,r).appendTo(t)}}})})),(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}ThriveQuizB.views=ThriveQuizB.views||{},function(t){t((function(){t("body").on("click",".tqb-toggle-settings",(function(e){TVE_Dash.modal(ThriveQuizB.views.ModalSettings,{"max-width":"35%"})})),ThriveQuizB.views.ModalSteps=TVE_Dash.views.Modal.extend({stepClass:".tqb-modal-step",currentStep:0,$step:null,events:{"click .tqb-modal-next-step":"next","click .tqb-modal-prev-step":"prev"},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this},gotoStep:function(e){var t=this.steps.hide().eq(e).show(),i=this;return this.$step=t,setTimeout((function(){i.input_focus(t)}),50),this.currentStep=e,this},next:function(){this.beforeNext(),this.gotoStep(this.currentStep+1),this.afterNext()},prev:function(){this.beforePrev(),this.gotoStep(this.currentStep-1),this.afterPrev()},beforeNext:function(){return this},afterNext:function(){return this},beforePrev:function(){return this},afterPrev:function(){return this}}),ThriveQuizB.views.ModalNewQuiz=ThriveQuizB.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/new-quiz"),events:function(){return _.extend({},ThriveQuizB.views.ModalSteps.prototype.events,{"click .tqb-new-quiz-tpl":"chooseQuizTemplate","click .tvd-modal-submit":"save"})},afterInitialize:function(){this.listenTo(this.model,"change:tpl",_.bind((function(){var e=this.templates.findWhere({id:this.model.get("tpl")});this.model.set("post_title",e.get("is_empty")?"":e.get("name")),this.model.set("tpl",e.get("id"))}),this))},afterRender:function(){this.steps=this.$(this.stepClass).hide(),this.gotoStep(0),this.renderTemplates(),ThriveQuizB.util.data_binder(this)},chooseQuizTemplate:function(e){var i=t(e.target).closest(".tvd-card")[0],s=this.$(".tqb-new-quiz-tpl");this.$el.find(".tqb-modal-next-step").removeAttr("disabled"),TVE_Dash.select_card(t(i),s),this.model.set("tpl",i.dataset.id),this.renderDescription()},renderTemplates:function(){var e=this.$(".tqb-new-quiz-templates");return e.empty(),this.data.templates.each((function(t){e.append(TVE_Dash.tpl("modals/new-quiz-tpl",{item:t}))}),this),this},renderDescription:function(){var e=this.$(".tqb-new-quiz-description"),t=this.model.get("tpl");if(t){var i=this.data.templates.findWhere({id:t});e.html("<span>"+i.get("description")+"</span>&nbsp;"),e.append(i.get("learn_more")),ThriveQuizB.util.bind_wistia()}},next:function(){if(!this.model.get("tpl"))return TVE_Dash.err(ThriveQuizB.t.QuizMissingTemplate);this.gotoStep(this.currentStep+1)},save:function(e){var t=this;this.model.isValid()&&(TVE_Dash.showLoader(),this.model.set("order",0,{silent:!0}),this.model.save(null,{success:function(e,i){if(e.set("ID",i),t.collection.unshift(e),ThriveQuizB.shown_quizzes.order){var s=ThriveQuizB.shown_quizzes.order[ThriveQuizB.quizzes_details.quizzes_displayed-1];ThriveQuizB.quizzes_details.quizzes_number===ThriveQuizB.quizzes_details.quizzes_displayed||ThriveQuizB.quizzes_details.quizzes_displayed<ThriveQuizB.quizzes_details.quizzes_displayed.max_quiz_number?ThriveQuizB.quizzes_details.quizzes_displayed+=1:ThriveQuizB.shown_quizzes.visible[s]=!1,ThriveQuizB.shown_quizzes.visible[i]=!0}ThriveQuizB.quizzes_details.quizzes_number+=1,ThriveQuizB.globals.quizzes.add(t.model,{at:t.collection.length}),t.close(),ThriveQuizB.router.navigate(e.get_edit_route(),{trigger:!0})},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_save_fail_toast)},complete:function(){TVE_Dash.hideLoader()}}))}}),ThriveQuizB.views.ModalEditQuizType=ThriveQuizB.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/edit-quiz-type"),className:"tvd-modal tqb-feedback-modal",modal_step:0,edit_mode:!1,events:function(){return _.extend({},ThriveQuizB.views.ModalSteps.prototype.events,{"click .tqb-quiz-selector":"changeQuizType","click .tqb-modal-submit":"save"})},afterInitialize:function(e){this.quiz_model=e.quiz_model,this.modal_step=e.modal_step,this.edit_mode=e.edit_mode||this.edit_mode,this.listenTo(this.model,"change:type",_.bind((function(){var e=this.types.findWhere({key:this.model.get("type")});this.renderQuizType(e)}),this))},afterRender:function(){if(this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(this.modal_step),this.edit_mode&&this.$el.find(".tqb-modal-prev-step").html(ThriveQuizB.t.cancel),1===this.modal_step&&this.$el.find("#tqb-quiz-type-results-message").html(ThriveQuizB.t.personality_result_change_text),this.$el.find(".tqb-modal-type-action").hide(),this.model.get("type")){var e=this.types.findWhere({key:this.model.get("type")});this.renderQuizType(e)}TVE_Dash.data_binder(this)},changeQuizType:function(e){var i=e.currentTarget,s=t(i).attr("data-type"),r=t(i).attr("data-description"),n=t(i).attr("data-learn-more"),a=t(i).children(".tvd-card"),o=this.$el.find(".tvd-card");TVE_Dash.select_card(a,o),this.$el.find("#tqb-quiz-type-description").html(r+" "+n),ThriveQuizB.util.bind_wistia(),this.model.set("type",s),this.$(".tqb-save").toggleClass("tqb-hide","survey"!==s),this.$(".tqb-continue").toggleClass("tqb-hide","survey"===s)},renderQuizType:function(e){e.get("has_next_step")&&(this.changeNextButton("tqb-modal-submit","tqb-modal-next-step"),this.$el.find(".tqb-modal-type-action").text(ThriveQuizB.t.continue),"number"!==e.get("key")&&'"percentage"'!==e.get("key")||this.model.set("results",new ThriveQuizB.collections.Options([])))},changeNextButton:function(e,t){this.$el.find(".tqb-modal-type-action").show().removeClass(e).addClass(t)},gotoStep:function(e){this.$el.css({height:2===e?"40%":"70%"}),ThriveQuizB.views.ModalSteps.prototype.gotoStep.apply(this,arguments)},prev:function(){if(this.quiz_settings_view&&this.quiz_settings_view.undelegateEvents(),this.edit_mode)return this.close();var e=this.currentStep;switch(this.model.get("type")){case"right_wrong":e=this.currentStep-2;break;case"personality":e=this.currentStep-1;break;case"percentage":case"number":case"survey":e=this.currentStep-3}this.gotoStep(e)},next:function(){if(!this.model.get("type"))return TVE_Dash.err(ThriveQuizB.t.QuizMissingType);var e=this.currentStep;switch(this.model.get("type")){case"right_wrong":e=this.currentStep+2;break;case"personality":e=this.currentStep+1;break;case"percentage":case"number":e=this.currentStep+3}this.gotoStep(e),this.quiz_settings_view=new ThriveQuizB.views.QuizExtraSettings({model:this.model,el:this.$step.find(".tqb-quiz-extra-settings")}),this.quiz_settings_view.render()},save:function(){if(this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);var e=this,i=t(".tqb-edit-quiz-type");TVE_Dash.showLoader(),this.model.get("results").each((function(e){e&&!e.get("text")&&e.destroy()})),this.model.prepareForSave(),this.model.save(null,{success:function(t,s){e.quiz_model.set("type",t.get("type")),e.quiz_model.set("results",new ThriveQuizB.collections.Options(s.returned_results)),e.quiz_model.set("feedback_settings",t.get("feedback_settings")),e.quiz_model.set("highlight_settings",t.get("highlight_settings")),e.quiz_model.structure_set()||i.html(ThriveQuizB.t.change_type);try{var r=ThriveQuizB.globals.quizzes.findWhere({ID:e.quiz_model.get("ID")});r instanceof ThriveQuizB.models.Quiz&&r.set("type",t.get("type"))}catch(e){console.log("Error: "+e)}TVE_Dash.success(s.responseText)},error:function(e,t){TVE_Dash.err(t.responseText)},complete:function(){TVE_Dash.hideLoader(),e.close()}})}}),ThriveQuizB.views.ModalEditQuizStyle=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/edit-quiz-style"),className:"tvd-modal tvd-modal-fixed-footer tqb-choose-quiz-style",events:{"click .tqb-quiz-style-item":"selectStyleItem","click .tvd-modal-submit":"save"},afterRender:function(){var e=this.collection.indexOf(this.collection.findWhere({id:this.model.get("style")}));-1!==e&&this.collection.models.splice(0,0,this.collection.models.splice(e,1)[0]),this.collection.each(this.renderOne,this)},renderOne:function(e){var t=this.model.get("style")===e.get("id"),i=new ThriveQuizB.views.QuizStyleItem({model:e});t&&(this.selected_stye=e.get("id")),this.$("#tqb-quiz-styles-list").append(i.render(t).$el)},selectStyleItem:function(e){var i=t(e.currentTarget),s=i.attr("data-style"),r=i.parent().find(".tqb-card-style-item");TVE_Dash.select_card(i.find(".tvd-card").first(),r),this.selected_stye=s},save:function(){if(this.tvd_clear_errors(),!this.selected_stye)return TVE_Dash.err(ThriveQuizB.t.style_warning);this.model.set("style",this.selected_stye);var e=this,t=new ThriveQuizB.models.QuizStyle({style:this.model.get("style"),quiz_id:this.model.get("ID"),structure:this.model.get("structure")});TVE_Dash.showLoader(),t.save(null,{success:function(t,i){e.model.trigger("tqb_style_changed")},error:function(e,t){},complete:function(){TVE_Dash.hideLoader(),e.close()}})}}),ThriveQuizB.views.ModalAddVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/add-variation"),events:{"click .tvd-modal-submit":"save"},afterRender:function(){this._prepare_translations(),ThriveQuizB.util.data_binder(this)},_prepare_translations:function(){var e=this;this.$(".tqb-translate").each((function(){var i=t(this).html();i=i.replace("%s",e.model.get_name()),t(this).html(i)}))},save:function(){if(this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);var e=this;TVE_Dash.showLoader(),this.model.save(null,{success:function(t,i){e.model.trigger("add:parent_post",i),-1!==Backbone.history.getFragment().indexOf("dashboard/page/")?(t.set({id:i.id,tcb_editor_url:i.tcb_editor_url}),e.collection.add(t)):ThriveQuizB.router.navigate("#dashboard/page/"+i.page_id,{trigger:!0})},error:function(e,t){},complete:function(){TVE_Dash.hideLoader(),e.close()}})}}),ThriveQuizB.views.ModalReAddVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/add-variation"),events:{"click .tvd-modal-submit":"save"},afterRender:function(){this._prepare_translations(),ThriveQuizB.util.data_binder(this)},_prepare_translations:function(){var e=this;this.$(".tqb-translate").each((function(){var i=t(this).html();i=i.replace("%s",e.model.get_name()),t(this).html(i)}))},save:function(){if(this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);var e=this;TVE_Dash.showLoader(),this.model.save(null,{success:function(t,i){e.model.trigger("add:parent_post",i),t.set({id:i.id,tcb_editor_url:i.tcb_editor_url}),e.page_model.get("variations").add(t)},error:function(e,t){},complete:function(){TVE_Dash.hideLoader(),e.close()}})}}),ThriveQuizB.views.ModalResetVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/reset-variation"),events:{"click .tvd-modal-submit":"reset"},reset:function(){var e=this;TVE_Dash.showLoader(),this.model.resetStatistics({success:function(t){delete t.id,delete t.page_id,delete t.quiz_id,e.model.set(t)},error:function(){},complete:function(){e.close(),TVE_Dash.hideLoader()}},this.model.toJSON())}}),ThriveQuizB.views.ModalResetQuiz=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/reset-quiz-stats"),events:{"click .tvd-modal-submit":"reset"},afterRender:function(){var e=this.$("p"),t=e.html();t=t.replace(/%s/g,this.model.get("post_title")),e.html(t)},reset:function(){var e=this;TVE_Dash.showLoader(),this.model.resetStatistics({success:function(t){TVE_Dash.success(ThriveQuizB.t.quiz_stats_reset),e.collection.trigger("tqb:reset-stats")},error:function(){TVE_Dash.err("Quiz statistics could not be reset")},complete:function(){e.close(),TVE_Dash.hideLoader()}},this.model.toJSON())}}),ThriveQuizB.views.ModalAnonymizeResults=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/anonymize-quiz-results"),events:{"click .tvd-modal-submit":"anonymize"},afterRender:function(){var e=this.$(".tvd-modal-title"),t=e.html();t=t.replace(/%s/g,this.model.get("post_title")),e.html(t)},anonymize:function(){var e=this;TVE_Dash.showLoader(),this.model.anonymizeResults({success:function(t){TVE_Dash.success("Quiz data was anonymized"),e.collection.trigger("tqb:reset-stats")},error:function(){TVE_Dash.err("Quiz data could not be anonymized")},complete:function(){e.close(),TVE_Dash.hideLoader()}},this.model.toJSON())}}),ThriveQuizB.views.ModalFilterReports=TVE_Dash.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/filter-reports"),className:"tvd-modal tqb-filter-reports-modal",modal_step:0,events:function(){return _.extend({},ThriveQuizB.views.ModalSteps.prototype.events,{"click .tvd-modal-submit":"save","click .tqb-filter-report-input":"setFilterFlag","change .tqb-filter-report-input":"setFilterFlag","click .tqb-category-checkbox":"updateCategoryList"})},afterInitialize:function(){this.results=this.quizModel.get("results").first(),"personality"!==this.quizModel.get("type")||this.categories&&0!==this.categories.length||(this.categories=[],this.quizModel.get("results").each(function(e){this.categories.push(e.get("text"))}.bind(this))),this.listenTo(this.model,"change:progress",this.toggleResultFilter)},resultIsWithinRage:function(){return"object"===e(this.results.toJSON())&&"min"in this.results.toJSON()&&"max"in this.results.toJSON()},shouldDisableResultFilter:function(){return["all","in_progress"].includes(this.model.get("progress"))},toggleResultFilter:function(){var e=this.shouldDisableResultFilter();this.$(".tqb-result-filter").children().toggleClass("tqb-disabled",e),this.$(".tqb-result-filter").toggleClass("tvd-tooltipped",e)},setFilterFlag:function(){this.model.tqb_filters=!0},afterRender:function(){this.model.get("progress")||this.model.set("progress","all",{silent:!0}),this.quizModel.get("type")!==ThriveQuizB.data.quiz_types.survey&&this.resultIsWithinRage()&&(this.model.get("result_min")||this.model.set("result_min",this.results.toJSON().min,{silent:!0}),this.model.get("result_max")||this.model.set("result_max",this.results.toJSON().max,{silent:!0})),this.toggleResultFilter();var e=this,t=new Date,i=new Date;this.model.get("date_started")?t=new Date(Date.parse(this.model.get("date_started"))):""!==this.model.get("date_started")&&(t.setDate(t.getDate()-7),this.model.set("date_started",t.toISOString().split("T")[0])),this.model.get("date_finished")?i=new Date(Date.parse(this.model.get("date_finished"))):""!==this.model.get("date_finished")&&this.model.set("date_finished",i.toISOString().split("T")[0]),this.$el.find("#tqb-report-date-started").pickadate({format:"yyyy-mm-dd",format_submit:"yyyy-mm-dd",onClose:function(){e.validateDate("start",e.$el.find("#tqb-report-date-started").val())},onStart:function(){""!==e.model.get("date_started")&&this.set("select",[t.getFullYear(),t.getMonth(),t.getDate()])}}),this.$el.find("#tqb-report-date-finished").pickadate({format:"yyyy-mm-dd",format_submit:"yyyy-mm-dd",onClose:function(){e.validateDate("end",e.$el.find("#tqb-report-date-finished").val())},onStart:function(){""!==e.model.get("date_finished")&&this.set("select",[i.getFullYear(),i.getMonth(),i.getDate()])}}),TVE_Dash.data_binder(this)},updateCategoryList:function(e){var i=this.$el.find(".tqb-category-checkbox:checked");if(0===i.length)return e.currentTarget.checked=!0,TVE_Dash.err(ThriveQuizB.t.min_one_category_selected),!1;var s=[];i.each((function(){s.push(t(this).attr("data-text"))})),this.model.set("categories",s)},validateDate:function(e,t){"start"===e&&this.model.get("date_started")!==t&&this.model.set("date_started",t),"end"===e&&this.model.get("date_finished")!==t&&this.model.set("date_finished",t),this.setFilterFlag()},onOpen:function(){this.model.saveState(),this.savePressed=0},onClose:function(){this.savePressed||this.model.restoreState(!0)},save:function(){var e=this.model.validate(this.results);if(e&&e.length)TVE_Dash.err(e[0]);else{this.$el.find("#tqb-numeric-error").hide(),TVE_Dash.showLoader();var t=this;this.shouldDisableResultFilter()&&(this.model.unset("result_min"),this.model.unset("result_max"),this.model.unset("categories")),this.model.unset("offset"),this.savePressed=1,this.model.save().done(_.bind((function(e){t.collection=new ThriveQuizB.collections.QuizUsers(e.data),t.model.set({total_pages:e.total_pages?e.total_pages:0,total_items:e.total_items?e.total_items:0}),t.model.trigger("tqb:filtered",t.collection)}))).always((function(){TVE_Dash.hideLoader(),t.close()}))}}}),ThriveQuizB.views.ModalArchiveLastVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/archive-last-variation"),afterInitialize:function(e){this.page_model=e.page_model}}),ThriveQuizB.views.ModalArchiveVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/archive-variation"),events:{"click .tvd-modal-submit":"save"},afterInitialize:function(e){this.page_model=e.page_model},save:function(){var e=this,t=this.model.get("is_control");this.model.set({post_status:ThriveQuizB.data.variation_status.archive}),TVE_Dash.showLoader(),this.model.save(null,{success:function(i,s){1==t&&s.new_control_id&&e.page_model.get("variations").get(s.new_control_id).set({is_control:1}),e.page_model.get("archived_variations").add(i),e.page_model.get("variations").remove(i),TVE_Dash.success(ThriveQuizB.t.archive_variation_success_toast)},error:function(e,t){TVE_Dash.err(ThriveQuizB.t.archive_variation_fail_toast)},complete:function(){TVE_Dash.hideLoader(),e.close()}})}}),ThriveQuizB.views.ModalDeleteVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/delete-variation"),events:{"click .tvd-modal-submit":"delete"},afterRender:function(){this.$el.addClass("tvd-red")},delete:function(){var e=this;TVE_Dash.showLoader(),this.model.destroy({success:function(e,t){TVE_Dash.success(ThriveQuizB.t.delete_variation_success_toast)},error:function(e,t){TVE_Dash.err(ThriveQuizB.t.delete_variation_fail_toast)},complete:function(){TVE_Dash.hideLoader(),e.close()}})}}),ThriveQuizB.views.ModalCopyShortcode=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/copy-quiz-shortcode"),className:"tvd-modal tqb-copy-shortcode-modal",events:{},afterRender:function(){this.bind_zclip()},bind_zclip:function(){TVE_Dash.bindZClip(this.$el.find("a.tvd-copy-to-clipboard"))}}),ThriveQuizB.views.ModalDeleteStructureItem=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/delete-structure-item"),events:{"click .tvd-modal-submit":"delete"},afterRender:function(){var e=this.$(".tqb-has-placeholder"),t=e.html().replace("%s",this.model.get("name"));e.html(t)},delete:function(){this.close(),this.model.trigger("tqb_render_structure_item")}}),ThriveQuizB.views.ModalDeleteRedirectLink=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/delete-redirect-link"),events:{"click .tvd-modal-submit":"delete"},afterRender:function(){var e=this.$(".tqb-has-placeholder"),t=e.html().replace("%s",this.data.model.get("lower_bound")+" - "+this.data.model.get("upper_bound"));e.html(t)},delete:function(){this.close(),this.model.destroy(),this.data.itemView.remove()}}),ThriveQuizB.views.ModalEditVariationTest=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/edit-variation-test"),events:{"click .tve-edit-variation-test":"saveTest","blur #auto_win_min_conversions":"checkMinimumConversions","blur #auto_win_min_duration":"checkMinimumDuration","blur #auto_win_chance_original":"checkChanceToBeatOriginal","change #tve-enable-test-settings":"toggleAutoWinSettings"},checkMinimumConversions:function(e){var t=jQuery(e.currentTarget);parseInt(t.val())<100?this.$el.find(".tve_engagements_notice").removeClass("tvd-hide"):this.$el.find(".tve_engagements_notice").addClass("tvd-hide")},checkMinimumDuration:function(e){var t=jQuery(e.currentTarget);parseInt(t.val())<7?this.$el.find(".tve_duration_notice").removeClass("tvd-hide"):this.$el.find(".tve_duration_notice").addClass("tvd-hide")},checkChanceToBeatOriginal:function(e){var t=jQuery(e.currentTarget);parseFloat(t.val())<90?this.$el.find(".tve_beat_original_notice").removeClass("tvd-hide"):this.$el.find(".tve_beat_original_notice").addClass("tvd-hide")},saveTest:function(e){var t=this;if(this.model.set("auto_win_enabled",this.$el.find("input[name='auto_win_enabled']").is(":checked")),this.model.set("auto_win_min_conversions",this.$el.find('input[name="auto_win_min_conversions"]').val()),this.model.set("auto_win_min_duration",this.$el.find('input[name="auto_win_min_duration"]').val()),this.model.set("auto_win_chance_original",this.$el.find('input[name="auto_win_chance_original"]').val()),this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);this.model.trigger("auto_win_changed"),TVE_Dash.showLoader(),this.model.save({},{success:function(){t.close(),TVE_Dash.hideLoader()}})},toggleAutoWinSettings:function(e){jQuery(e.currentTarget).is(":checked")?this.$el.find(".tve-winner-settings-input").show(0):this.$el.find(".tve-winner-settings-input").hide(0)}}),ThriveQuizB.views.ModalStopVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/stop-variation"),className:"tvd-modal tvd-red",events:{"click .tqb-stop-test-variation-action":"stopVariation"},initialize:function(){},stopVariation:function(e){var t=this;location.hash="#dashboard/test/"+t.model.get("test_id")+"/stop",TVE_Dash.showLoader(),t.model.set("active",0),t.model.save(null,{success:function(e,i){2==t.collection.length?ThriveQuizB.router.navigate("#dashboard/page/"+t.collection.first().get("page_id"),{trigger:!0}):ThriveQuizB.router.navigate("#dashboard/test/"+t.model.get("test_id"),{trigger:!0})},error:function(){location.hash="#dashboard/test/"+t.model.get("test_id"),TVE_Dash.err(ThriveQuizB.t.stopVariationFailToast)},complete:function(){t.close(),TVE_Dash.hideLoader()}})}}),ThriveQuizB.views.ModalStopVariationTest=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/stop-variation-test"),afterRender:function(){this.$el.addClass("tvd-stop-test-modal");var e=this.$el.find("#tqb-stop-variation"),t=this,i=t.collection.getHighestRateItem();return e.empty(),this.collection.each((function(s){s.set("show_graph",!1),s.on("tqb_close_modal",(function(){t.close()}));var r=new ThriveQuizB.views.TestItem({model:s,highest_id:i,page_id:t.model.get("page_id")});e.append(r.render().el)})),this}}),ThriveQuizB.views.ModalDeleteTest=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("tests/delete-test"),events:{"click .tve-confirm-delete-test":"deleteTest"},afterInitialize:function(e){this.$el.addClass("tvd-red")},deleteTest:function(e){var t=this;TVE_Dash.showLoader(),this.model.destroy({success:function(){t.model.trigger("tqb_test_removed"),TVE_Dash.success(ThriveQuizB.t.deleteTestToast)},error:function(){},complete:function(){t.close(),TVE_Dash.hideLoader()}})}}),ThriveQuizB.views.ModalVariationTest=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/variation-start-test"),className:"tvd-modal",events:{"click .tqb-toggle-dropdown":"toggleSettings","click .tqb-start-variation-test":"saveTest","change #tqb-enable-test-settings":"toggleAutoWinSettings","blur #auto_win_min_conversions":"checkMinimumConversions","blur #auto_win_min_duration":"checkMinimumDuration","blur #auto_win_chance_original":"checkChanceToBeatOriginal"},checkMinimumConversions:function(e){var t=jQuery(e.currentTarget);parseInt(t.val())<100?this.$el.find(".tqb_engagements_notice").removeClass("tvd-hide"):this.$el.find(".tqb_engagements_notice").addClass("tvd-hide")},checkMinimumDuration:function(e){var t=jQuery(e.currentTarget);parseInt(t.val())<7?this.$el.find(".tqb_duration_notice").removeClass("tvd-hide"):this.$el.find(".tqb_duration_notice").addClass("tvd-hide")},checkChanceToBeatOriginal:function(e){var t=jQuery(e.currentTarget);parseFloat(t.val())<90?this.$el.find(".tqb_beat_original_notice").removeClass("tvd-hide"):this.$el.find(".tqb_beat_original_notice").addClass("tvd-hide")},toggleSettings:function(){var e=this.$el.find("#tqb-winner-test-container");this.$el.find("#tqb-winner-test-settings"),e.is(":visible")?e.hide(0):e.fadeIn("fast")},toggleAutoWinSettings:function(e){jQuery(e.currentTarget).is(":checked")?this.$el.find(".tqb-winner-settings-input").show(0):this.$el.find(".tqb-winner-settings-input").hide(0)},saveTest:function(e){var t=this;if(this.model.set("title",this.$el.find('input[name="test_title"]').val()),this.model.set("notes",this.$el.find('textarea[name="test_notes"]').val()),this.model.set("conversion_goal",this.$el.find('input[name="conversion_goal"]:checked').val()),this.model.set("auto_win_enabled",this.$el.find("input[name='auto_win_enabled']").is(":checked")),this.model.set("auto_win_min_conversions",this.$el.find('input[name="auto_win_min_conversions"]').val()),this.model.set("auto_win_min_duration",this.$el.find('input[name="auto_win_min_duration"]').val()),this.model.set("auto_win_chance_original",this.$el.find('input[name="auto_win_chance_original"]').val()),this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);this.model.trigger("auto_win_changed"),TVE_Dash.showLoader(),this.model.save(null,{success:function(e,i){ThriveQuizB.router.navigate("#dashboard/test/"+i,{trigger:!0}),t.close(),TVE_Dash.hideLoader()}})}}),ThriveQuizB.views.ModalBadgeTemplates=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/badge-templates"),className:"tvd-modal tvd-modal-fixed-footer",events:{"click .tvd-modal-submit":"set_template"},afterInitialize:function(){this.badge_templates=ThriveQuizB.globals.badge_templates},afterRender:function(){var e=this,t=this.$("#tqb-badge-templates-list");this.badge_templates.each((function(i,s,r){var n=new ThriveQuizB.views.BadgeTemplateItem({model:i,collection:e.badge_templates});t.append(n.render().$el)}))},set_template:function(){var e=this.badge_templates.findWhere({selected:!0});if(!e)return TVE_Dash.err(ThriveQuizB.t.no_badge_template_selected);var t=this,i=new ThriveQuizB.models.ThriveImage({post_parent:ThriveQuizB.globals.quiz.get("ID"),template:e.get("key")});TVE_Dash.showLoader(),i.save(null,{wait:!0,success:function(e,i,s){t.collection.push(e),TVE_Dash.hideLoader(),window.location=e.get("editor_url")},error:function(e,t,i){TVE_Dash.err(t.responseJSON.data.message),TVE_Dash.hideLoader()},complete:function(){t.close()}})}}),ThriveQuizB.views.ModalViewUserAnswers=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/view-user-answers"),afterRender:function(){var e=this.$el.find("#tqb-user-quiz-answers-list");return e.empty(),this.collection.each((function(t){var i=new ThriveQuizB.views.UserQuestion({model:t});e.append(i.render().el)})),this}}),ThriveQuizB.views.ModalSettings=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/settings"),events:{"click .tqb-setting-checkbox":"checkCheckboxValue","click .tvd-modal-submit":"save_settings"},afterInitialize:function(){this.model=new ThriveQuizB.models.Settings(ThriveQuizB.data.settings)},checkCheckboxValue:function(e){var i=t(e.currentTarget),s={};s[i.attr("data-key")]=Number(i[0].checked),this.model.set(s)},save_settings:function(){var e=this;TVE_Dash.showLoader(),this.model.save(null,{success:function(e,t){ThriveQuizB.data.settings=t},complete:function(){TVE_Dash.hideLoader(),e.close()}})}}),ThriveQuizB.views.QuizSettings=TVE_Dash.views.Modal.extend({className:"tvd-modal tqb-feedback-modal",template:TVE_Dash.tpl("modals/quiz/settings"),events:{"click .tqb-modal-submit":"save"},afterRender:function(){new ThriveQuizB.views.QuizExtraSettings({el:this.getSettingEl(),model:this.model}).render()},getSettingEl:function(){var e=null;switch(this.model.get("type")){case"right_wrong":e=this.$(".tqb-quiz-settings-right-wrong");break;case"personality":e=this.$(".tqb-quiz-settings-personality");break;default:e=this.$(".tqb-quiz-settings")}return e},save:function(){if(this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);var e=this;TVE_Dash.showLoader(),this.model.prepareForSave(),this.model.save(null,{success:function(t,i){e.quiz_model.set("type",t.get("type")),e.quiz_model.set("results",new ThriveQuizB.collections.Options(i.returned_results)),e.quiz_model.set("feedback_settings",t.get("feedback_settings")),e.quiz_model.set("highlight_settings",t.get("highlight_settings")),TVE_Dash.success(i.responseText)},error:function(e,t){TVE_Dash.err(t.responseText)},complete:function(){TVE_Dash.hideLoader(),e.close()}})}}),ThriveQuizB.views.ModalExportQuiz=TVE_Dash.views.Modal.extend({className:"tvd-modal tqb-export-modal",template:TVE_Dash.tpl("modals/quiz/export"),events:{"click .tqb-cancel-export":"cancelExport","click #tqb-download-export":"close"},canceled:!1,process:null,afterInitialize:function(){this.process=this.startExport()},afterRender:function(){this.$(".tvd-modal-close-x").hide(),this.process.then(_.bind(this.exportQuizDetails,this)).then(_.bind(this.exportQuizQuestions,this)).then(_.bind(this.exportQuizBadge,this)).then(_.bind(this.exportQuizResultLinks,this)).then(_.bind(this.exportQuizStructure,this)).then(_.bind(this.exportFinished,this)).catch(_.bind(this.exportFailed,this)),this.$console=this.$("#tqb-export-console"),this.$btnDownload=this.$("#tqb-download-export"),this.$btnCancel=this.$(".tqb-cancel-export")},startExport:function(){var e={action:"tqb_admin_ajax_controller",route:"export_quiz",quiz_id:this.model.get("ID")};return Promise.resolve(e)},exportQuizDetails:function(e){return this.pushMessage("Exporting quiz details..."),e.step="details",this.doAjax(e)},exportQuizQuestions:function(e){return this.model.hasQuestions()&&this.pushMessage("Exporting quiz questions..."),e.step="questions",this.doAjax(e)},exportQuizBadge:function(e){return this.model.hasBadge()&&this.pushMessage("Exporting quiz badge..."),e.step="badge",this.doAjax(e)},exportQuizStructure:function(e){return this.pushMessage("Exporting quiz structure..."),e.step="structure",e.last_step=1,this.doAjax(e)},exportQuizResultLinks:function(e){return this.model.hasResultLinks()&&this.pushMessage("Exporting quiz result links..."),e.step="resultlinks",this.doAjax(e)},exportFinished:function(e){this.$btnDownload.show(),this.$btnDownload.attr("href",e.zip.url),this.$btnCancel.attr("disabled",!0),this.$(".tvd-modal-close-x").show()},exportFailed:function(e){e=_.extend({message:"Export failed"},e),this.$(".tvd-modal-close").show(),this.$btnCancel.hide(),this.pushMessage(e.message)},cancelExport:function(){this.canceled=!0,this.pushMessage("Canceling export process..."),this.close()},pushMessage:function(e){this.$console.append(t("<p/>").html(e))},doAjax:function(e){return new Promise((function(i,s){var r=e,n=ThriveQuizB.util.ajaxurl();t.ajax({url:n,data:r,type:"post"}).done((function(t){t.zip&&i(t),i(e)})).fail((function(e){s({message:e.responseJSON.message||"Export failed"})}))}))},beforeClose:function(){var e={action:"tqb_admin_ajax_controller",quiz_id:this.model.get("ID"),step:"clearexport",route:"export_quiz"};this.doAjax(e)}}),ThriveQuizB.views.ModalImportQuiz=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/quiz/import"),$dropArea:null,fileList:null,events:{"drop #tqb-drop-area":function(e){e.preventDefault(),this.fileList=e.dataTransfer.files,this.handleFile()},"dragover #tqb-drop-area":function(e){e.preventDefault()},"dragleave #tqb-drop-area":function(e){e.preventDefault()},"click .tqb-drop-blue":function(e){e.preventDefault(),this.$("#tqb-file-input").click()},"change #tqb-file-input":function(e){this.fileList=e.currentTarget.files,this.handleFile()},"click .tqb-modal-submit":function(){if(!0===this.validateFile()){TVE_Dash.showLoader();var e=new FormData,i=this;e.append("tqb_quiz_file",this.fileList.item(0)),e.append("action","tqb_admin_ajax_controller"),e.append("route","import_quiz");var s=ThriveQuizB.util.ajaxurl();t.ajax({url:s,data:e,type:"post",cache:!1,dataType:"json",processData:!1,contentType:!1}).done((function(e){e.quiz_id?(ThriveQuizB.shown_quizzes.order.push(e.quiz_id),ThriveQuizB.shown_quizzes.visible[e.quiz_id]=!0,ThriveQuizB.router.navigate("#dashboard/quiz/"+e.quiz_id,{trigger:!0}),TVE_Dash.success(e.message)):TVE_Dash.err(e.message),TVE_Dash.hideLoader(),i.close()})).fail((function(e){i.$(".tqb-state").hide(),i.$(".tqb-initial-state").show(),TVE_Dash.err(e.responseJSON.message),TVE_Dash.hideLoader()}))}}},afterInitialize:function(){jQuery.event.props.push("dataTransfer")},afterRender:function(){this.$dropArea=this.$("#tqb-drop-area")},handleFile:function(){this.isZip()&&(this.$(".tqb-state").hide(),this.$(".tqb-ready-state").html('<span class="tqb-import-title">'+this.fileList.item(0).name+"</span>").show())},validateFile:function(){return!!(this.fileList&&this.fileList.length&&this.isZip())||(TVE_Dash.err(ThriveQuizB.t.invalid_import_file),!1)},isZip:function(){var t=this.fileList.item(0);return"object"===e(t)&&t.type&&("application/x-zip-compressed"===t.type||"application/zip"===t.type)}})}))}(jQuery)})(),ThriveQuizB.util=ThriveQuizB.util||{},_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},Backbone.ajax=function(){return-1===arguments[0].url.indexOf("_nonce")&&(arguments[0].url+="&_nonce="+ThriveQuizB.admin_nonce),Backbone.$.ajax.apply(Backbone.$,arguments)},function(e){window.addEventListener("message",(function(t){t.data.event&&"tqb_question_counter_update"==t.data.event&&(0==parseInt(e(".tqb-questions-number").text())||0==t.data.number?ThriveQuizB.globals.EditedQuiz.view.model.fetch({success:function(){ThriveQuizB.globals.EditedQuiz.view.render()}}):e(".tqb-questions-number").html(t.data.number))}),!1),ThriveQuizB.util.states={normal:"normal",delete:"delete"},ThriveQuizB.util.bind_wistia=function(){window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes()},ThriveQuizB.util.structure_items={splash:{name:ThriveQuizB.t.splash_name,mandatory:!1},qna:{name:ThriveQuizB.t.qna_name,mandatory:!0},optin:{name:ThriveQuizB.t.optin_name,mandatory:!1},results:{name:ThriveQuizB.t.results_name,mandatory:!0}},ThriveQuizB.util.ajaxurl=function(e){var t=-1!==ajaxurl.indexOf("?")?"&":"?";return e&&e.length?(e=e.replace(/^(\?|&)/,""),e+="&_nonce="+ThriveQuizB.admin_nonce,ajaxurl+t+e):ajaxurl+t+"_nonce="+ThriveQuizB.admin_nonce},ThriveQuizB.util.setLoading=function(e){e.addClass("tvd-disabled"),e.prepend('<span class="tvd-icon-spinner mdi-pulse tvo-small-icon tvd-margin-right-small"></span>')},ThriveQuizB.util.removeLoading=function(e){e.removeClass("tvd-disabled"),e.find(".tvd-icon-spinner").remove()},ThriveQuizB.util.showHideNoQuizInfo=function(){ThriveQuizB.globals.quizzes.length?e(".tqb-no-quiz-wrapper").hide():e(".tqb-no-quiz-wrapper").show()},ThriveQuizB.util.roundNumber=function(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i},ThriveQuizB.util.createInitialStructureObject=function(e){var t={},i={},s=null;return Object.keys(ThriveQuizB.data.quiz_structure_item_types).forEach((function(r,n){s=ThriveQuizB.data.quiz_structure_item_types[r].key,void 0!==e[s]&&((i=e[s]).key=s,t[r]=i)})),t},ThriveQuizB.util.data_binder=function(t,i){if(void 0===i&&(i=t.model),!(!i instanceof Backbone.Model)){var s=t.$el.find("[data-bind]").each((function(){var s=e(this),r=s.attr("data-bind"),n=!1;s.on("change",(function(){var e,t=(e=s).is(":checkbox")?!!e.is(":checked"):e.is(":radio")?e.is(":checked")?e.val():"":e.val();i.get(r)!=t&&(n=!0,i.set(r,t),n=!1)})),t.listenTo(i,"change:"+r,(function(){var e,i;n||(e=s,i=this.model.get(r),e.is(":radio")?t.$el.find('input[name="'+e.attr("name")+'"]:radio').filter('[value="'+i+'"]').prop("checked",!0):e.is(":checkbox")?e.prop("checked",!!i):e.val(i))}))}));t.listenTo(i,"invalid",(function(e,t){_.isArray(t)?_.each(t,(function(e){var t=e;e.field&&(t=e.field);var i=s.filter('[data-bind="'+t+'"]').first().addClass("tvd-validate tvd-invalid").focus();e.message&&i.siblings("label").attr("data-error",e.message),(i.is(":radio")||i.is(":checkbox"))&&TVE_Dash.err(i.next("label").attr("data-error"))})):_.isString(t)&&TVE_Dash.err(t)}))}}}(jQuery),ThriveQuizB.globals=ThriveQuizB.globals||{},function(e){var t=Backbone.Router.extend({view:null,$el:e("#tqb-admin-dashboard-wrapper"),routes:{dashboard:"dashboard","dashboard/quiz/:id":"quizEdit","purge-cache":"purgeCache","reports(/:id)":"reports","reports(/:id)(/:type)":"reports","dashboard/page/:id/redirect-settings":"redirectSettings","dashboard/page/:id(/:is_default)":"editQuizPages","dashboard/test/:id":"editQuizPageTest"},breadcrumbs:{col:null,view:null},init_breadcrumbs:function(){this.breadcrumbs.col=new ThriveQuizB.collections.Breadcrumbs,this.breadcrumbs.view=new ThriveQuizB.views.Breadcrumbs({collection:this.breadcrumbs.col})},set_page:function(t,i,s){this.breadcrumbs.col.reset(),s=s||{},this.breadcrumbs.col.add_page(ThriveQuizB.dash_url,ThriveQuizB.t.Thrive_Dashboard,!0),_.each(s,_.bind((function(e){this.breadcrumbs.col.add_page(e.route,e.label)}),this)),this.breadcrumbs.col.add_page("",i);var r=e("head > title");this.original_title||(this.original_title=r.html()),r.html(i+" &lsaquo; "+this.original_title)},dashboard:function(){this.set_page("dashboard",ThriveQuizB.t.Dashboard);var t=this;function i(){t.view=new ThriveQuizB.views.Dashboard({collection:ThriveQuizB.globals.quizzes}),t.$el.html(t.view.render().$el),ThriveQuizB.util.bind_wistia(),ThriveQuizB.util.showHideNoQuizInfo(),ThriveQuizB.globals.quizzes.length<ThriveQuizB.quizzes_details.max_quiz_number&&e("#tqb-no-search-result, .tqb-load-more-section").hide()}if(TVE_Dash.showLoader(),this.view&&this.view.remove(),ThriveQuizB.globals.quizzes.length)return i();ThriveQuizB.globals.quizzes.fetch({update:!0,success:i,error:function(e,t,i){TVE_Dash.err(ThriveQuizB.t.error_fetching_quizzes,1e4),TVE_Dash.hideLoader()}})},reports:function(e,t){if(!e)if(this.view&&this.view.model)e=this.view.model.get("ID");else{var i=ThriveQuizB.globals.quizzes.findWhere({is_valid:!0});e=i instanceof ThriveQuizB.models.Quiz?i.get("ID"):null}if(!t)return this.navigate("#reports/"+e+"/completions",{trigger:!0});this.set_page("reports",ThriveQuizB.t.Reporting,[{route:"dashboard",label:ThriveQuizB.t.Dashboard}]),TVE_Dash.showLoader(),this.view&&this.view.remove(),this.view=new ThriveQuizB.views.Reporting({model:new ThriveQuizB.models.Reporting({selected:e}),collection:new ThriveQuizB.collections.ReportQuizzes,report_type:t}),this.$el.html(this.view.render().$el),TVE_Dash.hideLoader()},quizEdit:function(t){if(this.view&&this.view.remove(),TVE_Dash.opened_modal_view&&TVE_Dash.opened_modal_view.close(),e(".tvd-material-tooltip").hide(),t){ThriveQuizB.globals.EditedQuiz=this;var i=this,s=new ThriveQuizB.models.Quiz({ID:t});TVE_Dash.showLoader(),s.fetch({cache:!1,success:function(e,t,s){ThriveQuizB.globals.quiz=e,i.view=new ThriveQuizB.views.EditQuiz({model:e}),i.$el.html(i.view.render().$el),i.set_page("dashboard/quiz",e.get("post_title"),[{route:"dashboard",label:ThriveQuizB.t.Dashboard}]),e.on("change:post_title",(function(){i.set_page("dashboard/quiz",e.get("post_title"),[{route:"dashboard",label:ThriveQuizB.t.Dashboard}])})),TVE_Dash.hideLoader()}}).error((function(e){TVE_Dash.err(e.responseText),TVE_Dash.hideLoader(),ThriveQuizB.router.navigate("#dashboard",{trigger:!0})}))}else ThriveQuizB.router.navigate("#dashboard",{trigger:!0})},editQuizPageTest:function(t){if(this.view&&this.view.remove(),TVE_Dash.opened_modal_view&&TVE_Dash.opened_modal_view.close(),e(".tvd-material-tooltip").hide(),t){var i=this,s=new ThriveQuizB.models.Test({id:t});TVE_Dash.showLoader(),s.fetch({success:function(e,t,s){e&&(e.set("status",Number(e.get("status"))),i.view=new ThriveQuizB.views.QuizPageTest({model:e,completed_tests:new ThriveQuizB.collections.Tests(e.get("completed_tests"))}),i.$el.html(i.view.$el),i.view.render(),i.set_page("dashboard/page",e.get("title"),[{route:"dashboard",label:ThriveQuizB.t.Dashboard},{route:"dashboard/quiz/"+e.get("quiz_id"),label:e.get("quiz_name")}])),TVE_Dash.hideLoader()}}).error((function(e){TVE_Dash.err(e.responseText),TVE_Dash.hideLoader(),ThriveQuizB.router.navigate("#dashboard",{trigger:!0})}))}else ThriveQuizB.router.navigate("#dashboard",{trigger:!0})},editQuizPages:function(t,i){if(this.view&&this.view.remove(),TVE_Dash.opened_modal_view&&TVE_Dash.opened_modal_view.close(),e(".tvd-material-tooltip").hide(),t){var s=this,r=new ThriveQuizB.models.Page({ID:t});TVE_Dash.showLoader(),r.fetch({data:{viewed:!0},success:function(e,t,r){i&&e.set("is_default",!0),s.view=new ThriveQuizB.views.QuizPageVariations({model:e,completed_tests:new ThriveQuizB.collections.Tests(e.get("completed_tests"))}),s.$el.html(s.view.render().$el),s.set_page("dashboard/page",e.get("tqb_page_name"),[{route:"dashboard",label:ThriveQuizB.t.Dashboard},{route:"dashboard/quiz/"+e.get("post_parent"),label:e.get("quiz_name")}]),TVE_Dash.hideLoader()}}).error((function(e){TVE_Dash.err(e.responseText),TVE_Dash.hideLoader(),ThriveQuizB.router.navigate("#dashboard",{trigger:!0})}))}else ThriveQuizB.router.navigate("#dashboard",{trigger:!0})},redirectSettings:function(t){if(this.view&&this.view.remove(),TVE_Dash.showLoader(),e(".tvd-material-tooltip").hide(),!t)return ThriveQuizB.router.navigate("#dashboard",{trigger:!0});this.view=new ThriveQuizB.views.ResultsSettings,new ThriveQuizB.models.ResultsSettings({ID:t}).fetch({success:_.bind((function(e){this.view.model=e,this.$el.html(this.view.render().$el),this.set_page("dashboard/page",ThriveQuizB.t.redirect_settings,[{route:"dashboard",label:ThriveQuizB.t.Dashboard},{route:"dashboard/quiz/"+e.get("post_parent"),label:e.get("quiz_name")}])}),this),error:_.bind((function(e,t){TVE_Dash.err(t.responseText)}),this)}).always((function(){TVE_Dash.hideLoader()}))},purgeCache:function(){TVE_Dash.showLoader(),e.ajax({type:"post",url:ajaxurl,dataType:"json",data:{action:"tqb_admin_ajax_controller",route:"settings",custom:"purge_cache",_nonce:ThriveQuizB.admin_nonce}}).done(_.bind((function(e){ThriveQuizB.globals.quizzes.reset(e),this.navigate("#dashboard",{trigger:!0})}),this)).always((function(){TVE_Dash.hideLoader()}))}});e((function(){ThriveQuizB.globals.quizzes=new ThriveQuizB.collections.Quizzes(ThriveQuizB.data.quizzes),ThriveQuizB.globals.badge_templates=new ThriveQuizB.collections.BadgeTemplates(ThriveQuizB.badge_templates),new Promise((function(e,t){ThriveQuizB.globals.quizzes.fetch({update:!0,success:e,error:t})})).then((function(){ThriveQuizB.router=new t,ThriveQuizB.router.init_breadcrumbs(),Backbone.history.stop(),Backbone.history.start({hashchange:!0}),Backbone.history.fragment||ThriveQuizB.router.navigate("#dashboard",{trigger:!0})}))}))}(jQuery),ThriveQuizB.LineChart=Backbone.Model.extend({defaults:function(){return{id:"",title:"",renderTo:"",type:"line",data:[]}},initialize:function(){var e=this.get("title"),t=this.get("type"),i=this.get("renderTo"),s=this.get("legend");this.chart=this.dochart(e,t,i,s)},redraw:function(){var e=this.get("title"),t=this.get("data"),i=this.get("x_axis"),s=this.get("y_axis"),r=[],n=this.get("x_axis").length;for(var a in t){r.push(t[a].id);var o=this.chart.get(t[a].id);o&&null!==o?o.setData(t[a].data):this.chart.addSeries(t[a],!1,!1)}for(a=0;a<this.chart.series.length;a++)r.indexOf(this.chart.series[a].options.id)<0&&(this.chart.series[a].remove(!1),a--);this.chart.get("time_interval").setCategories(i),this.chart.xAxis[0].update({tickInterval:n>13?Math.ceil(n/13):1}),this.chart.setTitle({text:e}),this.chart.yAxis[0].axisTitle&&this.chart.yAxis[0].axisTitle.attr({text:s}),this.chart.redraw(),this.chart.hideLoading()},showLoading:function(){this.chart.showLoading()},hideLoading:function(){this.chart.hideLoading()},dochart:function(e,t,i,s){var r={};return s&&(r={layout:"vertical",backgroundColor:"#FFFFFF",align:"right",verticalAlign:"top",floating:!1,y:75,x:-50}),new Highcharts.Chart({chart:{type:t,renderTo:i,style:{fontFamily:"Open Sans,sans-serif"}},colors:ThriveQuizB.chart_colors,yAxis:{allowDecimals:!1,title:{text:"Conversions"},min:0},xAxis:{id:"time_interval"},credits:{enabled:!1},title:{text:e},legend:r,tooltip:{shared:!1,useHTML:!0,formatter:function(){return"scatter"!=this.series.type&&this.x+"<br/>"+this.series.name+": <b>"+this.y+"</b>"}},plotOptions:{series:{dataLabels:{shape:"callout",backgroundColor:"rgba(0, 0, 0, 0.75)",style:{color:"#FFFFFF",textShadow:"none"}},events:{legendItemClick:function(){"scatter"==this.type&&(this.visible?jQuery(".highcharts-data-labels").hide():jQuery(".highcharts-data-labels").show())}}}}})}}),ThriveQuizB.PieChart=Backbone.Model.extend({defaults:function(){return{id:"",title:"",data:[]}},initialize:function(){var e=this.get("title");this.get("data"),this.chart=this.dopie(e)},redraw:function(){var e=this.get("title"),t=this.get("data");this.get("x_axis"),this.chart.series[0].setData(t),this.chart.setTitle(e),this.chart.redraw(),this.chart.hideLoading()},showLoading:function(){this.chart.showLoading()},hideLoading:function(){this.chart.hideLoading()},dopie:function(e){return new Highcharts.Chart({chart:{renderTo:"tve-report-chart",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},colors:ThriveQuizB.chart_colors,credits:{enabled:!1},title:{text:e},plotOptions:{pie:{allowPointSelect:!1,cursor:"default",showInLegend:!0,dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},tooltip:{formatter:function(){return this.key+": "+parseInt(this.y)}},series:[{type:"pie",name:e}]})}}),ThriveQuizB.Pie3DChart=Backbone.Model.extend({defaults:function(){return{id:"",data:[],colors:[]}},initialize:function(){var e=this.get("renderTo"),t=this.get("data"),i=[];this.get("total"),t.forEach((function(e,t){if(e.percent>0){var s={};s.name=e.image.url?'<img src="'+e.image.url+'" height="30" width="30"/>':e.text,s.y=e.percent,s.color=e.color,i.push(s)}})),this.doChart(i,e)},showLoading:function(){this.chart.showLoading()},hideLoading:function(){this.chart.hideLoading()},doChart:function(e,t){return new Highcharts.Chart({tooltip:{pointFormat:"<b>{point.percentage:.1f}%</b>",useHTML:!0},legend:{enabled:!1},chart:{renderTo:t,type:"pie",options3d:{enabled:!0,alpha:25,beta:0}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:35,showInLegend:!1,dataLabels:{enabled:!1}}},title:{text:""},series:[{type:"pie",data:e}]})}}),ThriveQuizB.BarChart=Backbone.Model.extend({defaults:function(){return{id:"",data:[],colors:[]}},initialize:function(){var e=this.get("renderTo"),t=this.get("data"),i=this.get("colors"),s=0,r=100,n=100;for(var a in t)t[a][0]<r&&(r=t[a][0]),t[a][t[a].length-1]>s&&(s=t[a][t[a].length-1]),(t[a][t[a].length-1]-t[a][0])/2<n&&(n=(t[a][t[a].length-1]-t[a][0])/2);for(var a in r=r>n/3?r-n/3:0,s+=n/3,t){for(var o,l=[],h=1;h<t[a].length;h++)l.push({data:[{low:t[a][h-1],high:t[a][h]}]});o=(t[a][0]+t[a][t[a].length-1])/2,this.doChart(l,o,r,s,i[a],e+"-"+a)}},showLoading:function(){this.chart.showLoading()},hideLoading:function(){this.chart.hideLoading()},doChart:function(e,t,i,s,r,n){return new Highcharts.Chart({chart:{renderTo:n,type:"columnrange",inverted:!0,height:50,width:240,spacing:[10,10,10,10]},colors:r,plotOptions:{columnrange:{grouping:!1}},title:{text:""},xAxis:{title:{text:""},labels:{enabled:!1},lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",minorTickLength:0,tickLength:0},yAxis:{title:{text:""},labels:{enabled:!1},plotLines:[{color:"#000000",value:t,width:1,zIndex:100}],min:i,max:s,lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",minorTickLength:0,tickLength:0},legend:{enabled:!1},credits:{enabled:!1},tooltip:{enabled:!1},series:e})}})})();