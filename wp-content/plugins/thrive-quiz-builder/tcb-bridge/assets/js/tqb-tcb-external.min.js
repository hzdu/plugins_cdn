(()=>{var e,t={1886:e=>{e.exports={RedirectQuizCompletedLabel:{def:"Quiz Completed!",key:"red_quiz_completed_label"},RedirectResultsLabel:{def:"Show results",key:"red_results_label"},RedirectRetakeQuizLabel:{def:"Retake quiz",key:"red_retake_quiz_label"},RedirectRetakeQuiz:{key:"red_retake_quiz"},SaveUserProgress:{key:"save_user_progress"}}},9183:e=>{var t;function i(e){var i=t.qna_templates[e];return i?(i=jQuery("<textarea/>").html(i).text(),_.template(i,_.templateSettings)):null}var n=Backbone.Model.extend({initialize:function(e){e.settings&&this.set("settings",new Backbone.Model(e.settings))},get_image:function(){return"string"==typeof this.get("image")?this.get("image"):this.get("image").sizes.full.url},isImageAnswer:function(e){return 2===parseInt(e.get("q_type"))}});e.exports=function(e,r){r.question.data.display_settings=JSON.parse(r.question.data.display_settings),r.question.data.settings=JSON.parse(r.question.data.settings),t=r;var o=new n(r.question.data);e.html(r.qna_html?r.qna_html:r.html);var a=e.is(".tqb-shortcode-new-content")?e:e.find(".tqb-shortcode-new-content");a.append(i("questionWrapper")()),a.find(".tqb-question-container").replaceWith(i("questionContainer")({item:o,display_type:r.question.data.display_settings.type})),o.get("media")&&a.prepend(o.get("media")),a.find(".tqb-question-text").replaceWith(i("questionText")({item:o})),a.find(".tqb-question-description").replaceWith(i("questionDescription")({item:o})),o.get_image()&&a.find(".tqb-question-container").append('<div class="tqb-question-image-container"><img src="'+o.get_image()+'"></div>'),a.find(".tqb-answers-container").replaceWith(i("answersContainer")()),_.each(r.question.answers,(function(e){var t="answerItem",r=new n(e);3===parseInt(o.get("q_type"))?t="answerOpenItem":r.isImageAnswer(o)&&(t="answerImageItem",a.find(".tqb-answers-container").addClass("tqb-answer-has-image"));var s=jQuery(i(t)({item:r,question:o,settings:o.get("settings")}));if(r.isImageAnswer(o)&&s.find(".tqb-answer-image-container").html('<img src="'+r.get_image()+'" alt="" class="tqb-answer-image">'),a.find(".tqb-answers-container").append(s[0].outerHTML),3===parseInt(o.get("q_type"))){var l=jQuery("<div/>").addClass("tqb-answer-oeq").html(o.get("settings").get("placeholder"));a.find(".tqb-answer-action").removeClass("tqb-open-ended-wrapper"),a.find(".tqb-answer-open-type").html(l).addClass("tqb-answer-oeq-type").removeClass("tqb-answer-open-type"),a.find(".tqb-answer-inner-wrapper").removeClass("tqb-open-ended-wrapper")}})),a.find(".tqb-fancy-container, .tqb-answer-open-type .thrv_text_element").remove(),a.removeClass("tcb-row-empty tcb-elem-placeholder"),a.find(".tqb-image-answer").removeClass("tqb-hide");var s=jQuery("<style/>").addClass("tve_custom_style").html(r.tve_custom_style);a.is(".tqb-shortcode-new-content")?a.append(s):a.find(".tqb-shortcode-new-content").append(s)}},1109:(e,t,i)=>{var n=TVE.shortcode_manager,r=null,o=null,a=i(4631),s=i(1886);e.exports=TVE.Views.Base.component.extend({$redirectionOverrideAdvanced:null,before_update:function(){this.resetConfigCache(),this.setQuiz(this.getQuizID()),this.toggleRedirectionOverride(this.getConfig()[s.SaveUserProgress.key],!1)},setQuiz:function(e){return this.quiz=TQB.quizzes[e],this.quiz},resetConfigCache:function(){r=null,o=null},getQuizID:function(){return parseInt(this.getConfig().quiz_id)},controls_init:function(){this.$redirectionOverrideAdvanced=this.$(".tqb-redirection-override"),this.$redirectionOverrideControls=this.$(".tqb-redirection-override-extra-controls");var e=this;this.controls.change_quiz.update=function(t){var i=[];Object.values(TQB.quizzes).reverse().forEach((function(e){i.push({value:e.ID,name:e.post_title})})),this.build_options(i);var n=e.getConfig();this.setValue(n.quiz_id)},this.controls.change_quiz.input=function(e,t){TVE.main.trigger("insert_quiz",t.value)},this.controls.quiz_scroll.update=function(t){var i=!1;if(t.attr("data-enable_scroll"))i="on"===t.attr("data-enable_scroll");else{var n=e.getConfig(),r=_.filter(Object.values(TQB.quizzes),(function(e){return e.ID&&parseInt(e.ID)===parseInt(n.quiz_id)}))[0];i=r&&r.auto_scroll&&parseInt(r.auto_scroll)}this.setChecked(i)},this.controls.quiz_scroll.input=function(e,t){var i=!0===t.checked?"on":"off";e.attr("data-enable_scroll",i)},this.controls.SaveUserQuizProgress.update=function(e){var t=this.component.getConfig()[s.SaveUserProgress.key],i=t&&Number(t);this.setChecked(i)},this.controls.SaveUserQuizProgress.input=function(e,t){var i=Number(t.checked);this.component.updateConfig(s.SaveUserProgress.key,i),this.component.toggleRedirectionOverride(i,!0)},this.placeholder_panel=new a({component:this,minWidth:250,no_buttons:!0}),TVE.add_action("tve.conditional_display.activate",(function(t){var i=t.find(".tqb-shortcode-new-content");if(i.length){var n=i.data("quiz-id");e.loadQuiz(n,i)}})),TVE.main.on("insert_quiz ",(function(t){e.loadQuiz(t,TVE.ActiveElement)})),TVE.add_filter("tcb.symbol.before_save",(function(e){var t="__CONFIG_quiz_shortcode__";if(e.symbol_content.includes(t)){var i,n,r=jQuery("<div>"+e.symbol_content+"</div>"),o=r.find(".thrive-quiz-builder-shortcode > .thrive-shortcode-config");o.length&&((i=o.html().match(new RegExp(t+"(.*)"+t)))&&((n=JSON.parse(i[1])).in_tcb_editor="inside_tcb"),o.html(t+JSON.stringify(n)+t),e.symbol_content=r.html())}return e}))},toggleRedirectionOverride:function(e,t){var i=this.quiz&&"url"===this.quiz.results_page_type,n=e&&i;this.$redirectionOverrideAdvanced[n?"show":"hide"](),this.$redirectionOverrideControls.empty(),i&&(t&&(e?(this.updateConfig(s.RedirectQuizCompletedLabel.key,s.RedirectQuizCompletedLabel.def),this.updateConfig(s.RedirectResultsLabel.key,s.RedirectResultsLabel.def),this.updateConfig(s.RedirectRetakeQuiz.key,1),this.updateConfig(s.RedirectRetakeQuizLabel.key,s.RedirectRetakeQuizLabel.def)):(this.deleteConfig(s.RedirectQuizCompletedLabel.key),this.deleteConfig(s.RedirectResultsLabel.key),this.deleteConfig(s.RedirectRetakeQuiz.key),this.deleteConfig(s.RedirectRetakeQuizLabel.key))),this.generateRedirectionOverrideControls())},generateRedirectionOverrideControls:function(){this.$redirectionOverrideControls.append('<div class="tqb-redirect-override-completed-label"></div>'),this.$redirectionOverrideControls.append('<div class="tqb-redirect-override-results-label"></div>'),this.$redirectionOverrideControls.append('<div class="tqb-redirect-override-allow-retake"></div>'),this.$redirectionOverrideControls.append('<div class="tqb-redirect-override-retake-label"></div>');var e=new TVE.Views.Controls.LabelInput({el:this.$el.find(".tqb-redirect-override-completed-label"),component:this,model:{config:{"full-width":!0,label:"Quiz completed label"}}});e.change=function(e,t){this.component.updateConfig(s.RedirectQuizCompletedLabel.key,t.value.trim())},e.update=function(e){this.setValue(this.component.getConfig()[s.RedirectQuizCompletedLabel.key])};var t=new TVE.Views.Controls.LabelInput({el:this.$el.find(".tqb-redirect-override-results-label"),component:this,model:{config:{"full-width":!0,label:"Show results label"}}});t.change=function(e,t){this.component.updateConfig(s.RedirectResultsLabel.key,t.value.trim())},t.update=function(e){this.setValue(this.component.getConfig()[s.RedirectResultsLabel.key])};var i=new TVE.Views.Controls.Switch({el:this.$el.find(".tqb-redirect-override-allow-retake"),component:this,model:{config:{name:"",label:"Allow users to retake quiz"}}});i.change=function(e,t){this.component.updateConfig(s.RedirectRetakeQuiz.key,Number(t.checked)),this.component.toggleRetakeLabel(t.checked)},i.update=function(e){var t=this.component.getConfig()[s.RedirectRetakeQuiz.key],i=t&&Number(t);this.setValue(i),this.component.toggleRetakeLabel(i)};var n=new TVE.Views.Controls.LabelInput({el:this.$el.find(".tqb-redirect-override-retake-label"),component:this,model:{config:{"full-width":!0}}});n.change=function(e,t){this.component.updateConfig(s.RedirectRetakeQuizLabel.key,t.value.trim())},n.update=function(e){this.setValue(this.component.getConfig()[s.RedirectRetakeQuizLabel.key])},e.update(TVE.ActiveElement),n.update(TVE.ActiveElement),t.update(TVE.ActiveElement),i.update(TVE.ActiveElement)},toggleRetakeLabel:function(e){this.$(".tqb-redirect-override-retake-label")[e?"show":"hide"]()},placeholder_action:function(){this.placeholder_panel.open(TVE.ActiveElement,TVE.ActiveElement.find(".tcb-inline-placeholder-action"))},getConfig:function(){return null===r&&(r=n(TVE.ActiveElement.find(".thrive-shortcode-config"),"quiz_shortcode")),null===o&&(o=r.get()),o},updateConfig:function(e,t){null!==r&&null!==o||this.getConfig(),o[e]=t,r.update(t,e)},deleteConfig:function(e){null===r&&this.getConfig(),r.remove(e),delete o[e]},loadQuiz:function(e,t){var n=this;n.quiz_ajax({quiz_id:e}).done((function(r){r&&(n.resetConfigCache(),TVE.Editor_Page.blur(),(r=TVE.apply_filters("tqb_change_quiz_before_insert",r)).qna_templates?i(9183)(t,r):t.html(r),t.removeClass("tcb-row-empty tcb-elem-placeholder"),t.find(".tqb-fancy-icon").remove(),t.removeAttr("data-enable_scroll"),TVE.inner.window.TCB_Front.handleIframes(t,!0),TVE.Editor_Page.focus_element(t,null,{afterInsert:1,quizID:e})),TVE.main.overlay("close")}))},quiz_ajax:function(e,t){var i={type:"post",dataType:"json",url:TQB.ajaxurl};if(TVE.main.overlay(),e.action="tqb_frontend_ajax_controller",e.route="shortcode",e.tqb_in_tcb_editor="inside_tcb",e._nonce=TQB.security,i.data=e,t)for(var n in t)i[n]=t[n];return jQuery.ajax(i,e)}})},4631:e=>{var t;t=jQuery,e.exports=TVE.Views.InlinePanel.extend({template:TVE.tpl("inline/content-templates"),after_initialize:function(){this.$(".drop-panel").addClass("small-pad tcb-autocomplete"),this.autocomplete()},autocomplete:function(){var e=this.$el;this.$input=this.$(".tcb-search").autocomplete({minLength:0,source:function(e,i){var n=Object.values(TQB.quizzes);n.forEach((function(e,t){n[t].label=e.post_title,n[t].id=e.ID})),i(t.ui.autocomplete.filter(n,e.term).slice(0,5))},appendTo:this.$(".popup-content"),select:function(e,t){return TVE.main.trigger("insert_quiz",t.item.id),e.stopPropagation(),!1},open:function(t,i){e.find(".ui-menu-item-wrapper").removeClass("ui-menu-item-wrapper ui-state-active")}}),this.$input.data("ui-autocomplete")._renderItem=function(e,i){e.addClass("tcb-suggest");var n=new RegExp(this.term,"i");return t("<li></li>").data("item.autocomplete",i).append('<a href="#" class="tcb-truncate">'+i.label.replace(n,'<span class="highlight">'+this.term+"</span>")+"</a>").appendTo(e)}},onOpen:function(){this.$input.val("").focus().autocomplete("search")}})},9404:(e,t,i)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}e.exports=function(e){return{$_root:e=e||TVE.Editor_Page.$body,ids:[],getIds:function(){return this.ids.length||_.each(this.$_root.find(".thrive-quiz-builder-shortcode"),(function(e){var t,i=(t=jQuery(e),TVE.shortcode_manager(t.find(".thrive-shortcode-config"),"quiz_shortcode").get());this.ids.push(i.quiz_id)}),this),this.ids},fetch:function(){return e={quizzes:this.getIds()},t={type:"post",dataType:"json",url:TQB.ajaxurl},TVE.main.overlay(),e.action="tqb_frontend_ajax_controller",e.route="render_shortcode",e._nonce=TQB.security,t.data=e,jQuery.ajax(t,e);var e,t},render:function(){var e=this;this.fetch().done((function(t){_.each(t,(function(t,i){e.html(t)})),TVE.main.overlay("close")}))},html:function(e){var t=this.$_root.find('.tqb-shortcode-new-content[data-quiz-id="'+e.quiz_id+'"]');"object"===n(e.qna_templates)?i(9183)(t,e):(t.html(e.html),t.find(".tqb-fancy-icon").remove(),TVE.inner.window.TCB_Front.handleIframes(t,!0))}}}}},i={};function n(e){var r=i[e];if(void 0!==r)return r.exports;var o=i[e]={exports:{}};return t[e](o,o.exports,n),o.exports}(e=jQuery)(window).on("tcb_main_ready",(function(){e.extend(!0,TVE,{Views:{Components:{quiz:n(1109)}}})})).on("tcb.register-hooks",(function(){TVE.add_filter("tcb.toc.headers",(function(e){return e.not(".thrive-quiz-builder-shortcode *")})),TVE.add_action("tcb-ready",(function(){n(9404)().render()}))}))})();