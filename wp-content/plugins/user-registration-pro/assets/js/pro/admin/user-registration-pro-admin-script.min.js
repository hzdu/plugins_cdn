jQuery(function(e){var t={init:function(){this.initalize_form_reset_settings(),this.initalize_whitelist_domain_settings(),this.initalize_form_auto_password_generation_settings(),this.initialize_conditional_logic_settings(),this.initialize_extension_page(),this.initialize_external_fields_mapping(),this.init_all_tooltips(),this.manage_tooltip_fields(),this.init_export_custom_fields()},init_all_tooltips:function(){var t={theme:"tooltipster-borderless",maxWidth:200,multiple:!0,interactive:!0,position:"bottom",contentAsHTML:!0,functionInit:function(e,t){var i=jQuery(t.origin).attr("data-tip");i&&e.content(i)}};e(".user-registration-help-tip").tooltipster(t)},initialize_external_fields_mapping:function(){e(document).ready(function(){e(document).on("user_registration_admin_before_form_submit",function(e,i){var n=t.save_external_mapping_settings();n.length>0&&(i.data.ur_pro_external_mapping_settings=n)}),t.hide_show_external_fields_mapping(),e(document).on("change","#user_registration_enable_external_fields_mapping_field",function(){t.hide_show_external_fields_mapping()}),e(document).on("change",".ur-pro-db-table-section",function(){t.hide_show_external_table_selection()});user_registration_pro_admin_script_data.ur_pro_form_fields;e(document).on("click",".ur-pro-external-field-map-group .add",function(){var i=e(this).closest(".ur-pro-field-mapping-box").attr("data-last-key"),n='<li class="ur-pro-external-field-map-group" data-key="'+ ++i+'">';n+='<div class="ur-pro-external-field-map-form-group">',n+='<select class="ur-pro-fields ur-pro-field-map-select" name="ur_pro_external_map_form_fields['+i+']">',n+='<option value="">-- Select Field --</option>',n+=t.get_fields_list(),n+="</select></div>",n+='<div class="ur-pro-operator"> <i class="dashicons dashicons-arrow-right-alt"></i> </div>',n+='<div class="ur-pro-value">',n+='<input name="user_registration_form_value['+i+']" class="ur_pro_external_field_name" placeholder="Enter Field Key" type="text" />',n+="</div>",n+='<span class="add">',n+='<i class="dashicons dashicons-plus"></i>',n+="</span>",n+='<span class="remove">',n+='<i class="dashicons dashicons-minus"></i>',n+="</span></li>",e(this).closest(".ur-pro-field-mapping-box").append(n),e(this).closest(".ur-pro-field-mapping-box").attr("data-last-key",i)}),e(document).on("click",".ur-pro-external-field-map-group .remove",function(){e(".ur-pro-field-mapping-box").find(".ur-pro-external-field-map-group").length>1&&e(this).parent().remove()}),e(document).on("change",".ur_pro_db_table",function(){$table=e(this).val(),e(".ur-spinner").remove(),t.retrive_db_table_columns($table)})})},initalize_whitelist_domain_settings:function(){e(document).ready(function(){var i=e("#user_registration_form_setting_enable_whitelist_domain"),n=e("#user_registration_form_setting_whitelist_domain_field"),r=e("#user_registration_form_setting_domain_restriction_settings_field");t.settings_fields_toggler(i,n),t.settings_fields_toggler(i,r),i.on("change",function(){t.settings_fields_toggler(e(this),n),t.settings_fields_toggler(e(this),r)})})},initalize_form_reset_settings:function(){e(document).ready(function(){var i=e("#user_registration_form_setting_enable_reset_button"),n=e("#user_registration_form_setting_form_reset_class_field"),r=e("#user_registration_form_setting_form_reset_label_field");t.settings_fields_toggler(i,n),t.settings_fields_toggler(i,r),i.on("change",function(){t.settings_fields_toggler(e(this),n),t.settings_fields_toggler(e(this),r)})})},initalize_form_auto_password_generation_settings:function(){e(document).ready(function(){var i=e("#user_registration_pro_auto_password_activate"),n=e("#user_registration_pro_auto_generated_password_length_field");t.settings_fields_toggler(i,n),i.on("change",function(){t.settings_fields_toggler(e(this),n)})})},initialize_conditional_logic_settings:function(){e(document).on("change",".ur-conditional-wrapper .ur_conditional_field",function(){t.replaceFieldValues(".ur-conditional-wrapper",this)}),e(document).find(".ur_use_conditional_logic_wrapper").each(function(){var t=e(this).closest(".ur_conditional_logic_container");e(this).find("#ur_use_conditional_logic").is(":checked")?t.find(".ur_conditional_logic_wrapper").show():t.find(".ur_conditional_logic_wrapper").hide()}),e(document).on("change","#ur_use_conditional_logic",function(){var t=e(this).closest(".ur_conditional_logic_container");e(this).is(":checked")?t.find(".ur_conditional_logic_wrapper").show():t.find(".ur_conditional_logic_wrapper").hide()})},hide_show_external_table_selection:function(){$selected_option=e(".ur-pro-db-table-section").val(),"external_table"===$selected_option?(t.init_all_tooltips(),e(".ur-pro-external-field-table-column-selection").show()):(e(".ur_pro_db_table").val(user_registration_pro_admin_script_data.ur_pro_db_prefix+"usermeta"),e(".ur_pro_user_id_db_column").val(""),e(".ur_pro_field_key_db_column").val(""),e(".ur_pro_field_value_db_column").val(""),e(".ur-pro-external-field-table-column-selection").hide())},hide_show_external_fields_mapping:function(){if(e("#user_registration_enable_external_fields_mapping").is(":checked"))if(0===e(".ur-pro-fields-mapping-container").length){var i=e(user_registration_pro_admin_script_data.ur_pro_external_fields_mapping_output),n=i.find(".ur-pro-field-map-select"),r='<option value="">-- Select Field --</option>'+t.get_fields_list();n.each(function(){var t=e(this).val();e(this).html(r),e(this).val(t),e(this).find('option[value="'+t+'"]').prop("selected",!0)}),e("#user_registration_enable_external_fields_mapping_field").after(i),t.hide_show_external_table_selection()}else e(".ur-pro-fields-mapping-container").show(),t.hide_show_external_table_selection();else e(".ur-pro-fields-mapping-container").hide()},get_fields_list:function(){var t="";return e(".ur-grid-lists .ur-selected-item .ur-general-setting").each(function(){var i=e(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-label label").text(),n=e(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-field").data("field-key");if("section_title"!=n&&"html"!=n&&"wysiwyg"!=n&&"billing_address_title"!=n&&"shipping_address_title"!=n){var r=e(this).find("[data-field='field_name']").val();void 0!==r&&(t+='<option value="'+r+'" data-type="'+n+'">'+i+"</option>")}}),t},settings_fields_toggler:function(e,t){e.is(":checked")?t.show():t.hide()},replaceFieldValues:function(t,i){var n=e("option:selected",i).attr("data-type"),r=e("option:selected",i).val(),a=e(i).closest(t).find(".ur-conditional-input"),o=a.attr("name"),s=a.attr("class");if("checkbox"==n||"radio"==n||"select"==n||"country"==n||"billing_country"==n||"shipping_country"==n||"select2"==n||"multi_select2"==n||"multi_choice"==n){if("select"==n||"radio"==n||"select2"==n||"multi_select2"==n)var l=e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return e(this).val()});else if("country"==n||"billing_country"==n||"shipping_country"==n)e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return e(this).val()}),e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return e(this).text()});else l=e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field input").map(function(){return e(this).val()});var _="<option value>--select--</option>";if("country"==n||"billing_country"==n||"shipping_country"==n){var u=e('.ur-general-setting-field-name input[value="'+r+'"').closest(".ur-selected-item").find(".ur-advance-selected_countries select option:selected"),d=[];e(this).find(".urcl-value select").html('<option value="">--select--</option>'),u.each(function(){var t=e(this).val(),i=e(this).text();d.push('<option value="'+t+'">'+i+"</option>")}),_=d.join("")}else 1==l.length&&""===l[0]?_='<option value="1">'+urcl_data.checkbox_checked+"</option>":e(l).each(function(e,t){_=_+'<option value="'+t+'">'+t+"</option>"});a.replaceWith('<select name="'+o+'" class="'+s+'">'+_+"</select>")}else a.replaceWith('<input type="text" name="'+o+'" class="'+s+'">')},retrive_db_table_columns:function(t){var i={action:"user_registration_pro_get_db_columns_by_table",security:user_registration_pro_admin_script_data.ur_pro_get_db_columns_by_table,table:t};e(".user_registration_user_id_db_column_label").append('<span class="ur-spinner"></span>'),e(".user_registration_field_key_db_column_label").append('<span class="ur-spinner"></span>'),e(".user_registration_field_value_db_column_label").append('<span class="ur-spinner"></span>'),e.ajax({url:user_registration_pro_admin_script_data.ajax_url,data:i,type:"POST",success:function(t){if(t.success&&"undefined"!=typeof t.data.columns){var i=JSON.parse(t.data.columns);e(".ur_pro_user_id_db_column option").remove(),e(".ur_pro_field_key_db_column option").remove(),e(".ur_pro_field_value_db_column option").remove(),e(".ur_pro_user_id_db_column").append(e("<option>",{value:"",text:"-- Select Column for User ID --"})),e(".ur_pro_field_key_db_column").append(e("<option>",{value:"",text:"-- Select Column for Field Key --"})),e(".ur_pro_field_value_db_column").append(e("<option>",{value:"",text:"-- Select Column for Field Value --  "}));e.each(i,function(t,i){'<option value="'+i+'">'+i+"</option>",e(".ur_pro_user_id_db_column").append(e("<option>",{value:i,text:i})),e(".ur_pro_field_key_db_column").append(e("<option>",{value:i,text:i})),e(".ur_pro_field_value_db_column").append(e("<option>",{value:i,text:i}))})}e(".ur-spinner").remove()}})},save_external_mapping_settings:function(){var t=[],i=e(".ur-pro-field-mapping-wrap");return e.each(i,function(){var i=e(this).find(".ur-pro-external-field-map-group"),n=[],r=[];e.each(i,function(){var t={ur_field:e(this).find(".ur-pro-field-map-select").val(),external_field:e(this).find(".ur_pro_external_field_name").val()};r.push(t)}),n.push(r);var a={db_table:e(".ur_pro_db_table").val(),user_id_db_column:e(".ur_pro_user_id_db_column").val(),field_key_db_column:e(".ur_pro_field_key_db_column").val(),field_value_db_column:e(".ur_pro_field_value_db_column").val(),mapped_fields:n};t.push(a)}),t},initialize_extension_page:function(){e(".ur_addons_wrap").find(".install-now").on("click",function(t){var i=e(this),n={action:"user_registration_pro_extension_install",security:user_registration_pro_admin_script_data.ur_pro_install_extension,slug:i.data("slug"),name:i.data("name")};t.preventDefault(),i.text("Installing..."),i.append('<span class="ur-spinner"></span>'),e.ajax({url:user_registration_pro_admin_script_data.ajax_url,data:n,type:"POST",success:function(t){var n='<div class="notice '+(t.success?"notice-success":"notice-error")+'"><p>'+t.message+"</p></div>";e(n).insertBefore(i.closest(".ur_addons_wrap").find(".subsubsub")),t.success?(i.text("Installed"),t.activateUrl&&(i.text("Activate"),i.removeClass("install-now").addClass("activate-now button-primary").attr("href",t.activateUrl),i.closest(".ur-plugin-card-bottom").find(".status-label").removeClass("status-install-now").addClass("status-inactive").text("Inactive"))):i.text(user_registration_pro_admin_script_data.ur_pro_extension_installed_failed_text).prop("disabled",!0),e(".ur-spinner").remove(),i.off("click")}})})},manage_tooltip_fields:function(){e('select[data-field="tooltip"]').each(function(){"yes"===e(this).val()?(e(this).closest(".ur-selected-item").find(".ur-label").find("label").append('<span class="ur-portal-tooltip"></span>'),e(this).closest(".ur-toggle-content").find(".ur-general-setting-tooltip-message").show(500)):e(this).closest(".ur-toggle-content").find(".ur-general-setting-tooltip-message").hide(500),e(document).on("click",".ur-selected-item",function(i){i.stopImmediatePropagation();var n=e(".ur-general-setting-field");e.each(n,function(){var i=e(this);switch(i.attr("data-field")){case"tooltip":t.trigger_general_setting_tooltip(i),i.on("change",function(){t.trigger_general_setting_tooltip(i)});break;case"tooltip_message":i.on("input",function(){t.trigger_general_setting_tooltip_message(i)})}})})})},trigger_general_setting_tooltip:function(t){var i=e(".ur-selected-item.ur-item-active"),n=t.closest("#ur-setting-form").find("[data-field='field_name']").val(),r=i.find("[data-field='field_name']").val();i.find(".ur-general-setting-block").find('select[data-field="'+t.attr("data-field")+'"] option').removeAttr("selected"),n===r&&(i.find(".ur-label").find(".ur-portal-tooltip").length>0&&i.find(".ur-label").find(".ur-portal-tooltip").remove(),"yes"===t.val()?(i.find(".ur-label").find("label").append('<span class="ur-portal-tooltip"></span>'),t.closest(".ur-toggle-content").find(".ur-general-setting-tooltip-message").show(500),i.find(".ur-general-setting-block").find('select[data-field="'+t.attr("data-field")+'"]').find('option[value="'+t.val()+'"]').attr("selected",!0)):(i.find(".ur-label").find("label").find("span.ur-portal-tooltip").remove(),t.closest(".ur-toggle-content").find(".ur-general-setting-tooltip-message").hide(500)))},trigger_general_setting_tooltip_message:function(t){e(".ur-selected-item.ur-item-active").find(".ur-general-setting-block").find('textarea[data-field="'+t.attr("data-field")+'"]').val(t.val())},init_export_custom_fields:function(){e("select.ur-input.forms-list").on("change",function(){var t=e('<span class="ur-spinner"></span>');e(".ur-export-custom-fields > p").append(t);var i=e(this).val();e.ajax({url:user_registration_pro_admin_script_data.ajax_url,data:{action:"user_registration_pro_get_form_fields_list_by_form_id",form_id:i,security:user_registration_pro_admin_script_data.ur_pro_get_form_fields_by_form_id},type:"post",success:function(i){e(".ur-form-fields-container").contents().slice(4).remove();var n=JSON.parse(i.data.form_field_list);e.each(n,function(t,i){var n=e('<input type="checkbox" name="csv-export-custom-fields[]" class="ur-custom-fields-input" checked>');n.val(t),e(".ur-form-fields-container").append(n),e(".ur-form-fields-container").append("&nbsp;"+i+"<br />")}),e("input.ur-all-fields-option").prop("checked",!0),e(".ur_export_csv_fields_dict").val(i.data.form_field_list),t.remove()}})}),e("input.ur-all-fields-option").on("change",function(){!0===e(this).prop("checked")?e(".ur-custom-fields-input").each(function(){e(this).prop("checked",!0)}):e(".ur-custom-fields-input").each(function(){e(this).prop("checked",!1)})}),e(document).on("change",".ur-custom-fields-input",function(){0===e(".ur-custom-fields-input:not(:checked)").length?e("input.ur-all-fields-option").prop("checked",!0):e("input.ur-all-fields-option").prop("checked",!1)})}};t.init()});