jQuery(function(s){var e=s(".edit-php.post-type-yith-wcbm-badge .page-title-action, .edit-php.post-type-yith-wcbm-badge .yith-plugin-fw__list-table-blank-state__cta"),t=s(".column-yith_wcbm_preview .yith-wcbm-badge"),i=function(e){return(e=e instanceof jQuery?e:s(this)).is(":checked")},d=function(e,t){var i=s(e),e=t||"#000000",a=i.css("color");if(i&&i.text().trim()){t=i.clone();if(t.find("*").remove(),t.text().trim())return e=a&&(-1!==a.indexOf("rgb")||-1!==a.indexOf("#")||-1!==a.indexOf("hsl"))?a:e;for(var o=i.find("> *"),n=-1;o[++n];)if(s(o[n]).text().trim())return d(o[n],a)}return e},a=function(e,t){var i=(e=e.replace("#",""))[0]+e[1],a=e[2]+e[3],e=e[4]+e[5],i=Math.round(t*parseInt(i,16)),a=Math.round(t*parseInt(a,16)),e=Math.round(t*parseInt(e,16));return"#"+((i<16?"0":"")+i.toString(16))+((a<16?"0":"")+a.toString(16))+((e<16?"0":"")+e.toString(16))},o=function(e){return s(e).find("p").map(function(e,t){var i=s(t).find("span").css("font-size");return i&&s(t).css("line-height",i),t}),s(e)},l={preview:s(".yith-wcbm-preview-metabox .yith-wcbm-badge"),container:s(".yith-wcbm-preview-metabox .yith-wcbm-preview-container"),templates:{css:wp.template("yith-wcbm-css-badge-html"),advanced:wp.template("yith-wcbm-advanced-badge-html")},fields:{allRows:s("#yith-wcbm-metabox .yith-wcbm-badge-type-row ~ .the-metabox"),type:s("#_type"),uploadedImageWidth:s("#_uploaded_image_width"),width:s("#_size-dimension-width"),height:s("#_size-dimension-height"),sizeUnit:s("#_size input.yith-plugin-fw-dimensions__unit__value"),backgroundColor:s("#_background_color"),textColor:s("#_text_color"),padding:{top:s("#_padding-dimension-top"),right:s("#_padding-dimension-right"),bottom:s("#_padding-dimension-bottom"),left:s("#_padding-dimension-left"),unit:s("#_padding input.yith-plugin-fw-dimensions__unit__value")},borderRadius:{topLeft:s("#_border_radius-dimension-top-left"),topRight:s("#_border_radius-dimension-top-right"),bottomRight:s("#_border_radius-dimension-bottom-right"),bottomLeft:s("#_border_radius-dimension-bottom-left"),unit:s("#_border_radius input.yith-plugin-fw-dimensions__unit__value")},opacity:s("#_opacity"),rotation:{x:s("#_rotation_x"),y:s("#_rotation_y"),z:s("#_rotation_z")},flipText:{inputs:s("#_flip_text input"),inputsRow:s(".yith-wcbm-flip-text-row"),enable:s("#_use_flip_text")},positionType:s("#_position_type input"),anchorPoint:s("#_anchor_point input"),valuePosition:{top:s("#_position_values-dimension-top"),right:s("#_position_values-dimension-right"),bottom:s("#_position_values-dimension-bottom"),left:s("#_position_values-dimension-left"),unit:s("#_position_values input.yith-plugin-fw-dimensions__unit__value"),unitPxHandler:s("#_position_values .yith-plugin-fw-dimensions__unit--px-unit"),unitPercentageHandler:s("#_position_values .yith-plugin-fw-dimensions__unit--percentage-unit")},valuePositionRows:s(".yith-wcbm-position-values-row, .yith-wcbm-anchor-point-row"),fixedPosition:s(".yith-wcbm-position-field input"),fixedAlignment:s(".yith-wcbm-alignment-field input"),fixedPositionRows:s(".yith-wcbm-position-fixed-row, .yith-wcbm-alignment-fixed-row"),alignmentPreview:s("#_alignment-container .yith-wcbm-alignment-preview"),margin:{top:s("#_margin-dimension-top"),right:s("#_margin-dimension-right"),bottom:s("#_margin-dimension-bottom"),left:s("#_margin-dimension-left"),unit:s("#_margin input.yith-plugin-fw-dimensions__unit__value")},textArea:s(".yith-wcbm-text-editor-row textarea"),textContainer:s("#_text-container"),imageBadges:{container:s("#_image"),getInputs:function(){return s("#_image input")},assetsUrl:s("#_image-container .yith-wcbm-badge-library__badges").data("assets-url"),labels:s("#_image-container .yith-wcbm-badge-list-element"),upload:{container:s(".yith-wcbm-upload-image"),img:s(".yith-wcbm-upload-image img"),url:s("#yith-wcbm-upload-image-attachment-url"),id:s("#yith-wcbm-upload-image-attachment-id")}},cssBadges:{container:s("#_css"),getInputs:function(){return s("#_css input")},assetsUrl:s("#_css-container .yith-wcbm-badge-library__badges").data("assets-url")},advancedBadges:{container:s("#_advanced"),getInputs:function(){return s("#_advanced input")},assetsUrl:s("#_advanced-container .yith-wcbm-badge-library__badges").data("assets-url")?s("#_advanced-container .yith-wcbm-badge-library__badges").data("assets-url").replace("advanced-badge-previews","advanced-badges"):""},advancedDisplay:{inputs:s("#_advanced_display input"),row:s("#_advanced_display-container").parent()}},getCheckedValue:function(e){var t=l.fields[e];return["imageBadges","cssBadges","advancedBadges"].includes(e)&&(t=t.getInputs()),!!(t=["flipText","advancedDisplay"].includes(e)?t.inputs:t)&&t.filter(i).val()},getPositionType:function(){return l.getCheckedValue("positionType")},getFixedPosition:function(){return l.getCheckedValue("fixedPosition")},getFixedAlignment:function(){return l.getCheckedValue("fixedAlignment")},getAnchorPoint:function(){return l.getCheckedValue("anchorPoint")},getSelectedImageBadge:function(){return l.getCheckedValue("imageBadges")},getSelectedImageBadgeID:function(){return l.getCheckedValue("imageBadges").replace(".svg","")},getSelectedCssBadge:function(){return l.getCheckedValue("cssBadges")},getSelectedAdvancedBadge:function(){return l.getCheckedValue("advancedBadges")},getAdvancedBadgeDisplay:function(){return l.getCheckedValue("advancedDisplay")},getSelectedBadgeId:function(){var e=!1;switch(l.getType()){case"image":e=l.getSelectedImageBadge();break;case"css":e=l.getSelectedCssBadge();break;case"advanced":e=l.getSelectedAdvancedBadge()}return!!e&&Math.abs(e.replace(".svg",""))},getSelectedFlipText:function(){return l.fields.flipText.enable.is(":checked")?l.getCheckedValue("flipText"):"no"},getFixedPositionCss:function(){var e=l.getFixedPosition(),t=l.getFixedAlignment(),i={top:{top:0},middle:{top:"50%"},bottom:{bottom:0}},a={left:{left:0},center:{left:"50%"},right:{right:0}},o={left:"auto",right:"auto",top:"auto",bottom:"auto"};return a[t]&&s.each(a[t],function(e,t){o[e]=t}),i[e]&&s.each(i[e],function(e,t){o[e]=t}),o},getSelectedImageBadgeURL:function(){var e=l.getSelectedImageBadge();return"upload"===e?l.fields.imageBadges.upload.url.val():l.fields.imageBadges.assetsUrl+"/"+e},getSelectedCssBadgeURL:function(){return l.fields.cssBadges.assetsUrl+"/"+l.getSelectedCssBadge()},getSelectedAdvancedBadgeURL:function(){return l.fields.advancedBadges.assetsUrl+"/"+l.getSelectedAdvancedBadge()},getBadgeUrl:function(){var e="";switch(l.getType()){case"image":e=l.getSelectedImageBadgeURL();break;case"css":e=l.getSelectedCssBadgeURL();break;case"advanced":e=l.getSelectedAdvancedBadgeURL()}return e},getType:function(){return l.fields.type.val()},isType:function(e){return l.getType()===e},getUploadedImageWidth:function(){return l.fields.uploadedImageWidth.val()},getWidthCSS:function(){var e=l.fields.width.val(),t="percentage"===l.fields.sizeUnit.val()?"%":"px";return 0<e?e+t:"auto"},getHeightCSS:function(){var e=l.fields.height.val(),t="percentage"===l.fields.sizeUnit.val()?"%":"px";return 0<e?e+t:"auto"},getBackgroundColor:function(){return l.fields.backgroundColor.val()},getTextColor:function(){return l.isType("advanced")?l.fields.textColor.val():l.getTextColorFromText()},getTextColorFromText:function(){var e=s(r.getTextEditorBody()).html(),e=e||l.getTextEditorContent();return d(s("<div>"+e+"</div>","#3c434a"))},getDimensions:function(e,t){if(t=t||{first:"top",second:"right",third:"bottom",fourth:"left"},l.fields[e]){var i=Math.round(l.fields[e][t.first].val()),a=Math.round(l.fields[e][t.second].val()),o=Math.round(l.fields[e][t.third].val()),t=Math.round(l.fields[e][t.fourth].val()),e="percentage"===l.fields[e].unit.val()?"%":"px";return i+e+" "+a+e+" "+o+e+" "+t+e}return""},setAnchorPoint:function(e){var t=s("#_anchor_point");t.find("input").prop("checked",!1),t.find('input[value="'+e+'"]').prop("checked",!0),r.handleAnchorPointChange()},getPadding:function(){return l.getDimensions("padding")},getBorderRadius:function(){return l.getDimensions("borderRadius",{first:"topLeft",second:"topRight",third:"bottomRight",fourth:"bottomLeft"})},getOpacity:function(){return l.fields.opacity.val()+"%"},getTransform:function(){var e,t="";return"fixed"===l.getPositionType()&&(e=l.getFixedPosition(),t="translate( "+{left:"0",center:"-50%",right:"0"}[l.getFixedAlignment()]+", "+{top:"0",middle:"-50%",bottom:"0"}[e]+" )"),t+" "+("rotateX("+Math.abs(l.fields.rotation.x.val())+"deg) rotateY("+Math.abs(l.fields.rotation.y.val())+"deg) rotateZ("+Math.abs(l.fields.rotation.z.val())+"deg)")},getMargin:function(){return l.getDimensions("margin")},resetMargin:function(){l.hasMargin()&&(l.fields.margin.top.val(0),l.fields.margin.left.val(0),l.fields.margin.bottom.val(0),l.fields.margin.right.val(0).trigger("change"))},hasMargin:function(){return Math.round(l.fields.margin.top.val())||Math.round(l.fields.margin.right.val())||Math.round(l.fields.margin.bottom.val())||Math.round(l.fields.margin.left.val())},getTextEditorContent:function(){var t=(t=l.fields.textContainer.find(".html-active").length?l.fields.textArea.val():s(r.getTextEditorBody()).html())||o(s("<div>"+l.fields.textArea.val()+"</div>")).html();return Object.keys(yithWcbmMetaboxPremiumOptions.badgePlaceholders).forEach(function(e){t=t.replaceAll("{{"+e+"}}",yithWcbmMetaboxPremiumOptions.badgePlaceholders[e])}),t},getValuePositionCss:function(){var e=l.getAnchorPoint().split("-"),t="percentage"===l.fields.valuePosition.unit.val()?"%":"px",i={top:"auto",right:"auto",bottom:"auto",left:"auto"};return e[0]&&e[1]&&(i[e[0]]=l.fields.valuePosition[e[0]].val()+t,i[e[1]]=l.fields.valuePosition[e[1]].val()+t),i},hasFlipText:function(e){return e===l.getSelectedFlipText()},getFLipTextCss:function(){var e={};switch(l.getSelectedFlipText()){case"vertical":e={transform:"scale(1, -1)"},l.isType("css")&&8===l.getSelectedBadgeId()&&(e.transform+=" translate(-50%,50% )");break;case"horizontal":e={transform:"scale(-1, 1)"},l.isType("css")&&8===l.getSelectedBadgeId()&&(e.transform+=" translate(50%,-50% )");break;case"both":e={transform:"scale(-1, -1)"},l.isType("css")&&8===l.getSelectedBadgeId()&&(e.transform+=" translate(50%,50% )")}return e},getCSS:function(){var e="fixed"===l.getPositionType()?l.getFixedPositionCss():l.getValuePositionCss(),t={padding:0,"border-radius":0,transform:l.getTransform(),margin:l.getMargin(),opacity:l.getOpacity()},t=Object.assign({},t,e);switch(l.getType()){case"text":t.width=l.getWidthCSS(),t.height=l.getHeightCSS(),t.padding=l.getPadding(),t["border-radius"]=l.getBorderRadius();break;case"image":if("upload"===l.getSelectedImageBadge()){var i=l.getUploadedImageWidth();t["background-color"]="",t.width=Math.abs(i)?l.getUploadedImageWidth()+"px":"auto",t.height="auto";break}case"css":t["background-color"]="",t.width="auto",t.height="auto";break;case"advanced":t.width="",t.height=""}return t},replacePreviewWith:function(e){l.preview.removeAttr("class"),l.preview.addClass(Array(e[0].classList).join(" ")),l.preview.html(e.html())},updatePreview:function(e){switch(l.preview.css("background-color",""),l.getType()){case"text":l.replacePreviewWith(s('<div class="yith-wcbm-badge yith-wcbm-badge-text"><div class="yith-wcbm-badge-text">'+l.getTextEditorContent()+"</div></div>"));break;case"image":var t=yithWcbmMetaboxOptions.imageBadges&&yithWcbmMetaboxOptions.imageBadges[l.getSelectedImageBadgeID()]?yithWcbmMetaboxOptions.imageBadges[l.getSelectedImageBadgeID()]:'<img src="'+l.getBadgeUrl()+'" alt="">';l.replacePreviewWith(s('<div class="yith-wcbm-badge yith-wcbm-badge-image '+("upload"===l.getSelectedImageBadge()?"yith-wcbm-badge-image-uploaded":"")+'">'+t+"</div>"));break;case"css":var i=l.getSelectedBadgeId(),a=l.getTextEditorContent(),a=s(l.templates.css({classes:"yith-wcbm-badge yith-wcbm-badge-css",id:i,style:i,badgeSvg:yithWcbmMetaboxPremiumOptions.cssBadges[l.getSelectedBadgeId()],text:a}));l.replacePreviewWith(a);break;case"advanced":i=l.getSelectedBadgeId();yithWcbmMetaboxPremiumOptions.advancedBadges[l.getSelectedBadgeId()]&&(a=s(l.templates.advanced({classes:"yith-wcbm-badge yith-wcbm-badge-"+i,badgeSvg:yithWcbmMetaboxPremiumOptions.advancedBadges[l.getSelectedBadgeId()],id:i,style:i})),console.log(l.getSelectedBadgeId(),yithWcbmMetaboxPremiumOptions.advancedBadges[l.getSelectedBadgeId()]),a.removeClass("yith-wcbm-advanced-display-amount yith-wcbm-advanced-display-percentage").addClass("yith-wcbm-advanced-display-"+l.getAdvancedBadgeDisplay()),l.replacePreviewWith(a))}l.fields.flipText.enable.is(":checked")&&l.preview.addClass("yith-wcbm-badge-"+l.getType()+"--flip-"+l.getSelectedFlipText()),l.updateCssVariables(),l.preview.css(l.getCSS()),l.makeItDraggable()},makeItDraggable:function(){l.preview.draggable({containment:".yith-wcbm-preview-wrapper",cursor:"grab",grid:[1,1],drag:l.draggingHandler})},draggingHandler:function(){l.resetMargin(),"fixed"===l.getPositionType()&&l.fields.positionType.first().prop("checked",!0).trigger("change"),"px"===l.fields.valuePosition.unit.val()&&l.fields.valuePosition.unitPercentageHandler.trigger("click");var e=Math.round(parseInt(l.preview.css("left").replace("px",""))),t=Math.round(parseInt(l.preview.css("top").replace("px",""))),i=Math.round(l.preview.outerHeight()),a=Math.round(l.container.outerHeight()),o=Math.round(l.preview.outerWidth()),n=Math.round(l.container.outerWidth()),d={top:0,left:0,bottom:0,right:0},r=(50<t/a*100?"bottom":"top")+"-"+(50<e/n*100?"right":"left");switch(l.preview.css({bottom:"auto",right:"auto",transform:l.getTransform()}),l.setAnchorPoint(r),r){case"top-left":d.top=Math.round(t/a*1e4)/100,d.left=Math.round(e/n*1e4)/100;break;case"top-right":d.top=Math.round(t/a*1e4)/100,d.right=Math.round((n-e-o)/n*1e4)/100;break;case"bottom-right":d.bottom=Math.round((a-t-i)/a*1e4)/100,d.right=Math.round((n-e-o)/n*1e4)/100;break;case"bottom-left":d.bottom=Math.round((a-t-i)/a*1e4)/100,d.left=Math.round(e/n*1e4)/100}s.each(d,function(e,t){l.fields.valuePosition[e].val(t)})},unsetCssVariables:function(){for(var e=["primary","text","secondary","secondary-light","secondary-dark","tertiary","triadic-positive","triadic-negative","analogous-positive","analogous-negative"],t=0;t<e.length;t++)document.documentElement.style.setProperty("--badge-"+e[t]+"-color","unset")},updateCssVariables:function(e){var t=function(e){e=e.replace("#","");var t,i,a=parseInt(e[0]+e[1],16)/255,o=parseInt(e[2]+e[3],16)/255,n=parseInt(e[4]+e[5],16)/255,d=Math.max(a,o,n),r=Math.min(a,o,n),s=(d+r)/2*100;return d===r?t=i=0:(e=d-r,t=100*(50<s?e/(2-d-r):e/(d+r)),i=a===d?(o-n)/e+(o<n?6:0):o===d?(n-a)/e+2:(a-o)/e+4,i*=60),{h:i,s:t,l:s}}(e=e||l.getBackgroundColor()),t={primary:e,text:l.getTextColor(),secondary:a(e,.6),"secondary-light":a(e,.7),"secondary-dark":a(e,.5),tertiary:a(e,.4),"triadic-positive":"hsl("+(t.h+90)+","+t.s+"% ,"+t.l+"%)","triadic-negative":"hsl("+(t.h-90)+","+t.s+"% ,"+t.l+"%)","analogous-positive":"hsl("+(t.h+30)+","+t.s+"% ,"+t.l+"%)","analogous-negative":"hsl("+(t.h-30)+","+t.s+"% ,"+t.l+"%)"};s.each(t,function(e,t){document.documentElement.style.setProperty("--badge-"+e+"-color",t)})}},r={selectors:{badgeType:".yith-wcbm-badge-type",badgeTitle:"#yith-wcbm-title",uploadImage:".yith-wcbm-upload-image:not(.yith-wcbm-upload-image--uploaded) #yith-wcbm-upload-image",badgeLibraryItemClass:".yith-wcbm-badge-library__badges .yith-wcbm-badge-library__badge",removeUploadedImage:".yith-wcbm-upload-image.yith-wcbm-upload-image--uploaded.yith-wcbm-badge-list-element--selected #yith-wcbm-upload-image",backgroundColorInput:"#_background_color",textColorInput:"#_text_color",anchorPoint:"#_anchor_point input",positionType:"#_position_type-container input",position:".yith-wcbm-position-field input",alignment:".yith-wcbm-alignment-field input",rotation:"input.yith-wcbm-rotation-input",rotationSlider:".yith-wcbm-rotation-slider input, input.yith-wcbm-rotation-input",imageField:".yith-wcbm-badge-list-element input",useFlipText:"#_use_flip_text",libraryTab:".yith-wcbm-badge-library-tab",addBadgeToLibraryButtons:".yith-wcbm-badge-more__add-to-library-button:not(.yith-wcbm-badge-more__add-to-library-button--locked)",addAllBadgesToLibraryButtons:".yith-wcbm-badge-more__add-all-button",checkForPlaceholders:".yith-wcbm-check-for-placeholders",placeholderWrapper:".yith-wcbm-placeholders-list .yith-wcbm-placeholder-wrapper"},init:function(){switch(s(document).on("click",r.selectors.uploadImage,r.uploadBadgeImage),s(document).on("click",r.selectors.libraryTab,r.handleLibraryTabClick),s(document).on("click",r.selectors.badgeLibraryItemClass,r.setBadgeFromData),s(document).on("click",r.selectors.removeUploadedImage,r.removeBadgeImage),s(document).on("click",r.selectors.addBadgeToLibraryButtons,r.handleAddBadgeToLibrary),s(document).on("click",r.selectors.addAllBadgesToLibraryButtons,r.handleAddAllBadgesToLibrary),s(document).on("click",r.selectors.checkForPlaceholders,r.openPlaceholdersModal),s(document).on("click",r.selectors.placeholderWrapper,r.copyPlaceholder),s(document).on("change",r.selectors.backgroundColorInput,r.updateBackgroundColor),s(document).on("change",r.selectors.textColorInput,r.updateTextColor),s(document).on("change",r.selectors.badgeType,r.handleBadgeTypeChange),s(document).on("change",r.selectors.anchorPoint,r.handleAnchorPointChange),s(document).on("change",r.selectors.positionType,r.handlePositionTypeChange),s(document).on("change",r.selectors.position,r.handlePositionChange),s(document).on("change",r.selectors.position+" , "+r.selectors.alignment,r.handleFixedPositionChange),s(document).on("change",r.selectors.imageField,r.handleBadgeImageSelection),s(document).on("change",r.selectors.useFlipText,r.handleFLipTextVisibility),s(document).on("change keyup",r.selectors.rotation,r.handleRotationChangeFromInput),s(document).on("change keyup",r.selectors.rotationSlider,r.handleRotationChangeFromSlider),s(document).on("change keyup invalid",r.selectors.badgeTitle,r.checkInputValidity),s(r.selectors.badgeTitle).on("invalid",r.checkInputValidity),r.initEditors(),r.initSelect(),r.initSliders(),r.initImageSelectors(),r.initColorPickers(),r.initAddBadgeToLibraryStyle(),l.getType()){case"image":l.fields.imageBadges.getInputs().filter(i).trigger("change");break;case"css":l.fields.cssBadges.getInputs().filter(i).trigger("change");break;case"advanced":l.fields.advancedBadges.getInputs().filter(i).trigger("change")}s("#_type").trigger("change"),s("#_position-container input:checked").trigger("change"),s("#yith-wcbm-title").val(s("#title").val()),l.fields.positionType.filter(i).trigger("change"),"values"===l.getPositionType()&&l.fields.anchorPoint.filter(i).trigger("change"),r.handleAdvancedDisplayVisibility(),l.updatePreview()},initEditorBackground:function(){l.fields.backgroundColor.trigger("change")},initImageSelectors:function(){s(".yith-wcbm-badge-library__badges").each(function(e,t){var i=s(t).find(".yith-wcbm-badge-list-element--selected"),a=i[0]?i[0].offsetTop:0,i=i.outerHeight();t.scrollTop=a-i/2-69})},setBackgroundColor:function(e){l.fields.backgroundColor.val(e).trigger("change")},setTextColor:function(e){l.fields.textColor.val(e).trigger("change")},setBadgeFromData:function(){var e;yithWcbmMetaboxPremiumOptions.badgeList.hasOwnProperty(l.getType())&&yithWcbmMetaboxPremiumOptions.badgeList[l.getType()].hasOwnProperty(l.getSelectedBadgeId())&&(r.setBackgroundColor(yithWcbmMetaboxPremiumOptions.badgeList[l.getType()][l.getSelectedBadgeId()].backgroundColor),l.isType("advanced")?r.setTextColor(yithWcbmMetaboxPremiumOptions.badgeList[l.getType()][l.getSelectedBadgeId()].textColor):l.isType("css")&&((e=s(r.getTextEditorBody())).html(e.html().replace(/data-mce-style=".+?"/g,"")),e.find("p, span").each(function(e,t){s(t).css("color",yithWcbmMetaboxPremiumOptions.badgeList[l.getType()][l.getSelectedBadgeId()].textColor)}),l.fields.textArea.val(e.html()))),s(r.getTextEditorBody()).trigger("change")},getEditorFontSizes:function(){for(var e=[],t=yithWcbmMetaboxOptions.editor.fontSize.min,i=1;t<yithWcbmMetaboxOptions.editor.fontSize.max;t+=Math.ceil(i/10),i++)e.push(t+"pt");return e.push(yithWcbmMetaboxOptions.editor.fontSize.max+"pt"),e.join(" ")},getTextEditorBody:function(){return r.textEditorBody&&r.textEditorBody.length||(r.textEditorBody=s("#_text_ifr").contents().find("body#tinymce")),r.textEditorBody},initEditors:function(){s("textarea.yith-wcbm-text-editor:not(.yith-wcbm-text-editor-initialized)").each(function(){var t=s(this),e=t.attr("id");t.addClass("yith-wcbm-text-editor-initialized"),wp.editor.initialize(e,{tinymce:{wpautop:!1,toolbar1:"undo,redo,removeformat,fontselect,fontsizeselect,forecolor,bold,italic,,blockquote,alignleft,aligncenter,alignright",textarea_rows:10,font_formats:yithWcbmMetaboxOptions.editor.fonts.join(""),fontsize_formats:r.getEditorFontSizes(),init_instance_callback:function(e){e.on("keyup",function(){var e=s(this.iframeElement).contents().find("#tinymce");o(e)}),e.on("keyup",l.updatePreview),s(e.iframeElement).contents().find("html,body").attr("style",'height: 100%; font-family: "Open Sans", sans-serif; line-height: normal !important;'),t.trigger("yith-wcbm-editor-initialized")}},quicktags:{buttons:"strong,em,block,del,ins,img,ul,ol,li,code,more,close"},mediaButtons:!1})})},initSelect:function(){s(".yith-enhanced-select").selectWoo({minimumResultsForSearch:Infinity})},initSliders:function(){s(".yith-wcbm-rotation-slider .ui-slider .ui-slider").each(function(){s(this).slider({slide:function(e,t){s(this).find("input").val(t.value).trigger("change"),s(t.handle).text(t.value)}})})},initColorPickers:function(){l.fields.backgroundColor.wpColorPicker({change:r.updateBackgroundColor}),l.fields.textColor.wpColorPicker({change:r.updateTextColor})},initAddBadgeToLibraryStyle:function(){var e=s(".yith-wcbm-badge-more__add-to-library-button-text");(e=!!e&&s(e[0]))&&(e=s("<span>"+e.html()+"</span>").css({"font-size":"10px","white-space":"nowrap","min-width":"fit-content","font-weight":"600"}),s("body").append(e),document.documentElement.style.setProperty("--add-badge-to-library-length",e.outerWidth()+"px"),e.remove())},setTextEditorCss:function(e){var t=r.getTextEditorBody();t.css("background",""),t.css(e)},updateBackgroundColor:function(e,t){l.isType("image")||(t=t&&t.hasOwnProperty("color")?t.color.toString():s(this).val(),r.setTextEditorCss({"background-color":t}),l.updatePreview(),l.updateCssVariables(t))},updateTextColor:function(e,t){t=t&&t.hasOwnProperty("color")?t.color.toString():s(this).val();document.documentElement.style.setProperty("--badge-text-color",t)},handleBadgeTypeChange:function(){var e=s(this).val();switch(l.fields.allRows.hide(),s(".yith-wcbm-visible-if-"+e).show(),e){case"image":s("#_image-container input:checked").trigger("change");break;case"advanced":r.handleAdvancedDisplayVisibility();case"css":l.fields.textColor.trigger("change");case"text":l.fields.backgroundColor.trigger("change"),l.fields.flipText.enable.trigger("change")}l.fields.positionType.filter(i).trigger("change")},handlePositionChange:function(){var e=l.fields.alignmentPreview,t=s(this).val();e.removeClass("yith-wcbm-alignment-preview--top yith-wcbm-alignment-preview--middle yith-wcbm-alignment-preview--bottom"),e.addClass("yith-wcbm-alignment-preview--"+t)},handleFixedPositionChange:function(){var e=l.getFixedPosition(),t=l.getFixedAlignment();l.fields.margin["bottom"===e?"top":"bottom"].closest(".yith-plugin-fw-dimensions__dimension").hide(),l.fields.margin["bottom"===e?"bottom":"top"].closest(".yith-plugin-fw-dimensions__dimension").show(),l.fields.margin["right"===t?"left":"right"].closest(".yith-plugin-fw-dimensions__dimension").hide(),l.fields.margin["right"===t?"right":"left"].closest(".yith-plugin-fw-dimensions__dimension").show()},handleBadgeImageSelection:function(){var e=s(this);e.closest(".yith-wcbm-badge-library__badges").find(".yith-wcbm-badge-list-element--selected").removeClass("yith-wcbm-badge-list-element--selected"),e.closest(".yith-wcbm-badge-list-element").addClass("yith-wcbm-badge-list-element--selected"),l.isType("advanced")?r.handleAdvancedDisplayVisibility():l.isType("image")&&(e=s(".yith-wcbm-visible-if-image--upload"),"upload"===l.getSelectedImageBadge()?e.show():e.hide())},handleAdvancedDisplayVisibility:function(){l.isType("advanced")&&(yithWcbmMetaboxPremiumOptions.badgeList.hasOwnProperty("advanced")&&yithWcbmMetaboxPremiumOptions.badgeList.advanced.hasOwnProperty(l.getSelectedBadgeId())&&yithWcbmMetaboxPremiumOptions.badgeList.advanced[l.getSelectedBadgeId()].hasOwnProperty("chooseWhatDisplay")&&!yithWcbmMetaboxPremiumOptions.badgeList.advanced[l.getSelectedBadgeId()].chooseWhatDisplay?l.fields.advancedDisplay.row.hide():l.fields.advancedDisplay.row.show())},handleFLipTextVisibility:function(){s(this).is(":checked")?l.fields.flipText.inputsRow.show():l.fields.flipText.inputsRow.hide()},uploadBadgeImage:function(){var e=[new wp.media.controller.Library({library:wp.media.query(),multiple:!1,title:"Choose Image",priority:20,filterable:"uploaded"})],t=wp.media.frames.downloadable_file=wp.media({title:yithWcbmMetaboxOptions.i18n.uploadAttachment,library:{type:""},button:{text:yithWcbmMetaboxOptions.i18n.uploadAttachment},multiple:!1,states:e});t.on("close",function(e){t.state().get("selection").length||r.removeBadgeImage()}),t.on("select",function(){var e=t.state().get("selection").first().toJSON();l.fields.imageBadges.upload.url.val(e.url),l.fields.imageBadges.upload.container.addClass("yith-wcbm-upload-image--uploaded"),l.fields.imageBadges.upload.img.prop("src",e.url),l.fields.imageBadges.upload.id.val(e.id),l.updatePreview()}),t.open()},removeBadgeImage:function(){l.fields.imageBadges.upload.container.removeClass("yith-wcbm-upload-image--uploaded"),l.fields.imageBadges.upload.img.prop("src",""),l.fields.imageBadges.upload.url.val(""),l.fields.imageBadges.upload.id.val(""),l.fields.imageBadges.labels.not(".yith-wcbm-upload-image").first().find("input").prop("checked",!0).trigger("change")},handleRotationChangeFromInput:function(){var e=s(this),t=e.data("linked-to"),i=Math.min(360,Math.max(0,e.val()));s("#"+t).val(i),s("#"+t+"-div").slider("value",i),e.val(i)},handleRotationChangeFromSlider:function(){var e=s(this);s('input[data-linked-to="'+e.attr("id")+'"]').val(Math.min(360,Math.max(0,e.val())))},handlePositionTypeChange:function(){"fixed"===s(this).val()?(l.fields.fixedPositionRows.show(),l.fields.valuePositionRows.hide()):(l.fields.anchorPoint.filter(i).trigger("change"),l.fields.valuePositionRows.show(),l.fields.fixedPositionRows.hide())},handleAnchorPointChange:function(){s.each(l.fields.valuePosition,function(){s(this).closest(".yith-plugin-fw-dimensions__dimension").hide()}),s.each(l.fields.margin,function(){s(this).closest(".yith-plugin-fw-dimensions__dimension").hide()}),l.getAnchorPoint().split("-").forEach(function(e){l.fields.valuePosition[e].closest(".yith-plugin-fw-dimensions__dimension").show(),l.fields.margin[e].closest(".yith-plugin-fw-dimensions__dimension").show()})},handleLibraryTabClick:function(){var e=s(this).closest(".yith-wcbm-badge-library-wrapper"),t=e.find(".yith-wcbm-badge-more__badges"),i=e.find(".yith-wcbm-badge-library__badges");e.find(".yith-wcbm-badge-library-tab").removeClass("yith-wcbm-badge-library-tab--selected"),s(this).hasClass("yith-wcbm-badge-library-tab__more")?(i.hide(),t.css("display","grid")):(i.css("display","grid"),t.hide(),t.find(".yith-wcbm-badge-more__add-to-library-button--downloaded").removeClass("yith-wcbm-badge-more__add-to-library-button--downloading")),s(this).addClass("yith-wcbm-badge-library-tab--selected")},addBadgeToLibrary:function(e,t){var i=e.closest(".yith-wcbm-badge-more__badge"),a=i.data("badge-id"),o=l.getType(),n={action:yithWcbmMetaboxPremiumOptions.actions.addBadgeToLibrary,security:yithWcbmMetaboxPremiumOptions.security.addBadgeToLibrary,badge_type:o,badge_id:a},d=!1;e.addClass("yith-wcbm-badge-more__add-to-library-button--downloading"),s.ajax({type:"POST",dataType:"json",data:n,url:yithWcbmMetaboxPremiumOptions.ajaxurl,success:function(e){var t;e.success&&(d=!0,t=o+"Badges","image"===o?(yithWcbmMetaboxOptions.imageBadges||(yithWcbmMetaboxOptions.imageBadges={}),yithWcbmMetaboxOptions.imageBadges[a.replace(".svg","")]=e.badgeContent):(yithWcbmMetaboxPremiumOptions[t]||(yithWcbmMetaboxPremiumOptions[t]={}),yithWcbmMetaboxPremiumOptions[t][a.replace(".svg","")]=e.badgeContent),e=wp.template("yith-wcbm-badge-library-"+l.getType()),e=s(e({value:a,previewUrl:i.data("badge-preview-url")})),l.fields[t].container.append(e))},complete:function(){d?e.addClass("yith-wcbm-badge-more__add-to-library-button--downloaded"):(e.addClass("yith-wcbm-badge-more__add-to-library-button--failed"),setTimeout(function(){e.removeClass("yith-wcbm-badge-more__add-to-library-button--failed yith-wcbm-badge-more__add-to-library-button--downloading")},2500)),t&&Array.isArray(t)&&0<t.length?($nextButton=s(t.shift()),r.addBadgeToLibrary($nextButton,t)):e.closest(".yith-wcbm-badge-more__badges").find(".yith-wcbm-badge-more__add-all-button").removeClass("yith-wcbm-badge-more__add-all-button--disabled")}})},handleAddBadgeToLibrary:function(){r.addBadgeToLibrary(s(this))},handleAddAllBadgesToLibrary:function(e){e.preventDefault();var t=s(this),e=t.closest(".yith-wcbm-badge-list-container").find(".yith-wcbm-badge-more__badge .yith-wcbm-badge-more__add-to-library-button:not(.yith-wcbm-badge-more__add-to-library-button--downloading)");t.addClass("yith-wcbm-badge-more__add-all-button--disabled"),e=e.toArray(),r.addBadgeToLibrary(s(e.shift()),e)},checkInputValidity:function(){var e=s(this),t=e.closest(".yith-plugin-fw-metabox-field-row").find(".description"),i=e.is(":valid")?"":"#ea0034";e.css("border-color",i),t.css("color",i)},openPlaceholdersModal:function(){yith.ui.modal({...yithWcbmMetaboxPremiumOptions.modals.badgePlaceholders,closeWhenClickingOnOverlay:!0,allowClosingWithEsc:!0,width:"auto"})},copyPlaceholder:function(e){e?.originalEvent&&s(this).find(".yith-wcbm-placeholder-input .yith-plugin-fw-copy-to-clipboard__copy").trigger("click")}};"edit-yith-wcbm-badge"===yithWcbmMetaboxOptions.screenID?(t.each(function(){var e=s(this),t=s(this).outerHeight(),i=s(this).outerWidth();(60<t||200<i)&&e.css("zoom",Math.min(60/t,200/i))}),e.on("click",function(e){e.preventDefault(),yith.ui.modal({title:yithWcbmMetaboxOptions.addBadgeModal.title,content:yithWcbmMetaboxOptions.addBadgeModal.content,closeWhenClickingOnOverlay:!0,width:700})}),s(document).on("click",".yith-wcbm-enable-badge input",function(){var t=s(this),e=t.closest(".yith-wcbm-enable-badge"),i=e.data("badge-id"),i={action:yithWcbmMetaboxOptions.actions.toggleEnableBadge,security:yithWcbmMetaboxOptions.security.toggleEnableBadge,badge_id:i,badge_enable:t.prop("checked")?"yes":"no"};e.block({message:"",overlayCSS:{backgroundColor:"#ffffff",opacity:.8,cursor:"wait"}}),s.ajax({type:"POST",dataType:"json",data:i,url:yithWcbmMetaboxOptions.ajaxurl,success:function(e){e.success||t.prop("checked",!t.prop("checked"))},complete:function(){e.unblock()}})}),s(document).on("click",".yith_wcbm_actions .yith-plugin-fw__action-button--delete-action a",function(e){e.preventDefault(),e.stopPropagation();var t=s(this).attr("href"),e=s(this).closest("tr").find("td.title a").html();yith.ui.confirm({title:yithWcbmMetaboxOptions.i18n.deleteBadgeModal.title,message:yithWcbmMetaboxOptions.i18n.deleteBadgeModal.message.replace("%s",e),confirmButtonType:"delete",confirmButton:yithWcbmMetaboxOptions.i18n.deleteBadgeModal.confirmButton,closeAfterConfirm:!1,onConfirm:function(){window.location.href=t}})})):(s(document).on("change keyup",".yith-wcbm-badge-options-metabox input, .yith-wcbm-badge-options-metabox select, .yith-wcbm-badge-options-metabox textarea",l.updatePreview),s(document).on("change keyup click","#_text-container, .mce-container, .mce-toolbar-grp",l.updatePreview),s(document).on("yith-wcbm-editor-initialized",".yith-wcbm-badge-options-metabox textarea",r.initEditorBackground),r.init())});