jQuery(function(a){var e=a(".edit-php.post-type-yith-wcbm-badge .page-title-action, .edit-php.post-type-yith-wcbm-badge .yith-plugin-fw__list-table-blank-state__cta"),t=a(".column-yith_wcbm_preview .yith-wcbm-badge"),i=function(e){return(e=e instanceof jQuery?e:a(this)).is(":checked")},o=function(e){return a(e).find("p").map(function(e,t){var i=a(t).find("span").css("font-size");return i&&a(t).css("line-height",i),t}),a(e)},r={preview:a(".yith-wcbm-preview-metabox .yith-wcbm-badge"),container:a(".yith-wcbm-preview-metabox .yith-wcbm-preview-container"),fields:{allRows:a("#yith-wcbm-metabox .yith-wcbm-badge-type-row ~ .the-metabox"),type:a("#_type"),width:a("#_size-dimension-width"),height:a("#_size-dimension-height"),backgroundColor:a("#_background_color"),textColor:a("#_text_color"),padding:{top:a("#_padding-dimension-top"),right:a("#_padding-dimension-right"),bottom:a("#_padding-dimension-bottom"),left:a("#_padding-dimension-left"),unit:a("#_padding input.yith-plugin-fw-dimensions__unit__value")},borderRadius:{topLeft:a("#_border_radius-dimension-top-left"),topRight:a("#_border_radius-dimension-top-right"),bottomRight:a("#_border_radius-dimension-bottom-right"),bottomLeft:a("#_border_radius-dimension-bottom-left"),unit:a("#_border_radius input.yith-plugin-fw-dimensions__unit__value")},fixedPosition:a(".yith-wcbm-position-field input"),fixedAlignment:a(".yith-wcbm-alignment-field input"),fixedPositionRows:a(".yith-wcbm-position-fixed-row, .yith-wcbm-alignment-fixed-row"),alignmentPreview:a("#_alignment-container .yith-wcbm-alignment-preview"),textArea:a(".yith-wcbm-text-editor-row textarea"),imageBadges:{container:a("#_image"),getInputs:function(){return a("#_image input")},assetsUrl:a("#_image-container .yith-wcbm-badge-library__badges").data("assets-url"),labels:a("#_image-container .yith-wcbm-badge-list-element"),upload:{container:a(".yith-wcbm-upload-image"),img:a(".yith-wcbm-upload-image img"),url:a("#yith-wcbm-upload-image-attachment-url"),id:a("#yith-wcbm-upload-image-attachment-id")}}},getCheckedValue:function(e){var t=r.fields[e];return!!(t="imageBadges"===e?t.getInputs():t)&&t.filter(i).val()},getFixedPosition:function(){return r.getCheckedValue("fixedPosition")},getFixedAlignment:function(){return r.getCheckedValue("fixedAlignment")},getSelectedImageBadge:function(){return r.getCheckedValue("imageBadges")},getSelectedImageBadgeID:function(){return r.getCheckedValue("imageBadges").replace(".svg","")},getSelectedBadgeId:function(){var e=!1;return!!(e=r.isType("image")?r.getSelectedImageBadge():e)&&Math.abs(e.replace(".svg",""))},getFixedPositionCss:function(){var e=r.getFixedPosition(),t=r.getFixedAlignment(),i={top:{top:0},middle:{top:"50%"},bottom:{bottom:0}},o={left:{left:0},center:{left:"50%"},right:{right:0}},n={left:"auto",right:"auto",top:"auto",bottom:"auto"};return o[t]&&a.each(o[t],function(e,t){n[e]=t}),i[e]&&a.each(i[e],function(e,t){n[e]=t}),n},getSelectedImageBadgeURL:function(){return r.fields.imageBadges.assetsUrl+"/"+r.getSelectedImageBadge()},getBadgeUrl:function(){var e="";return e=r.isType("image")?r.getSelectedImageBadgeURL():e},getType:function(){return r.fields.type.val()},isType:function(e){return r.getType()===e},getWidthCSS:function(){var e=r.fields.width.val();return 0<e?e+"px":"auto"},getHeightCSS:function(){var e=r.fields.height.val();return 0<e?e+"px":"auto"},getBackgroundColor:function(){return r.fields.backgroundColor.val()},getTextColor:function(){return r.isType("advanced")?r.fields.textColor.val():r.getTextColorFromText()},getTextColorFromText:function(){for(var e=a(n.getTextEditorBody()).html(),e=e||r.getTextEditorContent(),t=a("<div>"+e+"</div>").find("p,span"),i=-1;t[++i];){var o=a(t[i]).css("color");if(o&&(-1!==o.indexOf("rgb")||-1!==o.indexOf("#")||-1!==o.indexOf("hsl")))return o}return"#3c434a"},getDimensions:function(e,t){if(t=t||{first:"top",second:"right",third:"bottom",fourth:"left"},r.fields[e]){var i=Math.round(r.fields[e][t.first].val()),o=Math.round(r.fields[e][t.second].val()),n=Math.round(r.fields[e][t.third].val()),t=Math.round(r.fields[e][t.fourth].val()),e="percentage"===r.fields[e].unit.val()?"%":"px";return i+e+" "+o+e+" "+n+e+" "+t+e}return""},getPadding:function(){return r.getDimensions("padding")},getBorderRadius:function(){return r.getDimensions("borderRadius",{first:"topLeft",second:"topRight",third:"bottomRight",fourth:"bottomLeft"})},getTransform:function(){var e=r.getFixedPosition();return"translate( "+{left:"0",center:"-50%",right:"0"}[r.getFixedAlignment()]+", "+{top:"0",middle:"-50%",bottom:"0"}[e]+" )"},getTextEditorContent:function(){tinymce.editors.filter(function(e){return e.initialized&&"_text"===e.id});return a(n.getTextEditorBody()).html()||o(a("<div>"+r.fields.textArea.val()+"</div>")).html()},getCSS:function(){var e=r.getFixedPositionCss(),t={padding:0,"border-radius":0,transform:r.getTransform()},t=Object.assign({},t,e);switch(r.getType()){case"text":t.width=r.getWidthCSS(),t.height=r.getHeightCSS(),t.padding=r.getPadding(),t["border-radius"]=r.getBorderRadius();break;case"image":t.width="",t.height=""}return t},replacePreviewWith:function(e){r.preview.removeAttr("class"),r.preview.addClass(Array(e[0].classList).join(" ")),r.preview.html(e.html())},updatePreview:function(e){switch(r.preview.css("background-color",""),r.getType()){case"text":r.replacePreviewWith(a('<div class="yith-wcbm-badge yith-wcbm-badge-text"><div class="yith-wcbm-badge-text">'+r.getTextEditorContent()+"</div></div>")),r.updateTextAreaValue();break;case"image":var t=yithWcbmMetaboxOptions.imageBadges&&yithWcbmMetaboxOptions.imageBadges[r.getSelectedImageBadgeID()]?yithWcbmMetaboxOptions.imageBadges[r.getSelectedImageBadgeID()]:'<img src="'+r.getBadgeUrl()+'" alt="">';r.replacePreviewWith(a('<div class="yith-wcbm-badge yith-wcbm-badge-image '+("upload"===r.getSelectedImageBadge()?"yith-wcbm-badge-image-uploaded":"")+'">'+t+"</div>"))}r.updateCssVariables(),r.preview.css(r.getCSS())},updateTextAreaValue:function(){r.fields.textArea.val(r.getTextEditorContent())},unsetCssVariables:function(){for(var e=["primary","text"],t=0;t<e.length;t++)document.documentElement.style.setProperty("--badge-"+e[t]+"-color","unset")},updateCssVariables:function(e){e={primary:e=e||r.getBackgroundColor(),text:r.getTextColor()};a.each(e,function(e,t){document.documentElement.style.setProperty("--badge-"+e+"-color",t)})}},n={selectors:{badgeType:".yith-wcbm-badge-type",badgeTitle:"#yith-wcbm-title",backgroundColorInput:"#_background_color",textColorInput:"#_text_color",position:".yith-wcbm-position-field input",alignment:".yith-wcbm-alignment-field input",imageField:".yith-wcbm-badge-list-element input"},init:function(){a(document).on("change",n.selectors.backgroundColorInput,n.updateBackgroundColor),a(document).on("change",n.selectors.textColorInput,n.updateTextColor),a(document).on("change",n.selectors.badgeType,n.handleBadgeTypeChange),a(document).on("change",n.selectors.position,n.handlePositionChange),a(document).on("change",n.selectors.imageField,n.handleBadgeImageSelection),a(document).on("change keyup invalid",n.selectors.badgeTitle,n.checkInputValidity),a(n.selectors.badgeTitle).on("invalid",n.checkInputValidity),n.initEditors(),n.initSelect(),n.initImageSelectors(),n.initColorPickers(),"image"===r.getType()&&r.fields.imageBadges.getInputs().filter(i).trigger("change"),a("#_type").trigger("change"),a("#yith-wcbm-title").val(a("#title").val()),r.updatePreview()},initEditorBackground:function(){r.fields.backgroundColor.trigger("change")},initImageSelectors:function(){a(".yith-wcbm-badge-library__badges").each(function(e,t){var i=a(t).find(".yith-wcbm-badge-list-element--selected"),o=i[0]?i[0].offsetTop:0,i=i.outerHeight();t.scrollTop=o-i/2-69})},setBackgroundColor:function(e){r.fields.backgroundColor.val(e).trigger("change")},setTextColor:function(e){r.fields.textColor.val(e).trigger("change")},getEditorFontSizes:function(){for(var e=[],t=yithWcbmMetaboxOptions.editor.fontSize.min,i=1;t<yithWcbmMetaboxOptions.editor.fontSize.max;t+=Math.ceil(i/10),i++)e.push(t+"pt");return e.push(yithWcbmMetaboxOptions.editor.fontSize.max+"pt"),e.join(" ")},getTextEditorBody:function(){return n.textEditorBody&&n.textEditorBody.length||(n.textEditorBody=a("#_text_ifr").contents().find("body#tinymce")),n.textEditorBody},initEditors:function(){a("textarea.yith-wcbm-text-editor:not(.yith-wcbm-text-editor-initialized)").each(function(){var t=a(this),e=t.attr("id");t.addClass("yith-wcbm-text-editor-initialized"),wp.editor.initialize(e,{tinymce:{wpautop:!1,toolbar1:"undo,redo,removeformat,fontselect,fontsizeselect,forecolor,bold,italic,,blockquote,alignleft,aligncenter,alignright",textarea_rows:10,font_formats:yithWcbmMetaboxOptions.editor.fonts.join(""),fontsize_formats:n.getEditorFontSizes(),init_instance_callback:function(e){e.on("keyup",function(){var e=a(this.iframeElement).contents().find("#tinymce");o(e)}),e.on("keyup",r.updatePreview),a(e.iframeElement).contents().find("html,body").attr("style",'height: 100%; font-family: "Open Sans", sans-serif; line-height: normal !important;'),t.trigger("yith-wcbm-editor-initialized")}},quicktags:{buttons:"strong,em,block,del,ins,img,ul,ol,li,code,more,close"},mediaButtons:!1})})},initSelect:function(){a(".yith-enhanced-select").selectWoo({minimumResultsForSearch:Infinity})},initColorPickers:function(){r.fields.backgroundColor.wpColorPicker({change:n.updateBackgroundColor}),r.fields.textColor.wpColorPicker({change:n.updateTextColor})},setTextEditorCss:function(e){var t=n.getTextEditorBody();t.css("background",""),t.css(e)},updateBackgroundColor:function(e,t){r.isType("image")||(t=t&&t.hasOwnProperty("color")?t.color.toString():a(this).val(),n.setTextEditorCss({"background-color":t}),r.updatePreview(),r.updateCssVariables(t))},updateTextColor:function(e,t){t=t&&t.hasOwnProperty("color")?t.color.toString():a(this).val();document.documentElement.style.setProperty("--badge-text-color",t)},handleBadgeTypeChange:function(){var e=a(this).val();switch(r.fields.allRows.hide(),a(".yith-wcbm-visible-if-"+e).show(),e){case"image":a("#_image-container input:checked").trigger("change");break;case"text":r.fields.backgroundColor.trigger("change")}},handlePositionChange:function(){var e=r.fields.alignmentPreview,t=a(this).val();e.removeClass("yith-wcbm-alignment-preview--top yith-wcbm-alignment-preview--middle yith-wcbm-alignment-preview--bottom"),e.addClass("yith-wcbm-alignment-preview--"+t)},handleBadgeImageSelection:function(){var e=a(this);e.closest(".yith-wcbm-badge-library__badges").find(".yith-wcbm-badge-list-element--selected").removeClass("yith-wcbm-badge-list-element--selected"),e.closest(".yith-wcbm-badge-list-element").addClass("yith-wcbm-badge-list-element--selected")},checkInputValidity:function(){var e=a(this),t=e.closest(".yith-plugin-fw-metabox-field-row").find(".description"),i=e.is(":valid")?"":"#ea0034";e.css("border-color",i),t.css("color",i)}};"edit-yith-wcbm-badge"===yithWcbmMetaboxOptions.screenID?(t.each(function(){var e=a(this),t=a(this).outerHeight(),i=a(this).outerWidth();(60<t||200<i)&&e.css("zoom",Math.min(60/t,200/i))}),e.on("click",function(e){e.preventDefault(),yith.ui.modal({title:yithWcbmMetaboxOptions.addBadgeModal.title,content:yithWcbmMetaboxOptions.addBadgeModal.content,closeWhenClickingOnOverlay:!0,width:700})}),a(document).on("click",".yith-wcbm-enable-badge input",function(){var t=a(this),e=t.closest(".yith-wcbm-enable-badge"),i=e.data("badge-id"),i={action:yithWcbmMetaboxOptions.actions.toggleEnableBadge,security:yithWcbmMetaboxOptions.security.toggleEnableBadge,badge_id:i,badge_enable:t.prop("checked")?"yes":"no"};e.block({message:"",overlayCSS:{backgroundColor:"#FFFFFF",opacity:.8,cursor:"wait"}}),a.ajax({type:"POST",dataType:"json",data:i,url:yithWcbmMetaboxOptions.ajaxurl,success:function(e){e.success||t.prop("checked",!t.prop("checked"))},complete:function(){e.unblock()}})}),a(document).on("click",".yith_wcbm_actions .yith-plugin-fw__action-button--delete-action a",function(e){e.preventDefault(),e.stopPropagation();var t=a(this).attr("href"),e=a(this).closest("tr").find("td.title a").html();yith.ui.confirm({title:yithWcbmMetaboxOptions.i18n.deleteBadgeModal.title,message:yithWcbmMetaboxOptions.i18n.deleteBadgeModal.message.replace("%s",e),confirmButtonType:"delete",confirmButton:yithWcbmMetaboxOptions.i18n.deleteBadgeModal.confirmButton,closeAfterConfirm:!1,onConfirm:function(){window.location.href=t}})})):(a(document).on("change keyup",".yith-wcbm-badge-options-metabox input, .yith-wcbm-badge-options-metabox select, .yith-wcbm-badge-options-metabox textarea",r.updatePreview),a(document).on("change keyup click","#_text-container, .mce-container, .mce-toolbar-grp",r.updatePreview),a(document).on("yith-wcbm-editor-initialized",".yith-wcbm-badge-options-metabox textarea",n.initEditorBackground),n.init())});