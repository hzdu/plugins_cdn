/*! Thrive Ovation - 2022-05-25
* http://www.thrivethemes.com/
* Copyright (c) 2022 Thrive Themes */

!function(a){a.fn.testimonial_capture_form=function(){return this.each(function(){var b,c=a(this),d=c.find(".on_success").val();c.wrapInner('<form method="post"></form>'),c.find(".tvo-form-picture").hover(function(){var b=a(this);b.attr("src")==b.attr("data-default")&&b.find(".tvo-social-picture").show()},function(){a(this).find(".tvo-social-picture").hide()}),c.find(".tvo_email").blur(function(){var b=this.value,d=c.find(".tvo-picture-wrapper");d.length>0&&g(b)&&a.ajax({type:"GET",url:TVO_Form.gravatar_route,data:{email:b}}).done(function(a){a&&(d.css("background-image","url("+a+")"),c.find(".tvo-remove-image").show())})}),c.find(".tvo-remove-image").click(function(){var b=c.find(".tvo-picture-wrapper");b.css("background-image","url("+b.attr("data-default")+")"),a(this).hide()});var e=function(){var b=!1;return c.find(".tvo_input").each(function(){var c=a(this);c.hasClass("tvo_required")&&0===c.val().length?(c.addClass("tvo_required_error"),b=!0):c.removeClass("tvo_required_error")}),b},f=function(a){c.find(".tvo-form-error").html(a)},g=function(){var a=/\S+@\S+\.\S+/,b=c.find(".tvo_email");return""===b.val()||a.test(b.val())},h=function(){var a=c.find(".tvo_website_url").val(),b=new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$");return void 0===a||""==a||b.test(a.toLowerCase())},i=function(){var b={},d=c.find(".tvo-picture-wrapper");return c.find(".tvo_input").each(function(){var c=a(this),d=c.attr("name"),e=c.val();void 0!==d&&(b[d]=e)}),b.content="",c.find(".tvo-form-textarea").each(function(){b.content+=" <p>"+this.value+"</p> "}),c.find(".g-recaptcha").length?(b._use_captcha=1,b["g-recaptcha-response"]=c.find(".g-recaptcha-response").val()):b._use_captcha=0,d.length>0?(b.picture_url=d.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""),d.attr("data-default")==b.picture_url&&(b.picture_url="")):b.picture_url="",b},j=function(){var a=c.find(".tvo-form-config"),b={};return b.tags=JSON.parse(a.find(".tags").val()),b.shortcode_id=a.find(".shortcode_id").val(),b.post_id=TVO_Form.post_id,b};b=c.find(".tvo-form-button"),b.on("click",function(k){k.stopPropagation(),k.preventDefault();var l=b.text();if(b.text(TVO_Form.translate.sending),f(""),e())return b.text(l),f(TVO_Form.translate.required),!1;if(!g())return b.text(l),f(TVO_Form.translate.validEmail),!1;if(!h())return b.text(l),f(TVO_Form.translate.validURL),!1;var m=i(),n=c.find(".tvo_form_state"),o=c.find(".tvo_success_state"),p=j();a.extend(m,p),b.attr("disabled",!0),a.ajax({headers:{"X-WP-Nonce":TVO_Form.nonce},type:"POST",url:TVO_Form.testimonial_route,data:m}).fail(function(a){b.text(l),b.attr("disabled",!1),a.responseJSON&&f(a.responseJSON.message)}).done(function(){switch(b.attr("disabled",!1),d){case"message":n.hide(),o.show();break;case"redirect":window.location=c.find(".on_redirect").val();break;default:location.reload()}})})})},a(function(){a(document).on("tve_shortcode_content_loaded",function(a,b){var c=b.$(".tvo_testimonial_form");c.length&&c.testimonial_capture_form()}),a(".tvo_testimonial_form").testimonial_capture_form()})}(jQuery);