(()=>{var t;window.ThriveOvation=window.ThriveOvation||{},ThriveOvation.util=ThriveOvation.util||{},_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},t=jQuery,window.addEventListener("message",(function(t){t.data.event&&"tvo_testimonials_template_update"==t.data.event&&t.data.template&&ThriveOvation.router.short_codes("capture")}),!1),ThriveOvation.util.setLoading=function(t){t.addClass("tvd-disabled"),t.prepend('<span class="tvd-icon-spinner mdi-pulse tvo-small-icon tvd-margin-right-small"></span>')},ThriveOvation.util.removeLoading=function(t){t.removeClass("tvd-disabled"),t.find(".tvd-icon-spinner").remove()},ThriveOvation.util.validateInput=function(t,e,i){var a=!0;return""==(t instanceof jQuery?t.val():t)&&(e||(e=ThriveOvation.translations.isRequired),a=!1,t instanceof jQuery&&(t.removeClass("tvd-valid"),t.addClass("tvd-invalid"))),e&&e.length>0&&!1===a&&i&&TVE_Dash.err(e,ThriveOvation.const.toast_timeout),a},ThriveOvation.util.containsObject=function(t,e){var i;for(i=0;i<e.length;i++)if(e[i].id==t.id)return!0;return!1},ThriveOvation.util.build_mce_init=function(e,i){var a={},o={};return!!this.hasTinymce()&&(a[i]=t.extend(!0,{},e.mce),o[i]=t.extend(!0,{},e.qt),o[i].id=i,a[i].selector="#"+i,a[i].body_class=a[i].body_class.replace("tvo-tinymce-tpl",i),{mce_init:a,qt_init:o})},ThriveOvation.util.clearMCEEditor=function(t){["tvo-testimonial-content-tinymce","tvo-email-template"].forEach((function(e){if(t!=e&&"undefined"!=typeof tinymce){var i=tinymce.get(e);i&&i.remove()}}))},ThriveOvation.util.getTestimonialContent=function(t){return this.hasTinymce()?tinyMCE.get("tvo-testimonial-content-tinymce").getContent():t.find("#tvo-testimonial-content-tinymce").val()},ThriveOvation.util.hasTinymce=function(){return!!window.tinymce},ThriveOvation.util.validateURL=function(t){var e=t instanceof jQuery?t.val():t;return!!new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$").test(e)||(t.removeClass("tvd-valid"),t.addClass("tvd-invalid"),!1)},ThriveOvation.util.validateEmail=function(t){var e=t instanceof jQuery?t.val():t;return!!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)||(t instanceof jQuery&&(t.removeClass("tvd-valid"),t.addClass("tvd-invalid")),!1)},ThriveOvation.util.bind_wistia=function(){window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes()},ThriveOvation.util.decrementIncrementListCounters=function(t,e){var i;switch(t.get("status")){case ThriveOvation.const.status.ready_for_display:(i=jQuery(".tvo-ready-for-display-c")).html(parseInt(i.text())+e);break;case ThriveOvation.const.status.awaiting_approval:(i=jQuery(".tvo-awaiting-approval-c")).html(parseInt(i.text())+e);break;case ThriveOvation.const.status.awaiting_review:(i=jQuery(".tvo-awaiting-review-c")).html(parseInt(i.text())+e);break;case ThriveOvation.const.status.rejected:(i=jQuery(".tvo-rejected-c")).html(parseInt(i.text())+e)}0===t.get("tags").length&&(i=jQuery(".tvo-untagged-c")).html(parseInt(i.text())+e),-1!==t.get("picture_url").indexOf(ThriveOvation.testimonial_image_placeholder)&&(i=jQuery(".tvo-no-picture-c")).html(parseInt(i.text())+e)},ThriveOvation.util.incrementDecrementStatusCounters=function(t,e){var i;switch(t){case ThriveOvation.const.status.ready_for_display:i=jQuery(".tvo-ready-for-display-c");break;case ThriveOvation.const.status.awaiting_approval:i=jQuery(".tvo-awaiting-approval-c");break;case ThriveOvation.const.status.awaiting_review:i=jQuery(".tvo-awaiting-review-c");break;case ThriveOvation.const.status.rejected:i=jQuery(".tvo-rejected-c")}switch(i.html(parseInt(i.text())-1),e){case ThriveOvation.const.status.ready_for_display:i=jQuery(".tvo-ready-for-display-c");break;case ThriveOvation.const.status.awaiting_approval:i=jQuery(".tvo-awaiting-approval-c");break;case ThriveOvation.const.status.awaiting_review:i=jQuery(".tvo-awaiting-review-c");break;case ThriveOvation.const.status.rejected:i=jQuery(".tvo-rejected-c")}i.html(parseInt(i.text())+1)},ThriveOvation.util.incrementDecrementTagCounters=function(t){var e=jQuery(".tvo-untagged-c");e.html(parseInt(e.text())+t)},ThriveOvation.bindZClip=function(t){setTimeout((function(){try{t.closest(".tvo-copy-input-content").find("input.tvo-copy").on("click",(function(t){this.select(),t.preventDefault(),t.stopPropagation()})),t.zclip({path:ThriveOvation.const.wp_content+"plugins/thrive-ovation/admin/js/libs/jquery.zclip.1.1.1/ZeroClipboard.swf",copy:function(){return jQuery(this).parents(".tvo-copy-input-content").find("input.tvo-copy").val()},afterCopy:function(){var t=jQuery(this);t.prev().select();var e,i=t.html();t.hasClass("tvd-btn-blue")&&(e="tvd-btn-blue",t.removeClass("tvd-btn-blue").addClass("tvd-btn-green")),t.find(".tvo-copy-text").html('<span class="tvd-icon-check"></span>'),setTimeout((function(){e&&t.removeClass("tvd-btn-green").addClass(e),t.find(".tvo-copy-text").html(i)}),3e3),t.parent().prev().select()}})}catch(t){console.error&&console.error("Error embedding zclip - most likely another plugin is messing this up")&&console.error(t)}}),200)},ThriveOvation.util.CheckCheckboxValue=function(t,e){var i=jQuery(t.currentTarget);!0===i.is(":checked")?e.find("."+i.attr("data-hide")).slideDown():e.find("."+i.attr("data-hide")).slideUp()},ThriveOvation.util.setModelWithKeyValue=function(t,e){var i=t.attr("data-key"),a=t.val(),o={};o[i]=a,e.set(o)},ThriveOvation.util.addNewTagInTheSystem=function(t,e){if(t.name=t.text,t.text==t.id){var i=new ThriveOvation.models.Tag(t);i.set("post_id",0),TVE_Dash.showLoader(),i.save(null,{success:function(i,a){e.$el.find('option[value="'+t.id+'"]').remove(),e.$el.find(".tvo-add-tag-autocomplete").append('<option value="'+a.tag.term_id+'" selected>'+a.tag.text+"</option>").trigger("change");var o={id:a.tag.term_id,text:a.tag.text};ThriveOvation.availableTags.push(o),TVE_Dash.hideLoader()},error:function(t,e){TVE_Dash.err(ThriveOvation.translations.testimonial_tag_added_fail_toast),TVE_Dash.hideLoader()}})}},ThriveOvation.util.addNewTagInTheSystemFromComments=function(t){if(t.name=t.text,t.text==t.id){var e=new ThriveOvation.models.Tag(t);e.set("post_id",0),TVE_Dash.showLoader(),e.save(null,{success:function(e,i){jQuery('option[value="'+t.id+'"]').remove(),jQuery(".tvo-add-tag-autocomplete").append('<option value="'+i.tag.term_id+'" selected>'+i.tag.text+"</option>").trigger("change");var a={id:i.tag.term_id,text:i.tag.text};ThriveOvation.availableTags.push(a),TVE_Dash.hideLoader()},error:function(t,e){TVE_Dash.err(ThriveOvation.translations.testimonial_tag_added_fail_toast),TVE_Dash.hideLoader()}})}},ThriveOvation.util.Breadcrumbs=function(t,e,i){for(var a in t){var o={title:t[a].title,url:t[a].url},n=[];if(t[a].key==e)return o.url+=void 0===i?"":"/"+i,[o];if((n=ThriveOvation.util.Breadcrumbs(t[a].kids,e,i)).length>0)return n.unshift(o),n}return void 0===n?[]:n},ThriveOvation.util.incrementDecrementShowHideSpace=function(t,e){var i,a,o;switch(t){case"tvo-show-hide-tags":i=".tvo-show-hide-testimonial-info-container",o="tvd-s3",a="tvd-s6";break;case"tvo-show-hide-status":i=".tvo-show-hide-description-container",o="tvd-s3",a="tvd-s5"}e>0?jQuery(i).removeClass(o).addClass(a):jQuery(i).removeClass(a).addClass(o)},window.ThriveOvation=window.ThriveOvation||{},ThriveOvation.models=ThriveOvation.models||{},ThriveOvation.collections=ThriveOvation.collections||{},jQuery,Backbone.emulateHTTP=!0,ThriveOvation.models.Base=Backbone.Model.extend({idAttribute:"id",sync:function(t,e,i){var a;return(i=i||{}).cache=!1,_.isUndefined(ThriveOvation.nonce)||_.isNull(ThriveOvation.nonce)||(a=i.beforeSend,i.beforeSend=function(t){if(t.setRequestHeader("X-WP-Nonce",ThriveOvation.nonce),a)return a.apply(this,arguments)}),Backbone.sync(t,e,i)}}),ThriveOvation.collections.Base=Backbone.Collection.extend({sync:function(t,e,i){var a;return(i=i||{}).cache=!1,i.url=this.url(),_.isUndefined(ThriveOvation.nonce)||_.isNull(ThriveOvation.nonce)||(a=i.beforeSend,i.beforeSend=function(t){if(t.setRequestHeader("X-WP-Nonce",ThriveOvation.nonce),a)return a.apply(this,arguments)}),Backbone.sync(t,e,i)}}),ThriveOvation.models.Settings=ThriveOvation.models.Base.extend({url:ThriveOvation.routes.settings}),ThriveOvation.models.PostMeta=ThriveOvation.models.Base.extend({defaults:{key:"",meta_key:"",meta_value:""},url:function(){return ThriveOvation.routes.postmeta+"/"+this.get("key")}}),ThriveOvation.models.Filters=ThriveOvation.models.Base.extend({defaults:{show_hide_tags:1,show_hide_type:1,show_hide_status:1,testimonial_content:"summary"},url:function(){return ThriveOvation.routes.filters}}),ThriveOvation.models.Testimonial=ThriveOvation.models.Base.extend({defaults:{title:"",name:"",date:"",email:"",role:"",website_url:"",picture_url:"",tags:[],content:"",status:-1,source:"",sent_emails:0},url:function(){var t=ThriveOvation.routes.testimonials;return this.get("id")&&(t+="/"+this.get("id")),t}}),ThriveOvation.models.copyTestimonial=ThriveOvation.models.Base.extend({defaults:{title:"",name:"",date:"",email:"",role:"",website_url:"",picture_url:"",tags:[],content:"",status:-1,source:"",sent_emails:0},url:function(){return ThriveOvation.routes.testimonials+"/copy"}}),ThriveOvation.models.Tag=ThriveOvation.models.Base.extend({idAttribute:"term_id",defaults:{name:"",post_id:""},url:function(){var t=ThriveOvation.routes.tags;return this.get("term_id")&&(t+="/"+this.get("term_id")),t}}),ThriveOvation.models.ActivityLogEntry=ThriveOvation.models.Base.extend({defaults:{id:"",post_id:"",text:"",class:"",date:""}}),ThriveOvation.models.Shortcode=ThriveOvation.models.Base.extend({defaults:{name:"",content:"",type:"",thumbnail:""},url:function(){var t=ThriveOvation.routes.shortcodes;return this.get("id")&&(t+="/"+this.get("id")),t}}),ThriveOvation.collections.Shortcodes=ThriveOvation.collections.Base.extend({model:ThriveOvation.models.Shortcode,url:function(){return ThriveOvation.routes.shortcodes},comparator:function(t){return t.get("id")},parse:function(t){return t.forEach((function(e,i){var a;e.config.template&&e.config.template.length>1?("display"==e.config.type?a=e.config.template.split("/",1)[0]:"capture"==e.config.type&&(a="capture"),t[i].thumbnail=ThriveOvation.admin_url+"img/shortcode_"+a+".jpg"):t[i].thumbnail=""})),t}}),ThriveOvation.models.LandingCombo=ThriveOvation.models.Base.extend({defaults:{id:"",title:""}}),ThriveOvation.collections.LandingCombo=ThriveOvation.collections.Base.extend({model:ThriveOvation.models.LandingCombo}),ThriveOvation.collections.ActivityLog=ThriveOvation.collections.Base.extend({model:ThriveOvation.models.ActivityLogEntry,url:function(){return ThriveOvation.routes.testimonials+"/activity/"}}),ThriveOvation.collections.Testimonials=ThriveOvation.collections.Base.extend({model:ThriveOvation.models.Testimonial,url:function(){return ThriveOvation.routes.testimonials},comparator:function(t){return-t.get("id")}}),ThriveOvation.models.AssetWizardConnection=ThriveOvation.models.Base.extend({idAttribute:"ID",defaults:function(){return{connection:"",active:"",connection_instance:""}}}),ThriveOvation.models.NewConnection=ThriveOvation.models.Base.extend({idAttribute:"ID",defaults:{connected_apis:{}},url:function(){return ThriveOvation.routes.api+"/"+this.get("connection")}}),ThriveOvation.models.LandingPageConfig=ThriveOvation.models.Base.extend({defaults:{approve:"",approve_url:"",approve_post_id:"",approve_post_val:"",not_approve:"",not_approve_url:"",not_approve_post_id:"",not_approve_post_val:""},url:function(){return ThriveOvation.routes.settings+"/landing-page/config"}}),ThriveOvation.models.EmailConfig=ThriveOvation.models.Base.extend({defaults:{subject:"",template:""},url:function(){return ThriveOvation.routes.settings+"/email/config"}}),ThriveOvation.models.ConfirmEmailSend=ThriveOvation.models.Base.extend({defaults:{}}),ThriveOvation.collections.AssetConnection=ThriveOvation.collections.Base.extend({model:ThriveOvation.models.AssetWizardConnection}),window.ThriveOvation=window.ThriveOvation||{},ThriveOvation.views=ThriveOvation.views||{},ThriveOvation.objects=ThriveOvation.objects||{},function(t){t((function(){t(document).keypress((function(t){13!==t.which&&13!==t.keyCode||jQuery("a").is(":focus")||(jQuery("#tvo-delete-testimonial-modal").is(":visible")&&jQuery(".tvo-detele-testimonial-action").focus().click(),jQuery("#tvo-delete-multiple-testimonials-modal").is(":visible")&&jQuery(".tvo-detele-multiple-testimonials-action").focus().click())})),ThriveOvation.views.Base=Backbone.View.extend({modal:function(t,e){return TVE_Dash.modal(t,e)}}),ThriveOvation.views.Breadcrumbs=ThriveOvation.views.Base.extend({render:function(t){var e=this;return this.$el.empty(),_.each(t,(function(t){var i=new ThriveOvation.views.BreadcrumbsItem;e.$el.append(i.render(t).el)})),this}}),ThriveOvation.views.BreadcrumbsItem=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("dashboard/breadcrumb-item"),className:"tvd-breadcrumb",tagName:"li",render:function(t){return this.$el.html(this.template({url:t.url,title:t.title})),this}}),ThriveOvation.views.SocialMediaImport=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("social-media/social-media-import"),events:{"click .tvo-import":"importTestimonial","click #tvo-upload-testimonial-image":"openUploadImage","keydown .tvo-url":"captureKeyImport","keydown .tvo-social-field":"captureKeySave","click .tvo-save-testimonial":"saveTestimonial"},render:function(){var t=this.template;return ThriveOvation.social_connections.facebook||ThriveOvation.social_connections.twitter||(t=TVE_Dash.tpl("social-media/no-social-media")),this.$el.html(t()),this.renderTestimonialEditor(),this},populateFieldWithValues:function(t){if(this.$(".tvo-testimonial-area").removeClass("tvd-hide"),this.$("#tvo-author-name").val(t.name),this.$("#tvo-author-email").val(t.email),this.$("#tvo-author-website").val(t.website_url),this.$(".tvo-testimonial-author-image img").attr("src",t.profile_image_url),TVE_Dash.materialize(this.$el),this.renderTestimonialEditor(),ThriveOvation.util.hasTinymce()?tinyMCE.get("tvo-testimonial-content-tinymce").setContent(t.testimonial):this.$("#tvo-testimonial-content-tinymce").val(t.testimonial),t.source){var e=this.$(".tvo-author-email label");"twitter"==t.source?(e.attr("data-error",e.attr("data-error-twitter")),e.html(e.attr("data-content-twitter"))):"facebook"==t.source&&(e.attr("data-error",e.attr("data-error-facebook")),e.html(e.attr("data-content-facebook")))}this.renderSelectTags()},renderTestimonialEditor:function(){var e=ThriveOvation.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["tvo-tinymce-tpl"],qt:window.tinyMCEPreInit.qtInit["tvo-tinymce-tpl"]},"tvo-testimonial-content-tinymce");e&&(tinyMCEPreInit.mceInit=t.extend(tinyMCEPreInit.mceInit,e.mce_init),tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"].setup=function(t){t.on("change",(function(){t.save()}))},tinyMCE.init(tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"]),window.wpActiveEditor="tvo-testimonial-content-tinymce")},renderSelectTags:function(){var t=this.$("#tvo-social-media-new-tag-modal"),e=this;t.data("select2")&&(t.select2("destroy"),t.val(null),t.unbind("select2:select")),t.select2({tags:!0,multiple:!0,data:ThriveOvation.availableTags,placeholder:ThriveOvation.translations.tags_select2_placeholder}).on("select2:select",(function(t){ThriveOvation.util.addNewTagInTheSystem(t.params.data,e)})).on("select2:unselect",(function(t){t.params.originalEvent&&t.params.originalEvent.stopPropagation()}))},openUploadImage:function(){if(t)t.open();else{var t=wp.media({title:ThriveOvation.translations.choose_testimonial_image,button:{text:ThriveOvation.translations.choose_testimonial_image_button},library:{type:"image"},multiple:!1,frame:"select"}),e=this;t.on("select",(function(){var i=t.state().get("selection").first().toJSON();e.$(".tvo-testimonial-author-image img").attr("src",i.url)})),t.open()}},captureKeyImport:function(t){13!==t.which&&13!==t.keyCode||this.$(".tvo-import").click()},captureKeySave:function(t){13!==t.which&&13!==t.keyCode||this.$(".tvo-save-testimonial").click()},importTestimonial:function(e){var i=ThriveOvation.util.validateURL(this.$(".tvo-url")),a=this.$(".tvo-url").val(),o=jQuery(e.currentTarget),n=this;if(i){if(o.hasClass("tvd-disabled"))return;ThriveOvation.util.setLoading(o),t.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},cache:!1,url:ThriveOvation.routes.socialmedia+"/import_testimonial",type:"POST",data:{social_media_url:a}}).done((function(t){switch(t.code){case 0:TVE_Dash.err(t.message);break;case 1:TVE_Dash.success(t.message),n.populateFieldWithValues(t.result)}})).error((function(){TVE_Dash.err(ThriveOvation.translations.invalid_social_request)})).always((function(){ThriveOvation.util.removeLoading(o),TVE_Dash.hideLoader()}))}else TVE_Dash.err(ThriveOvation.translations.invalid_url)},validateModel:function(){var t=!0;return this.$("#tvo-author-website").val()&&!ThriveOvation.util.validateURL(this.$("#tvo-author-website"))&&(t=!1),ThriveOvation.util.validateInput(this.$("#tvo-author-name"),ThriveOvation.translations.isRequired)||(t=!1),ThriveOvation.util.validateInput(ThriveOvation.util.getTestimonialContent(this.$el),ThriveOvation.translations.testimonial_content_missing,!0)?this.$(".tvo-testimonial-content").removeClass("tvo-tiny-mce-error"):(t=!1,this.$(".tvo-testimonial-content").addClass("tvo-tiny-mce-error")),t},clearAreaAfterSave:function(){this.$(".tvo-url").val(""),this.$(".tvo-testimonial-area").addClass("tvd-hide")},saveTestimonial:function(t){var e=jQuery(t.currentTarget),i=new ThriveOvation.models.Testimonial,a={},o=this;if(this.validateModel()){if(e.hasClass("tvd-disabled"))return;ThriveOvation.util.setLoading(e),a={title:this.$("#tvo-title").val(),name:this.$("#tvo-author-name").val(),email:this.$("#tvo-author-email").val(),role:this.$("#tvo-author-role").val(),website_url:this.$("#tvo-author-website").val(),content:ThriveOvation.util.getTestimonialContent(this.$el),tags:this.$("#tvo-social-media-new-tag-modal").val(),source:ThriveOvation.const.source.social_media,picture_url:this.$(".tvo-testimonial-author-image img").prop("src"),comment_url:this.$(".tvo-url").val()},i.save(a,{success:function(t,i){TVE_Dash.success(ThriveOvation.translations.testimonial_saved_success_toast),ThriveOvation.util.removeLoading(e),o.clearAreaAfterSave()},error:function(t,i){TVE_Dash.err(ThriveOvation.translations.testimonial_saved_error_toast),ThriveOvation.util.removeLoading(e)}})}}}),ThriveOvation.views.Testimonials=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("testimonials/list"),events:{"change .tvo-testimonials-select-all":"checkUncheckTestimonials","change .tvo-checkbox-testimonial-item":"showHideCheckboxActions","click .tvo-filter":"applyFilters","change .tvo-dropdown-filter":"applyDropDownFilters","change .tvo-filter-content":"filterContent","click .tvo-detele-testimonial-action":"deleteTestimonial","click .tvo-delete-multiple-testimonials-modal":"deleteTestimonialsModal","click .tvo-detele-multiple-testimonials-action":"deleteMultipleTestimonials","click .tvo-add-new-testimonial":"newTestimonialModal","click .tvo-show-hide":"showHideElements","click .tvo-add-tags-to-multiple-testimonials":"addTagsToMultipleTestimonials","click .tvo-new-dropdown-button":"showTagDropdown","keyup .tvo-multiple-tag-search":"searchMultipleTags","change .tvo-add-multiple-tags-checkbox":"checkMultipleTestimonialsCheckboxForParticularClass","keydown .tvo-delete-testimonial-modal":"capturekey","keydown .tvo-delete-multiple-testimonials-modal":"capturekey","click .tvo-testimonial-duplicate":"duplicate"},testimonialsPagination:null,filter_status:[],filter_untagged:0,filter_nopicture:0,initialize:function(){var t=this,e=jQuery(document);this.render(),e.off("filterReset"),e.on("filterReset",(function(){t.resetFilters()}))},showHideElements:function(t){var e=jQuery(t.currentTarget),i=e.attr("id");e.is(":checked")?(jQuery("."+i+"-container").removeClass("tvd-hide"),ThriveOvation.util.incrementDecrementShowHideSpace(i,-1)):(jQuery("."+i+"-container").addClass("tvd-hide"),ThriveOvation.util.incrementDecrementShowHideSpace(i,1)),this.saveFilters()},capturekey:function(t){13!==t.which&&13!==t.keyCode||(this.$("#tvo-delete-testimonial-modal").is(":visible")&&this.$(".tvo-detele-testimonial-action").focus().click(),this.$("#tvo-delete-multiple-testimonials-modal").is(":visible")&&this.$(".tvo-detele-multiple-testimonials-action").focus().click())},showHideMassActions:function(){var t=this.$(".tvo-checkbox-testimonial-item");t.filter(":checkbox:checked").length?this.$(".tvo-testimonials-select-all-actions").removeClass("tvd-hide"):this.$(".tvo-testimonials-select-all-actions").addClass("tvd-hide"),this.$(".tvo-testimonials-select-all").prop("checked",!t.not(":checked").length)},resetTheParticularTags:function(){this.$(".tvo-multiple-tag-search").val("").trigger("change"),this.$(".tvo_multiple_tag_container").removeClass("tvd-hide"),this.$(".tvo-add-multiple-tags-checkbox").removeAttr("checked")},resetView:function(){this.$(".tvo-testimonials-select-all-actions").addClass("tvd-hide"),this.$(".tvo-testimonials-select-all").prop("checked",!1).trigger("change"),this.resetTheParticularTags()},showHideCheckboxActions:function(e){var i=t(e.currentTarget);this.adjustTagsCheckboxes(),i.is(":checked")?i.parents(".tvo-gray-box").addClass("tvo-highlight-row"):i.parents(".tvo-gray-box").removeClass("tvo-highlight-row"),this.showHideMassActions()},checkUncheckTestimonials:function(e){var i=jQuery(e.currentTarget);this.$(".tvo-checkbox-testimonial-item").prop("checked",t(i).is(":checked")).trigger("change")},adjustTagsCheckboxes:function(){var t=[];this.resetTheParticularTags(),jQuery(".tvo-checkbox-testimonial-item:checked").each((function(){for(var e=jQuery(this).attr("data-id"),i=ThriveOvation.objects.Testimonials.get(e).get("tags"),a=0;a<i.length;a++)-1===jQuery.inArray(i[a].id,t)&&t.push(i[a].id)})),this.$(".tvo-add-multiple-tags-checkbox").each((function(){var e=jQuery(this).attr("data-id");jQuery(this).removeClass("tvo-multiple-tags-particular"),jQuery.inArray(parseInt(e),t)>-1&&jQuery(this).addClass("tvo-multiple-tags-particular")}))},searchMultipleTags:function(t){var e=jQuery(t.currentTarget),i=jQuery(e).val().toLowerCase();this.$(".tvo_multiple_tag_container").each((function(){-1===jQuery(this).attr("data-label").indexOf(i)?jQuery(this).addClass("tvd-hide"):jQuery(this).removeClass("tvd-hide")})),0===this.$(".tvo_multiple_tag_container").not(".tvd-hide").length?(this.$(".tvo-no-tags-to-display").removeClass("tvd-hide"),this.$(".tvo-add-tags-to-multiple-testimonials").attr("disabled","disabled")):(this.$(".tvo-no-tags-to-display").addClass("tvd-hide"),this.$(".tvo-add-tags-to-multiple-testimonials").removeAttr("disabled"))},filterContent:function(t){var e=jQuery(t.currentTarget);"summary"==jQuery(e).val()?jQuery(".tvo-testimonial-content-full").addClass("tvd-hide"):jQuery(".tvo-testimonial-content-summary").addClass("tvd-hide"),jQuery(".tvo-testimonial-content-"+jQuery(e).val()).removeClass("tvd-hide"),this.saveFilters()},saveFilters:function(){new ThriveOvation.models.Filters({show_hide_tags:Number(this.$("#tvo-show-hide-tags")[0].checked),show_hide_type:Number(this.$("#tvo-show-hide-type")[0].checked),show_hide_status:Number(this.$("#tvo-show-hide-status")[0].checked),testimonial_content:this.$(".tvo-filter-content").val()}).save(null,{success:function(t,e){},error:function(t,e){}})},deleteTestimonial:function(t){var e=jQuery(t.currentTarget),i=jQuery(e).attr("data-id"),a=ThriveOvation.objects.Testimonials.get(i),o=this;a.destroy({success:function(t,e){jQuery(".testimonial-row-"+e).slideUp("normal",(function(){jQuery(this).remove()})),ThriveOvation.util.decrementIncrementListCounters(t,-1),o.resetView(),o.testimonialsPagination.changePage(),TVE_Dash.success(ThriveOvation.translations.testimonial_deleted_success_toast)},error:function(t,e){TVE_Dash.err(ThriveOvation.translations.testimonial_deleted_fail_toast)}})},duplicate:function(e){var i=jQuery(e.currentTarget),a=jQuery(i).attr("data-id"),o=ThriveOvation.objects.Testimonials.get(a);new ThriveOvation.models.copyTestimonial(o.toJSON()).save().done((function(e){TVE_Dash.success(e.message);var i=new ThriveOvation.models.Testimonial(e),a=new ThriveOvation.views.TestimonialsItem({model:i}).render().$el;ThriveOvation.util.decrementIncrementListCounters(i,1),ThriveOvation.objects.Testimonials.push(i),ThriveOvation.objects.TestimonialsList.$el.prepend(a),new ThriveOvation.views.TestimonialPagination({collection:ThriveOvation.objects.Testimonials,view:ThriveOvation.objects.TestimonialsList,el:jQuery(".tvo-top-pagination"),type:"static"}).checkFieldsDisplay(),t(".tvd-material-tooltip").hide()})).error((function(t){t=JSON.parse(t.responseText),TVE_Dash.err(t.message+": "+t.code)}))},newTestimonialModal:function(){return this.modal(ThriveOvation.views.ModalNewTestimonial,{model:new ThriveOvation.models.Testimonial}),this},checkMultipleTestimonialsCheckboxForParticularClass:function(t){jQuery(t.currentTarget).removeClass("tvo-multiple-tags-particular")},addTagsToMultipleTestimonials:function(e){var i=[],a=[],o=[],n=this;TVE_Dash.showLoader(),this.$(".tvo-add-multiple-tags-checkbox").each((function(){var e=t(this);if(this.checked){var i=e.attr("data-id");a.push(i)}else if(!this.classList.contains("tvo-multiple-tags-particular")){var n=e.attr("data-id");o.push(n)}})),this.$(".tvo-checkbox-testimonial-item:checked").each((function(){var t=jQuery(this).attr("data-id");i.push(t)})),t.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},cache:!1,url:ThriveOvation.routes.tags+"/add_multiple_tags_to_multiple_testimonials",type:"POST",data:{tvo_testimonial_ids:i,tvo_tags_ids:a,tvo_delete_tags_ids:o}}).done((function(t){n.resetView(),t.length>0&&n.fetchTestimonialListData(),n.$(".tvo-close-modal-add-tags-to-multiple-testimonials").click()})).always((function(){setTimeout((function(){TVE_Dash.hideLoader()}),500)}))},deleteTestimonialsModal:function(t){jQuery("#tvo-delete-multiple-testimonials-modal").openModal({})},deleteMultipleTestimonials:function(e){var i=[],a=[],o=this;this.$(".tvo-checkbox-testimonial-item:checked").each((function(){var t=jQuery(this).attr("data-id"),e=ThriveOvation.objects.Testimonials.get(t);i.push(t),a.push(e)})),t.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},cache:!1,url:ThriveOvation.objects.Testimonials.url(),type:"DELETE",data:{tvo_testimonial_elements:i}}).done((function(t){for(var e=0;e<t.length;e++)jQuery(".testimonial-row-"+t[e]).remove();jQuery(a).each((function(t,e){ThriveOvation.util.decrementIncrementListCounters(e,-1),ThriveOvation.objects.Testimonials.remove(e)})),o.resetView(),o.testimonialsPagination.changePage(),TVE_Dash.success(ThriveOvation.translations.multiple_testimonials_deleted_success_toast)})).error((function(){TVE_Dash.err(ThriveOvation.translations.multiple_testimonials_deleted_fail_toast)})).always((function(){TVE_Dash.hideLoader()}))},applyFilters:function(t){var e=jQuery(t.currentTarget),i=this;TVE_Dash.showLoader(),this.$(".tvo-testimonials-select-all").prop("checked",!1).trigger("change"),this.adjustTagsCheckboxes(),e.hasClass("tvo-filter-status")?(i.filter_status=[],jQuery("input:checkbox.tvo-filter-status").each((function(){this.checked&&i.filter_status.push(jQuery(this).val())}))):e.hasClass("tvo-filter-tag")?e.is(":checked")?i.filter_untagged=1:i.filter_untagged=0:e.hasClass("tvo-filter-picture")&&(e.is(":checked")?i.filter_nopicture=1:i.filter_nopicture=0),this.testimonialsPagination.changePage(null,{status:i.filter_status,untagged:i.filter_untagged,nopicture:i.filter_nopicture})},applyDropDownFilters:function(t){var e=jQuery(t.currentTarget),i=this,a=e.attr("class").split(" ").shift();switch(TVE_Dash.showLoader(),this.$(".tvo-testimonials-select-all").prop("checked",!1).trigger("change"),this.adjustTagsCheckboxes(),a){case"tvo-image-filter":i.image_filter=e.val(),"any"==e.val()&&e.val("select-title");break;case"tvo-title-filter":i.title_filter=e.val(),"any"==e.val()&&e.val("select-image")}this.testimonialsPagination.changePage(null,{titleFilter:i.title_filter,imageFilter:i.image_filter})},resetFilters:function(){var t=this.$(".tvo-image-filter"),e=this.$(".tvo-title-filter");this.$("#tvo-dashboard-filter-tags").select2("val",""),this.testimonialsPagination.changePage(null,{tagsFilter:""}),e.val("select-title").trigger("change"),t.val("select-image").trigger("change")},showTagDropdown:function(e){var i=this.$el,a=this,o=jQuery(e.target).parents(".tvo-new-dropdown"),n=o.find(".tvo-new-dropdown-content");o.toggleClass("tvd-active"),n.slideToggle(),e.stopPropagation(),i.parents("body").off("click.clearDropdown").on("click.clearDropdown",(function(e){if(!t(e.target).parents().is(o)){var n=i.find(".tvo-new-dropdown"),s=i.find(".tvo-new-dropdown-content");n.hasClass("tvd-active")&&(s.slideUp(),n.removeClass("tvd-active"),a.resetTheParticularTags())}}))},render:function(){return this.$el.html(this.template()),TVE_Dash.materialize(this.$el),ThriveOvation.objects.Testimonials=new ThriveOvation.collections.Testimonials,ThriveOvation.objects.TestimonialsList=new ThriveOvation.views.TestimonialsList({collection:ThriveOvation.objects.Testimonials,el:this.$("#tvo-testimonials-list")}),this.testimonialsPagination=new ThriveOvation.views.TestimonialPagination({collection:ThriveOvation.objects.Testimonials,view:ThriveOvation.objects.TestimonialsList,el:this.$(".tvo-top-pagination"),type:"static"}),this.renderFilterTags(),this.fetchTestimonialListData(),setTimeout((function(){jQuery(".tvd-dropdown-button").tvd_dropdown()}),500),TVE_Dash.hideLoader(),this},fetchTestimonialListData:function(){var t=this;ThriveOvation.objects.Testimonials.fetch({success:function(){t.testimonialsPagination.changePage()}})},renderFilterTags:function(){var t=this,e=this.$("#tvo-dashboard-filter-tags");e.data("select2")&&e.select2("destroy"),e.select2({tags:!0,multiple:!0,data:ThriveOvation.availableTags,placeholder:ThriveOvation.translations.select_filter_tags}).on("select2:select",(function(i){t.testimonialsPagination.changePage(null,{tagsFilter:e.val()})})).on("select2:unselect",(function(i){i.params.originalEvent&&(t.testimonialsPagination.changePage(null,{tagsFilter:e.val()}),i.params.originalEvent.stopPropagation())}))}}),ThriveOvation.views.TestimonialsList=ThriveOvation.views.Base.extend({events:{},initialize:function(){},renderOne:function(t){var e=new ThriveOvation.views.TestimonialsItem({model:t}).render().$el;this.$el.append(e)},render:function(t){this.$el.empty();var e=this.collection;return void 0!==t&&(e=new ThriveOvation.collections.Testimonials(t)),e.each(this.renderOne,this),this}}),ThriveOvation.views.TestimonialsItem=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("testimonials/item"),events:{"change .tvo-testimonial-status-change":"updateTestimonialStatus","click .tvo-delete-testimonial-modal":"deleteTestimonialModal","click .tvo-remove-testimonial-tag":"deleteTestimonialTag","click .tvo-add-new-tag":"addNewTag","click .tvo-add-new-tag-action":"addNewTagAction"},attributes:function(){return{class:"tvd-row tvo-gray-box testimonial-row-"+this.model.get("id")}},initialize:function(t){},addNewTag:function(t){this.$(".tvo-testimonial-"+this.model.get("id")+"-tag-display-area").addClass("tvd-hide"),this.$(".tvo-testimonial-"+this.model.get("id")+"-tag-add-area").removeClass("tvd-hide"),this.$("#tvo-testimonial-"+this.model.get("id")+"-new-tag").select2("open")},addNewTagAction:function(t){var e=jQuery(t.currentTarget),i=this.$("#tvo-testimonial-"+this.model.get("id")+"-new-tag").select2("data"),a=this,o=this.model.get("tags").length;e.hasClass("tvd-disabled")||(ThriveOvation.util.setLoading(e),this.model.set("tags",this.$("#tvo-testimonial-"+this.model.get("id")+"-new-tag").val()),this.model.save(null,{success:function(t,e){var n="";i.length>0?jQuery.each(i,(function(e,i){var a={id:i.id,text:i.text,model_id:t.get("id")};n+=TVE_Dash.tpl("testimonials/tag-item",{object:a})})):n+='<i class="tvd-small-text tvo-gray-text">'+ThriveOvation.translations.untagged_testimonial+"</i>",a.$(".tvo-testimonial-"+t.get("id")+"-tag-display-area > div.tvd-clearfix").html(n),a.$(".tvo-testimonial-"+t.get("id")+"-tag-display-area").removeClass("tvd-hide"),a.$(".tvo-testimonial-"+t.get("id")+"-tag-add-area").addClass("tvd-hide"),0===o&&t.get("tags").length>0?ThriveOvation.util.incrementDecrementTagCounters(-1):o>0&&0===t.get("tags").length&&ThriveOvation.util.incrementDecrementTagCounters(1),TVE_Dash.success(ThriveOvation.translations.testimonial_tag_added_success_toast)},error:function(t,e){TVE_Dash.err(ThriveOvation.translations.testimonial_tag_added_fail_toast)},complete:function(){ThriveOvation.util.removeLoading(e)}}))},renderSelectTags:function(){var t=this,e=this.$("#tvo-testimonial-"+this.model.get("id")+"-new-tag");e.data("select2")&&e.select2("destroy"),null==t.$("#tvo-testimonial-"+t.model.get("id")+"-new-tag").val()&&t.$(".tvo-add-new-tag-action").html(ThriveOvation.translations.update_tags),e.select2({tags:!0,multiple:!0,placeholder:ThriveOvation.translations.tags_select2_placeholder}).on("select2:select",(function(e){t.$(".tvo-add-new-tag-action").html(ThriveOvation.translations.save),ThriveOvation.util.addNewTagInTheSystem(e.params.data,t)})).on("select2:unselect",(function(e){e.params.originalEvent&&(null==t.$("#tvo-testimonial-"+t.model.get("id")+"-new-tag").val()&&t.$(".tvo-add-new-tag-action").html(ThriveOvation.translations.update_tags),e.params.originalEvent.stopPropagation())})).on("select2:open",(function(e){var i=t.$(".tvo-testimonial-"+t.model.get("id")+"-tag-add-area").find(".select2-search__field"),a=t.$("#tvo-testimonial-"+t.model.get("id")+"-new-tag");i.unbind(),i.keyup((function(e){13===e.which&&""==i.val()&&(a.select2("close"),t.$(".tvo-testimonial-"+t.model.get("id")+"-tag-add-area").find(".tvo-add-new-tag-action").click())}))}))},renderTags:function(t){var e=this;e.$("#tvo-testimonial-"+e.model.get("id")+"-new-tag").empty(),ThriveOvation.availableTags.forEach((function(i){var a="";ThriveOvation.util.containsObject(i,t)&&(a='selected="selected"');var o='<option value="'+i.id+'" '+a+">"+i.text+"</option>";e.$("#tvo-testimonial-"+e.model.get("id")+"-new-tag").append(o)})),e.renderSelectTags()},deleteTestimonialModal:function(t){var e=jQuery("#tvo-delete-testimonial-modal"),i=t.currentTarget.attributes["data-id"].value,a=t.currentTarget.attributes["data-title"].value;e.find(".tvo-delete-content-title").html(a),e.openModal({ready:function(){e.find(".tvo-detele-testimonial-action").attr("data-id",i)}})},updateTestimonialStatus:function(t){var e=jQuery(t.currentTarget),i=jQuery(e).val(),a=jQuery(e).attr("data-value");i!=a&&(this.model.set({status:i}),new ThriveOvation.models.PostMeta({key:this.model.get("id"),meta_key:ThriveOvation.const.meta_key.status,meta_value:i}).save(null,{success:function(t,o){jQuery(e).attr("data-value",i).removeClass("tvo-testimonial-status-"+a).addClass("tvo-testimonial-status-"+i),ThriveOvation.util.incrementDecrementStatusCounters(a,i),TVE_Dash.success(ThriveOvation.translations.status_changed_success_toast)},error:function(t,e){TVE_Dash.err(ThriveOvation.translations.status_changed_fail_toast)}}))},deleteTestimonialTag:function(t){for(var e=jQuery(t.currentTarget),i=e.attr("data-testimonial-id"),a=e.attr("data-tag-id"),o=this.model.get("tags"),n=[],s=this.$el,r=this,l=0;l<o.length;l++)if(o[l].id==a){n.name=o[l].text,n.post_id=o[l].post_id,n.term_id=o[l].id;break}new ThriveOvation.models.Tag(n).destroy({data:{post_id:n.post_id,id:n.term_id},processData:!0,success:function(t,e){if(s.find(".tvo-testimonial-custom-tag-"+i+"-"+a).remove(),0===s.find(".tvo-testimonial-custom-tag").length){var o='<i class="tvd-small-text tvo-gray-text">'+ThriveOvation.translations.untagged_testimonial+"</i>";s.find("div.tvo-testimonial-"+i+"-tag-display-area > div.tvd-clearfix").html(o),ThriveOvation.util.incrementDecrementTagCounters(1)}TVE_Dash.success(ThriveOvation.translations.testimonial_tag_removed_success_toast),s.find("div.tvo-testimonial-"+i+"-tag-display-area > div.tvd-clearfix").html(o),r.deleteTagFromSelect(n.term_id)},error:function(t,e){TVE_Dash.err(ThriveOvation.translations.testimonial_tag_removed_fail_toast)}})},deleteTagFromSelect:function(e){var i=this.model.get("tags"),a=t.grep(i,(function(t){return t.id!=e}));this.model.set("tags",a),this.renderTags(a)},render:function(){this.$el.html(this.template({testimonial:this.model})),TVE_Dash.materialize(this.$el);var t=this.model.get("tags");return this.renderTags(t),this}}),ThriveOvation.views.TestimonialPagination=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("pagination/post-view"),events:{"click a.page":"setLoaderBeforeChangingThePage","change .tvo-items-per-page":"changeItemPerPage"},currentPage:1,pageCount:1,itemsPerPage:10,total_items:0,collection:null,params:null,type:"",view:null,initialize:function(t){this.collection=t.collection,this.view=t.view,this.type=t.type},changeItemPerPage:function(t){var e=this;TVE_Dash.showLoader(),this.itemsPerPage=jQuery(t.target).val(),setTimeout((function(){e.changePage(null,{page:1})}),10)},setLoaderBeforeChangingThePage:function(t,e){var i=this;TVE_Dash.showLoader(),setTimeout((function(){i.changePage(t,e)}),10)},changePage:function(e,i){TVE_Dash.showLoader();var a=this,o={itemsPerPage:this.itemsPerPage},n={readyForDisplay:0,awaitingReview:0,awaitingApproval:0,rejected:0,untagged:0,noPicture:0};if(e&&void 0!==e.currentTarget?o.page=jQuery(e.currentTarget).attr("value"):i&&void 0!==i.page?o.page=parseInt(i.page):o.page=this.currentPage,o.page<1&&(o.page=1),void 0!==i&&(void 0!==i.search_by&&(this.search_by=i.search_by),void 0!==i.status&&(this.status=i.status),void 0!==i.untagged&&(this.untagged=i.untagged),void 0!==i.nopicture&&(this.nopicture=i.nopicture),void 0!==i.titleFilter&&(this.titleFilter=i.titleFilter),void 0!==i.imageFilter&&(this.imageFilter=i.imageFilter),void 0!==i.tagsFilter&&(this.tagsFilter=i.tagsFilter)),o.search_by=this.search_by?this.search_by:"",o.exclude=this.exclude?this.exclude:[],o.status=this.status?this.status:[],o.untagged=this.untagged?this.untagged:0,o.nopicture=this.nopicture?this.nopicture:0,o.titleFilter=this.titleFilter?this.titleFilter:"",o.imageFilter=this.imageFilter?this.imageFilter:"",o.tagsFilter=this.tagsFilter?this.tagsFilter:[],"dynamic"==this.type)this.collection.fetch({reset:!0,data:t.param(o),success:function(){0==a.collection.length&&a.collection.total_count>0&&1!=a.currentPage?a.changePage(null,{page:a.currentPage-1}):(a.updateParams(o.page,a.collection.total_count),a.render())}});else if("static"==this.type&&void 0!==this.view&&null!=this.view){this.updateParams(o.page,this.collection.length);var s,r=this.collection.clone(),l=(this.currentPage-1)*this.itemsPerPage,v=[];for(var c in void 0!==r.comparator&&r.sort(),r.each((function(t){switch(t.get("status")){case ThriveOvation.const.status.ready_for_display:n.readyForDisplay++;break;case ThriveOvation.const.status.awaiting_approval:n.awaitingApproval++;break;case ThriveOvation.const.status.awaiting_review:n.awaitingReview++;break;case ThriveOvation.const.status.rejected:n.rejected++}if(o.status.length>0&&-1===jQuery.inArray(t.get("status"),o.status)&&v.push(t),t.get("tags").length>0?0!=o.untagged&&v.push(t):n.untagged++,-1==t.get("picture_url").indexOf(ThriveOvation.testimonial_image_placeholder)?0!=o.nopicture&&v.push(t):n.noPicture++,o.tagsFilter.length>0){for(var e=!0,i=t.get("tags").map((function(t){return t.id})),a=0;a<o.tagsFilter.length;a++)-1!==i.indexOf(parseInt(o.tagsFilter[a]))&&(e=!1);e&&v.push(t)}if(""!=o.titleFilter){var s=o.titleFilter,r=t.get("title")||"";switch(s){case"with-title":""==r&&v.push(t);break;case"without-title":""!=r&&v.push(t)}}if(""!=o.imageFilter)switch(o.imageFilter){case"with-image":0==t.get("has_picture")&&v.push(t);break;case"without-image":1==t.get("has_picture")&&v.push(t)}})),a.setCountersToLabels(n),v)r.remove(v[c]);if(this.updateParams(o.page,r.length),s=r.chain().rest(l).first(this.itemsPerPage).value(),this.view.render(s),0==s.length){if(a.collection.length>0&&1!=a.currentPage)return void a.changePage(null,{page:a.currentPage-1});jQuery("#tvo-testimonials-list").html(TVE_Dash.tpl("pagination/no-results"))}this.checkFieldsDisplay(),this.render()}return!1},setCountersToLabels:function(t){jQuery(".tvo-ready-for-display-c").html(t.readyForDisplay),jQuery(".tvo-awaiting-approval-c").html(t.awaitingApproval),jQuery(".tvo-awaiting-review-c").html(t.awaitingReview),jQuery(".tvo-rejected-c").html(t.rejected),jQuery(".tvo-untagged-c").html(t.untagged),jQuery(".tvo-no-picture-c").html(t.noPicture)},checkFieldsDisplay:function(){jQuery("#tvo-show-hide-tags").is(":checked")?(jQuery(".tvo-show-hide-tags-container").removeClass("tvd-hide").trigger("change"),ThriveOvation.util.incrementDecrementShowHideSpace("tvo-show-hide-tags",-1)):(jQuery(".tvo-show-hide-tags-container").addClass("tvd-hide").trigger("change"),ThriveOvation.util.incrementDecrementShowHideSpace("tvo-show-hide-tags",1)),jQuery("#tvo-show-hide-status").is(":checked")?(jQuery(".tvo-show-hide-status-container").removeClass("tvd-hide").trigger("change"),ThriveOvation.util.incrementDecrementShowHideSpace("tvo-show-hide-status",-1)):(jQuery(".tvo-show-hide-status-container").addClass("tvd-hide").trigger("change"),ThriveOvation.util.incrementDecrementShowHideSpace("tvo-show-hide-status",1)),jQuery("#tvo-show-hide-type").is(":checked")?jQuery(".tvo-show-hide-type-container").removeClass("tvd-hide").trigger("change"):jQuery(".tvo-show-hide-type-container").addClass("tvd-hide").trigger("change"),"full"==jQuery(".tvo-filter-content").val()?(jQuery(".tvo-testimonial-content-summary").addClass("tvd-hide"),jQuery(".tvo-testimonial-content-full").removeClass("tvd-hide")):(jQuery(".tvo-testimonial-content-summary").removeClass("tvd-hide"),jQuery(".tvo-testimonial-content-full").addClass("tvd-hide"))},updateParams:function(t,e){this.currentPage=t,this.total_items=e,this.pageCount=Math.ceil(this.total_items/this.itemsPerPage)},setupParams:function(t){this.currentPage=t,this.total_items=this.collection.length,this.pageCount=Math.ceil(this.total_items/this.itemsPerPage)},render:function(){return this.$el.html(this.template({currentPage:parseInt(this.currentPage),pageCount:parseInt(this.pageCount),total_items:parseInt(this.total_items),itemsPerPage:parseInt(this.itemsPerPage)})),TVE_Dash.hideLoader(),TVE_Dash.materialize(this.$el),this}}),ThriveOvation.views.ModalNewTestimonial=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("testimonials/testimonial/modal"),type:"",events:{"click .tvo-save-new-testimonial":"save","click .tvo-upload-testimonial-image":"openUploadImage","click #tvo-remove-testimonial-image":"removeImage","keydown .tvo-testimonial-input":"enterPress"},afterRender:function(){return this.$el.html(this.template({testimonial:this.model})),this.renderTestimonialEditor(),this.$el.addClass("tvo-big-modal"),this},afterMaterialize:function(){return this.renderSelectTags(),this},enterPress:function(t){13!==t.which&&13!==t.keyCode||this.save()},renderSelectTags:function(){var t=this.$("#tvo-author-new-tag-modal"),e=this;t.data("select2")&&t.select2("destroy"),t.select2({tags:!0,multiple:!0,data:ThriveOvation.availableTags,placeholder:ThriveOvation.translations.tags_select2_placeholder}).on("select2:select",(function(t){ThriveOvation.util.addNewTagInTheSystem(t.params.data,e)})).on("select2:unselect",(function(t){t.params.originalEvent&&t.params.originalEvent.stopPropagation()}))},renderTestimonialEditor:function(){var e=ThriveOvation.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["tvo-tinymce-tpl"],qt:window.tinyMCEPreInit.qtInit["tvo-tinymce-tpl"]},"tvo-testimonial-content-tinymce");e&&(tinyMCEPreInit.mceInit=t.extend(tinyMCEPreInit.mceInit,e.mce_init),tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"].setup=function(t){t.on("change",(function(){t.save()}))},tinyMCE.init(tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"]),window.wpActiveEditor="tvo-testimonial-content-tinymce")},validateModel:function(){var t=!0;return ThriveOvation.util.validateInput(this.$("#tvo-author-name"),ThriveOvation.translations.author_name_required,!0)||(t=!1),this.$("#tvo-author-email").val()&&!ThriveOvation.util.validateEmail(this.$("#tvo-author-email"))&&(t=!1),this.$("#tvo-author-website").val()&&!ThriveOvation.util.validateURL(this.$("#tvo-author-website"))&&(t=!1),ThriveOvation.util.validateInput(ThriveOvation.util.getTestimonialContent(this.$el),ThriveOvation.translations.testimonial_content_missing,!0)?this.$(".tvo-testimonial-content").removeClass("tvo-tiny-mce-error"):(t=!1,this.$(".tvo-testimonial-content").addClass("tvo-tiny-mce-error")),t},save:function(){TVE_Dash.showLoader();var t=this,e={title:this.$("#tvo-title").val(),name:this.$("#tvo-author-name").val(),email:this.$("#tvo-author-email").val(),role:this.$("#tvo-author-role").val(),website_url:this.$("#tvo-author-website").val(),content:ThriveOvation.util.getTestimonialContent(this.$el),tags:this.$("#tvo-author-new-tag-modal").val(),picture_url:1==this.$("input[name='tvo-is-placeholder']").val()?"":this.$(".tvo-testimonial-author-image img").attr("src"),source:ThriveOvation.const.source.plugin},i=this.$(".tvo-save-new-testimonial");if(this.validateModel()){if(i.hasClass("tvd-disabled"))return;ThriveOvation.util.setLoading(i),this.model.save(e).done((function(e){TVE_Dash.success(e.message);var i=new ThriveOvation.models.Testimonial(e),a=new ThriveOvation.views.TestimonialsItem({model:i}).render().$el;ThriveOvation.util.decrementIncrementListCounters(i,1),ThriveOvation.objects.Testimonials.push(i),ThriveOvation.objects.TestimonialsList.$el.prepend(a),new ThriveOvation.views.TestimonialPagination({collection:ThriveOvation.objects.Testimonials,view:ThriveOvation.objects.TestimonialsList,el:jQuery(".tvo-top-pagination"),type:"static"}).changePage(),jQuery("body").trigger("filterReset"),t.close()})).error((function(t){t=JSON.parse(t.responseText),TVE_Dash.err(t.message+": "+t.code)})).always((function(){ThriveOvation.util.removeLoading(i),TVE_Dash.hideLoader()}))}else TVE_Dash.hideLoader();return!0},openUploadImage:function(){if(t)t.open();else{var t=wp.media({title:ThriveOvation.translations.choose_testimonial_image,button:{text:ThriveOvation.translations.choose_testimonial_image_button},library:{type:"image"},multiple:!1,frame:"select"}),e=this;t.on("select",(function(){var i=t.state().get("selection").first().toJSON();e.$("input[name='tvo-is-placeholder']").val(0),e.$(".tvo-testimonial-author-image img").attr("src",i.url),e.$("#tvo-upload-testimonial-image").hide(),e.$(".tvo-image-uploaded").show()})),t.open()}},removeImage:function(){var t=this.$("#tvo-remove-testimonial-image").attr("data-default");this.$(".tvo-testimonial-author-image img").attr("src",t),this.$("#tvo-upload-testimonial-image").show(),this.$(".tvo-image-uploaded").hide()},beforeClose:function(){ThriveOvation.util.clearMCEEditor()}}),ThriveOvation.views.Testimonial=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("testimonials/testimonial"),events:{"click .tvo-update-testimonial":"updateTestimonial","change #tvo-testimonial-status-change":"updateTestimonialStatus","click .tvo-upload-testimonial-image":"openUploadImage","click #tvo-remove-testimonial-image":"removeImage","click .tvo-send-approval-email":"openEmailModal","keydown .tvo-testimonial-input":"enterPress","keyup .tvo-testimonial-input":"updateTestimonialModel","click .tvo-open-testimonial-webpage":function(){if(ThriveOvation.util.validateInput(this.$("#tvo-author-website"))&&ThriveOvation.util.validateURL(this.$("#tvo-author-website"))){var t=this.$("#tvo-author-website").val();"http"!==t.substring(0,4)&&(t="//"+t),window.open(t,"_blank")}},"click .tvo-open-testimonial-email":function(){window.location.href="mailto:"+this.$("#tvo-author-email").val()}},className:"tvd-testimonial-page",tagName:"div",initialize:function(){return this.listenTo(this.model,"sync",this.render),ThriveOvation.objects.EmailConfig=new ThriveOvation.models.EmailConfig,this},render:function(){this.$el.html(this.template({testimonial:this.model})),this.renderTestimonialEditor(),this.renderAcivitylog();var t=this.model.get("tags");return TVE_Dash.materialize(this.$el),this.renderTags(t),this},renderAcivitylog:function(){var t=this.model.get("activityLog");ThriveOvation.objects.ActivityLogEntriesCollection=new ThriveOvation.collections.ActivityLog(t),ThriveOvation.objects.ActivityLogViews instanceof ThriveOvation.views.ActivityLogView&&ThriveOvation.objects.ActivityLogViews.undelegateEvents(),ThriveOvation.objects.ActivityLogViews=new ThriveOvation.views.ActivityLogView({collection:ThriveOvation.objects.ActivityLogEntriesCollection,el:this.$("#tvo-activity-log-entries")}),ThriveOvation.objects.Testimonial.set("activityLogCount",parseInt(this.model.get("activityLogCount"))),ThriveOvation.objects.ActivityLogViews.render()},renderSelectTags:function(){var t=this;this.$("#tvo-author-new-tag-"+this.model.get("id")).select2({tags:!0,multiple:!0,placeholder:ThriveOvation.translations.tags_select2_placeholder}).on("select2:select",(function(e){ThriveOvation.util.addNewTagInTheSystem(e.params.data,t)})).on("select2:unselect",(function(t){t.params.originalEvent&&t.params.originalEvent.stopPropagation()}))},enterPress:function(t){13!=t.which&&13!=t.keyCode||this.updateTestimonial()},renderTags:function(t){var e=this,i="";ThriveOvation.availableTags.forEach((function(a){i=ThriveOvation.util.containsObject(a,t)?'selected="selected"':"";var o='<option value="'+a.id+'" '+i+">"+a.text+"</option>";e.$("#tvo-author-new-tag-"+e.model.get("id")).append(o)})),this.renderSelectTags()},renderTestimonialEditor:function(){var e=ThriveOvation.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["tvo-tinymce-tpl"],qt:window.tinyMCEPreInit.qtInit["tvo-tinymce-tpl"]},"tvo-testimonial-content-tinymce");e&&(tinyMCEPreInit.mceInit=t.extend(tinyMCEPreInit.mceInit,e.mce_init),tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"].setup=function(t){t.on("change",(function(){t.save()}))},tinyMCE.init(tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"]),window.wpActiveEditor="tvo-testimonial-content-tinymce",tinyMCE.get("tvo-testimonial-content-tinymce").setContent(this.model.get("content")))},validateModel:function(){var t=!0,e=this.$("#tvo-author-email");return ThriveOvation.util.validateInput(this.$("#tvo-author-name"),ThriveOvation.translations.isRequired)||(t=!1),"twitter"!==this.model.get("media_source")&&"facebook"!==this.model.get("media_source")&&""!=e.val()&&(ThriveOvation.util.validateEmail(e)||(t=!1)),this.$("#tvo-author-website").val()&&!ThriveOvation.util.validateURL(this.$("#tvo-author-website"))&&(t=!1),ThriveOvation.util.validateInput(ThriveOvation.util.getTestimonialContent(this.$el),ThriveOvation.translations.testimonial_content_missing,!0)?this.$(".tvo-testimonial-content").removeClass("tvo-tiny-mce-error"):(t=!1,this.$(".tvo-testimonial-content").addClass("tvo-tiny-mce-error")),t},updateTestimonialModel:function(t){var e=jQuery(t.currentTarget);ThriveOvation.util.setModelWithKeyValue(e,this.model)},updateTestimonial:function(){TVE_Dash.showLoader();var t=this;return this.model.set("tags",t.$("#tvo-author-new-tag-"+t.model.get("id")).val()),this.model.set("content",ThriveOvation.util.getTestimonialContent(this.$el)),this.validateModel()?(ThriveOvation.util.clearMCEEditor(),this.model.save().done((function(e){t.model.set("tags",e.tags),t.model.set("activityLog",e.activityLog),t.model.set("activityLogCount",e.activityLogCount),t.renderAcivitylog(),TVE_Dash.success(ThriveOvation.translations.testimonial_successfully_saved)})).error((function(t){TVE_Dash.err(JSON.parse(t.responseText).message)})).always((function(){TVE_Dash.hideLoader()}))):TVE_Dash.hideLoader(),!0},updateTestimonialStatus:function(t){var e=jQuery(t.currentTarget),i=jQuery(e).val(),a=jQuery(e).attr("data-value"),o=this;i!=a&&(this.model.set({status:this.$("#tvo-testimonial-status-change").val()}),new ThriveOvation.models.PostMeta({key:this.model.get("id"),meta_key:ThriveOvation.const.meta_key.status,meta_value:this.$("#tvo-testimonial-status-change").val()}).save(null,{success:function(t,n){jQuery(e).attr("data-value",i).removeClass("tvo-testimonial-status-"+a).addClass("tvo-testimonial-status-"+i),TVE_Dash.success(ThriveOvation.translations.status_changed_success_toast),o.model.set("activityLog",n.activityLog),o.model.set("activityLogCount",n.activityLogCount),o.renderAcivitylog()},error:function(t,e){TVE_Dash.err(ThriveOvation.translations.status_changed_fail_toast)}}))},openEmailModal:function(){this.modal(ThriveOvation.views.ConfigureEmailModal,{model:ThriveOvation.objects.EmailConfig,testimonial:ThriveOvation.objects.Testimonial,preview:!0})},openConfirmModal:function(){this.modal(ThriveOvation.views.ConfirmSendingEmailModal,{model:new ThriveOvation.models.ConfirmEmailSend})},sendApprovalEmail:function(){TVE_Dash.showLoader();var t=this.model.get("id"),e=this;jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:ThriveOvation.routes.testimonials+"/email/approval",type:"POST",data:{testimonial:t}}).done((function(t){e.model.set("activityLog",t.activityLog),e.model.set("activityLogCount",t.activityLogCount),e.model.set("status",t.status),e.model.set("sent_emails",t.sent_emails),e.$("#tvo-testimonial-status-change").val(t.status).trigger("change"),e.renderAcivitylog(),TVE_Dash.success(ThriveOvation.translations.confirmation_email_sent)})).error((function(t){TVE_Dash.err(JSON.parse(t.responseText).message)})).always((function(){TVE_Dash.hideLoader()}))},openUploadImage:function(){if(t)t.open();else{var t=wp.media({title:ThriveOvation.translations.choose_testimonial_image,button:{text:ThriveOvation.translations.choose_testimonial_image_button},library:{type:"image"},multiple:!1,frame:"select"}),e=this;t.on("select",(function(){var i=t.state().get("selection").first().toJSON();e.model.set("picture_url",i.url),e.$(".tvo-profile-picture").css("background-image","url("+i.url+")"),e.$("#tvo-upload-testimonial-image").hide(),e.$(".tvo-image-uploaded").show()})),t.open()}},removeImage:function(){var t=this.$("#tvo-remove-testimonial-image").attr("data-default");this.model.set("picture_url",t),this.$(".tvo-profile-picture").css("background-image","url("+t+")"),this.$("#tvo-upload-testimonial-image").show(),this.$(".tvo-image-uploaded").hide()}}),ThriveOvation.views.Setting=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("settings"),events:{"click .tvo-save-settings":"saveSettings","click .tvo-add-new-connection":"openConnectionModal","click .tvo-configure-email-template":"openEmailConfigureModal","click .tvo-configure-landing-page":"openLandingPageConfigureModal","click .tvo-new-image":"selectDefaultImage","click .tvo-default-image":"setDefaultImage"},initialize:function(){this.listenTo(this.model,"sync",this.render)},init:function(){var t=this.model;jQuery(".tvo-setting-input-select").each((function(){var e=jQuery(this).data("key");jQuery(this).val(t.get(e))})),ThriveOvation.objects.EmailConfig=new ThriveOvation.models.EmailConfig},render:function(){return this.$el.html(this.template({settings:this.model}).replace(/tve-script/g,"script")),ThriveOvation.util.bind_wistia(),this.init(),this.renderApiConnections(),TVE_Dash.materialize(this.$el),TVE_Dash.hideLoader(),this},renderApiConnections:function(){return new ThriveOvation.views.AssetConnections({collection:ThriveOvation.objects.AssetConnection,el:this.$("#tvo-email-connection-wrap")}).render(),this},openConnectionModal:function(){TVE_Dash.modal(ThriveOvation.views.ConnectionModal,{"max-width":"35%",model:new ThriveOvation.models.NewConnection({connected_apis:ThriveOvation.objects.AssetConnection})})},openLandingPageConfigureModal:function(){this.modal(ThriveOvation.views.ConfigureLandingPageModal,{model:new ThriveOvation.models.LandingPageConfig,"max-width":"45%"})},openEmailConfigureModal:function(){this.modal(ThriveOvation.views.ConfigureEmailModal,{model:ThriveOvation.objects.EmailConfig})},saveSettings:function(t){var e=jQuery(t.currentTarget),i=this.model;e.hasClass("tvd-disabled")||(ThriveOvation.util.setLoading(e),jQuery(".tvo-setting-input-checkbox").each((function(){var t=jQuery(this),e=t.data("key"),a=Number(t[0].checked),o={};o[e]=a,i.set(o)})),i.save(null,{success:function(t,i){TVE_Dash.success(ThriveOvation.translations.settings_saved_success_toast),ThriveOvation.util.removeLoading(e)},error:function(t,i){TVE_Dash.err(ThriveOvation.translations.settings_saved_fail_toast),ThriveOvation.util.removeLoading(e)}}))},selectDefaultImage:function(){if(t)t.open();else{var t=wp.media({title:ThriveOvation.translations.choose_default_image,button:{text:ThriveOvation.translations.choose_testimonial_image_button},library:{type:"image"},multiple:!1,frame:"select"}),e=this;t.on("select",(function(){var i=t.state().get("selection").first().toJSON();e.$(".tvo-default-picture").css("background-image","url("+i.url+")"),e.$(".tvo-default-image").attr("disabled",!1),e.saveDefaultImage(i.url)})),t.open()}},setDefaultImage:function(t){var e=t.currentTarget.getAttribute("data-default");t.currentTarget.setAttribute("disabled",!0),this.$(".tvo-default-picture").css("background-image","url("+e+")"),this.saveDefaultImage(e)},saveDefaultImage:function(t){t||(t=this.$(".tvo-default-picture").css("background-image")),TVE_Dash.showLoader(),jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},type:"POST",url:ThriveOvation.routes.settings+"/default-placeholder",data:{image:t}}).done((function(){TVE_Dash.success(ThriveOvation.translations.success_image_set)})).fail((function(){TVE_Dash.error(ThriveOvation.translations.error_image_set)})).always((function(){TVE_Dash.hideLoader()}))}}),ThriveOvation.views.ActivityLogEntryView=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("testimonials/activity/log/entry"),tagName:"li",className:"tvd-collection-item tvo-activity-log-entry",events:{},initialize:function(t){},render:function(){return this.$el.html(this.template({logEntry:this.model})),this}}),ThriveOvation.views.ActivityLogView=ThriveOvation.views.Base.extend({events:{"click .tvo-extend-activity-log":"extend"},initialize:function(){},renderOne:function(t){var e=new ThriveOvation.views.ActivityLogEntryView({model:t}).render().$el;this.$el.append(e)},render:function(t){this.$el.empty();var e=this.collection;return void 0!==t&&(e=new ThriveOvation.collections.ActivityLog(t)),e.each(this.renderOne,this),this.removeExtension(),this.renderExtension(),this},removeExtension:function(){this.$(".tvo-activity-log-extension").remove()},extend:function(){var e=this;TVE_Dash.showLoader(),t.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:e.collection.url()+ThriveOvation.objects.Testimonial.get("id")+"/"+e.collection.length,type:"GET"}).done((function(t){t.activity_log.length&&(e.removeExtension(),t.activity_log.forEach((function(t){var i=new ThriveOvation.models.ActivityLogEntry(t);e.collection.push(i),e.renderOne(i)})),e.renderExtension())})).error((function(){})).always((function(){TVE_Dash.hideLoader()}))},renderExtension:function(){if(this.collection.length<ThriveOvation.objects.Testimonial.get("activityLogCount")){var t=TVE_Dash.tpl("testimonials/activity/log/extension");this.$el.append(t)}}}),ThriveOvation.views.Shortcodes=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("shortcodes/list"),type:"",events:{"click .tvo-add-new-shortcode":"new"},initialize:function(t){this.type=t.type},render:function(){return this.$el.html(this.template({type:this.type})),0===this.collection.length?this.$(".tvo-shortcodes-notice").show():this.collection.each(this.renderShortcode,this),TVE_Dash.materialize(this.$el),this},renderShortcode:function(t){var e=new ThriveOvation.views.Shortcode({model:t});this.$(".tvo-shortcodes-container .tvo-add-new-shortcode").before(e.render().$el)},new:function(){this.modal(ThriveOvation.views.ModalNewShortcode,{model:new ThriveOvation.models.Shortcode,view:this})}}),ThriveOvation.views.Shortcode=ThriveOvation.views.Base.extend({className:"tvd-col tvd-s6 tvd-ms6 tvd-m4 tvd-l3 tvo-shortcode-item",template:TVE_Dash.tpl("shortcodes/shortcode"),events:{"click .tvo-edit-shortcode-title":"editTitle","click .tvo-shortcode-icon-delete":"deleteShortcode"},initialize:function(){this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"change:state",this.renderState),this.renderState()},renderState:function(){var t;return"delete"==this.model.get("state")?(t=new ThriveOvation.views.ShortcodeDeleteState({model:this.model}).render().$el,this.$el.html(t)):(t=this.template({shortcode:this.model}),this.$el.html(t),this.$shortcodeName=this.$(".tvo-shortcode-title"),ThriveOvation.bindZClip(this.$("a.tve-copy-to-clipboard")),TVE_Dash.materialize(this.$el)),this},deleteShortcode:function(){return this.model.set("state","delete"),this.renderState(),this},editTitle:function(){var t=this,e=(this.$(".tvo-edit-shortcode-title"),new Backbone.Model({value:this.model.get("title"),label:ThriveOvation.translations.shortcode_name,required:!0}));e.on("change:value",(function(){t.model.set("name",arguments[1]),t.model.save(),t.$shortcodeName.html(t.model.get("name")).show(),i.remove()})),e.on("tvo_no_change",(function(){t.$shortcodeName.html(t.model.get("name")).show(),i.remove()}));var i=new ThriveOvation.views.TextEdit({model:e,tagName:"div"});this.$shortcodeName.hide().after(i.render().$el),i.focus()}}),ThriveOvation.views.ShortcodeDeleteState=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("shortcodes/delete/shortcode"),events:{"click .tvo-delete-no":function(){this.model.set("state","normal")},"click .tvo-delete-yes":"yes",keydown:"keyAction"},initialize:function(){this.listenTo(this.collection,"remove",this.remove)},render:function(){this.$el.html(this.template({item:this.model}));var t=this;return _.defer((function(){t.$(".tvo-delete-shortcode-card").focus()})),this},keyAction:function(t){var e=t.which;13==e?this.yes():27==e&&this.model.set("state","normal")},yes:function(){TVE_Dash.cardLoader(this.$el),this.model.destroy({wait:!0,success:function(){TVE_Dash.hideLoader(),TVE_Dash.success(ThriveOvation.translations.delete_shortcode)},error:function(t,e){e=JSON.parse(e.responseText),TVE_Dash.err(e.message+": "+e.code),TVE_Dash.hideLoader()}})}}),ThriveOvation.views.ModalNewShortcode=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("shortcodes/shortcode/modal"),events:{"click .tvo-save-new-shortcode":"save","keydown #tvo-shortcode-name":"toSave"},afterRender:function(){return this.$el.html(this.template()),this},validateModel:function(){return ThriveOvation.util.validateInput(this.$("#tvo-shortcode-name"),ThriveOvation.translations.isRequired)},toSave:function(t){13==(t.keyCode||t.which)&&this.save()},save:function(){if(this.validateModel()){var t=this,e={name:this.$("#tvo-shortcode-name").val(),type:this.view.type};TVE_Dash.showLoader(),this.model.save(e,{success:function(e,i){e.set({url:i.url,id:i.id}),t.view.collection.add(e),t.view.collection.sort(),t.view.render(),t.close(),TVE_Dash.hideLoader()}})}return!0}}),ThriveOvation.views.TextEdit=ThriveOvation.views.Base.extend({className:"tvd-input-field tvo-inline-edit",template:TVE_Dash.tpl("textedit"),events:{"keyup input":"keyup","change input":function(e){return t.trim(this.input.val())?(this.model.set("value",this.input.val()),!1):(this.input.addClass("tvd-invalid"),!1)},"blur input":function(){this.model.trigger("tvo_no_change")}},keyup:function(t){27===t.which&&this.model.trigger("tvo_no_change")},render:function(){return this.$el.html(this.template({item:this.model})),this.input=this.$("input"),this},focus:function(){this.input.focus().select()}}),ThriveOvation.views.AssetConnections=ThriveOvation.views.Base.extend({events:{"click .tvo-connection-setting-change":"saveConnection"},initialize:function(){this.listenTo(this.collection,"change",this.render)},render:function(){return this.$("#tvo-email-api-connections").empty(),this.collection.each(this.renderOne,this),this},renderOne:function(t){var e=new ThriveOvation.views.AssetConnection({model:t,wrapper:this.$el}).render().$el;this.$("#tvo-email-api-connections").append(e)},saveConnection:function(t){var e=jQuery(t.currentTarget).attr("data"),i=this;TVE_Dash.showLoader(),jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},type:"POST",url:ThriveOvation.routes.settings+"/api/activate",data:{connection:e}}).done((function(){i.collection.each((function(t,i){t.set("active",e)})),TVE_Dash.hideLoader()}))}}),ThriveOvation.views.AssetConnection=ThriveOvation.views.Base.extend({tagName:"li",template:TVE_Dash.tpl("api/connections/connections"),events:{"click .tve-asset-group-test":"testConnection","click .tvo-connection-edit":"openEditModal"},initialize:function(t){_.extend(this,_.pick(t,"wrapper"))},render:function(){return this.model.get("connection")?(this.$el.html(this.template(this.model.toJSON())),this.wrapper.find(".tvo-no-email-connection-setup").hide(),this.wrapper.find("#tvo-add-new-connection-upper").show()):(this.wrapper.find(".tvo-no-email-connection-setup").show(),this.wrapper.find("#tvo-add-new-connection-upper").hide()),this},openEditModal:function(e){var i=t(e.currentTarget).attr("id").replace("tvo-delivery-","").replace("-edit","");this.modal(ThriveOvation.views.ConnectionModal,{model:new ThriveOvation.models.NewConnection({connected_apis:ThriveOvation.objects.AssetConnection}),edit:i})},testConnection:function(t){var e=jQuery(t.currentTarget).attr("data"),i=this.$(".tvo-test-connection-"+e+" .tve-asset-group-test-result"),a=this.$(".tvo-test-response");TVE_Dash.showLoader(),jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},type:"POST",url:ThriveOvation.routes.settings+"/api/testconnection",data:{connection:e}}).success((function(t){a.empty();var e=JSON.parse(t);a.prepend(e),i.empty(),e.indexOf("updated")>-1?i.append('<span class="tvd-text-green"><i class="tvd-icon-check"></i>Success</span>'):i.append('<span class="tvd-text-red"><i class="tvd-icon-remove"></i>Error</span>'),TVE_Dash.hideLoader()}))}}),ThriveOvation.views.ConfigureLandingPageModal=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("email/configure-landing-page"),events:{"click .tvo-save-landing-page-settings":"save","change .tvo-change-landing-setting":"changeSettings"},getPostNameById:function(e,i){t("#tvu-leads-posts").val(""),t("#tvu-leads-posts-not").val("");var a=ThriveOvation.routes.settings+"/get_post_name_by_id";jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:a,type:"POST",data:{postId:e}}).done((function(e){"approve"==i&&(t("#tvu-leads-posts").val(e),t("#tvu-leads-posts").removeClass("ui-autocomplete-loading")),"not_approve"==i&&(t("#tvu-leads-posts-not").val(e),t("#tvu-leads-posts-not").removeClass("ui-autocomplete-loading"))})).error((function(t){TVE_Dash.err(JSON.parse(t.responseText).message)})).always((function(){TVE_Dash.hideLoader()}))},testimonialAutocomplete:function(e){var i=this,a=ThriveOvation.routes.settings+"/landing_testimonial_autocomplete";t(".tvu-leads-autocomplete").autocomplete({delay:50,select:function(t,e){i.model.set({approve_post_id:e.item.id}),i.model.set({approve_post_val:e.item.value})},source:function(e,i){t.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:a,dataType:"json",data:{q:e.term},type:"POST"}).done((function(t){i(t)})).error((function(t){TVE_Dash.err(JSON.parse(t.responseText).message)}))}}),t(".tvu-not-leads-autocomplete").autocomplete({delay:50,select:function(t,e){i.model.set({not_approve_post_id:e.item.id}),i.model.set({not_approve_post_val:e.item.value})},source:function(e,i){t.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:a,dataType:"json",data:{q:e.term},type:"POST"}).done((function(t){i(t)})).error((function(t){TVE_Dash.err(JSON.parse(t.responseText).message)}))}})},afterRender:function(){var e=this;this.model.fetch({success:function(i,a,o){i.get("approve")&&e.$("#approve").val(i.get("approve")).trigger("change"),i.get("not_approve")&&e.$("#not_approve").val(i.get("not_approve")).trigger("change"),"tvo_custom_url"==i.get("approve")&&e.$("#approve_url").val(i.get("approve_url")),"tvo_existing_content"==i.get("not_approve")?e.$("#not_approve_post_id").val(i.get("not_approve_post_id")).trigger("change"):"tvo_custom_url"==i.get("not_approve")&&e.$("#not_approve_url").val(i.get("not_approve_url")),e.model.get("approve_post_val")&&t("#tvu-leads-posts").val(e.model.get("approve_post_val")),e.model.get("approve_post_val")&&t("#tvu-leads-posts-not").val(e.model.get("not_approve_post_val")),TVE_Dash.materialize(e.$el),e.testimonialAutocomplete(),e.getPostNameById(i.get("approve_post_id"),"approve"),e.getPostNameById(i.get("not_approve_post_id"),"not_approve")}})},changeSettings:function(t){var e=jQuery(t.currentTarget),i=e.attr("data-action"),a=e.val();this.$("."+i).addClass("tvd-hide"),this.$("."+i+"."+a).removeClass("tvd-hide"),this.$("."+i+"_tvo_existing_content").val(null).trigger("change"),this.$("."+i+"_tvo_custom_url").val(null).trigger("change")},save:function(t){var e=jQuery(t.currentTarget),i=this,a=this.$("#approve").val(),o=this.$("#approve_url").val(),n=this.model.get("approve_post_id"),s=this.model.get("approve_post_val"),r=this.$("#not_approve").val(),l=this.$("#not_approve_url").val(),v=this.model.get("not_approve_post_id"),c=this.model.get("not_approve_post_val");if(!e.hasClass("tvd-disabled")){if(ThriveOvation.util.setLoading(e),""==a||""==o&&""==n||""==r||""==l&&""==v)return TVE_Dash.err(ThriveOvation.translations.complete_all_the_fields),void ThriveOvation.util.removeLoading(e);if(""!=o&&!ThriveOvation.util.validateURL(this.$("#approve_url"))||""!=l&&!ThriveOvation.util.validateURL(this.$("#not_approve_url")))return TVE_Dash.err(ThriveOvation.translations.invalid_url),void ThriveOvation.util.removeLoading(e);var h={approve:a,approve_url:o,approve_post_id:n,approve_post_val:s,not_approve:r,not_approve_url:l,not_approve_post_id:v,not_approve_post_val:c};this.model.save(h,{success:function(t,e){TVE_Dash.success(ThriveOvation.translations.landing_settings_success_toast),jQuery(".tvo_icon_landing_page").addClass("tvo-settings-step-success"),jQuery(".tvo-configure-landing-page").text(ThriveOvation.translations.settings_step_completed),i.close()},error:function(t,e){TVE_Dash.err(ThriveOvation.translations.landing_settings_fail_toast)},complete:function(){ThriveOvation.util.removeLoading(e)}})}}}),ThriveOvation.views.ConfirmSendingEmailModal=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("email/confirm/send/email"),events:{"click .tvo-send-approval-email":"sendEmail"},afterRender:function(){this.$el.html(this.template({testimonial:this.model}))},sendEmail:function(){ThriveOvation.objects.TestimonialView.sendApprovalEmail(),this.close()}}),ThriveOvation.views.ConfigureEmailModal=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("email/configure/email"),events:{"click .tvo-save-email-template":"saveEmailTemplate","click .tvo-preview-email":"previewEmail","click .tvo-back-to-email-template":"configEmail","click .tvo-test-approval-email":"sendTestEmail","click .tvo-send-email":"checkIfAlreadySent","click .tl-toggle-tab-display":"toggleTabDisplay","keydown .tvo-email-test":"enterPressOnTest"},afterRender:function(){return this.$el.addClass("tve-assed-email-modal"),ThriveOvation.bindZClip(this.$("a.tve-copy-to-clipboard")),ThriveOvation.objects.EmailConfig.get("template")&&ThriveOvation.objects.EmailConfig.get("subject")&&(this.$("#tvo-email-template").val(ThriveOvation.objects.EmailConfig.get("template")),this.$("#tvo-email-subject").val(ThriveOvation.objects.EmailConfig.get("subject"))),this.renderTestimonialEditor(),this.preview&&(this.previewEmail(),this.$(".tvo-settings-footer-buttons").hide(),this.$(".tvo-preview-footer-buttons").show()),this},configEmail:function(){this.$(".tvo-preview-email-content").hide(),this.$(".tvo-config-email-content").show()},renderTestimonialEditor:function(){var e=ThriveOvation.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["tvo-tinymce-tpl"],qt:window.tinyMCEPreInit.qtInit["tvo-tinymce-tpl"]},"tvo-email-template");e&&(tinyMCEPreInit.mceInit=t.extend(tinyMCEPreInit.mceInit,e.mce_init),tinyMCEPreInit.mceInit["tvo-email-template"].setup=function(t){t.on("change",(function(){t.save()}))},tinyMCE.init(tinyMCEPreInit.mceInit["tvo-email-template"]),window.wpActiveEditor="tvo-email-template")},sendTestEmail:function(){if(ThriveOvation.util.validateInput(this.$(".tvo-email-test"))&&ThriveOvation.util.validateEmail(this.$(".tvo-email-test"))){var t=this.$(".tvo-email-test").val();TVE_Dash.showLoader();var e=this.$(".tvo-preview-email-text").html(),i=this.$(".tvo-preview-email-subject").html();jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:ThriveOvation.routes.settings+"/email/test",type:"POST",data:{template:e,subject:i,email:t}}).done((function(t){TVE_Dash.success(ThriveOvation.translations.confirmation_test_email_sent)})).error((function(t){TVE_Dash.err(JSON.parse(t.responseText).message)})).always((function(){TVE_Dash.hideLoader()}))}},checkIfAlreadySent:function(){parseInt(ThriveOvation.objects.Testimonial.get("sent_emails"))>0?(this.close(),ThriveOvation.objects.TestimonialView.openConfirmModal()):this.sendApprovalEmail()},sendApprovalEmail:function(){ThriveOvation.objects.TestimonialView.sendApprovalEmail(),this.close()},previewEmail:function(){var t=this;TVE_Dash.showLoader();var e={};this.preview&&(e.name=this.testimonial.get("name"),e.content=this.testimonial.get("content"));var i=tinyMCE.get("tvo-email-template").getContent(),a=this.$("#tvo-email-subject").val();jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:ThriveOvation.routes.settings+"/email/process",type:"POST",data:{template:i,subject:a,data:e}}).done((function(e){t.$(".tvo-preview-email-text").html(e.template),t.$(".tvo-preview-email-subject").html(e.subject),t.$(".tvo-config-email-content").hide(),t.$(".tvo-preview-email-content").show()})).error((function(t){TVE_Dash.err(JSON.parse(t.responseText).message)})).always((function(){TVE_Dash.hideLoader()}))},saveEmailTemplate:function(){var t=ThriveOvation.util.hasTinymce()?tinyMCE.get("tvo-email-template").getContent():this.$("#tvo-email-template").val(),e=this.$(".tvo-email-subject").val(),i=this,a=this.model.get("template"),o=this.$(".tvo-save-email-template");this.model.set({template:t,subject:e}),TVE_Dash.showLoader(),o.hasClass("tvd-disabled")||(ThriveOvation.util.setLoading(o),this.model.save().done((function(){jQuery(".tvo_icon_email_config").addClass("tvo-settings-step-success"),jQuery(".tvo-configure-email-template").text(ThriveOvation.translations.settings_step_completed),TVE_Dash.success(ThriveOvation.translations.settings_saved_success_toast),i.close()})).error((function(t){i.$(".tvo-email-template").val(a),TVE_Dash.err(JSON.parse(t.responseText).message)})).always((function(){TVE_Dash.hideLoader(),ThriveOvation.util.removeLoading(o)})))},toggleTabDisplay:function(t){var e=jQuery(t.currentTarget),i=e.hasClass("collapsed"),a=jQuery(e.data("target"));i?a.hide(0).removeClass("tvd-not-visible").slideDown(200):a.slideUp(200,(function(){a.addClass("tvd-not-visible")})),e.toggleClass("collapsed"),e.toggleClass("hover")},enterPressOnTest:function(t){13!==t.which&&13!==t.keyCode||this.sendTestEmail()},beforeClose:function(){ThriveOvation.util.clearMCEEditor("tvo-testimonial-content-tinymce")}}),ThriveOvation.views.ConnectionModal=TVE_Dash.views.ModalSteps.extend({template:TVE_Dash.tpl("api/connections/add-api-connection"),events:{"click .tvd-modal-next-step":"next","click .tvd-modal-prev-step":"prev","click .tve-asset-delivery-conection":"openConnection","click .tve-leads-connection-edit":"openConnection","click .tvd-api-connect":"submitConnection","click .tvd-api-cancel":"closeConnection","click .tvo-asset-close":function(){this.close()}},onOpen:function(){ThriveOvation.objects.Apis.each(this.populateFields,this)},afterRender:function(){var t=this;if(ThriveOvation.objects.AssetConnection.forEach((function(e){t.$(".tvo-"+e.get("connection")+"-api").addClass("tvo-api-selected").next(".tvo-connection-name").addClass("tvo-connected-message").append('<span class="tvo-asset-connected">(connected)</span>');var i=e.get("connection_instance");for(var a in i)i[a]&&t.$("#tvo-"+a+"-"+e.get("connection")).val(i[a])})),ThriveOvation.objects.Apis.each(this.renderSelector,this),this.steps=this.$(this.stepClass).hide(),this.gotoStep(0),this.edit){var e=this.$(".tvo-connection-form[data-key="+this.edit+"]");e.find(".tvd-api-cancel").addClass("tvo-close-connection"),this.$(".tvo-connection-form").hide(),e.show(),this.gotoStep(1)}return this},populateFields:function(t){var e=t.get("connection"),i=t.get("connection_instance"),a=this.$(".tvo-connection-form[data-key="+e+"] form");i&&_.each(i,(function(t,e){var i=a.find(':input[name="connection['+e+']"]');(i.is("input")||i.is("textarea")||i.is("select"))&&i.val(t)}))},renderSelector:function(t){var e=new ThriveOvation.views.AssetSelector({model:t}).render().$el;this.$("#tvo-connections-list").append(e)},openConnection:function(e){e.stopPropagation();var i=t(e.target).attr("data-key"),a=this.$(".tvo-connection-form[data-key="+i+"]");this.$(".tvo-connection-form").hide(),a.show(),this.gotoStep(1)},closeConnection:function(e){if(t(e.target).hasClass("tvo-close-connection"))return t(e.target).removeClass("tvo-close-connection"),void this.close();this.gotoStep(0)},submitConnection:function(e){var i=this,a=(this.model,t(e.target).closest(".tvo-connection-form").find("form")),o=a.serializeArray(),n=this.mapProprieties(o),s=!1;_.each(n.connection_instance,(function(t,e){s=ThriveOvation.util.validateInput(a.find(':input[name="connection['+e+']"]'))})),s&&(TVE_Dash.showLoader(),jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:ThriveOvation.routes.settings+"/api",type:"post",data:o}).done((function(e){if(TVE_Dash.hideLoader(),"true"===e){var a=new ThriveOvation.models.AssetWizardConnection;a.set(n);var o=ThriveOvation.objects.Apis.findWhere({connection:n.connection});o.get("connected")||(o.set({connected:!0}),ThriveOvation.objects.AssetConnection.add(a)),o.set({connection_instance:n.connection_instance}),ThriveOvation.objects.AssetConnection.find((function(t){return t.get("connection")===n.connection}))||ThriveOvation.objects.AssetConnection.add(a),ThriveOvation.objects.AssetConnection.each((function(t,e){t.set("active",n.connection)})),new ThriveOvation.views.AssetConnections({collection:ThriveOvation.objects.AssetConnection,el:t("#tvo-email-connection-wrap")}).render(),i.$(".tvo-connection-name-success").text(n.connection),i.gotoStep(2)}else t(".tvo-delivery-connection").find(".error").remove(),TVE_Dash.err(JSON.parse(e),2e3)})))},mapProprieties:function(t){var e={connection:{},connection_instance:{}};return t.map((function(t){if("api"==t.name)e.connection=t.value;else{var i=t.name.match(/\[(.*?)\]/)[1];e.connection_instance[i]=t.value}})),e}}),ThriveOvation.views.AssetSelector=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("api/connections/selector"),className:"tvd-col tvd-s3 tvd-center-align",render:function(){return this.$el.html(this.template({item:this.model.toJSON()})),this}})}))}(jQuery),window.ThriveOvation=window.ThriveOvation||{},ThriveOvation.objects=ThriveOvation.objects||{},function(t){var e=Backbone.Router.extend({view:null,$el:t("#tvo-dashboard-wrapper"),routes:{testimonials:"testimonials",settings:"settings","testimonials(/:id)":"testimonial",socialimport:"social_media_import","shortcodes/(:type)":"short_codes"},params:{},initialize:function(){this.breadcrumbs=new ThriveOvation.views.Breadcrumbs({el:t(".tvo-breadcrumbs")})},route:function(t,e,i){var a=this;return i||(i=this[e]),Backbone.Router.prototype.route.call(this,t,e,(function(){ThriveOvation.util.clearMCEEditor(),i.apply(a,arguments)}))},social_media_import:function(){this.breadcrumbs.render(ThriveOvation.util.Breadcrumbs(ThriveOvation.breadcrumbs,"socialimport")),this.view&&this.view.remove(),this.view=new ThriveOvation.views.SocialMediaImport,this.$el.html(this.view.render().$el)},testimonials:function(){TVE_Dash.showLoader(),this.breadcrumbs.render(ThriveOvation.util.Breadcrumbs(ThriveOvation.breadcrumbs,"testimonials")),this.view&&this.view.remove(),this.view=new ThriveOvation.views.Testimonials,this.$el.html(this.view.$el)},testimonial:function(t){this.breadcrumbs.render(ThriveOvation.util.Breadcrumbs(ThriveOvation.breadcrumbs,"testimonial")),this.view&&(this.view.remove(),jQuery(".tvd-material-tooltip").hide()),ThriveOvation.objects.Testimonial=new ThriveOvation.models.Testimonial({id:t}),ThriveOvation.objects.Testimonial.fetch(),ThriveOvation.objects.TestimonialView=new ThriveOvation.views.Testimonial({model:ThriveOvation.objects.Testimonial}),this.$el.html(ThriveOvation.objects.TestimonialView.$el)},short_codes:function(t){if("capture"===t||"display"===t){this.breadcrumbs.render(ThriveOvation.util.Breadcrumbs(ThriveOvation.breadcrumbs,t+"-shortcodes")),this.view&&this.view.remove(),ThriveOvation.objects.Shortcodes=new ThriveOvation.collections.Shortcodes;var e=new ThriveOvation.views.Shortcodes({type:t,collection:ThriveOvation.objects.Shortcodes});ThriveOvation.objects.Shortcodes.fetch({data:{type:t},success:function(){e.render(),ThriveOvation.util.bind_wistia()}}),this.$el.html(e.$el)}else this.testimonials()},settings:function(){TVE_Dash.showLoader(),this.breadcrumbs.render(ThriveOvation.util.Breadcrumbs(ThriveOvation.breadcrumbs,"settings")),this.view&&this.view.remove(),ThriveOvation.objects.Settings=new ThriveOvation.models.Settings,ThriveOvation.objects.Settings.fetch(),this.view=new ThriveOvation.views.Setting({model:ThriveOvation.objects.Settings}),this.$el.html(this.view.$el)}});t((function(){ThriveOvation.router=new e,Backbone.history.start({hashchange:!0}),Backbone.history.fragment||ThriveOvation.router.navigate("#testimonials",{trigger:!0})}))}(jQuery)})();