!function(e){window.TVA_WC=window.TVA_WC||{products:[],assigned_products:[]},e((function(){TVA_WC.products=new Backbone.Collection(TVA_WC.products||[]);const s=e("select#product-type");"variable-subscription"===s.val()&&e("li.tva-courses_tab").show(),s.on("change",(function(t){"variable-subscription"===t.currentTarget.value&&e("li.tva-courses_tab").show()})),new t({el:e("#tva-courses"),selectedProductsIds:TVA_WC.assigned_products})}));const t=Backbone.View.extend({selectedProductsIds:[],$searchInput:null,events:{"input #tva-search":_.debounce((function(e){const t=e.currentTarget.value,s=TVA_WC.products.filter((e=>e.get("name").toLowerCase().includes(t.toLowerCase())));this.renderSearchResults(s)}),400),"focus #tva-search":function(){this.renderSearchResults(TVA_WC.products.filter())},"blur #tva-search":function(e){setTimeout((()=>{e.currentTarget.value="",this.$("#tva-search-results").remove()}),100)}},initialize:function(t){e.extend(this,!0,t),this.$searchInput=this.$("#tva-search"),this.renderChips()},renderChips:function(){this.$("#tva-chips").remove();const t=e("<div/>").attr("id","tva-chips");_.each(this.selectedProductsIds,(e=>t.append(this.renderChip(e)))),this.$searchInput.after(t)},removeChip:function(e){e=parseInt(e),TVA_WC.products.findWhere({id:e})&&this.selectedProductsIds.splice(this.selectedProductsIds.indexOf(e),1),this.renderChips()},renderChip:function(t){const s=TVA_WC.products.findWhere({id:t});if(!s)return"";t=parseInt(t);const r=e(`<div class="tva-chip"><span class="tva-remove-chip" data-id="${t}">&times;</span></div>`);return s instanceof Backbone.Model&&(r.append(`<input type="hidden" name="tva_products[]" value="${t}"/>`),r.prepend(e(`<span>${s.get("name")}</span>`)),r.find(".tva-remove-chip").on("click",(e=>{this.removeChip(e.currentTarget.dataset.id)}))),r},renderSearchResults:function(t){const s=e("<div/>").attr("id","tva-search-results").html(TVA_WC.t.no_item_found);t.length&&s.empty(),_.each(t,(e=>s.append(this.getSearchResultItemHtml(e)))),this.$("#tva-search-results").remove(),this.$searchInput.after(s)},getSearchResultItemHtml:function(t){const s=e("<div/>").addClass("tva-result-item").attr("data-id",t.get("id"));return s.append(e("<span/>").text(t.get("name"))),s.on("mousedown",(t=>{const s=e(t.currentTarget),r=parseInt(s.data("id"));this.$searchInput.val(""),TVA_WC.products.findWhere({id:r})&&-1===this.selectedProductsIds.indexOf(r)&&(this.selectedProductsIds.push(r),this.renderChips()),s.parent().remove()})),s}})}(jQuery);