!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=398)}({274:function(e,t){e.exports={enableQuizDependency:"tva_disable_mas",when:"tva_disable_mas_when",condition:"tva_disable_mas_when_cond",whenSelectConditions:{quizComplete:"quiz_complete",basedOnResults:"based_on_result"}}},398:function(e,t,n){var o;(o=jQuery)(window).on("tcb_main_ready",(function(){TVE.Views.Components.quiz&&o.extend(!0,TVE,n(399))})).on("tcb.register-hooks",(function(){var e={shortcodes:n(401)},t={};_.each(e,(function(e){TVE.addHooks(e,t)}))}))},399:function(e,t,n){e.exports={Views:{Components:{quiz:n(400)}}}},400:function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(274),s=TVE.Views.Components.quiz;e.exports=s.extend({MarkAsCompleteSelect:null,MarkAsCompleteSlider:null,checkboxInstances:null,shouldDisplayInfoText:!1,labels:{ControlMarkComplete:{survey:'Allow the "mark as complete" action only once this quiz has been completed',default:'Control the "mark as complete" behaviour based on the results on this quiz'},MarkAsCompleteSelect:{number:"User achieves minimum score",percentage:"User achieves minimum percentage",right_wrong:"Minimum number of correct answers",personality:"Result is selected categories"},MarkAsCompleteSlider:{number:"Score",percentage:"Percentage",right_wrong:"Correct answers",personality:""}},before_update:function(){var e=this;if(this.$infoText&&this.$infoText.hide(),s.prototype.before_update.call(this,arguments),this.quiz||this.setQuiz(this.getQuizID()),this.MarkAsCompleteSelect=null,this.MarkAsCompleteSlider=null,this.checkboxInstances={},this.generateExtraControls(),!this.quiz.results&&0===this.$(".tve-loader-square").length){this.$(".tve-advanced-controls").addClass("tve-loader-square");var t=setInterval((function(){e.quiz=e.setQuiz(e.getQuizID()),e.quiz.results&&(clearInterval(t),e.$(".tve-advanced-controls").removeClass("tve-loader-square"),e.generateExtraControls(),e.controls.ControlMarkComplete.update(TVE.ActiveElement))}),500)}},controls_init:function(e){var t=this;s.prototype.controls_init.call(this,e),TVE.add_action("tcb.focus_quiz.before",(function(e,n,o){o&&o.afterInsert&&o.quizID&&(t.setQuiz(o.quizID),t.controls.SaveUserQuizProgress.input(e,{checked:!0}))})),this.$extraControlsWrapper=this.$(".tva-tqb-extra-controls"),this.$infoText=this.$(".info-text.orange"),this.controls.ControlMarkComplete.update=function(e){this.setChecked(this.component.isMarkedAsCompleteLocked()),this.$(".switch-label").text(this.component.labels.ControlMarkComplete[this.component.quiz.type]||this.component.labels.ControlMarkComplete.default),this.component.MarkAsCompleteSelect&&this.component.MarkAsCompleteSelect.update(e)},this.controls.ControlMarkComplete.input=function(e,n){t.updateConfig(i.enableQuizDependency,Number(n.checked)),t.deleteConfig(i.when),t.deleteConfig(i.condition),t.MarkAsCompleteSelect&&t.MarkAsCompleteSelect.update(e)}},generateExtraControls:function(){var e=this;if(this.$extraControlsWrapper.empty(),this.quiz&&"survey"!==this.quiz.type){var t=this,n=this.getConfig()[i.condition];if(this.shouldDisplayInfoText=!1,this.$extraControlsWrapper.append('<div class="tva-tqb-mark-as-complete-select" style="display: none;"></div>'),this.MarkAsCompleteSelect=new TVE.Views.Controls.Select({el:this.$el.find(".tva-tqb-mark-as-complete-select"),component:this,model:{config:{"full-width":!0,name:'Enable "mark as complete" when',options:[{name:"Quiz completed",value:i.whenSelectConditions.quizComplete},{name:this.labels.MarkAsCompleteSelect[this.quiz.type],value:i.whenSelectConditions.basedOnResults}]}}}),this.MarkAsCompleteSelect.change=function(n,o){e.updateConfig(i.when,o.value),e.deleteConfig(i.condition),e.MarkAsCompleteSlider?(e.MarkAsCompleteSlider.update(n),e.MarkAsCompleteSlider.trigger_change()):Object.values(e.checkboxInstances).length&&(e.$el.find(".tva-tqb-mark-as-complete-condition")[e.isMarkAsCompleteResultConditioned()?"show":"hide"](),Object.values(t.checkboxInstances).forEach((function(e){return e.update(n)})))},this.MarkAsCompleteSelect.update=function(e){this.$el[t.isMarkedAsCompleteLocked()?"show":"hide"]();var n=t.getConfig()[i.when];this.setValue(n||i.whenSelectConditions.quizComplete),t.MarkAsCompleteSlider?t.MarkAsCompleteSlider.update(e):Object.values(t.checkboxInstances).length&&(t.$el.find(".tva-tqb-mark-as-complete-condition")[t.isMarkAsCompleteResultConditioned()?"show":"hide"](),Object.values(t.checkboxInstances).forEach((function(t){return t.update(e)})))},this.$extraControlsWrapper.append('<div class="tva-tqb-mark-as-complete-condition" style="display: none;"></div>'),this.resultIsWithinRage(this.quiz))this.MarkAsCompleteSlider=new TVE.Views.Controls.Slider({el:this.$el.find(".tva-tqb-mark-as-complete-condition"),component:this,model:{config:{default:parseInt(this.quiz.results.min),min:parseInt(this.quiz.results.min),max:parseInt(this.quiz.results.max),label:this.labels.MarkAsCompleteSlider[this.quiz.type],um:["percentage"===this.quiz.type?"%":""]}}}),this.MarkAsCompleteSlider.input=TVE.$.noop,this.MarkAsCompleteSlider.change=function(t,n){var o=parseInt(e.MarkAsCompleteSlider.model.config.max),s=parseInt(e.MarkAsCompleteSlider.model.config.min),r=parseInt(n.value);r>o&&(r=o,e.MarkAsCompleteSlider.setValue(r,!1)),r<s&&(r=s,e.MarkAsCompleteSlider.setValue(r,!1)),e.updateConfig(i.condition,r)},this.MarkAsCompleteSlider.update=function(e){this.$el[t.isMarkAsCompleteResultConditioned()?"show":"hide"]();var n=t.getConfig()[i.condition];n&&this.setValue(n)},void 0!==n&&(this.quiz.results.max<n||this.quiz.results.min>n)&&(this.shouldDisplayInfoText=!0);else if(Array.isArray(this.quiz.results)){if(this.checkboxInstances={},this.quiz.results.forEach((function(n){var o=parseInt(n.id);e.checkboxInstances[o]=new TVE.Views.Controls.Checkbox({model:{config:{label:n.text,value:o}}}),e.checkboxInstances[n.id].input=function(){var t=[];Object.values(e.checkboxInstances).forEach((function(e){e.isChecked()&&t.push(parseInt(e.$("input").val()))})),e.updateConfig(i.condition,t)},e.checkboxInstances[n.id].update=function(e){var n=t.getConfig()[i.condition];this.setChecked(Array.isArray(n)&&n.includes(parseInt(this.$("input").val())))},e.$el.find(".tva-tqb-mark-as-complete-condition").append(e.checkboxInstances[o].$el)})),void 0!==n)this.quiz.results.filter((function(e){return n.includes(parseInt(e.id))})).length!==n.length&&(this.shouldDisplayInfoText=!0)}this.shouldDisplayInfoText&&this.$infoText.show()}},resultIsWithinRage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 0===Object.values(e).length&&(e=this.quiz),"object"===o(e.results)&&"min"in e.results&&"max"in e.results},isMarkedAsCompleteLocked:function(){var e=this.getConfig()[i.enableQuizDependency];return e&&Number(e)},isMarkAsCompleteResultConditioned:function(){var e=this.getConfig()[i.when];return e&&e===i.whenSelectConditions.basedOnResults}})},401:function(e,t,n){var o=n(274);e.exports={actions:{"tve.lazyload.done":function(e){return"undefined"!=typeof TQB&&e.tqb_quizzes&&TVE.$.extend(!0,TQB.quizzes,e.tqb_quizzes),e}},filters:{tcb_save_post_data_after:function(e){if("tva_lesson"!==TVE.CONST.post_type)return e;var t=e.tve_content.match(/__CONFIG_quiz_shortcode__(.*?)__CONFIG_quiz_shortcode__/g);if(!t||!Array.isArray(t))return e;var n=t.map((function(e){return e.replace(/__CONFIG_quiz_shortcode__/g,"")}));return e.tva_tqb_mark_as_complete=[],n.forEach((function(t){var n;try{n=JSON.parse(t)}catch(e){return}if(n&&n[o.enableQuizDependency]&&1===parseInt(n[o.enableQuizDependency])){var i=!_.isEmpty(n[o.condition])||_.isNumber(n[o.condition]),s=_.pick({quiz_id:n.quiz_id,when:!_.isEmpty(n[o.when])&&i?n[o.when]:o.whenSelectConditions.quizComplete,cond:i?n[o.condition]:""},_.identity);e.tva_tqb_mark_as_complete.push(s)}})),e}}}}});