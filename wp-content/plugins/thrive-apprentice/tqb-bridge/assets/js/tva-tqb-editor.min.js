!function(){var e,t={7967:function(e,t,s){e.exports={Views:{Components:{quiz:s(7975)}}}},7975:function(e,t,s){const i=s(8401),n=TVE.Views.Components.quiz;e.exports=n.extend({MarkAsCompleteSelect:null,MarkAsCompleteSlider:null,checkboxInstances:null,shouldDisplayInfoText:!1,labels:{ControlMarkComplete:{survey:'Allow the "mark as complete" action only once this quiz has been completed',default:'Control the "mark as complete" behaviour based on the results on this quiz'},MarkAsCompleteSelect:{number:"User achieves minimum score",percentage:"User achieves minimum percentage",right_wrong:"Minimum number of correct answers",personality:"Result is selected categories"},MarkAsCompleteSlider:{number:"Score",percentage:"Percentage",right_wrong:"Correct answers",personality:""}},before_update:function(){if(this.$infoText&&this.$infoText.hide(),n.prototype.before_update.call(this,arguments),this.quiz||this.setQuiz(this.getQuizID()),this.MarkAsCompleteSelect=null,this.MarkAsCompleteSlider=null,this.checkboxInstances={},this.generateExtraControls(),!this.quiz.results&&0===this.$(".tve-loader-square").length){this.$(".tve-advanced-controls").addClass("tve-loader-square");const e=setInterval((()=>{this.quiz=this.setQuiz(this.getQuizID()),this.quiz.results&&(clearInterval(e),this.$(".tve-advanced-controls").removeClass("tve-loader-square"),this.generateExtraControls(),this.controls.ControlMarkComplete.update(TVE.ActiveElement))}),500)}},controls_init:function(e){n.prototype.controls_init.call(this,e),TVE.add_action("tcb.focus_quiz.before",((e,t,s)=>{s&&s.afterInsert&&s.quizID&&(this.setQuiz(s.quizID),this.controls.SaveUserQuizProgress.input(e,{checked:!0}))})),this.$extraControlsWrapper=this.$(".tva-tqb-extra-controls"),this.$infoText=this.$(".info-text.orange"),this.controls.ControlMarkComplete.update=function(e){this.setChecked(this.component.isMarkedAsCompleteLocked()),this.$(".switch-label").text(this.component.labels.ControlMarkComplete[this.component.quiz.type]||this.component.labels.ControlMarkComplete.default),this.component.MarkAsCompleteSelect&&this.component.MarkAsCompleteSelect.update(e)},this.controls.ControlMarkComplete.input=(e,t)=>{this.updateConfig(i.enableQuizDependency,Number(t.checked)),this.deleteConfig(i.when),this.deleteConfig(i.condition),this.MarkAsCompleteSelect&&this.MarkAsCompleteSelect.update(e)}},generateExtraControls:function(){if(this.$extraControlsWrapper.empty(),!this.quiz||"survey"===this.quiz.type)return;const e=this,t=this.getConfig()[i.condition];this.shouldDisplayInfoText=!1,this.$extraControlsWrapper.append('<div class="tva-tqb-mark-as-complete-select" style="display: none;"></div>'),this.MarkAsCompleteSelect=new TVE.Views.Controls.Select({el:this.$el.find(".tva-tqb-mark-as-complete-select"),component:this,model:{config:{"full-width":!0,name:'Enable "mark as complete" when',options:[{name:"Quiz completed",value:i.whenSelectConditions.quizComplete},{name:this.labels.MarkAsCompleteSelect[this.quiz.type],value:i.whenSelectConditions.basedOnResults}]}}}),this.MarkAsCompleteSelect.change=(t,s)=>{this.updateConfig(i.when,s.value),this.deleteConfig(i.condition),this.MarkAsCompleteSlider?(this.MarkAsCompleteSlider.update(t),this.MarkAsCompleteSlider.trigger_change()):Object.values(this.checkboxInstances).length&&(this.$el.find(".tva-tqb-mark-as-complete-condition")[this.isMarkAsCompleteResultConditioned()?"show":"hide"](),Object.values(e.checkboxInstances).forEach((e=>e.update(t))))},this.MarkAsCompleteSelect.update=function(t){this.$el[e.isMarkedAsCompleteLocked()?"show":"hide"]();const s=e.getConfig()[i.when];this.setValue(s||i.whenSelectConditions.quizComplete),e.MarkAsCompleteSlider?e.MarkAsCompleteSlider.update(t):Object.values(e.checkboxInstances).length&&(e.$el.find(".tva-tqb-mark-as-complete-condition")[e.isMarkAsCompleteResultConditioned()?"show":"hide"](),Object.values(e.checkboxInstances).forEach((e=>e.update(t))))},this.$extraControlsWrapper.append('<div class="tva-tqb-mark-as-complete-condition" style="display: none;"></div>'),this.resultIsWithinRage(this.quiz)?(this.MarkAsCompleteSlider=new TVE.Views.Controls.Slider({el:this.$el.find(".tva-tqb-mark-as-complete-condition"),component:this,model:{config:{default:parseInt(this.quiz.results.min),min:parseInt(this.quiz.results.min),max:parseInt(this.quiz.results.max),label:this.labels.MarkAsCompleteSlider[this.quiz.type],um:["percentage"===this.quiz.type?"%":""]}}}),this.MarkAsCompleteSlider.input=TVE.$.noop,this.MarkAsCompleteSlider.change=(e,t)=>{const s=parseInt(this.MarkAsCompleteSlider.model.config.max),n=parseInt(this.MarkAsCompleteSlider.model.config.min);let o=parseInt(t.value);o>s&&(o=s,this.MarkAsCompleteSlider.setValue(o,!1)),o<n&&(o=n,this.MarkAsCompleteSlider.setValue(o,!1)),this.updateConfig(i.condition,o)},this.MarkAsCompleteSlider.update=function(t){this.$el[e.isMarkAsCompleteResultConditioned()?"show":"hide"]();const s=e.getConfig()[i.condition];s&&this.setValue(s)},void 0!==t&&(this.quiz.results.max<t||this.quiz.results.min>t)&&(this.shouldDisplayInfoText=!0)):Array.isArray(this.quiz.results)&&(this.checkboxInstances={},this.quiz.results.forEach((t=>{const s=parseInt(t.id);this.checkboxInstances[s]=new TVE.Views.Controls.Checkbox({model:{config:{label:t.text,value:s}}}),this.checkboxInstances[t.id].input=()=>{const e=[];Object.values(this.checkboxInstances).forEach((t=>{t.isChecked()&&e.push(parseInt(t.$("input").val()))})),this.updateConfig(i.condition,e)},this.checkboxInstances[t.id].update=function(t){const s=e.getConfig()[i.condition];this.setChecked(Array.isArray(s)&&s.includes(parseInt(this.$("input").val())))},this.$el.find(".tva-tqb-mark-as-complete-condition").append(this.checkboxInstances[s].$el)})),void 0!==t)&&this.quiz.results.filter((e=>t.includes(parseInt(e.id)))).length!==t.length&&(this.shouldDisplayInfoText=!0),this.shouldDisplayInfoText&&this.$infoText.show()},resultIsWithinRage:function(e={}){return 0===Object.values(e).length&&(e=this.quiz),"object"==typeof e.results&&"min"in e.results&&"max"in e.results},isMarkedAsCompleteLocked:function(){const e=this.getConfig()[i.enableQuizDependency];return e&&Number(e)},isMarkAsCompleteResultConditioned:function(){const e=this.getConfig()[i.when];return e&&e===i.whenSelectConditions.basedOnResults}})},8401:function(e){e.exports={enableQuizDependency:"tva_disable_mas",when:"tva_disable_mas_when",condition:"tva_disable_mas_when_cond",whenSelectConditions:{quizComplete:"quiz_complete",basedOnResults:"based_on_result"}}},1984:function(e,t,s){const i=s(8401);e.exports={actions:{"tve.lazyload.done":e=>("undefined"!=typeof TQB&&e.tqb_quizzes&&TVE.$.extend(!0,TQB.quizzes,e.tqb_quizzes),e)},filters:{tcb_save_post_data_after:e=>{if("tva_lesson"!==TVE.CONST.post_type)return e;const t=e.tve_content.match(/__CONFIG_quiz_shortcode__(.*?)__CONFIG_quiz_shortcode__/g);if(!t||!Array.isArray(t))return e;const s=t.map((function(e){return e.replace(/__CONFIG_quiz_shortcode__/g,"")}));return e.tva_tqb_mark_as_complete=[],s.forEach((t=>{let s;try{s=JSON.parse(t)}catch(e){return}if(!s||!s[i.enableQuizDependency]||1!==parseInt(s[i.enableQuizDependency]))return;const n=!_.isEmpty(s[i.condition])||_.isNumber(s[i.condition]),o=_.pick({quiz_id:s.quiz_id,when:!_.isEmpty(s[i.when])&&n?s[i.when]:i.whenSelectConditions.quizComplete,cond:n?s[i.condition]:""},_.identity);e.tva_tqb_mark_as_complete.push(o)})),e}}}}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var o=s[e]={exports:{}};return t[e](o,o.exports,i),o.exports}(e=jQuery)(window).on("tcb_main_ready",(()=>{TVE.Views.Components.quiz&&e.extend(!0,TVE,i(7967))})).on("tcb.register-hooks",(()=>{const e={shortcodes:i(1984)},t={};_.each(e,(e=>{TVE.addHooks(e,t)}))}))}();