jQuery(function(r){var o=r(".yith-default-form").data("option-id"),t=r(".yith-default-form").data("callback"),n=r(".yith-default-form-main-table"),l=r(document).find(".yith-default-form__popup_wrapper"),i=r(document).find("#yith-default-form__delete_row"),e=r(document).find("#yith-default-form__reset_dialog"),a=r(document).find("table.option-list tbody > tr");blockParams={message:null,overlayCSS:{background:"#fff",opacity:.7},ignoreIfBlocked:!0},format_name=function(t){return t=(t=(t=(t=t.trim()).toLowerCase()).replace(/\s/g,"_")).replace(/[^A-Za-z0-9_]+/gi,"")},submitRowForm=function(){if(r("#name").hasClass("field-exists")||r("#name").hasClass("required"))return!1;var t=r(".yith-default-form__form_row").find("input,select,textarea").serializeArray();t.push({name:"yit_default_form",value:o}),t.push({name:"request",value:"save"}),n.block(blockParams),l.dialog("close"),r.post(document.location.href,t).done(function(t){refreshTable(t),n.unblock()})},duplicateRow=function(t){n.block(blockParams),r.post(document.location.href,{yit_default_form:o,request:"duplicate",row:t}).done(function(t){refreshTable(t),n.unblock()})},cancelRow=function(t){n.block(blockParams),i.dialog("close"),r.post(document.location.href,{yit_default_form:o,request:"cancel",row:t}).done(function(t){refreshTable(t),n.unblock()})},activateRow=function(t,e){n.block(blockParams),r.post(document.location.href,{yit_default_form:o,request:"activate",activated:e,row:t}).done(function(t){n.unblock()})},sortTable=function(t){n.block(blockParams),r.post(document.location.href,{yit_default_form:o,request:"sort",order:t}).done(function(t){refreshTable(t),n.unblock()})},restoreDefaultForm=function(){n.block(blockParams),e.dialog("close"),r.post(document.location.href,{yit_default_form:o,request:"restore",callback:t}).done(function(t){refreshTable(t),n.unblock()})},refreshTable=function(t){var e;""!==t&&(e=(t=r("<div></div>").html(t)).find(".yith-default-form-main-table"),t=t.find(".yith-default-form__popup_wrapper"),r(".yith-default-form-main-table").html(e.html()),r(".yith-default-form__popup_wrapper").html(t.html()),l=r(document).find(".yith-default-form__popup_wrapper"),initSortTable())},initSortTable=function(){r(".yith-default-form-main-table tbody").sortable({placeholder:"ui-state-highlight",axis:"y",handle:".action__sort",stop:function(){$order=n.find('[data-name="name"]');var o=[];$order.each(function(t,e){o.push(r(e).val())}),sortTable(o)}}).disableSelection()},initOptionListSortable=function(){r(document).find("table.option-list tbody").sortable({placeholder:"ui-state-highlight",axis:"y",handle:".drag"}).disableSelection()},openPopup=function(t="add"){(l=r(".yith-default-form__popup_wrapper")).dialog({closeText:"",title:yith_default_form_field["popup_title_"+t],width:550,modal:!0,dialogClass:"yith-plugin-ui yith-default-form-popup",buttons:[{text:yith_default_form_field[t],click:function(){submitRowForm()},"class":"yith-save-form"}]}),r(".wc-enhanced-select").select2(),loadDependences()},getNewOptionRow=function(t){var e=a.clone(),o=(o=r(e).html()).replace(/{key}/g,t);return r(e).html(o),r(e).attr("data-key",t),e},loadDependences=function(){r(document).find(".yith-default-form__popup_wrapper [data-deps]").each(function(){var t=r(this),n=t.closest("tr"),e=t.attr("data-deps").split(","),l=t.attr("data-deps_value").split(","),d=[];r.each(e,function(a,t){r('[name="'+t+'"]').on("change",function(){var t=r(this),e=t.val(),o=t.attr("type"),i="";"radio"===o&&!t.is(":checked")||("checkbox"===o&&(e=t.is(":checked")?"yes":"no"),i=(i=l[a]+"").split("|"),d[a]=-1!==r.inArray(e,i),-1===r.inArray(!1,d)?n.fadeIn():n.fadeOut())}).change()})})},initSortTable(),r(document).on("click",".yith-default-form__add-fields",function(t){t.preventDefault();var t=n.find("tr");1<t.length&&(t=t[1],r.each(r(t).find('input[type="hidden"]'),function(t,e){var o,i=r(e).data("name"),a=l.find('td *[name="'+i+'"]'),e=r(e).data("default");"name"===i&&a.prop("readonly",!1),"options"===i&&(i=r(document).find("table.option-list tbody"),o=getNewOptionRow(0),i.html(""),i.append(o),initOptionListSortable()),a.length&&("checkbox"===a.attr("type")?"yes"===e?a.prop("checked",!0):a.prop("checked",!1):a.val(e))})),openPopup()}),r(document).on("blur","#name",function(){var t=r(this),e=t.val(),o=t.closest("td"),i=r(".yith-save-form");if(i.removeClass("disabled").removeAttr("disabled"),t.removeClass("required"),t.removeClass("field-exists"),o.find(".description.field-exists").hide(),o.find(".description.required").hide(),!t.is("[readonly]")){if(e=format_name(e),t.val(e),""===e)return t.addClass("required"),o.find(".description.required").show(),i.addClass("disabled").attr("disabled","true"),!1;var a=n.find('input[value="'+e+'"]');r.each(a,function(){if(r(this).val()===e)return t.addClass("field-exists"),o.find(".description.field-exists").show(),i.addClass("disabled").attr("disabled","true"),!1})}}),r(document).on("click",".action__edit",function(t){t.preventDefault();var t=r(this).closest("tr"),d=l.find("#yith_form_fields_table");r.each(t.find('input[type="hidden"]'),function(t,e){var i,a,o,n=r(e).data("name"),l=d.find('td *[name="'+n+'"]'),e=r(e).val();"name"===n&&l.prop("readonly",!0),"options"===n&&(i=r(document).find("table.option-list tbody"),a=0,""!==e&&"::"!==e?(n=e.split("|"),o=[],r.each(n,function(t,e){o[t]=e.split("::")}),0<o.length&&r.each(o,function(t,e){var o;""!==e[0]&&(0===a&&i.html(""),o=getNewOptionRow(a++),r(o).find(".column-label input").val(e[0]),r(o).find(".column-value input").val(e[1]),i.append(o))})):(n=getNewOptionRow(a),i.html(""),i.append(n)),initOptionListSortable()),l.length&&("checkbox"===l.attr("type")?"yes"===e?l.prop("checked",!0):l.prop("checked",!1):l.val(e)),l.change()}),openPopup("edit")}),r(document).on("click","#add_new_option",function(t){t.preventDefault();var t=r(document).find("table.option-list tbody"),e=t.find("tr"),o=0,e=(r.each(e,function(t,e){r(e).data("key")>o&&(o=parseInt(r(e).data("key")))}),o++,getNewOptionRow(o));t.append(e),1<r(".option-list tbody tr").length&&r(".option-list tbody tr:first-child").find(".delete").show()}),r(document).on("click",".option-list .delete",function(t){t.preventDefault(),r(this).closest("tr").remove(),1===r(".option-list tbody tr").length&&r(".option-list tbody tr:first-child").find(".delete").hide()}),r(document).on("click",".action__duplicate",function(){var t=r(this).closest("tr").find('[data-name="name"]').val();duplicateRow(t)}),r(document).on("change",'input[name="enabled"]',function(){var t=r(this),e=t.closest("tr").find('[data-name="name"]').val(),t=t.is(":checked")?"yes":"no";activateRow(e,t)}),r(document).on("click","#yith-default-form__restore-default",function(t){t.preventDefault(),e.dialog({width:350,modal:!0,dialogClass:"yith-plugin-ui yith-default-form__confirm yith-default-form-popup",closeText:"",buttons:[{text:yith_default_form_field.confirmChoice,click:function(){restoreDefaultForm()},"class":"yith-confirm"},{text:yith_default_form_field.cancel,click:function(){e.dialog("close")},"class":"yith-close"}]})}),r(document).on("click",".action__trash",function(t){t.preventDefault();var e=r(this).closest("tr").find('[data-name="name"]').val();i.dialog({closeText:"",width:350,modal:!0,dialogClass:"yith-plugin-ui yith-default-form__confirm yith-default-form-popup",buttons:[{text:yith_default_form_field.confirmChoice,click:function(){cancelRow(e)},"class":"yith-confirm"},{text:yith_default_form_field.cancel,click:function(){i.dialog("close")},"class":"yith-close"}]})})});