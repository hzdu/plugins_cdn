!function(){var e;TD_NM.util=TD_NM.util||{},e=jQuery,TD_NM.util.camel_case=function(t){var i=t.split("_"),s="";return e.each(i,(function(e,t){s+=t.toLowerCase().charAt(0).toUpperCase()+t.slice(1)})),s},TD_NM.util.printf=function(e,t){return t?(t instanceof Array||(t=[t]),_.each(t,(function(t){e=e.replace("%s",t)})),e):e},TD_NM.util.plural=function(e,t,i){return 1==i?ThriveUlt.util.printf(e,i):ThriveUlt.util.printf(t,i)},TD_NM.util.data_binder=function(t,i){if(void 0===i&&(i=t.model),!(!i instanceof Backbone.Model)){var s=t.$el.find("[data-bind]").each((function(){var s=e(this),n=s.attr("data-bind"),o=!1;s.on("change",(function(){var e,t=(e=s).is(":checkbox")?!!e.is(":checked"):e.is(":radio")?e.is(":checked")?e.val():"":e.val();i.get(n)!=t&&(o=!0,i.set(n,t),o=!1)})),t.listenTo(i,"change:"+n,(function(){var e,i;o||(e=s,i=this.model.get(n),e.is(":radio")?t.$el.find('input[name="'+e.attr("name")+'"]:radio').filter('[value="'+i+'"]').prop("checked",!0):e.is(":checkbox")?e.prop("checked",!!i):e.val(i))}))}));t.listenTo(i,"invalid",(function(e,t){_.isArray(t)?_.each(t,(function(e){var t=e;e.field&&(t=e.field);var i=s.filter('[data-bind="'+t+'"]').first().addClass("tvd-validate tvd-invalid").focus();e.message&&i.siblings("label").attr("data-error",e.message),(i.is(":radio")||i.is(":checkbox"))&&TVE_Dash.err(i.next("label").attr("data-error"))})):_.isString(t)&&TVE_Dash.err(t)}))}},TD_NM.util.is_email=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},TD_NM.util.ajaxurl=function(e){var t=-1!==ajaxurl.indexOf("?")?"&":"?";return e&&e.length?(e=e.replace(/^(\?|&)/,""),e+="&_nonce="+TD_NM.admin_nonce,ajaxurl+t+e):ajaxurl+t+"_nonce="+TD_NM.admin_nonce},TD_NM.models=TD_NM.models||{},TD_NM.collections=TD_NM.collections||{},function(e){Backbone.emulateHTTP=!0,TD_NM.models.Base=Backbone.Model.extend({idAttribute:"ID",defaults:{ID:""},validation_error:function(e,t){return{field:e,message:t}},url:function(){var t=TD_NM.util.ajaxurl(this.get_action()+"&"+this.get_route());return e.isNumeric(this.get("ID"))&&(t+="&ID="+this.get("ID")),t},get_action:function(){return"action=td_nm_admin_controller"},get_route:function(){return"route=no_route"}}),TD_NM.collections.Base=Backbone.Collection.extend({last:function(){return this.at(this.size()-1)}}),TD_NM.models.Option=TD_NM.models.Base.extend({defaults:{value:null,label:""}}),TD_NM.collections.Options=TD_NM.collections.Base.extend({model:TD_NM.models.Option}),TD_NM.models.Message=TD_NM.models.Base.extend({defaults:{subject:"",content:""},validate:function(e){var t=[];if(0===e.subject.length&&t.push(this.validation_error("subject",TD_NM.t.subject_empty)),0===e.content.length&&t.push(this.validation_error("content",TD_NM.t.message_empty)),t.length)return t}}),TD_NM.models.Action=TD_NM.models.Base.extend({defaults:_.extend({},TD_NM.models.Base.prototype.defaults,{type:null}),get_route:function(){return"route=action"},url:function(){var t=TD_NM.util.ajaxurl(this.get_action()+"&"+this.get_route());return e.isNumeric(this.get("ID"))&&(t+="&ID="+this.get("ID")),e.isNumeric(this.get("notification_id"))&&(t+="&notification_id="+this.get("notification_id")),t}}),TD_NM.models.ActionComplex=TD_NM.models.Action.extend({defaults:_.extend({},TD_NM.models.Action.prototype.defaults,{url:null}),initialize:function(e){this.set("message",new TD_NM.models.Message(e&&e.message?e.message:{})),this.set("recipients",new TD_NM.collections.Options(e&&e.recipients?e.recipients:[]))},validate:function(e){var t=[];if(this.get("type")?this["validate_"+this.get("type")](t,e):t.push(TD_NM.t.select_action),t.length)return t},validate_custom_script:function(e,t){if(t.url||e.push(this.validation_error("url",TD_NM.t.invalid_url)),e.length)return e},validate_send_email_notification:function(e,t){var i=this.get("recipients");if(i&&0===i.length)return e.push(TD_NM.t.no_recipient),e;if(i.each((function(t){TD_NM.util.is_email(t.get("value"))||e.push(TD_NM.t.invalid_recipient)})),e.length)return e;var s=this.get("message").validate(this.get("message").attributes);return s instanceof Array&&_.each(s,(function(t,i){e.push(t)})),e.length?e:void 0},validate_wordpress_notification:function(e,t){var i=this.get("message").validate(this.get("message").attributes);i instanceof Array&&_.each(i,(function(t,i){"subject"!==t.field&&e.push(t)}))}}),TD_NM.collections.ActionsComplex=TD_NM.collections.Base.extend({model:TD_NM.models.ActionComplex}),TD_NM.collections.Actions=TD_NM.collections.Base.extend({model:function(e,t){switch(e.type){case"send_email_notification":return new TD_NM.models.ActionSendEmailNotification(e,t);case"custom_script":return new TD_NM.models.ActionCustomScript(e,t);default:return new TD_NM.models.Action(e)}}}),TD_NM.collections.ActionTypes=TD_NM.collections.Base.extend({model:TD_NM.models.Base.extend({defaults:{key:"",label:""}})}),TD_NM.models.ActionCustomScript=TD_NM.models.Action.extend({defaults:_.extend({},TD_NM.models.Action.prototype.defaults,{type:"custom_script",url:null}),validate:function(e){var t=[];if(e.url||t.push(this.validation_error("url",TD_NM.t.invalid_url)),t.length)return t}}),TD_NM.models.ActionSendEmailNotification=TD_NM.models.Action.extend({defaults:_.extend({},TD_NM.models.Action.prototype.defaults,{type:"send_email_notification"}),initialize:function(e,t){this.set("message",new TD_NM.models.Message(e&&e.message?e.message:{})),this.set("recipients",new TD_NM.collections.Options(e&&e.recipients?e.recipients:{}))},validate:function(){var e=[],t=this.get("recipients");if(t&&0===t.length)return e.push(TD_NM.t.no_recipient),e;if(t.each((function(t){TD_NM.util.is_email(t.get("value"))||e.push(TD_NM.t.invalid_recipient)})),e.length)return e;var i=this.get("message").validate(this.get("message").attributes);return i instanceof Array&&_.each(i,(function(t,i){e.push(t)})),e.length?e:void 0}}),TD_NM.models.BreadcrumbLink=TD_NM.models.Base.extend({defaults:_.extend({},TD_NM.models.Base.prototype.defaults,{hash:"",label:"",full_link:!1}),initialize:function(e){e&&!this.get("ID")&&this.set("ID",e.label.split(" ").join("").toLowerCase()),e&&this.set("full_link",e.hash.match(/^http/))},get_url:function(){return this.get("full_link")?this.get("hash"):"#"+this.get("hash")}}),TD_NM.collections.Breadcrumbs=TD_NM.collections.Base.extend({model:TD_NM.models.Base.extend({defaults:{hash:"",label:""}}),add_page:function(e,t){var i=new TD_NM.models.BreadcrumbLink({hash:e,label:t});return this.add(i)}}),TD_NM.models.OptionCheckbox=TD_NM.models.Option.extend({defaults:_.extend({},TD_NM.models.Option.prototype.defaults,{selected:!1})}),TD_NM.collections.OptionsCheckbox=TD_NM.collections.Options.extend({model:TD_NM.models.OptionCheckbox,match_selected:function(e){var t=this;e.each((function(e){var i=t.findWhere({value:e.get("value")});i&&i.set("selected",!0,{silent:!0})}))}}),TD_NM.models.OptionInput=TD_NM.models.Option.extend({defaults:_.extend({},TD_NM.models.Option.prototype.defaults,{selected:!1})}),TD_NM.collections.OptionsInput=TD_NM.collections.Options.extend({model:TD_NM.models.OptionInput}),TD_NM.models.Trigger=TD_NM.models.Base.extend({defaults:{type:null,settings:{}},get_route:function(){return"route=trigger"}}),TD_NM.models.Notification=TD_NM.models.Base.extend({defaults:_.extend({},TD_NM.models.Base.prototype.defaults,{}),initialize:function(e){this.set("trigger",new TD_NM.models.Trigger(e&&e.trigger?e.trigger:{})),this.set("actions",new TD_NM.collections.ActionsComplex(e&&e.actions?e.actions:[]))},get_route:function(){return"route=notification"}}),TD_NM.collections.Notifications=TD_NM.collections.Base.extend({model:TD_NM.models.Notification}),TD_NM.collections.TriggerTypes=TD_NM.collections.Base.extend({model:TD_NM.models.Base.extend({defaults:{key:"",label:""}})}),TD_NM.models.EmailService=TD_NM.models.Base.extend({defaults:{key:null,title:"",connected:!1,active:!1,status:""}}),TD_NM.collections.EmailServices=TD_NM.collections.Base.extend({model:TD_NM.models.EmailService})}(jQuery),TD_NM.views=TD_NM.views||{},function(e){e((function(){TD_NM.views.ModalSteps=TVE_Dash.views.Modal.extend({stepClass:".tvd-nm-modal-step",currentStep:0,$step:null,events:{"click .tvd-nm-modal-next-step":"next","click .tvd-nm-modal-prev-step":"prev"},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this},gotoStep:function(e){var t=this.steps.hide().eq(e).show(),i=this;return this.$step=t,setTimeout((function(){i.input_focus(t)}),50),this.currentStep=e,this},next:function(){!1!==this.beforeNext()&&(this.gotoStep(this.currentStep+1),this.afterNext())},prev:function(){this.beforePrev(),this.gotoStep(this.currentStep-1),this.afterPrev()},beforeNext:function(){return this},afterNext:function(){return this},beforePrev:function(){return this},afterPrev:function(){return this}}),TD_NM.views.ModalCreateNotification=TD_NM.views.ModalSteps.extend({className:"tvd-modal-fixed-footer tvd-modal",template:TVE_Dash.tpl("modals/create-notification"),summary_view:null,events:function(){return _.extend(TD_NM.views.ModalSteps.prototype.events,{"click #tvd-nm-trigger-types .tvd-nm-trigger-type":"_select_trigger_type","click #tvd-nm-action-types .tvd-nm-action-type":"_select_action_type","click .tvd-modal-submit":"save"})},afterInitialize:function(){this.data.trigger_types.on("change:selected",this._render_trigger_settings,this),this.data.action_types.on("change:selected",this._render_action_settings,this)},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this._render_trigger_types(),this._render_action_types(),this},_render_summary:function(){this.summary_view=new TD_NM.views.Summary({collection:new TD_NM.collections.Base(this.model.get("trigger"))}),this.$("#tvd-nm-notification-summary").html(this.summary_view.render().$el)},_render_trigger_types:function(){this.data.trigger_types.each((function(e){var t=TVE_Dash.tpl("trigger-type-box");this.$("#tvd-nm-trigger-types").append(t({item:e}))}),this)},_render_action_types:function(){this.data.action_types.each((function(e){var t=TVE_Dash.tpl("action-type-box");this.$("#tvd-nm-action-types").append(t({item:e}))}),this)},_select_trigger_type:function(t){var i=e(t.currentTarget);i.find(".tvd-card").is(".tvd-nm-selected-card")||(this.$("#tvd-nm-trigger-types .tvd-nm-selected-card").removeClass("tvd-nm-selected-card"),i.find(".tvd-card").addClass("tvd-nm-selected-card"),this.data.trigger_types.forEach((function(e){e.set("selected",!1,{silent:!0})})),this.data.trigger_types.findWhere({key:i.data("trigger-type")}).set("selected",!0))},_select_action_type:function(t){var i=e(t.currentTarget);i.find(".tvd-card").is(".tvd-nm-selected-card")||(this.$("#tvd-nm-action-types .tvd-nm-selected-card").removeClass("tvd-nm-selected-card"),i.find(".tvd-card").addClass("tvd-nm-selected-card"),this.data.action_types.forEach((function(e){e.set("selected",!1,{silent:!0})})),this.data.action_types.findWhere({key:i.data("action-type")}).set("selected",!0))},_render_trigger_settings:function(e){var t=TD_NM.util.camel_case(e.get("key"));if(void 0!==TD_NM.views["Settings"+t]){this.model.get("trigger").set("type",e.get("key"),{silent:!0}),this.trigger_settings_view&&this.trigger_settings_view.remove();var i=this.$("#tvd-nm-trigger-settings").html("");this.trigger_settings_view=new TD_NM.views["Settings"+t]({model:this.model}),i.html(this.trigger_settings_view.render().$el)}else console.log("Settings"+t+" View not found.")},_render_action_settings:function(e){var t=TD_NM.util.camel_case(e.get("key")),i=new TD_NM.models.ActionComplex({type:e.get("key"),recipients:[{value:TD_NM.current_user_email,label:TD_NM.t.insert_recipients_email}]});this.action_settings_view&&this.action_settings_view.remove(),this.action_settings_view=new TD_NM.views["Settings"+t]({model:i,trigger:this.model.get("trigger")}),this.model.get("actions").reset(i),this.$("#tvd-nm-action-settings").html(this.action_settings_view.render().$el)},beforeNext:function(){return 0!==this.currentStep||(this.trigger_settings_view&&this.trigger_settings_view.are_valid()?(this.model.get("trigger").set("settings",this.trigger_settings_view.get_settings()),this._render_summary(),!0):(TVE_Dash.err(TD_NM.t.next_step_no_option_selected),!1))},afterNext:function(){if(1!==this.currentStep)return this},beforePrev:function(){this.summary_view.remove()},save:function(){if(this.tvd_nm_clear_errors(),0===this.model.get("actions").length)return TVE_Dash.err(TD_NM.t.select_action);if(!this.model.get("actions").last().isValid())return this.tvd_nm_show_errors(this.model.get("actions").last());TVE_Dash.showLoader();var e=this.model,t=this;e.save().done((function(i){e.set("ID",i),e.get("actions").last().set("notification_id",i).set("ID",0),t.collection.add(e),t.close()})).error((function(e){TVE_Dash.err(e.responseJSON.error)})).always((function(){TVE_Dash.hideLoader()}))}}),TD_NM.views.ModalAddAction=TD_NM.views.ModalCreateNotification.extend({template:TVE_Dash.tpl("modals/add-action"),afterInitialize:function(){this.data.action_types.on("change:selected",this._render_action_settings,this)},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(1),this._render_summary(),this._render_action_types(),this},_render_action_types:function(){this.data.action_types.each((function(e){this.collection.findWhere({type:e.get("key")})&&e.set("disable",!0,{silent:!0});var t=TVE_Dash.tpl("action-type-box");this.$("#tvd-nm-action-types").append(t({item:e}))}),this)},_select_action_type:function(t){var i=e(t.currentTarget);i.find(".tvd-card").is(".tvd-nm-selected-card")||(this.$("#tvd-nm-action-types .tvd-nm-selected-card").removeClass("tvd-nm-selected-card"),i.find(".tvd-card").addClass("tvd-nm-selected-card"),this.data.action_types.forEach((function(e){e.set("selected",!1,{silent:!0})})),this.data.action_types.findWhere({key:i.data("action-type")}).set("selected",!0))},_render_action_settings:function(e){var t=TD_NM.util.camel_case(e.get("key"));this.model.set("type",e.get("key"),{silent:!0}),this.model.set("notification_id",this.data.notification_model.get("ID"),{silent:!0}),this.action_settings_view&&this.action_settings_view.remove(),this.model.get("message").set("content","",{silent:!0}),this.action_settings_view=new TD_NM.views["Settings"+t]({model:this.model,trigger:this.data.notification_model.get("trigger")}),this.$("#tvd-nm-action-settings").html(this.action_settings_view.render().$el),TVE_Dash.materialize(this.$el)},_render_summary:function(){var e=[];e.push(this.data.notification_model.get("trigger")),e=e.concat(this.data.notification_model.get("actions").models),this.summary_view=new TD_NM.views.Summary({collection:new TD_NM.collections.Base(e)}),this.$("#tvd-nm-notification-summary").html(this.summary_view.render().$el)},save:function(){this.tvd_nm_clear_errors();var e=this;if(!this.model.isValid())return this.tvd_nm_show_errors(this.model);TVE_Dash.showLoader(),this.model.save().done((function(t){TVE_Dash.success(TD_NM.t.action_saved),e.model.set("ID",t,{silent:!0}),e.collection.push(e.model),e.close()})).error((function(e){TVE_Dash.err(e.responseJSON.error)})).always((function(){TVE_Dash.hideLoader()}))}}),TD_NM.views.ModalEditAction=TD_NM.views.ModalCreateNotification.extend({template:TVE_Dash.tpl("modals/edit-action"),afterInitialize:function(){this.data.action_types.on("change:selected",this._render_action_settings,this)},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(1),this._select_action_type(this.model.get("type")),this},_render_action_settings:function(e){var t=TD_NM.util.camel_case(e.get("key"));this.model.set("type",e.get("key"),{silent:!0}),this.model.set("action_name",e.get("label"),{silent:!0}),this.model.set("ID",this.collection.indexOf(this.model),{silent:!0}),this.action_settings_view&&this.action_settings_view.remove(),this.action_settings_view=new TD_NM.views["Settings"+t]({model:this.model,trigger:this.data.trigger}),this.$el.find(".tvd-modal-title").text(TD_NM.util.printf("Edit %s",[this.model.get("action_name")])),this.$("#tvd-nm-action-settings").html(this.action_settings_view.render().$el),TVE_Dash.materialize(this.$el)},_select_action_type:function(e){this.data.action_types.findWhere({key:e}).set("selected",!0),this.action_model=this.data.action_types.findWhere({key:e})},save:function(){if(this.tvd_nm_clear_errors(),!this.model.isValid())return this.tvd_nm_show_errors(this.model);TVE_Dash.showLoader();var e=this.action_settings_view.model,t=this;e.save().done((function(){TVE_Dash.success(TD_NM.t.action_saved),e.trigger("change",e),t.close()})).error((function(e){TVE_Dash.err(e.responseJSON.error)})).always((function(){TVE_Dash.hideLoader()}))}}),TD_NM.views.ModalEditTrigger=TD_NM.views.ModalCreateNotification.extend({template:TVE_Dash.tpl("modals/edit-trigger"),afterInitialize:function(){this.data.trigger_types.on("change:selected",this._render_trigger_settings,this)},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this._render_trigger_types(),this.$('#tvd-nm-trigger-types .tvd-nm-trigger-type[data-trigger-type="'+this.model.get("type")+'"]').trigger("click"),this},_render_trigger_types:function(){this.data.trigger_types.each((function(e){if(this.model.get("type")==e.get("key")){var t=TVE_Dash.tpl("trigger-type-box");this.$("#tvd-nm-trigger-types").append(t({item:e}))}}),this)},_render_trigger_settings:function(e){var t=TD_NM.util.camel_case(e.get("key"));this.model.set("type",e.get("key"),{silent:!0}),this.trigger_settings_view&&this.trigger_settings_view.remove();var i=this.$("#tvd-nm-trigger-settings").html(""),s=new TD_NM.views["Settings"+t]({model:this.model});this.trigger_settings_view=s,i.html(s.render().$el)},save:function(){if(!this.trigger_settings_view.are_valid())return TVE_Dash.err(TD_NM.t.next_step_no_option_selected),!1;var e=this;this.model.set("settings",this.trigger_settings_view.get_settings(),{silent:!0}),TVE_Dash.showLoader(),this.model.save().done((function(){TVE_Dash.success(TD_NM.t.trigger_saved)})).error((function(e){TVE_Dash.err(e.responseJSON.error)})).always((function(){e.close(),TVE_Dash.hideLoader()}))}}),TD_NM.views.ModalDelete=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/delete-confirmation"),events:{"click .tvd-nm-delete-yes":"yes"},yes:function(t){var i=e(t.currentTarget),s=this;this.btnLoading(i),TVE_Dash.showLoader(),this.model.destroy({success:function(){TVE_Dash.success(TD_NM.t.success_delete)},error:function(){TVE_Dash.err(TD_NM.t.error_delete)},complete:function(){s.close(),TVE_Dash.hideLoader()}})}}),TD_NM.views.ModalEmailServices=TD_NM.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/email-services"),events:function(){return _.extend(TD_NM.views.ModalSteps.prototype.events,{"change .tvd-nm-toggle-service":"toggle_connection","click .tvd-nm-connection":"connection_form","click .tvd-nm-save-connection":"connection_save","click .tvd-nm-connection-test":"connection_test"})},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this.render_connected_services(),this},render_connected_services:function(){var e=this.$("#tvd-nm-connected-list").empty(),t=TVE_Dash.tpl("services/item"),i=this.$("#tvd-nm-connections-text");0===this.collection.where({connected:!0}).length?i.html(TD_NM.t.no_connection_established):i.html(TD_NM.t.your_existing_connections),this.collection.each((function(i){!0===i.get("connected")&&e.append(t({item:i}))}),this)},toggle_connection:function(t){var i=this,s=e(t.currentTarget),n=s.data("key");this.$(".tvd-nm-toggle-service").not(s).prop("checked",!1),TVE_Dash.showLoader(),e.ajax({type:"post",url:TD_NM.util.ajaxurl(),data:{action:"td_nm_admin_controller",route:"toggle_service",service:n,active:s.prop("checked")?1:0}}).success((function(){i.collection.each((function(e){e.set({active:s.prop("checked")&&e.get("key")===n},{silent:!0})}))})).error((function(){TVE_Dash.err(TD_NM.t.action_failed)})).always((function(){TVE_Dash.hideLoader(),i.render_connected_services()}))},beforePrev:function(){2===this.currentStep&&this._render_thumbs()},beforeNext:function(){return 0===this.currentStep&&this._render_thumbs(),this},_render_thumbs:function(){var e=this.$("#tvd-nm-connections-list").empty(),t=TVE_Dash.tpl("services/thumb-item");this.collection.each((function(i){e.append(t({item:i}))}))},connection_form:function(t){this.gotoStep(2);var i=e(t.currentTarget).data("key"),s=this.$("#tvd-nm-connection-form").html(this.$('.tvd-nm-connection-form[data-key="'+i+'"]').html());this.key=i,s.find(".tvd-card-title, .tvd-card-action").hide(),s.find("select").select2()},connection_save:function(){TVE_Dash.showLoader();var t=this,i=this.$("#tvd-nm-connection-form").find("form"),s={action:"td_nm_admin_controller",route:"setup_connection",service:this.key};e.ajax({type:"post",url:TD_NM.util.ajaxurl(i.serialize()),data:s,dataType:"json"}).success((function(){var i=t.collection.findWhere({key:t.key});i.set("connected",!0,{silent:!0}),i.set("status",TD_NM.t.connected,{silent:!0}),t.collection.each((function(e){e.set({active:e.get("key")===t.key},{silent:!0})})),t.gotoStep(0),e("#td-nm-email-services i").removeClass("tvd-nm-warning-sign"),TVE_Dash.success(TD_NM.t.connection_established)})).error((function(e){TVE_Dash.err(e.responseJSON.error)})).always((function(){t.render_connected_services(),TVE_Dash.hideLoader()}))},connection_test:function(t){var i=e(t.currentTarget).data("key");TVE_Dash.showLoader(),e.ajax({type:"post",url:TD_NM.util.ajaxurl(),data:{action:"td_nm_admin_controller",route:"connection_test",service:i},dataType:"json"}).done((function(e){TVE_Dash.success(e.success)})).fail((function(e){TVE_Dash.err(e.responseJSON.error)})).always((function(){TVE_Dash.hideLoader()}))}})}))}(jQuery),TD_NM.views=TD_NM.views||{},function(e){e((function(){e(document).keypress((function(t){13!=t.which&&13!=t.keyCode||e(".tvd-nm-delete-yes").is(":visible")&&e(".tvd-nm-delete-yes").focus().click()})),Backbone.View.prototype.tvd_nm_clear_errors=function(){return this.$(".tvd-invalid").removeClass("tvd-invalid"),this.$("select").trigger("tvdclear"),this},Backbone.View.prototype.tvd_nm_show_errors=function(t){if(t=t||this.model){var i=t instanceof Backbone.Model?t.validationError:t,s=this,n=e();return e.isArray(i)?_.each(i,(function(e){o(e)})):o(i),n.not(".tvd-no-focus").first().focus(),this.tvd_nm_scroll_first_error(n.first()),this}function o(t){if("string"==typeof t)return TVE_Dash.err(t);n=n.add(s.$("[data-field="+t.field+"]").addClass("tvd-invalid").each((function(){var i=e(this);i.is("select")?i.trigger("tvderror",t.message):i.next("label").attr("data-error",t.message)})))}},Backbone.View.prototype.tvd_nm_scroll_first_error=function(e){if(!(this instanceof TVE_Dash.views.Modal&&e.length))return this;var t=e.offset().top,i=this.$_content.offset().top,s=this.$_content.scrollTop(),n=this.$_content.outerHeight();if(t>=i&&t<n+i-50)return this;this.$_content.animate({scrollTop:s+t-i-40},200,"swing")},TD_NM.views.Base=Backbone.View.extend({render:function(){return this.template&&this.$el.html(this.template({item:void 0!==this.model?this.model:{}})),TVE_Dash.materialize(this.$el),this},modal:function(e,t){return TVE_Dash.modal(e,t)},bind_zclip:function(){TVE_Dash.bindZClip(this.$el.find("a.tvd-copy-to-clipboard"))}}),TD_NM.views.Dashboard=TD_NM.views.Base.extend({className:"tvd-container",template:TVE_Dash.tpl("dashboard"),events:{"click .tvd-nm-create-notification":"create_notification"},new_button_view:null,create_notification:function(){this.modal(TD_NM.views.ModalCreateNotification,{trigger_types:new TD_NM.collections.TriggerTypes(TD_NM.trigger_types),action_types:new TD_NM.collections.ActionTypes(TD_NM.action_types),model:new TD_NM.models.Notification,collection:this.collection,"max-width":"60%",width:"750px",in_duration:200,out_duration:0})},initialize:function(){this.new_button_view=new TD_NM.views.NewButtonDash,this.listenTo(this.collection,"add",this.toggle_new_button),this.listenTo(this.collection,"add",this._render_notification),this.listenTo(this.collection,"remove",this.toggle_new_button)},render:function(){return this.$el.html(this.template({})),0===this.collection.length&&this._display_new_button_dash(),this._render_notifications(),this},toggle_new_button:function(){this.collection.length?this.new_button_view.remove():this._display_new_button_dash()},_display_new_button_dash:function(){this.$("#tvd-nm-notifications-list").prepend(this.new_button_view.render().$el),this.new_button_view.add_custom_text(TD_NM.t.no_notification_created_yet)},_render_notifications:function(){this.collection.each(this._render_notification,this)},_render_notification:function(e){var t=new TD_NM.views.Notification({model:e});this.$("#tvd-nm-notifications-list").prepend(t.render().$el)}}),TD_NM.views.Header=TD_NM.views.Base.extend({template:TVE_Dash.tpl("header"),events:{"click #td-nm-email-services":"email_services"},email_services:function(){this.modal(TD_NM.views.ModalEmailServices,{collection:TD_NM.globals.email_services,"max-width":"70%",width:"900px",in_duration:200,out_duration:0})}}),TD_NM.views.Breadcrumbs=TD_NM.views.Base.extend({el:e("#tvd-nm-breadcrumbs-wrapper")[0],template:TVE_Dash.tpl("breadcrumbs"),initialize:function(){this.$title=e("head > title"),this.original_title=this.$title.html(),this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"add",this.render)},render:function(){this.$el.empty().html(this.template({links:this.collection}))}}),TD_NM.views.Settings=TD_NM.views.Base.extend({render:function(){return this.$el.html(this.template({})),this.options_section_view=this.render_section(),this},render_section:function(e,t,i){return new TD_NM.views.OptionsSection({model:t instanceof TD_NM.models.Base?t:this.get_model(),el:e instanceof jQuery?e:this.get_element(),collection:i instanceof TD_NM.collections.Base?i:this.get_collection()}).render()},get_model:function(){return this.model=new TD_NM.models.Base({title:"Settings title"})},get_element:function(){return this.$el.append("<div/>")},get_collection:function(){return this.collection=new TD_NM.collections.Options([])},get_settings:function(){return this.collection},are_valid:function(){return!1}}),TD_NM.views.SettingsEmailSignUp=TD_NM.views.Settings.extend({template:TVE_Dash.tpl("triggers/settings/email-sign-up"),render:function(){return this.$el.html(this.template({})),this.render_groups(),this.render_shortcodes(),this.render_thrive_boxes(),this},render_groups:function(){var e=this.$("#tvd-nm-lead-groups-wrapper"),t=new TD_NM.models.Base({title:TD_NM.t.LeadGroups,empty_message:TD_NM.util.printf(TD_NM.t.no_s_to_display,[TD_NM.t.group])}),i=new TD_NM.collections.OptionsCheckbox(TD_NM.tl.groups);if(this.model instanceof TD_NM.models.Trigger){var s=new TD_NM.collections.Options(this.model.get("settings").groups);i.match_selected(s)}return this.group_section_view=this.render_section(e,t,i),this},render_shortcodes:function(){var e=this.$("#tvd-nm-lead-shortcodes-wrapper"),t=new TD_NM.models.Base({title:TD_NM.t.Shortcodes,empty_message:TD_NM.util.printf(TD_NM.t.no_s_to_display,[TD_NM.t.shortcode])}),i=new TD_NM.collections.OptionsCheckbox(TD_NM.tl.shortcodes);if(this.model instanceof TD_NM.models.Trigger){var s=new TD_NM.collections.Options(this.model.get("settings").shortcodes);i.match_selected(s)}return this.shortcodes_section_view=this.render_section(e,t,i),this},render_thrive_boxes:function(){var e=this.$("#tvd-nm-lead-thrive-boxes-wrapper"),t=new TD_NM.models.Base({title:TD_NM.t.ThriveBoxes,empty_message:TD_NM.util.printf(TD_NM.t.no_s_to_display,[TD_NM.t.thrive_box])}),i=new TD_NM.collections.OptionsCheckbox(TD_NM.tl.thrive_boxes);if(this.model instanceof TD_NM.models.Trigger){var s=new TD_NM.collections.Options(this.model.get("settings").thrive_boxes);i.match_selected(s)}return this.thrive_boxes_section_view=this.render_section(e,t,i),this},get_settings:function(){return{groups:this.group_section_view.collection.where({selected:!0}),shortcodes:this.shortcodes_section_view.collection.where({selected:!0}),thrive_boxes:this.thrive_boxes_section_view.collection.where({selected:!0})}},are_valid:function(){return this.group_section_view.collection.where({selected:!0}).length>0||this.shortcodes_section_view.collection.where({selected:!0}).length>0||this.thrive_boxes_section_view.collection.where({selected:!0}).length>0}}),TD_NM.views.SettingsSplitTestEnds=TD_NM.views.Settings.extend({template:TVE_Dash.tpl("triggers/settings/split-test-ends"),render:function(){return this.$el.html(this.template({})),this.render_tl_tests(),this.render_tho_tests(),this.render_tqb_tests(),this.render_tab_tests(),this},render_tl_tests:function(){var e=this.$("#tvd-nm-tl-tests-wrapper"),t=new TD_NM.models.Base({title:"Thrive Leads Tests",empty_message:TD_NM.util.printf(TD_NM.t.no_s_found,[TD_NM.t.split_tests])}),i=new TD_NM.collections.OptionsCheckbox(TD_NM.split_tests.tl);if(this.model instanceof TD_NM.models.Trigger){var s=new TD_NM.collections.Options(this.model.get("settings").tl);i.match_selected(s)}return this.tl_section_view=this.render_section(e,t,i),this},render_tqb_tests:function(){var e=this.$("#tvd-nm-tqb-tests-wrapper"),t=new TD_NM.models.Base({title:"Thrive Quiz Builder Tests",empty_message:TD_NM.util.printf(TD_NM.t.no_s_found,[TD_NM.t.split_tests])}),i=new TD_NM.collections.OptionsCheckbox(TD_NM.split_tests.tqb);if(this.model instanceof TD_NM.models.Trigger){var s=new TD_NM.collections.Options(this.model.get("settings").tqb);i.match_selected(s)}return this.tqb_section_view=this.render_section(e,t,i),this},render_tab_tests:function(){var e=this.$("#tvd-nm-tab-tests-wrapper"),t=new TD_NM.models.Base({title:"Thrive Optimize",empty_message:TD_NM.util.printf(TD_NM.t.no_s_found,[TD_NM.t.split_tests])}),i=new TD_NM.collections.OptionsCheckbox(TD_NM.split_tests.tab);if(this.model instanceof TD_NM.models.Trigger){var s=new TD_NM.collections.Options(this.model.get("settings").tab);i.match_selected(s)}return this.tab_section_view=this.render_section(e,t,i),this},render_tho_tests:function(){var e=this.$("#tvd-nm-tho-tests-wrapper"),t=new TD_NM.models.Base({title:"Thrive Headline Optimizer",empty_message:TD_NM.util.printf(TD_NM.t.no_s_found,[TD_NM.t.split_tests])}),i=new TD_NM.collections.OptionsCheckbox(TD_NM.split_tests.tho);if(this.model instanceof TD_NM.models.Trigger){var s=new TD_NM.collections.Options(this.model.get("settings").tho);i.match_selected(s)}return this.tho_section_view=this.render_section(e,t,i),this},get_settings:function(){return{tl:this.tl_section_view.collection.where({selected:!0}),tho:this.tho_section_view.collection.where({selected:!0}),tqb:this.tqb_section_view.collection.where({selected:!0}),tab:this.tab_section_view.collection.where({selected:!0})}},are_valid:function(){return this.tl_section_view.collection.where({selected:!0}).length>0||this.tho_section_view.collection.where({selected:!0}).length>0||this.tqb_section_view.collection.where({selected:!0}).length>0||this.tab_section_view.collection.where({selected:!0}).length>0}}),TD_NM.views.SettingsTestimonialSubmitted=TD_NM.views.Settings.extend({template:TVE_Dash.tpl("triggers/settings/testimonial-submitted"),render:function(){return this.$el.html(this.template({})),this},get_settings:function(){return{tvo:[]}},are_valid:function(){return!0}}),TD_NM.views.SettingsSendEmailNotification=TD_NM.views.Base.extend({className:"tvd-nm-settings-email-notification",template:TVE_Dash.tpl("actions/settings/send-email-notification"),events:{"click #tvd-nm-add-recipient":"add_recipient","keyup #tvd-nm-message-content":function(e){e.stopPropagation()}},trigger_model:null,initialize:function(e){e&&e.trigger&&(this.trigger_model=e.trigger),this.listenTo(this.model.get("recipients"),"add",this.render_option)},render:function(){return this.$el.html(this.template({})),this.model.get("recipients").length?this.model.get("recipients").each((function(e){this.render_option(e)}),this):this.add_recipient(),this._render_message(),this},render_option:function(e){var t=new TD_NM.views.OptionInputMultipleEmail({collection:this.model.get("recipients"),model:e});this.$("#tvd-nm-recipients-wrapper").append(t.render().$el)},add_recipient:function(){if(!this.model.get("recipients").where({value:null}).length){var e=this.model.get("recipients").last();void 0===e||TD_NM.util.is_email(e.get("value"))?void 0!==e&&this.model.get("recipients").where({value:e.get("value")}).length>1?TVE_Dash.err(TD_NM.t.email_duplicated):this.model.get("recipients").add({value:null,label:TD_NM.t.insert_recipients_email}):TVE_Dash.err(TD_NM.t.invalid_email)}},_render_message:function(){var e=this.model.get("message");0===e.get("content").length&&this.trigger_model&&"quiz_completion"===this.trigger_model.get("type")&&(e.set("subject",TD_NM.t.default_message_subject_quiz_completion_send_email),e.set("content",TD_NM.t.default_message_quiz_completion_send_email));var t=new TD_NM.views.MessageForm({model:e,collection:new TD_NM.collections.Base(TD_NM.message_shortcodes[this.trigger_model.get("type")][this.model.get("type")])});this.$("#tvd-nm-message-wrapper").html(t.render().$el)}}),TD_NM.views.SettingsCustomScript=TD_NM.views.Base.extend({template:TVE_Dash.tpl("actions/settings/custom-script"),render:function(){return this.$el.html(this.template(this.model?{item:this.model}:{})),TD_NM.util.data_binder(this),this}}),TD_NM.views.SettingsQuizCompletion=TD_NM.views.Settings.extend({template:TVE_Dash.tpl("triggers/settings/quiz-completion"),render:function(){return this.$el.html(this.template({})),this.render_quizzes(),this},render_quizzes:function(){var e=this.$("#tvd-nm-quizzes-wrapper"),t=new TD_NM.collections.OptionsCheckbox(TD_NM.tqb.quizzes);if(this.model instanceof TD_NM.models.Trigger){var i=new TD_NM.collections.Options(this.model.get("settings"));t.match_selected(i)}return this.quizzes_section_view=this.render_section(e,null,t),this},get_model:function(){return new TD_NM.models.Base({empty_message:TD_NM.t.no_quizzes})},are_valid:function(){return this.quizzes_section_view.collection.where({selected:!0}).length>0},get_settings:function(){return this.quizzes_section_view.collection.where({selected:!0})}}),TD_NM.views.SettingsWordpressNotification=TD_NM.views.Base.extend({template:TVE_Dash.tpl("actions/settings/wordpress-notification"),trigger_model:null,initialize:function(e){e&&e.trigger&&(this.trigger_model=e.trigger)},render:function(){return this.$el.html(this.template(this.model?{item:this.model}:{})),this._render_message(),this},_render_message:function(){var t=this.model.get("message");if(0===t.get("content").length&&this.trigger_model)switch(this.trigger_model.get("type")){case"email_sign_up":t.set("content",TD_NM.t.default_message_send_email_wp);break;case"split_test_ends":t.set("content",TD_NM.t.default_message_split_test_ends_wp);break;case"testimonial_submitted":t.set("content",TD_NM.t.default_message_testimonial_sub_wp);break;case"quiz_completion":t.set("content",TD_NM.t.default_message_quiz_completion_wp)}var i=new TD_NM.views.MessageForm({model:t,collection:new TD_NM.collections.Base(TD_NM.message_shortcodes[this.trigger_model.get("type")][this.model.get("type")])});i.action_type=this.model.get("type"),i.trigger_type=this.trigger_model.get("type"),this.$("#tvd-nm-message-wrapper").html(i.render().$el),setTimeout((function(){TVE_Dash.materialize(e("#tvd-nm-message-wrapper"))}),10)}}),TD_NM.views.OptionsSection=TD_NM.views.Base.extend({render:function(){return this.model&&this.model.get("title")&&this.$el.append("<h4>"+this.model.get("title")+"</h4>"),this.collection.each(this.render_option,this),0===this.collection.length&&this.model&&this.model.get("empty_message")&&this.$el.append('<p class="tvd-center-align tvd-nm-no-notification">'+this.model.get("empty_message")+"</p>"),this},render_option:function(e){var t="Option";e instanceof TD_NM.models.OptionCheckbox&&(t="OptionCheckbox");var i=new TD_NM.views[t]({model:e});return this.$el.append(i.render().$el),this}}),TD_NM.views.Option=TD_NM.views.Base.extend({template:TVE_Dash.tpl("options/option"),render:function(){return this.$el.append(this.template({item:this.model})),this}}),TD_NM.views.OptionCheckbox=TD_NM.views.Option.extend({className:"tvd-col tvd-s4",template:TVE_Dash.tpl("options/checkbox"),events:{'click input[type="checkbox"]':function(t){var i=e(t.currentTarget);this.model.set("selected",i.is(":checked"))}},render:function(){return this.$el.append(this.template({item:this.model})),this.$("input").prop("checked",this.model.get("selected")),this}}),TD_NM.views.OptionInput=TD_NM.views.Option.extend({className:"tvd-nm-option-input tvd-collapse tvd-row",template:TVE_Dash.tpl("options/input"),render:function(){return this.$el.append(this.template({item:this.model})),TD_NM.util.data_binder(this),this}}),TD_NM.views.OptionInputMultiple=TD_NM.views.OptionInput.extend({template:TVE_Dash.tpl("options/input-multiple"),events:{"click .tvd-nm-remove-recipient":"remove_option","blur input":"validate","change input":function(t){e(t.currentTarget).removeClass("tvd-invalid")}},render:function(){return this.$el.append(this.template({item:this.model})),TD_NM.util.data_binder(this),this},remove_option:function(){this.collection.remove(this.model,{silent:!0}),this.remove()},validate:function(){return this}}),TD_NM.views.OptionInputMultipleEmail=TD_NM.views.OptionInputMultiple.extend({validate:function(t){var i=e(t.currentTarget);if(t.currentTarget.value.length&&!TD_NM.util.is_email(t.currentTarget.value))return TVE_Dash.err(TD_NM.t.invalid_email),i.addClass("tvd-invalid"),void t.currentTarget.focus();t.currentTarget.value.length&&this.collection.where({value:this.model.get("value")}).length>1&&(TVE_Dash.err(TD_NM.t.email_duplicated),t.currentTarget.focus(),i.addClass("tvd-invalid"))}}),TD_NM.views.MessageForm=TD_NM.views.Base.extend({events:{"click .tvd-nm-toggle-display":"toggle_tab_display"},template:TVE_Dash.tpl("messages/form"),render:function(){return this.$el.html(this.template({item:this.model})),this.action_type&&"wordpress_notification"===this.action_type&&(this.$("#tvd-nm-message-subject").parents(".tvd-row").first().hide(),this.trigger_type&&"email_sign_up"===this.trigger_type&&this.$("#tvd-nm-message-shortcodes-wrapper").hide()),this.$el.find('label[for="tvd-nm-message-subject"]').toggleClass("tvd-active",!!this.model.get("subject").length),this.$el.find('label[for="tvd-nm-message-content"]').toggleClass("tvd-active",!!this.model.get("content").length),this.render_shortcodes(),this.bind_zclip(),TD_NM.util.data_binder(this),this.$("#tvd-nm-message-content").css({height:"150px"}),this},render_shortcodes:function(){var e=this.$("#tvd-nm-message-shortcodes-container");this.collection.each((function(t,i){TVE_Dash.tpl("messages/shortcodes/item"),e.append(TVE_Dash.tpl("messages/shortcodes/item")({item:t}))}),this)},toggle_tab_display:function(){var e=this.$el.find("#tvd-nm-message-shortcodes-container");e.hasClass("tvd-not-visible")?(e.hide(0).removeClass("tvd-not-visible").slideDown(200),this.$el.find(".tvd-nm-toggle-display-icon").removeClass("tvd-nm-icon-angle-up").addClass("tvd-nm-icon-angle-down"),this.$el.find(".tvd-nm-toggle-display-text").html(TD_NM.t.hide_available_shortcodes)):(e.slideUp(200,(function(){e.addClass("tvd-not-visible")})),this.$el.find(".tvd-nm-toggle-display-text").html(TD_NM.t.show_available_shortcodes),this.$el.find(".tvd-nm-toggle-display-icon").removeClass("tvd-nm-icon-angle-down").addClass("tvd-nm-icon-angle-up"))}}),TD_NM.views.NewButton=TD_NM.views.Base.extend({className:"tvd-col tvd-nm-add-action tvd-pointer",template:TVE_Dash.tpl("new-button"),events:{"click .tvd-card":"add_new_action"},add_custom_text:function(e){this.$el.find(".tvd-nm-new-button-header-text").html(e)},add_new_action:function(){this.modal(TD_NM.views.ModalAddAction,{action_types:new TD_NM.collections.ActionTypes(TD_NM.action_types),model:new TD_NM.models.ActionComplex,notification_model:this.model,collection:this.model.get("actions"),"max-width":"60%",width:"750px",in_duration:200,out_duration:0})}}),TD_NM.views.NewButtonDash=TD_NM.views.NewButton.extend({className:function(){return"tvd-col tvd-s12 tvd-nm-add-action tvd-pointer tvd-nm-create-notification tvd-nm-create-notification-area"},add_custom_text:function(e){this.$el.prepend('<div class="tvd-col tvd-s12 tvd-center-align tvd-nm-no-notification tvd-nm-create-notification-area">'+e+"</div>")},add_new_action:function(){}}),TD_NM.views.Notification=TD_NM.views.Base.extend({className:"tvd-row tvd-nm-notification-item",template:TVE_Dash.tpl("notifications/item"),initialize:function(){this.listenTo(this.model,"remove",this.remove),this.listenTo(this.model.get("actions"),"add",this.reset_notification),this.listenTo(this.model.get("actions"),"remove",this.reset_notification)},render:function(){return this.$el.html(this.template({})),this.render_trigger(this.model.get("trigger")),this.render_actions(this.model.get("actions")),this.model.get("actions").length<TD_NM.action_types.length&&this.render_add_button(),this.render_notification_action_buttons(),this},render_trigger:function(e){return new TD_NM.views.SummaryTriggers({collection:new TD_NM.collections.Base([e]),el:this.$("#tvd-nm-trigger-wrapper")}).render(),this},render_actions:function(e){var t=new TD_NM.views.SummaryActions({collection:e,el:this.$("#tvd-nm-actions-wrapper")});return t.trigger=this.model.get("trigger"),t.render(),this},render_add_button:function(){var e=new TD_NM.views.NewButton({model:this.model});this.$("#tvd-nm-actions-wrapper").append(e.render().$el),e.add_custom_text(TD_NM.t.add_new_action)},render_notification_action_buttons:function(){var e=new TD_NM.views.NotificationActionButtons({model:this.model});this.$("#tvd-nm-actions-wrapper").append(e.render().$el)},reset_notification:function(){this.$el.empty(),this.render()}}),TD_NM.views.NotificationActionButtons=TD_NM.views.Base.extend({className:"tvd-right tvd-nm-notification-action-buttons",template:TVE_Dash.tpl("options/action-buttons"),events:{"click .tvd-nm-delete-notification":"delete_notification_modal"},delete_notification_modal:function(){this.modal(TD_NM.views.ModalDelete,{model:this.model,"max-width":"60%",width:"750px",in_duration:200,out_duration:0})}}),TD_NM.views.NotificationSummary=TD_NM.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/notification-summary"),render:function(){return this.$el.html(this.template({trigger:this.trigger_model,action:this.action_model})),this}}),TD_NM.views.Summary=TD_NM.views.Base.extend({className:"tvd-row tvd-nm-summary",render:function(){return this.collection.each(this.render_item,this),this},render_item:function(e){var t="SummaryItem";(e instanceof TD_NM.models.Trigger||e instanceof TD_NM.models.Action)&&(t="SummaryItemNotification");var i=new TD_NM.views[t]({model:e,collection:this.collection});return this.$el.append(i.render().$el),this}}),TD_NM.views.SummaryActions=TD_NM.views.Summary.extend({render_item:function(e){var t=new TD_NM.views.SummaryItemAction({model:e,collection:this.collection});return t.trigger=this.trigger,this.$el.append(t.render().$el),this}}),TD_NM.views.SummaryTriggers=TD_NM.views.Summary.extend({render_item:function(e){var t=new TD_NM.views.SummaryItemTrigger({model:e,collection:this.collection});return this.$el.append(t.render().$el),this}}),TD_NM.views.SummaryItem=TD_NM.views.Base.extend({className:"tvd-col tvd-s2 tvd-nm-summary-item",template:TVE_Dash.tpl("summaries/item"),events:{"click .tvd-nm-action-edit":"edit_action","click .tvd-nm-action-delete":"delete_action"},edit_action:function(){this.modal(TD_NM.views.ModalEditAction,{action_types:new TD_NM.collections.ActionTypes(TD_NM.action_types),trigger:this.trigger,model:this.model,collection:this.collection,"max-width":"60%",width:"750px",in_duration:200,out_duration:0})},delete_action:function(){this.modal(TD_NM.views.ModalDelete,{model:this.model,"max-width":"60%",width:"750px",in_duration:200,out_duration:0})}}),TD_NM.views.SummaryItemAction=TD_NM.views.Base.extend({className:"tvd-col",template:TVE_Dash.tpl("summaries/items/action"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"remove",this.remove_item)},render:function(){var e="SummaryItem";"send_email_notification"===this.model.get("type")?e+="SendEmailNotification":"custom_script"===this.model.get("type")?e+="CustomScript":"wordpress_notification"===this.model.get("type")&&(e+="WordpressNotification");var t=new TD_NM.views[e]({model:this.model,collection:this.collection});return t.trigger=this.trigger,this.$el.html(""),this.$el.append(t.render().$el),this},remove_item:function(){this.collection.each((function(e,t){e.set("ID",t)}))}}),TD_NM.views.SummaryItemCustomScript=TD_NM.views.SummaryItem.extend({specific_class:"",className:function(){return"tvd-card tvd-white tvd-small tvd-valign-wrapper tvd-nm-summary-item-action tvd-nm-action td-nm-equal-width-action "+this.specific_class},template:TVE_Dash.tpl("summaries/items/actions/custom-script"),render:function(){return this.collection.indexOf(this.model)===TD_NM.action_types.length-1&&this.$el.addClass("tvd-nm-no-icon-action"),this.$el.html(this.template({item:this.model})),this.bind_zclip(),this}}),TD_NM.views.SummaryItemSendEmailNotification=TD_NM.views.SummaryItem.extend({specific_class:"",className:function(){return"tvd-card tvd-white tvd-small tvd-valign-wrapper tvd-nm-summary-item-action tvd-nm-action td-nm-equal-width-action "+this.specific_class},template:TVE_Dash.tpl("summaries/items/actions/send-email-notification"),render:function(){return this.collection.indexOf(this.model)===TD_NM.action_types.length-1&&this.$el.addClass("tvd-nm-no-icon-action"),this.$el.html(this.template({item:this.model})),this.render_recipients(),this},render_recipients:function(){var e=this.$(".tvd-nm-emails-list"),t=this.model.get("recipients").length;this.model.get("recipients").every((function(i,s){var n=TVE_Dash.tpl("options/recipient");if(s<=0)return e.append(n({item:i})),0!=s&&1!=t&&e.append("<span>,&nbsp;</span>"),!0;var o=t-1,r=new TD_NM.models.Base({value:"+"+o+" "+TD_NM.t.others});return e.append("<span>,&nbsp;</span>"),e.append(n({item:r})),!1}))}}),TD_NM.views.SummaryItemWordpressNotification=TD_NM.views.SummaryItem.extend({specific_class:"tvd-nm-action-wp",className:function(){return"tvd-card tvd-white tvd-small tvd-valign-wrapper tvd-nm-summary-item-action tvd-nm-action td-nm-equal-width-action "+this.specific_class},template:TVE_Dash.tpl("summaries/items/actions/wordpress-notification"),render:function(){return this.collection.indexOf(this.model)===TD_NM.action_types.length-1&&this.$el.addClass("tvd-nm-no-icon-action"),this.$el.html(this.template({item:this.model})),this.bind_zclip(),this}}),TD_NM.views.SummaryItemTrigger=TD_NM.views.SummaryItem.extend({className:"tvd-card tvd-white tvd-small tvd-valign-wrapper tvd-nm-summary-item-trigger",template:TVE_Dash.tpl("summaries/items/trigger"),events:{"click .tvd-nm-edit-trigger":"edit"},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){var e=TD_NM.globals.trigger_types.findWhere({key:this.model.get("type")});return this.model.set("label",e.get("label"),{silent:!0}).set("icon",e.get("icon"),{silent:!0}),this.$el.html(this.template({item:this.model})),this},edit:function(){this.modal(TD_NM.views.ModalEditTrigger,{trigger_types:TD_NM.globals.trigger_types,model:this.model,"max-width":"60%",width:"750px",in_duration:200,out_duration:0})}}),TD_NM.views.SummaryItemNotification=TD_NM.views.SummaryItem.extend({className:"tvd-col tvd-s3",template:TVE_Dash.tpl("summaries/items/notification"),render:function(){var e=null;return this.model instanceof TD_NM.models.Trigger?(e=TD_NM.globals.trigger_types.findWhere({key:this.model.get("type")}),this.model.set("color","tvd-green-text").set("class","tvd-nm-summary-item-trigger")):(e=TD_NM.globals.action_types.findWhere({key:this.model.get("type")}),this.model.set("color","tvd-blue-text").set("class","tvd-nm-summary-item-action")),this.model.set("label",e.get("label")).set("icon",e.get("icon")),this.$el.html(this.template({item:this.model})),this}}),TD_NM.views.Unavailable=TD_NM.views.Base.extend({template:TVE_Dash.tpl("unavailable")})}))}(jQuery),_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},Backbone.ajax=function(){return-1===arguments[0].url.indexOf("_nonce")&&(arguments[0].url+="&_nonce="+TD_NM.admin_nonce),Backbone.$.ajax.apply(Backbone.$,arguments)},function(e){var t=Backbone.Router.extend({view:null,$el:e("#tvd-nm-wrapper"),routes:{dashboard:"dashboard"},breadcrumbs:{collection:null,view:null},init_breadcrumbs:function(){this.breadcrumbs.collection=new TD_NM.collections.Breadcrumbs,this.breadcrumbs.view=new TD_NM.views.Breadcrumbs({collection:this.breadcrumbs.collection})},dashboard:function(){this._set_page("dashboard",TD_NM.t.NM_Dashboard),this.view&&this.view.remove(),this._render_header(),0!==TD_NM.trigger_types.length?this.view=new TD_NM.views.Dashboard({collection:new TD_NM.collections.Notifications(TD_NM.notifications)}):this.view=new TD_NM.views.Unavailable({}),this.$el.html(this.view.render().$el)},_render_header:function(){this.header?this.header.setElement(e(".tvu-header")):this.header=new TD_NM.views.Header({el:"#tvd-nm-header"}),this.header.render()},_set_page:function(t,i,s){this.breadcrumbs.collection.reset(),s=s||{},this.breadcrumbs.collection.add_page(TD_NM.dash_url,TD_NM.t.Thrive_Dashboard,!0),_.each(s,_.bind((function(e){this.breadcrumbs.collection.add_page(e.route,e.label)}),this)),this.breadcrumbs.collection.add_page("",i);var n=e("head > title");this.original_title||(this.original_title=n.html()),n.html(i+" &lsaquo; "+this.original_title)}});e((function(){TD_NM.globals=TD_NM.globals||{},TD_NM.globals.trigger_types=new TD_NM.collections.TriggerTypes(TD_NM.trigger_types),TD_NM.globals.action_types=new TD_NM.collections.ActionTypes(TD_NM.action_types),TD_NM.globals.email_services=new TD_NM.collections.EmailServices(TD_NM.email_services),TD_NM.router=new t,TD_NM.router.init_breadcrumbs(),Backbone.history.start({hashchange:!0}),Backbone.history.fragment||TD_NM.router.navigate("#dashboard",{trigger:!0})}))}(jQuery)}();