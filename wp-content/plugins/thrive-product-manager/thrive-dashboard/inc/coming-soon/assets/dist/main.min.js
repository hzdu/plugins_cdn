!function(){var e;(e=jQuery)((()=>{(new(Backbone.View.extend({el:".cs-content",events:{"click .tvd-toggle-input":"switchToggle","click .add-new-page":"createNewPage","click .enable-state":function(t){this.enableState(t.target.getAttribute("data-enable")),t.target.classList.contains("remove-page")&&(this.activateComingSoon(0),e(".page-source-select").val(null).trigger("change"))}},initialize:function(){0!==parseInt(TVD_CS_CONST.is_coming_soon_enabled)&&this.enableState("view")},initializeDropdown:function(){e(".page-source-select").select2({ajax:{url:TVD_CS_CONST.baseUrl,dataType:"json",delay:250,data:e=>({search:e.term,status:"publish",type:"page"}),processResults:e=>({results:e})},placeholder:TVD_CS_CONST.t.search_page,templateResult:t=>t.loading?t.text:t.title?e(TVE_Dash.tpl("coming-soon-views-dropdown-result",{pageTitle:t.title.rendered})):void 0,templateSelection:e=>e.text||e.title.rendered,multiple:!0,minimumInputLength:3,language:{inputTooShort:()=>""}}).on("select2:select",(e=>{this.initializePageVariables(e.params.data),this.enableState("inactive"),this.enableLoader(),this.activateComingSoon(e.params.data.id)}))},createNewPage:function(){const t=e("#new-page-title").val();t?(this.enableLoader(),e.ajax({method:"POST",url:TVD_CS_CONST.baseUrl,data:{title:t,type:"page",status:"publish"},beforeSend:e=>{e.setRequestHeader("X-WP-Nonce",TVD_CS_CONST.nonce)},success:e=>{this.initializePageVariables(e),this.activateComingSoon(e.id)}})):TVE_Dash.err(TVD_CS_CONST.t.add_page_title)},activateComingSoon:function(t){e.ajax({url:ajaxurl,dataType:"json",type:"POST",data:{_wpnonce:TVE_Dash_Const.nonce,action:TVE_Dash_Const.actions.backend_ajax,route:TVE_Dash_Const.routes.settings,field:"tvd_coming_soon_page_id",value:t}}).done((a=>{0!==t&&this.enableState("view"),e("#wp-admin-bar-coming-soon").toggle(0!==t),TVE_Dash.page_loader&&TVE_Dash.page_loader.close(),TVE_Dash.success(TVD_CS_CONST.t.saved_successfully)}))},switchToggle:function(){this.$(".tvd-toggle-input")[0].checked?this.enableState("search"):(this.activateComingSoon(0),this.enableState("inactive"))},enableState:function(e){if("inactive"!==e){const t={pageName:TVD_CS_CONST.page_name,editUrl:TVD_CS_CONST.edit_url,previewUrl:TVD_CS_CONST.preview_url};this.$el.find(".tvd-cs-page-selector").html(TVE_Dash.tpl(`coming-soon-views-${e}`,"view"===e?t:{})),"search"===e&&this.initializeDropdown()}else this.$el.find(".tvd-cs-page-selector").empty()},initializePageVariables:function(e){TVD_CS_CONST.page_name=e.title.rendered,TVD_CS_CONST.preview_url=e.link;const t=new URL(TVD_CS_CONST.base_url+"post.php");t.searchParams.append("post",e.id),t.searchParams.append("action","architect"),t.searchParams.append("tve","true"),TVD_CS_CONST.edit_url=t},enableLoader:function(){TVE_Dash.page_loader=new TVE_Dash.views.PageLoader,TVE_Dash.page_loader.render(),TVE_Dash.page_loader.open()}}))).render()}))}();