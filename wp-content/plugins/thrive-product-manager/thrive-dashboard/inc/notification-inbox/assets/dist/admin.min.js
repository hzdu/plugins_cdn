!function(){var t={9389:function(t){t.exports=Backbone.Collection.extend({last:function(){return this.at(this.size()-1)}})},6618:function(t,n,e){var o=e(9389),i=e(1299);t.exports=o.extend({model:i})},1299:function(t){t.exports=Backbone.Model.extend({idAttribute:"ID",defaults:{title:"",read:0},initialize:function(t){this.set("read",0===t.read?"unread":"read")},get_action:function(){return"notification"},url:function(){var t=ajaxurl+(this.get_action()+"&")+this.get_route();return $.isNumeric(this.get("ID"))&&(t+="&ID="+this.get("ID")),t}})},982:function(t){jQuery,t.exports=Backbone.View.extend({render:function(){return this}})},5621:function(t,n,e){var o;jQuery,o=e(982),t.exports=o.extend({render:function(){return this.$el.append(TVE_Dash.tpl("ni-notification")({model:this.model})),this}})},4475:function(t,n,e){!function(n){var o=e(982);t.exports=o.extend({events:{"click .tvd-ni-notifications":"open","click .ni-counter-holder":"open"},initialize:function(){var t=this;this.listenTo(this.collection,"change:read",t.render),this.collection.on("bulk_update",(function(){t.render()}))},render:function(){return this.$(".ni-counter-holder").html(TD_Inbox.total_unread),TD_Inbox.total_unread>=1?this.$(".ni-counter-holder").show():this.$(".ni-counter-holder").hide(),this},open:function(){n(".tvd-inbox-holder").toggle()}})}(jQuery)},822:function(t,n,e){!function(n){var o=e(982);t.exports=o.extend({render:function(){return this.$el.html(TVE_Dash.tpl("ni-notification-detail")({model:this.model})),"unread"===this.model.get("read")&&this.save(),this},save:function(){var t=this;n.ajax({type:"POST",url:TD_Inbox.ajaxurl,data:{action:"thrv_notifications",notification_id:t.model.get("id"),_nonce:TD_Inbox.admin_nonce}}).done((function(n){void 0!==(n=JSON.parse(n)).total_unread&&(TD_Inbox.total_unread=n.total_unread,TD_Inbox.total_unread>=1&&t.$(".ni-counter-holder").show(),t.model.set({read:"read"}))})).error((function(t){TVE_Dash.err(t.responseJSON.error)}))}})}(jQuery)},2940:function(t,n,e){var o=e(982),i=e(5621),a=e(822),r=e(1299);!function(n){var e=o.extend({events:{"click .tvd-ni-mark-read":"readAll"},render:function(){return this.$el.html(TVE_Dash.tpl("notification-header")({})),0===this.collection.where({read:"unread"}).length&&this.$(".tvd-ni-mark-read").addClass("tvd-ni-disabled"),0==this.collection.length&&this.$(".tvd-ni-mark-read").empty(),this},readAll:function(t){this.collection.each((function(t){t.set({read:"read"},{silent:!0})})),this.saveData(),this.collection.trigger("render"),this.render(),t.stopPropagation()},saveData:function(){var t=this;n.ajax({type:"POST",url:TD_Inbox.ajaxurl,data:{action:"thrv_bulkread",_nonce:TD_Inbox.admin_nonce}}).done((function(n){void 0!==(n=JSON.parse(n)).total_unread&&(TD_Inbox.total_unread=n.total_unread,t.collection.trigger("bulk_update"))}))}});t.exports=o.extend({headerView:null,events:{"click .td-inbox-item":"renderNotification","click .ni-go-back":"render","click .tvd-ni-close":"close","click .tvd-ni-load-inner":"loadMore"},initialize:function(){var t=this;this.collection.on("render",(function(){t.render()}))},render:function(t){return this.$(".tvd-notification-wrapper").html('<div class="tvd-notifications-list"></div><div class="tvd-load-more"></div>'),this.headerView&&this.headerView.undelegateEvents(),this.headerView=new e({el:this.$(".tvd-notification-header"),collection:this.collection}).render(),this.renderList(),0===this.collection.length?this.$(".tvd-load-more").append('<span class="tvd-ni-no-data">'+TD_Inbox.t.no_data+"</span>"):this.collection.length<parseInt(TD_Inbox.total)?this.$(".tvd-load-more").html('<span class="tvd-ni-load"><span class="tvd-ni-load-inner">'+TD_Inbox.t.more_10+"</span></span>"):this.$(".tvd-load-more").html('<span class="tvd-ni-no-more-data">'+TD_Inbox.t.no_more_data+"</span>"),t&&t.target&&t.stopPropagation(),this},renderList:function(){this.$(".tvd-notifications-list").empty(),this.collection.each((function(t){new i({model:t,el:this.$(".tvd-notifications-list")}).render()}),this)},renderNotification:function(t){var n=t.currentTarget.dataset.id,e=this.collection.findWhere({id:n});new a({model:e,el:this.$(".tvd-notification-wrapper")}).render(),this.$(".tvd-notification-header").empty(),t.stopPropagation()},close:function(){this.$el.toggle()},loadMore:function(t){this.doAjaxCall("thrv_load_more",{limit:TD_Inbox.limit,offset:TD_Inbox.offset}),this.collection.length>=parseInt(TD_Inbox.total)&&(this.$(".tvd-load-more").empty(),this.$(".tvd-load-more").html('<span class="tvd-ni-no-more-data">'+TD_Inbox.t.no_more_data+"</span>")),t.stopPropagation()},doAjaxCall:function(t,e){var o=this,i=this.$(".tvd-ni-load-inner"),a=i.text();i.text("Loading..."),n.ajax({type:"POST",url:TD_Inbox.ajaxurl,data:_.extend({action:t,_nonce:TD_Inbox.admin_nonce},e)}).done((function(t){TD_Inbox.offset=parseInt(TD_Inbox.limit)+parseInt(TD_Inbox.offset),_.each(t,(function(t){o.collection.add(new r(t))})),o.collection.length===parseInt(TD_Inbox.total)&&o.$(".tvd-load-more").html('<span class="tvd-ni-no-more-data">'+TD_Inbox.t.no_more_data+"</span>"),o.renderList()})).always((function(){i.length&&i.text(a)}))}})}(jQuery)}},n={};function e(o){var i=n[o];if(void 0!==i)return i.exports;var a=n[o]={exports:{}};return t[o](a,a.exports,e),a.exports}TD_Inbox=TD_Inbox||{},function(t){var n=e(2940),o=e(4475),i=e(6618);t((function(){var e=new i(TD_Inbox.data);new n({el:t(".tvd-inbox-holder"),collection:e}).render(),new o({el:t(".ni-inbox-counter"),collection:e}).render(),t(".tvd-ni-notifications").length&&t(".tvd-inbox-holder").length&&t(document).click((function(n){t(n.target).is(".tvd-ni-notifications, .ni-counter-holder")||t(n.target).closest(".tvd-inbox-holder").length<=0&&t("body").find(".tvd-inbox-holder").hide()}))}))}(jQuery)}();