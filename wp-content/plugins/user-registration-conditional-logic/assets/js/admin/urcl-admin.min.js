jQuery(function(a){var r={init:function(){a(document.body).on("ur_rendered_field_options ur_new_field_created",function(){r.renderConditionalLogicMapUI()}),a(document.body).on("change",".ur-enable-conditional-logic",function(){var e=a(this).is(":checked");a(".ur-selected-item.ur-item-active").find(".ur-enable-conditional-logic").attr("checked",e),e?(a("#ur-setting-form .urcl-logic-creator").slideDown(),a(".ur-selected-item.ur-item-active").find(".urcl-logic-creator").show()):(a("#ur-setting-form .urcl-logic-creator").slideUp(),a(".ur-selected-item.ur-item-active").find(".urcl-logic-creator").hide())}),a(document.body).on("click",".urcl-add-new-group",function(e){e.preventDefault();e=r.resolve_smart_tags(urcl_data.templates.group,{urcl_conditions:r.createField()});a("#ur-setting-form .urcl-logic-map-container").append(e),r.udpateRuleJSON()}),a(document.body).on("click",".urcl-add-field",function(){var e=a(this).closest(".urcl-conditional-logic__group");1===e.find(".urcl-field").length&&0===e.find(".urcl-logic-gate.is-active").length&&e.find(".urcl-logic-gate-or").addClass("is-active"),a(this).closest(".urcl-field").after(r.createField()),r.udpateRuleJSON()}),a(document.body).on("click",".urcl-remove-group",function(){var t;1<a(this).closest(".urcl-logic-map-container").find(".urcl-group").length?(t=a(this),Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to remove the Conditional Logic group? You will not be able to revert this action.",confirmButtonText:"Yeah! Go Ahead.",showCancelButton:!0}).then(function(e){e.value&&(t.closest(".urcl-group").remove(),r.udpateRuleJSON())})):Swal.fire({icon:"error",title:"Nope!",text:"You have to leave at least ONE group."})}),a(document.body).on("click",".urcl-remove-field",function(){var t,i;1<a(this).closest(".urcl-conditions-container").find(".urcl-field").length?(t=a(this),i=a(this).closest(".urcl-conditional-logic__group"),Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to remove the Conditional Logic field? You will not be able to revert this action.",confirmButtonText:"Yeah! Go Ahead.",showCancelButton:!0}).then(function(e){e.value&&(t.closest(".urcl-field").remove(),1===i.find(".urcl-field").length&&i.find(".urcl-logic-gate.is-active").length&&i.find(".urcl-logic-gate").removeClass("is-active"),r.udpateRuleJSON())})):Swal.fire({icon:"error",title:"Nope!",text:"You have to leave at least ONE field in a group."})}),a(document.body).on("change",".urcl-action-input, .urcl-root-logic-gate, .urcl-triggerer-field, .urcl-field-operator, .urcl-field-value",function(){r.udpateRuleJSON()}),a(document.body).on("change",".urcl-triggerer-field",function(){var e=a(this).val(),e=r.getInputElementForCLField(e);a(this).closest(".urcl-field").find(".urcl-field-value").remove(),a(this).closest(".urcl-field").find(".urcl-field-operator").after(e),r.udpateRuleJSON()}),a(document.body).on("click",".urcl-logic-gate",function(){a(this).is(".is-active")||(a(this).closest(".urcl-logic-gate-container").find(".urcl-logic-gate.is-active").removeClass("is-active"),a(this).addClass("is-active"),r.udpateRuleJSON())})},resolve_smart_tags:function(t,i,e){var o;return t&&i&&"object"==typeof i&&Object.keys(i).forEach(function(e){o=new RegExp("{{{"+e+"}}}","g"),t=t.replace(o,i[e])}),e&&Array.isArray(e)&&e.length&&e.forEach(function(e){e&&"object"==typeof e&&e.placeholder&&""!==e.placeholder&&(o=new RegExp("{{{"+e.placeholder+":"+e.tag+"}}}","g"),t=t.replace(o,e.value),o=new RegExp("{{{"+e.placeholder+":[A-z0-9_]+}}}","g"),t=t.replace(o,""))}),t},renderConditionalLogicMapUI:function(){var e,t,i=a("#ur-setting-form .urcl-logic-map").val(),o=null;try{i=(i=i.replace(/\\"/g,'"')).replace(/^"|"$/g,""),o=JSON.parse(i)}catch(l){}o&&(e=o.logic_map,i=a("#ur-setting-form .urcl-logic-creator"),t=[],i.find(".urcl-action-input").val(o.action),i.find(".urcl-root-logic-gate").val(e.logic_gate),e.conditions.forEach(function(e){t.push(r.createGroup(e))}),i.find(".urcl-logic-map-container").html(t.join("")))},createGroup:function(e){var t=[];return e||"object"==typeof e||(e={}),Array.isArray(e.conditions)&&e.conditions.forEach(function(e){t.push(r.createField(e))}),r.resolve_smart_tags(urcl_data.templates.group,{urcl_conditions:t.join("")},[{placeholder:"urcl_logic_gate",tag:e.logic_gate,value:"is-active"}])},createField:function(e){return e||"object"==typeof e||(e={}),r.resolve_smart_tags(urcl_data.templates.field,{urcl_triggerer_input:r.getFormFields(e.triggerer_id,[r.getSelectedFieldId()]),urcl_field_value_input:r.getInputElementForCLField(e.triggerer_id,e.value)},[{placeholder:"operator",tag:e.operator,value:"selected"}])},getSelectedFieldId:function(){return a(".ur-selected-item.ur-item-active").find(".ur-general-setting-field-name .ur-general-setting-field").val()},getFormFields:function(e,t,i){var o,l,r,n,c=['<option value="***">--- Select a field ---</option>'];return Array.isArray(t)||(t=[]),Array.isArray(i)||(i=["phone","date","timepicker","file","profile_picture","single_item","section_title","html","wysiwyg","hidden","billing_address_title","shipping_address_title"]),a(".ur-selected-item").each(function(){o=a(this).find(".ur-field").data("field-key"),l=a(this).find(".ur-general-setting-label .ur-general-setting-field").val(),r=a(this).find(".ur-general-setting-field-name .ur-general-setting-field").val(),n="",o&&l&&r&&(t.includes(r)||i.includes(o)||(e===r&&(n='selected="selected"'),c.push('<option data-type="'+o+'" data-label="'+l+'" value="'+r+'" '+n+">"+l+"</option>")))}),'<select class="urcl-conditional-logic__rule__param urcl-triggerer-field">'+c.join("")+"</select>"},getInputElementForCLField:function(i,o){var l,r,n,c,u="";return a(".ur-selected-item").each(function(){if(t=a(this).find(".ur-field").data("field-key"),l=a(this).find(".ur-general-setting-field-name .ur-general-setting-field").val(),["checkbox","multi_select2"].includes(t)&&(t="checkbox"),["radio","select","select2"].includes(t)&&(t="radio"),["country","billing_country","shipping_country"].includes(t)&&(t="country"),["privacy_policy","mailchimp","separate_shipping"].includes(t)&&(t="check_uncheck"),i===l){switch(t){case"checkbox":r=[],a(this).find(".ur-general-setting-options .ur-options-list .ur-type-checkbox-label").each(function(){n="",a(this).val()===o&&(n="selected"),r.push('<option value="'+a(this).val()+'" '+n+">"+a(this).val()+"</option>")}),u='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+r.join("")+"</select>";break;case"radio":r=[],a(this).find(".ur-general-setting-options .ur-options-list .ur-type-radio-label").each(function(){n="",a(this).val()===o&&(n="selected"),r.push('<option value="'+a(this).val()+'" '+n+">"+a(this).val()+"</option>")}),u='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+r.join("")+"</select>";break;case"country":r=[],a(this).find(".ur-settings-selected-countries option:selected").each(function(){n="",a(this).val()===o&&(n="selected"),r.push('<option value="'+a(this).val()+'" '+n+">"+a(this).html()+"</option>")}),u='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+r.join("")+"</select>";break;case"learndash_course":r=[];var e,t=a(".ur-general-setting-learndash_course .ur-general-setting-field-type select").val();"select_box"===t?a(this).find("#ur-input-type-learndash-course option").each(function(){n="",a(this).val()==o&&(n="selected=selected"),r.push('<option value="'+a(this).val()+'" '+n+">"+a(this).html()+"</option>")}):"check_box"===t&&a(this).find(".ur-input-type-learndash_course .ur-field input").each(function(){n="",e=a(this).data("value"),optionLabel=a(this).data("label"),e==o&&(n="selected=selected"),r.push('<option value="'+e+'" '+n+">"+optionLabel+"</option>")}),u='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+r.join("")+"</select>";break;case"number":c="",u='<input type="number" class="urcl-conditional-logic__rule__value urcl-field-value" '+(c=o?'value="'+o+'"':c)+" />";break;case"check_uncheck":u='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+(r=['<option value="checked" '+("checked"===o?"selected":"")+">Checked</option>",'<option value="unchecked" '+("unchecked"===o?"selected":"")+">UnChecked</option>"]).join("")+"</select>";break;default:c="",u='<input type="text" class="urcl-conditional-logic__rule__value urcl-field-value" '+(c=o?'value="'+o+'"':c)+" />"}return!1}}),u},udpateRuleJSON:function(){var e,t,i,o=a("#ur-setting-form .urcl-logic-creator"),l={action:o.find(".urcl-action-input").val(),logic_map:{type:"group",logic_gate:o.find(".urcl-root-logic-gate").val(),conditions:[]}},r=[];o.find(".urcl-logic-map-container .urcl-group").each(function(){t=[],i=a(this).find(".urcl-logic-gate.is-active").data("value"),a(this).find(".urcl-field").each(function(){t.push({type:"field",triggerer_id:a(this).find(".urcl-triggerer-field").val(),operator:a(this).find(".urcl-field-operator").val(),value:a(this).find(".urcl-field-value").val()})}),r.push({type:"group",logic_gate:i||"",conditions:t})}),l.logic_map.conditions=r,e=JSON.stringify(l),a("#ur-setting-form .urcl-logic-map").val(e),a(".ur-selected-item.ur-item-active").find(".urcl-logic-map").val(e)}};function o(){var o="";return a(".ur-grid-lists .ur-selected-item .ur-general-setting").each(function(){var e,t=a(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-label label").text(),i=a(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-field").data("field-key");"section_title"==i||"html"==i||"wysiwyg"==i||"billing_address_title"==i||"shipping_address_title"==i||void 0!==(e=a(this).find("[data-field='field_name']").val())&&(o+='<option value="'+e+'" data-type="'+i+'">'+t+"</option>")}),o}function e(){var e,t,i;a("#user_registration_form_setting_enable_assign_user_role_conditionally").is(":checked")?0===a(".urcl-role-container").length?(t=(e=a(urcl_data.users_roles_conditional_fields)).find(".urcl-field-conditional-field-select"),i='<option value="">-- Select --</option>'+o(),t.each(function(){var e=a(this).val();a(this).html(i),a(this).val(e),a(this).find('option[value="'+e+'"]').prop("selected",!0)}),a("#user_registration_form_setting_enable_assign_user_role_conditionally").closest(".urcl-form-settings-enable-assign-user-role").after(e)):a(".urcl-role-container").show():a(".urcl-role-container").hide()}r.init(),e(),a(document).on("change","#user_registration_form_setting_enable_assign_user_role_conditionally",function(){e()});var t=urcl_data.users_roles_conditions_data;function i(e,t){var i,o,l,r=a("option:selected",t).attr("data-type"),n=a("option:selected",t).val(),c=a(t).closest(e).find(".urcl-value").children().first(),t=c.attr("name"),e=c.attr("class");"checkbox"==r||"radio"==r||"select"==r||"country"==r||"billing_country"==r||"shipping_country"==r||"select2"==r||"multi_select2"==r?("select"==r||"select2"==r||"multi_select2"==r?i=a('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+n+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return a(this).val()}):"country"==r||"billing_country"==r||"shipping_country"==r?(a('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+n+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return a(this).val()}),a('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+n+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return a(this).text()})):i=a('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+n+'"]').closest(".ur-selected-item").find(".ur-field input").map(function(){return a(this).val()}),o="<option value>--select--</option>","country"==r||"billing_country"==r||"shipping_country"==r?(n=a('.ur-general-setting-field-name input[value="'+n+'"').closest(".ur-selected-item").find(".ur-advance-selected_countries select option:selected"),l=[],a(this).find(".urcl-value select").html('<option value="">--select--</option>'),n.each(function(){var e=a(this).val(),t=a(this).text();l.push('<option value="'+e+'">'+t+"</option>")}),o=l.join("")):1==i.length&&""===i[0]?o='<option value="1">'+urcl_data.checkbox_checked+"</option>":a(i).each(function(e,t){o=o+'<option value="'+t+'">'+t+"</option>"}),c.replaceWith('<select name="'+t+'" class="'+e+'">'+o+"</select>")):c.replaceWith('<input type="text" name="'+t+'" class="'+e+'">')}a(document).on("click",".urcl-role-conditional-container .urcl-role-logic-box .add",function(){condition_id=a(this).closest(".urcl-role-logic-box").attr("data-group");var e=a(this).closest(".urcl-role-logic-box").attr("data-last-key");e++;var t=a(this).closest(".urcl-or-groups").length;$output='<li class="'+(1===t?"urcl-conditional-or-group":"urcl-conditional-group")+'" data-key='+e+">",$output+='<div class="urcl-form-group">',$output+='<select class="urcl-form-settings-field urcl-user-role-field urcl-field-conditional-field-select" name="user_registration_form_fields['+condition_id+"]["+e+']">',$output+='<option value="">-- Select --</option>',$output+=o(),$output+="</select></div>",$output+='<div class="urcl-operator"><select class="urcl-form-settings-field urcl-user-role-field" name="user_registration_form_operator['+condition_id+"]["+e+']">',$output+='<option value = "is" >is</option>',$output+='<option value = "is_not" >is not</option>',$output+='<option value = "empty"> empty </option>',$output+='<option value = "not_empty"> not empty </option>',$output+='<option value = "greater_than"> greater than </option>',$output+='<option value = "less_than"> less_than </option>',$output+="</select></div>",$output+='<div class="urcl-value"><input class="urcl-form-settings-field urcl-user-role-field" name = "user_registration_form_value['+condition_id+"]["+e+']" type="text" /></div>',$output+='<span class="add">',$output+="AND",$output+="</span>",$output+='<span class="remove">',$output+='<i class="dashicons dashicons-minus"></i>',$output+="</span></li>",a(this).closest(".urcl-role-logic-box").append($output),a(this).closest(".urcl-role-logic-box").attr("data-last-key",e)}),a(document).on("click",".urcl-role-conditional-container .urcl-role-logic-box .remove",function(){var e,t;a(this).parent().hasClass("urcl-conditional-group")?1<a(this).parent().parent().find(".urcl-conditional-group").length?a(this).parent().remove():0<a(this).parent().parent().parent().find(".urcl-conditional-or-group").length&&(a(this).parent().parent().next(".urcl-or-label").remove(),a(this).parent().parent().remove()):a(this).parent().hasClass("urcl-conditional-or-group")&&(1==a(this).parent().parent().find(".urcl-conditional-or-group").length?0===a(this).parent().parent().parent().find(".urcl-conditional-group").length?(e=a(this).parent().parent().prev(".urcl-or-label").length,t=a(this).parent().parent().next(".urcl-or-label").length,0===e?0<t&&(a(this).parent().parent().next(".urcl-or-label").remove(),a(this).parent().parent().remove()):(a(this).parent().parent().prev(".urcl-or-label").remove(),a(this).parent().parent().remove())):(a(this).parent().parent().prev(".urcl-or-label").remove(),a(this).parent().parent().remove()):a(this).parent().remove())}),a(document).on("click",".urcl-role-logic-wrap .urcl-remove-condition",function(){a(this).parent().remove(),1===a(".urcl-role-container").find(".urcl-role-logic-wrap").length&&a(".urcl-role-container").find(".urcl-remove-condition").remove()}),a(document).on("click",".urcl-role-container .urcl-add-new-condition",function(){1===a(".urcl-role-container").find(".urcl-role-logic-wrap").length&&a(".urcl-role-container").find(".urcl-role-logic-wrap .urcl-add-or-condition").after('<button class="urcl-remove-condition"></button>');var e=a(this).attr("data-last-conditionid");$output='<div class="urcl-form-settings-logic-wrap urcl-role-logic-wrap" data-group ="condition_'+ ++e+'">',$output+='<div class="urcl-form-settings-assign urcl-assign-role">',$output+='<p class="urcl-assign-label">'+urcl_data.assign+"</p>",$output+='<select class="urcl-form-settings-field urcl-user-role-field" name="user_registration_form_conditional_user_role[condition_'+e+']">',a.each(t.user_roles_list,function(e,t){$output+='<option value="'+e+'">'+t+"</option>"}),$output+="</select>",$output+="<p>"+urcl_data.only_if_following_matches+"</p>",$output+="</div>",$output+='<ul class="urcl-form-settings-logic-box urcl-role-logic-box" data-group ="condition_'+e+'" data-last-key="1">',$output+='<li class="urcl-conditional-group" data-key="1">',$output+='<div class="urcl-form-group">',$output+='<select class="urcl-form-settings-field urcl-user-role-field urcl-field-conditional-field-select" name="user_registration_form_fields[condition_'+e+'][1]">',$output+='<option value=""> -- Select --</option>',$output+=o(),$output+="</select></div>",$output+='<div class="urcl-operator"><select class="urcl-form-settings-field urcl-user-role-field" name="user_registration_form_operator[condition_'+e+'][1]">',$output+='<option value = "is" >is</option>',$output+='<option value = "is_not" >is not</option>',$output+='<option value = "empty"> empty </option>',$output+='<option value = "not_empty"> not empty </option>',$output+='<option value = "greater_than"> greater than </option>',$output+='<option value = "less_than"> less_than </option>',$output+="</select></div>",$output+='<div class="urcl-value"><input class="urcl-form-settings-field urcl-user-role-field" name="user_registration_user_registration_form_value[condition_'+e+'][1]" type="text" /></div>',$output+='<span class="add">',$output+="AND",$output+="</span>",$output+='<span class="remove">',$output+='<i class="dashicons dashicons-minus"></i>',$output+="</span></li>",$output+="</ul>",$output+='<button class="button button-secondary button-medium urcl-add-or-condition">Add OR Condition</button>',$output+='<button class="urcl-remove-condition"></button>',$output+="</div>",a(".urcl-role-conditional-container").append($output),a(this).attr("data-last-conditionid",e)}),a(document).on("click",".urcl-role-logic-wrap .urcl-add-or-condition",function(){var e=a(this).closest(".urcl-role-logic-wrap").attr("data-group"),t='<p class="urcl-or-label"> OR </p>';t+='<ul class="urcl-form-settings-logic-box urcl-or-groups urcl-role-logic-box" data-group ="'+e+'" data-last-key="1">',t+='<li class="urcl-conditional-or-group" data-key="1">',t+='<div class="urcl-form-group">',t+='<select class="urcl-form-settings-field urcl-user-role-field urcl-field-conditional-field-select" name="user_registration_form_fields[condition_'+e+'][1]">',t+='<option value=""> -- Select --</option>',t+=o(),t+="</select></div>",t+='<div class="urcl-operator"><select class="urcl-form-settings-field urcl-user-role-field" name="user_registration_form_operator[condition_'+e+'][1]">',t+='<option value = "is" >is</option>',t+='<option value = "is_not" >is not</option>',t+='<option value = "empty"> empty </option>',t+='<option value = "not_empty"> not empty </option>',t+='<option value = "greater_than"> greater than </option>',t+='<option value = "less_than"> less_than </option>',t+="</select></div>",t+='<div class="urcl-value"><input class="urcl-form-settings-field urcl-user-role-field" name="user_registration_user_registration_form_value[condition_'+e+'][1]" type="text" /></div>',t+='<span class="add">',t+="AND",t+="</span>",t+='<span class="remove">',t+='<i class="dashicons dashicons-minus"></i>',t+="</span></li>",t+="</ul>",a(this).before(t)}),a(document).on("change",".urcl-role-container .urcl-conditional-group .urcl-field-conditional-field-select",function(){i(".urcl-conditional-group",this)}),a(document).on("change",".urcl-role-container .urcl-conditional-or-group .urcl-field-conditional-field-select",function(){i(".urcl-conditional-or-group",this)})});