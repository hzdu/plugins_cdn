MabModalPopup=function(t,e){this.id=t,this.node=document.getElementById("modal-popup-"+t),this.element=this.node.querySelector('[data-element-id="'+t+'"]'),this.settings=e,this.cookieKey="max_modal_popup_"+this.id,this.lastScrollY=0,this.outsideClickClose=!0,this.escKeyPressClose=!0,this.preventPageScroll=!1,this.closeBtnDelay=0,this.autoCloseDelay=0,this.init()},MabModalPopup.prototype.init=function(){this.initConditions(),this.initRules(),this.bindEvents()},MabModalPopup.prototype.initConditions=function(){var t,e=this.getConditions();void 0!==e.pageViews&&(t="popup_"+this.id+"_page_views",e=null===(e=this.storage.get(t))?1:parseInt(e)+1,this.storage.set(t,e))},MabModalPopup.prototype.initRules=function(){var t=this.getAdvancedRules();t&&(t.preventCloseOutsideClick&&(this.outsideClickClose=!1),t.preventCloseEscKey&&(this.escKeyPressClose=!1),t.showCloseButtonAfter&&(this.closeBtnDelay=parseInt(t.showCloseButtonAfter)||0),t.autoCloseAfter&&(this.autoCloseDelay=parseInt(t.autoCloseAfter)||0),t.disablePageScroll&&(this.preventPageScroll=!0))},MabModalPopup.prototype.bindEvents=function(){var t=this.getTriggers();0<t.length&&t.forEach(function(t){if(void 0!==t)switch(t.type){case"onPageLoad":this.triggerOnPageLoad(t);break;case"onScroll":this.triggerOnScroll(t);break;case"onScrollTo":this.triggerOnScrollTo(t);break;case"onClick":this.triggerOnClick(t);break;case"onURLParameter":this.triggerOnURLParameter(t);break;case"onUserInactivity":this.triggerOnUserInactivity(t);break;case"onExitIntent":this.triggerOnExitIntent()}}.bind(this)),window.addEventListener("hashchange",this.triggerOnHashChange.bind(this)),window.addEventListener("load",this.triggerOnHashChange.bind(this),!0),void 0!==(t=this.node.getElementsByClassName("max-modal-popup-close")[0])&&(t.addEventListener("click",this.closeEvent.bind(this)),t.addEventListener("keypress",this.closeEvent.bind(this))),0<(t=this.node.querySelectorAll("[data-modal-popup-close]")).length&&t.forEach(function(t){void 0!==t&&t.addEventListener("click",this.closeEvent.bind(this))}.bind(this)),window.addEventListener("click",this.closeOnOutsideClick.bind(this),!0),window.addEventListener("keyup",this.closeOnEscKey.bind(this))},MabModalPopup.prototype.triggerOnPageLoad=function(t){void 0!==t.delay&&(0<(t=parseFloat(t.delay)||0)&&setTimeout(function(){this.removeEntranceAnimation()}.bind(this),t/2*1e3),setTimeout(function(){this.open()}.bind(this),1e3*t))},MabModalPopup.prototype.triggerOnScroll=function(t){var e,i,o;void 0!==t.offset&&(e=t.direction||"down",i=parseFloat(t.offset),i=isNaN(i)?50:i,o=!1,window.addEventListener("scroll",function(){var t;if(!o&&(t=scrollY>this.lastScrollY?"down":"up",this.lastScrollY=scrollY,t===e)){if("up"==t)return this.open(),void(o=!0);t=document.documentElement.scrollHeight-window.innerHeight,t=scrollY/t*100,i<=t&&(this.open(),o=!0)}}.bind(this)))},MabModalPopup.prototype.triggerOnScrollTo=function(t){var e,i;void 0!==t.selector&&(t=t.selector,e=document.querySelectorAll(t),i=!1,0<e.length&&((t=function(){e.forEach(function(t){var e=t.getBoundingClientRect();e.top<=window.innerHeight&&0<=e.bottom&&"none"!==window.getComputedStyle(t)&&!i&&(this.open(),i=!0)}.bind(this))}).bind(this).call(),window.addEventListener("scroll",t.bind(this)),window.addEventListener("resize",t.bind(this)),window.addEventListener("orientationchange",t.bind(this))))},MabModalPopup.prototype.triggerOnClick=function(t){void 0!==t.selector&&(t=t.selector,0<(t=document.querySelectorAll(t)).length&&t.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),this.onClickEvent=!0,this.open()}.bind(this))}.bind(this)))},MabModalPopup.prototype.triggerOnURLParameter=function(e){var i,t,o;void 0!==e.parameter&&""!==location.search&&(i=e.value||"",t=location.search.replace("?","").split("&"),o=!1,0<t.length&&t.forEach(function(t){void 0===t||(t=t.split("="))[0]===e.parameter&&(o=!0,(void 0===t[1]&&""!==i||void 0!==t[1]&&t[1]!==i)&&(o=!1))}),o&&this.open())},MabModalPopup.prototype.triggerOnUserInactivity=function(t){var e,i=parseInt(t.duration)?parseInt(t.duration):30,o=function(){e=setTimeout(function(){this.open()}.bind(this),1e3*i)}.bind(this),t=function(){clearTimeout(e),o()};o(),document.addEventListener("keypress",t.bind(this)),document.addEventListener("mousemove",t.bind(this))},MabModalPopup.prototype.triggerOnExitIntent=function(){document.addEventListener("mouseleave",function(t){t.clientY<=0&&this.open()}.bind(this))},MabModalPopup.prototype.triggerOnHashChange=function(){var t=window.location.hash;""!==t&&1!==(t=t.replace("#","").split("-")).length&&"modal"===t[0]&&this.id===t[1]&&null!==document.getElementById("modal-popup-"+t[1])&&this.open()},MabModalPopup.prototype.closeEvent=function(t){1!==t.which&&13!==t.which&&32!==t.which&&void 0!==t.which||(t.preventDefault(),this.close())},MabModalPopup.prototype.closeOnOutsideClick=function(t){this.outsideClickClose&&("brxe-"+this.id===t.target.id||t.target.closest(".brxe-max-modal-popup")||"max-modal-popup-backdrop"===t.target.getAttribute("class")&&this.id!==t.target.closest(".max-modal-popup").dataset.modalId||this.close())},MabModalPopup.prototype.closeOnEscKey=function(t){this.escKeyPressClose&&27===t.which&&this.close()},MabModalPopup.prototype.isActive=function(){return this.node.classList.contains("active")},MabModalPopup.prototype.open=function(t){if(!this.isActive()){if(!this.onClickEvent){if(this.getCookie(this.cookieKey))return;if(!this.isValidCondition())return}this.preventPageScroll&&document.documentElement.classList.add("max-disable-scroll"),this.removeEntranceAnimation(),this.node.classList.add("active"),this.setEntranceAnimation(),this.node.setAttribute("tabindex","0");var e=this.node.getElementsByClassName("max-modal-popup-close")[0];void 0!==e&&(e.style.display="none",setTimeout(function(){e.style.removeProperty("display")}.bind(this),1e3*this.closeBtnDelay)),setTimeout(function(){this.node.focus()}.bind(this),100),this.onClickEvent||this.setCookie(this.cookieKey,!0,this.getReTriggerTime()),this.setActiveCount(),this.autoCloseDelay&&setTimeout(function(){this.close()}.bind(this),1e3*this.autoCloseDelay),this.triggerHook("max_modal_popup:open")}},MabModalPopup.prototype.close=function(){this.isActive()&&(this.removeEntranceAnimation(),""!==this.getExitAnimation()?(this.setExitAnimation(),setTimeout(function(){this.node.classList.remove("active"),this.removeExitAnimation()}.bind(this),1e3*this.getAnimationDuration())):this.node.classList.remove("active"),this.node.setAttribute("tabindex","-1"),this.onClickEvent=!1,this.preventPageScroll&&document.documentElement.classList.remove("max-disable-scroll"),this.triggerHook("max_modal_popup:close"))},MabModalPopup.prototype.setActiveCount=function(){var t="popup_"+this.id+"_times",e=(e=this.storage.get(t))?parseInt(e):0;this.storage.set(t,e+1)},MabModalPopup.prototype.isValidCondition=function(){var t,e,i=this.getConditions(),o=!0;return void 0!==i.pageViews&&(t="popup_"+this.id+"_page_views",e=this.storage.get(t),parseInt(e)<parseInt(i.pageViews)&&(o=!1)),void 0!==i.times&&(t="popup_"+this.id+"_times",e=this.storage.get(t),parseInt(e)>=parseInt(i.times)&&(i.resetTimes&&this.getReTriggerTime()?this.storage.set(t,0):o=!1)),o},MabModalPopup.prototype.setEntranceAnimation=function(){var t=this.getEntranceAnimation();""!==t&&setTimeout(function(){this.element.classList.add("brx-animate-"+t)}.bind(this),0)},MabModalPopup.prototype.removeEntranceAnimation=function(){var t=this.getEntranceAnimation();""!==t&&setTimeout(function(){this.element.classList.remove("brx-animate-"+t)}.bind(this),0)},MabModalPopup.prototype.setExitAnimation=function(){var t=this.getExitAnimation();""!==t&&setTimeout(function(){this.element.classList.add("brx-animate-"+t)}.bind(this),0)},MabModalPopup.prototype.removeExitAnimation=function(){var t=this.getExitAnimation();""!==t&&setTimeout(function(){this.element.classList.remove("brx-animate-"+t)}.bind(this),0)},MabModalPopup.prototype.getEntranceAnimation=function(){var t=this.getAnimation();return t.hasOwnProperty("entrance")?t.entrance:""},MabModalPopup.prototype.getExitAnimation=function(){var t=this.getAnimation();return t.hasOwnProperty("exit")?t.exit:""},MabModalPopup.prototype.getAnimation=function(){return this.settings.hasOwnProperty("animation")?this.settings.animation:{}},MabModalPopup.prototype.getAnimationDuration=function(){var t=this.getAnimation();return t.hasOwnProperty("duration")&&parseFloat(t.duration)||1},MabModalPopup.prototype.getTriggers=function(){return this.settings.hasOwnProperty("triggers")?this.settings.triggers:[]},MabModalPopup.prototype.getReTriggerTime=function(){return this.settings.reTriggerAfter||0},MabModalPopup.prototype.getAdvancedRules=function(){return!!this.settings.hasOwnProperty("advancedRules")&&this.settings.advancedRules},MabModalPopup.prototype.getConditions=function(){return this.settings.hasOwnProperty("conditions")?this.settings.conditions:{}},MabModalPopup.prototype.setCookie=function(t,e,i){""!==i&&0!==parseInt(i)||(i=0),document.cookie=t+"="+e+'; path="/"; max-age='+86400*i},MabModalPopup.prototype.getCookie=function(t){return 2===(t=("; "+document.cookie).split("; "+t+"=")).length&&t.pop().split(";").shift()},MabModalPopup.prototype.triggerHook=function(t,e){"object"!=typeof e&&(e={}),window.dispatchEvent(new CustomEvent(t,{detail:Object.assign({id:this.id,instance:this},e)})),void 0!==(e=t.split(":"))[1]&&(t=e[1]),this.node.dispatchEvent(new Event(t))},MabModalPopup.prototype.storage={key:"max_addons_bricks",cache:{},get:function(t){var e;return void 0!==this.cache[t]?this.cache[t]:(e=localStorage.getItem(this.key))&&""!==e?("object"!=typeof e&&(e=JSON.parse(e)),void 0!==(this.cache=e)[t]?e[t]:null):(localStorage.setItem(this.key,"{}"),null)},set:function(t,e){var i=localStorage.getItem(this.key);"object"!=typeof(i=i&&""!==i?i:{})&&(i=JSON.parse(i)),"object"==typeof e&&(e=JSON.stringify(e)),i[t]=e,localStorage.setItem(this.key,JSON.stringify(i)),this.cache=i}},document.addEventListener("DOMContentLoaded",function(t){bricksIsFrontend&&bricksQuerySelectorAll(document,".bricks-element-max-modal-popop, .brxe-max-modal-popup").forEach(function(t){var e=t.getAttribute("data-element-id"),t=JSON.parse(t.getAttribute("data-settings"));window["max_modal_popup_"+e]=new MabModalPopup(e,t)})});